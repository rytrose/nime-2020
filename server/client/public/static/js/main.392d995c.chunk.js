(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1002:function(e,t){},1019:function(e,t){},1021:function(e,t){},1035:function(e,t){},1037:function(e,t){},1101:function(e,t){},1103:function(e,t){},1139:function(e,t){},1141:function(e,t){},1147:function(e,t){},1304:function(e,t){},1324:function(e,t){},1326:function(e,t){},1356:function(e,t){},1358:function(e,t){},1365:function(e,t){},1367:function(e,t){},1372:function(e,t){},1373:function(e,t){},1385:function(e,t){},1387:function(e,t){},139:function(e,t,n){"use strict";(function(e){var r=n(4),a=n(5),i=(n(88),n(13)),s=n.n(i),o=n(39),c=(n(26),function(){function t(e,n){Object(r.a)(this,t),this.onSoundUploaded=n,this.numChannels=e,this.soundIdCounter=0}return Object(a.a)(t,[{key:"exportToWAV",value:function(t,n){new FormData;var r=new Worker("/recorderWorker.js");r.postMessage({command:"init",config:{sampleRate:s.a.context.sampleRate,numChannels:this.numChannels}}),r.onmessage=function(t){var r,a=t.data,i=new FileReader;i.onload=function(){r=this.result,n(new e(r))},i.readAsArrayBuffer(a)},r.postMessage({command:"record",buffer:t}),r.postMessage({command:"exportWAV",type:"audio/wav"})}},{key:"uploadBufferToIpfs",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;return new Promise(function(a,i){new FormData;var c=t,u=new Worker("/recorderWorker.js");console.log("buffer = "),console.log(e),u.postMessage({command:"init",config:{sampleRate:s.a.context.sampleRate,numChannels:t.numChannels}});new Date;if(u.onmessage=function(e){var t=this,i=e.data;console.log("adding blob to ipfs!"),o.a.addBlob(i).then(function(e){n&&c.onSoundUploaded(t.soundIdCounter++,e,r),a(e)})},n)u.postMessage({command:"record",buffer:e});else{for(var l=[],p=0;p<e.numberOfChannels;p++)l.push(e.getChannelData(p));u.postMessage({command:"record",buffer:l})}u.postMessage({command:"exportWAV",type:"audio/wav"})})}},{key:"uploadVideoBlob",value:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];console.log("buffer = "),console.log(e);new FormData;var c=this,u=new Worker("/recorderWorker.js");u.postMessage({command:"init",config:{sampleRate:s.a.context.sampleRate,numChannels:this.numChannels}});new Date;u.onmessage=function(e){var t=e.data;o.a.addBlob(t).then(function(e){i?c.onSoundUploaded(void 0,e,a):c.onSoundUploaded(a,e,a)})},u.postMessage({command:"record",buffer:e}),u.postMessage({command:"exportWAV",type:"audio/wav"})}}]),t}());t.a=c}).call(this,n(14).Buffer)},1394:function(e,t){},1396:function(e,t){},1402:function(e,t){},1409:function(e,t){},1411:function(e,t){},1421:function(e,t){},1423:function(e,t){},1437:function(e,t){},1439:function(e,t){},144:function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return u});n(90);var r=n(27),a={A:"a","A#":"A",B:"b",C:"c","C#":"C",D:"d","D#":"D",E:"e",F:"f","F#":"F",G:"g","G#":"G"},i={A:r.a.utils.asciiToHex("a"),"A#":r.a.utils.asciiToHex("A"),B:r.a.utils.asciiToHex("b"),C:r.a.utils.asciiToHex("c"),"C#":r.a.utils.asciiToHex("C"),D:r.a.utils.asciiToHex("d"),"D#":r.a.utils.asciiToHex("D"),E:r.a.utils.asciiToHex("e"),F:r.a.utils.asciiToHex("f"),"F#":r.a.utils.asciiToHex("F"),G:r.a.utils.asciiToHex("g"),"G#":r.a.utils.asciiToHex("G")},s={};for(var o in i)s[i[o]]=o;for(var c in s={},a)s[a[c]]=c;var u=s},153:function(e,t,n){"use strict";function r(e){for(var t=e.length-1;t>=0;t--)if("0"!==e.slice(t,t+1))return e.slice(0,t+1)}function a(e){for(var t=0;t<e.length;t++)if("0"!==e.slice(t,t+1))return e.slice(t)}n.d(t,"b",function(){return r}),n.d(t,"a",function(){return a})},157:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r="SEQUENCE_USED_SOUND"},1621:function(e,t){},1622:function(e,t){},1623:function(e,t){},1624:function(e,t){},1625:function(e,t){},1626:function(e,t){},1628:function(e,t,n){"use strict";n(4)},1645:function(e,t,n){},1665:function(e,t,n){},1666:function(e,t,n){},1667:function(e,t,n){},1668:function(e,t,n){},1669:function(e,t,n){},168:function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"bytes32[16]",name:"sampleHashes",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"titles",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"youtubeVideoIds",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"coverArtHashes",type:"bytes32[16]"},{internalType:"uint256[16]",name:"discogIds",type:"uint256[16]"},{internalType:"bytes32[4][16]",name:"tagsToAdd",type:"bytes32[4][16]"},{internalType:"bytes32[4][16]",name:"stylesToAdd",type:"bytes32[4][16]"},{internalType:"bytes32[16]",name:"countries",type:"bytes32[16]"},{internalType:"int16[16]",name:"sampleYears",type:"int16[16]"},{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"bytes32[9]",name:"encryptedContentKey",type:"bytes32[9]"},{internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"newEncryptedSamples",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32[16]",name:"sampleHashes",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"titles",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"youtubeVideoIds",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"coverArtHashes",type:"bytes32[16]"},{internalType:"uint256[16]",name:"discogIds",type:"uint256[16]"},{internalType:"bytes32[4][16]",name:"tagsToAdd",type:"bytes32[4][16]"},{internalType:"bytes32[4][16]",name:"stylesToAdd",type:"bytes32[4][16]"},{internalType:"bytes32[16]",name:"countries",type:"bytes32[16]"},{internalType:"int16[16]",name:"sampleYears",type:"int16[16]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"newSamplesWithMetadata",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"string",name:"title",type:"string"},{internalType:"bytes32",name:"youtubeVideoId",type:"bytes32"},{internalType:"bytes32[4]",name:"tagsToAdd",type:"bytes32[4]"},{internalType:"bytes32[4]",name:"stylesToAdd",type:"bytes32[4]"},{internalType:"bytes32",name:"country",type:"bytes32"},{internalType:"int16",name:"year",type:"int16"},{internalType:"uint256",name:"discogsId",type:"uint256"},{internalType:"bytes32",name:"coverArtHash",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"newSampleWithMetadata",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"country",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleCountry",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32[4]",name:"stylesToAdd",type:"bytes32[4]"},{internalType:"bytes32",name:"country",type:"bytes32"},{internalType:"int16",name:"year",type:"int16"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleDiscogsMetadata",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"style",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleStyle",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"tag",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleTag",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32[4]",name:"tagsToAdd",type:"bytes32[4]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleTags",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"int16",name:"year",type:"int16"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleYear",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"youtubeVideoId",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleYoutubeVideoId",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"guildsAddress",type:"address"},{internalType:"address",name:"encryptionAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!1,internalType:"string",name:"title",type:"string"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampleCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"youtubeVideoId",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampledYoutube",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"tag",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampleTagged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"style",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampleStyle",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"int16",name:"year",type:"int16"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampleYear",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"country",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampleCountry",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"discogsId",type:"uint256"},{indexed:!0,internalType:"bytes32",name:"coverArtHash",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"NewDiscogsSample",type:"event"}],this.contractAddress="0xc77d4e72dF7D0Bf96488eF543253af537fEb8737"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},169:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(26);function a(e){e=function(e){return 0===e.indexOf("0x")?e.slice(2):e}(e);for(var t=[],n=0;n<e.length;n+=64)e.length<n+64?t.push(i("0x"+e.slice(n))):t.push(i("0x"+e.slice(n,n+64)));return t}function i(e){return r.a.web3.utils.padRight(e,64)}},172:function(e,t,n){"use strict";var r=n(3),a=n.n(r),i=n(15),s=n(12),o=n(4),c=n(5),u=n(132),l=n.n(u),p=n(133),h=n.n(p),f=16384,d=256,m={name:"AES-CTR",counter:new h.a.Counter(5)._counter,length:64};function v(e,t){return g.apply(this,arguments)}function g(){return(g=Object(s.a)(a.a.mark(function e(t,n){var r,i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.length<f)){e.next=4;break}return e.next=3,k(t,n);case 3:return e.abrupt("return",e.sent);case 4:return r=b(t),e.next=7,k(r,n);case 7:return i=e.sent,s=y(t,new Uint8Array(i)),e.abrupt("return",s);case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function y(e,t){for(var n=Math.ceil(f/d),r=Math.floor(e.length/d),a=0;a<d;a++){var i=a*r,s=a*n;e.set(t.subarray(s,s+n),i)}return e}function b(e){for(var t=Math.ceil(f/d),n=Math.floor(e.length/d),r=new Uint8Array(f),a=0;a<d;a++){var i=a*n;r.set(e.subarray(i,i+t),a*t)}return r}function k(e,t){return E.apply(this,arguments)}function E(){return(E=Object(s.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.importKey("raw",new Uint8Array(n).buffer,{name:"AES-CTR"},!1,["encrypt","decrypt"]);case 2:return r=e.sent,e.next=5,window.crypto.subtle.encrypt(m,r,new Uint8Array(t));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function O(e,t){return S.apply(this,arguments)}function S(){return(S=Object(s.a)(a.a.mark(function e(t,n){var r,i,s,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.length<f)){e.next=5;break}return e.next=3,P(t,n);case 3:return r=e.sent,e.abrupt("return",new Uint8Array(r));case 5:return i=b(t),e.t0=Uint8Array,e.next=9,P(i,n);case 9:return e.t1=e.sent,s=new e.t0(e.t1),o=y(t,s),e.abrupt("return",o);case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}function P(e,t){return w.apply(this,arguments)}function w(){return(w=Object(s.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.importKey("raw",new Uint8Array(n).buffer,{name:"AES-CTR"},!1,["decrypt"]);case 2:return r=e.sent,e.next=5,window.crypto.subtle.decrypt(m,r,t);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}var j=n(26);function T(e,t){for(var n=Math.ceil(e.length/256),r=Object(i.a)(t),a=void 0,s=0;s<256;s++){var o=s*n,c=(s+r[s%r.length])%256*n,u=e.subarray(o,o+n);a=Object(i.a)(e.subarray(c,c+n)),c+n>e.length||o+n>e.length||(e.set(u,c),e.set(a,o))}return e}function x(e,t){for(var n=Math.ceil(e.length/256),r=Object(i.a)(t),a=void 0,s=255;s>=0;s--){var o=s*n,c=(s+r[s%r.length])%256*n;if(!(o+n>e.length||c+n>e.length)){var u=e.subarray(o,o+n);a=new Uint8Array(e.subarray(c,c+n)),e.set(u,c),e.set(a,o)}}return e}var C=n(169),N=(new h.a.Counter(5)._counter,function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.a.generateAESKey();Object(o.a)(this,e),this.contentKey="string"===typeof t?h.a.utils.hex.toBytes(t):t,this.publicKey=void 0}return Object(c.a)(e,[{key:"encryptKey",value:function(e){this.publicKey=e;var t=h.a.utils.hex.fromBytes(this.contentKey),n=l.a.encrypt(t,e).cipher,r=j.a.web3.utils.toHex(n);this.encryptedContentKey=r,this.eck=n}},{key:"convertForEthereum",value:function(){return Object(C.a)(this.encryptedContentKey)}},{key:"encryptContent",value:function(){var e=Object(s.a)(a.a.mark(function e(t){var n,r,s,o,c,u,l,p=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=p.length>1&&void 0!==p[1]&&p[1],void 0!==t){e.next=3;break}return e.abrupt("return","");case 3:if(r=new Uint8Array(this.contentKey).buffer,s=n?t:h.a.utils.utf8.toBytes(t),o=n?T(s,new Uint8Array(this.contentKey)):s,!n){e.next=13;break}return e.next=9,v(o,r);case 9:return c=e.sent,e.abrupt("return",c);case 13:return e.next=15,k(s,this.contentKey);case 15:return u=e.sent,l=h.a.utils.hex.fromBytes(Object(i.a)(new Uint8Array(u))),e.abrupt("return",l);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"decryptContent",value:function(e){var t=this;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?new Promise(function(){var n=Object(s.a)(a.a.mark(function n(r,i){var s;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,O(e,t.contentKey);case 2:s=x(s=n.sent,new Uint8Array(t.contentKey)),r(s);case 5:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}()):new Promise(function(){var n=Object(s.a)(a.a.mark(function n(r,s){var o,c,u;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o=h.a.utils.hex.toBytes(e),n.next=3,P(new Uint8Array(o),t.contentKey);case 3:c=n.sent,u=h.a.utils.utf8.fromBytes(Object(i.a)(new Uint8Array(c))),r(u);case 6:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getPublicKeyAsBytes32",value:function(){var e=j.a.web3.utils.toHex(this.publicKey);return Object(C.a)(e)}}]),e}());t.a=N},1741:function(e,t){},1750:function(e,t){},1752:function(e,t){},181:function(e,t,n){},1848:function(e,t){},188:function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a});var r=1,a=4},189:function(e,t,n){"use strict";(function(e){n.d(t,"b",function(){return a}),n.d(t,"a",function(){return i});var r=n(114);function a(e){var t=r.decode(e).toString("hex").replace(/^1220/,"");return 64!=t.length?null:"0x"+t}function i(t){var n=new e(t.replace(/^0x/,"1220"),"hex");return r.encode(n)}}).call(this,n(14).Buffer)},1890:function(e,t){},1895:function(e,t){},1897:function(e,t){},1914:function(e,t){},1916:function(e,t){},2:function(e,t,n){"use strict";n.d(t,"id",function(){return r}),n.d(t,"Rd",function(){return a}),n.d(t,"zf",function(){return i}),n.d(t,"yb",function(){return s}),n.d(t,"xb",function(){return o}),n.d(t,"Od",function(){return c}),n.d(t,"Ic",function(){return u}),n.d(t,"ob",function(){return l}),n.d(t,"qb",function(){return p}),n.d(t,"mb",function(){return h}),n.d(t,"kd",function(){return f}),n.d(t,"Jf",function(){return d}),n.d(t,"Kf",function(){return m}),n.d(t,"nd",function(){return v}),n.d(t,"a",function(){return g}),n.d(t,"p",function(){return y}),n.d(t,"i",function(){return b}),n.d(t,"g",function(){return k}),n.d(t,"h",function(){return E}),n.d(t,"m",function(){return O}),n.d(t,"k",function(){return S}),n.d(t,"j",function(){return P}),n.d(t,"b",function(){return w}),n.d(t,"Mf",function(){return j}),n.d(t,"Lf",function(){return T}),n.d(t,"of",function(){return x}),n.d(t,"Nf",function(){return C}),n.d(t,"x",function(){return N}),n.d(t,"bf",function(){return R}),n.d(t,"kf",function(){return D}),n.d(t,"Nd",function(){return q}),n.d(t,"yd",function(){return M}),n.d(t,"rf",function(){return A}),n.d(t,"gf",function(){return I}),n.d(t,"nf",function(){return L}),n.d(t,"Vb",function(){return F}),n.d(t,"Tb",function(){return B}),n.d(t,"dd",function(){return H}),n.d(t,"lc",function(){return V}),n.d(t,"mc",function(){return U}),n.d(t,"nc",function(){return J}),n.d(t,"jc",function(){return _}),n.d(t,"kc",function(){return G}),n.d(t,"Qd",function(){return z}),n.d(t,"Ld",function(){return W}),n.d(t,"dc",function(){return K}),n.d(t,"He",function(){return Q}),n.d(t,"Ke",function(){return X}),n.d(t,"Sd",function(){return Y}),n.d(t,"vd",function(){return Z}),n.d(t,"Fb",function(){return $}),n.d(t,"Db",function(){return ee}),n.d(t,"Cd",function(){return te}),n.d(t,"Dd",function(){return ne}),n.d(t,"Cc",function(){return re}),n.d(t,"nb",function(){return ae}),n.d(t,"Jb",function(){return ie}),n.d(t,"mf",function(){return se}),n.d(t,"cf",function(){return oe}),n.d(t,"Gf",function(){return ce}),n.d(t,"kb",function(){return ue}),n.d(t,"yf",function(){return le}),n.d(t,"Le",function(){return pe}),n.d(t,"Qe",function(){return he}),n.d(t,"Yb",function(){return fe}),n.d(t,"Zb",function(){return de}),n.d(t,"ve",function(){return me}),n.d(t,"Zd",function(){return ve}),n.d(t,"ue",function(){return ge}),n.d(t,"qe",function(){return ye}),n.d(t,"re",function(){return be}),n.d(t,"Xd",function(){return ke}),n.d(t,"bb",function(){return Ee}),n.d(t,"hc",function(){return Oe}),n.d(t,"Ge",function(){return Se}),n.d(t,"Zc",function(){return Pe}),n.d(t,"Ed",function(){return we}),n.d(t,"qd",function(){return je}),n.d(t,"ud",function(){return Te}),n.d(t,"Ee",function(){return xe}),n.d(t,"xc",function(){return Ce}),n.d(t,"Ab",function(){return Ne}),n.d(t,"ld",function(){return Re}),n.d(t,"rc",function(){return De}),n.d(t,"ef",function(){return qe}),n.d(t,"Id",function(){return Me}),n.d(t,"tf",function(){return Ae}),n.d(t,"zc",function(){return Ie}),n.d(t,"xf",function(){return Le}),n.d(t,"sb",function(){return Fe}),n.d(t,"vf",function(){return Be}),n.d(t,"Tc",function(){return He}),n.d(t,"Sc",function(){return Ve}),n.d(t,"gb",function(){return Ue}),n.d(t,"ee",function(){return Je}),n.d(t,"Ve",function(){return _e}),n.d(t,"cd",function(){return Ge}),n.d(t,"n",function(){return ze}),n.d(t,"De",function(){return We}),n.d(t,"Md",function(){return Ke}),n.d(t,"Je",function(){return Qe}),n.d(t,"w",function(){return Xe}),n.d(t,"u",function(){return Ye}),n.d(t,"v",function(){return Ze}),n.d(t,"if",function(){return $e}),n.d(t,"jf",function(){return et}),n.d(t,"uc",function(){return tt}),n.d(t,"Ib",function(){return nt}),n.d(t,"Yc",function(){return rt}),n.d(t,"oc",function(){return at}),n.d(t,"gd",function(){return it}),n.d(t,"pc",function(){return st}),n.d(t,"ne",function(){return ot}),n.d(t,"Gc",function(){return ct}),n.d(t,"ge",function(){return ut}),n.d(t,"Vd",function(){return lt}),n.d(t,"af",function(){return pt}),n.d(t,"me",function(){return ht}),n.d(t,"ke",function(){return ft}),n.d(t,"de",function(){return dt}),n.d(t,"lf",function(){return mt}),n.d(t,"If",function(){return vt}),n.d(t,"vc",function(){return gt}),n.d(t,"Z",function(){return yt}),n.d(t,"hd",function(){return bt}),n.d(t,"Hf",function(){return kt}),n.d(t,"R",function(){return Et}),n.d(t,"Bf",function(){return Ot}),n.d(t,"Cf",function(){return St}),n.d(t,"Bc",function(){return Pt}),n.d(t,"Pc",function(){return wt}),n.d(t,"Oc",function(){return jt}),n.d(t,"f",function(){return Tt}),n.d(t,"tc",function(){return xt}),n.d(t,"Lc",function(){return Ct}),n.d(t,"t",function(){return Nt}),n.d(t,"s",function(){return Rt}),n.d(t,"e",function(){return Dt}),n.d(t,"Td",function(){return qt}),n.d(t,"Ud",function(){return Mt}),n.d(t,"Be",function(){return At}),n.d(t,"db",function(){return It}),n.d(t,"ib",function(){return Lt}),n.d(t,"hb",function(){return Ft}),n.d(t,"cb",function(){return Bt}),n.d(t,"ad",function(){return Ht}),n.d(t,"Y",function(){return Vt}),n.d(t,"sd",function(){return Ut}),n.d(t,"Ac",function(){return Jt}),n.d(t,"te",function(){return _t}),n.d(t,"Yd",function(){return Gt}),n.d(t,"ie",function(){return zt}),n.d(t,"Rc",function(){return Wt}),n.d(t,"oe",function(){return Kt}),n.d(t,"l",function(){return Qt}),n.d(t,"be",function(){return Xt}),n.d(t,"Eb",function(){return Yt}),n.d(t,"jb",function(){return Zt}),n.d(t,"Ad",function(){return $t}),n.d(t,"wd",function(){return en}),n.d(t,"we",function(){return tn}),n.d(t,"Dc",function(){return nn}),n.d(t,"ce",function(){return rn}),n.d(t,"Me",function(){return an}),n.d(t,"rb",function(){return sn}),n.d(t,"Ec",function(){return on}),n.d(t,"Ne",function(){return cn}),n.d(t,"od",function(){return un}),n.d(t,"td",function(){return ln}),n.d(t,"ae",function(){return pn}),n.d(t,"wb",function(){return hn}),n.d(t,"Gb",function(){return fn}),n.d(t,"hf",function(){return dn}),n.d(t,"Ub",function(){return mn}),n.d(t,"Hd",function(){return vn}),n.d(t,"q",function(){return gn}),n.d(t,"ze",function(){return yn}),n.d(t,"le",function(){return bn}),n.d(t,"sc",function(){return kn}),n.d(t,"xe",function(){return En}),n.d(t,"zb",function(){return On}),n.d(t,"xd",function(){return Sn}),n.d(t,"Fd",function(){return Pn}),n.d(t,"Wb",function(){return wn}),n.d(t,"vb",function(){return jn}),n.d(t,"ub",function(){return Tn}),n.d(t,"tb",function(){return xn}),n.d(t,"Pb",function(){return Cn}),n.d(t,"bd",function(){return Nn}),n.d(t,"md",function(){return Rn}),n.d(t,"Cb",function(){return Dn}),n.d(t,"Oe",function(){return qn}),n.d(t,"df",function(){return Mn}),n.d(t,"qf",function(){return An}),n.d(t,"Sb",function(){return In}),n.d(t,"Qb",function(){return Ln}),n.d(t,"Rb",function(){return Fn}),n.d(t,"Bb",function(){return Bn}),n.d(t,"Bd",function(){return Hn}),n.d(t,"Ae",function(){return Vn}),n.d(t,"Ie",function(){return Un}),n.d(t,"rd",function(){return Jn}),n.d(t,"pe",function(){return _n}),n.d(t,"yc",function(){return Gn}),n.d(t,"Mc",function(){return zn}),n.d(t,"Kc",function(){return Wn}),n.d(t,"he",function(){return Kn}),n.d(t,"zd",function(){return Qn}),n.d(t,"lb",function(){return Xn}),n.d(t,"Wc",function(){return Yn}),n.d(t,"Xc",function(){return Zn}),n.d(t,"Fe",function(){return $n}),n.d(t,"fe",function(){return er}),n.d(t,"ye",function(){return tr}),n.d(t,"wf",function(){return nr}),n.d(t,"Uc",function(){return rr}),n.d(t,"eb",function(){return ar}),n.d(t,"fb",function(){return ir}),n.d(t,"Af",function(){return sr}),n.d(t,"sf",function(){return or}),n.d(t,"Pe",function(){return cr}),n.d(t,"O",function(){return ur}),n.d(t,"I",function(){return lr}),n.d(t,"A",function(){return pr}),n.d(t,"G",function(){return hr}),n.d(t,"y",function(){return fr}),n.d(t,"N",function(){return dr}),n.d(t,"H",function(){return mr}),n.d(t,"M",function(){return vr}),n.d(t,"Q",function(){return gr}),n.d(t,"Kd",function(){return yr}),n.d(t,"Mb",function(){return br}),n.d(t,"Lb",function(){return kr}),n.d(t,"Jd",function(){return Er}),n.d(t,"gc",function(){return Or}),n.d(t,"ff",function(){return Sr}),n.d(t,"Vc",function(){return Pr}),n.d(t,"P",function(){return wr}),n.d(t,"Te",function(){return jr}),n.d(t,"B",function(){return Tr}),n.d(t,"C",function(){return xr}),n.d(t,"D",function(){return Cr}),n.d(t,"J",function(){return Nr}),n.d(t,"L",function(){return Rr}),n.d(t,"F",function(){return Dr}),n.d(t,"K",function(){return qr}),n.d(t,"E",function(){return Mr}),n.d(t,"pd",function(){return Ar}),n.d(t,"Hb",function(){return Ir}),n.d(t,"z",function(){return Lr}),n.d(t,"We",function(){return Fr}),n.d(t,"Xe",function(){return Br}),n.d(t,"Wd",function(){return Hr}),n.d(t,"Ze",function(){return Vr}),n.d(t,"Nc",function(){return Ur}),n.d(t,"r",function(){return Jr}),n.d(t,"Re",function(){return _r}),n.d(t,"je",function(){return Gr}),n.d(t,"Gd",function(){return zr}),n.d(t,"d",function(){return Wr}),n.d(t,"Ye",function(){return Kr}),n.d(t,"S",function(){return Qr}),n.d(t,"U",function(){return Xr}),n.d(t,"V",function(){return Yr}),n.d(t,"W",function(){return Zr}),n.d(t,"pf",function(){return $r}),n.d(t,"X",function(){return ea}),n.d(t,"T",function(){return ta}),n.d(t,"Ob",function(){return na}),n.d(t,"Kb",function(){return ra}),n.d(t,"c",function(){return aa}),n.d(t,"fd",function(){return ia}),n.d(t,"Df",function(){return sa}),n.d(t,"Ef",function(){return oa}),n.d(t,"Ff",function(){return ca}),n.d(t,"Nb",function(){return ua}),n.d(t,"ic",function(){return la}),n.d(t,"Qc",function(){return pa}),n.d(t,"pb",function(){return ha}),n.d(t,"jd",function(){return fa}),n.d(t,"o",function(){return da}),n.d(t,"Jc",function(){return ma}),n.d(t,"ed",function(){return va}),n.d(t,"fc",function(){return ga}),n.d(t,"ab",function(){return ya}),n.d(t,"ac",function(){return ba}),n.d(t,"cc",function(){return ka}),n.d(t,"bc",function(){return Ea}),n.d(t,"Hc",function(){return Oa}),n.d(t,"Ue",function(){return Sa}),n.d(t,"qc",function(){return Pa}),n.d(t,"Pd",function(){return wa}),n.d(t,"Ce",function(){return ja}),n.d(t,"se",function(){return Ta}),n.d(t,"Se",function(){return xa}),n.d(t,"Xb",function(){return Ca}),n.d(t,"wc",function(){return Na}),n.d(t,"ec",function(){return Ra}),n.d(t,"Fc",function(){return Da}),n.d(t,"uf",function(){return qa});var r=1,a=2,i=3,s=4,o=5,c=6,u=7,l=8,p=9,h=10,f=11,d=12,m=13,v=16,g=17,y=18,b=19,k=20,E=21,O=22,S=23,P=24,w=25,j=26,T=27,x=28,C=29,N=30,R=31,D=32,q=33,M=34,A=35,I=36,L=37,F=38,B=39,H=40,V=41,U=42,J=43,_=44,G=45,z=46,W=47,K=48,Q=49,X=50,Y=51,Z=52,$=53,ee=54,te=55,ne=56,re=57,ae=58,ie=59,se=60,oe=61,ce=62,ue=63,le=64,pe=65,he=66,fe=67,de=68,me=69,ve=70,ge=71,ye=72,be=73,ke=74,Ee=75,Oe=76,Se=77,Pe=78,we=79,je=80,Te=81,xe=82,Ce=83,Ne=84,Re=85,De=86,qe=87,Me=88,Ae=89,Ie=90,Le=91,Fe=92,Be=93,He=94,Ve=95,Ue=96,Je=97,_e=98,Ge=99,ze=100,We=101,Ke=102,Qe=103,Xe=104,Ye=105,Ze=106,$e=107,et=108,tt=109,nt=110,rt=111,at=112,it=113,st=114,ot=115,ct=116,ut=117,lt=118,pt=119,ht=120,ft=121,dt=122,mt=123,vt=124,gt=125,yt=126,bt=127,kt=128,Et=129,Ot=130,St=131,Pt=132,wt=133,jt=134,Tt=135,xt=136,Ct=137,Nt=138,Rt=139,Dt=140,qt=141,Mt=142,At=143,It=144,Lt=145,Ft=146,Bt=147,Ht=148,Vt=149,Ut=150,Jt=151,_t=152,Gt=153,zt=154,Wt=155,Kt=156,Qt=157,Xt=158,Yt=159,Zt=160,$t=161,en=162,tn=163,nn=164,rn=165,an=166,sn=167,on=168,cn=169,un=170,ln=171,pn=172,hn=173,fn=174,dn=175,mn=176,vn=178,gn=179,yn=180,bn=181,kn=182,En=183,On=184,Sn=185,Pn=186,wn=187,jn=188,Tn=189,xn=190,Cn=191,Nn=192,Rn=193,Dn=194,qn=195,Mn=196,An=197,In=198,Ln=199,Fn=200,Bn=201,Hn=202,Vn=203,Un=204,Jn=205,_n=206,Gn=207,zn=208,Wn=209,Kn=210,Qn=211,Xn=212,Yn=213,Zn=214,$n=215,er=216,tr=217,nr=218,rr=219,ar=220,ir=221,sr=222,or=223,cr=224,ur=225,lr=226,pr=229,hr=230,fr=231,dr=232,mr=233,vr=234,gr=235,yr=236,br=237,kr=238,Er=239,Or=240,Sr=241,Pr=242,wr=243,jr=244,Tr=245,xr=246,Cr=247,Nr=248,Rr=249,Dr=250,qr=251,Mr=252,Ar=253,Ir=254,Lr=255,Fr=256,Br=257,Hr=258,Vr=259,Ur=260,Jr=261,_r=262,Gr=263,zr=264,Wr=265,Kr=266,Qr=267,Xr=268,Yr=269,Zr=270,$r=271,ea=272,ta=273,na=274,ra=275,aa=276,ia=277,sa=278,oa=279,ca=280,ua=281,la=282,pa=283,ha=284,fa=285,da=286,ma=287,va=288,ga=289,ya=290,ba=291,ka=292,Ea=293,Oa=294,Sa=295,Pa=296,wa=297,ja=298,Ta=299,xa=300,Ca=301,Na=302,Ra=303,Da=304,qa=305},20:function(e,t,n){"use strict";(function(e){n.d(t,"i",function(){return p}),n.d(t,"h",function(){return h}),n.d(t,"f",function(){return f}),n.d(t,"g",function(){return d}),n.d(t,"n",function(){return m}),n.d(t,"b",function(){return v}),n.d(t,"e",function(){return g}),n.d(t,"d",function(){return y}),n.d(t,"l",function(){return b}),n.d(t,"j",function(){return k}),n.d(t,"k",function(){return E}),n.d(t,"a",function(){return O}),n.d(t,"m",function(){return S}),n.d(t,"c",function(){return P});var r=n(4),a=n(5),i=(n(90),n(144)),s=n(27),o=n(114),c=(window.web3,s.a.utils.padLeft("0x0",64)),u=function(){function e(t,n){Object(r.a)(this,e),this.toConversion=t,this.fromConversion=n}return Object(a.a)(e,[{key:"convertTo",value:function(e){return this.toConversion(e)}},{key:"convertFrom",value:function(e){return e===c?null:this.fromConversion(e)}}]),e}();function l(e){var t="";for(var n in e)0!=e.charCodeAt(n)&&(t+=e.charAt(n));return t}var p=new u(function(e){return function(e){var t=o.decode(e).toString("hex").replace(/^1220/,"");return 64!=t.length?null:"0x"+t}(e)},function(t){return function(t){var n=new e(t.replace(/^0x/,"1220"),"hex");return o.encode(n)}(t)}),h=new u(function(e){return s.a.utils.padLeft(s.a.utils.numberToHex(e),64)},function(e){return s.a.utils.hexToNumber(e)}),f=new u(function(e){return s.a.utils.padLeft(s.a.utils.numberToHex(e),64)},function(e){return l(s.a.utils.toAscii(e))}),d=new u(function(e){return s.a.utils.padLeft(s.a.utils.numberToHex(e),64)},function(e){return s.a.utils.hexToNumber(e)}),m=new u(function(e){return s.a.utils.padLeft(s.a.utils.numberToHex(parseInt(e)),64)},function(e){return s.a.utils.hexToNumber(e)}),v=new u(function(e){return s.a.utils.padRight(s.a.utils.fromAscii(e),64)},function(e){return l(s.a.utils.toAscii(e))}),g=new u(function(e){return s.a.utils.padLeft(s.a.utils.fromAscii(e),64)},function(e){return l(s.a.utils.toAscii(e))}),y=new u(function(e){return s.a.utils.padLeft(s.a.utils.toHex(e),64)},function(e){return function(e){for(var t=0;t<e.length;t++)if("0"!==e.slice(t,t+1))return e.slice(t);return e}(e.slice(2))});var b=new u(function(e){return s.a.utils.padRight(s.a.utils.toHex(e),64)},function(e){return l(s.a.utils.toAscii(e))}),k=new u(function(e){return s.a.utils.padRight(e,64)},function(e){return l(s.a.utils.toAscii(e)).split("").map(function(e){return i.a[e]})}),E=new u(function(e){return s.a.utils.padRight(e,64)},function(e){return i.a[l(s.a.utils.toAscii(e))]}),O=new u(function(e){return s.a.utils.padLeft(e,64)},function(e){return function(e){return"0x"+e.slice(e.length-40)}(e)}),S=new u(function(e){return s.a.utils.padLeft(e[0],64)},function(e){return l(s.a.utils.toAscii(e))}),P=function(e){return new u(function(e){return e},function(t){return t.slice(2,2+64*e)})}}).call(this,n(14).Buffer)},2065:function(e,t){},2124:function(e,t){},2127:function(e,t){},2129:function(e,t){},2164:function(e,t){},2182:function(e,t){},2218:function(e,t,n){"use strict";(function(e){n(4),n(9),n(10),n(1),n(950);n(79),n(825),n(477),n(846),n(849),n(2219),n(2240),n(859),n(860),n(861),n(2285),n(866)}).call(this,n(14).Buffer)},2245:function(e,t){},2247:function(e,t){},2288:function(e,t,n){},2305:function(e,t,n){},2306:function(e,t,n){},2307:function(e,t,n){},2308:function(e,t,n){},2309:function(e,t,n){},2310:function(e,t,n){},2311:function(e,t,n){},2312:function(e,t,n){},2313:function(e,t,n){},2314:function(e,t,n){},2315:function(e,t,n){},2317:function(e,t){var n,r,a=0,i=[];function s(){for(var e=0;e<r;e++)i[e]=[]}function o(e,t){for(var n=new Float32Array(t),r=0,a=0;a<e.length;a++)n.set(e[a],r),r+=e[a].length;return n}function c(e,t,n){for(var r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))}this.onmessage=function(e){switch(e.data.command){case"init":t=e.data.config,n=t.sampleRate,r=t.numChannels,s();break;case"record":!function(e){for(var t=0;t<r;t++)i[t].push(e[t]);a+=e[0].length}(e.data.buffer);break;case"exportWAV":!function(e){for(var t=[],s=0;s<r;s++)t.push(o(i[s],a));if(2===r)var u=function(e,t){var n=e.length+t.length,r=new Float32Array(n),a=0,i=0;for(;a<n;)r[a++]=e[i],r[a++]=t[i],i++;return r}(t[0],t[1]);else var u=t[0];var l=function(e){var t=new ArrayBuffer(44+2*e.length),a=new DataView(t);return c(a,0,"RIFF"),a.setUint32(4,36+2*e.length,!0),c(a,8,"WAVE"),c(a,12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,r,!0),a.setUint32(24,n,!0),a.setUint32(28,4*n,!0),a.setUint16(32,2*r,!0),a.setUint16(34,16,!0),c(a,36,"data"),a.setUint32(40,2*e.length,!0),function(e,t,n){for(var r=0;r<n.length;r++,t+=2){var a=Math.max(-1,Math.min(1,n[r]));e.setInt16(t,a<0?32768*a:32767*a,!0)}}(a,44,e),a}(u),p=new Blob([l],{type:e});this.postMessage(p)}(e.data.type);break;case"getBuffer":!function(){for(var e=[],t=0;t<r;t++)e.push(o(i[t],a));this.postMessage(e)}();break;case"clear":a=0,i=[],s()}var t}},2319:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(108),s=n.n(i),o=(n(966),n(4)),c=n(5),u=n(9),l=n(10),p=n(1),h=n(88),f=n.n(h),d=n(26),m=n(96),v=n.n(m),g=n(16),y=function(e){var t=e.name,n=e.children,r=e.wide,i=void 0!==r&&r;return a.a.createElement("div",{className:i?"dashboard-module wide":"dashboard-module"},a.a.createElement("div",{className:"module-name"},t),a.a.createElement("div",{className:"inner-module"},n))},b="RESOLUTION_DROPDOWN",k={STEP:"Click to toggle the step on/off. CMD+click or Alt+click to edit this step's parameters. Drag the right edge to change it's duration. Type shift to view/hide the parameters.",TRACK:"An audio track. Click to select the track. And press a key to map the key to the selected track.",TRACK_THUMBNAIL:"Click to go to this track's details page.",TRACK_EFFECTS_BUTTON:"Click to show the effects for this track.",TRACK_PIANO_ROLL_BUTTON:"Click to show a piano roll for this track, for finer control over melody.",TRACK_ADD_STEPS_BUTTON:"Click to double the length of steps in this track.",TRACK_REMOVE_STEPS_BUTTON:"Click to half the length of steps in this track.",TRACK_MUTE_BUTTON:"Click to mute/unmute the track.",TRACK_SOLO_BUTTON:"Click to solo/un-solo the track. When soloed, you will only hear this track's output",TRACK_RECORD_ARM_BUTTON:"Click to arm this track. When armed (i.e. red), you can play this track like a keyboard, using your computer keyboard, or a midi controller.",TRACK_MIDI_DROPDOWN:"Specify what inputs can control this track when the record arm button is enabled. By default, the computer keyboard and MIDI controllers are enabled.",ADD_EFFECTS_BUTTON:"Click to add effects to this track.",TRACK_SEND_A_SLIDER:'Controls the level of output from this track that goes to "Send A". "Send A" by default is a reverb.',TRACK_SEND_B_SLIDER:'Controls the level of output from this track that goes to "Send B". "Send B" by default is a delay.',TRACK_LOCK_BUTTON:"Click to lock/unlock this track's parameters to this pattern. A track can be locked with respect to specific pattern. Any parameter changes made to a locked track are specific to that pattern.",LFOS_BUTTON:"Click to edit the project-wide LFOs",ENVELOPES_BUTTON:"Click to edit the project-wide envelopes",LFO_TOGGLE_BUTTON:"Click to control this parameter with one of the project-wide LFOs",ENVELOPE_TOGGLE_BUTTON:"Click to control this parameter with one of the project-wide envelopes",EFFECT_PARAMETER:"Click the parameter name to display the LFOs/Envelopes that can control this parameter.",EFFECT_TOGGLE_BUTTON:"Click the toggle the effect on/off.",EFFECT_COLLAPSE_BUTTON:"Click to collapse/uncollapse the effect.",EFFECT_DELETE_BUTTON:"Click to delete this effect from the effects chain.",ADD_SOUND_BUTTON:"Click to add sound to track.",PARAMETER_MODS_BUTTON:"Click to fine-tune the LFO/Envelope modulations (if any) for this effect.",CURRENT_PATTERN_BUTTON:"The current pattern of this project.",PATTERN_BUTTON:"Click to switch to another pattern",NEW_PATTERN_BUTTON:"Click to create a new pattern, copied from the current pattern.",DELETE_PATTERN_BUTTON:"Click to delete the current pattern.",RESOLUTION_DROPDOWN:"Specify the step resolution of the step sequencer. For example, you can view the steps in triplets.",PLAY_BUTTON:"Click to play the project in pattern mode.",RECORD_BUTTON:"Click to enable recording. When recording, any tracks triggered via computer-keyboard/midi controller will be recorded into the sequence",ROLL_BUTTON:'Click to enable "roll". When enabled, you can trigger tracks in time with the selected resolution of the project.',QUANTIZE_BUTTON:"When quantized, any triggers you record will be snapped to the grid, as defined by the selected resolution of the project. When unquantized, it does not snap to the grid.",AND_TAG_BUTTON:"Sounds must contain this tag, along with any other red colored tags. Click to unselect this tag.",OR_TAG_BUTTON:"Sounds may contain this tag. Click to unselect this tag.",SELECTOR_TAG_BUTTON:"Click to filter by this tag.",SELECTOR_CATEGORY_BUTTON:"Click to filter by this category of tags.",TRACK_PARAMETERS:"All steps on this track are by default set to these parameters. Changing the parameter for a specific step overrides that default for that step.",TRACK_WAVEFORM:'Drag the markers to set the start/end of the slice. You can also select a new region and click "Add Slice" to create additional slices from this sample.',SELECTOR_WAVEFORM:"Click to hear the sample. Drag to make a selection",DETAIL_VIEW_HAS_SELECTED_SLICE:"Press a key to map the selected slice to a key. You can also click on the graphical keyboard on this page to map this.",GRAPHICAL_KEYBOARD:"Shows what keys are mapped to what sounds and slices. Click on a mapped key to unmap it. Click on an unmapped key to map it to the selected slice for this track",ENVELOPE_TRACK_DROPDOWN:"Specify which track will trigger this envelope.",LFO_MIN_SLIDER:"Controls the minimum value that LFO oscillators from at the given rate",LFO_MAX_SLIDER:"Controls the maximum value that LFO oscillators to at the given rate",PARAMETERIZER_FACTOR:"Multiplies the chosen parameter`s value by this factor, everytime the track triggers",PARAMETERIZER_OFFSET:"Sums the chosen parameter`s value with this offset, everytime the track triggers.",PROBABILITY:"Controls the probability rate which this MIDI effect will apply. I.E. 100% means it always applies ",PARAMETERIZER_DROPDOWN:"Specifiy the parameter which this effect will apply to.",RESAMPLE:"Resamples this track's pattern (including effects), creating a new track with the recorded sample",TRANSCRIBE:"Transcribes the midi notes for this sample, creating a new External Instrument track with the transcribed midi notes (takes a few seconds to run).",PLAY_MIX_BUTTON:"Plays a recorded mix (if there is one)",RECORD_MIX_BUTTON:"Record a mix, so that all pattern switches, parameter changes are recorded and can be played back.",AUTOMATION_BUTTON:"When clicked, and the RECORD button at the bottom is turned on, any automation changes made within a pattern are recorded to that pattern. To delete the automations, hold down the / key",AUDITION_BUTTON:"Audition this sample, replacing the current sample in the selected track with it.",CONVOLVER_BUTTON:"Replace a convolver reverb's impulse sample with this sample",LAYER_BUTTON:"Add this sample to the selected track, so that multiple samples can be triggered by one track.",ADD_SYNTH_BUTTON:"Click to add a simple synth to the project",ADD_MULTI_SYNTH_BUTTON:"Click to add a multi-oscillator synth to the project",ADD_FM_SYNTH_BUTTON:"Click to add an FM synth to the project",ADD_EXTERNAL_INSTRUMENT_BUTTON:"Click to add an external instrument to the project. This can control midi devices connected to your computer, including hardware synths",ADD_PRESET_BUTTON:"Click to add this preset to your project",LFO_COMPONENT:"An LFO oscillates between minimum and maximum values, at a constant rate. You can connect parameters to an LFO to modulate its value",ENVELOPE_COMPONENT:"An envelope is triggered any time its connected track has triggered. When triggered, it can control parameter values according to the ASDR (attack, sustain, decay, release) of the envelope.",ADD_ALL_SOUNDS_BUTTON:"Click to select sounds, instruments, presets, and/or sequences to load into the project.",ADD_SOUNDS_BUTTON:"Click to search for and load sounds into your project.",ADD_INSTRUMENTS_BUTTON:"Click to add instruments (e.g. synths) into your project.",ADD_PRESETS_BUTTON:"Click to add saved presets into your project.",ADD_SEQUENCES_BUTTON:"Click to search for and load saved projects.",VIEW_DROPDOWN:"Go to other views, like the mix view",BPM_SLIDER:"Set the BPM (i.e. the tempo) of the project",SWING_SLIDER:"Set the swing of the project.",BPM_LOCK:"Lock/unlock the pattern BPM. This allows different patterns to have different BPMs",PUBLIC_SAVE:"Saves the sequence publicly-- without encryption-- so anyone can see",PRIVATE_SAVE:"Saves the sequence encrypted, so that only you can see (with a password)",PARAMETER_VALUE:"Click to edit the parameter value",PRESET_FOLDERS:"Choose ready-to-go presets to add to your track (by double-clicking the item).",GUILDS_SELECTOR:"Chooses the selected Guild. When selected, only show samples, presets, sequences from that Guild.",ROLL_BUTTONS:"Click and hold to beat-repeat a fraction of the beat.",MUTE_BUTTON:"Click to mute/unmute the volume.",ACTIONS_REMAINING:"The number of actions you still can take before submitting.",TIME_REMAINING:"You must wait this much time before you can make edits again.",SUBMIT_ACTIONS_BUTTON:"Click to submit your edits for everyone to see.",UNDO_BUTTON:"Click to undo your last edit.",REDO_BUTTON:"Click to redo the last edit you undid.",ROOM_NAME:"The name of the musical canvas you are viewing.",NUMBER_OF_PEOPLE:"The number of people currently viewing and editing this musical canvas.",LEAVE_ROOM_BUTTON:"Click to leave this musical canvas.",BROWSE_HISTORY_BUTTON:"Click to view musical snapshots from the past.",HISTORY_SLIDER:"Move the slider to view different points within the history of the canvas.",HISTORY_TIMESTAMP:"The snapshot of history that you are currently viewing.",BACK_TO_LIVE_BUTTON:"Click to return to the living version of this canvas.",INSTALLATION_KNOBS:"Turn the knobs to alter the music.",TRACK_TAB_BUTTON:"Click to view piano roll for this track.",PIANO_ROLL_STEP:"Double click to delete note, drag the right-edge to edit the note length, and drag the whole note to move its position.",STEP_DISABLED:"This step is currently disabled for this musical canvas."},E=Object(g.b)(function(e,t){return{actionsRemaining:e.installation.actionsRemaining,timeRemaining:e.installation.timeRemaining,browseHistory:e.installation.browseHistory,undoLength:e.installation.undoLength,redoLength:e.installation.redoLength}},null)(function(e){var t=e.actionsRemaining<0?"submit-button disabled":"submit-button";if(e.timeRemaining>0)return a.a.createElement("div",{className:"actions"},a.a.createElement("div",{onMouseOver:function(){return e.setContextualHelp("TIME_REMAINING")},onMouseLeave:function(){return e.setContextualHelp(void 0)},className:"time-remaining"},e.timeRemaining/1e3),a.a.createElement("div",{className:"actions-text"},"seconds left"));var n="undo-button",r="redo-button";return 0===e.undoLength&&(n+=" disabled"),0===e.redoLength&&(r+=" disabled"),a.a.createElement("div",null,e.browseHistory?a.a.createElement("div",null,a.a.createElement("div",{className:"actions-browsing-history-text"},"Browsing history..."),a.a.createElement("div",{className:"actions-browsing-history-text"},"Actions are cleared when history is changed.")):a.a.createElement("div",{className:"actions"},a.a.createElement("div",{className:"undo-redo-buttons"},a.a.createElement("div",{onMouseOver:function(){return e.setContextualHelp("UNDO_BUTTON")},onMouseLeave:function(){return e.setContextualHelp(void 0)},onClick:function(){e.sequencerEngine.operationManager.undo()},className:n},"Undo"),a.a.createElement("div",{onMouseOver:function(){return e.setContextualHelp("REDO_BUTTON")},onMouseLeave:function(){return e.setContextualHelp(void 0)},onClick:function(){e.sequencerEngine.operationManager.redo()},className:r},"Redo")),a.a.createElement("div",{className:"module-name"},"Actions"),a.a.createElement("div",{onMouseOver:function(){return e.setContextualHelp("ACTIONS_REMAINING")},onMouseLeave:function(){return e.setContextualHelp(void 0)},className:"actions-remaining"},e.actionsRemaining),a.a.createElement("div",{className:"actions-text"},"remaining"),a.a.createElement("div",{onMouseOver:function(){return e.setContextualHelp("SUBMIT_ACTIONS_BUTTON")},onMouseLeave:function(){return e.setContextualHelp(void 0)},onClick:function(){e.sequencerEngine.operationManager.roomActionsManager.submitActions()},className:t},"Submit")))}),O=n(8);function S(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var P=function(e){Object(u.a)(n,e);var t=S(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"onPlayMixClicked",value:function(e){this.props.setIsPlayingMix(!this.props.isPlaying),this.props.sequencerEngine.schedulePlay(),document.activeElement.blur()}},{key:"onClickRecordMixButton",value:function(){if(window.installation){var e=!this.props.isRecordingMix;this.props.sequencerEngine.recording(e)}else this.props.setIsRecordingMix(!this.props.isRecordingMix)}},{key:"onClickStop",value:function(){this.props.sequencerEngine.stop(),this.props.setArrangementMouseX(void 0)}},{key:"getPianoIcon",value:function(){return"/piano-icon.png"}},{key:"getPianoClass",value:function(){return this.props.showPianoRoll?"piano-roll-button show":"piano-roll-button"}},{key:"onClickPianoRoll",value:function(){this.props.setShowPianoRoll(!this.props.showPianoRoll)}},{key:"render",value:function(){var e=this,t="playpause ";return this.props.playScheduled&&(t+=" flashit"),a.a.createElement("div",{className:"mix-buttons"},a.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("PLAY_MIX_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:t},a.a.createElement("input",{onChange:function(t){return e.onPlayMixClicked(t)},checked:!this.props.isPlayingMix&&!this.props.isPlaying,type:"checkbox",value:!this.props.isPlayingMix&&!this.props.isPlaying,id:"playpause",name:"check"}),a.a.createElement("label",{className:this.props.isPlayingMix?"mix":"",htmlFor:"playpause",tabIndex:1})),a.a.createElement("div",{onClick:function(){return e.onClickStop()},className:"stop-button"}),a.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("RECORD_MIX_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onClickRecordMixButton()},className:this.props.isRecordingMix?"recording-dot":"not-recording-dot"}),a.a.createElement("img",{onClick:function(){return e.onClickPianoRoll()},className:this.getPianoClass(),src:this.getPianoIcon()}),a.a.createElement("img",{onMouseOver:function(){return e.props.setContextualHelp("AUTOMATION_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onClickLooping()},className:"loop-icon",src:this.getLoopIcon()}))}},{key:"getLoopIcon",value:function(){return this.props.looping?"/arrow-loop-looping.png":"/arrow-loop.png"}},{key:"onClickLooping",value:function(){this.props.sequencerEngine.restartAllMixes(!this.props.looping),this.props.setLooping(!this.props.looping)}},{key:"getLoopClass",value:function(){return this.props.looping?"loop-icon looping":"loop-icon"}},{key:"onClickAutomationMode",value:function(){"PLAY"===this.props.automationMode?this.props.setProjectAutomationMode("RECORD"):"RECORD"===this.props.automationMode&&this.props.setProjectAutomationMode("PLAY")}},{key:"getAutomationIcon",value:function(){return"RECORD"===this.props.automationMode?"/automation-icon-enabled.png":"/automation-icon-disabled.png"}}]),n}(r.Component),w=Object(g.b)(function(e,t){var n=t.sequencerEngine.getSequenceId(),r=e.sequencer.isPlaying[n]||0;return{isRecordingMix:window.installation?e.sequencer.isRecording:e.mix.isRecordingMix,isPlayingMix:e.mix.isPlayingMix,isPlaying:r,showPianoRoll:e.sequencer.showPianoRoll,automationMode:e.sequencer.automationMode,playScheduled:e.clock.playScheduled,looping:e.arrangement.looping}},function(e){return{setShowPianoRoll:function(t){return e(Object(O.cd)(t))},setIsPlayingMix:function(t){return e(Object(O.Db)(t))},setIsRecordingMix:function(t){return e(Object(O.Fb)(t))},setProjectAutomationMode:function(t){return e(Object(O.nc)(t))},setContextualHelp:function(t){return e(Object(O.U)(t))},setLooping:function(t){return e(Object(O.z)(t))},setArrangementMouseX:function(t){return e(Object(O.A)(t))}}})(P),j=n(25),T=n(13),x=n.n(T),C=n(3),N=n.n(C),R=n(12),D=n(11),q=n(17),M=n(15),A=n(69),I=function(){function e(t,n){Object(o.a)(this,e),this.step=t,this.value=n,this.id=Object(A.uuid)()}return Object(c.a)(e,[{key:"fromJson",value:function(e){return this.step=e.step,this.value="string"===typeof e.value?new x.a.Time(e.value):e.value,this.id=e.id,this}},{key:"getCopy",value:function(){var t=(new e).fromJson(this.getJson());return t.id=this.id,t}},{key:"getJson",value:function(){return{step:this.step,value:this.value.toNotation?this.value.toNotation():this.value,id:this.id}}}]),e}(),L=n(187),F="a-rate",B=n(61);var H=function(){function e(t){Object(o.a)(this,e),this.id=Object(A.uuid)(),this.parameter=t,this.automations=[],this.nextCache={},this.previousCache={},this.getValueCache={},this.distanceCache={}}return Object(c.a)(e,[{key:"getPoint",value:function(e){return this.automations.find(function(t){return t.id===e.id})}},{key:"getSelectedPoints",value:function(e,t,n,r){return this.automations.filter(function(a){var i=a.step,s=a.value;return e<=i&&t<=s&&n>=i&&r>=s})}},{key:"getClosestBefore",value:function(e){var t=void 0;for(var n in this.automations){var r=this.automations[n];if(r.step>e)return t;t=r}return t}},{key:"getDistanceToClosest",value:function(e){var t=void 0;if(e.step in this.distanceCache)return this.distanceCache[e.step];var n=void 0;for(var r in this.automations){var a=this.automations[r],i=Math.abs(a.step-e.step);(void 0===t||i<t)&&(t=i,n=a)}return this.distanceCache[e.step]={distance:t,point:n},this.distanceCache[e.step]}},{key:"quantizePoint",value:function(e){if(void 0!==(e=this.getPoint(e))){var t;for(var n in e.step=(t=e.step,Math.round(2*t)/2),e.value=function(e,t){if(e.quantize)return e.quantize(t);var n=e.min,r=e.max,a=(r-n)/80,i=e.config.defaultValue;if(Math.abs(i-t)<a/8)return i;if(r<20)return Math.round(10*t)/10;var s=t%a;return s>a/2?t+a-s:t-s}(this.parameter,e.value),this.automations)this.automations[n]===e&&(this.automations[n]=e.getCopy());this.automations=Object(M.a)(this.automations),this.updateRedux()}}},{key:"movePoints",value:function(e,t,n){for(var r in e){var a=e[r],i=a.step,s=a.value;i+=t,s+=n,this.movePoint(a,i,s,!1)}this.schedule(),this.updateRedux(),this.clearCache()}},{key:"movePoint",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(void 0!==e){e=this.getPoint(e);var a=this.getNextEvent(e),i=this.getPreviousEvent(e);for(var s in(void 0===a||t<a.step)&&(void 0===i||t>i.step)?(e.step=t,e.value=Math.min(Math.max(n,this.parameter.min),this.parameter.max)):e.value=Math.min(Math.max(n,this.parameter.min),this.parameter.max),this.automations)if(this.automations[s]===e){this.automations[s]=e.getCopy();break}r&&(this.schedule(),this.updateRedux(),this.clearCache())}}},{key:"updateRedux",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.store&&(e||this.automations.length>0)&&this.store.dispatch(Object(O.Yb)(this.parameter,Object(M.a)(this.automations),this))}},{key:"getNextEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.automations;if(e.id in this.nextCache)return this.nextCache[e.id];for(var n=0;n<t.length;n++)if(e.id===t[n].id)return this.nextCache[e.id]=t[n+1],t[n+1];return this.nextCache[e.id]=t[0],t[0]}},{key:"getPreviousEvent",value:function(e){var t=void 0;if(e.id in this.previousCache)return this.previousCache[e.id];for(var n=0;n<this.automations.length-1;n++){if(this.automations[n]===e)return t;t=this.automations[n]}this.previousCache[e.id]=void 0}},{key:"getValueAtStep",value:function(e){this.parameter.track&&(e%=(this.parameter.track.instrumentRack?this.parameter.track.instrumentRack:this.parameter.track).length);return e in this.getValueCache?this.getValueCache[e]:(this.getValueCache[e]=function(e,t,n){var r,a=n[0],i=t.get(!0);if(t.getNumberFromOption&&(i=t.getNumberFromOption(i)),"string"===typeof i&&(i=new x.a.Time(i).toFrequency()),0===n.length)return i;for(var s in n){var o=n[s=parseInt(s)];if(r=o,o.step<=e&&n[s+1]&&e<n[s+1].step){var c=n[s+1],u=(c.step,o.step,e-o.step),l=(c.value-o.value)/(c.step-o.step),p=o.value+u*l;return p=t.toFrequency?new x.a.Time(p):p}}return r&&e>=r.step?r.value:a?a.value:i}(e,this.parameter,this.automations),this.getValueCache[e])}},{key:"removeBreakPoints",value:function(e){var t=this;e.forEach(function(e){return t.removeBreakPoint(e,!1)}),this.updateRedux(!0)}},{key:"removeBreakPoint",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0!==e){e=this.getPoint(e);var n=this.automations.indexOf(e);n>-1&&this.automations.splice(n,1),this.clearCache(),t&&this.updateRedux(!0)}}},{key:"clearCache",value:function(){this.cache={},this.getValueCache={},this.nextCache={},this.distanceCache={},this.previousCache={}}},{key:"addBreakPoint",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(A.uuid)();this.clearCache(),this.parameter.audioParam&&this.parameter.automationRate!==F&&(this.parameter.automationRate=F);var r=new I(e,t);return r.id=n,this.automations.push(r),this.automations.sort(function(e,t){return e.step-t.step}),this.schedule(),this.updateRedux(),r}},{key:"clear",value:function(){this.eventIds&&this.eventIds.forEach(function(e){return x.a.Transport.clear(e)})}},{key:"schedule",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.lastStartTime,n=arguments.length>1?arguments[1]:void 0;if(this.clear(),void 0!==t&&(this.lastStartTime=t,void 0!==this.parameter.audioParams||void 0!==this.parameter.audioParam)){var r=this.automations;if(r.length>0){var a=r[0].getCopy();a.step=0,a.id=Object(A.uuid)(),r=[a].concat(Object(M.a)(r))}this.eventIds=r.map(function(t){return x.a.Transport.schedule(function(n){if(e.parameter.audioParam||e.parameter.audioParams){x.a.Master.context.currentTime;var a=e.getNextEvent(t,r);if(!a)return;var i=a.value;if(i.toFrequency&&(i=i.toFrequency()),a){var s=new x.a.Time("32n")*(a.step-t.step)-.001;e.parameter.audioParams?e.parameter.audioParams.forEach(function(e){return e.rampTo(i,s,n+.001)}):e.parameter.audioParam&&(e.parameter.audioParam.rampTo?e.parameter.audioParam.rampTo(i,s,n+.001):e.parameter.audioParam.linearRampToValueAtTime(i||1e-5,x.a.Master.context.currentTime+s-.001))}}},function(e,t,n){var r=x.a.Transport.getTicksAtTime(n),a=new x.a.Time("32n");return new x.a.TransportTime(r+e*a.toTicks(),"i")}(t.step,0,n))})}}},{key:"getJson",value:function(){return{id:this.id,automations:this.automations.map(function(e){return e.getJson()})}}},{key:"fromJson",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.id,a=e.automations;if(n||(this.id=r),void 0===a||0===a.length)return this;for(var i in a){var s=a[i],o=(s.step,s.value,s.id),c=(new I).fromJson(a[i]);void 0!==o&&(c.id=o),this.automations.push(c)}return t&&this.schedule(),this.updateRedux(),this}},{key:"getCopy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.store,n=new e(this.parameter);return n.fromJson(this.getJson(),!1,!0),n.store=t,n}},{key:"dispose",value:function(){this.clear(),this.automations=void 0,this.eventIds=void 0}}]),e}(),V=0,U=function(){function e(){Object(o.a)(this,e),this.canceled=!1,this.id=V++}return Object(c.a)(e,[{key:"setValue",value:function(e){}},{key:"cancel",value:function(){this.canceled=!0}},{key:"isDeterministic",value:function(){return!1}},{key:"isSkippable",value:function(){return!0}},{key:"isPrunable",value:function(){return!1}},{key:"setTime",value:function(e,t){this.step=t,this.time=e}},{key:"scheduleEvent",value:function(e,t,n){var r=this;e+=this.time,setTimeout(function(){if(!r.canceled)try{r.executeEvent(t,n)}catch(e){console.log("got an error executing event = "),console.log(r),console.log(e)}},e-0)}},{key:"getValue",value:function(){}},{key:"executeEvent",value:function(e){}},{key:"getType",value:function(){}},{key:"getJson",value:function(){return{type:this.getType(),time:this.time,step:this.step}}},{key:"fromJson",value:function(e){return this.time=e.time,this.step=e.step,this}},{key:"isEquivalent",value:function(){return!1}},{key:"restart",value:function(){}},{key:"getCopy",value:function(){}},{key:"loadSubSequence",value:function(e,t){void 0!==e.subSequence?this.subSequence=t.getSubSequence(e.subSequence):this.subSequence=t.currentSubSequence}},{key:"value",get:function(){return this.getValue()},set:function(e){this.setValue(e)}}]),e}();function J(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var _=function(e){Object(u.a)(n,e);var t=J(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this)).patternNumber=e,r}return Object(c.a)(n,[{key:"getValue",value:function(){return this.patternNumber}},{key:"isSkippable",value:function(){return!1}},{key:"isDeterministic",value:function(){return!0}},{key:"executeEvent",value:function(e){e.switchToPatternHelper(this.patternNumber)}},{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{patternNumber:this.patternNumber})}},{key:"getCopy",value:function(e){var t=new n;return t.fromJson(this.getJson(),e),t}},{key:"getType",value:function(){return de}},{key:"fromJson",value:function(e,t){return Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e),this.loadSubSequence(e,t),this.patternNumber=e.patternNumber,this}}]),n}(U);function G(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var z=function(e){Object(u.a)(n,e);var t=G(n);function n(e,r){var a;return Object(o.a)(this,n),(a=t.call(this)).subSequence=e,a.volume=r,a}return Object(c.a)(n,[{key:"setValue",value:function(e){this.volume=e}},{key:"getValue",value:function(){return this.volume}},{key:"isSkippable",value:function(){return!1}},{key:"executeEvent",value:function(e,t){if(void 0!==t&&void 0!==this.subSequence&&void 0!==this.subSequence.linearRampFade){var n=(t.step-this.step)*new x.a.Time("32n").toMilliseconds()/1e3;this.subSequence.linearRampFade(Math.max(0,this.value),Math.max(0,t.volume),n)}}},{key:"getType",value:function(){return we}},{key:"getCopy",value:function(e){return(new n).fromJson(this.getJson(),e)}},{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{subSequence:this.subSequence.id,volume:this.volume})}},{key:"fromJson",value:function(e,t){return Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e),this.subSequence=t.getSubSequence(e.subSequence),this.volume=e.volume,this}}]),n}(U),W=n(19);function K(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Q=function(e){Object(u.a)(n,e);var t=K(n);function n(e,r){var a;return Object(o.a)(this,n),(a=t.call(this)).track=e,a.volume=r,a}return Object(c.a)(n,[{key:"getCopy",value:function(){return(new n).fromJson(this.getJson())}},{key:"getValue",value:function(){return this.volume}},{key:"executeEvent",value:function(e){this.subSequence.tracks[this.track.trackNumber]&&this.subSequence.tracks[this.track.trackNumber].setVolume(this.volume,!0)}},{key:"getType",value:function(){return me}},{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{trackNumber:this.track.trackNumber,volume:this.volume})}},{key:"fromJson",value:function(e,t){return Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e),void 0!==e.subSequence?this.track=t.getSubSequence(e.subSequence).tracks[e.trackNumber]:this.track=t.tracks[e.trackNumber],this.volume=e.volume,this}}]),n}(U);function X(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Y=function(e){Object(u.a)(n,e);var t=X(n);function n(e,r){var a;return Object(o.a)(this,n),(a=t.call(this)).groupNumber=e,a.volume=r,a}return Object(c.a)(n,[{key:"executeEvent",value:function(e){this.subSequence.groups.groups[this.groupNumber]&&this.subSequence.groups.groups[this.groupNumber].setVolume(this.volume)}},{key:"getType",value:function(){return ve}},{key:"getCopy",value:function(){return(new n).fromJson(this.getJson())}},{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{groupNumber:this.groupNumber,volume:this.volume})}},{key:"fromJson",value:function(e){return Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e),this.groupNumber=e.groupNumber,this.volume=e.volume,this}}]),n}(U);function Z(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var $=function(e){Object(u.a)(n,e);var t=Z(n);function n(e,r){var a;return Object(o.a)(this,n),(a=t.call(this)).track=e,a.mute=r,a}return Object(c.a)(n,[{key:"getValue",value:function(){return this.mute?0:1}},{key:"isSkippable",value:function(){return!1}},{key:"executeEvent",value:function(e){this.subSequence.tracks[this.track.trackNumber].mute(this.mute,!0)}},{key:"getType",value:function(){return ge}},{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{trackNumber:this.track.trackNumber,mute:this.mute})}},{key:"fromJson",value:function(e,t){return Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e),this.track=t.tracks[e.trackNumber],this.mute=e.mute,this}}]),n}(U);function ee(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var te=function(e){Object(u.a)(n,e);var t=ee(n);function n(e,r){var a;return Object(o.a)(this,n),(a=t.call(this)).groupNumber=e,a.mute=r,a}return Object(c.a)(n,[{key:"getValue",value:function(){return this.mute?0:1}},{key:"isSkippable",value:function(){return!1}},{key:"executeEvent",value:function(e){this.subSequence.groups.groups[this.groupNumber].mute(this.mute)}},{key:"getType",value:function(){return ye}},{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{groupNumber:this.groupNumber,mute:this.mute})}},{key:"fromJson",value:function(e){return Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e),this.groupNumber=e.groupNumber,this.mute=e.mute,this}}]),n}(U);function ne(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var re=function(e){Object(u.a)(n,e);var t=ne(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this)).track=e,i.sendNumber=r,i.volume=a,i}return Object(c.a)(n,[{key:"executeEvent",value:function(e){this.subSequence.tracks[this.track.trackNumber].setSendVolume(this.sendNumber,this.volume,!0)}},{key:"getType",value:function(){return ke}},{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{trackNumber:this.track.trackNumber,sendNumber:this.sendNumber,volume:this.volume})}},{key:"fromJson",value:function(e,t){return Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e),this.track=t.tracks[e.trackNumber],this.sendNumber=e.sendNumber,this.volume=e.volume,this}}]),n}(U);function ae(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ie=function(e){Object(u.a)(n,e);var t=ae(n);function n(e,r){var a;return Object(o.a)(this,n),(a=t.call(this)).track=e,a.solo=r,a}return Object(c.a)(n,[{key:"isSkippable",value:function(){return!1}},{key:"executeEvent",value:function(e){this.subSequence.tracks[this.track.trackNumber].solo(this.solo,!0)}},{key:"getType",value:function(){return Ee}},{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{trackNumber:this.track.trackNumber,solo:this.solo})}},{key:"fromJson",value:function(e,t){return Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e),this.track=t.tracks[e.trackNumber],this.solo=e.solo,this}}]),n}(U);function se(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var oe=function(e){Object(u.a)(n,e);var t=se(n);function n(e,r){var a;return Object(o.a)(this,n),(a=t.call(this)).track=e,a.reverse=r,a}return Object(c.a)(n,[{key:"isSkippable",value:function(){return!1}},{key:"executeEvent",value:function(e){this.subSequence.tracks[this.track.trackNumber].reverse(this.reverse,!0)}},{key:"getType",value:function(){return Oe}},{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{trackNumber:this.track.trackNumber,reverse:this.reverse})}},{key:"fromJson",value:function(e,t){return Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e),this.track=t.tracks[e.trackNumber],this.reverse=e.reverse,this}}]),n}(U);function ce(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ue=function(e){Object(u.a)(n,e);var t=ce(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this)).resolution=e,r}return Object(c.a)(n,[{key:"getValue",value:function(){return this.resolution}},{key:"isDeterministic",value:function(){return!0}},{key:"isSkippable",value:function(){return!0}},{key:"executeEvent",value:function(e){}},{key:"getType",value:function(){return Pe}},{key:"getCopy",value:function(){var e=new n;return e.fromJson(this.getJson()),e}},{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{resolution:this.resolution.getJson()})}},{key:"fromJson",value:function(e,t){return Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e),this.resolution=new Xe,this.resolution.fromJson(e.resolution),this}},{key:"isEquivalent",value:function(e){return e.resolution.equals(this.resolution)}}]),n}(U);function le(e,t,n,r){var a=void 0;switch(t){case de:a=new _;break;case me:a=new Q;break;case ve:a=new Y;break;case ge:a=new $;break;case Ee:a=new ie;break;case ye:a=new te;break;case be:a=new Ne;break;case ke:a=new re;break;case Oe:a=new oe;break;case Pe:a=new ue;break;case Se:a=new fe(!1,new Xe);break;case we:a=new z}return void 0!==a&&(a.fromJson(e,n),void 0!==a&&(a.subSequence=r)),a}function pe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function he(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var fe=function(e){Object(u.a)(n,e);var t=he(n);function n(e,r){var a;return Object(o.a)(this,n),(a=t.call(this,new ue(r))).rolling=e,a}return Object(c.a)(n,[{key:"getValue",value:function(){return this.rolling?1:0}},{key:"isDeterministic",value:function(){return!0}},{key:"isSkippable",value:function(){return!0}},{key:"isPrunable",value:function(){return!this.rolling}},{key:"executeEvent",value:function(e){e.sequenceRolling=this.rolling}},{key:"getCopy",value:function(){var e=new n(this.rolling,this.initialSubEvent.resolution);return e.fromJson(this.getJson()),e}},{key:"getType",value:function(){return Se}},{key:"getSubType",value:function(){return Pe}},{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{rolling:this.rolling})}},{key:"fromJson",value:function(e,t){return Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e),this.rolling=e.rolling,this.initialSubEvent.step=this.step,this}}]),n}(function(e){Object(u.a)(n,e);var t=pe(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this)).initialSubEvent=e,r.initialSubEvent.parentEvent=Object(W.a)(r),r.subEvents=[],r.cache={},r}return Object(c.a)(n,[{key:"setTime",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"setTime",this).call(this,e,t),this.initialSubEvent.setTime(e,t)}},{key:"getNextSubEvent",value:function(e){for(var t in this.subEvents)if(e.step<this.subEvents[t].step)return this.subEvents[t]}},{key:"getPreviousSubEvent",value:function(e){var t;for(var n in this.subEvents){if(e===this.subEvents[n])return t;t=this.subEvents[n]}}},{key:"isLastSubEvent",value:function(e){return this.subEvents.indexOf(e)===this.subEvents.length-1}},{key:"deleteSubEvent",value:function(e){if(this.initialSubEvent===e)return 0===this.subEvents.length?(this.initialSubEvent=void 0,0):(this.initialSubEvent=this.subEvents[0],this.subEvents=this.subEvents.slice(1),this.initialSubEvent.step=this.step,void 0===this.initialSubEvent&&(this.subEvents=[]),0);var t=this.subEvents.indexOf(e);return t<0?t:(this.subEvents.splice(t,1),t)}},{key:"isEmpty",value:function(){return void 0===this.initialSubEvent&&0===this.subEvents.length}},{key:"restart",value:function(){this.cache={}}},{key:"getSubEvents",value:function(){var e=[this.initialSubEvent].concat(Object(M.a)(this.subEvents)),t=e[e.length-1];return void 0!==t&&(t.duration=this.step+this.duration-t.step),e}},{key:"addSubEvent",value:function(e){e.parentEvent=this,this.subEvents.push(e),this.subEvents.sort(function(e,t){return e.step-t.step});var t=this.initialSubEvent;for(var n in this.subEvents)void 0!==t&&(t.duration=this.subEvents[n].step-t.step),t=this.subEvents[n];var r=this.subEvents[this.subEvents.length-1];r.duration=this.step+this.duration-r.step}},{key:"getSubEvent",value:function(e){if(e in this.cache)return this.cache[e];for(var t=this.initialSubEvent,n=0;n<this.subEvents.length&&!(this.subEvents[n].step>e);n++)t=this.subEvents[n];return this.cache[e]=t,t}},{key:"getSubType",value:function(){}},{key:"fromJson",value:function(e,t){for(var r in Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),this.initialSubEvent=le(e.initialSubEvent,this.getSubType(),t),void 0===this.initialSubEvent.step&&(this.initialSubEvent.step=this.step),this.initialSubEvent.parentEvent=this,e.subEvents)this.addSubEvent(le(e.subEvents[r],this.getSubType(),t))}},{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{subType:this.getSubType(),initialSubEvent:this.initialSubEvent.getJson(),subEvents:this.subEvents.map(function(e){return e.getJson()})})}},{key:"calculateDurations",value:function(){if(this.isEmpty())this.duration=0;else{var e=this.getSubEvents(),t=void 0;for(var n in e)t&&(t.duration=e[n].step-t.step),t=e[n];t.duration=this.step+this.duration-t.step}}},{key:"events",get:function(){return this.getSubEvents()},set:function(e){this.restart(),this.initialSubEvent=e[0],this.subEvents=e.slice(1),this.calculateDurations()}}]),n}(U)),de=1,me=2,ve=3,ge=5,ye=6,be=7,ke=8,Ee=9,Oe=10,Se=11,Pe=12,we=14,je={id:1e6};function Te(e){switch(e){case de:return new _;case Se:return new fe;case we:return new z;default:return}}function xe(e){switch(e){case Se:case Pe:case de:return!0;default:return!1}}function Ce(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ne=function(e){Object(u.a)(n,e);var t=Ce(n);function n(e,r){var a;return Object(o.a)(this,n),(a=t.call(this)).parameter=e,a.parameterValue=r,a}return Object(c.a)(n,[{key:"getCopy",value:function(){return(new n).fromJson(this.getJson())}},{key:"isSkippable",value:function(){return!0}},{key:"executeEvent",value:function(e){this.parameter&&this.parameter.set(this.parameterValue,!0)}},{key:"getJson",value:function(){if(void 0!==this.parameter)return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{parameter:this.parameter.getJson(),value:this.parameterValue})}},{key:"getType",value:function(){return be}},{key:"fromJson",value:function(e,t){if(Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e),this.parameter=t.getParameterFromJson(e.parameter),this.parameterValue=e.value,void 0!==this.parameter)return this}}]),n}(U);function Re(e){var t={};for(var n in e){var r=e[n];t[n]=De(r)}return t}function De(e){return null===e?e:("object"===typeof e&&e.resolution&&(e=new Xe(16,!1).fromJson(e)),e)}var qe="LFO",Me="ENV",Ae=function(){function e(t,n,r,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:qe;Object(o.a)(this,e),this.parameter=t,this.modulator=n,this.scale=r,this.scales=a,this.type=i,void 0===this.scale&&void 0!==this.scales&&(this.scale=this.scales[0])}return Object(c.a)(e,[{key:"getJson",value:function(){return{modulator:this.modulator.number,min:this.scale.min,max:this.scale.max,type:this.type}}},{key:"min",get:function(){return this.scale.min},set:function(e){void 0!==this.scales?this.scales.forEach(function(t){return t.min=e}):this.scale.min=e}},{key:"max",get:function(){return this.scale.max},set:function(e){void 0!==this.scales?this.scales.forEach(function(t){return t.max=e}):this.scale.max=e}}]),e}();function Ie(e,t,n){var r={};if(e<t)for(var a in n)(a=parseInt(a))>t?r[a]=n[a]:a>e?r[a-1]=n[a]:a===e?r[t]=n[e]:r[a]=n[a];else for(var i in n)(i=parseInt(i))<t?r[i]=n[i]:i===e?r[t]=n[e]:i>=t?r[i+1]=n[i]:r[i]=n[i];return r}function Le(e,t){var n={};for(var r in t)(r=parseInt(r))!==e&&(r>e?n[r-1]=t[r]:n[r]=t[r]);return n}function Fe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}x.a.Master.context;var Be=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object(o.a)(this,e),a=e.getDefaultConfig(a),this.config=a,this.toCache={},this.fromCache={},this.context=void 0,this.name=t,this.prettyName=a.prettyName||t,this.effectName=void 0,this.builder=a.builder,this.object=n,this.setter=r,this.min=a.min,this.useMeter=!1,this.max=a.max,this.constantAutomationRate=a.constantAutomationRate,this.units=a.units,this.unlockedValue=null,this.automatable=a.automatable,this.patternToValue={},this.id=Object(A.uuid)(),null!==a.defaultValue&&this.set(a.defaultValue,!0),this.originalMin=this.min,this.originalMax=this.max,this.store=void 0,this.context=void 0,this.mixSession=void 0,this.lfos=[],this.envelopes=[],this.patternToAutomation={},this.unlockedAutomation=new H(this),this.previousAutomation=this.unlockedAutomation,this.currentStep=void 0}return Object(c.a)(e,null,[{key:"getDefaultConfig",value:function(e){return void 0===e.min&&(e.min=0),void 0===e.max&&(e.max=1),void 0===e.max&&(e.units=""),void 0===e.defaultValue&&(e.defaultValue=0),void 0===e.automatable&&(e.automatable=!0),void 0===e.constantAutomationRate&&(e.constantAutomationRate=!1),e}}]),Object(c.a)(e,[{key:"onNewStep",value:function(e){this.currentStep=e}},{key:"dispose",value:function(){for(var e in this.unlockedAutomation.dispose(),this.patternToAutomation)this.patternToAutomation[e].dispose();this.audioParam&&this.audioParam._param&&this.audioParam.dispose(),this.audioParams&&this.audioParams.filter(function(e){return e._param}).forEach(function(e){return e.dispose()}),this.audioParam=void 0,this.audioParams=void 0,this.object=void 0}},{key:"isPatternLocked",value:function(){return void 0!==this.context&&(this.context.track?this.context.track.instrumentRack?this.context.track.instrumentRack.patternLocked:this.context.track.patternLocked:this.context.lfosTrack?this.context.lfosTrack.patternLocked:this.context.envelopesTrack?this.context.envelopesTrack.patternLocked:this.context.sequencerEngine?this.context.sequencerEngine.patternLocked:void 0)}},{key:"deleteLocks",value:function(){this.currentPattern in this.patternToValue&&(this.unlockedValue=this.patternToValue[this.currentPattern]),this.patternToValue={},this.updateRedux()}},{key:"enableAudioParam",value:function(){this.useMeter=!0}},{key:"setAudioParam",value:function(e){this.audioParam=e,this.automationRate=F}},{key:"setAudioParams",value:function(e){this.audioParams=e}},{key:"isValidValue",value:function(e){return!isNaN(e)&&e>=this.min&&e<=this.max}},{key:"isAudioParamEnabled",value:function(){return void 0!==this.audioParam||void 0!==this.audioParams}},{key:"isConnectedToAnyModulator",value:function(){return this.isConnectedToAnyLFO()||this.isConnectedToAnyEnvelope()}},{key:"isConnectedToAnyLFO",value:function(){return this.lfos.length>0}},{key:"isConnectedToLFO",value:function(e){return this.lfos.indexOf(e)>-1}},{key:"isConnectedToAnyEnvelope",value:function(){return this.envelopes.length>0}},{key:"isConnectedToEnvelope",value:function(e){return this.envelopes.indexOf(e)>-1}},{key:"refresh",value:function(){this.set(this.get())}},{key:"hasPatternLockedValues",value:function(){return Object.keys(this.patternToValue).length>0||Object.keys(this.patternToAutomation).length>0}},{key:"connectToEnvelope",value:function(e){var t=this;this.isConnectedToEnvelope(e)||(this.envelopes.push(e),this.audioParams?this.audioParams.forEach(function(n,r){return e.connect(n,t,r)}):(this.automationRate=F,e.connect(this.audioParam,this,0)))}},{key:"disconnectFromAllModulators",value:function(){var e=Object(M.a)(this.lfos);for(var t in e)this.disconnectFromLFO(e[t]);var n=[].concat(n);for(var r in n)this.disconnectFromEnvelope(n[r]);this.lfos=[],this.envelopes=[]}},{key:"disconnectFromEnvelope",value:function(e){var t=this,n=(!(arguments.length>1&&void 0!==arguments[1])||arguments[1],this.envelopes.indexOf(e));n<0||(this.useMeter?this.useMeter=!1:this.audioParams?this.audioParams.forEach(function(n,r){return e.disconnect(n,t,r)}):(this.automationRate=F,e.disconnect(this.audioParam,this,0)),this.envelopes.splice(n,1))}},{key:"connectToLFO",value:function(e){var t=this;this.isConnectedToLFO(e)||(this.lfos.push(e),this.audioParams?this.audioParams.forEach(function(n,r){return e.connect(n,t,r)}):(this.automationRate=F,e.connect(this.audioParam,this,0)))}},{key:"disconnectFromLFO",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.lfos.indexOf(e);if(!(r<0)&&(this.useMeter?this.useMeter=!1:this.audioParams?this.audioParams.forEach(function(n,r){return e.disconnect(n,t,r)}):this.audioParam&&(e.disconnect(this.audioParam,this,0),this.automationRate=F),this.lfos.splice(r,1),0===this.lfos.length&&n)){this.audioParam,this.meter;this.audioParam=void 0,this.meter=void 0}}},{key:"getConnectableParam",value:function(){return this.audioParam}},{key:"setContext",value:function(e){this.context=e,void 0!==this.context.track?(this.track=this.context.track,this.track.sequencerEngine&&(this.track.sequencerEngine.idToParameter[this.id]=this)):this.context.lfoTrack?this.context.lfoTrack.sequencerEngine&&(this.context.lfoTrack.sequencerEngine.idToParameter[this.id]=this):this.context.envelopeTrack&&this.context.envelopeTrack.sequencerEngine&&(this.context.envelopeTrack.sequencerEngine.idToParameter[this.id]=this)}},{key:"setStore",value:function(e){this.store=e,void 0!==e&&(e.dispatch(Object(O.gb)(this.id,this.get())),this.unlockedAutomation.store=e,this.automation.updateRedux())}},{key:"setMixSession",value:function(e){this.mixSession=e}},{key:"setTrack",value:function(e){this.track=e}},{key:"copyFrom",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this.value=e.value:(this.disconnectFromAllModulators(),this.fromJson(e.getJson(),t),this.set(e.value))}},{key:"loadModsFromJson",value:function(e){if(void 0!==e.mods)for(var t in e.mods){var n=e.mods[t],r=n.modulator||n.lfo,a=n.type||qe;for(var i in this.parameterMods){var s=this.parameterMods[i];if(s.modulator.number===r&&s.type===a){s.min=n.min,s.max=n.max;break}}}}},{key:"fromJson",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0!==e){e.id&&!r&&(this.id=e.id);var a=void 0!==t?t.currentSubSequence||t.subSequences[0]:void 0;if(void 0!==e.lfo)this.enableAudioParam(),this.connectToLFO(t.lfos[0].lfo);else if(a&&void 0!==e.lfos&&e.lfos.length>0)for(var i in this.enableAudioParam(),e.lfos){var s=e.lfos[i];this.connectToLFO(a.lfos[s].lfo)}if(a&&void 0!==e.envelopes&&e.envelopes.length>0&&(this.enableAudioParam(),e.envelopes.forEach(function(e){return n.connectToEnvelope(a.envelopes[e])})),void 0!==e.value&&this.set(e.value),void 0!==e.patternToValue&&(this.unlockedValue=De(e.unlockedValue),this.patternToValue=Re(e.patternToValue),this.isPatternLocked()&&void 0!==this.patternToValue[0]?this.set(this.patternToValue[0]):this.set(this.unlockedValue)),e.patternToAutomation){for(var o in e.patternToAutomation)this.patternToAutomation[o]=new H(this),this.patternToAutomation[o].fromJson(e.patternToAutomation[o],!1);this.unlockedAutomation.fromJson(e.unlockedAutomation,!1),this.isPatternLocked()&&this.patternToAutomation[0]?this.patternToAutomation[0].schedule():this.automation.schedule()}this.loadModsFromJson(e)}}},{key:"getJson",value:function(){var e=this.parameterMods,t=void 0===this.context?void 0:this.context.subSequence,n={};for(var r in this.patternToAutomation)n[r]=this.patternToAutomation[r].getJson();return{id:this.id,unlockedAutomation:this.unlockedAutomation.getJson(),patternToAutomation:n,context:void 0===this.context?void 0:this.context.getJson(),subSequence:void 0===t?void 0:t.id,name:this.name,min:this.min,max:this.max,unlockedValue:this.unlockedValue,patternToValue:this.patternToValue,originalMin:this.originalMin,originalMax:this.originalMax,mods:e.map(function(e){return e.getJson()}),lfos:this.lfos.map(function(e){return e.number-1}),envelopes:this.envelopes.map(function(e){return e.number-1})}}},{key:"normalizedSet",value:function(e){this.set(this.normalize(e),void 0,void 0,.2)}},{key:"normalizeOriginal",value:function(e){return this.originalMin+(this.originalMax-this.originalMin)*e}},{key:"normalize",value:function(e){return this.min+(this.max-this.min)*e}},{key:"updateRedux",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var t in this.patternToAutomation)this.patternToAutomation[t].clear();if(this.unlockedAutomation.clear(),this.automation.clear(),this.automation.store=this.store,this.automation.updateRedux(),null!==this.value&&void 0!==this.value)return this.set(this.value,!0,e)}},{key:"deletePattern",value:function(e){this.patternToValue=Le(e,this.patternToValue)}},{key:"movePatternTo",value:function(e,t){this.patternToValue=Ie(e,t,this.patternToValue)}},{key:"newPattern",value:function(e,t){this.patternToValue[t]=this.patternToValue[e],this.patternToAutomation[e]?this.patternToAutomation[t]=this.patternToAutomation[e].getCopy(this.store):this.patternToAutomation[t]=this.automation.getCopy(this.store),this.patternToAutomation[t].updateRedux()}},{key:"callSetter",value:function(){var e=this.get();this.setter(this.object,e)}},{key:"set",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;this.builder&&(e=this.builder(e));this.value;return this.value=e,void 0===this.audioParam||null===e||void 0===e||isNaN(e)||this.hasAudioParamSetter||void 0!==n&&n>=0&&this.audioParam.exponentialRampToValueAtTime(e,n),this.setter(this.object,e),void 0!==this.store&&(t||this.sequencerEngine&&this.sequencerEngine.multiSequencerEngine||this.store.dispatch(Object(O.gb)(this.id,this.value))),{id:this.id,value:this.value}}},{key:"getAtStep",value:function(e){if(this.hasMacro){var t=this.hasMacro.macroParameter.getAtStep(e);return this.hasMacro.normalizeParameterValue(this,t)}if(this.automations&&this.automations.length>0){var n=this.automation.getValueAtStep(e);return this.isConnectedToAnyModulator()?n+this.get(!0):n}return this.get()}},{key:"shouldUseGetAtStep",value:function(){return void 0!==this.currentStep&&(this.automations.length>0||this.hasMacro&&this.hasMacro.macroParameter.automations.length>0)}},{key:"get",value:function(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this.shouldUseGetAtStep())return this.getAtStep(this.currentStep);if(this.useMeter){var e=this.getMeterValue();return(e=parseFloat(this.value)+parseFloat(e))>=this.max?this.max:e}return void 0===this.audioParam||void 0===this.meter?null===this.value?null:this.value:null===this.value||void 0===this.value||isNaN(this.value)?this.value:void 0}},{key:"getMeterValue",value:function(){var e=0;for(var t in this.lfos){var n=this.lfos[t].getScaleForParameter(this),r=this.lfos[t].getValue(this.trackStep),a=n.max,i=n.min,s=(a-i)*(r+100)/200+i;n.max,n.min,n.min;e+=s}for(var o in this.envelopes){var c=this.envelopes[o].getScaleForParameter(this),u=this.envelopes[o].getValue(this.trackStep),l=c.max,p=c.min;e+=(l-p)*u/1+p}return e}},{key:"automation",get:function(){return this.isPatternLocked()?(void 0===this.patternToAutomation[this.currentPattern]&&(this.patternToAutomation[this.currentPattern]=this.previousAutomation.getCopy(this.store)),this.previousAutomation=this.patternToAutomation[this.currentPattern],this.previousAutomation):(this.previousAutomation=this.unlockedAutomation,this.unlockedAutomation)}},{key:"automations",get:function(){return this.automation.automations}},{key:"sequencerEngine",get:function(){return this.track?this.track.sequencerEngine:this.object&&this.object.track?this.object.track.sequencerEngine:this.context&&this.context.effect?this.context.effect.sequencerEngine:this.context&&this.context.track?this.context.track.sequencerEngine:this.context&&this.context.instrumentRack?this.context.instrumentRack.sequencerEngine:this.context&&this.context.instrument?this.context.instrument.sequencerEngine:this.context&&this.context.lfoTrack?this.context.lfoTrack.sequencerEngine:void 0}},{key:"value",set:function(e){this.isPatternLocked()?this.patternToValue[this.currentPattern]=e:this.unlockedValue=e},get:function(){if(this.isPatternLocked()){var e=this.currentPattern;if(void 0===e)return;var t=this.patternToValue[e];return void 0===t?this.unlockedValue:t}return this.unlockedValue}},{key:"currentPattern",get:function(){return this.context.track?this.context.track.instrumentRack?this.context.track.instrumentRack.currentPattern:this.context.track.currentPattern:this.context.lfosTrack?this.context.lfosTrack.currentPattern:this.context.envelopesTrack?this.context.envelopesTrack.currentPattern:this.context.sequencerEngine?this.context.sequencerEngine.currentPattern:void 0}},{key:"automationRate",set:function(e){e=this.config.automationRate||e,void 0!==this.audioParam&&void 0!==this.audioParam.input&&(this.constantAutomationRate||(this.audioParam.input.automationRate=e))},get:function(){return this.audioParam&&this.audioParam.input&&this.audioParam.input.automationRate}},{key:"parameterMods",get:function(){var e=this;if(void 0!==this.audioParams){var t=this.lfos.map(function(t){return new Ae(e,t,void 0,e.audioParams.map(function(n,r){return t.getScaleForParameter(e,r)}))}),n=this.envelopes.map(function(t){return new Ae(e,t,void 0,e.audioParams.map(function(n,r){return t.getScaleForParameter(e,r)}),Me)});return t.concat(n).filter(function(e){return void 0!==e.scale})}var r=this.lfos.map(function(t){return new Ae(e,t,t.getScaleForParameter(e),void 0,qe)}),a=this.envelopes.map(function(t){return new Ae(e,t,t.getScaleForParameter(e),void 0,Me)});return r.concat(a).filter(function(e){return void 0!==e.scale})}},{key:"mix",get:function(){return this.context&&this.context.subSequence?this.context.subSequence.mix:void 0}},{key:"trackStep",get:function(){return void 0===this.context?0:this.context.track.sequencerEngine.trackStep}}]),e}(),He=function(e){Object(u.a)(n,e);var t=Fe(n);function n(e,r,a,i,s,c,u){var l=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],p=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return Object(o.a)(this,n),t.call(this,e,r,a,i,s,c,u,l,p)}return Object(c.a)(n,[{key:"normalize",value:function(e){return Math.round(this.min+(this.max-this.min)*e)}},{key:"set",value:function(e,t){Object(B.a)(e)&&(null===e?Object(q.a)(Object(p.a)(n.prototype),"set",this).call(this,null,t):Object(q.a)(Object(p.a)(n.prototype),"set",this).call(this,Math.round(e),t))}}]),n}(Be),Ve=function(e){Object(u.a)(n,e);var t=Fe(n);function n(e,r,a,i,s,c){return Object(o.a)(this,n),t.call(this,e,r,function(e,t){return e.value=t},a,i,s,c,!0)}return n}(Be),Ue=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object(o.a)(this,e),this.effectNumber=t,this.parameter=n,this.value=r,this.automationContext=a}return Object(c.a)(e,[{key:"setAtTime",value:function(e,t){this.parameter.set(this.value,void 0,void 0,e)}},{key:"getJson",value:function(){return Object(D.a)({},this.automationContext,{effectNumber:this.effectNumber,parameterName:this.parameter.name,value:this.value})}},{key:"getCopy",value:function(){return new e(this.effectNumber,this.parameter,this.value,this.automationContext)}}]),e}(),Je=function(){function e(t,n,r,a){Object(o.a)(this,e);var i=void 0!==t?t.store:void 0;this.track=a,this.context=r,this.mixSession=n,this.sequencerEngine=t,this.stepNumber=void 0,this.position=0,this.id=Object(A.uuid)(),this.parameters=[],this.on=!1,this.durationParameter=new Be("Duration",this,function(e,t){return t},{min:0,max:256,unit:"1/16th",defaultValue:null}),this.registerParameter(this.durationParameter,i,n,r),this.transposeParameter=new Be("Tranpose",this,function(e,t){return t},{min:-32,max:32,unit:"",defaultValue:null}),this.registerParameter(this.transposeParameter,i,n,r),this.chopParameter=new He("Chop",this,function(e,t){return t},{min:1,max:32,unit:"",defaultValue:null}),this.registerParameter(this.chopParameter,i,n,r),this.chopDurationParameter=new He("Chop Duration",this,function(e,t){return t},{min:1,max:32,unit:"",defaultValue:null}),this.registerParameter(this.chopDurationParameter,i,n,r),this.panningParameter=new Be("Panning",this,function(e,t){return t},{min:-1,max:1,unit:"",defaultValue:null}),this.registerParameter(this.panningParameter,i,n,r),this.velocityParameter=new Be("Velocity",this,function(e,t){return t},{min:0,max:1,unit:"",defaultValue:null}),this.registerParameter(this.velocityParameter,i,n,r),this.startParameter=new Be("Start",this,function(e,t){return t},{min:0,max:100,unit:"%",defaultValue:null}),this.registerParameter(this.startParameter,i,n,r),this.attackParameter=new Be("Attack",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:null}),this.registerParameter(this.attackParameter,i,n,r),this.releaseParameter=new Be("Release",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:null}),this.registerParameter(this.releaseParameter,i,n,r),this.sliceParameter=new He("Slice",this,function(e,t){return t},{min:0,max:64,unit:"",defaultValue:null,automatable:!1}),this.registerParameter(this.sliceParameter,i,n,r),this.pitchAttackParameter=new Be("Pitch Attack",this,function(e,t){return t},{min:.01,max:1e4,unit:"",defaultValue:null}),this.registerParameter(this.pitchAttackParameter,i,n,r),this.pitchDecayParameter=new Be("Pitch Decay",this,function(e,t){return t},{min:.01,max:1e4,unit:"",defaultValue:null}),this.registerParameter(this.pitchDecayParameter,i,n,r),this.pitchSustainParameter=new Be("Pitch Sustain",this,function(e,t){return t},{min:-10,max:10,unit:"",defaultValue:null}),this.registerParameter(this.pitchSustainParameter,i,n,r),this.pitchReleaseParameter=new Be("Pitch Release",this,function(e,t){return t},{min:.01,max:1e4,unit:"",defaultValue:null}),this.registerParameter(this.pitchReleaseParameter,i,n,r),this.selectedRecordingParameter=new Be("Selected Recording",this,function(e,t){return t},{min:1,max:100,unit:"",defaultValue:null}),this.registerParameter(this.selectedRecordingParameter,i,n,r),this.monophonicParameter=new Be("Monophonic",this,function(e,t){return t},{min:!1,max:!0,unit:"",defaultValue:null}),this.registerParameter(this.monophonicParameter,i,n,r),this.reverseParameter=new Be("reverse",this,function(e,t){return t},{min:0,max:1,unit:"",defaultValue:null}),this.registerParameter(this.reverseParameter,i,n,r),this.transposeMatchParameter=new Be("Transpose Match",this,function(e,t){return t},{min:0,max:20,unit:"",defaultValue:null}),this.registerParameter(this.transposeMatchParameter,i,n,r),this.effectAutomations=new _e,this.polyphonicSteps=[],this.nextStepData=void 0}return Object(c.a)(e,[{key:"registerParameter",value:function(e,t,n,r){e.setStore(t),void 0!==n&&e.setMixSession(n),void 0!==r&&e.setContext(r),this.parameters.push(e)}},{key:"triggerAutomations",value:function(e,t){e=new x.a.Time(e)-x.a.Master.context.currentTime,this.effectAutomations.forMidiEffects().forEach(function(e){return e.setAtTime()}),null!==this.panningParameter.get()&&t.setPanning(this.panning,e),this.effectAutomations.forAudioEffects().forEach(function(t){return t.setAtTime(e)}),this.effectAutomations.forInstruments().forEach(function(t){return t.setAtTime(e)})}},{key:"addEffectAutomation",value:function(e){this.effectAutomations.push(e)}},{key:"addStep",value:function(e){if(this===e||this.id===e.id||this.transpose===e.transpose)return e;if(void 0===this.nextStepData){if(!this.on)return e;this.nextStepData=e}else this.nextStepData=this.nextStepData.addStep(e);return this}},{key:"hasStep",value:function(e){return this===e||this.id===e.id||void 0!==this.nextStepData&&this.nextStepData.hasStep(e)}},{key:"deleteStep",value:function(t){if(this===t||this.id===t.id){if(void 0===this.nextStepData)return new e;var n=this.nextStepData;return this.nextStepData=void 0,n}if(void 0!==this.nextStepData){var r=this.nextStepData.deleteStep(t);if(void 0!==r)return this.nextStepData=r,this}}},{key:"containsStep",value:function(e){return e.id===this.id||void 0!==this.nextStepData&&this.containsStep(this.nextStepData)}},{key:"getStepDataForTranspose",value:function(e,t){if(Math.round(this.transpose)==e||t&&null===this.transpose)return this;var n=this.getPolyphony(),r=-1;for(var a in n){var i=n[a];if(Math.round(i.transpose)==e||t&&null===i.transpose){r=a;break}}return-1!=r?n[r]:void 0}},{key:"deleteTranspose",value:function(e,t){if(this.transpose===e||t&&null===this.transpose){var n=this.polyphonicSteps;this.clear(),n.length>0&&(this.copyFrom(n[0]),this.polyphonicSteps=n.slice(1))}else{var r=this.polyphonicSteps.filter(function(n){return n.transpose==e||t&&null==n.transpose});if(r.length>0){var a=this.polyphonicSteps.indexOf(r[0]);this.polyphonicSteps.splice(a,1)}}}},{key:"getPolyphony",value:function(){for(var e=this,t=[];void 0!==e;)e.track=this.track,t.push(e),e=e.nextStepData;return t}},{key:"equals",value:function(e){return!(this.on!=e.on||this.duration!=e.duration||this.transpose!=e.transpose||this.chop!=e.chop||this.chopDuration!=e.chopDuration||this.velocity!=e.velocity||this.start!=e.start||this.panning!=e.panning||this.attack!=e.attack||this.reverse!=e.reverse||this.release!=e.release||this.slice!=e.slice||this.pitchAttack!==e.pitchAttack||this.pitchDecay!==e.pitchDecay||this.pitchSustain!==e.pitchSutain||this.selectedRecording!==e.selectedRecording||this.pitchRelease!==e.pitchRelease)}},{key:"simpleLoad",value:function(e,t,n,r){this.loadFromJson(e,t,void 0,void 0,void 0,n,r)}},{key:"loadFromJson",value:function(t,n){var r=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,c=arguments.length>6?arguments[6]:void 0;return this.on=t.on,void 0!==t.id&&(this.id=t.id),this.duration=void 0===t.duration?null:t.duration,void 0!==t.durationParameter&&this.durationParameter.fromJson(t.durationParameter,s),this.panning=void 0===t.panning?null:t.panning,void 0!==t.transpose&&(this.transpose=t.transpose),this.transposeParameter.fromJson(t.transposeParameter,s),void 0!==t.velocity&&(this.velocity=t.velocity),this.velocityParameter.fromJson(t.velocityParameter,s),void 0!==t.start&&(this.start=t.start),this.startParameter.fromJson(t.startParameter,s),void 0!==t.chop&&(this.chop=t.chop),this.chopParameter.fromJson(t.chopParameter,s),this.chopDuration=void 0===t.chopDuration?null:t.chopDuration,void 0!==t.attack&&(this.attack=t.attack),this.attackParameter.fromJson(t.attackParameter,s),void 0!==t.release&&(this.release=t.release),this.releaseParameter.fromJson(t.releaseParameter,s),this.slice="slice"in t?t.slice:0,void 0!==t.pitchAttack&&(this.pitchAttack=t.pitchAttack),this.pitchAttackParameter.fromJson(t.pitchAttackParameter,s),void 0!==t.pitchDecay&&(this.pitchDecay=t.pitchDecay),this.pitchDecayParameter.fromJson(t.pitchDecayParameter,s),void 0!==t.pitchSustain&&(this.pitchSustain=t.pitchSustain),this.pitchSustainParameter.fromJson(t.pitchSustainParameter,s),void 0!==t.pitchRelease&&(this.pitchRelease=t.pitchRelease),this.pitchReleaseParameter.fromJson(t.pitchReleaseParameter,s),void 0!==t.selectedRecording&&(this.selectedRecording=t.selectedRecording),this.monophonicParameter.fromJson(t.monophonicParameter,s),void 0!==t.monophonic&&(this.monophonic=t.monophonic),this.selectedRecordingParameter.fromJson(t.selectedRecordingParameter,s),this.reverse=void 0===t.reverse?a:t.reverse,void 0!==t.effectAutomations&&this.loadAutomations(t.effectAutomations,o,n,c),"polyphonicSteps"in t&&!i&&(t.polyphonicSteps.map(function(t){var n=new e;return n.stepNumber=r.stepNumber,n.loadFromJson(t,void 0,null,!0),n}).forEach(function(e){return r.addStep(e)}),this.nextStepData),this}},{key:"clearAutomations",value:function(){this.automations.clear()}},{key:"loadAutomations",value:function(e,t,n,r){for(var a=0;a<e.length;a++){var i=e[a],s=i.effectNumber,o=i.parameterName,c=i.value,u=n[s],l=r[s];void 0!==u&&this.findAutomationParameter(u,o,s,c),void 0!==l&&this.findAutomationParameter(l,o,s,c),void 0===s&&this.findAutomationInstrumentParameter(t.instrument,i,o,c)}}},{key:"findAutomationParameter",value:function(e,t,n,r){var a=e.parameters.filter(function(e){return t===e.name});if(a.length>0){var i=a[0];this.effectAutomations.set(i,new Ue(n,i,r))}}},{key:"findAutomationInstrumentParameter",value:function(e,t,n,r){var a=e.findParameter(t,n),i=Object(D.a)({},t);delete i.name,delete i.value,delete i.effectNumber,void 0!==a&&this.effectAutomations.set(a,new Ue(void 0,a,r,i))}},{key:"loadDefaults",value:function(){this.on=!1,this.reverse=!1,this.transpose=0,this.duration=1,this.velocity=1,this.start=0,this.chop=1,this.chopDuration=1,this.attack=0,this.release=15,this.slice=0,this.pitchAttack=.01,this.pitchDecay=.01,this.pitchSustain=0,this.pitchRelease=.01,this.monophonic=!1,this.selectedRecording=0}},{key:"clear",value:function(){this.on=!1,this.reverse=null,this.transpose=null,this.panning=null,this.duration=null,this.velocity=null,this.start=null,this.chop=null,this.chopDuration=null,this.attack=null,this.release=null,this.pitchAttack=null,this.pitchDecay=null,this.pitchRelease=null,this.pitchSustain=null,this.selectedRecording=null,this.transposeMatch=null,this.slice=null,this.polyphonicSteps=[],this.nextStepData=void 0,this.monophonic=null}},{key:"getCopy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=void 0;return o=void 0!==this.stepDataCopy&&i?this.stepDataCopy:a?new e:new e(this.sequencerEngine,this.mixSession),s&&(this.stepDataCopy=o),o.stepNumber=this.stepNumber,n&&(o.id=this.id),o.track=this.track,o.position=this.position,o.on=this.on,o.effectAutomations=this.effectAutomations.getCopy(),o.durationParameter.copyFrom(this.durationParameter,this.sequencerEngine,r),o.chopParameter.copyFrom(this.chopParameter,this.sequencerEngine,r),o.panningParameter.copyFrom(this.panningParameter,this.sequencerEngine,r),o.transposeParameter.copyFrom(this.transposeParameter,this.sequencerEngine,r),o.velocityParameter.copyFrom(this.velocityParameter,this.sequencerEngine,r),o.startParameter.copyFrom(this.startParameter,this.sequencerEngine,r),o.attackParameter.copyFrom(this.attackParameter,this.sequencerEngine,r),o.releaseParameter.copyFrom(this.releaseParameter,this.sequencerEngine,r),o.sliceParameter.copyFrom(this.sliceParameter,this.sequencerEngine,r),o.transposeMatchParameter.copyFrom(this.transposeMatchParameter,this.sequencerEngine,r),t||this.getPolyphony().map(function(e){return e.getCopy(!0,n,r,a,i)}).slice(1).forEach(function(e){return o.addStep(e)}),o.pitchAttackParameter.copyFrom(this.pitchAttackParameter,this.sequencerEngine,r),o.pitchDecayParameter.copyFrom(this.pitchDecayParameter,this.sequencerEngine,r),o.pitchSustainParameter.copyFrom(this.pitchSustainParameter,this.sequencerEngine,r),o.pitchReleaseParameter.copyFrom(this.pitchReleaseParameter,this.sequencerEngine,r),o.selectedRecordingParameter.copyFrom(this.selectedRecordingParameter,this.sequencerEngine,r),o.monophonicParameter.copyFrom(this.monophonicParameter,this.sequencerEngine,r),o.reverse=this.reverse,o}},{key:"copyFrom",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.on=e.on,this.stepNumber=e.stepNumber,this.duration=e.durationParameter.get(),this.panning=e.panningParameter.get(),this.chop=e.chopParameter.get(),this.chopDuration=e.chopDurationParameter.get(),this.transpose=e.transposeParameter.get(),this.velocity=e.velocityParameter.get(),this.start=e.startParameter.get(),this.attack=e.attackParameter.get(),this.release=e.releaseParameter.get(),this.slice=e.sliceParameter.get(),this.pitchAttack=e.pitchAttackParameter.get(),this.pitchDecay=e.pitchDecayParameter.get(),this.pitchSustain=e.pitchSustainParameter.get(),this.pitchRelease=e.pitchReleaseParameter.get(),this.selectedRecording=e.selectedRecordingParameter.get(),this.transposeMatch=e.transposeMatchParameter.get(),this.monophonic=e.monophonicParameter.get(),this.reverse=e.reverse,n||e.getPolyphony().slice(1).map(function(e){return e.getCopy()}).forEach(function(e){return t.addStep(e)})}},{key:"getJson",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t={on:this.on,newPitchSustain:!0,id:this.id};return null!==this.reverse&&(t.reverse=this.reverse),(this.durationParameter.lfos.length>0||Object.keys(this.durationParameter.patternToValue).length>0||null!==this.durationParameter.get())&&(t.durationParameter=this.durationParameter.getJson()),null!==this.durationParameter.get()&&(t.duration=this.duration),null!==this.panningParameter.get()&&(t.panning=this.panning),(this.chopParameter.lfos.length>0||Object.keys(this.chopParameter.patternToValue).length>0||null!==this.chopParameter.get())&&(t.chopParameter=this.chopParameter.getJson()),(this.transposeParameter.lfos.length>0||Object.keys(this.transposeParameter.patternToValue).length>0||null!==this.transposeParameter.get())&&(t.transposeParameter=this.transposeParameter.getJson()),(this.velocityParameter.lfos.length>0||Object.keys(this.velocityParameter.patternToValue).length>0||null!==this.velocityParameter.get())&&(t.velocityParameter=this.velocityParameter.getJson()),(this.startParameter.lfos.length>0||Object.keys(this.startParameter.patternToValue).length>0||null!==this.startParameter.get())&&(t.startParameter=this.startParameter.getJson()),(this.attackParameter.lfos.length>0||Object.keys(this.attackParameter.patternToValue).length>0||null!==this.attackParameter.get())&&(t.attackParameter=this.attackParameter.getJson()),null!==this.attackParameter.get()&&(t.attack=this.attack),(this.releaseParameter.lfos.length>0||Object.keys(this.releaseParameter.patternToValue).length>0||null!=this.releaseParameter.get())&&(t.releaseParameter=this.releaseParameter.getJson()),null!==this.slice&&(t.slice=this.slice),(this.pitchAttackParameter.lfos.length>0||Object.keys(this.pitchAttackParameter.patternToValue).length>0||null!=this.pitchAttackParameter.get())&&(t.pitchAttackParameter=this.pitchAttackParameter.getJson()),(this.pitchDecayParameter.lfos.length>0||Object.keys(this.pitchDecayParameter.patternToValue).length>0||null!=this.pitchDecayParameter.get())&&(t.pitchDecayParameter=this.pitchDecayParameter.getJson()),(this.pitchSustainParameter.lfos.length>0||Object.keys(this.pitchSustainParameter.patternToValue).length>0||null!=this.pitchSustainParameter.get())&&(t.pitchSustainParameter=this.pitchSustainParameter.getJson()),(this.pitchReleaseParameter.lfos.length>0||Object.keys(this.pitchReleaseParameter.patternToValue).length>0||null!=this.pitchReleaseParameter.get())&&(t.pitchReleaseParameter=this.pitchReleaseParameter.getJson()),(this.selectedRecordingParameter.lfos.length>0||Object.keys(this.selectedRecordingParameter.patternToValue).length>0||null!=this.selectedRecordingParameter.get())&&(t.selectedRecordingParameter=this.selectedRecordingParameter.getJson()),(Object.keys(this.monophonicParameter.patternToValue).length>0||null!=this.monophonicParameter.get())&&(t.monophonicParameter=this.monophonicParameter.getJson()),e||(t.polyphonicSteps=this.getPolyphony().slice(1).map(function(e){return e.getJson(!0)})),t.effectAutomations=this.effectAutomations.automations.map(function(e){return e.getJson()}),t}},{key:"trackData",get:function(){return void 0!==this.track?this.track.trackData:this}},{key:"duration",get:function(){return null===this.durationParameter.get()?this.trackData.durationParameter.get():this.durationParameter.get()},set:function(e){this.durationParameter.set(e)}},{key:"panning",get:function(){return null===this.panningParameter.get()?this.trackData.panningParameter.get():this.panningParameter.get()},set:function(e){this.panningParameter.set(e)}},{key:"transpose",get:function(){return null===this.transposeParameter.get()?this.trackData.transposeParameter.get():this.transposeParameter.get()},set:function(e){this.transposeParameter.set(e)}},{key:"velocity",get:function(){return null===this.velocityParameter.get()?this.trackData.velocityParameter.get():this.velocityParameter.get()},set:function(e){this.velocityParameter.set(e)}},{key:"start",get:function(){return null===this.startParameter.get()?this.trackData.startParameter.get():this.startParameter.get()},set:function(e){this.startParameter.set(e)}},{key:"chop",get:function(){return null===this.chopParameter.get()?this.trackData.chopParameter.get():this.chopParameter.get()},set:function(e){this.chopParameter.set(e)}},{key:"chopDuration",get:function(){return null===this.chopDurationParameter.get()?this.trackData.chopDurationParameter.get():this.chopDurationParameter.get()},set:function(e){this.chopDurationParameter.set(e)}},{key:"slice",get:function(){return null===this.sliceParameter.get()?this.trackData.sliceParameter.get():this.sliceParameter.get()},set:function(e){this.sliceParameter.set(e)}},{key:"attack",get:function(){return null===this.attackParameter.get()?this.trackData.attackParameter.get():this.attackParameter.get()},set:function(e){this.attackParameter.set(e)}},{key:"release",get:function(){return null===this.releaseParameter.get()?this.trackData.releaseParameter.get():this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e)}},{key:"pitchAttack",get:function(){return null===this.pitchAttackParameter.get()?this.trackData.pitchAttackParameter.get():this.pitchAttackParameter.get()},set:function(e){this.pitchAttackParameter.set(e)}},{key:"pitchDecay",get:function(){return null===this.pitchDecayParameter.get()?this.trackData.pitchDecayParameter.get():this.pitchDecayParameter.get()},set:function(e){this.pitchDecayParameter.set(e)}},{key:"pitchSustain",set:function(e){this.pitchSustainParameter.set(e)},get:function(){return null===this.pitchSustainParameter.get()?this.trackData.pitchSustainParameter.get():this.pitchSustainParameter.get()}},{key:"pitchRelease",get:function(){return null===this.pitchReleaseParameter.get()?this.trackData.pitchReleaseParameter.get():this.pitchReleaseParameter.get()},set:function(e){this.pitchReleaseParameter.set(e)}},{key:"reverse",set:function(e){this.reverseParameter.set(e)},get:function(){return null===this.reverseParameter.get()?this.trackData.reverseParameter.get():this.reverseParameter.get()}},{key:"transposeMatch",set:function(e){this.transposeMatchParameter.set(e)},get:function(){return this.transposeMatchParameter.get()}},{key:"selectedRecording",get:function(){return null===this.selectedRecordingParameter.get()?this.trackData.selectedRecordingParameter.get():this.selectedRecordingParameter.get()},set:function(e){this.selectedRecordingParameter.set(e)}},{key:"monophonic",set:function(e){this.monophonicParameter.set(e)},get:function(){return null===this.monophonicParameter.get()?this.trackData.monophonicParameter.get():this.monophonicParameter.get()}}]),e}(),_e=function(){function e(){Object(o.a)(this,e),this.automations=[]}return Object(c.a)(e,[{key:"clear",value:function(){this.automations=[]}},{key:"get",value:function(e){var t=this.automations.filter(function(t){return t.parameter===e});if(t.length>0)return t[0]}},{key:"delete",value:function(e){var t=-1;for(var n in this.automations)this.automations[n].parameter===e&&(t=n);-1!==t&&this.automations.splice(t,1)}},{key:"set",value:function(e,t){this.automations.push(t)}},{key:"trigger",value:function(e,t){this.automations.forEach(function(n){return n.setAtTime(e,t)})}},{key:"isEmpty",value:function(){return 0==this.automations.length}},{key:"forAudioEffects",value:function(){return this.automations.filter(function(e){return e.parameter.context.effect}).filter(function(e){return!e.parameter.context.effect.isMidiEffect()})}},{key:"forMidiEffects",value:function(){return this.automations.filter(function(e){return e.parameter.context.effect}).filter(function(e){return e.parameter.context.effect.isMidiEffect()})}},{key:"forInstruments",value:function(){return this.automations.filter(function(e){return e.parameter.context.track}).filter(function(e){return void 0!==e.parameter.context.track.instrument})}},{key:"getCopy",value:function(){var t=new e;return t.automations=this.automations.map(function(e){return e.getCopy()}),t}}]),e}(),Ge=Je,ze=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(o.a)(this,e),this.track=t,this.isTriplet=n,this.steps={0:new Ge(void 0,void 0,void 0,t)}}return Object(c.a)(e,[{key:"getAllOnSteps",value:function(){var e=[];for(var t in this.steps)e=e.concat(this.steps[t].getPolyphony().filter(function(e){return e.on}));return e}},{key:"getStep",value:function(e){return void 0===this.steps[e]?new Ge(void 0,void 0,void 0,this.track):this.steps[e]}},{key:"getAnyStep",value:function(){return this.steps[Object.keys(this.steps)[0]]}},{key:"setStep",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t.track=this.track,this.isTriplet||(t.position=parseFloat(e)),n&&void 0!==this.steps[e]&&this.steps[e].on&&this.steps[e].getPolyphony().length>=1?this.steps[e].addStep(t):this.steps[e]=t}},{key:"setStepAtPosition",value:function(e,t){e.track=this.track,this.isTriplet||(e.position=parseFloat(t)),this.steps[t]=e}},{key:"clear",value:function(){this.steps={0:new Ge(void 0,void 0,void 0,this.track)}}},{key:"getCopy",value:function(){var t=Object(R.a)(N.a.mark(function t(){var n,r,a,i,s,o,c=this,u=arguments;return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=u.length>0&&void 0!==u[0]?u[0]:this.track,(r=new e(n)).isTriplet=r.isTriplet,a=[],t.t0=N.a.keys(this.steps);case 5:if((t.t1=t.t0()).done){t.next=12;break}if(i=t.t1.value,this.steps[i].on){t.next=9;break}return t.abrupt("continue",5);case 9:a.push(new Promise(function(e,t){e({key:i,stepData:c.steps[i].getCopy(!1,!1,!0,!0,!1,!0)})})),t.next=5;break;case 12:return t.next=14,Promise.all(a);case 14:for(o in s=t.sent)r.setStep(s[o].key,s[o].stepData);return t.abrupt("return",r);case 17:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"getJson",value:function(){var e={};for(var t in this.steps)e[t]=this.steps[t].getJson();return e}},{key:"anyOn",value:function(){for(var e in this.steps)if(this.steps[e].getPolyphony().some(function(e){return e.on}))return!0;return!1}},{key:"anyEffectAutomation",value:function(){for(var e in this.steps)if(this.steps[e].getPolyphony().some(function(e){return!e.effectAutomations.isEmpty()}))return!0;return!1}},{key:"anyOnAfter",value:function(e,t,n){for(var r in e=parseFloat(e),this.steps){if(parseFloat(r)+1e-5>=e&&this.steps[r].getPolyphony().some(function(e){return e.on&&(void 0===t||n&&null==e.transpose||e.transpose===t)}))return!0}return!1}},{key:"clearAfterIfOn",value:function(e,t,n){var r=!1;for(var a in this.steps)a>=e&&this.steps[a].getPolyphony().some(function(e){return e.on&&(void 0==t||n&&null==e.transpose||e.transpose==t)})&&(void 0!==t?this.steps[a].deleteTranspose(t,n):this.steps[a]=new Ge,r=!0);return r}},{key:"clearBeforeIfOn",value:function(e,t,n){var r=!1;for(var a in this.steps)a<e&&this.getStep(a).getPolyphony().some(function(e){return e.on&&(void 0===t||n&&null==e.transpose||e.transpose==t)})&&(void 0!==t?this.steps[a].deleteTranspose(t,n):this.steps[a]=new Ge,r=!0);return r}}]),e}(),We=new x.a.Time("16n"),Ke=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(o.a)(this,e),this.resolution=t,this.isTriplet=n,this.baseResolution=n?48:32}return Object(c.a)(e,[{key:"getTripletOrNonTriplet",value:function(){return this.isTriplet?new e(this.resolution,!1):new e(this.resolution,!0)}},{key:"equals",value:function(e){return this.resolution===e.resolution&&this.isTriplet===e.isTriplet}},{key:"getOffset",value:function(){return this.baseResolution/this.numSteps()}},{key:"getLengthAtResolution",value:function(e){return e*(this.numSteps()/this.baseResolution)}},{key:"getNumberOfStepsAtBaseResolution",value:function(){return this.baseResolution/this.numSteps()}},{key:"getTimeInStep",value:function(){return this.isTriplet?new x.a.Time(this.resolution+"t"):new x.a.Time(this.resolution+"n")}},{key:"getDurationOfStep",value:function(){return this.getTimeInStep().toMilliseconds()/new We.toMilliseconds}},{key:"numSteps",value:function(){return this.isTriplet?this.resolution/32*48:this.resolution}},{key:"toString",value:function(){return this.isTriplet?this.resolution+"t":this.resolution}},{key:"transformList",value:function(e,t){for(var n=(t=t||this.baseResolution)/this.numSteps(),r=[],a=0;a<e.length;a+=n)r.push(e[a]);return r}},{key:"transformBucketsIntoSteps",value:function(e){for(var t=this.baseResolution/this.numSteps(),n=[],r=0;r<e.length;r+=t){for(var a=16,i=null,s=0;s<t;s++){var o=e[r+s];if(void 0===o)break;var c=o.steps;for(var u in c)u<a&&c[u].on&&(a=u,i=s)}null==i&&(i=0,a=0),n.push(e[r+i].getStep(a))}return n}},{key:"transformBucketsAtResolution",value:function(e,t){if(this.isTriplet==t.isTriplet)return this.transformList(e,t);for(var n=e.length*this.numSteps()/t.numSteps(),r=e[0].track,a=[],i=0;i<n;i++){var s=new ze(r,this.isTriplet);a.push(s)}for(var o=0;o<e.length;o++)for(var c in e[o].steps){var u=(o+parseFloat(c))*this.numSteps()/t.numSteps(),l=Math.floor(u),p=u-l,h=a[l];void 0!==h&&(h.setStep(p,e[o].getStep(c)),a[l]=h)}return a}},{key:"transformStepAtResolution",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e(32,!1);return t*(this.baseResolution/this.numSteps())*this.numSteps()/n.numSteps()}},{key:"transformStepAtResolution2",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e(32,!1);return t*this.numSteps()/n.numSteps()}},{key:"transformStepAtBaseResolution",value:function(t){return t*new e(32,!1).numSteps()/this.numSteps()}},{key:"transformStepFromBaseResolution",value:function(e){return this.transformStepAtResolution2(e,Qe)}},{key:"getJson",value:function(){return{resolution:this.resolution,baseResolution:this.baseResolution,isTriplet:this.isTriplet}}},{key:"fromJson",value:function(e){return this.resolution=e.resolution,this.baseResolution=e.baseResolution,this.isTriplet=e.isTriplet,this}},{key:"getCopy",value:function(){return new e(this.resolution,this.isTriplet)}}]),e}(),Qe=new Ke(32,!1),Xe=Ke,Ye=new Xe(4,!1),Ze=new Xe(8,!1),$e=new Xe(16,!1),et=new Xe(32,!1),tt=function(e){var t=e.resolution,n=e.sequencerEngine,i=Object(r.useState)(!1),s=Object(j.a)(i,2),o=s[0],c=s[1],u=Object(r.useCallback)(function(){console.log("ROLLING!"),n.resolution=t,n.trackRolling=!0,n.sequenceRolling=!0,c(!0)},[c]),l=Object(r.useCallback)(function(){console.log("UNROLLING!"),n.resolution=t,n.sequenceRolling=!1,n.trackRolling=!1,c(!1)},[c]),p="explore-roll-button";return o&&(p+=" flash-it rolling"),a.a.createElement("div",{onMouseDown:u,onMouseLeave:l,onMouseUp:l,className:p},"1/",t.resolution)},nt=Object(g.b)(function(e,t){return{resolution:e.sequencer.resolution}},null)(function(e){e.resolution;var t=e.sequencerEngine,n=e.setContextualHelp;return a.a.createElement("div",{onMouseOver:function(){return n("ROLL_BUTTONS")},onMouseLeave:function(){return n(void 0)},className:"roll-buttons"},a.a.createElement(tt,{sequencerEngine:t,resolution:Ye}),a.a.createElement(tt,{sequencerEngine:t,resolution:Ze}),a.a.createElement(tt,{sequencerEngine:t,resolution:$e}),a.a.createElement(tt,{sequencerEngine:t,resolution:et}))}),rt=Object(g.b)(function(e){return{muted:e.installation.muted}},function(e){return{setInstallationMuted:function(t){return e(Object(O.xb)(t))}}})(function(e){var t=e.muted,n=e.sequencerEngine,i=e.setInstallationMuted,s=e.setContextualHelp,o=Object(r.useCallback)(function(){t?n.channelMixer.mute(!1):n.channelMixer.mute(!0),i(!t)},[t]);return a.a.createElement("div",{className:"sequencer-module"},a.a.createElement(nt,{setContextualHelp:s,sequencerEngine:n}),a.a.createElement("div",{onMouseOver:function(){return s("MUTE_BUTTON")},onMouseLeave:function(){return s(void 0)},onClick:o,className:"mute-button"},t?"Unmute":"Mute"))}),at=Object(g.b)(function(e,t){return{numMembers:e.installation.numMembers}},null)(function(e){return a.a.createElement("div",{className:"room-module"},a.a.createElement("div",{onMouseOver:function(){return e.setContextualHelp("NUMBER_OF_PEOPLE")},onMouseLeave:function(){return e.setContextualHelp(void 0)},className:"people-online"},e.numMembers),a.a.createElement("div",{onMouseOver:function(){return e.setContextualHelp("NUMBER_OF_PEOPLE")},onMouseLeave:function(){return e.setContextualHelp(void 0)},className:"people-text"},"people online"),a.a.createElement("div",{onMouseOver:function(){return e.setContextualHelp("LEAVE_ROOM_BUTTON")},onMouseLeave:function(){return e.setContextualHelp(void 0)},onClick:function(){e.sequencerEngine.operationManager.roomActionsManager.firebaseHandler.leaveRoom()},className:"leave-room"},"Leave"))}),it="MOVE_STEPS",st="SNAP_TO_GRID",ot=function(e,t,n,r){return{type:"ADD_STEP",payload:{track:e,step:t,stepNumber:n,resolution:r}}},ct=function(e,t,n,r){return{type:"DELETE_STEP",timestamp:(new Date).getTime(),payload:{track:e,step:t,stepNumber:n,resolution:r}}},ut=function(e,t,n){return{type:"DELETE_STEP_NUMBER",timestamp:(new Date).getTime(),payload:{track:e,stepNumber:t,resolution:n}}},lt=function(e,t,n){return{type:"TOGGLE_STEP",payload:{track:e,stepNumber:t,resolution:n}}},pt=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return{type:it,payload:{track:e,steps:t,transformation:n,wrap:a,resolution:r}}},ht=function(e,t){return{type:"DELETE_STEPS",payload:{track:e,steps:t}}},ft=function(e,t,n,r){return{type:"UPDATE_STEP_PARAMETER",payload:{track:e,step:t,parameter:n,value:r}}},dt=function(e,t,n,r){return{type:"UPDATE_STEP_DURATIONS",payload:{track:e,steps:t,factor:n,value:r}}},mt=function(e,t,n,r){return{type:"ADD_EFFECT",payload:{effect:e,track:t,group:n,send:r}}},vt=function(e,t,n,r){return{type:"TOGGLE_EFFECT",payload:{effect:e,track:t,group:n,send:r}}},gt=function(e,t,n,r,a,i){return{type:"MOVE_EFFECT",payload:{from:e,to:t,isMidiEffect:n,track:r,group:a,send:i}}},yt=function(e,t){return{type:"UPDATE_PARAMETER",payload:{parameter:e,value:t}}},bt=function(e,t){return{type:"UPDATE_TRACK_VOLUME",payload:{track:e,value:t}}},kt=function(e,t,n,r){return{type:"ADD_AUTOMATION_BREAK_POINT",payload:{automation:e,step:t,value:n,pointId:r}}},Et=function(e,t,n,r){return{type:"MOVE_AUTOMATION_BREAK_POINT",payload:{automation:e,point:t,step:n,value:r}}},Ot=function(e,t,n,r){return{type:"MOVE_AUTOMATION_BREAK_POINTS",payload:{automation:e,points:t,stepDiff:n,valueDiff:r}}},St=function(e,t,n){return{type:st,payload:{track:e,steps:t,resolution:n}}},Pt=function(e,t){return{type:"SNAP_AUTOMATION_BREAK_POINT",payload:{automation:e,point:t}}},wt=n(36),jt=new wt.a,Tt=(Object(g.b)(function(e,t){if(void 0===t.track)return{};var n=t.track;return n&&n.tracks&&n.tracks[0]&&(n=n.tracks[0].track),{id:void 0!==n.sample&&void 0!==n.sample.getId()?n.sample.getId():n.presetName||n.getName(),resolution:e.sequencer.resolution,isSelectedTrack:e.mix.selectedTrack===t.track.trackNumber&&t.track.subSequence.id===t.sequencerEngine.currentSubSequence.id}},null)(function(e){var t=e.sequencerEngine,n=e.track,i=e.muted,s=e.isSelectedTrack,o=Object(r.useCallback)(function(){var e=n.subSequence.id;t.switchToSubSequence(e),t.selectTrack(n.trackNumber)},[i,n]),c="track-mute",u={backgroundColor:jt.getColorForTrack(n)};return s&&(c+=" selected"),a.a.createElement("div",{onClick:o,style:u,className:c},a.a.createElement("div",{className:"track-mute-name"}))}),n(60)),xt=n.n(Tt),Ct=n(946),Nt=n.n(Ct),Rt=Object(g.b)(function(e,t){return{browseHistory:e.installation.browseHistory,historyLength:e.installation.historyLength,historyPosition:e.installation.historyPosition,historyTimestamp:e.installation.historyTimestamp}},null)(function(e){var t=e.sequencerEngine.operationManager,n=e.setContextualHelp;return a.a.createElement("div",null,e.browseHistory?a.a.createElement("div",{className:"history"},a.a.createElement("div",{onMouseOver:function(){return n("HISTORY_TIMESTAMP")},onMouseLeave:function(){return n(void 0)},className:"history-timestamp"},0===e.historyTimestamp?"Beginning of time":Nt()(e.historyTimestamp,"default")),a.a.createElement("div",{onMouseOver:function(){return n("HISTORY_SLIDER")},onMouseLeave:function(){return n(void 0)},className:"history-slider"},a.a.createElement(xt.a,{value:e.historyPosition,change:function(e){return t.historySliderChanged(e.target.value)},slideStop:function(e){return t.historySliderStopped(e.target.value)},step:1,max:e.historyLength,min:0,orientation:"horizontal",reversed:!1})),a.a.createElement("div",{onMouseOver:function(){return n("BACK_TO_LIVE_BUTTON")},onMouseLeave:function(){return n(void 0)},onClick:function(){t.browseHistory=!1},className:"history-back-to-live"},"Back to live")):a.a.createElement("div",{className:"history"},a.a.createElement("div",{className:"history-browse-history-text"},"Live"),a.a.createElement("div",{onMouseOver:function(){return n("BROWSE_HISTORY_BUTTON")},onMouseLeave:function(){return n(void 0)},onClick:function(){t.browseHistory=!0},className:"history-browse-history"},"Browse history")))}),Dt=Object(g.b)(function(e,t){return{toastMessage:e.installation.toastMessage,showToast:e.installation.showToast}},null)(function(e){return a.a.createElement("div",null,e.showToast?a.a.createElement("div",{className:"dashboard-module wide toast-border toast-flash"},a.a.createElement("div",{className:"toast-close"},a.a.createElement("div",{onClick:function(){e.sequencerEngine.operationManager.showToast=!1},className:"close"},"\u2715")),a.a.createElement("div",{className:"inner-module"},a.a.createElement("div",{className:"toast-text"},e.toastMessage))):"")}),qt=n(947),Mt=n.n(qt),At=n(948),It=n.n(At),Lt=Object(g.b)(function(e,t){return{hideInterface:e.installation.hideInterface}},null)(function(e){return a.a.createElement("div",{className:"dashboard-module hide-module"},a.a.createElement("img",{onClick:function(){e.sequencerEngine.operationManager.hideInterface=!e.sequencerEngine.operationManager.hideInterface},src:e.hideInterface?It.a:Mt.a,className:e.hideInterface?"hide-eye-slash":"hide-eye"}),a.a.createElement("div",{className:"hide-text"},"Show / Hide Interface"))}),Ft=(n(1645),Object(g.b)(function(e,t){return{currentRoom:e.installation.currentRoom}},function(e){return{setContextualHelp:function(t){return e(Object(O.U)(t))}}})(function(e){return a.a.createElement("div",{className:"sequencer-dashboard"},a.a.createElement(y,{name:""},a.a.createElement(rt,e)),a.a.createElement(y,{name:""},a.a.createElement(E,e)),a.a.createElement(y,{name:e.currentRoom},a.a.createElement(at,e)),a.a.createElement(y,{name:"History",wide:!0},a.a.createElement(Rt,e)),a.a.createElement(Dt,e),a.a.createElement(Lt,e))})),Bt=(n(1646),Object(g.b)(function(e){return{loadingSequence:e.sequencer.loadingSequence,loadingProgress:e.installation.loadingProgress}},null)(function(e){var t=e.loadingProgress,n=e.roomName,r={width:390*t/100};return a.a.createElement("div",{className:"progress-bar"},a.a.createElement("div",{className:"inner-progress-bar"},a.a.createElement("div",{className:"progress",style:r}),a.a.createElement("div",{className:"loading-text"},"Entering ",n," ...")))})),Ht=function(){function e(){Object(o.a)(this,e),this.selectedTags=[],this.selectedOrTags=[],this.selectedStyles=[],this.selectedCountries=[],this.selectedVideos=[],this.selectedDiscogs=[],this.filterFavorites=!1,this.year=void 0,this.chord=void 0}return Object(c.a)(e,[{key:"toString",value:function(){console.log("selectedTags = "+this.selectedTags.join(",")),console.log("selectedOrTags = "+this.selectedOrTags.join(",")),console.log("selectedStyles= "+this.selectedStyles.join(",")),console.log("selectedCountries = = "+this.selectedCountries.join(","))}},{key:"empty",value:function(){return 0==this.selectedTags.length&&0==this.selectedStyles.length&&0==this.selectedOrTags.length&&0==this.selectedCountries.length&&void 0===this.chord&&void 0==this.year}},{key:"getSearchQueryParameters",value:function(){var e="?tags="+this.selectedTags.join(",")+"&styles="+this.selectedStyles.join(",")+"&countries="+this.selectedCountries.join(",");return void 0!==this.year&&(e+="&year="+this.year),e}},{key:"getTopTags",value:function(){return this.getTopFields("/getTags")}},{key:"getTopStyles",value:function(){return this.getTopFields("/getStyles")}},{key:"getTopCountries",value:function(){return this.getTopFields("/getCountries")}},{key:"getTopFields",value:function(e){var t=this;return new Promise(function(n,r){var a=t.getSearchQueryParameters();e+=a,f.a.get(e).then(function(e){var t=e.data.data,r=[];for(var a in t)r.push(a);n(r)}).catch(function(e){r(e)})})}},{key:"getSounds",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r,a;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="/filterSearch/"+t+"/"+n+this.getSearchQueryParameters(),e.next=3,f.a.get(r);case 3:return a=e.sent,e.abrupt("return",this.searchCallback(a));case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"searchCallback",value:function(e){for(var t=e.data.data,n=[],r=0;r<t.length;r++)n.push(t[r].id);return{sounds:n,total:e.data.total}}}]),e}(),Vt=n(27),Ut=function(){function e(){Object(o.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"bytes32",name:"hash",type:"bytes32"}],name:"newGuildClassification",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"guildsAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"},{indexed:!0,internalType:"bytes32",name:"hash",type:"bytes32"}],name:"NewGuildClassification",type:"event"}],this.contractAddress="0x3831959eF022C226F3bdfF6481f4666901428f90"}return Object(c.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),Jt=n(31),_t=n(41),Gt=n(39),zt=n(189),Wt=new Ut,Kt={};function Qt(e){for(var t,n,r=e.length;0!==r;)n=Math.floor(Math.random()*r),t=e[r-=1],e[r]=e[n],e[n]=t;return e}var Xt=new(function(){function e(){Object(o.a)(this,e),void 0!==Vt.a&&Vt.a.eth.net.isListening()&&(this.contract=new Vt.a.eth.Contract(Wt.abi,Wt.contractAddress),this.ethAddress=this.contract.options.address)}return Object(c.a)(e,[{key:"saveClassifications",value:function(e,t){var n=this;return new Promise(function(){var r=Object(R.a)(N.a.mark(function r(a,i){var s,o;return N.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Gt.a.addJson(t);case 2:return s=r.sent,r.next=5,Vt.a.eth.getAccounts();case 5:o=r.sent,n.contract.methods.newGuildClassification(e,Object(zt.b)(s)).send({from:o[0]},function(e,t){e?i(e):a(s)});case 7:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"getClassificationsHash",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r,a=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:0,n=new _t.a(Wt.contractAddress).from(Jt.i).select("contentHash").where("guildId",t),e.next=4,n.executeQuery();case 4:if(0!==(r=e.sent).length){e.next=7;break}return e.abrupt("return",void 0);case 7:return e.abrupt("return",r[0].contentHash);case 8:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"getClassifications",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(function(){var n=Object(R.a)(N.a.mark(function n(r,a){var i,s;return N.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!Kt[t]){n.next=2;break}return n.abrupt("return",r(Kt[t]));case 2:return n.next=4,e.getClassificationsHash(t);case 4:if(void 0!==(i=n.sent)){n.next=9;break}r({}),n.next=14;break;case 9:return n.next=11,Gt.a.getJson(i);case 11:s=n.sent,Kt[t]=s,r(s);case 14:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}}]),e}()),Yt=function(){function e(){Object(o.a)(this,e),this.tagToLevel={},this.tagToParent={},this.tagToChildren={},this.loadHierarchy()}return Object(c.a)(e,[{key:"loadHierarchy",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r,a,i,s;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Xt.getClassifications();case 2:for(r in t=e.sent,n={},t)for(a in n[r]=this.getParentOfTag(r,t),t[r])i=t[r][a],n[i]=r;for(s in this.tagToChildren=t,this.tagToParent=n,this.tagToLevel={},n)this.tagToLevel[s]=this.getLevel(s,n);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getAllChildren",value:function(e){var t=this.tagToChildren[e],n=[];for(var r in t)n=n.concat(this.getAllChildren(t[r]));return n.concat(t)}},{key:"reduce",value:function(e,t){if(e.length<=40)return e;var n=1,r=0===t.length,a=!0,i=[];for(var s in t){var o=t[s];i=i.concat(this.getAllChildren(o)),void 0===this.tagToLevel[o]?r=!0:a=!1,this.tagToLevel[o]>=n&&(n=this.tagToLevel[o])}return r&&(n+=2),a?this.filterReduction(e,2,i,r):this.filterReduction(e,n,i,r)}},{key:"filterReduction",value:function(e,t,n,r){var a=this;return e.filter(function(e){return n.indexOf(e.value)>-1||a.tagToLevel[e.value]<=t||r&&void 0===a.tagToLevel[e.value]})}},{key:"getLevel",value:function(e,t){return void 0===t[e]?0:t[e]===e?0:1+this.getLevel(t[e],t)}},{key:"getParentOfTag",value:function(e,t){for(var n in t){if(t[n].indexOf(e)>-1)return n}return null}}]),e}(),Zt="OR",$t="AND";function en(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function tn(e){e=e.map(function(t){return{value:t.value,rank:Math.pow(.9,8*t.rank/e.length)}});var t=Math.max.apply(Math,e.map(function(e){return e.rank}));return e.map(function(e){return{value:e.value,rank:e.rank/t}})}function nn(e,t){var n={};for(var r in e)r in t&&(n[r]=e[r].rank+t[r].rank);return n}var rn=function(e){Object(u.a)(n,e);var t=en(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this)).cache=e,r.varietyReducer=new Yt,r}return Object(c.a)(n,[{key:"freeTextSearch",value:function(e){var t=this;return new Promise(function(n,r){n({TAG:tn(t.cache.freeTextSearch("TAG",e)),STYLE:tn(t.cache.freeTextSearch("STYLE",e)),COUNTRY:tn(t.cache.freeTextSearch("COUNTRY",e)),YEAR:tn(t.cache.freeTextSearch("YEAR",e))})})}},{key:"getTopVideos",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.empty()){e.next=4;break}return e.abrupt("return",this.cache.getAllForField("YOUTUBE",0,1e7));case 4:return r=this.selectedOrTags.length>0?Zt:$t,e.abrupt("return",this.getTopFields(0,1e7,"YOUTUBE",r));case 6:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTopDiscogs",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.empty()){e.next=4;break}return e.abrupt("return",this.cache.getAllForField("DISCOGS",0,1e7));case 4:return r=this.selectedOrTags.length>0?Zt:$t,e.abrupt("return",this.getTopFields(0,1e7,"DISCOGS",r));case 6:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTopTags",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n,r){var a,i;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=void 0===r?this.selectedTags:r,!this.filterFavorites){e.next=6;break}return e.next=4,d.a.getFavoritesForUser();case 4:return a=e.sent,e.abrupt("return",this.getTagsForSounds(a));case 6:return e.next=8,this.getTopFields(t,n,"TAG");case 8:return i=e.sent,e.abrupt("return",this.varietyReducer.reduce(i,this.selectedTags));case 10:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getTopStyles",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.selectedOrTags.length>0?Zt:$t,e.abrupt("return",this.getTopFields(void 0,void 0,"STYLE",t));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getTopCountries",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.selectedOrTags.length>0?Zt:$t,e.abrupt("return",this.getTopFields(void 0,void 0,"COUNTRY",t));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getVideoInfo",value:function(e){var t=Array.from(this.cache.getFieldsForField("TAG","YOUTUBE",e)),n=Array.from(this.cache.getFieldsForField("STYLE","YOUTUBE",e)),r=Array.from(this.cache.getFieldsForField("YEAR","YOUTUBE",e));return{tags:t.map(function(e){return e.value}),styles:n.map(function(e){return e.value}),year:r.map(function(e){return e.value})[0]}}},{key:"getTopFields",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n,r){var a,i,s,o,c,u,l=this,p=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=p.length>3&&void 0!==p[3]?p[3]:$t,i=this.getSelectedFields(a),!this.empty()){e.next=4;break}return e.abrupt("return",tn(this.cache.getAllForField(r,t,n)));case 4:for(c in s=[],o=function(e){i[e].forEach(function(t){s.push(l.cache.getFieldsForField(r,e,t))})},i)o(c);return u=[],u=a==Zt?Array.from(this.unionAll(s)):Array.from(this.intersectAll(s)),e.abrupt("return",tn(u));case 10:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getSelectedFields",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$t,t=void 0===this.year?[]:[this.year];return{TAG:e==Zt?this.selectedOrTags:this.selectedTags,STYLE:this.selectedStyles,COUNTRY:this.selectedCountries,YEAR:t}}},{key:"getTagsForSounds",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r,a,i,s;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(a in n={},r=[],t)r.push(d.a.getTagsForSound(t[a]));return e.next=5,Promise.all(r);case 5:for(s in i=e.sent)i[s].forEach(function(e){return n[e]=!0});return e.abrupt("return",Object.keys(n));case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"unionAll",value:function(e){if(void 0===e||0==e.length)return[];var t={};return e.forEach(function(e){return e.forEach(function(e){e.value in t||(t[e.value]=0),t[e.value]+=e.rank})}),t}},{key:"intersectAll",value:function(e){if(void 0===e||0==e.length)return[];var t=[],n=function(n){a=e[n];var r={};a.forEach(function(e){return r[e.value]=e.rank}),t.push(r)};for(var r in e){var a;n(r)}for(var i=t[0],s=1;s<t.length;s++)i=nn(i,t[s]);var o=new Set;for(var c in i)o.add({value:c,rank:i[c]/t.length});return o}}]),n}(Ht);function an(e,t){var n=new Set(e),r=new Set(t);return Array.from(n).every(function(e){return r.has(e)})&&Array.from(r).every(function(e){return n.has(e)})}var sn=function(){function e(t){Object(o.a)(this,e),this.store=t,this.selectedTags=[],this.selectedOrTags=[],this.selectedStyles=[],this.selectedCountries=[],this.selectedVideos=[],this.filterFavorites=!1,this.chord=!1,this.year=void 0,this.unsortedResults=[],this.canceled=!1,this.mostRecentResults=void 0,this.mostPopularResults=void 0,this.shuffledResults=void 0,console.log("constructing new search query obj")}return Object(c.a)(e,[{key:"addLazyResults",value:function(){var e=Object(R.a)(N.a.mark(function e(t){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.linkedPromiseList=t;case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getNext",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n=this;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.linkedPromiseList&&!this.canceled){e.next=3;break}return this.canceled||this.setFinalResults(this.unsortedResults),e.abrupt("return",void 0);case 3:return e.next=5,this.linkedPromiseList.getCurrent();case 5:if(t=e.sent,(t=Array.from(new Set(t))).forEach(function(e){n.unsortedResults.push(e)}),this.setFinalResults(this.unsortedResults),void 0!==this.linkedPromiseList){e.next=11;break}return e.abrupt("return",void 0);case 11:return e.next=13,this.linkedPromiseList.getNext();case 13:return this.linkedPromiseList=e.sent,e.abrupt("return",this.linkedPromiseList);case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"addUnsortedResults",value:function(e){this.unsortedResults=e}},{key:"sort",value:function(){this.setFinalResults(this.unsortedResults)}},{key:"setFinalResults",value:function(e){this.unsortedResults=e,"MOST_POPULAR"===this.sortBy?this.mostPopularResults?this.results=this.mostPopularResults:(this.results=this.sortByRanking(Object(M.a)(this.unsortedResults)),this.mostPopularResults=this.results):"RANDOM"===this.sortBy?void 0===this.shuffledResults?(console.log("shuffling"),this.results=Qt(Object(M.a)(this.unsortedResults)),this.shuffledResults=this.results):this.results=this.shuffledResults:this.mostRecentResults?this.results=this.mostRecentResults:(this.results=this.unsortedResults,this.mostRecentResults=this.results)}},{key:"sortByRanking",value:function(e){var t=this;return void 0===this.sampleToRanking?e:(e.sort(function(e,n){var r=e in t.sampleToRanking?t.sampleToRanking[e]:0;return(n in t.sampleToRanking?t.sampleToRanking[n]:0)-r}),e)}},{key:"getAllSounds",value:function(){var e=this,t=void 0===this.favorites||void 0===this.results?this.results:this.results.filter(function(t){return e.favorites.indexOf(t)>-1});return Array.from(new Set(t))}},{key:"getResults",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,r=this.getAllSounds();return void 0!==r&&(void 0!==this.stylesSounds&&(r=r.filter(function(t){return e.stylesSounds.has(t)})),void 0!==this.yearSounds&&(r=r.filter(function(t){return e.yearSounds.has(t)})),void 0!==this.chordSounds&&(r=r.filter(function(t){return e.chordSounds.has(t)})),void 0!==this.videosSounds&&(r=r.filter(function(t){return e.videosSounds.has(t)}))),void 0===r?{sounds:[],total:0}:void 0!==t&&void 0!==n?t>=r.length?{sounds:[],total:0}:t+n>=r.length?{sounds:r.slice(t),total:r.length}:{sounds:r.slice(t,t+n),total:r.length}:{sounds:r,total:r.length}}},{key:"cancel",value:function(){this.canceled=!0}},{key:"empty",value:function(){return 0===this.selectedTags.length&&0===this.selectedStyles.length&&0===this.selectedOrTags.length&&-0==this.selectedCountries.length&&0===this.selectedVideos.length&&void 0===this.chord&&void 0===this.year}},{key:"equals",value:function(e){var t=!1;return this.chord===e.chord?t=!0:void 0===this.chord||void 0===e.chord?t=!1:this.chord.join(",")===e.chord.join(",")&&(t=!0),an(this.selectedTags,e.selectedTags)&&an(this.selectedOrTags,e.selectedOrTags)&&an(this.selectedStyles,e.selectedStyles)&&an(this.selectedVideos,e.selectedVideos)&&an(this.selectedDiscogs,e.selectedDiscogs)&&an(this.selectedCountries,e.selectedCountries)&&function(e,t){if(void 0!==e&&void 0===t)return!1;if(void 0!==t&&void 0===e)return!1;if(void 0===e&&void 0===t)return!0;e=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),t=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate());var n=Math.abs(e-t);if(0===Math.floor(n/1e3/60/60/24))return!0;return!1}(this.fromDate,e.fromDate)&&this.filterFavorites===e.filterFavorites&&t&&this.year===e.year}},{key:"sortBy",get:function(){return this.store.getState().selector.sortBy}}]),e}(),on=n(299),cn=n(298);function un(e,t){return new Set(Object(M.a)(e).filter(function(e){return t.has(e)}))}function ln(e,t){return pn.apply(this,arguments)}function pn(){return(pn=Object(R.a)(N.a.mark(function e(t,n){var r,a,i,s,o,c,u;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(a in r=[],t)i=t[a],r.push(n(i));return e.next=4,Promise.all(r);case 4:s=e.sent,o=new Set(s[0]),e.t0=N.a.keys(s);case 7:if((e.t1=e.t0()).done){e.next=15;break}if(0!=(c=e.t1.value)){e.next=11;break}return e.abrupt("continue",7);case 11:u=new Set(s[c]),o=un(o,u),e.next=7;break;case 15:return e.abrupt("return",Array.from(o));case 16:case"end":return e.stop()}},e)}))).apply(this,arguments)}function hn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var fn=new(function(){function e(){Object(o.a)(this,e),this.recentQueries=[],this.guildId=0}return Object(c.a)(e,[{key:"setStore",value:function(e){var t=this;void 0===this.store&&e&&(this.store=e,this.store.subscribe(function(){return t.onChange()}))}},{key:"onChange",value:function(){var e=this.store.getState().guilds.selectedGuild,t=e?e.guildId:0;t!==this.guildId&&(console.log("guild changed to guildId = "+t),this.guildId=t,this.clear())}},{key:"clear",value:function(){this.recentQueries=[]}},{key:"createSearchQuery",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new sn(this.store);return n.selectedTags=e.selectedTags,n.selectedOrTags=e.selectedOrTags,n.selectedStyles=e.selectedStyles,n.selectedVideos=e.selectedVideos,n.selectedDiscogs=e.selectedDiscogs,n.selectedCountries=e.selectedCountries,n.filterFavorites=e.filterFavorites,n.fromDate=e.fromDate,n.chord=void 0===e.chord?void 0:Object(M.a)(e.chord),n.year=e.year,t||(n.sampleToRanking=e.sampleToRanking),n}},{key:"getSearchQueryIfExists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.createSearchQuery(e),r=this.recentQueries.filter(function(e){return n.equals(e)&&!n.canceled});return void 0===(r=0==r.length?void 0:r[0])||t||(r.sampleToRanking=e.sampleToRanking,r.canceled=!1),void 0!==r&&r.sort(),r}},{key:"addNewQuery",value:function(e){this.recentQueries.push(e),this.recentQueries.length>25&&this.recentQueries.splice(0,1)}}]),e}()),dn={};function mn(e,t){if(void 0!==e||void 0!==t){var n=new Set;return e&&e.forEach(function(e){return n.add(e)}),t&&t.forEach(function(e){return n.add(e)}),console.log("union gave me = "),console.log(e),console.log(t),console.log(n),n}}var vn=function(e){Object(u.a)(n,e);var t=hn(n);function n(e,r){var a;return Object(o.a)(this,n),(a=t.call(this,e)).store=r?r.store:void 0,a.cache=e,a.updateSoundRankings(),fn.setStore(a.store),a}return Object(c.a)(n,[{key:"getNewIndex",value:function(){var e=Object(R.a)(N.a.mark(function e(t){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cache.loadNewIndex(t);case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"clearCache",value:function(){fn.clear(),dn={}}},{key:"filterByMonth",value:function(){var e=Object(R.a)(N.a.mark(function e(t){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cache.filterByMonth(t.getMonth(),t.getFullYear());case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"clearFilterByMonth",value:function(){this.cache.clearFilter()}},{key:"getAllSounds",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r,a,i,s,o,c;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(r=fn.getSearchQueryIfExists(this,!0))){e.next=3;break}return e.abrupt("return",r);case 3:return r=fn.createSearchQuery(this,!0),e.next=6,this.getSoundsWithVideos(this.selectedVideos);case 6:return a=e.sent,e.next=9,this.getSoundsWithDiscogs(this.selectedDiscogs);case 9:if(i=e.sent,r.videosSounds=mn(a,i),s=[],!this.filterFavorites){e.next=18;break}return e.next=15,d.a.getFavoritesForUser();case 15:s=e.sent,e.next=29;break;case 18:if(o=void 0,void 0===a&&void 0===i){e.next=23;break}o=r.videosSounds,e.next=28;break;case 23:return(c=new Date(this.fromDate)).setDate(this.fromDate.getDate()+31),e.next=27,d.a.getAllSounds(this.fromDate,c);case 27:o=e.sent;case 28:o.forEach(function(e){-1==s.indexOf(e)&&s.push(e)});case 29:return r.setFinalResults(s),fn.addNewQuery(r),e.abrupt("return",r);case 32:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSounds",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r,a,i,s,o,c,u,l,p,h,f,m;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(r=fn.getSearchQueryIfExists(this))){e.next=3;break}return e.abrupt("return",r);case 3:return r=fn.createSearchQuery(this),(new Date).getTime(),e.next=7,this.getSoundsWithTags(this.selectedTags);case 7:return a=e.sent,e.next=10,this.getSoundsWithVideos(this.selectedVideos);case 10:return i=e.sent,e.next=13,this.getSoundsWithDiscogs(this.selectedDiscogs);case 13:return s=e.sent,e.next=16,this.getSoundsWithOrTags(this.sortTagsByPopularity(this.selectedOrTags));case 16:return o=e.sent,e.next=19,this.getSoundsWithStyles(this.selectedStyles);case 19:return c=e.sent,e.next=22,this.getSoundsWithCountries(this.selectedCountries);case 22:return u=e.sent,e.next=25,this.getSoundsWithYear(this.year);case 25:return l=e.sent,e.next=28,this.getSoundsWithChord(this.chord);case 28:if(p=e.sent,(new Date).getTime(),h=[p,a,c,u,l],f=this.intersectResultsForFilters(h),!this.filterFavorites){e.next=38;break}return e.next=35,d.a.getFavoritesForUser();case 35:e.t0=e.sent,e.next=39;break;case 38:e.t0=void 0;case 39:return m=e.t0,r.videosSounds=mn(i,s),r.favorites=m,r.countriesSounds=u,r.stylesSounds=c,r.yearSounds=l,r.chordSounds=p,r.addUnsortedResults(f),r.addLazyResults(o),fn.addNewQuery(r),e.abrupt("return",r);case 50:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSoundsWithTags",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n=this;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",[]);case 2:return e.t0=Set,e.next=5,ln(t,function(e){return n.getSoundsWithTag(e)});case 5:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithTag",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in dn)){e.next=2;break}return e.abrupt("return",dn[t]);case 2:return e.next=4,d.a.getSoundsWithTag(t);case 4:return n=e.sent,dn[t]=n,e.abrupt("return",n);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithVideos",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r,a,i,s;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",void 0);case 2:for(r in n=[],t)n.push(d.a.getSoundsWithVideo(t[r]));return e.next=6,Promise.all(n);case 6:for(s in a=e.sent,i=[],a)i=i.concat(a[s]);return e.abrupt("return",new Set(i));case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithDiscogs",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r,a,i,s;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",void 0);case 2:for(r in n=[],t)n.push(d.a.getSoundsWithDiscogs(t[r]));return e.next=6,Promise.all(n);case 6:for(s in a=e.sent,i=[],a)i=i.concat(a[s]);return console.log(i),e.abrupt("return",new Set(i));case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithOrTags",value:function(){var e=Object(R.a)(N.a.mark(function e(t){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.abrupt("return",this.recursivelySearchOrTags(t));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"recursivelySearchOrTags",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=t.length){e.next=2;break}return e.abrupt("return",new Promise(function(e,t){return e(void 0)}));case 2:return n=t[0],e.abrupt("return",new on.a(function(){return d.a.getSoundsWithTag(n)},this.recursivelySearchOrTags(t.slice(1))));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithStyles",value:function(){var e=Object(R.a)(N.a.mark(function e(t){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.t0=Set,e.next=5,ln(t,function(e){return d.a.getSoundsWithStyle(e)});case 5:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithCountries",value:function(){var e=Object(R.a)(N.a.mark(function e(t){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.t0=Set,e.next=5,ln(t,function(e){return d.a.getSoundsWithCountry(e)});case 5:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithYear",value:function(){var e=Object(R.a)(N.a.mark(function e(t){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.t0=Set,e.next=5,d.a.getSoundsWithYear(this.year);case 5:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithChord",value:function(){var e=Object(R.a)(N.a.mark(function e(t){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.t0=Set,e.t1=Object,e.next=6,(new cn.a).searchRankedNotes(this.chord);case 6:return e.t2=e.sent,e.t3=e.t1.keys.call(e.t1,e.t2),e.abrupt("return",new e.t0(e.t3));case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"intersectResultsForFilters",value:function(e){if(this.selectedOrTags.length>0)return[];var t=!1,n=new Set([]);for(var r in e){var a=e[r];if(void 0!==a)if(n.size>0){if(!(a.size>0))continue;n=un(n,a),t=!0}else!t&&a.size>0&&(n=a)}return Array.from(n)}},{key:"sortTagsByPopularity",value:function(e){var t=this.cache.getAllForField("TAG",0,2e3);return e.sort(function(e,n){return t.indexOf(e)-t.indexOf(n)}),e}},{key:"updateSoundRankings",value:function(){var e=Object(R.a)(N.a.mark(function e(){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.getOverallVotedRankings();case 2:this.sampleToRanking=e.sent;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"sortBy",get:function(){return fn.sortBy},set:function(e){fn.sortBy=e}}]),n}(rn),gn=n(49),yn=function e(){Object(o.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"month",type:"uint32"},{name:"year",type:"uint32"}],name:"newMonthlyIndex",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"month",type:"uint32"},{indexed:!0,name:"year",type:"uint64"}],name:"NewMonthlyIndex",type:"event"}],this.contractAddress="0xfaa21e766f988524d3f38b9c46c22aca11d76dd5"},bn=n(97),kn=new yn,En=(window.web3,function(){function e(){Object(o.a)(this,e),this.indexContract=new Vt.a.eth.Contract(kn.abi,kn.contractAddress),this.indexContractAddress=this.indexContract.options.address}return Object(c.a)(e,[{key:"getIndexForMonth",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r,a,i;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new bn.a(this.indexContractAddress).from(Jt.q).select("hash").where("month",t).where("year",n).executeQuery();case 2:if(r=e.sent,console.log("got the results for monthly = "),console.log(r),void 0!==r&&0!==r.length){e.next=7;break}return e.abrupt("return");case 7:return a=r[0].hash,e.next=10,Gt.a.getJson(a);case 10:return i=e.sent,e.abrupt("return",i);case 12:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}());function On(e){var t=void 0;for(var n in e){var r=e[n];void 0!==r&&(t=void 0!==t?Sn(t,r):r)}return t}function Sn(e,t){var n={};for(var r in e){var a=e[r],i=t[r];for(var s in n[r]={},a){var o=a[s],c=i[s];n[r][s]=Pn(o,c)}}return n}function Pn(e,t){var n=wn(e),r=wn(t),a={};for(var i in n)a[i]=i in r?[].concat(Object(M.a)(n[i]),Object(M.a)(r[i])):n[i];for(var s in r)s in n||(a[s]=n[s]);return function(e){return Object.keys(e).map(function(t){return{dimension:t,values:e[t]}})}(a)}function wn(e){var t={};for(var n in e){var r=e[n];t[r.dimension]=r.values}return t}var jn=new(function(){function e(){Object(o.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"bytes32",name:"ipfsHash",type:"bytes32"}],name:"newIndex",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"guildsAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"},{indexed:!1,internalType:"bytes32",name:"indexHash",type:"bytes32"}],name:"NewIndex",type:"event"}],this.contractAddress="0xefBe8bf3720fE3aD117B1397DD95c77240Fe8837"}return Object(c.a)(e,[{key:"getContract",value:function(e){return console.log("getting contract w address = "+this.contractAddress),new e.eth.Contract(this.abi,this.contractAddress)}}]),e}()),Tn=new En,xn={},Cn=function(){function e(t){var n=this;Object(o.a)(this,e),this.fullIndex=void 0,this.guildId=0,this.useMonth=!1,this.monthlyIndices=[],this.monthlyFilter=void 0,this.store=t,t&&this.store.subscribe(function(){return n.onStateUpdate()})}return Object(c.a)(e,[{key:"onStateUpdate",value:function(){var e=this.store.getState(),t=e.guilds.selectedGuild?e.guilds.selectedGuild.guildId:0;t!==this.guildId&&(this.guildId=t,this.loadIndex())}},{key:"loadNewIndex",value:function(){var e=Object(R.a)(N.a.mark(function e(t){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.guildId=t,e.next=3,this.loadIndex();case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"filterByMonth",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.monthlyFilter&&this.monthlyFilter.month===t&&this.monthlyFilter.year===n){e.next=4;break}return e.next=3,Tn.getIndexForMonth(t,n);case 3:this.monthlyIndex=e.sent;case 4:return this.useMonth=!0,this.monthlyFilter={month:t,year:n},e.abrupt("return",!0);case 7:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearFilter",value:function(){this.useMonth=!1}},{key:"loadIndex",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=n.length>0&&void 0!==n[0]?n[0]:this.guildId)||!gn.a.isLoggedIn()){e.next=8;break}return e.next=4,this.fetchAndMergeIndices();case 4:return this.fullIndex=e.sent,console.log("merged indices = "),console.log(this.fullIndex),e.abrupt("return");case 8:return e.next=10,this.fetchIndex(t);case 10:this.fullIndex=e.sent;case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fetchAndMergeIndices",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r,a,i;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("fetch and merge indicies"),t=[0],n=Array.from(new Set(t.map(function(e){return e.guildId}))),console.log("guilds = "),console.log(n),r=[],e.t0=N.a.keys(n);case 7:if((e.t1=e.t0()).done){e.next=18;break}return a=e.t1.value,i=n[a],console.log("fetching index for guildId = "+i),e.t2=r,e.next=14,this.fetchIndex(i);case 14:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=7;break;case 18:return console.log("indices to merge = "),console.log(r),e.abrupt("return",On(r));case 21:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fetchIndex",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:this.guildId,e.next=3,this.getIndexHash(t);case 3:if(n=e.sent,console.log("hash returned = "+n),void 0!==n){e.next=8;break}return e.abrupt("return",void 0);case 8:return e.next=10,Gt.a.getJson(n);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getAllForField",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;if(void 0===this.index)return[];var r=this.index[e][e].map(function(e,t){return{value:e.dimension,rank:t}});return this.sort(r),r.length<t+n?r.slice(t):r.slice(t,t+n)}},{key:"getFieldsForField",value:function(e,t,n){if(void 0===this.index)return new Set([]);var r=this.index[t][e].filter(function(e){return e.dimension==n});if(0==r.length)return new Set([]);if(void 0===r[0].values)return new Set;var a=Object(M.a)(r[0].values).map(function(e,t){return{value:e,rank:t}});return this.sort(a),new Set(a)}},{key:"freeTextSearch",value:function(e,t){console.log("freeTextSearch("+e+" ,"+t+")"),console.log(this.fullIndex);var n=this.getAllForField(e,0,5e3);return n=n.filter(function(e){return e.value.toString().toLowerCase().includes(t.toLowerCase())}).map(function(e,t){return{value:e.value,rank:e.rank}})}},{key:"sort",value:function(e){return e.sort(function(e,t){return e=e.value,t=t.value,void 0===e[0]?1:void 0===t[0]?-1:e[0]===e[0].toLocaleLowerCase()&&t[0]===t[0].toLocaleLowerCase()||e[0]===e[0].toLocaleUpperCase()&&t[0]===t[0].toLocaleUpperCase()?e.localeCompare(t):e[0]===e[0].toLocaleLowerCase()?-1:1})}},{key:"getIndexHash",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in xn)){e.next=4;break}return e.next=3,xn[t];case 3:return e.abrupt("return",e.sent);case 4:return n=new Promise(function(){var e=Object(R.a)(N.a.mark(function e(n,r){var a,i,s;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new _t.a(jn.contractAddress).from(Jt.n).select("indexHash").where("guildId",t).limit(1),e.next=3,a.executeQuery();case 3:if(0!==(i=e.sent).length){e.next=7;break}return n(void 0),e.abrupt("return");case 7:s=i[0].indexHash,n(s);case 9:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),xn[t]=n,e.next=8,n;case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"index",get:function(){return this.useMonth?void 0===this.monthlyIndex?this.fullIndex:this.monthlyIndex.index:this.fullIndex}},{key:"toBlock",get:function(){return this.monthlyIndex.toBlock}},{key:"fromBlock",get:function(){return this.monthlyIndex.fromBlock}}]),e}(),Nn=function(){function e(t,n){Object(o.a)(this,e),this.sampler=t,this.sliceNumber=n}return Object(c.a)(e,[{key:"start",get:function(){return this.sampler.getStartTime(this.sliceNumber)},set:function(e){this.sampler.slice(this.sliceNumber,e,this.end)}},{key:"end",get:function(){return this.sampler.getEndTime(this.sliceNumber)},set:function(e){this.sampler.slice(this.sliceNumber,this.start,e)}}]),e}();function Rn(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.cursor.step;return e.getSelectedTrack().getEasyPattern().getStepsAtStepNumber(e.cursor.step).map(function(e){return e.step})}var Dn=n(56),qn=["hi-hat","snare","kick","crash","ride","breaks","sherman","ambient","sub","rim","side-stick","sidestick","clap","piano","guitar","rimshot","percussion"],Mn=function(){function e(t,n){Object(o.a)(this,e),this.sample=t,this.sequencerEngine=n,this.searcher=new vn(n.ethereumCache,n),this.nextSounds=[],this.previousSounds=[],this.counter=0}return Object(c.a)(e,[{key:"getCopy",value:function(t){var n=new e(t,this.sequencerEngine);return n.searcher=this.searcher,this.sounds&&(n.sounds=Qt(Object(M.a)(this.sounds))),n.initBuffers(),n}},{key:"hasNext",value:function(){return void 0===this.sounds||this.nextSounds.length>0}},{key:"hasPrevious",value:function(){return void 0===this.sounds||this.previousSounds.length>0}},{key:"dispose",value:function(){this.nextSounds.forEach(function(e){return e.dispose(!0)}),this.previousSounds.forEach(function(e){return e.dispose(!0)}),this.sounds=void 0,this.nextSounds=void 0,this.previousSounds=void 0,this.sample&&(this.sample.dispose(!0),this.sample=void 0),this.searcher=void 0}},{key:"search",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r,a,i,s=this;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sample.fetchTags();case 2:return t=e.sent,this.searcher.selectedTags=t,e.next=6,this.searcher.getSounds();case 6:n=e.sent;case 7:return e.next=9,n.getNext();case 9:if(!e.sent){e.next=12;break}e.next=7;break;case 12:this.sounds=n.getResults().sounds,e.t0=N.a.keys(t);case 14:if((e.t1=e.t0()).done){e.next=31;break}if(r=e.t1.value,a=t[r],!(qn.indexOf(a)>-1)){e.next=29;break}return this.searcher.selectedTags=[a],e.next=21,this.searcher.getSounds();case 21:i=e.sent;case 22:return e.next=24,i.getNext();case 24:if(!e.sent){e.next=27;break}e.next=22;break;case 27:this.sounds=this.sounds.concat(i.getResults().sounds).filter(function(e){return e!==s.sample.getId()}),this.sounds=Array.from(new Set(this.sounds));case 29:e.next=14;break;case 31:this.counter=0,this.initBuffers();case 33:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"initBuffers",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r,a;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.sounds){e.next=2;break}return e.abrupt("return");case 2:this.loading=!0,this.sounds.length,t=0;case 5:if(!(this.nextSounds.length<2)){e.next=24;break}return e.prev=6,e.next=9,this.loadNextForInitialBuffer(t);case 9:n=e.sent,r=n.next,a=n.previous,this.nextSounds.push(r),this.previousSounds.push(a),e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(6),!(t>=10)){e.next=20;break}return e.abrupt("break",24);case 20:console.log("timed out loading next and previous...");case 21:t++,e.next=5;break;case 24:this.loading=!1;case 25:case"end":return e.stop()}},e,this,[[6,16]])}));return function(){return e.apply(this,arguments)}}()},{key:"loadNextForInitialBuffer",value:function(e){var t=this;return new Promise(function(){var n=Object(R.a)(N.a.mark(function n(r,a){var i,s,o,c,u;return N.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return setTimeout(function(){a()},1500),n.prev=1,i=t.sounds.length,s=(t.counter+e)%i,o=t.sounds[s],c=new Dn.a(o),n.next=8,c.load();case 8:return s=((t.counter-e-1)%i+i)%i,o=t.sounds[s],u=new Dn.a(o),n.next=13,u.load().catch(a);case 13:r({next:c,previous:u}),n.next=19;break;case 16:n.prev=16,n.t0=n.catch(1),a();case 19:case"end":return n.stop()}},n,null,[[1,16]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"sleep",value:function(e){return new Promise(function(){var t=Object(R.a)(N.a.mark(function t(n,r){return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:setTimeout(function(){return n()},e);case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getNext",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n=this;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.sounds){e.next=3;break}return e.next=3,this.search();case 3:if(!this.loading){e.next=8;break}return e.next=6,this.sleep(50);case 6:e.next=3;break;case 8:return t=this.nextSounds.shift(),setTimeout(function(){n.loadNext(t)},100),e.abrupt("return",t);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getPrevious",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.sounds){e.next=3;break}return e.next=3,this.search();case 3:if(!this.loading){e.next=8;break}return e.next=6,this.sleep(50);case 6:e.next=3;break;case 8:return t=this.previousSounds.shift(),this.loadPrevious(t),e.abrupt("return",t);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loadNext",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r,a,i,s=this;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("load next called"),n=!1,setTimeout(function(){n||(s.loading=!1)},1500),this.loading=!0,(r=this.previousSounds.pop())&&r.dispose(!0),this.previousSounds=[this.sample].concat(Object(M.a)(this.previousSounds)),this.sample=t,!0,a=void 0,i=0;case 11:if(void 0!==a){e.next=28;break}return e.prev=12,e.next=15,this.loadNextAvailableSample();case 15:a=e.sent,e.next=25;break;case 18:if(e.prev=18,e.t0=e.catch(12),!(i>=10)){e.next=24;break}return this.loading=!1,n=!0,e.abrupt("return");case 24:console.log("retrying");case 25:i++,e.next=11;break;case 28:this.nextSounds.push(a),this.loading=!1,n=!0;case 31:case"end":return e.stop()}},e,this,[[12,18]])}));return function(t){return e.apply(this,arguments)}}()},{key:"loadNextAvailableSample",value:function(){var e=this;return new Promise(function(){var t=Object(R.a)(N.a.mark(function t(n,r){var a,i,s;return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.counter=(e.counter+1)%e.sounds.length,a=(e.counter+2)%e.sounds.length,i=e.sounds[a],s=new Dn.a(i),setTimeout(function(){r()},1500),t.prev=5,t.next=8,s.load();case 8:n(s),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(5),r();case 14:case"end":return t.stop()}},t,null,[[5,11]])}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"loadPrevious",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r,a,i;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,(n=this.nextSounds.pop())&&n.dispose(!0),this.nextSounds=[this.sample].concat(Object(M.a)(this.nextSounds)),this.sample=t,this.counter=this.mod(this.counter-1,this.sounds.length),r=this.mod(this.counter-2,this.sounds.length),a=this.sounds[r],i=new Dn.a(a),e.next=11,i.load();case 11:this.previousSounds.push(i),this.loading=!1;case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"mod",value:function(e,t){return(e%t+t)%t}}]),e}(),An=n(34);function In(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ln=function(e){Object(u.a)(n,e);var t=In(n);function n(e,r,a){var i,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object(o.a)(this,n),(i=t.call(this,e,r,a,s)).hasAudioParamSetter=!0,i.setAudioParam(r),i}return Object(c.a)(n,[{key:"fromJson",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=void 0!==t?t.currentSubSequence||t.subSequences[0]:void 0;if(void 0===e.id||r||(this.id=e.id),void 0!==e.lfos&&e.lfos.length>0&&void 0!==a&&e.lfos.forEach(function(e){return n.connectToLFO(a.lfos[e].lfo)}),void 0!==e.envelopes&&e.envelopes.length>0&&void 0!==a&&e.envelopes.forEach(function(e){return n.connectToEnvelope(a.envelopes[e])}),void 0!==e.value&&this.set(e.value),void 0!==e.patternToValue&&(this.unlockedValue=De(e.unlockedValue),this.patternToValue=Re(e.patternToValue),this.isPatternLocked()&&void 0!==this.patternToValue[0]?this.set(this.patternToValue[0]):this.set(this.unlockedValue)),e.patternToAutomation){for(var i in e.patternToAutomation)this.patternToAutomation[i]=new H(this),this.patternToAutomation[i].fromJson(e.patternToAutomation[i]);this.unlockedAutomation.fromJson(e.unlockedAutomation)}this.loadModsFromJson(e)}},{key:"disconnectFromLFO",value:function(e){Object(q.a)(Object(p.a)(n.prototype),"disconnectFromLFO",this).call(this,e,!1),this.set(this.value)}}]),n}(Be),Fn=function(e){Object(u.a)(n,e);var t=In(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.01;return Object(o.a)(this,n),(a=t.call(this,e,r,function(e,t){window.sequencerEngine&&window.sequencerEngine.playing?e.linearRampToValueAtTime(t,x.a.Master.context.currentTime+s):e.value=t},i)).hasAudioParamSetter=!1,a}return n}(Ln),Bn=function(e){Object(u.a)(n,e);var t=In(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Object(o.a)(this,n),i.unit="%",(a=t.call(this,e,r,i)).hasAudioParamSetter=!1,a}return n}(Fn);function Hn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Vn=function(){function e(t,n,r){var a=this;Object(o.a)(this,e),this.sequencerEngine=r,this.store=r.store,this.name=t,this.id=Object(A.uuid)(),this.effectFn=n,this.enabledParameter=new Be("Enabled",this,function(e,t){a.toggle(t)},{min:0,max:1,unit:"boolean",defaultValue:!0}),this.effectNode=n(),this.enabled=!1,this.toggledValue=0,this.value=0,this.connected=0,this.wetParameter=void 0!==this.effectNode.wet?new Bn("Wet",this.effectNode.wet,{defaultValue:0}):void 0,this.parameters=[],this.registerParameter(this.wetParameter),this.track=void 0,this.group=void 0,this.setWet(0)}return Object(c.a)(e,[{key:"makePublicIfNeeded",value:function(){}},{key:"getParameters",value:function(){return this.parameters}},{key:"isMidiEffect",value:function(){return!1}},{key:"registerContext",value:function(e,t){var n=this;this.context?this.context.combineWith(e):this.context=e.getCopy(),t?(this.context.forSubDevice(this),this.context.forEffect(t)):this.context.forEffect(this),this.parameters.forEach(function(e){return e.setContext(n.context)})}},{key:"registerMixSession",value:function(e){this.parameters.forEach(function(t){return t.setMixSession(e)})}},{key:"registerParameter",value:function(e){void 0!==e&&(e.name=e.name,e.effectName=this.name,e.setStore(this.store),this.parameters.push(e))}},{key:"connect",value:function(e){this.effectNode.connect(e)}},{key:"syncable",value:function(){return!1}},{key:"disconnect",value:function(e){this.effectNode.disconnect(e)}},{key:"isEnabled",value:function(){return this.enabledParameter.get()}},{key:"enable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.enabledParameter.set(e)}},{key:"toggleEnabled",value:function(){this.enabledParameter.set(!this.enabledParameter.get())}},{key:"toggle",value:function(e){}},{key:"setValue",value:function(e){this.value=e,"wet"in this.effectNode&&this.wetParameter.set(e)}},{key:"setWet",value:function(e){"wet"in this.effectNode&&this.wetParameter.set(e)}},{key:"getWet",value:function(){return this.wetParameter.value}},{key:"getName",value:function(){return this.name}},{key:"getEffect",value:function(){return this.effectNode}},{key:"getEffectCopy",value:function(){var t=new e(this.name,this.effectFn,this.sequencerEngine);return this.wetParameter&&t.setWet(this.wetParameter.get()),t.enable(this.enabledParameter.get()),t}},{key:"fromJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return void 0===e.id||t&&"boolean"===typeof t||(this.id=e.id),void 0!==e.enabled&&this.enable(e.enabled),void 0!==this.wetParameter&&(void 0!==e.wet&&(this.wetParameter.set(e.wet),this.effectNode.wet&&(this.effectNode.wet.value=e.wet)),this.loadParameterFromJson(e,"wetParameter",this.wetParameter,t)),this}},{key:"saveParameterToJson",value:function(e,t,n){if(n.isConnectedToAnyModulator()||Object.keys(n.patternToValue).length>0||n.automations.length>=0||n.hasMacro){var r=Object(D.a)({},e);return r[t]=n.getJson(),r}return e}},{key:"loadParameterFromJson",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];r="boolean"===typeof r&&r,t in e&&n.fromJson(e[t],this.sequencerEngine,r)}},{key:"getJson",value:function(){var e={name:this.name,enabled:this.enabledParameter.get(),id:this.id};return void 0!==this.wetParameter&&(e.wet=this.wetParameter.get(),e.value=this.wetParameter.get(),e=this.saveParameterToJson(e,"wetParameter",this.wetParameter)),e}},{key:"dispose",value:function(){this.effectNode.dispose(),this.effectNode=void 0,this.parameters.forEach(function(e){return e.dispose()}),this.parameters=void 0}},{key:"wet",set:function(e){this.wetParameter&&this.wetParameter.set(e)}}]),e}(),Un=function(e){Object(u.a)(n,e);var t=Hn(n);function n(e,r){var a;Object(o.a)(this,n),a=t.call(this,"Filter",function(){return new x.a.Filter(80,"lowpass",-24)},e);var i={min:0,max:1e4,unit:"HZ",defaultValue:80};return r&&(i.automationRate=r),a.cutoffParameter=new Fn("Cutoff",a.effectNode.frequency,i),a.qParameter=new Fn("Q",a.effectNode.Q,{min:0,max:20,unit:"",defaultValue:1}),a.typeParameter=new Be("type",Object(W.a)(a),function(e,t){return a.effectNode.type=t},{min:"lowpass",max:"highpass",unit:"",defaultValue:"lowpass"}),a.registerParameter(a.cutoffParameter),a.registerParameter(a.typeParameter),a.registerParameter(a.qParameter),a}return Object(c.a)(n,[{key:"connect",value:function(e){Object(q.a)(Object(p.a)(n.prototype),"connect",this).call(this,e)}},{key:"syncable",value:function(){return!1}},{key:"toggle",value:function(e){}},{key:"setValue",value:function(e){this.value=e,e=5e3*e+50,this.effectNode.frequency.value=e}},{key:"setFrequency",value:function(e){try{this.cutoffParameter.set(e)}catch(t){}}},{key:"setQ",value:function(e){this.qParameter.set(e)}},{key:"lowpass",value:function(){this.type="lowpass"}},{key:"hipass",value:function(){this.type="highpass"}},{key:"getFrequency",value:function(){return this.effectNode.frequency.value}},{key:"getQ",value:function(){return this.effectNode.Q.value}},{key:"getJson",value:function(){var e=Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),frequency:this.effectNode.frequency.value,q:this.effectNode.Q.value,type:this.effectNode.type});return e=this.saveParameterToJson(e,"cutoffParameter",this.cutoffParameter),e=this.saveParameterToJson(e,"qParameter",this.qParameter),e=this.saveParameterToJson(e,"typeParameter",this.typeParameter)}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),this.enable(e.enabled),this.qParameter.set(e.q),this.cutoffParameter.set(e.frequency),this.typeParameter.set(e.type),this.loadParameterFromJson(e,"qParameter",this.qParameter,t),this.loadParameterFromJson(e,"cutoffParameter",this.cutoffParameter,t),this.loadParameterFromJson(e,"typeParameter",this.typeParameter,t)}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}},{key:"cutoffFrequency",get:function(){return this.cutoffParameter.get()},set:function(e){this.cutoffParameter.set(e)}},{key:"Q",set:function(e){this.qParameter.set(e)}},{key:"type",set:function(e){this.typeParameter.set(e)},get:function(){return this.typeParameter.get()}}]),n}(Vn),Jn=function(e){Object(u.a)(n,e);var t=Hn(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Auto Filter",function(){return new x.a.AutoFilter(4*new x.a.Time("1m"))},e)).qParameter=new Fn("Q",r.effectNode.filter.Q,{min:0,max:20,unit:"",defaultValue:1}),r.registerParameter(r.qParameter),r.effectNode.start(),r.effectNode.wet.value=1,r.storedLFOTime=4*new x.a.Time("1m"),r}return Object(c.a)(n,[{key:"syncable",value:function(){return!0}},{key:"start",value:function(){this.effectNode.start()}},{key:"stop",value:function(){this.effectNode.stop()}},{key:"toggle",value:function(e){}},{key:"getLFOTime",value:function(){return new x.a.Time(this.effectNode.frequency.value).toNotation()}},{key:"getStoredLFOTime",value:function(){return this.storedLFOTime}},{key:"setLFOTime",value:function(e){this.storedLFOTime=e,this.effectNode.frequency.value=e}},{key:"lowpass",value:function(){this.effectNode.filter.type="lowpass"}},{key:"hipass",value:function(){this.effectNode.filter.type="highpass"}},{key:"getFilterType",value:function(){return this.effectNode.filter.type}},{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),frequency:this.effectNode.frequency.value,storedLFOTime:this.storedLFOTime,baseFrequency:this.effectNode.baseFrequency,octaves:this.effectNode.octaves,q:this.effectNode.filter.Q.value,filterType:this.effectNode.filter.type})}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),this.enable(e.enabled),this.effectNode.filter.Q.value=e.q,this.effectNode.frequency.value=e.frequency,this.effectNode.baseFrequency=e.baseFrequency,this.effectNode.octaves=e.octaves,this.storedLFOTime="storedLFOTime"in e?e.storedLFOTime:e.frequency,this.effectNode.filter.type=e.filterType}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),n}(Vn),_n=function(e){Object(u.a)(n,e);var t=Hn(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Pan",function(){return new x.a.Panner},e)).panParameter=new Be("Panning",r.effectNode.pan,function(e,t){return e.value=t},{min:-1,max:1,unit:"",defaultValue:0}),r.registerParameter(r.panParameter),r}return Object(c.a)(n,[{key:"toggle",value:function(e){}},{key:"setValue",value:function(e){this.value=e,this.panParameter.normalizedSet(e)}},{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),value:this.value})}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t);var r=new n;return r.setValue(this.value),r}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),n}(Vn),Gn=function(e){Object(u.a)(n,e);var t=Hn(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Reverb",function(){return new x.a.Freeverb},e)).roomSizeParameter=new Bn("Room Size",r.effectNode.roomSize),r.registerParameter(r.roomSizeParameter),r.dampeningParameter=new Ln("Dampening",r.effectNode.dampening,function(e,t){return e.value=t},{min:0,max:1e4}),r.registerParameter(r.dampeningParameter),r}return Object(c.a)(n,[{key:"setRoomSize",value:function(e){this.roomSizeParameter.set(e)}},{key:"setDampening",value:function(e){this.dampening.set(e)}},{key:"getDampening",value:function(){return this.effectNode.dampening.value}},{key:"getRoomSize",value:function(){return this.effectNode.roomSize.value}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}},{key:"getJson",value:function(){var e=Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),roomSize:this.roomSizeParameter.get(),wet:this.wetParameter.get(),dampening:this.dampeningParameter.get()});return(this.roomSizeParameter.isConnectedToAnyModulator()||Object.keys(this.roomSizeParameter.patternToValue).length>0)&&(e.roomSizeParameter=this.roomSizeParameter.getJson()),(this.dampeningParameter.isConnectedToAnyModulator()||Object.keys(this.dampeningParameter.patternToValue).length>0)&&(e.dampeningParameter=this.dampeningParameter.getJson()),e}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),this.name=e.name,this.enable(e.enabled),"roomSize"in e&&this.roomSizeParameter.set(e.roomSize),"wet"in e&&this.wetParameter.set(e.wet),"dampening"in e&&this.dampeningParameter.set(e.dampening),this.loadParameterFromJson(e,"roomSizeParameter",this.roomSizeParameter,t),this.loadParameterFromJson(e,"dampeningParameter",this.dampeningParameter,t)}}]),n}(Vn),zn=function(e){Object(u.a)(n,e);var t=Hn(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Tremolo",function(){return new x.a.Tremolo},e)).effectNode.start(),r.rateParameter=new Ln("Rate",r.effectNode.frequency,function(e,t){return e.value=t},{min:0,max:32,defaultValue:0}),r.spreadParameter=new Ln("Spread",r.effectNode,function(e,t){return e.spread=t},{min:0,max:360,defaultValue:180}),r.depthParameter=new Bn("Depth",r.effectNode.depth),r.registerParameter(r.depthParameter),r.registerParameter(r.rateParameter),r.registerParameter(r.spreadParameter),r}return Object(c.a)(n,[{key:"setRate",value:function(e){this.effectNode.frequency.value=e}},{key:"setDepth",value:function(e){this.effectNode.depth.value=e}},{key:"getRate",value:function(){return this.effectNode.frequency.value}},{key:"getDepth",value:function(){return this.effectNode.depth.value}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}},{key:"getJson",value:function(){var e=Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),depth:this.depthParameter.get(),spread:this.spreadParameter.get(),rate:this.rateParameter.get()});return(this.depthParameter.isConnectedToAnyModulator()||Object.keys(this.depthParameter.patternToValue).length>0)&&(e.depthParameter=this.depthParameter.getJson()),(this.spreadParameter.isConnectedToAnyModulator()||Object.keys(this.spreadParameter.patternToValue).length>0)&&(e.spreadParameter=this.spreadParameter.getJson()),(this.rateParameter.isConnectedToAnyModulator()||Object.keys(this.rateParameter.patternToValue).length>0)&&(e.rateParameter=this.rateParameter.getJson()),e}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),this.name=e.name,this.enable(e.enabled),this.depthParameter.set(void 0!==e.depth?e.depth:1),this.spreadParameter.set(void 0!==e.spread?e.spread:180),this.wetParameter.set(void 0!==e.wet?e.wet:1),this.rateParameter.set(void 0!==e.rate?e.rate:1),this.loadParameterFromJson(e,"depthParameter",this.depthParameter,t),this.loadParameterFromJson(e,"spreadParameter",this.spreadParameter,t),this.loadParameterFromJson(e,"rateParameter",this.rateParameter,t)}}]),n}(Vn),Wn=function(e){Object(u.a)(n,e);var t=Hn(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Chorus",function(){return new x.a.Chorus},e)).rateParameter=new Ln("Rate",r.effectNode.frequency,function(e,t){return e.value=t},{min:0,max:32,defaultValue:4}),r.registerParameter(r.rateParameter),r.depthParameter=new Ln("Depth",r.effectNode,function(e,t){return e.depth=t},{min:0,max:100,unit:"%",defaultValue:.5}),r.registerParameter(r.depthParameter),r}return Object(c.a)(n,[{key:"setRate",value:function(e){this.effectNode.frequency.value=e}},{key:"setDepth",value:function(e){this.effectNode.depth=e}},{key:"getRate",value:function(){return this.effectNode.frequency.value}},{key:"getDepth",value:function(){return this.effectNode.depth}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}},{key:"getJson",value:function(){var e=Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),depth:this.depthParameter.get(),rate:this.rateParameter.get()});return e=this.saveParameterToJson(e,"depthParameter",this.depthParameter),e=this.saveParameterToJson(e,"rateParameter",this.rateParameter)}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),this.name=e.name,this.enable(e.enabled),this.wetParameter.set(e.wet),this.depthParameter.set(e.depth),this.rateParameter.set(e.rate),this.loadParameterFromJson(e,"rateParameter",this.rateParameter,t),this.loadParameterFromJson(e,"depthParameter",this.depthParameter,t)}}]),n}(Vn),Kn=function(e){Object(u.a)(n,e);var t=Hn(n);function n(e){var r;Object(o.a)(this,n),r=t.call(this,e);for(var a=[],i=0;i<e.effects.length;i++)a.push(e.effects[i].value);return r.state={effectsValues:a},r.setState(r.state),r}return Object(c.a)(n,[{key:"onChangeValue",value:function(e,t){this.state.effectsValues[e]=t;var n=parseFloat(t)/30;this.props.effects[e].setValue(n),this.setState(this.state)}},{key:"toggleEffect",value:function(e){e.toggle(),this.props.onEffectsChange(),this.setState(this.state)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",null,this.props.effects.map(function(t,n){return a.a.createElement(Qn,{key:n,name:t.getName(),disabled:!t.isEnabled(),onClickToggle:function(){return e.toggleEffect(t)},value:30*t.value,onChangeValue:function(t){return e.onChangeValue(n,t)}})}))}}]),n}(r.Component),Qn=function(e){Object(u.a)(n,e);var t=Hn(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"effect-knob-container"},a.a.createElement(xt.a,{value:this.props.value,change:function(t){return e.props.onChangeValue(t.target.value)},step:this.state.step,max:30,min:0,orientation:"vertical",disabled:this.props.disabled?"disabled":"",reversed:!0}),a.a.createElement("div",Object(An.a)({className:this.props.disabled?"disabled":"",onClick:this.props.onClickToggle},"className","effect-label"),this.props.name))}}]),n}(r.Component),Xn={ReverbEffect:Gn,FilterEffect:Un,TremoloEffect:zn,AutoFilterEffect:Jn,ChorusEffect:Wn,TrackEffects:Kn,PanEffect:_n,Effect:Vn};function Yn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Zn=function(e){Object(u.a)(n,e);var t=Yn(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Delay",function(){return new x.a.FeedbackDelay(new x.a.Time("16n"),.5)},e)).delayTime="16n",r.rateParameter=new Ln("Delay Rate",r.effectNode.delayTime,function(e,t){r.rawDelayRate=t,"number"===typeof t&&(t/=1e3),t._val&&(t="object"==typeof t._val?new x.a.Time(t._val._val):new x.a.Time(t._val)),r.effectNode.delayTime.linearRampToValueAtTime(new x.a.Time(t),.001)},{min:1e-4,max:1,unit:"",defaultValue:new x.a.Time("8n")}),r.rawDelayRate="8n",r.isSynced=!0,r.registerParameter(r.rateParameter),r.feedbackParameter=new Bn("Feedback",r.effectNode.feedback),r.registerParameter(r.feedbackParameter),r}return Object(c.a)(n,[{key:"setFeedback",value:function(e){this.feedbackParameter.set(e)}},{key:"getFeedback",value:function(){return this.effectNode.feedback.value}},{key:"onBPMUpdated",value:function(){this.isSynced&&this.rateParameter.set(this.rawDelayRate,!0)}},{key:"getDelayTime",value:function(){return this.delayTime}},{key:"getJson",value:function(){var e=this.rate;"object"===typeof e&&e.toSeconds&&(e=this.rate.toSeconds());var t=Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),feedback:this.effectNode.feedback.value,isSynced:this.isSynced,rate:e,rawDelayRate:this.rawDelayRate});return t=this.saveParameterToJson(t,"feedbackParameter",this.feedbackParameter),t=this.saveParameterToJson(t,"rateParameter",this.rateParameter)}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),"feedback"in e&&this.feedbackParameter.set(e.feedback),"delayTime"in e&&(this.rate=e.delayTime),"rate"in e&&(this.rate=e.rate),"rawDelayRate"in e&&(this.rawDelayRate=e.rawDelayRate),"isSynced"in e&&(this.isSynced=e.isSynced),this.loadParameterFromJson(e,"feedbackParameter",this.feedbackParameter,t),this.loadParameterFromJson(e,"rateParameter",this.rateParameter,t)}},{key:"rate",set:function(e){this.rateParameter.set(e)},get:function(){return this.rateParameter.get()}}]),n}(Xn.Effect);function $n(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var er=function(e){Object(u.a)(n,e);var t=$n(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Auto Wah",function(){return new x.a.AutoWah(50,6,-30)},e)).effectNode.gain.value=6,r.baseFrequencyParameter=new Be("Base Frequency",r.effectNode,function(e,t){return e.baseFrequency=t},{min:0,max:1e4,unit:"hz",defaultValue:400}),r.registerParameter(r.baseFrequencyParameter),r.octaveParameter=new Be("Octaves",r.effectNode,function(e,t){return e.octaves=t},{min:0,max:10,unit:"",defaultValue:1}),r.registerParameter(r.octaveParameter),r.qParameter=new Ve("Q",r.effectNode.Q,{min:0,max:10,unit:"",defaultValue:0}),r.registerParameter(r.qParameter),r.sensitivityParameter=new Be("Sensitivity",r.effectNode,function(e,t){return e.sensitivity=t},{min:-12,max:6,unit:"db",defaultValue:0}),r.registerParameter(r.sensitivityParameter),r.attackParameter=new Be("Attack",r.effectNode,function(e,t){return e.follower.attack=t},{min:0,max:2,unit:"",defaultValue:0}),r.registerParameter(r.attackParameter),r.releaseParameter=new Be("Release",r.effectNode,function(e,t){return e.follower.release=t},{min:0,max:2,unit:"",defaultValue:0}),r.registerParameter(r.releaseParameter),r}return Object(c.a)(n,[{key:"getJson",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this);return e.name=this.name,e.baseFrequency=this.baseFrequencyParameter.get(),e.octave=this.octaveParameter.get(),e.q=this.qParameter.get(),e.sensitivity=this.sensitivityParameter.get(),e.attack=this.attackParameter.get(),e.release=this.releaseParameter.get(),e.wet=this.wetParameter.get(),e}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),"baseFrequency"in e&&this.baseFrequencyParameter.set(e.baseFrequency),"octave"in e&&this.octaveParameter.set(e.octave),"sensitivity"in e&&this.sensitivityParameter.set(e.sensitivity),"q"in e&&this.qParameter.set(e.q),"attack"in e&&this.attackParameter.set(e.attack),"release"in e&&this.releaseParameter.set(e.release),e.enabled&&this.enable(!0),"wet"in e&&this.setValue(e.wet)}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),n}(Xn.Effect);function tr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}Xn.Effect;function nr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var rr=function(e){Object(u.a)(n,e);var t=nr(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Stereo Widener",function(){return new x.a.StereoWidener(.5)},e)).widthParameter=new Fn("Width",r.effectNode.width,{min:0,max:1,defaultValue:.5}),r.registerParameter(r.widthParameter),r}return Object(c.a)(n,[{key:"getJson",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this);return e.width=this.widthParameter.get(),e=this.saveParameterToJson(e,"widthParameter",this.widthParameter)}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),this.widthParameter.set(e.width),this.loadParameterFromJson(e,"widthParameter",this.widthParameter,t)}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),n}(Xn.Effect);function ar(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ir=function(e){Object(u.a)(n,e);var t=ar(n);function n(e){return Object(o.a)(this,n),t.call(this,"Oscilloscope",function(){return new x.a.Analyser({type:"waveform",size:512})},e)}return Object(c.a)(n,[{key:"getValue",value:function(){return this.effectNode.getValue()}},{key:"getEffectCopy",value:function(){return new n(this.sequencerEngine)}}]),n}(Xn.Effect);function sr(e,t,n){if(n.isConnectedToAnyModulator()||Object.keys(n.patternToValue).length>0||n.automations&&n.automations.length>0||n.hasMacro){var r=Object(D.a)({},e);return r[t]=n.getJson(),r}return e}function or(e,t,n,r,a){t in e&&n.fromJson(e[t],r,a)}function cr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ur=function(e){Object(u.a)(n,e);var t=cr(n);function n(e,r,a){return Object(o.a)(this,n),t.call(this,e,r,a)}return Object(c.a)(n,[{key:"dispose",value:function(){Object(q.a)(Object(p.a)(n.prototype),"dispose",this).call(this)}},{key:"setCompressors",value:function(e){for(var t in this.compressors=[],e)this.compressors.push(new lr(t,this.store,e[t]))}},{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{compressors:this.compressors.map(function(e){return e.getJson()})})}},{key:"fromJson",value:function(e,t){for(var r in Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),e.compressors){var a=e.compressors[r].name;this.getCompressor(a).fromJson(e.compressors[r],t)}}},{key:"getCompressor",value:function(e){return this.compressors.find(function(t){return t.name===e})}}]),n}(Xn.Effect),lr=function(){function e(t,n,r){Object(o.a)(this,e),this.name=t,this.store=n,this.compressorNode=r,this.parameters=[],this.thresholdParameter=new Fn("Threshold",this.compressorNode.threshold,{min:-80,max:8,unit:"",defaultValue:0,constantAutomationRate:!0}),this.registerParameter(this.thresholdParameter),this.ratioParameter=new Fn("Ratio",this.compressorNode.ratio,{min:1,max:24,unit:"",defaultValue:3,constantAutomationRate:!0}),this.registerParameter(this.ratioParameter),this.attackParameter=new Bn("Attack",this.compressorNode.attack,{constantAutomationRate:!0}),this.registerParameter(this.attackParameter),this.releaseParameter=new Bn("Release",this.compressorNode.release,{constantAutomationRate:!0}),this.registerParameter(this.releaseParameter),this.releaseParameter.set(.1),this.kneeParameter=new Fn("Knee",this.compressorNode.knee,{min:0,max:40,unit:"db",defaultValue:1,constantAutomationRate:!0}),this.registerParameter(this.kneeParameter)}return Object(c.a)(e,[{key:"registerParameter",value:function(e){void 0!==e&&(e.name=e.name,e.effectName=this.name,e.setStore(this.store),this.parameters.push(e))}},{key:"getJson",value:function(){var e={name:this.name,threshold:this.thresholdParameter.get(),ratio:this.ratioParameter.get(),attack:this.attackParameter.get(),release:this.releaseParameter.get()};return e=sr(e,"thresholdParameter",this.thresholdParameter),e=sr(e,"ratioParameter",this.ratioParameter),e=sr(e,"attackParameter",this.attackParameter),e=sr(e,"releaseParameter",this.releaseParameter)}},{key:"fromJson",value:function(e,t){this.thresholdParameter.set(e.threshold),this.ratioParameter.set(e.ratio),this.attackParameter.set(e.attack),this.releaseParameter.set(e.release),or(e,"thresholdParameter",this.thresholdParameter,t),or(e,"ratioParameter",this.ratioParameter,t),or(e,"attackParameter",this.attackParameter),or(e,"releaseParameter",this.releaseParameter)}}]),e}();function pr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var hr=function(e){Object(u.a)(n,e);var t=pr(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Multiband Compressor",function(){return new x.a.MultibandCompressor},e)).setCompressors({LOW:r.effectNode.low,MID:r.effectNode.mid,HIGH:r.effectNode.high}),r}return Object(c.a)(n,[{key:"dispose",value:function(){Object(q.a)(Object(p.a)(n.prototype),"dispose",this).call(this)}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),n}(ur);function fr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var dr=function(e){Object(u.a)(n,e);var t=fr(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Ultra Phaser",function(){return new x.a.Gain(1)},e)).poles=8,r.generateAllPassFilters(),r.rateParameter=new Fn("Rate",r.lfo.frequency,{defaultValue:"1n",min:0,max:1}),r.registerParameter(r.rateParameter),r.feedbackParameter=new Fn("Feedback",r.feedbackNode.gain,{defaultValue:.1,min:0,max:1}),r.registerParameter(r.feedbackParameter),r.wetParameter=new Fn("Wet",r.crossFade.fade,{defaultValue:.5,min:0,max:1}),r.registerParameter(r.wetParameter),r.depthParameter=new Ln("Depth",r.lfo._scaler._scale,function(e,t){r.lfo.max=t},{min:0,max:1,unit:"",defaultValue:.5,automatable:!1}),r.registerParameter(r.depthParameter),r}return Object(c.a)(n,[{key:"generateAllPassFilters",value:function(){var e=this;this.filters=[],this.scalers=[];for(var t=100,n=0;n<this.poles;n++){var r=new x.a.Filter(t,"allpass");this.filters.push(r);var a=new x.a.Scale(t,t+4e3);a.connect(r.frequency),this.scalers.push(a),t+=1e3}this.outputNode=new x.a.Gain(1),this.lfo=new x.a.LFO("1n",0,1),this.filters.forEach(function(t,n){return e.lfo.connect(e.scalers[n])});var i=this.effectNode;for(var s in this.filters)i.connect(this.filters[s]),i=this.filters[s];this.lfo.start(),this.crossFade=new x.a.CrossFade(0),this.crossFade.connect(this.outputNode),this.effectNode.connect(this.crossFade,0,0),i.connect(this.crossFade,0,1),this.feedbackNode=new x.a.Gain(.2),i.connect(this.feedbackNode),this.feedbackNode.connect(this.filters[0])}},{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}},{key:"getJson",value:function(){var e=Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{rate:this.rateParameter.get(),feedback:this.feedbackParameter.get(),wet:this.wetParameter.get(),depth:this.depthParameter.get()});return e=this.saveParameterToJson(e,"rateParameter",this.rateParameter),e=this.saveParameterToJson(e,"feedbackParameter",this.feedbackParameter),e=this.saveParameterToJson(e,"wetParameter",this.wetParameter),e=this.saveParameterToJson(e,"depthParameter",this.depthParameter)}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),this.rateParameter.set(e.rate),this.feedbackParameter.set(e.feedback),this.wetParameter.set(e.wet),this.depthParameter.set(e.depth),this.loadParameterFromJson(e,"rateParameter",this.rateParameter,t),this.loadParameterFromJson(e,"feedbackParameter",this.feedbackParameter,t),this.loadParameterFromJson(e,"wetParameter",this.wetParameter,t),this.loadParameterFromJson(e,"depthParameter",this.depthParameter,t)}}]),n}(Xn.Effect),mr="/convolver/PrimeXtraLong.wav",vr=new(function(){function e(){Object(o.a)(this,e),console.log("tone ",x.a),this.DEFAULT_BUFFER=new x.a.Buffer(window.installation?"/public"+mr:mr)}return Object(c.a)(e,[{key:"setSampleRate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"interactive";console.log("setSampleRate =",e),44100!==e&&(x.a.setContext(new AudioContext({sampleRate:e,latencyHint:t})),window.context=x.a.Master.context,console.log(x.a.Master.context),this.DEFAULT_BUFFER=new x.a.Buffer(window.installation?"/public"+mr:mr))}}]),e}()),gr=(n(281),n(248));function yr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}x.a.Frequency("C3");var br={Hangar:"/convolverHangar.wav","Giant Cave":"/convolver/GiantCave.wav","Airport Terminal":"/convolver/AirportTerminal.wav","Outdoor Blastoff":"/convolver/OutdoorBlastOff.wav","Outdoor Stadium":"/convolver/OutdoorStadium.wav","Plate Large":"/convolver/PlateLarge.wav","Plate Medium":"/convolver/PlateMedium.wav","Plate Small":"/convolver/PlateSmall.wav","Plate Super Dry":"/convolver/PlateSuperDry.wav","Prime Long":"/convolver/PrimeLong.wav","Prime Medium":"/convolver/PrimeMed.wav","Prime Short":"/convolver/PrimeShort.wav","Prime Extra Long":"/convolver/PrimeXtraLong.wav","Room Concert Hall":"/convolver/RoomConcertHall.wav","Room Huge":"/convolver/RoomHuge.wav","Room Large":"/convolver/RoomLarge.wav","Room Medium":"/convolver/RoomMedium.wav","Room Pool":"/convolver/RoomPool.wav"},kr=function(e){Object(u.a)(n,e);var t=yr(n);function n(e){var r;return Object(o.a)(this,n),r=t.call(this,"Convolver Reverb",function(){return new x.a.Convolver(vr.DEFAULT_BUFFER)},e),console.log("THIS convovler = ",Object(W.a)(r)),r.rawBuffer=new x.a.Buffer(vr.DEFAULT_BUFFER),r.convolverType="Prime Extra Long",r.convolverSample=void 0,r.pitchParameter=new Be("Pitch",Object(W.a)(r),function(e,t){return r.pitch=t},{automatable:!1}),r.durationParameter=new Be("duration",Object(W.a)(r),function(e,t){return r.release=t},{defaultValue:100,automatable:!1}),r.attackParameter=new Be("attack",Object(W.a)(r),function(e,t){return r.attack=t},{defaultValue:0,automatable:!1}),r.registerParameter(r.attackParameter),r.registerParameter(r.pitchParameter),r.registerParameter(r.durationParameter),r}return Object(c.a)(n,[{key:"renderBuffer",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r,a,i,s,o,c,u;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.rawBuffer&&null!==this.rawBuffer){e.next=2;break}return e.abrupt("return");case 2:return t=new x.a.Buffer(this.rawBuffer),n=t.duration*this.duration/100,r=t.duration*this.attack/100,console.log("rendering buffer with duration=%s attack=%s",this.duration,this.attack),this.sequencerEngine.hasConvolver=!0,a=x.a.Master.context.sampleRate,i=new OfflineAudioContext(2,a*n*2,a),s=i.createBufferSource(),(o=i.createGain(1)).connect(i.destination),r>0&&(o.gain.value=0,o.gain.linearRampToValueAtTime(1,r)),o.gain.linearRampToValueAtTime(0,n),s.connect(o),c=x.a.intervalToFrequencyRatio(this.pitch),s.playbackRate.value=c,s.buffer=t._buffer,s.start(0),e.next=21,i.startRendering();case 21:u=e.sent,this.effectNode&&(this.effectNode.buffer=new x.a.Buffer(u));case 23:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"sleep",value:function(e){return new Promise(function(t,n){setTimeout(function(){return t()},e)})}},{key:"setConvolverSample",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===this.encryptedIpfs&&(this.encryptedIpfs=new gr.a(this.sequencerEngine.store,this.sequencerEngine.ethereum.guilds,this.sequencerEngine.ethereum.encryption,this.sequencerEngine.ethereum.crypto)),e.next=3,this.encryptedIpfs.getSound(t);case 3:if(void 0!==(n=e.sent)){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,x.a.Master.context.decodeAudioData(n.buffer);case 8:return r=e.sent,this.convolverType=void 0,this.convolverSample=t,this.rawBuffer=r,e.next=14,this.renderBuffer();case 14:console.log("finished rendering!");case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setConvolverType",value:function(e){var t=this;return new Promise(function(n,r){if(e in br){var a=window.installation?"/public"+br[e]:br[e];t.effectNode.load(a,Object(R.a)(N.a.mark(function e(){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.rawBuffer=new x.a.Buffer(t.effectNode.buffer),e.next=3,t.renderBuffer();case 3:console.log("set convolver type finished"),n();case 5:case"end":return e.stop()}},e)}))),t.samplePitch=0,t.convolverType=e,t.convolverSample=void 0}})}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}},{key:"makePublicIfNeeded",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("convolver reverb makepublic if needed"),!this.convolverSample){e.next=16;break}return e.next=4,d.a.guildSamples.getGuildIdForSound(this.convolverSample);case 4:if(t=e.sent,console.log("guild for convollver reverb",t),0===t){e.next=16;break}return n=new Dn.a(this.convolverSample),e.next=10,n.load();case 10:return console.log("got sound=",n),e.next=13,d.a.guildSamples.saveSample(n);case 13:r=e.sent,console.log("replacing id with id=",r),this.convolverSample=r;case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),convolverType:this.convolverType,convolverSample:this.convolverSample,pitch:this.pitch,attack:this.attack,duration:this.duration})}},{key:"fromJson",value:function(){var e=Object(R.a)(N.a.mark(function e(t,r){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,t,r),void 0===t.convolverType){e.next=7;break}if("Prime Extra Long"===t.convolverType){e.next=5;break}return e.next=5,this.setConvolverType(t.convolverType);case 5:e.next=12;break;case 7:if(void 0===t.convolverSample){e.next=12;break}return e.next=10,this.sleep(250);case 10:return e.next=12,this.setConvolverSample(t.convolverSample,t);case 12:if(!("pitch"in t)){e.next=17;break}if(this.pitchParameter.set(t.pitch),0===t.pitch){e.next=17;break}return e.next=17,this.sleep(200);case 17:if(!("duration"in t)){e.next=22;break}if(this.durationParameter.set(t.duration),100===t.duration){e.next=22;break}return e.next=22,this.sleep(200);case 22:"attack"in t&&this.attackParameter.set(t.attack);case 23:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"release",set:function(e){100!==e&&this.renderBuffer()}},{key:"attack",set:function(e){0!==e&&this.renderBuffer()},get:function(){return this.attackParameter.get()}},{key:"pitch",set:function(e){0!==e?this.renderBuffer():this.effectNode&&(this.effectNode.buffer=this.rawBuffer)},get:function(){return this.pitchParameter.get()}},{key:"duration",get:function(){return this.durationParameter.get()}}]),n}(Xn.Effect);function Er(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Or=function(e){Object(u.a)(n,e);var t=Er(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Chebyshev",function(){return new x.a.Chebyshev(1)},e)).effectNode.oversampling="none",r.orderParameter=new Ln("Order",r.effectNode,function(e,t){return e.order=t},{min:1,max:100,unit:"",defaultValue:1}),r.registerParameter(r.orderParameter),r}return Object(c.a)(n,[{key:"getJson",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this);return e.order=this.effectNode.order,e.enabled=this.enabledParameter.get(),e.wet=this.effectNode.wet.value,e.name=this.name,e=this.saveParameterToJson(e,"orderParameter",this.orderParameter)}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),this.orderParameter.set(e.order),e.enabled&&this.enable(!0),this.setValue(e.value),this.loadParameterFromJson(e,"orderParameter",this.orderParameter,t)}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),n}(Xn.Effect);function Sr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Pr=function(e){Object(u.a)(n,e);var t=Sr(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Bit Crusher",function(){return new x.a.BitCrusher(8)},e)).bitsParameter=new Ln("Bits",r.effectNode,function(e,t){return e.bits=t},{min:1,max:8,unit:"",defaultValue:8}),r.registerParameter(r.bitsParameter),r}return Object(c.a)(n,[{key:"getJson",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this);return e.bits=this.bitsParameter.get(),e.name=this.name,this.saveParameterToJson(e,"bitsParameter",this.bitsParameter)}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),this.effectNode.bits=e.bits,this.effectNode.wet.value=e.wet,e.enabled&&this.enable(!0),this.loadParameterFromJson(e,"bitsParameter",this.bitsParameter,t)}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),n}(Xn.Effect);function wr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var jr=function(e){Object(u.a)(n,e);var t=wr(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Compressor",function(){return new x.a.Gain(1)},e)).effectNode.gain.value=1,r.compressorNode=new x.a.Compressor(-24,3),r.effectNode.connect(r.compressorNode),r.gainParameter=new Fn("Gain",r.effectNode.gain,{min:0,max:2,unit:"db",defaultValue:.5}),r.registerParameter(r.gainParameter),r.thresholdParameter=new Fn("Threshold",r.compressorNode.threshold,{min:-80,max:8,unit:"",defaultValue:0,constantAutomationRate:!0}),r.registerParameter(r.thresholdParameter),r.ratioParameter=new Fn("Ratio",r.compressorNode.ratio,{min:1,max:24,unit:"",defaultValue:3,constantAutomationRate:!0}),r.registerParameter(r.ratioParameter),r.attackParameter=new Bn("Attack",r.compressorNode.attack,{constantAutomationRate:!0}),r.registerParameter(r.attackParameter),r.releaseParameter=new Bn("Release",r.compressorNode.release,{constantAutomationRate:!0}),r.registerParameter(r.releaseParameter),r.releaseParameter.set(.1),r.kneeParameter=new Fn("Knee",r.compressorNode.knee,{min:0,max:40,unit:"db",defaultValue:1,constantAutomationRate:!0}),r.registerParameter(r.kneeParameter),r}return Object(c.a)(n,[{key:"dispose",value:function(){Object(q.a)(Object(p.a)(n.prototype),"dispose",this).call(this),this.compressorNode.dispose(),this.compressorNode=void 0}},{key:"connect",value:function(e){this.connectedNode=e,this.compressorNode.connect(e)}},{key:"disconnect",value:function(e){null!=this.connectedNode&&(this.compressorNode.disconnect(e),this.connectedNode=null)}},{key:"getJson",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this);return e.name=this.name,e.gain=this.gainParameter.get(),e.threshold=this.thresholdParameter.get(),e.ratio=this.ratioParameter.get(),e.release=this.releaseParameter.get(),e.attack=this.attackParameter.get(),e.knee=this.kneeParameter.get(),e.enabled=this.enabledParameter.get(),(this.gainParameter.isConnectedToAnyModulator()||Object.keys(this.gainParameter.patternToValue).length>0)&&(e.gainParameter=this.gainParameter.getJson()),(this.thresholdParameter.isConnectedToAnyModulator()||Object.keys(this.thresholdParameter.patternToValue).length>0)&&(e.thresholdParameter=this.thresholdParameter.getJson()),(this.ratioParameter.isConnectedToAnyModulator()||Object.keys(this.ratioParameter.patternToValue).length>0)&&(e.ratioParameter=this.ratioParameter.getJson()),(this.releaseParameter.isConnectedToAnyModulator()||Object.keys(this.releaseParameter.patternToValue).length>0)&&(e.releaseParameter=this.releaseParameter.getJson()),(this.attackParameter.isConnectedToAnyModulator()||Object.keys(this.attackParameter.patternToValue).length>0)&&(e.attackParameter=this.attackParameter.getJson()),this.kneeParameter.isConnectedToAnyModulator()|Object.keys(this.kneeParameter.patternToValue).length>0&&(e.kneeParameter=this.kneeParameter.getJson()),e}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),"gain"in e&&this.gainParameter.set(e.gain),"threshold"in e&&this.thresholdParameter.set(e.threshold),"ratio"in e&&this.ratioParameter.set(e.ratio),"release"in e&&this.releaseParameter.set(e.release),"attack"in e&&this.attackParameter.set(e.attack),"knee"in e&&this.kneeParameter.set(e.knee),e.enabled&&this.enable(!0),this.loadParameterFromJson(e,"gainParameter",this.gainParameter,t),this.loadParameterFromJson(e,"thresholdParameter",this.thresholdParameter,t),this.loadParameterFromJson(e,"ratioParameter",this.ratioParameter,t),this.loadParameterFromJson(e,"releaseParameter",this.releaseParameter,t),this.loadParameterFromJson(e,"attackParameter",this.attackParameter,t),this.loadParameterFromJson(e,"kneeParameter",this.kneeParameter,t)}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),n}(Xn.Effect);function Tr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var xr=function(e){Object(u.a)(n,e);var t=Tr(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Distortion",function(){return new x.a.Distortion(.4)},e)).effectNode.oversampling="4x",r.distortionParameter=new Ln("Distortion",r.effectNode,function(e,t){return e.distortion=t},{min:0,max:1,unit:"%",defaultValue:.1}),r.registerParameter(r.distortionParameter),r}return Object(c.a)(n,[{key:"getJson",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this);return e.distortion=this.effectNode.distortion,e.enabled=this.enabledParameter.get(),e.wet=this.effectNode.wet.value,e.name=this.name,(this.distortionParameter.isConnectedToAnyModulator()||Object.keys(this.distortionParameter.patternToValue).length>0)&&(e.distortionParameter=this.distortionParameter.getJson()),e}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),this.distortionParameter.set(e.distortion),e.enabled&&this.enable(!0),this.setValue(e.value),this.loadParameterFromJson(e,"distortionParameter",this.distortionParameter,t)}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),n}(Xn.Effect);function Cr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Nr=function(e){Object(u.a)(n,e);var t=Cr(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Pitch Shift",function(){return new x.a.PitchShift(0)},e)).pitchParameter=new Ln("Pitch",r.effectNode,function(e,t){e.pitch=t},{min:-24,max:24,unit:"",defaultValue:12}),r.registerParameter(r.pitchParameter),r.windowSizeParameter=new Ln("Window Size",r.effectNode,function(e,t){return e.windowSize=t},{min:.03,max:.1,unit:"",defaultValue:.03}),r.registerParameter(r.windowSizeParameter),r}return Object(c.a)(n,[{key:"getJson",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this);return e.pitch=this.pitchParameter.get(),e.windowSize=this.windowSizeParameter.get(),e.enabled=this.enabledParameter.get(),e.wet=this.effectNode.wet.value,e.name=this.name,e=this.saveParameterToJson(e,"pitchParameter",this.pitchParameter),e=this.saveParameterToJson(e,"windowSizeParameter",this.pitchParameter)}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),this.pitchParameter.set(e.pitch),this.windowSizeParameter.set(e.windowSize),e.enabled&&this.enable(!0),this.setValue(e.value),this.loadParameterFromJson(e,"pitchParameter",this.pitchParameter,t),this.loadParameterFromJson(e,"windowSizeParameter",this.pitchParameter,t)}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),n}(Xn.Effect);function Rr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Dr=function(e){Object(u.a)(n,e);var t=Rr(n);function n(e){var r;return Object(o.a)(this,n),r=t.call(this,"Panner",function(){return new x.a.Panner(0)},e),console.log("_panner = "),console.log(r.effectNode._panner.pan),r.panningParameter=new Fn("Panning",r.effectNode._panner.pan,{min:-1,max:1,unit:"",defaultValue:0}),r.registerParameter(r.panningParameter),r}return Object(c.a)(n,[{key:"getJson",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this);return e.panning=this.panningParameter.get(),e.enabled=this.enabledParameter.get(),e.name=this.name,e=this.saveParameterToJson(e,"panningParameter",this.panningParameter)}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),this.panningParameter.set(e.panning),e.enabled&&this.enable(!0),this.loadParameterFromJson(e,"panningParameter",this.panningParameter,t)}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),n}(Xn.Effect);function qr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Mr=function(e){Object(u.a)(n,e);var t=qr(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"EQ 3",function(){return new x.a.EQ3},e)).lowParameter=new Be("Low",r.effectNode.low,function(e,t){return e.value=t},{min:-10,max:10,unit:"db",defaultValue:0}),r.lowFrequencyParameter=new Be("Low Frequency",r.effectNode.lowFrequency,function(e,t){return e.value=t},{min:0,max:400,unit:"hz",defaultValue:0}),r.midParameter=new Be("Mid",r.effectNode.mid,function(e,t){return e.value=t},{min:-10,max:10,unit:"db",defaultValue:0}),r.highParameter=new Be("High",r.effectNode.high,function(e,t){return e.value=t},{min:-10,max:10,unit:"db",defaultValue:0}),r.highFrequencyParameter=new Be("High Frequency",r.effectNode.highFrequency,function(e,t){return e.value=t},{min:1e3,max:1e4,unit:"hz",defaultValue:2e3}),r.registerParameter(r.lowParameter),r.registerParameter(r.midParameter),r.registerParameter(r.highParameter),r.registerParameter(r.lowFrequencyParameter),r.registerParameter(r.highFrequencyParameter),r}return Object(c.a)(n,[{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{low:this.lowParameter.get(),mid:this.midParameter.get(),high:this.highParameter.get(),lowFrequency:this.lowFrequencyParameter.get(),highFrequency:this.highFrequencyParameter.get(),enabled:this.enabledParameter.get(),name:this.name})}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),this.lowParameter.set(e.low),this.midParameter.set(e.mid),this.highParameter.set(e.high),this.lowFrequencyParameter.set(e.lowFrequency),this.highFrequencyParameter.set(e.highFrequency),this.enable(e.enabled)}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),n}(Xn.Effect);function Ar(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ir="peaking",Lr=function(e){Object(u.a)(n,e);var t=Ar(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"EQ 10",function(){return new x.a.Gain(1)},e)).filter31=new x.a.Filter(31,Ir),r.filter31.Q.value=.71,r.filter63=new x.a.Filter(63,Ir),r.filter63.Q.value=.71,r.filter125=new x.a.Filter(125,Ir),r.filter125.Q.value=.71,r.filter250=new x.a.Filter(250,Ir),r.filter250.Q.value=.71,r.filter500=new x.a.Filter(500,Ir),r.filter500.Q.value=.71,r.filter1k=new x.a.Filter(1e3,Ir),r.filter1k.Q.value=.71,r.filter2k=new x.a.Filter(2e3,Ir),r.filter2k.Q.value=.71,r.filter4k=new x.a.Filter(4e3,Ir),r.filter4k.Q.value=.71,r.filter8k=new x.a.Filter(8e3,Ir),r.filter8k.Q.value=.71,r.filter16k=new x.a.Filter(16e3,Ir),r.filter16k.Q.value=.71,r.outputNode=new x.a.Gain(1),r.effectNode.chain(r.filter31,r.filter63,r.filter125,r.filter250,r.filter500,r.filter1k,r.filter2k,r.filter4k,r.filter8k,r.filter16k,r.outputNode),r.gain31Parameter=new Fn("Gain 31",r.filter31.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain31Parameter),r.gain63Parameter=new Fn("Gain 63",r.filter63.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain63Parameter),r.gain125Parameter=new Fn("Gain 125",r.filter125.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain125Parameter),r.gain125Parameter=new Fn("Gain 125",r.filter125.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain125Parameter),r.gain250Parameter=new Fn("Gain 250",r.filter250.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain250Parameter),r.gain500Parameter=new Fn("Gain 500",r.filter500.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain500Parameter),r.gain1kParameter=new Fn("Gain 1k",r.filter1k.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain1kParameter),r.gain2kParameter=new Fn("Gain 2k",r.filter2k.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain2kParameter),r.gain4kParameter=new Fn("Gain 4k",r.filter4k.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain4kParameter),r.gain8kParameter=new Fn("Gain 8k",r.filter8k.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain8kParameter),r.gain16kParameter=new Fn("Gain 16k",r.filter16k.gain,{min:-12,max:12,unit:"db",defaultValue:0}),r.registerParameter(r.gain16kParameter),r}return Object(c.a)(n,[{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(){this.outputNode.disconnect()}},{key:"getJson",value:function(){var e=Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{gain63:this.gain63Parameter.get(),gain125:this.gain125Parameter.get(),gain250:this.gain250Parameter.get(),gain500:this.gain500Parameter.get(),gain1k:this.gain1kParameter.get(),gain2k:this.gain2kParameter.get(),gain4k:this.gain4kParameter.get(),gain8k:this.gain8kParameter.get(),gain16k:this.gain16kParameter.get()});return e=this.saveParameterToJson(e,"gain31Parameter",this.gain31Parameter),e=this.saveParameterToJson(e,"gain63Parameter",this.gain63Parameter),e=this.saveParameterToJson(e,"gain125Parameter",this.gain125Parameter),e=this.saveParameterToJson(e,"gain250Parameter",this.gain250Parameter),e=this.saveParameterToJson(e,"gain500Parameter",this.gain500Parameter),e=this.saveParameterToJson(e,"gain1kParameter",this.gain1kParameter),e=this.saveParameterToJson(e,"gain2kParameter",this.gain2kParameter),e=this.saveParameterToJson(e,"gain4kParameter",this.gain4kParameter),e=this.saveParameterToJson(e,"gain8kParameter",this.gain8kParameter),e=this.saveParameterToJson(e,"gain16kParameter",this.gain16kParameter)}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),this.gain63Parameter.set(e.gain63),this.gain125Parameter.set(e.gain125),this.gain250Parameter.set(e.gain250),this.gain500Parameter.set(e.gain500),this.gain1kParameter.set(e.gain1k),this.gain2kParameter.set(e.gain2k),this.gain4kParameter.set(e.gain4k),this.gain8kParameter.set(e.gain8k),this.gain16kParameter.set(e.gain16k),this.loadParameterFromJson(e,"gain31Parameter",this.gain31Parameter,t),this.loadParameterFromJson(e,"gain63Parameter",this.gain63Parameter,t),this.loadParameterFromJson(e,"gain125Parameter",this.gain125Parameter,t),this.loadParameterFromJson(e,"gain250Parameter",this.gain250Parameter,t),this.loadParameterFromJson(e,"gain500Parameter",this.gain500Parameter,t),this.loadParameterFromJson(e,"gain1kParameter",this.gain1kParameter,t),this.loadParameterFromJson(e,"gain2kParameter",this.gain2kParameter,t),this.loadParameterFromJson(e,"gain4kParameter",this.gain4kParameter,t),this.loadParameterFromJson(e,"gain8kParameter",this.gain8kParameter,t),this.loadParameterFromJson(e,"gain16kParameter",this.gain16kParameter,t),this.enable(e.enabled)}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),n}(Xn.Effect);function Fr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Br=function(e){Object(u.a)(n,e);var t=Fr(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Gate",function(){return new x.a.Gain(2)},e)).connectedTrack=void 0,r.follower=new x.a.Follower(.012,.1),r.multiplier=new x.a.Gain(100),r.gate=new x.a.Gate(-30,.001,.2),r.smoothingParameter=new Be("Smoothing",Object(W.a)(r),function(e,t){return r.gate.smoothing=t},{min:1e-5,max:2,unit:"ms",defaultValue:.012}),r.thresholdParameter=new Be("Threshold",Object(W.a)(r),function(e,t){return r.gate.threshold=t},{min:-30,max:6,unit:"db",defaultValue:0}),r.registerParameter(r.smoothingParameter),r.registerParameter(r.thresholdParameter),r.effectNode.connect(r.gate),r}return Object(c.a)(n,[{key:"connect",value:function(e){this.gate.connect(e)}},{key:"disconnect",value:function(e){this.gate.disconnect(e)}},{key:"setSideChainedTrack",value:function(e,t){void 0!==this.connectedTrack&&this.connectedTrack.volumeNode.disconnect(this.multiplier),e.volumeNode.chain(this.multiplier,this.follower),this.follower.connect(this.effectNode.gain),this.connectedTrack=e,this.trackNumber=t}},{key:"getJson",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this);return e.trackNumber=this.trackNumber,e.threshold=this.threshold,e.smoothing=this.smoothing,e=this.saveParameterToJson(e,"smoothingParameter",this.smoothingParameter),e=this.saveParameterToJson(e,"thresholdParameter",this.thresholdParameter)}},{key:"fromJson",value:function(e,t,r){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,r),e.enabled&&this.enable(!0),this.threshold=e.threshold,this.smoothing=e.smoothing,this.setSideChainedTrack(t[e.trackNumber],e.trackNumber),this.loadParameterFromJson(e,"thresholdParameter",this.thresholdParameter),this.loadParameterFromJson(e,"smoothingParameter",this.smoothingParameter)}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),this.sequencerEngine.tracks,!0),e}},{key:"smoothing",get:function(){return this.smoothingParameter.get()},set:function(e){return this.smoothingParameter.set(e)}},{key:"threshold",get:function(){return this.thresholdParameter.get()},set:function(e){return this.thresholdParameter.set(e)}}]),n}(Xn.Effect),Hr=180;function Vr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ur="peaking",Jr=function(e){Object(u.a)(n,e);var t=Vr(n);function n(e){var r,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(var i in Object(o.a)(this,n),(r=t.call(this,"EQ8",function(){return new x.a.Gain(1)},e)).store=e.store,r.equalizerPoints=[new _r(e,Object(W.a)(r),80,0,1,1,!0,"lowshelf"),new _r(e,Object(W.a)(r),300,0,1,2,!1),new _r(e,Object(W.a)(r),500,0,1,3,!1),new _r(e,Object(W.a)(r),800,0,1,4,!1),new _r(e,Object(W.a)(r),1e3,0,1,5),new _r(e,Object(W.a)(r),2e3,0,1,6,!1),new _r(e,Object(W.a)(r),4e3,0,1,7),new _r(e,Object(W.a)(r),8e3,0,1,8,!0,"highshelf")],r.updateRate=Hr,a&&(r.analyser=new x.a.Analyser("fft",256)),r.outputNode=new x.a.Gain(1),r.setupEqualizer(),r.equalizerPoints)r.parameters=r.parameters.concat(r.equalizerPoints[i].parameters);return r}return Object(c.a)(n,[{key:"dispose",value:function(){Object(q.a)(Object(p.a)(n.prototype),"dispose",this).call(this),this.analyser&&this.analyser.dispose(),this.equalizerPoints.forEach(function(e){return e.dispose()}),this.equalizerPoints=void 0}},{key:"disconnectAllFilters",value:function(){this.effectNode.disconnect(),this.equalizerPoints.filter(function(e){return e.enabled}).forEach(function(e){return e.filter.disconnect()})}},{key:"setupEqualizer",value:function(){var e,t=this.equalizerPoints.filter(function(e){return e.enabled}).map(function(e){return e.filter});t.push(this.outputNode),(e=this.effectNode).chain.apply(e,Object(M.a)(t))}},{key:"getSpectrum",value:function(){return this.analyser.getValue()}},{key:"connect",value:function(e){this.outputNode.connect(e),this.analyser&&this.outputNode.connect(this.analyser)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e),this.analyser&&this.analyser.disconnect()}},{key:"getJson",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this);return e.updateRate=this.updateRate,e.equalizerPoints=this.equalizerPoints.map(function(e){return e.getJson()}),e}},{key:"fromJson",value:function(e,t){for(var r in Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),"updateRate"in e&&(this.updateRate=e.updateRate),this.equalizerPoints)this.equalizerPoints[r].fromJson(e.equalizerPoints[r]);return this}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),n}(Xn.Effect),_r=function(){function e(t,n,r,a,i,s){var c=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Ur;Object(o.a)(this,e),this.eq=n,this.name="EQ Frequency "+s,this.number=s,this.type=u,this.sequencerEngine=t,this.store=t.store,this.filter=new x.a.Filter(r,u),this.filter.Q.value=i,this.filter.gain.value=a,this.frequencyParameter=new Fn(this.name+" frequency",this.filter.frequency,{min:0,max:1e4,unit:"hz",defaultValue:r}),this.gainParameter=new Fn(this.name+" gain",this.filter.gain,{min:-16,max:16,unit:"db",defaultValue:a}),this.qParameter=new Fn(this.name+" q",this.filter.Q,{min:0,max:16,unit:"Q",defaultValue:i}),this.enabledParameter=new Be(this.name+" enabled",this,function(e,t){},{min:0,max:1,unit:"boolean",defaultValue:c}),this.parameters=[],this.registerParameter(this.enabledParameter),this.registerParameter(this.frequencyParameter),this.registerParameter(this.gainParameter),this.registerParameter(this.qParameter)}return Object(c.a)(e,[{key:"dispose",value:function(){this.filter._param&&this.filter.dispose(),this.filter=void 0,this.parameters.forEach(function(e){return e.dispose()}),this.gainParameter=void 0,this.qParameter=void 0}},{key:"getJson",value:function(){var e={number:this.number,frequency:this.frequency,gain:this.gain,q:this.q,enabled:this.enabled};return e=sr(e,"frequencyParameter",this.frequencyParameter),e=sr(e,"qParameter",this.qParameter),e=sr(e,"gainParameter",this.gainParameter),e=sr(e,"enabledParameter",this.enabledParameter)}},{key:"fromJson",value:function(e){this.enabled=e.enabled,this.frequency=e.frequency,this.frequencyParameter.unlockedValue=e.frequency,this.q=e.q,this.qParameter.unlockedValue=e.q,this.gain=e.gain,this.gainParameter.unlockedValue=e.gain,or(e,"frequencyParameter",this.frequencyParameter,this.sequencerEngine),or(e,"qParameter",this.qParameter,this.sequencerEngine),or(e,"gainParameter",this.gainParameter,this.sequencerEngine),or(e,"enabledParameter",this.enabledParameter)}},{key:"registerParameter",value:function(e){void 0!==e&&(e.name=e.name,e.effectName=this.name,e.setStore(this.store),this.parameters.push(e))}},{key:"frequencyToGain",value:function(e){return"peaking"===this.type?this.frequencyToGainPeaking(e):"highshelf"===this.type?this.frequencyToGainHighShelf(e):this.frequencyToGainLowShelf(e)}},{key:"frequencyToGainPeaking",value:function(e){var t=200/this.q,n=e-t/2,r=e+t/2;return e<=n||e>=r?0:e<this.frequency?this.gain*((e-n)/(this.frequency-n)):this.gain*((r-e)/(r-this.frequency))}},{key:"frequencyToGainHighShelf",value:function(e){var t=e-100;return(e+=100)<=t?0:e>=this.frequency?this.gain:this.gain*((e-t)/(this.frequency-t))}},{key:"frequencyToGainLowShelf",value:function(e){var t=e+100;return e>=t?0:e<=this.frequency?this.gain:this.gain*((e-t)/(this.frequency-t))}},{key:"enabled",get:function(){return this.enabledParameter.get()},set:function(e){return this.enabledParameter.set(e)}},{key:"frequency",get:function(){return this.frequencyParameter.get()},set:function(e){this.frequencyParameter.set(e)}},{key:"gain",get:function(){return this.gainParameter.get()},set:function(e){this.gainParameter.set(e)}},{key:"q",get:function(){return this.qParameter.get()},set:function(e){this.qParameter.set(e)}}]),e}(),Gr=Jr,zr=n(45),Wr=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,[{key:"getCopy",value:function(){var t=new e;return t.sequencerEngine=this.sequencerEngine,t.envelopesTrack=this.envelopesTrack,t.envelopeTrack=this.envelopeTrack,t.lfosTrack=this.lfosTrack,t.lfoTrack=this.lfoTrack,t.liveEffect=this.liveEffect,t.track=this.track,t.group=this.group,t.instrument=this.instrument,t.send=this.effect,t.effect=this.effect,t.midiEffect=this.midiEffect,t.subDevice=this.subDevice,t.macro=this.macro,t}},{key:"forSequencerEngine",value:function(e){return this.sequencerEngine=e,this}},{key:"forEnvelopeTrack",value:function(e,t){return this.envelopeTrack=e,this.envelopesTrack=t,this}},{key:"forLFOTrack",value:function(e,t){return this.lfoTrack=e,this.lfosTrack=t,this}},{key:"forMacro",value:function(e){return this.macro=e,this}},{key:"forTrack",value:function(e){return this.track=e,this}},{key:"forGroup",value:function(e){return this.group=e,this}},{key:"forSend",value:function(e){return this.send=e,this}},{key:"forEffect",value:function(e){return this.effect=e,this}},{key:"forMidiEffect",value:function(e){return this.midiEffect=e,this}},{key:"forLiveEffect",value:function(e){return this.liveEffect=e,this}},{key:"forInstrument",value:function(e){return this.instrument=e,this}},{key:"forSubDevice",value:function(e){return this.subDevice=e,this}},{key:"getEffectContext",value:function(){return void 0!==this.track?this.track:void 0!==this.group?this.group:void 0!==this.send?this.send:void 0}},{key:"getJson",value:function(){var e={},t=[];if(void 0!==this.track&&this.track.getTrackType()===zr.b&&(e=Object(D.a)({},e,{track:this.track.trackNumber,isInstrument:!0})),void 0!==this.track?(t=this.track.effects,e.track=this.track.trackNumber):void 0!==this.group?(t=this.group.effects,e.group=this.group.groupNumber):void 0!==this.send&&(t=this.send.effects,e.send=this.send.sendNumber),e.effect=-1,this.effect&&(t&&(e.effect=t.indexOf(this.effect)),this.subDevice&&(console.log("there was a subdevice!"),e.subDevice=this.effect.getSubDeviceIndex(this.subDevice))),this.midiEffect&&(e.midiEffect=this.track.midiEffects.effects.indexOf(this.midiEffect)),this.liveEffect&&(e.liveEffect=this.track.liveEffects.effects.indexOf(this.liveEffect)),this.macro&&(e.macro=this.macro.id),this.instrument){e.isInstrument=!0;var n=void 0;this.subDevice&&(n=this.track.instrument.getSubDeviceIndex(this.subDevice)),e.subDevice=n}return e}},{key:"combineWith",value:function(e){return e.track&&(this.track=e.track),e.effect&&(this.effect=e.effect),e.subDevice&&(this.subDevice=e.subDevice),this}},{key:"subSequence",get:function(){return void 0!==this.envelopesTrack?this.envelopesTrack.subSequence:void 0!==this.lfosTrack?this.lfosTrack.subSequence:void 0!==this.track?this.track.subSequence:void 0}}]),e}();function Kr(e){return Math.pow(10,.05*e)}function Qr(e){return 20*Math.log(e)/Math.LN10}function Xr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Yr=65536,Zr=function(e){Object(u.a)(n,e);var t=Xr(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Saturator",function(){return new x.a.Gain(1)},e)).waveShaperNode=new x.a.WaveShaper([-1,1]),r.effectNode.connect(r.waveShaperNode),r.postGain=new x.a.Gain(1),r.waveShaperNode.connect(r.postGain),r.params=r.getParams(-10,20,30,6),r.curve=new Float32Array(Yr),r.driveParameter=new Ln("Drive",r.effectNode.gain,function(e,t){r.effectNode.gain.value=t,r.postGain.gain.value=Math.pow(1/t,.6)},{min:.01,max:4,unit:"",defaultValue:1,constantAutomationRate:!0}),r.registerParameter(r.driveParameter),r.waveShaperNode.curve=r.generateCurve(),r}return Object(c.a)(n,[{key:"connect",value:function(e){this.postGain.connect(e)}},{key:"disconnect",value:function(e){this.postGain.disconnect(e)}},{key:"getParams",value:function(e,t,n,r){var a=Kr(e),i=(Kr(t),1/n),s=this.kAtSlope(1/n,e,t,a),o=e+t,c=Kr(o);return{linearThreshold:a,thresholdDb:e,kneeDb:t,ykneeThresholdDb:Qr(this.saturateBasic(c,s,a)),kneeThreshold:c,kneeThresholdDb:o,k:s,ratio:n,slope:i}}},{key:"slopeAt",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.params.linearThreshold;if(e<n)return 1;var r=1.001*e,a=Qr(e),i=Qr(r),s=Qr(this.saturateBasic(e,t,n));return(Qr(this.saturateBasic(r,t,n))-s)/(i-a)}},{key:"kAtSlope",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.params.thresholdDb,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.params.kneeDb,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.params.linearThreshold,a=Kr(t+n),i=.1,s=1e4,o=5,c=0;c<15;++c){this.slopeAt(a,o,r)<e?(s=o,o=Math.sqrt(i*s)):(i=o,o=Math.sqrt(i*s))}return o}},{key:"saturateBasic",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.params.linearThreshold;return e<n?e:n+(1-Math.exp(-t*(e-n)))/t}},{key:"saturate",value:function(e){var t;if(e<this.params.kneeThreshold)t=this.saturateBasic(e,this.params.k);else{var n=Qr(e);t=Kr(this.params.ykneeThresholdDb+this.params.slope*(n-this.params.kneeThresholdDb))}return t}},{key:"generateCurve",value:function(e){for(var t=Yr/2,n=0,r=0;r<t;++r)n=r/t,n=this.saturate(n),this.curve[t+r]=n,this.curve[t-r-1]=-n;return this.curve}},{key:"getJson",value:function(){var e=Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{drive:this.driveParameter.get()});return e=this.saveParameterToJson(e,"driveParameter",this.driveParameter)}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),this.driveParameter.set(e.drive),this.loadParameterFromJson(e,"driveParameter",this.driveParameter,t)}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),n}(Xn.Effect);function $r(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ea=function(e){Object(u.a)(n,e);var t=$r(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Tape Delay",function(){return new x.a.Gain(1)},e)).initComponents(),r.rateParameter=new Fn("Rate",r.delayNode.delayTime,{defaultValue:.1,min:0,max:1},.2),r.registerParameter(r.rateParameter),r.feedbackParameter=new Fn("Feedback",r.feedbackNode.gain,{defaultValue:.1,min:0,max:1}),r.registerParameter(r.feedbackParameter),r.wetParameter=new Fn("Wet",r.crossFade.fade,{defaultValue:.5,min:0,max:1}),r.registerParameter(r.wetParameter),r}return Object(c.a)(n,[{key:"initComponents",value:function(){this.inputNode=this.effectNode,this.crossFade=new x.a.CrossFade(.5),this.feedbackNode=new x.a.Gain(.1),this.saturatorNode=new Zr(this.sequencerEngine),this.saturatorNode.driveParameter.set(2.5),this.registerParameter(this.driveParameter),this.delayNode=new x.a.FeedbackDelay(.1,.1),this.eqNode=new Gr(this.sequencerEngine,!1),this.eqNode.equalizerPoints[0].frequencyParameter.set(300),this.eqNode.equalizerPoints[4].qParameter.set(.7),this.eqNode.equalizerPoints[7].frequencyParameter.set(4e3),this.registerParameter(this.lowEQParameter),this.registerParameter(this.midEQParameter),this.registerParameter(this.highEQParameter),this.delayNode.wet.value=1,this.inputNode.connect(this.saturatorNode.effectNode),this.saturatorNode.connect(this.eqNode.effectNode),this.eqNode.connect(this.delayNode),this.inputNode.connect(this.crossFade,0,0),this.delayNode.connect(this.crossFade,0,1),this.delayNode.connect(this.feedbackNode),this.feedbackNode.connect(this.saturatorNode.effectNode),this.outputNode=new x.a.Gain(1),this.crossFade.connect(this.outputNode)}},{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}},{key:"getJson",value:function(){var e=Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{lowEQ:this.lowEQParameter.get(),midEQ:this.midEQParameter.get(),drive:this.driveParameter.get(),highEQ:this.highEQParameter.get(),feedback:this.feedbackParameter.get(),wet:this.wetParameter.get(),rate:this.rateParameter.get()});return e=this.saveParameterToJson(e,"driveParameter",this.driveParameter),e=this.saveParameterToJson(e,"lowEQParameter",this.lowEQParameter),e=this.saveParameterToJson(e,"midEQParameter",this.midEQParameter),e=this.saveParameterToJson(e,"highEQParameter",this.highEQParameter),e=this.saveParameterToJson(e,"feedbackParameter",this.feedbackParameter),e=this.saveParameterToJson(e,"rateParameter",this.rateParameter),e=this.saveParameterToJson(e,"wetParameter",this.wetParameter)}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),this.lowEQParameter.set(e.lowEQ),this.midEQParameter.set(e.midEQ),this.highEQParameter.set(e.highEQ),this.feedbackParameter.set(e.feedback),this.wetParameter.set(e.wet),this.rateParameter.set(e.rate),e.drive&&this.driveParameter.set(e.drive),this.loadParameterFromJson(e,"lowEQParameter",this.lowEQParameter,t),this.loadParameterFromJson(e,"driveParameter",this.driveParameter,t),this.loadParameterFromJson(e,"midEQParameter",this.midEQParameter,t),this.loadParameterFromJson(e,"highEQParameter",this.highEQParameter,t),this.loadParameterFromJson(e,"feedbackParameter",this.feedbackParameter,t),this.loadParameterFromJson(e,"rateParameter",this.rateParameter,t),this.loadParameterFromJson(e,"wetParameter",this.wetParameter,t)}},{key:"driveParameter",get:function(){return this.saturatorNode.driveParameter}},{key:"lowEQParameter",get:function(){return this.eqNode.equalizerPoints[0].gainParameter}},{key:"midEQParameter",get:function(){return this.eqNode.equalizerPoints[4].gainParameter}},{key:"highEQParameter",get:function(){return this.eqNode.equalizerPoints[7].gainParameter}}]),n}(Xn.Effect),ta=function(){function e(t,n){Object(o.a)(this,e),this.parameters=[],this.effect=t,this.sequencerEngine=n,this.store=n.store,this.gain=new x.a.Gain(1),this.gainParameter=new Fn("Gain",this.gain.gain,{min:0,max:1,unit:"db",defaultValue:.5}),this.registerParameter(this.gainParameter),this.probabilityParameter=new Be("Gain",this,function(){return[]},{min:0,max:100,unit:"%",defaultValue:100}),this.registerParameter(this.gainParameter),t&&t.connect&&(t.effectNode?this.gain.connect(t.effectNode):this.gain.connect(t))}return Object(c.a)(e,[{key:"registerParameter",value:function(e){void 0!==e&&(e.name=e.name,e.effectName=this.name,e.setStore(this.store),this.parameters.push(e))}},{key:"getCopy",value:function(){var t=new e(this.effect,this.sequencerEngine);return t.gainParameter.set(t.gainParameter.get()),t}},{key:"getJson",value:function(e){var t={effect:e.effects.indexOf(this.effect),gain:this.gainParameter.get()};return t=sr(t,"gainParameter",this.gainParameter)}},{key:"fromJson",value:function(e,t){this.gainParameter.set(e.gain),or(e,"gainParameter",this.gainParameter),this.effect=t.effects[e.effect],this.effect||(this.effect=t.outputNode),void 0!==this.effect.connect&&(this.effect.effectNode?this.gain.connect(this.effect.effectNode):this.gain.connect(this.effect))}},{key:"dispose",value:function(){this.gainParameter.dispose(),this.gainParameter=void 0}}]),e}();function na(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;return Math.random()<e}function ra(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;if(void 0!==n&&na(a)){var i=t+"Parameter";i in n?(r.disconnectFromAllModulators(),r.fromJson(n[i],e),r.set(n[t])):t in n&&r.set(n[t])}}function aa(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ia=[{value:"1n",label:"1"},{value:"2n",label:"1/2"},{value:"4n",label:"1/4"},{value:"4t",label:"1/4t"},{value:"8n",label:"1/8"},{value:"8n.",label:"1/8."},{value:"8t",label:"1/8t"},{value:"16n",label:"1/16"},{value:"16t",label:"1/16t"},{value:"32n",label:"1/32"}],sa=function(e){Object(u.a)(n,e);var t=aa(n);function n(e,r,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object(o.a)(this,n),t.call(this,e,r,a,i)}return Object(c.a)(n,[{key:"toSeconds",value:function(){return new x.a.Time(this.get()).toSeconds()}},{key:"toFrequency",value:function(){return new x.a.Time(this.get()).toFrequency()}},{key:"toString",value:function(){return new x.a.Time(this.get()).toString()}},{key:"quantize",value:function(e){e=new x.a.Frequency(e);var t=1e5,n=void 0;for(var r in ia){var a=new x.a.Time(ia[r].value),i=Math.abs(a.toFrequency()-e.toFrequency());i<t&&(t=i,n=a)}return n}}]),n}(Ln),oa=function(){function e(t,n){Object(o.a)(this,e),this.minValue=t,this.maxValue=t,this.min=t,this.max=n}return Object(c.a)(e,[{key:"min",set:function(e){this.minValue="-"===e?-0:parseFloat(e)},get:function(){return this.minValue}},{key:"max",set:function(e){this.maxValue="-"===e?-0:parseFloat(e)},get:function(){return this.maxValue}}]),e}(),ca=function(){function e(t,n,r,a){Object(o.a)(this,e),this.sequencerEngine=t,this.store=t.store,this.context=r,this.number=a,this.idToParameter={},this.parameterToScaler={},this.parameterIdToVoiceToNode={},this.parameters=[]}return Object(c.a)(e,[{key:"getType",value:function(){}},{key:"connect",value:function(e,t,n){var r=this;if(void 0!==e){this.idToParameter[t.id]=t;var a,i=this.getChain(t,e);if(this.sequencerEngine.hasAtleastOneSequencerEnginePlaying())setTimeout(function(){var e;(e=r.getModulator()).chain.apply(e,Object(M.a)(i))},300);else(a=this.getModulator()).chain.apply(a,Object(M.a)(i));return void 0===this.parameterIdToVoiceToNode[t.id]&&(this.parameterIdToVoiceToNode[t.id]={}),this.parameterIdToVoiceToNode[t.id][n]=i,i}var s=new oa(t.min,t.max);this.parameterToScaler[t.id]=s}},{key:"disconnect",value:function(e,t,n){if(void 0!==this.parameterIdToVoiceToNode[t.id]){delete this.idToParameter[t.id];var r=this.parameterIdToVoiceToNode[t.id][n];if(delete this.parameterIdToVoiceToNode[t.id][n],0===Object.keys(this.parameterIdToVoiceToNode[t.id]).length&&delete this.parameterIdToVoiceToNode[t.id],void 0!==this.parameterToScaler[t.id]&&delete this.parameterToScaler[t.id],void 0!==r){this.getModulator().disconnect(r[0]);for(var a=0;a<r.length-1;a++)r[a].disconnect(r[a+1])}}}},{key:"disconnectAllModulators",value:function(){this.parameters.forEach(function(e){return e.disconnectFromAllModulators()})}},{key:"getScaleForParameter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.parameterToScaler[e.id])return this.parameterToScaler[e.id];var n=this.parameterIdToVoiceToNode[e.id];if(void 0!==n){var r=n[t];return this.getScaleFromChain(r)}}}]),e}();function ua(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var la=function(e){Object(u.a)(n,e);var t=ua(n);function n(e,r,a,i){var s;return Object(o.a)(this,n),(s=t.call(this,e,r,a,i)).lastValue=void 0,s.lastStep=void 0,s.number=i,s.rawLFORate=void 0,s.mixSession=r,s.lfo=new x.a.LFO(.5,-100,100),s.setupLFOParameters(),s.meter=new x.a.Analyser({type:"waveform",size:32,smoothing:.7}),s.lfo.connect(s.meter),s.isSynced=!0,s}return Object(c.a)(n,[{key:"getType",value:function(){return"LFO"}},{key:"dispose",value:function(){for(var e in this.lfo.dispose(),this.meter.dispose(),this.parameters.forEach(function(e){return e.dispose()}),this.parameterIdToVoiceToNode){var t=this.parameterIdToVoiceToNode[e];for(var n in t){t[n].filter(function(e){return e.disconnect&&e._param}).forEach(function(e){return e.disconnect()})}}this.parameterIdToVoiceToNode=void 0,this.lfo=void 0,this.meter=void 0,this.lfoRateParameter=void 0,this.lfoMinParameter=void 0,this.lfoMaxParameter=void 0,this.lfoPhaseParameter=void 0}},{key:"getScaleFromChain",value:function(e){return e[2]}},{key:"getValue",value:function(e){if(e===this.lastStep)return this.lastValue;var t=this.meter.getValue()[0];return this.lastStep=e,this.lastValue=t,t}},{key:"start",value:function(){this.lfo.start(),this.lfo.lfoType=this.lfoType}},{key:"stop",value:function(){this.lfo.stop()}},{key:"getModulator",value:function(){return this.lfo}},{key:"getChain",value:function(e,t){return[new x.a.Gain(1),new x.a.Normalize(-100,100),new x.a.Scale(e.min,e.max),t]}},{key:"connect",value:function(e,t,r){if(void 0!==e){var a=e;e.input&&!Array.isArray(e.input)&&(a=e.input);Object(q.a)(Object(p.a)(n.prototype),"connect",this).call(this,a,t,r)}else{var i=new oa(t.min,t.max);this.parameterToScaler[t.id]=i}}},{key:"setupLFOParameters",value:function(){var e=this;this.lfoTypeParameter=new Be("LFO Type",this,function(t,n){e.stop(),e.lfo.type=n,e.start()},{min:0,max:1,defaultValue:"sine",automatable:!1}),this.registerParameter(this.lfoTypeParameter),this.lfoRateParameter=new sa("LFO Rate",this.lfo.frequency,function(t,n){e.lfo.frequency.value=new x.a.Frequency(n)},{min:0,max:20,unit:"",defaultValue:"4n"}),this.registerParameter(this.lfoRateParameter),this.lfoMinParameter=new Ln("LFO Min",this.lfo._scaler._add,function(t,n){e.lfo.min=n},{min:-100,max:100,unit:"",defaultValue:0}),this.registerParameter(this.lfoMinParameter),this.lfoMaxParameter=new Ln("LFO Max",this.lfo._scaler._scale,function(t,n){e.lfo.max=n},{min:-100,max:100,unit:"",defaultValue:0}),this.registerParameter(this.lfoMaxParameter),this.lfoPhaseParameter=new Be("LFO Phase",this,function(t,n){e.lfo.phase=n},{min:0,max:360,unit:"",defaultValue:0}),this.registerParameter(this.lfoPhaseParameter)}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),this.parameters.push(e)}},{key:"onBPMUpdated",value:function(){this.lfoRate=this.lfoRate}},{key:"getJson",value:function(){var e=this.lfoRate;return"number"!==typeof e&&void 0!==this.rawLFORate&&(e=this.rawLFORate),{lfoRateParameter:this.lfoRateParameter.getJson(),lfoRate:e,lfoMinParameter:this.lfoMinParameter.getJson(),lfoMaxParameter:this.lfoMaxParameter.getJson(),lfoTypeParameter:this.lfoTypeParameter.getJson(),lfoPhaseParameter:this.lfoPhaseParameter.getJson(),isSynced:this.isSynced}}},{key:"fromJson",value:function(e){"lfoRateParameter"in e&&this.lfoRateParameter.fromJson(e.lfoRateParameter,this.sequencerEngine),"isSynced"in e&&(this.isSynced=e.isSynced),"lfoRate"in e&&(Object(B.a)(e.lfoRate)&&this.isSynced?this.lfoRate=new x.a.Time(1/e.lfoRate).toNotation():this.lfoRate=e.lfoRate),"lfoMinParameter"in e&&this.lfoMinParameter.fromJson(e.lfoMinParameter,this.sequencerEngine),"lfoMin"in e&&(this.lfoMin=e.lfoMin),"lfoMaxParameter"in e&&this.lfoMaxParameter.fromJson(e.lfoMaxParameter,this.sequencerEngine),"lfoMax"in e&&(this.lfoMax=e.lfoMax),"lfoTypeParameter"in e&&this.lfoTypeParameter.fromJson(e.lfoTypeParameter,this.sequencerEngine),"lfoType"in e&&(this.lfoType=e.lfoType),"lfoPhaseParameter"in e&&this.lfoPhaseParameter.fromJson(e.lfoPhaseParameter,this.sequencerEngine),"lfoPhase"in e&&(this.lfoPhase=e.lfoPhase)}},{key:"copyFrom",value:function(e){this.lfoType=e.lfoType,this.lfoRate=e.lfoRate,this.lfoMin=e.lfoMin,this.lfoMax=e.lfoMax,this.lfoPhase=e.lfoPhase,this.isSynced=e.isSynced}},{key:"mateJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;na(t)&&(this.lfoTypeParameter.disconnectFromAllModulators(),this.lfoTypeParameter.fromJson(e.lfoTypeParameter,this.sequencerEngine)),na(t)&&(this.lfoRateParameter.disconnectFromAllModulators(),this.lfoRate=e.lfoRate,this.lfoRateParameter.fromJson(e.lfoRateParameter,this.sequencerEngine)),na(t)&&(this.lfoMinParameter.disconnectFromAllModulators(),this.lfoMinParameter.fromJson(e.lfoMinParameter,this.sequencerEngine)),na(t)&&(this.lfoMaxParameter.disconnectFromAllModulators(),this.lfoMaxParameter.fromJson(e.lfoMaxParameter,this.sequencerEngine)),na(t)&&(this.lfoPhaseParameter.disconnectFromAllModulators(),this.lfoPhaseParameter.fromJson(e.lfoPhaseParameter,this.sequencerEngine))}},{key:"getCopy",value:function(){var e=new n(this.sequencerEngine,this.mixSession,this.context,this.number);return e.fromJson(this.getJson()),e}},{key:"name",get:function(){return"LFO "+this.number}},{key:"lfoType",get:function(){return void 0===this.lfoTypeParameter?"sine":this.lfoTypeParameter.get()},set:function(e){this.lfoTypeParameter.set(e)}},{key:"lfoRate",get:function(){return this.lfoRateParameter.get()},set:function(e){this.lfoRateParameter.set(e),this.rawLFORate=e}},{key:"lfoMin",get:function(){return this.lfoMinParameter.get()},set:function(e){this.lfoMinParameter.set(e)}},{key:"lfoMax",get:function(){return this.lfoMaxParameter.get()},set:function(e){this.lfoMaxParameter.set(e)}},{key:"lfoPhase",get:function(){return this.lfoPhaseParameter.get()},set:function(e){this.lfoPhaseParameter.set(e)}}]),n}(ca),pa=function(){function e(t,n,r){var a=this;Object(o.a)(this,e),this.id=Object(A.uuid)(),this.context=r.getCopy().forMacro(this),this.sequencerEngine=n,this.name=t,this.subMacros=[],this.x=100,this.y=110,this.signal=new x.a.Signal(0),this.macroParameter=new Ln("macro",this.signal,function(e,t){var n={};for(var r in a.subMacros){var i=a.subMacros[r],s=i.updateRedux(t);n[i.parameter.id]=s.value}a.sequencerEngine.store.dispatch(Object(O.hb)(n))},{min:0,max:1,defaultValue:0,automationRate:F}),this.parameters=[],this.registerParameter(this.macroParameter)}return Object(c.a)(e,[{key:"registerParameter",value:function(e){void 0!==e&&(e.name=e.name,e.setStore(this.sequencerEngine.store),e.setContext(this.context),this.parameters.push(e))}},{key:"addParameter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.min,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.max,r=new ha(e,t,n);(e.audioParam||e.audioParams)&&this.signal.connect(r.scaler),this.subMacros.push(r),e.hasMacro=this}},{key:"isParameterMapped",value:function(e){return this.subMacros.some(function(t){return t.parameter===e})}},{key:"normalizeParameterValue",value:function(e,t){return this.subMacros.find(function(t){return t.parameter===e}).normalizeValue(t)}},{key:"unmapParameter",value:function(e){var t=this.subMacros.find(function(t){return t.parameter===e});if(void 0!==t){e.hasMacro=void 0,t.parameter.audioParam&&this.signal.disconnect(t.scaler);var n=this.subMacros.indexOf(t);this.subMacros.splice(n,1)}}},{key:"dispose",value:function(){this.subMacros.forEach(function(e){return e.dispose()}),this.subMacros=void 0,this.macroParameter.dispose(),this.signal=void 0,this.macroParameter=void 0}},{key:"getJson",value:function(){var e={id:this.id,x:this.x,y:this.y,name:this.name,subMacros:this.subMacros.map(function(e){return e.getJson()}),macroValue:this.macroParameter.get()};return e=sr(e,"macroParameter",this.macroParameter)}},{key:"getParameters",value:function(){return this.parameters}},{key:"fromJson",value:function(e,t){var n=this;e.id&&(this.id=e.id),this.name=e.name,this.x=e.x,this.y=e.y;var r=function(r){var a=e.subMacros[r],i=a.parameter,s=a.min,o=a.max;if(void 0===(i=t.find(function(e){return e.id===i})))return"continue";n.addParameter(i,s,o)};for(var a in e.subMacros)r(a);this.macroParameter.set(e.macroValue),or(e,"macroParameter",this.macroParameter,this.sequencerEngine)}}]),e}(),ha=function(){function e(t,n,r){Object(o.a)(this,e),this.parameter=t,this._min=n,this._max=r;var a=Math.abs(Math.min(this._min,this._max));if(this.scaler=new x.a.Scale(this._min+a,this._max+a),this.subtract=new x.a.Subtract(this._min<0||this._max<0?0:a),this.scaler.connect(this.subtract),this.parameter.audioParam)this.subtract.connect(this.parameter.audioParam);else if(this.parameter.audioParams)for(var i in this.parameter.audioParams){var s=this.parameter.audioParams[i].input||this.parameter.audioParams[i];this.subtract.connect(s)}this.parameter.automationRate=F}return Object(c.a)(e,[{key:"dispose",value:function(){this.scaler.disconnect(),this.scaler.dispose()}},{key:"normalizeValue",value:function(e){return this.min+(this.max-this.min)*e}},{key:"updateRedux",value:function(e){return e=this.normalizeValue(e),this.parameter.set(e,void 0,!0),{id:this.parameter.id,value:e}}},{key:"getJson",value:function(){return{parameter:this.parameter.id,min:this.min,max:this.max}}},{key:"min",set:function(e){this._min=e;var t=Math.abs(Math.min(this._min,this._max));this.scaler.min=e+t,this.scaler.max=this._max+t,this.subtract.value=this._min<0||this._max<0?0:t},get:function(){return this._min}},{key:"max",set:function(e){this._max=e;var t=Math.abs(Math.min(this._min,this._max));this.scaler.max=e+t,this.scaler.min=this._min+t,this.subtract.value=this._min<0||this._max<0?0:t},get:function(){return this._max}}]),e}(),fa=pa;function da(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ma=function(e){return function(e){Object(u.a)(n,e);var t=da(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).macros=[],e}return Object(c.a)(n,[{key:"connectNodeToMacro",value:function(e,t){e.audioParam&&t.addParameter(e)}},{key:"isMacro",value:function(e){return this.macros.indexOf(e)>-1}},{key:"deleteMacro",value:function(e){var t=this.macros.indexOf(e);this.macros.splice(t,1),e.dispose()}},{key:"newMacro",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.context,t="Macro "+(this.macros.length+1);console.log("setting context =",e);var n=new fa(t,this.sequencerEngine,e);return this.macros.push(n),n}},{key:"macroAdjacencyLists",get:function(){var e={};for(var t in this.macros){var n=this.macros[t],r=n.subMacros;e[n.id]=r}return e}}]),n}(e)};function va(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ga=function(e){return function(e){Object(u.a)(n,e);var t=va(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).configurations=[],e}return Object(c.a)(n,[{key:"initializeConfigurations",value:function(e){var t=this;this.loaded=!0,this.oldConfiguration=0,this.configurations[0]=e,this.configurationParameter=new Be("Configuration",this,function(e,n){t.switchToConfiguration(n)},{defaultValue:0,automatable:!1}),this.registerParameter(this.configurationParameter)}},{key:"newConfiguration",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?this.copyAdjacencyLists(this.adjacencyLists):{};this.configurations.push(e),this.currentConfiguration=this.configurations.length-1}},{key:"switchToConfiguration",value:function(e){var t=this;if(void 0!==this.configurationParameter){this.clearConfiguration(this.oldConfiguration);var n=this.configurations[e];this.adjacencyLists={};var r=function(e){for(var r in n[e]){var a=-1===parseInt(e)?t.inputNode:t.effects.find(function(t){return t.id===e}),i=n[e][r];a&&t.connectEdge(a,i)}};for(var a in n)r(a);this.oldConfiguration=this.currentConfiguration}}},{key:"clearConfiguration",value:function(e){var t=this,n=this.copyAdjacencyLists(this.adjacencyLists,!0);for(var r in this.adjacencyLists)this.adjacencyLists[r].forEach(function(e){return t.deleteEdge(e)});this.loaded&&(this.configurations[e]=n)}},{key:"copyAdjacencyLists",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.adjacencyLists,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={};for(var r in e)n[r]=t?Object(M.a)(e[r]):e[r].map(function(e){return e.getCopy()});return n}},{key:"getConfigurationJson",value:function(){var e=this,t=[];for(var n in this.configurations){var r=this.configurations[n],a={};for(var i in r)a[i]=r[i].map(function(t){return t.getJson(e)});t.push(a)}return t}},{key:"loadConfigurationJson",value:function(e){console.log("loading configuration =",e);var t=[];for(var n in e){var r=e[n],a={};for(var i in r){var s=[];for(var o in r[i]){var c=new ta(void 0,this.sequencerEngine);c.fromJson(r[i][o],this),s.push(c)}a[i]=s}console.log("pushing adjacency list =",a),t.push(a)}this.configurations=t,console.log("configuration =",t)}},{key:"currentConfiguration",set:function(e){this.configurationParameter.set(e)},get:function(){return this.configurationParameter.get()}}]),n}(e)};function ya(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ba=function(e){Object(u.a)(n,e);var t=ya(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Effect Rack",function(){return new x.a.Gain(1)},e)).inputNode=r.effectNode,r.inputNode.x=0,r.inputNode.y=200,r.outputNode=new x.a.Gain(1),r.outputNode.x=400,r.outputNode.y=200,r.adjacencyLists={},r.effects=[],r.initializeConfigurations(r.adjacencyLists),r}return Object(c.a)(n,[{key:"onBPMUpdated",value:function(){for(var e in this.effects)this.effects[e].onBPMUpdated&&this.effects[e].onBPMUpdated()}},{key:"getSubDevices",value:function(){return this.effects.map(function(e){return{value:e,label:e.name}})}},{key:"getSubDeviceIndex",value:function(e){return this.effects.indexOf(e)}},{key:"getSubDevice",value:function(e){return this.effects[e]}},{key:"getParameters",value:function(){var e=Object(M.a)(this.parameters);for(var t in this.effects)e=[].concat(Object(M.a)(e),Object(M.a)(this.effects[t].getParameters()));for(var n in this.macros)e=[].concat(Object(M.a)(e),Object(M.a)(this.macros[n].parameters));return e}},{key:"getModAdjacencyLists",value:function(e){var t=this,n=this.modulators.filter(function(t){return t.getType()===e}),r={};for(var a in n){var i=n[a],s=Object.values(i.idToParameter).filter(function(e){return t.effects.some(function(t){return t.parameters.indexOf(e)>-1})||t.macros.some(function(t){return t.parameters.indexOf(e)>-1})});0!==s.length&&(void 0===r[i.number]&&(r[i.number]=[]),r[i.number]=s)}return r}},{key:"registerContext",value:function(e){var t=this;Object(q.a)(Object(p.a)(n.prototype),"registerContext",this).call(this,e),this.effects.forEach(function(n){return n.registerContext(e,t)})}},{key:"setSize",value:function(e,t,n,r){this.inputNode.x=0,this.inputNode.y=t/2-r/2,this.outputNode.x=e-n,this.outputNode.y=t/2-r/2}},{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(){this.outputNode.disconnect()}},{key:"addEffect",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.x=200,e.y=200,t&&e.enable(!0),t&&e.wetParameter&&e.wetParameter.set(1);var n=(this.context||new Wr).getCopy();n.forEffect(this),e.registerContext(n,this),this.effects.push(e)}},{key:"dispose",value:function(){for(var e in this.effects.forEach(function(e){return e.dispose()}),this.adjacencyLists)this.adjacencyLists[e]&&this.adjacencyLists[e].forEach(function(e){return e.dispose()});this.adjacencyLists=void 0,Object(q.a)(Object(p.a)(n.prototype),"dispose",this).call(this)}},{key:"deleteEffect",value:function(e){var t=this,n=this.adjacencyLists[e.id]||[];for(var r in n.forEach(function(e){return t.deleteEdge(e)}),this.adjacencyLists)(n=this.adjacencyLists[r].filter(function(t){return t.effect===e})).forEach(function(e){return t.deleteEdge(e)});for(var a in this.lfoAdjacencyLists)void 0!==this.lfoAdjacencyLists[a]&&(n=this.lfoAdjacencyLists[a].filter(function(t){return e.parameters.indexOf(t)>-1})).forEach(function(e){return t.deleteEdge(e)});for(var i in this.envelopeAdjacencyLists)void 0!==this.envelopeAdjacencyLists[i]&&(n=this.envelopeAdjacencyLists[i].filter(function(t){return e.parameters.indexOf(t)>-1})).forEach(function(e){return t.deleteEdge(e)});e.dispose(),this.effects.splice(this.effects.indexOf(e),1)}},{key:"deleteEdge",value:function(e){var t=this;if(e.modulator){var n=e.edge,r=e.modulator;r.getType()===qe?n.disconnectFromLFO(r):n.disconnectFromEnvelope(r)}else{var a=function(n){var r=t.adjacencyLists[n],a=r.indexOf(e);if(a>-1)if(r.splice(a,1),-1===parseInt(n))t.inputNode.disconnect(e.gain);else{var i=t.effects.find(function(e){return e.id===n});i&&i.disconnect(e.gain)}};for(var i in this.adjacencyLists)a(i)}}},{key:"getLFO",value:function(e){return this.modulators.filter(function(e){return e.getType()===qe}).find(function(t){return t.number===e})}},{key:"getEnvelope",value:function(e){return this.modulators.filter(function(e){return e.getType()===Me}).find(function(t){return t.number===e})}},{key:"connectEdge",value:function(e,t){var n=void 0;return n=e.effectNode?e.id:-1,e.connect(t.gain),void 0===this.adjacencyLists[n]&&(this.adjacencyLists[n]=[]),this.adjacencyLists[n].push(t),t}},{key:"connectNodes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.effectNode,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.outputNode;if(this.isMacro(e))this.connectNodeToMacro(t,e);else if(e.getType)e.getType()===qe&&t.connectToLFO?t.connectToLFO(e):t.connectToEnvelope&&t.connectToEnvelope(e);else if(!t.isAudioParamEnabled){var n=new ta(t,this.sequencerEngine);return this.connectEdge(e,n),n}}},{key:"getJson",value:function(){var e=this,t={},r=function(n){var r=e.adjacencyLists[n].map(function(t){return t.getJson(e)});if(-1===parseInt(n))t[n]=r;else{var a=e.effects.find(function(e){return e.id===n});t[e.effects.indexOf(a)]=r}};for(var a in this.adjacencyLists)r(a);var i=Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),i,{configurations:this.getConfigurationJson(),currentConfiguration:this.currentConfiguration,macros:this.macros.map(function(e){return e.getJson()}),adjacencyLists:t,effects:this.effects.map(function(e){return Object(D.a)({},e.getJson(),{x:e.x,y:e.y})})});return i=sr(i,"configurationParameter",this.configurationParameter)}},{key:"fromJson",value:function(){var e=Object(R.a)(N.a.mark(function e(t,r,a,i){var s,o,c,u,l,h,f,d,m,v,g;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.loaded=!1,Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,t,i),s=t.effects,e.t0=N.a.keys(s);case 4:if((e.t1=e.t0()).done){e.next=15;break}return o=e.t1.value,c=s[o],e.next=9,Sa(c,r,this.sequencerEngine,a);case 9:u=e.sent,this.addEffect(u,!1),u.x=c.x,u.y=c.y,e.next=4;break;case 15:for(h in t.configurations&&this.loadConfigurationJson(t.configurations),l=t.adjacencyLists)for(d in(f=this.effects[h])||(f=this.inputNode),l[h])(m=new ta(void 0,this.sequencerEngine)).fromJson(l[h][d],this),this.connectEdge(f,m);if(void 0!==t.currentConfiguration&&(this.currentConfiguration=t.currentConfiguration),this.loadParameterFromJson(t,"configurationParameter",this.configurationParameter,i),t.macros)for(g in v=this.getParameters(),t.macros)this.newMacro(this.context.getCopy().forEffect(this)).fromJson(t.macros[g],v);this.loaded=!0;case 22:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine),t=this.context.track;return e.fromJson(this.getJson(),this.sequencerEngine.tracks,t.trackNumber,!0),e}},{key:"nodes",get:function(){return this.effects}},{key:"lfoAdjacencyLists",get:function(){return this.getModAdjacencyLists(qe)}},{key:"envelopeAdjacencyLists",get:function(){return this.getModAdjacencyLists(Me)}},{key:"modulators",get:function(){return[].concat(Object(M.a)(this.sequencerEngine.lfos.map(function(e){return e.lfo})),Object(M.a)(this.sequencerEngine.envelopes))}}]),n}(ga(ma(Xn.Effect)));function ka(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ea=function(e){Object(u.a)(n,e);var t=ka(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Stereo Delay",function(){return new x.a.Gain(1)},e)).initComponents(),r.isSynced=!0,r.wetParameter=new Be("Wet",Object(W.a)(r),function(e,t){r.leftDelay.wetParameter.set(t),r.rightDelay.wetParameter.set(t)},{min:0,max:1,unit:"",defaultValue:0,constantAutomationRate:!0}),r.registerParameter(r.wetParameter),r.feedbackParameter=new Be("Feedback",Object(W.a)(r),function(e,t){r.leftDelay.feedbackParameter.set(t),r.rightDelay.feedbackParameter.set(t)},{min:0,max:1,unit:"",defaultValue:0,constantAutomationRate:!0}),r.registerParameter(r.feedbackParameter),r}return Object(c.a)(n,[{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"initComponents",value:function(){this.leftDelay=new Zn(this.sequencerEngine),this.rightDelay=new Zn(this.sequencerEngine),this.effectNode.connect(this.leftDelay.effectNode),this.effectNode.connect(this.rightDelay.effectNode),this.merger=new x.a.Merge,this.leftDelay.connect(this.merger.left),this.rightDelay.connect(this.merger.right),this.outputNode=new x.a.Gain(1),this.merger.connect(this.outputNode)}},{key:"getJson",value:function(){var e=Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{leftDelay:this.leftDelay.getJson(),rightDelay:this.rightDelay.getJson(),wet:this.wetParameter.get(),feedback:this.feedbackParameter.get(),isSynced:this.isSynced});return e=this.saveParameterToJson(e,"wetParameter",this.wetParameter),e=this.saveParameterToJson(e,"feedbackParameter",this.feedbackParameter)}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),this.isSynced=e.isSynced,this.wetParameter.set(e.wet),this.feedbackParameter.set(e.feedback),this.leftDelay.fromJson(e.leftDelay),this.rightDelay.fromJson(e.rightDelay),this.loadParameterFromJson(e,"feedbackParameter",this.feedbackParameter,t),this.loadParameterFromJson(e,"wetParameter",this.wetParameter,t)}},{key:"getEffectCopy",value:function(){var e=new n(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),n}(Xn.Effect),Oa={Filter:function(e){return new Xn.FilterEffect(e)},Delay:function(e){return new Zn(e)},Reverb:function(e){return new Xn.ReverbEffect(e)},"Convolver Reverb":function(e){return new kr(e)},Tremolo:function(e){return new Xn.TremoloEffect(e)},Chorus:function(e){return new Xn.ChorusEffect(e)},Gate:function(e){return new Br(e)},"Auto Filter":function(e){return new Xn.AutoFilterEffect(e)},"Multiband Compressor":function(e){return new hr(e)},Distortion:function(e){return new xr(e)},Compressor:function(e){return new jr(e)},"Bit Crusher":function(e){return new Pr(e)},"EQ 3":function(e){return new Mr(e)},"EQ 10":function(e){return new Lr(e)},"Auto Wah":function(e){return new er(e)},Phaser:function(e){return new dr(e)},"Ultra Phaser":function(e){return new dr(e)},"Pitch Shift":function(e){return new Nr(e)},Panner:function(e){return new Dr(e)},EQ8:function(e){return new Gr(e)},Chebyshev:function(e){return new Or(e)},"Stereo Widener":function(e){return new rr(e)},"Tape Delay":function(e){return new ea(e)},Saturator:function(e){return new Zr(e)},"Stereo Delay":function(e){return new Ea(e)},Oscilloscope:function(e){return new ir(e)},"Effect Rack":function(e){return new ba(e)},Pan:function(e){return new Xn.PanEffect(e)}};function Sa(e,t,n,r){return Pa.apply(this,arguments)}function Pa(){return(Pa=Object(R.a)(N.a.mark(function e(t,n,r,a){var i,s,o;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.name,s=Oa[i](r),void 0!==a&&(o=(new Wr).forTrack(n[a]),s.registerContext(o)),s.fromJson(t,n,a),e.abrupt("return",s);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}var wa=function(){function e(t,n,r,a){Object(o.a)(this,e),this.inputNode=t,this.effectsInputNode=new x.a.Gain,this.inputNode.connect(this.effectsInputNode),this.outputNode=n,this.mixSession=a.mixSession,this.parameterContext=r,this.sequencerEngine=a,this.effects=[],this.samplerConnectedToMaster=!1}return Object(c.a)(e,[{key:"initDefault",value:function(){this.effects=(this.sequencerEngine,[]),this.updateEffects()}},{key:"setupEffects",value:function(){this.connectEffects(this.effectsInputNode,this.effects)}},{key:"updateEffects",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.effects;this.effects=t,this.effects.map(function(t){return t.track=e}),this.connectEffects(this.effectsInputNode,t)}},{key:"disconnectAll",value:function(){this.effects.map(function(e){return e.disconnect()})}},{key:"makePublicIfNeeded",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=N.a.keys(this.effects);case 1:if((e.t1=e.t0()).done){e.next=7;break}return t=e.t1.value,e.next=5,this.effects[t].makePublicIfNeeded();case 5:e.next=1;break;case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"connectEffects",value:function(e,t){e.disconnect(),this.effects.map(function(e){return e.disconnect()});for(var n=e,r=0;r<t.length;r++){var a=t[r].getEffect();t[r].isEnabled()&&(n.connect(a),n=t[r])}n.connect(this.outputNode),this.linkEffectParameters()}},{key:"linkEffectParameters",value:function(){var e=this;this.effects.forEach(function(t){t.registerContext(e.parameterContext),t.registerMixSession(e.mixSession)})}},{key:"dispose",value:function(){this.effectsInputNode.disconnect(),this.effectsInputNode.dispose(),this.effects.forEach(function(e){return e.disconnect()}),this.effects.forEach(function(e){return e.dispose()}),this.effects=void 0}},{key:"clear",value:function(){this.effects.forEach(function(e){return e.disconnect()}),this.effects.forEach(function(e){return e.dispose()}),this.effects=[]}},{key:"start",value:function(){this.effects.filter(function(e){return e.syncable()}).forEach(function(e){return e.start()}),this.effects.forEach(function(e){return e.parameters.filter(function(e){return e.isConnectedToAnyModulator()}).forEach(function(e){return e.refresh()})})}},{key:"getAllParameters",value:function(){var e=[];return this.effects.forEach(function(t){return t.getParameters().forEach(function(t){return e.push(t)})}),e}},{key:"getAllPatternLockedParameters",value:function(){return this.getAllParameters().filter(function(e){return e.hasPatternLockedValues()})}},{key:"moveEffectTo",value:function(e,t){if(e!=t){this.effectsInputNode.disconnect(this.effects[0]),this.effects.forEach(function(e){return e.disconnect()});var n=[];e>t?(n=this.effects.slice(0,t).concat([this.effects[e]]).concat(this.effects.slice(t,e)),this.effects.length>e+1&&(n=n.concat(this.effects.slice(e+1)))):(n=this.effects.slice(0,e).concat(this.effects.slice(e+1,t)).concat([this.effects[t],this.effects[e]]),this.effects.length>t+1&&(n=n.concat(this.effects.slice(t+1)))),this.updateEffects(n)}}},{key:"onBPMUpdated",value:function(){for(var e in this.effects)this.effects[e].onBPMUpdated&&this.effects[e].onBPMUpdated()}},{key:"getEffectNumber",value:function(e){var t=e.id;return this.effects.map(function(e){return e.id}).indexOf(t)}},{key:"getEffectById",value:function(e){return this.effects.find(function(t){return t.id===e})}},{key:"addEffect",value:function(e){this.effects=[].concat(Object(M.a)(this.effects),[e]),this.updateEffects()}},{key:"deleteEffect",value:function(e){var t=this.getEffectNumber(e);t<0||(e.disconnect(),t>0&&this.effects[t-1].disconnect(),this.effects.splice(t,1),this.effects=Object(M.a)(this.effects),this.updateEffects(this.effects))}},{key:"getCopy",value:function(t){var n=new e(t.gainNode,t.trackNode,(new Wr).forTrack(t),this.sequencerEngine);return n.effects=this.effects.map(function(e){return e.getEffectCopy()}),n}},{key:"getJson",value:function(){return this.effects.map(function(e){return e.getJson()})}},{key:"mate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=Math.max(e.effects.length,this.effects.length),r=[];e.disconnectAll();for(var a=[],i=0;i<n;i++){var s=this.effects[i],o=e.effects[i];na(t)?(o&&r.push(o.getEffectCopy(this.track)),s&&a.push(s)):s&&r.push(s)}this.updateEffects(r),a.forEach(function(e){return e.dispose()}),e.effectsInputNode.disconnect(),e.effectsInputNode.dispose()}},{key:"fromJson",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n,r){var a,i;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=N.a.keys(t);case 1:if((e.t1=e.t0()).done){e.next=11;break}return a=e.t1.value,i=t[a],e.t2=this,e.next=7,Sa(i,n,this.sequencerEngine,r);case 7:e.t3=e.sent,e.t2.addEffect.call(e.t2,e.t3),e.next=1;break;case 11:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()}]),e}(),ja=function e(t,n,r){Object(o.a)(this,e),this.stepData=t,this.time=n,this.stepNumber=r},Ta=function(){function e(t,n){Object(o.a)(this,e),this.id=Object(A.uuid)(),this.track=n,this.sequencerEngine=n.sequencerEngine,this.store=this.sequencerEngine.store,this.name=t,this.parameters=[],this.enabledParameter=new Be("enabled",this,function(e,t){return[]},{min:!1,max:!0,unit:"",defaultValue:!0,automatable:!1}),this.registerParameter(this.enabledParameter)}return Object(c.a)(e,[{key:"toggleEnabled",value:function(){this.enabled=!this.enabled}},{key:"isEnabled",value:function(){return this.enabled}},{key:"getJson",value:function(){var e={name:this.name,enabled:this.enabled,id:this.id};for(var t in e=this.saveParameterToJson(e,"enabledParameter",this.enabledParameter),this.parameters){var n=this.parameters[t];e[n.name]=n.get();var r=n.name+"Parameter";e=this.saveParameterToJson(e,r,n)}return e}},{key:"fromJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var n in void 0===e.id||t||(this.id=e.id),this.enabled=e.enabled,this.loadParameterFromJson(e,"enabledParameter",this.enabledParameter),this.parameters){var r=this.parameters[n],a=e[r.name];void 0!==a&&r.set(a),this.loadParameterFromJson(e,r.name+"Parameter",r)}}},{key:"registerContext",value:function(e){e=e.forEffect(this),this.parameters.forEach(function(t){return t.setContext(e)})}},{key:"registerMixSession",value:function(e){this.parameters.forEach(function(t){return t.setMixSession(e)})}},{key:"registerTrack",value:function(e){this.parameters.forEach(function(t){return t.setTrack(e)})}},{key:"registerParameter",value:function(e){void 0!==e&&(e.effectName=this.name,e.setStore(this.store),this.parameters.push(e))}},{key:"saveParameterToJson",value:function(e,t,n){return sr(e,t,n)}},{key:"loadParameterFromJson",value:function(e,t,n){or(e,t,n)}},{key:"enabled",get:function(){return this.enabledParameter.get()},set:function(e){this.enabledParameter.set(e)}}]),e}();function xa(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ca=function(e){Object(u.a)(n,e);var t=xa(n);function n(e,r){var a;return Object(o.a)(this,n),(a=t.call(this,e,r)).cacheSize=16,a.initCache(),a.triggers=[],a}return Object(c.a)(n,[{key:"registerContext",value:function(e,t){var n=this;this.context?this.context.combineWith(e):this.context=e.getCopy(),t?(this.context.forSubDevice(this),this.context.forMidiEffect(t)):this.context.forMidiEffect(this),this.parameters.forEach(function(e){return e.setContext(n.context)})}},{key:"isRealTime",value:function(){return!0}},{key:"getEffectType",value:function(){return"MIDI_FX"}},{key:"isMidiEffect",value:function(){return!0}},{key:"needsStableLookAhead",value:function(){return!1}},{key:"onNewStep",value:function(){this.clear()}},{key:"clear",value:function(){this.triggers=[]}},{key:"input",value:function(e){this.triggers.push(e)}},{key:"output",value:function(){}},{key:"removeNote",value:function(){}},{key:"getCopy",value:function(e){return this}},{key:"addNote",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.getStep(this.track.trackData,e,null,!1);r.velocity=this.track.trackData.velocity,r.duration=null,r.transpose=e,r.slice=t,this.input(new ja(r,0,n),!0)}},{key:"getStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.transpose,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.duration,r=void 0;return!(arguments.length>3&&void 0!==arguments[3])||arguments[3]?(r=this.cachedSteps[this.cacheIndex],this.cacheIndex=(this.cacheIndex+1)%this.cachedSteps.length):r=new Ge(void 0,void 0,void 0,this.track),r.transpose=t,r.velocity=e.velocity,r.duration=n,r.attack=e.attack,r.release=e.release,r.start=e.start,r.chop=e.chop,r.pitchAttack=e.pitchAttack,r.pitchSustain=e.pitchSustain,r.pitchRelease=e.pitchRelease,r.pitchDecay=e.pitchDecay,r.slice=e.slice,r.reverse=e.reverse,r.panning=e.panning,r.selectedRecording=e.selectedRecording,r}},{key:"initCache",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cacheSize;this.cachedSteps=[];for(var t=0;t<e;t++){var n=new Ge(void 0,void 0,void 0,this.track);n.loadDefaults(),this.cachedSteps.push(n)}this.cacheIndex=0}},{key:"copyTrigger",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getStep(e.stepData,void 0,void 0,t);return new ja(n,e.time,e.stepNumber)}},{key:"dispose",value:function(){}},{key:"getParameters",value:function(){return this.parameters}}]),n}(Ta),Na=new Xe(32,!1),Ra={};function Da(e,t){var n=Ra[e];if(void 0!==n){var r=n[t.toString()];if(void 0!==r)return r}else Ra[e]={};var a=function(e,t){var n=t.transformStepAtResolution2(e,Na),r=t.transformStepAtResolution2(e+1,Na),a=[];Math.floor(n)==n?a.push(n):r-n>1&&a.push(Math.ceil(n));Math.floor(r)>Math.floor(n)&&Math.floor(r)!=r&&a.push(Math.floor(r));for(var i=[],s=0;s<a.length;s++){var o=a[s],c=Na.transformStepAtResolution2(o,t),u=c-e;i.push({step:o,time:new x.a.Time("32n")*u})}return i}(e,t);return Ra[e][t.toString()]=a,a}function qa(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ma=function(e){Object(u.a)(n,e);var t=qa(n);function n(e,r,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object(o.a)(this,n),t.call(this,e,r,a,i)}return Object(c.a)(n,[{key:"getOptionFromNumber",value:function(e){if((e=parseFloat(e))in this.fromCache)return this.fromCache[e];var t=1e4,n=void 0;for(var r in this.options){var a=Math.abs(e-parseFloat(r));a<t&&(t=a,n=this.options[r])}return this.fromCache[e]=n,n}},{key:"getNumberFromOption",value:function(e){if(e.toString()in this.toCache)return this.toCache[e.toString()];for(var t in this.options)if(e.equals&&e.equals(this.options[t])||this.options[t]===e)return this.toCache[e.toString()]=parseFloat(t),parseFloat(t)}},{key:"set",value:function(e){var t="number"===typeof e?e:this.getNumberFromOption(e);Object(q.a)(Object(p.a)(n.prototype),"set",this).call(this,t)}},{key:"get",value:function(e){var t=Object(q.a)(Object(p.a)(n.prototype),"get",this).call(this,e);return t in this.options?this.options[t]:this.getOptionFromNumber(t)}},{key:"options",get:function(){return this.config.options}}]),n}(Be),Aa="DOWN",Ia="UP";function La(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Fa=function(e){Object(u.a)(n,e);var t=La(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Arpeggiator",e)).notesToRemove=[],r.arpRateParameter=new Ma("arpRate",Object(W.a)(r),function(e,t){return t},{min:0,max:1,unit:"",options:{0:new Xe(4,!1),.1:new Xe(4,!0),.2:new Xe(8,!1),.3:new Xe(8,!0),.4:new Xe(16,!1),.5:new Xe(16,!0),.6:new Xe(32,!1),.7:new Xe(32,!0)},defaultValue:new Xe(16,!1)}),r.registerParameter(r.arpRateParameter),r.arpOctavesParameter=new Be("arpOctaves",Object(W.a)(r),function(e,t){return t},{min:0,max:8,unit:"",defaultValue:1}),r.registerParameter(r.arpOctavesParameter),r.arpDirectionParameter=new Be("arpDirection",Object(W.a)(r),function(e,t){return t},{min:Aa,max:Ia,unit:"",defaultValue:Aa}),r.registerParameter(r.arpDirectionParameter),r.arpDurationFactorParameter=new Be("arpDurationFactor",Object(W.a)(r),function(e,t){return t},{min:1e-4,max:8,unit:"x",defaultValue:1}),r.registerParameter(r.arpDurationFactorParameter),r.arpRepeatParameter=new Be("arpRepeatFactor",Object(W.a)(r),function(e,t){return t},{min:1,max:8,unit:"x",defaultValue:1}),r.registerParameter(r.arpRepeatParameter),r.noteToDuration={},r.notes=[],r.index=0,r.repeatIndex=0,r.currentOctave=0,r}return Object(c.a)(n,[{key:"isRealTime",value:function(){return!1}},{key:"onNewStep",value:function(){}},{key:"clear",value:function(){this.noteToDuration={},this.notesToRemove=[],this.notes=[],this.repeatIndex=0,this.index=0,this.arpDirection===Aa?this.currentOctave=this.arpOctaves:this.currentOctave=0}},{key:"input",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.stepData.duration,r=e.stepData.transpose;t||(r in this.noteToDuration?this.noteToDuration[r]=this.noteToDuration[r]+2*n:this.noteToDuration[r]=2*n),this.getIndexOfTrigger(e)<0&&(e.stepData=this.getStep(e.stepData,r,n,!1),this.notes.push(e),this.notes=this.notes.sort(function(e,t){return e.stepData.transpose-t.stepData.transpose}),this.arpDirection===Aa&&this.notes.reverse())}},{key:"output",value:function(e,t,n){var r=this,a=this.getNextTriggers(t).map(function(t){return t.time+=e,t.stepNumber=n,t});return this.notesToRemove.forEach(function(e){return r.actuallyRemoveNote(e)}),this.notesToRemove=[],a}},{key:"getIndexOfTrigger",value:function(e){for(var t in this.notes)if(this.notes[t].stepData.transpose===e.stepData.transpose)return t;return-1}},{key:"actuallyRemoveNote",value:function(e){var t=-1;for(var n in this.notes)if(e===this.notes[n].stepData.transpose){t=n;break}t>-1&&this.notes.splice(t,1),this.index>=this.notes.length&&(this.index=0,this.currentOctave=0),0===this.notes.length&&this.clear()}},{key:"removeNote",value:function(e){this.notesToRemove.push(e)}},{key:"nextNote",value:function(e){if(0!=this.notes.length){var t=this.notes[this.index],n=t.stepData.transpose;n+=12*this.currentOctave,this.repeatIndex++,this.repeatIndex>=this.arpRepeat&&(this.repeatIndex=0,this.index++),this.index>=this.notes.length&&(this.index=0,this.arpDirection===Ia?this.currentOctave=(this.currentOctave+1)%(e+1):this.arpDirection===Aa&&(this.currentOctave=(this.currentOctave-1)%(e+1),this.currentOctave<0&&(this.currentOctave=e)));var r=this.getStep(t.stepData,n,this.track.trackData.duration*this.arpDurationFactor);return new ja(r,t.time,t.stepNumber)}}},{key:"getNextTriggers",value:function(e){var t=this,n=Da(e,this.arpRate).map(function(e){var n=t.nextNote(t.arpOctaves);return void 0!==n&&(n.time=e.time),n}).filter(function(e){return void 0!==e});for(var r in void 0===window.timeB&&(window.timeB=0,window.timeBCount=0),this.noteToDuration)this.noteToDuration[r]-=1,this.noteToDuration[r]<=0&&(delete this.noteToDuration[r],this.removeNote(parseInt(r)));return 0===Object.keys(this.noteToDuration).length&&0===this.notes.length&&this.clear(),n}},{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson(),!0),t}},{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{arpRate:this.arpRate.getJson()})}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),this.arpRate=new Xe(16,!1).fromJson(e.arpRate)}},{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson(),!0),t}},{key:"arpRate",get:function(){return this.arpRateParameter.get()},set:function(e){this.arpRateParameter.set(e)}},{key:"arpOctaves",get:function(){return this.arpOctavesParameter.get()}},{key:"arpDirection",get:function(){return this.arpDirectionParameter.get()}},{key:"arpDurationFactor",get:function(){return this.arpDurationFactorParameter.get()}},{key:"arpRepeat",get:function(){return this.arpRepeatParameter.get()}}]),n}(Ca);function Ba(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ha=function(e){Object(u.a)(n,e);var t=Ba(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Harmony",e)).pitchParameter=new Be("pitch",Object(W.a)(r),function(e,t){return t},{min:-32,max:32,unit:"",defaultValue:5}),r.registerParameter(r.pitchParameter),r.timingOffsetParameter=new Be("timingOffset",Object(W.a)(r),function(e,t){return t},{min:0,max:4,unit:"",defaultValue:0}),r.registerParameter(r.timingOffsetParameter),r.velocityParameter=new Be("velocity",Object(W.a)(r),function(e,t){return t},{min:0,max:1,unit:"",defaultValue:1}),r.registerParameter(r.velocityParameter),r.probabilityParameter=new Be("probability",Object(W.a)(r),function(e,t){return t},{min:0,max:100,unit:"",defaultValue:100}),r.registerParameter(r.probabilityParameter),r}return Object(c.a)(n,[{key:"output",value:function(){var e=[];for(var t in this.triggers){var n=this.triggers[t];if(e.push(n),this.probability/100>=Math.random()){var r=n.stepData.getCopy(!0,!1,!0,!0,!1);r.transpose+=this.pitch,r.velocity=this.velocity;var a=n.time+this.timingOffset*new x.a.Time("32n").toMilliseconds()/1e3;e.push(new ja(r,a,n.stepNumber))}}return e}},{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson(),!0),t}},{key:"pitch",get:function(){return this.pitchParameter.get()}},{key:"velocity",get:function(){return this.velocityParameter.get()}},{key:"timingOffset",get:function(){return this.timingOffsetParameter.get()}},{key:"probability",get:function(){return this.probabilityParameter.get()}}]),n}(Ca);function Va(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ua=function(e){Object(u.a)(n,e);var t=Va(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Parameterizer",e)).parameter=void 0,r.factorParameter=new Be("factor",Object(W.a)(r),function(e,t){return t},{min:0,max:1,unit:"",defaultValue:1}),r.registerParameter(r.factorParameter),r.offsetParameter=new Be("offset",Object(W.a)(r),function(e,t){return t},{min:-16,max:16,unit:"",defaultValue:0}),r.registerParameter(r.offsetParameter),r.probabilityParameter=new Be("probability",Object(W.a)(r),function(e,t){return t},{min:0,max:100,unit:"",defaultValue:100}),r.registerParameter(r.probabilityParameter),r}return Object(c.a)(n,[{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson(),!0),t}},{key:"getAvailableParameters",value:function(){return[this.track.trackData.durationParameter,this.track.trackData.chopParameter,this.track.trackData.velocityParameter,this.track.trackData.transposeParameter,this.track.trackData.startParameter,this.track.trackData.attackParameter,this.track.trackData.releaseParameter,this.track.trackData.pitchAttackParameter,this.track.trackData.pitchDecayParameter,this.track.trackData.pitchSustainParameter,this.track.trackData.pitchReleaseParameter]}},{key:"output",value:function(){var e=this;if(void 0===this.parameter)return this.triggers;for(var t in this.triggers){var n=this.triggers[t],r=this.getStep(n.stepData,void 0,void 0,!0),a=r.parameters.filter(function(t){return t.name===e.parameter.name});if(a.length>0){var i=a[0].get();Math.random()<this.probability/100&&a[0].set(i*this.factor+this.offset)}n.stepData=r}return this.triggers}},{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{parameter:void 0===this.parameter?void 0:this.parameter.name})}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t);var r=this.getAvailableParameters();void 0!==e.parameter&&(this.parameter=r.filter(function(t){return t.name===e.parameter})[0])}},{key:"factor",set:function(e){this.factorParameter.set(e)},get:function(){return this.factorParameter.get()}},{key:"offset",set:function(e){this.offsetParameter.set(e)},get:function(){return this.offsetParameter.get()}},{key:"probability",set:function(e){this.probabilityParameter.set(e)},get:function(){return this.probabilityParameter.get()}}]),n}(Ca);function Ja(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var _a=function(e){Object(u.a)(n,e);var t=Ja(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Timing",e)).oddOffsetParameter=new Be("oddTiming",Object(W.a)(r),function(e,t){return t},{min:0,max:4,unit:"1/32th",defaultValue:0}),r.registerParameter(r.oddOffsetParameter),r.evenOffsetParameter=new Be("evenTiming",Object(W.a)(r),function(e,t){return t},{min:0,max:4,unit:"1/32th",defaultValue:0}),r.registerParameter(r.evenOffsetParameter),r.probabilityParameter=new Be("probability",Object(W.a)(r),function(e,t){return t},{min:0,max:100,unit:"",defaultValue:100}),r.registerParameter(r.probabilityParameter),r.resolutionParameter=new Be("resolution",Object(W.a)(r),function(e,t){return t},{min:1,max:32,unit:"",defaultValue:2}),r.registerParameter(r.resolutionParameter),r}return Object(c.a)(n,[{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson()),t}},{key:"needsStableLookAhead",value:function(){return!0}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),e.oddOffset&&(this.oddOffset=e.oddOffset),e.evenOffset&&(this.evenOffset=e.evenOffset)}},{key:"output",value:function(){for(var e in this.triggers){var t=this.triggers[e],n=t.time;if(Math.random()<=this.probability/100){var r=Math.floor(t.stepNumber/this.resolution)%2==0?this.evenOffset:this.oddOffset;t.time=n+r*new x.a.Time("32n").toMilliseconds()/1e3}}return this.triggers}},{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson(),!0),t}},{key:"oddOffset",get:function(){return this.oddOffsetParameter.get()},set:function(e){this.oddOffsetParameter.set(e)}},{key:"evenOffset",get:function(){return this.evenOffsetParameter.get()},set:function(e){this.evenOffsetParameter.set(e)}},{key:"probability",set:function(e){this.probabilityParameter.set(e)},get:function(){return this.probabilityParameter.get()}},{key:"resolution",get:function(){return this.resolutionParameter.get()},set:function(e){return this.resolutionParameter.set(e)}}]),n}(Ca);function Ga(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var za=function(e){Object(u.a)(n,e);var t=Ga(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Midi Outputter",e)).trackOutputParameter=new Be("trackOutput",Object(W.a)(r),function(e,t){return t},{min:0,max:16,unit:"",defaultValue:void 0}),r.registerParameter(r.trackOutputParameter),r.probabilityParameter=new Be("probability",Object(W.a)(r),function(e,t){return t},{min:0,max:100,unit:"",defaultValue:100}),r.registerParameter(r.probabilityParameter),r}return Object(c.a)(n,[{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson(),!0),t}},{key:"getAvailableParameters",value:function(){return[this.track.trackData.durationParameter,this.track.trackData.chopParameter,this.track.trackData.velocityParameter,this.track.trackData.transposeParameter,this.track.trackData.attackParameter,this.track.trackData.releaseParameter,this.track.trackData.pitchAttackParameter,this.track.trackData.pitchDecayParameter,this.track.trackData.pitchSustainParameter,this.track.trackData.pitchReleaseParameter]}},{key:"output",value:function(e,t,n){if(Math.random()<this.probability/100&&this.trackOutput){var r=this.track.subSequence.tracks[this.trackOutput];if(void 0===r)return this.triggers;for(var a in r.onNewStep(),this.triggers)r.midiEffects.input(this.getStep(this.triggers[a].stepData,void 0,void 0,!0),this.triggers[a].time,n);r.midiEffects.output(e,t,n).forEach(function(e){return r.trigger(e.stepData,e.time)}),r.onStepEnded(e,t)}return this.triggers}},{key:"trackOutput",set:function(e){this.trackOutputParameter.set(e)},get:function(){return this.trackOutputParameter.get()}},{key:"probability",set:function(e){this.probabilityParameter.set(e)},get:function(){return this.probabilityParameter.get()}}]),n}(Ca);function Wa(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ka=new x.a.Time("32n"),Qa=function(e){Object(u.a)(n,e);var t=Wa(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Chord Rhythm",e)).durationFactorParameter=new Be("durationFactor",Object(W.a)(r),function(e,t){return[]},{defaultValue:1,min:0,max:2,unit:""}),r.registerParameter(r.durationFactorParameter),r.oddDelayTimeParameter=new Be("oddDelayTime",Object(W.a)(r),function(e,t){return[]},{defaultValue:1,min:.01,max:16,unit:""}),r.registerParameter(r.oddDelayTimeParameter),r.evenDelayTimeParameter=new Be("evenDelayTime",Object(W.a)(r),function(e,t){return[]},{defaultValue:1,min:.01,max:16,unit:""}),r.registerParameter(r.evenDelayTimeParameter),r.delayTimeFactorParameter=new Be("delayTimeFactor",Object(W.a)(r),function(e,t){return[]},{defaultValue:1,min:.01,max:4,unit:""}),r.registerParameter(r.delayTimeFactorParameter),r.evenVelocityParameter=new Be("evenVelocity",Object(W.a)(r),function(e,t){return[]},{defaultValue:1,min:.01,max:1,unit:""}),r.registerParameter(r.evenVelocityParameter),r.oddVelocityParameter=new Be("oddVelocity",Object(W.a)(r),function(e,t){return[]},{defaultValue:1,min:.01,max:1,unit:""}),r.registerParameter(r.oddVelocityParameter),r.repeatsParameter=new Be("repeats",Object(W.a)(r),function(e,t){return[]},{defaultValue:1,min:1,max:8,unit:""}),r.registerParameter(r.repeatsParameter),r.syncedParameter=new Be("synced",Object(W.a)(r),function(e,t){return[]},{defaultValue:!0,min:!1,max:!0,unit:""}),r.registerParameter(r.syncedParameter),r.velocitySpreadParameter=new Be("velocitySpread",Object(W.a)(r),function(e,t){return[]},{defaultValue:50,min:0,max:100,unit:""}),r.registerParameter(r.velocitySpreadParameter),r.velocityParameter=new Be("velocity",Object(W.a)(r),function(e,t){return[]},{defaultValue:1,min:0,max:1,unit:""}),r.registerParameter(r.velocityParameter),r.delays=[],r.liveTriggers=[],r}return Object(c.a)(n,[{key:"onNewStep",value:function(){this.triggers=[]}},{key:"removeNote",value:function(e,t){arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.gated;this.delays=this.delays.filter(function(t){return t.trigger.stepData.transpose!==e})}},{key:"input",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.liveTriggers.push(e):Object(q.a)(Object(p.a)(n.prototype),"input",this).call(this,e)}},{key:"clear",value:function(){this.triggers=[],this.delays=[]}},{key:"getDelayTrigger",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=(e.time-t)/Ka;return r=n?0:r,{stepNumber:e.stepNumber,stepOffset:r,trigger:this.copyTrigger(e),duration:n?void 0:e.stepData.duration,repeats:1,elapsed:0,even:!0}}},{key:"copyTrigger",value:function(e){var t=this.getStep(e.stepData,void 0,void 0,!1);return new ja(t,e.time,e.stepNUmber)}},{key:"output",value:function(e,t,n){var r=this;for(var a in this.triggers){var i=this.triggers[a];this.delays.push(this.getDelayTrigger(i,e))}for(var s in this.liveTriggers){var o=this.liveTriggers[s];o.stepNumber=t,this.delays.push(this.getDelayTrigger(o,e,!0))}var c=[],u=void 0,l=void 0,p=function(n){var a=r.delays[n],i=a.repeats/r.repeats%2==0,s=i?r.evenDelayTime:r.oddDelayTime;s*=r.delayTimeFactor;var o=i?r.evenVelocity:r.oddVelocity;if(o*=r.velocity,0===a.elapsed||r.shouldPlayDelay(a,t,a.isEven?r.evenDelayTime:r.oddDelayTime)){var p=r.getTimesToPlay(a,e,s),h=p.map(function(e){return r.getTriggerToPlay(a.trigger,e.timeToPlay,t,o,s)});c=[].concat(Object(M.a)(c),Object(M.a)(h)),u=t,l=p[p.length-1].offset,a.isEven=i,a.stepNumber=t,a.stepOffset=l,a.repeats++}a.elapsed++};for(var h in this.delays)p(h);return this.synced&&void 0!==u&&this.delays.forEach(function(e){e.stepNumber=u,e.stepOffset=l}),this.delays=this.delays.filter(function(e){return void 0===e.duration||e.elapsed<2*e.duration}),this.liveTriggers=[],c}},{key:"getTriggerToPlay",value:function(e,t,n,r,a){var i=this.copyTrigger(e);return i.time=t,i.stepData.duration=this.durationFactor*(a/2),i.stepNumber=n,i.stepData.velocity*=r,i}},{key:"shouldPlayDelay",value:function(e,t,n){var r=t,a=t+1,i=((e.stepNumber+e.stepOffset)%this.patternLength+n)%this.patternLength;return r<=i&&i<a}},{key:"getTimesToPlay",value:function(e,t,n){for(var r=((e.stepNumber+e.stepOffset)%this.patternLength+n)%this.patternLength,a=r-Math.floor(r),i=[];a<1;a+=n)i.push({timeToPlay:t+a*Ka,offset:a});return i}},{key:"isRealTime",value:function(){return!1}},{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson(),!0),t}},{key:"oddDelayTime",get:function(){return this.oddDelayTimeParameter.get()}},{key:"synced",get:function(){return this.syncedParameter.get()}},{key:"repeats",get:function(){return this.repeatsParameter.get()}},{key:"evenDelayTime",get:function(){return this.evenDelayTimeParameter.get()}},{key:"durationFactor",get:function(){return this.durationFactorParameter.get()}},{key:"delayTimeFactor",get:function(){return this.delayTimeFactorParameter.get()}},{key:"velocitySpread",get:function(){return this.velocitySpreadParameter.get()/100}},{key:"oddVelocity",get:function(){return Math.max(0,Math.sqrt(this.velocitySpread)-.2)}},{key:"velocity",get:function(){return this.velocityParameter.get()}},{key:"evenVelocity",get:function(){var e=1-this.velocitySpread;return Math.max(0,Math.sqrt(e)-.2)}},{key:"patternLength",get:function(){return this.track.length}}]),n}(Ca);function Xa(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}new x.a.Time("32n");var Ya=function(e){Object(u.a)(n,e);var t=Xa(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Chord Sculptor",e)).liveTriggers=[],r.linesParameter=new Be("lines",Object(W.a)(r),function(e,t){return r.lines=t},{defaultValue:[],min:[],max:[],unit:""}),r.registerParameter(r.linesParameter),r.effects=[],r.rawLines=[],r}return Object(c.a)(n,[{key:"clear",value:function(){this.effects.forEach(function(e){return e.clear()})}},{key:"onNewStep",value:function(){this.effects.forEach(function(e){return e.onNewStep()})}},{key:"removeNote",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.gated;this.effects.forEach(function(r){return r.removeNote(e,t,n)})}},{key:"isRealTime",value:function(){return!1}},{key:"removeNote",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.gated;this.effects.forEach(function(r){return r.removeNote(e,t,n)})}},{key:"input",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.effects.forEach(function(n){return n.input(e,t)})}},{key:"output",value:function(e,t,n){var r=[];for(var a in this.effects)r=[].concat(Object(M.a)(r),Object(M.a)(this.effects[a].output(e,t,n)));return r}},{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson(),!0),t}},{key:"lines",set:function(e){this.rawLines=e;var t=[];for(var n in e){var r=e[n],a=r.x1,i=r.y1,s=r.x2,o=r.y2,c=r.brightness,u=Math.abs(Math.ceil(16*(s-a))),l=8*i,p=8*o,h=4*(a+s)/2,f=c||1,d=new Qa(this.track);d.evenDelayTimeParameter.set(l),d.oddDelayTimeParameter.set(p),d.repeatsParameter.set(u),d.durationFactorParameter.set(h),d.velocityParameter.set(f),t.push(d)}this.effects=t}}]),n}(Ca);function Za(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var $a=function(e){Object(u.a)(n,e);var t=Za(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this,e,a,function(e,t){a.send(r,t)},{min:0,max:127,defaultValue:1})).ccNumber=r,a.setCallback(r,function(e){i.set(e)}),i}return Object(c.a)(n,[{key:"getJson",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this);return e.ccNumber=this.ccNumber,e}}]),n}(Be),ei={"Moog Minitaur":[{"VCO 2":{FREQ:17},FILTER:{CUTOFF:19,RES:21,"EG AMOUNT":22},MIX:{"VCO 1 LVL":15,"VCO 2 LVL":16}},{OSCILLATORS:{"OSC 1 SHAPE":70,"OSC 2 SHAPE":71},MOD:{"LFO RATE":3,"VCO LFO AMT":13,"VCF LFO AMT":12}},{"FILTER ENVELOPE":{ATTACK:23,"DECAY/RELEASE":24,SUSTAIN:25},"AMP ENVELOPE":{ATTACK:28,"DECAY/RELEASE":31,SUSTAIN:30}}],"Boutique SH-01A":[{VCF:{CUTOFF:74,RES:71,"ENV DEPTH":24,"MOD DEPTH":25,"KEY FOLLOW":26,"BEND DEPTH":27}},{LFO:{RATE:3,WAVEFORM:12,MODE:79}},{VCO:{"MOD DEPTH":13,RANGE:14,"PULSE WIDTH":15,"PWM SOURCE":16,"MOD SENS":17}},{VCO:{"BEND DEPTH":18,"PWM LEVEL":19,"SAW LEVEL":20,"SUB LEVEL":21,"SUB TYPE":22,"NOISE LEVEL":23}},{ENV:{ATTACK:73,DECAY:75,SUSTAIN:30,RELEASE:72},VCA:{"ENV SW":28,"ENV MODE":29}},{PORTAMENTO:{"PORTAMENTO MODE":31,PORTAMENTO:65,"PORTAMENTO TIME":5},MISC:{"TRANSPOSE SW":77,"NOISE MODE":78,TUNE:76}}]},ti={"MIDI Mix":{note:{0:{PATTERN_SWITCH:1,SEQUENCE_ROLL:3,PREVIOUS_PATTERN:25,NEXT_PATTERN:26},1:{PATTERN_SWITCH:4,SEQUENCE_ROLL:6},2:{PATTERN_SWITCH:7,SEQUENCE_ROLL:9},3:{PATTERN_SWITCH:10,SEQUENCE_ROLL:12},4:{PATTERN_SWITCH:13,SEQUENCE_ROLL:15},5:{PATTERN_SWITCH:16,SEQUENCE_ROLL:18},6:{PATTERN_SWITCH:19,SEQUENCE_ROLL:21},7:{PATTERN_SWITCH:22,SEQUENCE_ROLL:24}},cc:{0:{KNOB_1:16,KNOB_2:17,KNOB_3:18,VOLUME:19},1:{KNOB_1:20,KNOB_2:21,KNOB_3:22,VOLUME:23},2:{KNOB_1:24,KNOB_2:25,KNOB_3:26,VOLUME:27},3:{KNOB_1:28,KNOB_2:29,KNOB_3:30,VOLUME:31},4:{KNOB_1:46,KNOB_2:47,KNOB_3:48,VOLUME:49},5:{KNOB_1:50,KNOB_2:51,KNOB_3:52,VOLUME:53},6:{KNOB_1:54,KNOB_2:55,KNOB_3:56,VOLUME:57},7:{KNOB_1:58,KNOB_2:59,KNOB_3:60,VOLUME:61},MASTER:62}},"Komplete Kontrol M DAW":{actions:{PLAY:94,RECORD:95,CLEAR:93}}};function ni(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ri=function(e){Object(u.a)(n,e);var t=ni(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Midi Interface",e)).ccParameters=[],r.midiOutput=void 0,r}return Object(c.a)(n,[{key:"setConfig",value:function(e,t){if(this.midiOutput=e,this.midiCC=this.track.sequencerEngine.midi.deviceToMidiCC[e.name],this.midiDeviceName=e.name,void 0!==this.midiCC)for(var n in t){var r=t[n],a={};for(var i in r){var s=r[i];for(var o in a[i]={},s){var c=s[o],u=new $a(o,c,this.midiCC);this.registerParameter(u),a[i][o]=u}}this.ccParameters.push(a)}}},{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson(),!0),t}},{key:"output",value:function(e,t,n){return this.triggers}},{key:"getJson",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this);e.midiOutput=this.midiOutput.name;var t=[];for(var r in this.ccParameters){var a=this.ccParameters[r],i={};for(var s in a){var o=a[s],c={};for(var u in o){var l=o[u];c[l.name]=l.getJson()}i[s]=c}t.push(i)}return e.config=t,e}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t);var r=this.track.sequencerEngine.midi;if(void 0!==r){var a=r.controllerOutputs.filter(function(t){return t.name===e.midiOutput})[0];if(void 0!==a){for(var i in this.midiOutput=a,this.track.addMidiOutput(a,!0),this.midiCC=this.track.sequencerEngine.midi.deviceToMidiCC[a.name],e.config){var s=e.config[i];for(var o in s){var c=s[o];for(var u in c){var l=c[u],h=new $a(u,l.ccNumber,this.midiCC);h.fromJson(l,this.track.sequencerEngine),this.registerParameter(h),c[u]=h}}}this.ccParameters=e.config}}}}]),n}(Ca);function ai(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ii=function(e){Object(u.a)(n,e);var t=ai(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Midi Delay",e)).delayTimeParameter=new Be("delayTime",Object(W.a)(r),function(e,t){return t},{min:1,max:64,unit:"",defaultValue:1}),r.registerParameter(r.delayTimeParameter),r.repeatsParameter=new Be("repeats",Object(W.a)(r),function(e,t){return[]},{defaultValue:1,min:1,max:32,unit:"bars"}),r.registerParameter(r.repeatsParameter),r.wetParameter=new Be("wet",Object(W.a)(r),function(e,t){return t},{min:0,max:1,unit:"",defaultValue:.5}),r.registerParameter(r.wetParameter),r.delays=[],r}return Object(c.a)(n,[{key:"onNewStep",value:function(){this.triggers=[]}},{key:"clear",value:function(){this.triggers=[],this.delays=[]}},{key:"input",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.delays.length>8&&(this.delays=this.delays.slice(this.delays.length-8)),this.delays.push({stepNumber:e.stepNumber,trigger:this.copyTrigger(e),repeats:0,elapsed:0}),this.triggers.push(e)}},{key:"copyTrigger",value:function(e){var t=this.getStep(e.stepData,void 0,void 0,!1);return new ja(t,e.time,e.stepNUmber)}},{key:"output",value:function(e,t,n){var r=[],a=[];for(var i in this.delays){var s=this.delays[i];if(s.elapsed++,this.shouldPlayDelay(t,s)){var o=this.getStep(s.trigger.stepData,void 0,void 0,!1);o.velocity=o.velocity*(this.repeats-s.repeats)/this.repeats,o.velocity*=this.wet;var c=new ja(o,e,t);if(r.push(c),s.repeats++,s.repeats>=this.repeats)continue}a.push(s)}var u=this.triggers;for(var l in u){var p=this.getStep(u[l].stepData);p.velocity*=1-this.wet,u[l].stepData=p}return r=r.concat(u),this.delays=a,r}},{key:"shouldPlayDelay",value:function(e,t){var n=t.elapsed-1;return 0!==n&&n%Math.floor(this.delayTime)===0}},{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson(),!0),t}},{key:"wet",get:function(){return this.wetParameter.get()}},{key:"repeats",get:function(){return this.repeatsParameter.get()}},{key:"delayTime",get:function(){return this.delayTimeParameter.get()},set:function(e){this.delayTimeParameter.set(e)}}]),n}(Ca);function si(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function oi(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ci(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ci(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function ci(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ui(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var li=function(e){Object(u.a)(n,e);var t=ui(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Midi Effect Rack",e)).initializeConfigurations(r.adjacencyLists),r.initCache(128),r}return Object(c.a)(n,[{key:"output",value:function(e,t,n){var r=this,a=[],i={},s=[],o=this.inputNode;for(i[-1]=!0,s.push(o);s.length>0;){var c=s.shift(),u=c.output?c.output(e,t,n):Object(M.a)(this.triggers);if(void 0!==this.adjacencyLists[c.id]){var l,p=oi(this.adjacencyLists[c.id]);try{var h=function(){var e=l.value.effect;e.input?u.forEach(function(t){return e.input(r.copyTrigger(t,!0))}):a=[].concat(Object(M.a)(a),Object(M.a)(u)),i[e.id]=!0,e.parent=c,s.push(e)};for(p.s();!(l=p.n()).done;)h()}catch(f){p.e(f)}finally{p.f()}}}return a}},{key:"onNewStep",value:function(){this.triggers=[],this.effects.forEach(function(e){return e.onNewStep()})}},{key:"clear",value:function(){this.counter=0,this.effects.forEach(function(e){return e.clear()}),this.triggers=[]}},{key:"isRealTime",value:function(){return void 0===this.adjacencyLists[-1]||!this.adjacencyLists[-1].some(function(e){return e.effect&&e.effect.isRealTime&&!e.effect.isRealTime()})}},{key:"addNote",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.adjacencyLists[-1].filter(function(e){return e.effect&&e.effect.isRealTime&&!e.effect.isRealTime()}).forEach(function(r){return r.effect.addNote(e,t,n)})}},{key:"removeNote",value:function(e,t){this.effects.filter(function(e){return e.isRealTime&&!e.isRealTime()}).forEach(function(n){return n.removeNote(e,t)})}},{key:"getJson",value:function(){return this.getRackJson()}},{key:"fromJson",value:function(e,t){this.loaded=!1,Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t);var r=e.effects;for(var a in r){var i=r[a],s=xi(i,this.track);s.fromJson(i,t),this.addEffect(s,!1),s.x=i.x,s.y=i.y}this.fromRackJson(e,t),this.loaded=!0}},{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson(),!0),t}}]),n}(function(e){Object(u.a)(n,e);var t=si(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).effects=[],e.adjacencyLists={},e.inputNode={id:-1,x:0,y:200},e.outputNode={x:400,y:200},e}return Object(c.a)(n,[{key:"getSubDevices",value:function(){return this.effects.map(function(e){return{value:e,label:e.name}})}},{key:"getSubDeviceIndex",value:function(e){return this.effects.indexOf(e)}},{key:"getSubDevice",value:function(e){return this.effects[e]}},{key:"getParameters",value:function(){var e=Object(M.a)(this.parameters);for(var t in this.effects)e=[].concat(Object(M.a)(e),Object(M.a)(this.effects[t].getParameters()));return e}},{key:"getModAdjacencyLists",value:function(e){var t=this,n=this.modulators.filter(function(t){return t.getType()===e}),r={},a=function(a){var i=n[a],s=t.getParameters().filter(function(t){return e===qe?t.lfos.indexOf(i)>-1:t.envelopes.indexOf(i)>-1});if(0===s.length)return"continue";void 0===r[i.number]&&(r[i.number]=[]),r[i.number]=s};for(var i in n)a(i);return r}},{key:"registerContext",value:function(e){var t=this;Object(q.a)(Object(p.a)(n.prototype),"registerContext",this).call(this,e),this.effects.forEach(function(n){return n.registerContext(e,t)})}},{key:"setSize",value:function(e,t,n,r){this.inputNode.x=0,this.inputNode.y=t/2-r/2,this.outputNode.x=e-n,this.outputNode.y=t/2-r/2}},{key:"addEffect",value:function(e){!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e.x=200,e.y=200;var t=(this.context||new Wr).getCopy();t.forEffect(this),e.registerContext(t,this),this.effects.push(e)}},{key:"deleteEffect",value:function(e){var t=this,n=this.adjacencyLists[e.id]||[];for(var r in n.forEach(function(e){return t.deleteEdge(e)}),this.adjacencyLists)(n=this.adjacencyLists[r].filter(function(t){return t.effect===e})).forEach(function(e){return t.deleteEdge(e)});for(var a in this.lfoAdjacencyLists)void 0!==this.lfoAdjacencyLists[a]&&(n=this.lfoAdjacencyLists[a].filter(function(t){return e.parameters.indexOf(t)>-1})).forEach(function(e){return t.deleteEdge(e)});for(var i in this.envelopeAdjacencyLists)void 0!==this.envelopeAdjacencyLists[i]&&(n=this.envelopeAdjacencyLists[i].filter(function(t){return e.parameters.indexOf(t)>-1})).forEach(function(e){return t.deleteEdge(e)});e.dispose(),this.effects.splice(this.effects.indexOf(e),1)}},{key:"deleteEdge",value:function(e){if(e.modulator){var t=e.edge,n=e.modulator;n.getType()===qe?t.disconnectFromLFO(n):t.disconnectFromEnvelope(n)}else for(var r in this.adjacencyLists){var a=this.adjacencyLists[r],i=a.indexOf(e);i>-1&&a.splice(i,1)}}},{key:"getLFO",value:function(e){return this.modulators.filter(function(e){return e.getType()===qe}).find(function(t){return t.number===e})}},{key:"getEnvelope",value:function(e){return this.modulators.filter(function(e){return e.getType()===Me}).find(function(t){return t.number===e})}},{key:"connectEdge",value:function(e,t){var n=void 0;return n=e.effectNode||e.track?e.id:-1,void 0===this.adjacencyLists[n]&&(this.adjacencyLists[n]=[]),this.adjacencyLists[n].push(t),t}},{key:"connectNodes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.inputNode,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.outputNode;if(this.isMacro(e))this.connectNodeToMacro(t,e);else if(e.getType)e.getType()===qe&&t.connectToLFO?t.connectToLFO(e):t.connectToEnvelope&&t.connectToEnvelope(e);else if(!t.isAudioParamEnabled){var n=new ta(t,this.sequencerEngine);return this.connectEdge(e,n),n}}},{key:"getRackJson",value:function(){var e=this,t={},r=function(n){var r=e.adjacencyLists[n].map(function(t){return t.getJson(e)});if(-1===parseInt(n))t[n]=r;else{var a=e.effects.find(function(e){return e.id===n});t[e.effects.indexOf(a)]=r}};for(var a in this.adjacencyLists)r(a);this.saveCurrentConfiguration();var i=Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),i,{configurations:this.getConfigurationJson(),currentConfiguration:this.currentConfiguration,macros:this.macros.map(function(e){return e.getJson()}),adjacencyLists:t,effects:this.effects.map(function(e){return Object(D.a)({},e.getJson(),{x:e.x,y:e.y})})});return i=sr(i,"configurationParameter",this.configurationParameter)}},{key:"fromRackJson",value:function(e,t){this.loaded=!1,e.configurations&&this.loadConfigurationJson(e.configurations);var n=e.adjacencyLists;for(var r in n){var a=this.effects[r];for(var i in a||(a=this.inputNode),n[r]){var s=new ta(void 0,this.sequencerEngine);s.fromJson(n[r][i],this),this.connectEdge(a,s)}}if(void 0!==e.currentConfiguration&&(this.currentConfiguration=e.currentConfiguration),this.loadParameterFromJson(e,"configurationParameter",this.configurationParameter,t),e.macros){var o=this.getParameters();for(var c in e.macros)this.newMacro(this.context.getCopy().forEffect(this)).fromJson(e.macros[c],o)}this.loaded=!0}},{key:"nodes",get:function(){return this.effects}},{key:"lfoAdjacencyLists",get:function(){return this.getModAdjacencyLists(qe)}},{key:"envelopeAdjacencyLists",get:function(){return this.getModAdjacencyLists(Me)}},{key:"modulators",get:function(){return[].concat(Object(M.a)(this.sequencerEngine.lfos.map(function(e){return e.lfo})),Object(M.a)(this.sequencerEngine.envelopes))}}]),n}(ga(ma(Ca))));function pi(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var hi=function(e){Object(u.a)(n,e);var t=pi(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Alternate Tuning",e)).tuningMappings={0:.1,1:.5,2:.8,3:.9,4:1.2,5:1.5,6:2.3,7:2.9,8:3.3,9:4.2,10:5.1,11:7},r}return Object(c.a)(n,[{key:"output",value:function(){for(var e in this.triggers){var t=this.getStep(this.triggers[e].stepData,this.getTranspose(this.triggers[e].stepData.transpose),this.triggers[e].stepData.duration,!1);this.triggers[e].stepData=t}return this.triggers}},{key:"getTranspose",value:function(e){var t=12*Math.floor(e/12);return(e%=12)<0&&(e=12+e),e in this.tuningMappings?t+this.tuningMappings[e]:e}},{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{tuningMappings:this.tuningMappings})}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),this.tuningMappings=e.tuningMappings}},{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson(),!0),t}}]),n}(Ca);function fi(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function di(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var mi=function(e){Object(u.a)(n,e);var t=di(n);function n(e){var r,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Object(o.a)(this,n),r=t.call(this,"Warp",e),a&&(r.enabledParameter=new Be("enabled",Object(W.a)(r),function(e,t){return r.onEnable(t)},{min:!1,max:!0,unit:"",defaultValue:!0,automatable:!1}),r.registerParameter(r.enabledParameter)),r.warpLengthParameter=new Be("warpLength",Object(W.a)(r),function(e,t){return[]},{defaultValue:1,min:.25,max:16,unit:"bars",prettyName:"Warp Length"}),r.registerParameter(r.warpLengthParameter),r.warpFactorParameter=new Be("warpFactor",Object(W.a)(r),function(e,t){return[]},{defaultValue:2,min:1,max:8,unit:"",prettyName:"Warp Factor"}),r.registerParameter(r.warpFactorParameter),r.glideParameter=new Be("glide",Object(W.a)(r),function(e,t){return[]},{defaultValue:1,min:0,max:4,unit:"",automatable:!1}),r.registerParameter(r.glideParameter),r.resolutionParameter=new Ma("resolution",Object(W.a)(r),function(e,t){return t},{min:0,max:1,unit:"",options:{0:new Xe(4,!1),.1:new Xe(4,!0),.2:new Xe(8,!1),.3:new Xe(8,!0),.4:new Xe(16,!1),.5:new Xe(16,!0),.6:new Xe(32,!1),.7:new Xe(32,!0)},defaultValue:new Xe(16,!1)}),r.registerParameter(r.resolutionParameter),r.loopLengthParameter=new Be("loopLength",Object(W.a)(r),function(e,t){return[]},{defaultValue:100,min:0,max:100,unit:"%",prettyName:"Loop Length"}),r.registerParameter(r.loopLengthParameter),r.durationFactorParameter=new Be("durationFactor",Object(W.a)(r),function(e,t){return[]},{defaultValue:1,min:0,max:2,unit:"",prettyName:"Grain Size"}),r.registerParameter(r.durationFactorParameter),r.smoothnessParameter=new Be("smoothness",Object(W.a)(r),function(e,t){return[]},{defaultValue:1,min:1,max:20,unit:"",prettyName:"Smoothness"}),r.registerParameter(r.smoothnessParameter),r.sliceRetriggerParameter=new Be("sliceRetrigger",Object(W.a)(r),function(e,t){return[]},{defaultValue:!0,min:!1,max:!0,unit:"",automatable:!1}),r.registerParameter(r.sliceRetriggerParameter),r.noteToDuration={},r.noteToTrigger={},r.stepNumberTriggered=0,r.notes={},r}return Object(c.a)(n,[{key:"onEnable",value:function(e){this.track.sequencerEngine.store.dispatch(Object(O.Wd)(this.track.subSequence.id,this.track.trackNumber,e))}},{key:"releaseAll",value:function(e){this.notes={},this.noteToTrigger={},this.noteToDuration={}}},{key:"isNothingPlaying",value:function(){return fi(this.noteToTrigger)&&fi(this.notes)}},{key:"input",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(q.a)(Object(p.a)(n.prototype),"input",this).call(this,e,t);var r=e.stepNumber,a=e.stepData.transpose,i=e.stepData.slice;if(this.isNothingPlaying()&&this.sliceRetrigger&&(this.stepNumberTriggered=void 0),t)if(this.gated){var s=this.notes[a]||[];s.push(i),this.notes[a]=s}else(this.isNothingPlaying()||0==r||this.sliceRetrigger)&&(this.stepNumberTriggered=r),this.releaseAll(),this.notes[a]=[i];else{var o=2*e.stepData.duration;(!this.gated||this.track.rolling&&this.sequencerEngine.isSequenceRolling)&&(this.clear(!1),(this.sliceRetrigger||0===r)&&(this.stepNumberTriggered=r)),void 0===this.noteToDuration[a]&&(this.noteToDuration[a]=0),this.noteToDuration[a]=o,this.noteToTrigger[a]=e}}},{key:"output",value:function(e,t,n){var r=[];this.currentStep=t;var a=Da(t,this.resolution);for(var i in this.noteToTrigger){var s=this.noteToTrigger[i];for(var o in a)this.getTrigger(s.stepData,i,e+a[o].time,t,n,s.stepData.slice).forEach(function(e){return r.push(e)})}for(var c in this.notes){var u=this.notes[c];for(var l in u){var p=u[l];for(var h in a)this.getTrigger(this.track.trackData,c,e+a[h].time,t,n,p).forEach(function(e){return r.push(e)})}}for(var f in this.noteToDuration)this.gated&&(this.noteToDuration[f]=Math.max(0,this.noteToDuration[f]-1),this.noteToDuration[f]<=0&&(this.track.rolling&&this.sequencerEngine.isSequenceRolling||delete this.noteToTrigger[f]));return r}},{key:"addNote",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.getStep(this.track.trackData,e,null,!1);r.velocity=this.track.trackData.velocity,r.duration=null,r.transpose=e,r.slice=t,this.input(new ja(r,0,n+1),!0)}},{key:"removeNote",value:function(e,t){if(!(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.gated)&&void 0!==this.notes[e]){var n=this.notes[e],r=n.indexOf(t);r>-1&&(n.splice(r,1),this.notes[e]=n),0===this.notes[e].length&&delete this.notes[e]}}},{key:"getStepPercentage",value:function(e,t){var n=e-this.stepNumberTriggered;return n<0&&(n+=this.track.length),100*n/(32*this.getSliceWarpLength(t))/(this.warpLength*this.warpFactor)}},{key:"getSliceWarpLength",value:function(){var e=this.track.tempo,t=this.track.sequencerEngine.bpm;return void 0===e||null===e||0===e?1:e/t}},{key:"getSliceLoopLength",value:function(e,t){var n=void 0;if(this.track.instrument&&this.track.instrument.getSampler){var r=this.track.instrument.getSampler(e);r.samplers&&(n=r.samplers[0])}else n=this.track.getSamplers()[0];if(void 0===n)return 8;var a=n.getSlice(t),i=a.endTime-a.startTime;return 100*(64*new x.a.Time("32n").toMilliseconds()/1e3)/i}},{key:"getTrigger",value:function(e,t,n,r,a,i){void 0===this.stepNumberTriggered&&(this.gated||this.sliceRetrigger||this.isNothingPlaying())&&(this.stepNumberTriggered=r),t=parseFloat(t);var s=this.getStepPercentage(r,i),o=e.duration<1?e.duration:1,c=this.getStep(e,t,o,!0);return c.start=s*this.getSliceLoopLength(t,i)/100%this.loopLength,c.slice=i,c.duration*=this.durationFactor,c.attack+=8*this.smoothness,c.release+=2*this.smoothness,[new ja(c,n,a)]}},{key:"isRealTime",value:function(){return!1}},{key:"onNewStep",value:function(){}},{key:"clear",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.noteToDuration={},this.noteToTrigger={},e&&(this.stepNumberTriggered=void 0),this.notes={}}},{key:"getNextTriggerStep",value:function(e){var t=32/this.resolution.resolution;return e+(t-e%t)}},{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson(),!0),t}},{key:"fromJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),this.resolution=new Xe(16,!1).fromJson(e.resolution)}},{key:"sampler",get:function(){return this.track.getSamplers()[0]}},{key:"gated",get:function(){return this.track.gated}},{key:"durationFactor",get:function(){return this.durationFactorParameter.getAtStep(this.currentStep)},set:function(e){return this.durationFactorParameter.set(e)}},{key:"glide",get:function(){return this.glideParameter.get()},set:function(e){return this.glideParameter.set(e)}},{key:"warpFactor",get:function(){return this.warpFactorParameter.getAtStep(this.currentStep)},set:function(e){return this.warpFactorParameter.set(e)}},{key:"warpLength",get:function(){return this.warpLengthParameter.getAtStep(this.currentStep)},set:function(e){return this.warpLengthParameter.set(e)}},{key:"loopLength",get:function(){return this.loopLengthParameter.getAtStep(this.currentStep)},set:function(e){return this.loopLengthParameter.set(e)}},{key:"smoothness",get:function(){return this.smoothnessParameter.getAtStep(this.currentStep)},set:function(e){return this.smoothnessParameter.set(e)}},{key:"resolution",get:function(){return(new Xe).fromJson(this.resolutionParameter.get())},set:function(e){return this.resolutionParameter.set(e)}},{key:"sliceRetrigger",get:function(){return this.sliceRetriggerParameter.get()},set:function(e){return this.sliceRetriggerParameter.set(e)}}]),n}(Ca),vi=Object(L.a)(function(e){return e.cycle},function(e){return e.stepNumber},function(e){return e.length},function(e,t,n){return function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0,s=r/t.length,o=Math.floor(n%r/s);a+=s*o;for(var c=[];o<t.length&&!(n>a+s);o++){if(null!==t[o]&&Array.isArray(t[o]))n>=a&&n<a+s&&e(t[o],n,s,a,i).forEach(function(e){return c.push(e)});else if(t[o]&&t[o].cycle){if(n>=a&&n<a+s){var u=!0;"/"===t[o].operator&&(u=i%t[o].operand===0),u&&e(t[o].cycle,n,s,a,i).forEach(function(e){return c.push(e)})}}else if(n===Math.floor(a)){var l=!0;"/"===t[o].operator&&(l=i%t[o].operand===0),l&&c.push({transpose:t[o].transpose,offset:a-Math.floor(a),duration:s/2})}a+=s}return c}(gi(e),t%n,n,0,Math.floor(t/n))}),gi=function e(t){var n=[];for(var r in t)Array.isArray(t[r])?n.push(e(t[r])):n=[].concat(Object(M.a)(n),Object(M.a)(yi(t[r])));return n},yi=function(e){var t=void 0,n=e.operator,r=e.operand,a=(e.transpose,e.cycle);if(t=a?gi(a):e,"*"===n){for(var i=[],s=0;s<r;s++)i.push(t);return i}return[e]};function bi(e,t){console.log("completeLeaf(",e,t),e.cycle?(isNaN(parseInt(e.operand))||(e.operand=parseInt(e.operand)),t.push(e)):null===e.transpose?(console.log("adding null leaf"),t.push(e)):isNaN(parseInt(e.transpose))||(e.transpose=parseInt(e.transpose),isNaN(parseInt(e.operand))||(e.operand=parseInt(e.operand)),t.push(e))}var ki=function e(t){for(var n="",r=0;r<t.length;r++)Array.isArray(t[r])?n+="["+e(t[r])+"] ":null===t[r].transpose?n+="~ ":(n+=Ei(t[r]),r<t.length-1&&(n+=" "));return n},Ei=function(e){return e.cycle?"["+ki(e.cycle)+"]"+e.operator+e.operand:e.operator?e.transpose+e.operator+e.operand:e.transpose};function Oi(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Si=new x.a.Time("16n"),Pi=function(e){Object(u.a)(n,e);var t=Oi(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e,!1)).name="Tidal",r.cycleParameter=new Be("cycle",Object(W.a)(r),function(e,t){return[]},{defaultValue:void 0,min:!1,max:!0,unit:"",automatable:!1}),r.registerParameter(r.cycleParameter),r.warpLengthParameter.automatable=!1,r.warpFactorParameter.automatable=!1,r.loopLengthParameter.automatable=!1,r.cycleLengthParameter=new Be("cycleLength",Object(W.a)(r),function(e,t){return[]},{defaultValue:32,min:4,max:64,unit:""}),r.registerParameter(r.cycleLengthParameter),r.cycleRetrigger=!0,r.resolution=new Xe(32,!1),r}return Object(c.a)(n,[{key:"isRealTime",value:function(){return!1}},{key:"getTrigger",value:function(e,t,n,r,a,i){if(void 0===this.stepNumberTriggered&&(this.gated||this.sliceRetrigger||this.isNothingPlaying())&&(this.stepNumberTriggered=r),void 0!==this.cycle){var s=r-this.stepNumberTriggered;s<0&&(s+=this.track.length),this.cycleRetrigger||(s=r);var o=vi({cycle:this.cycle,stepNumber:s,length:this.cycleLength}),c=[];for(var u in o){var l=o[u],p=l.transpose,h=l.offset,f=l.duration;null!==p&&((e=this.getStep(e,t,1,!0)).slice=i,e.transpose=parseFloat(e.transpose)+parseFloat(p),e.duration=f*this.durationFactor,e.on=!0,c.push(new ja(e,Si*h+n,a)))}return c}}},{key:"getCopy",value:function(e){var t=new n(e);return t.fromJson(this.getJson(),!0),t}},{key:"cycleLength",get:function(){return Math.floor(this.cycleLengthParameter.get())},set:function(e){return this.cycleLengthParameter.set(e)}},{key:"cycle",get:function(){return this.cycleParameter.get()},set:function(e){return this.cycleParameter.set(e)}},{key:"cycleString",get:function(){return ki(this.cycle)}}]),n}(mi);function wi(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ji=function(e){Object(u.a)(n,e);var t=wi(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Every",e)).everyParameter=new Be("every",Object(W.a)(r),function(e,t){return t},{min:1,max:32,unit:"",defaultValue:2}),r.registerParameter(r.everyParameter),r.offsetParameter=new Be("offset",Object(W.a)(r),function(e,t){return t},{min:0,max:8,unit:"",defaultValue:0}),r.registerParameter(r.offsetParameter),r.gateParameter=new Be("gate",Object(W.a)(r),function(e,t){return t},{min:0,max:1,unit:"",defaultValue:1}),r.registerParameter(r.gateParameter),r.gateProbabilityParameter=new Be("gateProbability",Object(W.a)(r),function(e,t){return t},{min:0,max:100,unit:"",defaultValue:100}),r.registerParameter(r.gateProbabilityParameter),r.parameterEffects=[],r.counter=0,r}return Object(c.a)(n,[{key:"newParameter",value:function(){this.parameterEffects.push(new Ua(this.track))}},{key:"onNewStep",value:function(){this.triggers=[],this.parameterEffects.forEach(function(e){return e.onNewStep()})}},{key:"clear",value:function(){this.counter=0,this.triggers=[],this.parameterEffects.forEach(function(e){return e.clear()})}},{key:"output",value:function(){var e=this;if(0===this.triggers.length)return this.triggers;if(this.counter++%this.every!==this.offset)return this.triggers;if(!(this.gate&&100*Math.random()<=this.gateProbability))return[];var t=this.triggers,n=function(n){var r=e.parameterEffects[n];t.forEach(function(e){return r.input(e)}),t=r.output()};for(var r in this.parameterEffects)n(r);return t}},{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{parameterEffects:this.parameterEffects.map(function(e){return e.getJson()})})}},{key:"fromJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var r in Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e,t),e.parameterEffects){var a=new Ua(this.track);a.fromJson(e.parameterEffects[r],t),this.parameterEffects.push(a)}}},{key:"every",get:function(){return Math.round(this.everyParameter.get())}},{key:"offset",get:function(){return Math.round(this.offsetParameter.get())}},{key:"gate",get:function(){return Math.round(this.gateParameter.get())}},{key:"gateProbability",get:function(){return this.gateProbabilityParameter.get()}}]),n}(Ca),Ti={Arpeggiator:function(e){return new Fa(e)},Every:function(e){return new ji(e)},Parameterizer:function(e){return new Ua(e)},Timing:function(e){return new _a(e)},"Midi Outputter":function(e){return new za(e)},"Midi Interface":function(e){return new ri(e)},Harmony:function(e){return new Ha(e)},"Alternate Tuning":function(e){return new hi(e)},"Midi Delay":function(e){return new ii(e)},"Chord Rhythm":function(e){return new Qa(e)},"Chord Sculptor":function(e){return new Ya(e)},Warp:function(e){return new mi(e)},Tidal:function(e){return new Pi(e)},"Midi Effect Rack":function(e){return new li(e)}};function xi(e,t){if(e.name in Ti)return Ti[e.name](t)}var Ci=function(){function e(t){Object(o.a)(this,e),this.track=t,this.effects=[],this.inputedTriggers=[],this.noteToTriggers={},this.stepNumber=0}return Object(c.a)(e,[{key:"addEffect",value:function(e){this.effects=[].concat(Object(M.a)(this.effects),[e]),this.linkEffectParameters()}},{key:"getEffectById",value:function(e){return this.effects.find(function(t){return t.id===e})}},{key:"getCopy",value:function(t){var n=new e(t);return n.effects=this.effects.map(function(e){return e.getCopy(t)}),n.linkEffectParameters(),n}},{key:"linkEffectParameters",value:function(){var e=this;this.effects.forEach(function(t){t.registerContext((new Wr).forTrack(e.track)),t.registerMixSession(e.track.mixSession),t.registerTrack(e.track)})}},{key:"deleteEffect",value:function(e){var t=this.effects.map(function(e){return e.id}).indexOf(e.id);this.effects.splice(t,1),this.effects=Object(M.a)(this.effects)}},{key:"moveEffectTo",value:function(e,t){if(e!=t){var n=[];e>t?(n=this.effects.slice(0,t).concat([this.effects[e]]).concat(this.effects.slice(t,e)),this.effects.length>e+1&&(n=n.concat(this.effects.slice(e+1)))):(n=this.effects.slice(0,e).concat(this.effects.slice(e+1,t)).concat([this.effects[t],this.effects[e]]),this.effects.length>t+1&&(n=n.concat(this.effects.slice(t+1)))),this.effects=n}}},{key:"needsStableLookAhead",value:function(){return this.effects.some(function(e){return e.needsStableLookAhead()})}},{key:"input",value:function(e,t,n){this.inputedTriggers.push(new ja(e,t,n))}},{key:"output",value:function(e,t,n){var r=this;this.stepNumber=t;var a=this.inputedTriggers;for(var i in this.triggerAnimations(a[0],e,t),a.forEach(function(t){return r.triggerAttackReleasePreFXEnvelopes(e,t)}),this.effects){var s=this.effects[i];if(s.isEnabled()){for(var o in a){var c=a[o];s.input(c)}a=s.output(e,t,n)}}return this.triggerAttackReleasePostFXEnvelopes(a),a}},{key:"liveInputTrigger",value:function(e){var t=this;if(this.triggerAttackPreFXEnvelopes(void 0,e),this.isRealTime()){var n=e.transpose,r=[new ja(e,void 0,void 0)];for(var a in this.effects)if(this.effects[a].onNewStep(),this.effects[a].isEnabled()){for(var i in r)this.effects[a].input(r[i]);r=this.effects[a].output(void 0,void 0)}this.triggerAttackPostFXEnvelopes(r),r.forEach(function(e){t.track.liveTrigger(e.stepData,e.stepData.slice)}),void 0!==this.noteToTriggers[n]?this.noteToTriggers[n]=[].concat(Object(M.a)(this.noteToTriggers[n]),Object(M.a)(r)):this.noteToTriggers[n]=r}else this.addNote(e)}},{key:"triggerReleasePreFXEnvelopes",value:function(e){for(var t in this.track.connectedEnvelopes){this.track.connectedEnvelopes[t].envelope.triggerRelease(e)}}},{key:"triggerAttackPreFXEnvelopes",value:function(e,t){for(var n in this.track.connectedEnvelopes){var r=this.track.connectedEnvelopes[n];if("PRE_FX"===r.mode)r.envelope.triggerAttack(e,t.velocity)}}},{key:"triggerAttackReleasePreFXEnvelopes",value:function(e,t){var n=t.stepData;for(var r in this.track.connectedEnvelopes){var a=this.track.connectedEnvelopes[r];if("PRE_FX"===a.mode)a.envelope.triggerAttackRelease(this.getDuration(n.duration),e,n.velocity)}}},{key:"getDuration",value:function(e){return new x.a.Time("16n")*e}},{key:"triggerAttackPostFXEnvelopes",value:function(e){var t=this;e.forEach(function(e){for(var n in t.track.connectedEnvelopes){var r=t.track.connectedEnvelopes[n];if("POST_FX"===r.mode)r.envelope.triggerAttack(isNaN(e.time)?void 0:e.time,e.stepData.velocity)}})}},{key:"triggerAttackReleasePostFXEnvelopes",value:function(e){var t=this;e.forEach(function(e){for(var n in t.track.connectedEnvelopes){var r=t.track.connectedEnvelopes[n];if("POST_FX"===r.mode)r.envelope.triggerAttackRelease(t.getDuration(e.stepData.duration),e.time,e.stepData.velocity)}})}},{key:"liveInputRelease",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.isRealTime()){var n=this.noteToTriggers[e],r=[];for(var a in n)n[a].stepData.slice===t?this.track.liveTriggerRelease(n[a].stepData.transpose,n[a].stepData.slice):r.push(n[a]);this.noteToTriggers[e]=r,0===this.noteToTriggers[e].length&&delete this.noteToTriggers[e]}else this.removeNote(e,t);this.triggerReleasePreFXEnvelopes()}},{key:"addNote",value:function(e){var t=[new ja(e)],n=void 0;for(var r in this.effects){if(!(n=this.effects[r]).isRealTime())break;for(var a in this.effects[r].onNewStep(),t)n.input(t[a]);t=this.effects[r].output()}n.addNote(t[0].stepData.transpose,t[0].stepData.slice,this.stepNumber)}},{key:"removeNote",value:function(e,t){this.effects.forEach(function(n){return n.removeNote(e,t)})}},{key:"isRealTime",value:function(){return this.effects.filter(function(e){return e.isEnabled()}).every(function(e){return e.isRealTime()})}},{key:"isLiveRealTime",value:function(){return!!this.track.isEnabled&&this.effects.some(function(e){return"Arpeggiator"===e.name})}},{key:"onNewStep",value:function(){this.inputedTriggers=[],this.effects.forEach(function(e){return e.onNewStep()})}},{key:"clear",value:function(){this.effects.forEach(function(e){return e.clear()})}},{key:"fromJson",value:function(e){for(var t in e){var n=xi(e[t],this.track);n.fromJson(e[t]),this.addEffect(n)}}},{key:"getEffectNumber",value:function(e){return this.effects.indexOf(e)}},{key:"getJson",value:function(){return this.effects.map(function(e){return e.getJson()})}},{key:"getAllParameters",value:function(){var e=[];return this.effects.forEach(function(t){return t.getParameters().forEach(function(t){return e.push(t)})}),e}},{key:"getAllPatternLockedParameters",value:function(){return this.getAllParameters().filter(function(e){return e.hasPatternLockedValues()})}},{key:"mate",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=Math.max(e.effects.length,this.effects.length),r=[],a=0;a<n;a++){var i=this.effects[a],s=e.effects[a];na(t)?s&&r.push(s.getCopy(this.track)):i&&r.push(i)}this.effects=r,this.linkEffectParameters()}},{key:"triggerAnimations",value:function(e,t,n){if(void 0!==e){var r=new Event("TRIGGER_SAMPLE");r.trackNumber=this.track.trackNumber,r.subSequenceId=this.track.subSequence.id,r.startTime=t,r.duration=e.stepData.duration,r.transpose=e.stepData.transpose,r.loopPosition=100*n/this.track.length%100,r.stepNumber=n,r.time=Math.max(0,this.track.sequencerEngine.getMilliseconds(t)),window.dispatchEvent(r)}}}]),e}();function Ni(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ri=function(e){Object(u.a)(n,e);var t=Ni(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this,e,a)).effect=r,i}return Object(c.a)(n,[{key:"getParameters",value:function(){return[]}},{key:"getEffectType",value:function(){return"LIVE_FX"}},{key:"getJson",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this);return e.effect=this.effect,e}}]),n}(Ta),Di=1,qi=2,Mi=1,Ai=2,Ii=3;function Li(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Fi=function(e){Object(u.a)(n,e);var t=Li(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,"Roll Effect",Di,e)).rollFactorParameter=new Be("Roll Factor",Object(W.a)(r),function(e,t){return t},{min:.125,max:8,unit:"x",defaultValue:1}),r.registerParameter(r.rollFactorParameter),r.modeParameter=new He("Mode",Object(W.a)(r),function(e,t){return t},{min:Mi,max:Ii,unit:"",defaultValue:Ai}),r.registerParameter(r.modeParameter),r}return Object(c.a)(n,[{key:"getJson",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this);return e.rollFactor=this.rollFactor,e.mode=this.mode,e=this.saveParameterToJson(e,"rollFactorParameter",this.rollFactorParameter),e=this.saveParameterToJson(e,"modeParameter",this.modeParameter)}},{key:"fromJson",value:function(e){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e),this.mode=e.mode,this.rollFactor=e.rollFactor,this.loadParameterFromJson(e,"rollFactorParameter",this.rollFactorParameter),this.loadParameterFromJson(e,"modeParameter",this.modeParameter)}},{key:"mode",get:function(){return this.modeParameter.get()},set:function(e){this.modeParameter.set(e)}},{key:"rollFactor",get:function(){return this.rollFactorParameter.get()},set:function(e){this.rollFactorParameter.set(e)}}]),n}(Ri);function Bi(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Hi=6,Vi=function(e){Object(u.a)(n,e);var t=Bi(n);function n(e){var r;Object(o.a)(this,n),(r=t.call(this,"Macros",qi,e)).macros=[];for(var a=0;a<Hi;a++)r.newMacro();return r}return Object(c.a)(n,[{key:"getParameters",value:function(){return this.macros.map(function(e){return e.macroParameter})}},{key:"newMacro",value:function(){this.macros.push(new fa("Macro "+(this.numMacros+1),this.track.sequencerEngine,this.context))}},{key:"getJson",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this);return Object(D.a)({},e,{macros:this.macros.map(function(e){return e.getJson()})})}},{key:"fromJson",value:function(e){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e);var t=this.track.getAllParameters();for(var r in this.macros)this.macros[r].fromJson(e.macros[r],t)}},{key:"context",get:function(){return(new Wr).forLiveEffect(this).forTrack(this.track)}},{key:"numMacros",get:function(){return this.macros.length}}]),n}(Ri);function Ui(e,t){return e.effect===Di?new Fi(t):e.effect===qi?new Vi(t):void 0}var Ji=function(){function e(t){Object(o.a)(this,e),this.track=t,this.effects=[]}return Object(c.a)(e,[{key:"addEffect",value:function(e){this.effects.push(e),this.linkEffectParameters()}},{key:"linkEffectParameters",value:function(){var e=this;this.effects.forEach(function(t){t.registerContext((new Wr).forTrack(e.track)),t.registerMixSession(e.track.mixSession),t.registerTrack(e.track)})}},{key:"deleteEffect",value:function(e){var t=this.effects.indexOf(e);this.effects.splice(t,1)}},{key:"getAllParameters",value:function(){var e=[];for(var t in this.effects)e=[].concat(Object(M.a)(e),Object(M.a)(this.effects[t].getParameters()));return e}},{key:"getEffect",value:function(e){var t=this.effects.filter(function(t){return t.effect==e&&t.isEnabled()});return t.length>0?t[0]:void 0}},{key:"clear",value:function(){}},{key:"getJson",value:function(){return this.effects.map(function(e){return e.getJson()})}},{key:"fromJson",value:function(e){for(var t in e)console.log(e),this.addEffect(Ui(e[t],this.track)),this.effects[this.effects.length-1].fromJson(e[t])}}]),e}(),_i=(n(335),n(42));function Gi(e){return new x.a.Time(e).toMilliseconds()-new x.a.Time(x.a.Master.context.currentTime).toMilliseconds()}var zi=n(139),Wi=function(){function e(t,n){var r=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(o.a)(this,e),this.sequencerEngine=t,this.input=n,this.soundUploader=new zi.a(2,function(e,t,n){return r.onSoundUploaded(t)}),this.isMaster=a,this.resampleCount=0}return Object(c.a)(e,[{key:"getRecorder",value:function(){return new window.Recorder(this.input,{numChannels:2,bufferLen:1024})}},{key:"start",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.track=t,this.freeze=n,this.sequencerEngine.store.dispatch(Object(O.Gb)(void 0===t||t.trackNumber)),this.resamplingDurationElapsed=0;var r=Gi(e);this.recorder=this.getRecorder(),this.recorder.record(r+(new Date).getTime())}},{key:"stop",value:function(e){var t=this,n=Gi(e);setTimeout(function(){t.recorder.stop(Gi(e)+(new Date).getTime()),t.recorder.getBuffer(function(e){return t.saveBuffer(e)}),t.sequencerEngine.store.dispatch(Object(O.Gb)(void 0))},n+0)}},{key:"saveBuffer",value:function(e){this.audioBuffer=this.getAudioBuffer(e),this.soundUploader.uploadBufferToIpfs(e,!0,0)}},{key:"getAudioBuffer",value:function(e){var t=e[0].length,n=x.a.Master.context.createBuffer(2,t,x.a.Master.context.sampleRate);return n.copyToChannel(e[0],0,0),n.copyToChannel(e[1],1,0),n}},{key:"onSoundUploaded",value:function(e){var t=this;console.log("onSoundUploaded("+e+")");var n=new Dn.a(e);if(n.audioBuffer=this.audioBuffer,n.name="Resampled Recording",n.tags=["Resampled"],this.autoResampleMode){n.name=_i.a.fromTranspose(this.autoResampleTrackNote).toString();var r=this.autoResampleTrack;r.midiOutputs&&n.tags.push(Array.from(r.midiOutputs)[0].name)}if(n.isResampled=!0,n.samplesUsed=[],this.isMaster){var a=this.sequencerEngine.tracks.filter(function(e){return!e.muted&&e.sample}).map(function(e){return e.sample});a.forEach(function(e){var t;return(t=n.tags).push.apply(t,Object(M.a)(e.tags))}),n.tags=Array.from(new Set(n.tags)),n.samplesUsed=a.map(function(e){return e.getId()})}void 0===n.samplesUsed&&(n.samplesUsed=[]),this.freeze?this.track.freeze(n):this.sequencerEngine.addSound(n,void 0,void 0,void 0,!0).then(function(e){t.autoResampleMode&&t.matchLengths(e)}),this.autoResampleMode&&(this.resampleCount%this.samplesPerNote===0&&(this.autoResampleTrackNote=this.autoResampleTrackNote+2),this.resampleCount++,this.sequencerEngine.store.dispatch(Object(O.rc)(!0)))}},{key:"prepare",value:function(){}},{key:"matchLengths",value:function(e){for(;e.length>this.autoResampleTrack.length;)e.halfTrackLength()}},{key:"autoResampleTrack",get:function(){return this.sequencerEngine.tracks[0]}},{key:"autoResampleTrackNote",get:function(){return this.autoResampleTrack.pattern.stepBuckets[0].steps[0].transpose},set:function(e){this.autoResampleTrack.pattern.stepBuckets[0].steps[0].transpose=e}},{key:"autoResampleMode",get:function(){return this.sequencerEngine.autoResampleMode}},{key:"samplesPerNote",get:function(){return this.sequencerEngine.resampleConfig.samplesPerNote}}]),e}(),Ki=function(){function e(t){Object(o.a)(this,e),this.track=t,this.choke=void 0,this.transposeMatch=void 0,this.chokingDuration=0,this.isLiveTriggering=!1}return Object(c.a)(e,[{key:"onStep",value:function(){this.chokingDuration=Math.max(this.chokingDuration-1,0)}},{key:"newChoke",value:function(e,t){this.chokingDuration=e,this.track.releaseAll(t)}},{key:"isChoked",value:function(){return this.isLiveTriggering||this.chokingDuration>0}},{key:"liveTrigger",value:function(){this.choke&&(this.choke.chokes.isLiveTriggering=!0,this.choke.releaseAll())}},{key:"liveRelease",value:function(){this.choke&&(this.choke.chokes.isLiveTriggering=!1)}},{key:"getJson",value:function(){return{choke:void 0===this.choke?void 0:this.choke.trackNumber}}},{key:"fromJson",value:function(e,t){void 0!==e.choke&&(this.choke=t[e.choke])}}]),e}(),Qi="MASTER",Xi=12;function Yi(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Xi,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-200,i=e/n;if(i>=.75){var s=r*(1-Math.log(.75)/Math.log(.6));return s+=(r-s)*(i-.75)/.25}var o=r*(1-Math.log(i)/Math.log(.6));return isNaN(o)?a:o}window.q=.5,window.maxVolume=6;var Zi=new x.a.Time("32n");function $i(e,t,n){var r=e[0],a=e.map(function(e){return ns(e-r,t,n)}),i=ts(a,32),s=es(a,32,i),o=ts(s,16),c=ts(s=es(s,16,o),8),u=ts(s=es(s,8,c),4),l=ts(s=es(s,4,u),2),p=ts(s=es(s,2,l),1);return s=es(s,1,p),console.log("timing 1 = "),console.log(p),{steps:s,unquantizedSteps:a,timings:[p,l,u,c,o,i].filter(function(e){return!(0===(t=e).even&&0===t.odd);var t})}}function es(e,t,n){var r=32/t;return e.map(function(e){return{stepNumber:e.stepNumber,offset:Math.max(0,Math.floor(e.stepNumber/r)%2===0?e.offset-n.even:e.offset-n.odd)}})}function ts(e,t){var n=32/t,r=void 0,a=void 0;for(var i in e){var s=e[i],o=s.stepNumber,c=s.offset;Math.floor(o/n)%2===0?(1===t&&console.log("even for 1 offset = "+c),(void 0===a||a>c)&&(a=c)):(1===t&&console.log("odd for 1 offset = "+c),(void 0===r||r>c)&&(r=c))}return{resolution:t,even:a||0,odd:r||0}}function ns(e,t,n){var r=e*t/n/Zi.toMilliseconds(),a=r-Math.floor(r);return{stepNumber:Math.floor(r),offset:a}}var rs="ALL",as=function(){function e(){Object(o.a)(this,e),this.type=rs,this.nameToMidiInput={}}return Object(c.a)(e,[{key:"addMidiInput",value:function(e){this.nameToMidiInput[e.name]=e,this.type="CUSTOM"}},{key:"deleteMidiInput",value:function(e){e.name in this.nameToMidiInput&&(delete this.nameToMidiInput[e.name],0===Object.keys(this.nameToMidiInput).length&&(this.type=rs))}},{key:"setType",value:function(e){e!==rs&&"COMPUTER_KEYBOARD"!==e||(this.nameToMidiInput={}),this.type=e}},{key:"accepts",value:function(e,t){return this.type===rs||(e?t in this.nameToMidiInput:"COMPUTER_KEYBOARD"===this.type)}},{key:"getMidiInputs",value:function(){return Object.values(this.nameToMidiInput)}},{key:"getMidiInputNames",value:function(){return Object.keys(this.nameToMidiInput)}}]),e}(),is=new Xe(32,!1),ss=new Xe(32,!0),os=function(){function e(t,n){Object(o.a)(this,e),this.pattern=t,this.trackData=n}return Object(c.a)(e,[{key:"getStep",value:function(e,t,n){var r=this;return this.pattern.getStepAtResolution(e,t,function(e){return null===e.transpose&&n===r.trackData.transpose||e.transpose===n})}},{key:"getStepsAtStepNumber",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:is;return this.pattern.getPolyphonicStepsAtResolution(e,t)}},{key:"getStepWithTranspose",value:function(e,t,n){var r=this,a=function(e){return null===e.transpose&&n===r.trackData.transpose||r.snapTransposeToScale(e.transpose)===n},i=(this.pattern.getStepAtResolution(e,t,a,void 0,!0),this.pattern.getAllOnStepAtResolutionAtAnyPosition(e,t).filter(function(e){return e.on&&a(e)}));if(i.length>0)return i[0]}},{key:"snapTransposeToScale",value:function(e){return this.pattern.sequencerEngine.rules.snapTransposeToScale(e)}},{key:"deleteStepsAtStepNumber",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t.isTriplet?(e=ss.transformStepAtResolution2(e,t),this.pattern.tripletStepBuckets[e]=new ze(this.pattern.track,!0)):(e=is.transformStepAtResolution2(e,t),this.pattern.stepBuckets[e]=new ze(this.pattern.track)),n&&this.update(t.isTriplet)}},{key:"deleteStepAtStepNumber",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];t=this.getStepNumber(t,n);var a=n.isTriplet?this.pattern.tripletStepBucketsMatrix[t]:this.pattern.stepBucketsMatrix[t];if(void 0!==a){for(var i in a.steps){var s=a.steps[i].deleteStep(e);if(void 0!==s){a.steps[i]=s;break}}a.anyOn()||a.clear(),r&&this.update(n.isTriplet)}}},{key:"deleteStep",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.pattern.stepBucketsMatrix;for(var r in n){var a=n[r];for(var i in a.steps){var s=a.steps[i].deleteStep(e);if(void 0!==s){a.steps[i]=s;break}}a.anyOn()||a.clear()}t&&this.update()}},{key:"addStep",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];e.track=this.pattern.track;var o=is.transformStepAtResolution2(t,n);s&&t>=this.pattern.length(n)&&this.pattern.changeLength(o+2*e.duration,!1);var c=this.pattern.getStepAtResolution(o,is,function(){return!0},r);if(void 0!==c&&!i){if(e.transpose===c.transpose&&e.on===c.on)return void(c.id=e.id);e=c.addStep(e)}if(this.pattern.setStepAtResolution(e,t,n,r),a)if(n.isTriplet)this.update(n.isTriplet);else{var u=is.transformStepAtResolution2(t,n);this.pattern.stepBucketsMatrix[u]=this.pattern.stepBuckets[u],this.pattern.needsSync=!0}return e}},{key:"getSelectedSteps",value:function(e,t){for(var n=[],r=e.fromStep;r<=e.toStep;r++){var a=this.pattern.getAllOnStepAtResolutionAtAnyPosition(r,t);n=n.concat(a)}return n}},{key:"getSelectedPianoRollSteps",value:function(e,t){for(var n=this,r=[],a=e.stepNumber;a<e.stepNumber+e.numSteps;a++){var i=this.pattern.getAllOnStepAtResolutionAtAnyPosition(a,t).filter(function(t){return n.isStepSelected(t,e)});r=r.concat(i)}return r}},{key:"getStepNumber",value:function(e,t){return t.isTriplet?ss.transformStepAtResolution2(e,t):is.transformStepAtResolution2(e,t)}},{key:"isStepSelected",value:function(e,t){var n=null===e.transpose?this.trackData.transpose:e.transpose;return n<=t.transpose&&n>t.transpose-t.numNotes}},{key:"getStepNumbers",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:is,n=[];for(var r in e){var a=e[r],i=this.findStepNumber(a,t);n.push([a,i])}return n}},{key:"transformSteps",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];new Date;if(0===n.stepDifference&&0===n.transposeDifference)return e;var s=t.some(function(e){return e[1]+e[0].position+n.stepDifference<0});if(a&&s&&n.stepDifference<0)return e;for(var o in t){var c=t[o][0],u=t[o][1];isNaN(u),this.deleteStepAtStepNumber(c,u,r,!1)}var l=[],p={};for(var h in t){var f=t[h][0],d=t[h][1],m=d,v=null===f.transpose?this.trackData.transpose:f.transpose;if(isNaN(n.stepDifference)&&(n.stepDifference=0),f.transpose=v+n.transposeDifference,d+=f.position+n.stepDifference,!isNaN(d)){d<0?a?(d=0,f.position=0):d=this.pattern.length(r)+d:a&&(d%=this.pattern.length(r));var g=Math.floor(d),y=d-g;f.position=y,m!==g&&(p[m]=g),this.addStep(f,g,r,y,!1),l.push(f)}}new Date;return i&&(this.pattern.clearCache(),this.pattern.syncMatrixBySteps(p,r)),l}},{key:"snapToGrid",value:function(e,t){var n=this.getStepNumbers(e,t);for(var r in n){var a=n[r][0],i=n[r][1];a.position;this.deleteStepAtStepNumber(a,i,t,!1)}for(var s in n){var o=n[s][0],c=Math.round(n[s][1]);o.position=0,o.transpose=this.snapTransposeToScale(o.transpose),this.addStep(o,c,t,0,!1)}this.update()}},{key:"findStepNumber",value:function(e,t){var n=this.pattern.stepBucketsMatrix;for(var r in n){var a=n[r];if(void 0!==a)for(var i in a.steps){if(a.steps[i].hasStep(e))return t.transformStepAtResolution2(r,t.isTriplet?ss:is)}}}},{key:"findStepNumberAndDelete",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.pattern.stepBucketsMatrix;for(var a in r){var i=r[a];for(var s in i.steps){var o=i.steps[s].deleteStep(e);if(void 0!==o)return i.steps[s]=o,n&&this.update(t.isTriplet),t.transformStepAtResolution2(a,t.isTriplet?ss:is)}}}},{key:"deleteSteps",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.forEach(function(e){return t.deleteStep(e,!1)}),n&&this.update()}},{key:"getAllSteps",value:function(){var e=[],t=this.pattern.stepBucketsMatrix;for(var n in t){var r=t[n];for(var a in r.steps){var i=r.steps[a];e=e.concat(i.getPolyphony().filter(function(e){return e.on}))}}return e}},{key:"pasteSteps",value:function(e,t,n,r){if(void 0!==e&&void 0!==t){var a=n.getStepNumbers(e,r),i=6e4;for(var s in a){var o=a[s][1];o<i&&(i=o)}for(var c in a)a[c][1]-=i;var u=t.stepNumber,l=[];for(var p in a){var h=a[p][0].getCopy(!0,!1,!1,!0,!1,!1),f=u+a[p][1];l.push(this.addStep(h,f,r,h.position,!1))}return this.update(r.isTriplet),l}}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.pattern.calculateFills(this.trackData),this.pattern.clearCache(),this.pattern.syncBuckets(e)}}]),e}(),cs=function(){function e(t){Object(o.a)(this,e),this.type=t,this.events=[],this.counter=0}return Object(c.a)(e,[{key:"getMixType",value:function(){return"BASIC"}},{key:"seekToTrackStep",value:function(e){this.events.length>0&&this.events[this.events.length-1].step<e||this.restart()}},{key:"restart",value:function(){this.counter=0,this.events.forEach(function(e){return e.restart()})}},{key:"scheduleNext",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n,r){var a,i;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:0==t&&this.restart(),a=this.counter,i=this.events;case 3:if(!(a<i.length)){e.next=19;break}if(t!==i[a].step){e.next=8;break}i[a].scheduleEvent(n,r,i[a+1]),e.next=16;break;case 8:if(!(t>i[a].step)||i[a].isSkippable()){e.next=12;break}i[a].scheduleEvent(0-i[a].time,r,i[a+1]),e.next=16;break;case 12:if(!(t<i[a].step)){e.next=16;break}return e.abrupt("break",19);case 16:a++,e.next=3;break;case 19:this.counter=a;case 20:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"eraseEventsAtStep",value:function(e){this.events=this.events.filter(function(t){return t.step!=e})}},{key:"schedule",value:function(){this.events.forEach(function(e){return e.scheduleEvent()})}},{key:"getJson",value:function(){return{type:this.type,events:this.events.map(function(e){return e.getJson()}).filter(function(e){return void 0!==e})}}},{key:"getCopy",value:function(){var t=new e(this.type);return t.events=this.events,t}},{key:"loadFromJson",value:function(e,t,n){for(var r in e.events){var a=le(e.events[r],this.type,t,n);void 0!==a&&(this.events.length>0&&a.step<this.events[this.events.length-1].step&&e.length-r>=500&&(this.events=[]),this.events.push(a))}}},{key:"calculateDurations",value:function(){var e=void 0,t=[];for(var n in this.events){var r=this.events[n];void 0===r||r.isEmpty()||(void 0===e||e.rolling||r.rolling)&&(t.push(r),void 0!==e&&(e.duration=this.events[n].step-e.step),e=this.events[n])}this.events=t}},{key:"clear",value:function(){this.events=[],this.counter=0}},{key:"getNextEvent",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.counter:0;t<this.events.length;t++)if(e.step<this.events[t].step)return this.events[t]}},{key:"getPreviousEvent",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=void 0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?Math.max(0,this.counter-1):0;r<this.events.length;r++){if(t&&e.step<=this.events[r].step)return n;if(!t&&e.step<this.events[r].step)return n;n=this.events[r]}return n}},{key:"updateRedux",value:function(e,t){t.store.dispatch(Object(O.Rb)(e.id,this.type,Object(M.a)(this.events)))}},{key:"prune",value:function(){this.events.every(function(e){return e.isPrunable()})&&(this.events=[]);var e=void 0,t=[];for(var n in this.events){var r=this.events[n];void 0!==e&&r.isPrunable()&&e.isPrunable()||(void 0===e&&r.isPrunable()||(t.push(r),e=r))}this.events=t}},{key:"getEventsBetween",value:function(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this.events.filter(function(n){return n.step>=e&&n.step<=t}):this.events.filter(function(n){return n.step>=e&&n.step<t})}}]),e}();function us(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ls=function(e){Object(u.a)(n,e);var t=us(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this,e)).sequencerEngine=r,i.subSequence=a,i}return Object(c.a)(n,[{key:"getMixType",value:function(){return"LINEAR"}},{key:"getValueAtStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=this.getNextEvent({step:e},!0),r=this.getPreviousEvent({step:e},!1,!0);if(void 0===r){if(void 0===n)return t;var a=e/n.step;return t*(1-a)+n.value*a}if(void 0===n)return r.volume;var i=(e-r.step)/(n.step-r.step);return r.volume*(1-i)+n.volume*i}},{key:"deleteEvent",value:function(e){var t=this.events.indexOf(e);t>-1&&this.events.splice(t,1),this.updateRedux(this.subSequence,this.sequencerEngine)}},{key:"loadFromJson",value:function(e,t,r){Object(q.a)(Object(p.a)(n.prototype),"loadFromJson",this).call(this,e,t,r),this.updateRedux(r,t)}}]),n}(cs);function ps(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var hs=function(e){Object(u.a)(n,e);var t=ps(n);function n(e,r){var a;return Object(o.a)(this,n),(a=t.call(this,e)).defaultValue=r,a.heldEvent=void 0,a.currentEvent=r,a.cache={},a}return Object(c.a)(n,[{key:"getMixType",value:function(){return"DETERMINISTIC"}},{key:"restart",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object(q.a)(Object(p.a)(n.prototype),"restart",this).call(this),this.cache={},e||(this.heldEvent=void 0),this.currentEvent=this.defaultValue}},{key:"clear",value:function(){Object(q.a)(Object(p.a)(n.prototype),"clear",this).call(this),this.cache={}}},{key:"holdEvent",value:function(e,t){this.heldEvent=e}},{key:"getValuesBetweenSteps",value:function(e,t){for(var n=[],r=void 0,a=e;a<t;a++){var i=this.getValue(a,!1,!1),s=i.getValue();this.type===Pe?void 0!==r&&s.equals(r)||n.push({step:a,value:s,event:i}):s!==r&&n.push({step:a,value:s,event:i}),r=s}for(var o=0;o<n.length;o++)void 0===n[o+1]?n[o].duration=t-n[o].step:n[o].duration=n[o+1].step-n[o].step,n[o].event.duration=n[o].duration;return n}},{key:"getValue",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getEvent(e,t).getValue()}},{key:"getEvent",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.heldEvent)return this.heldEvent;if(e in this.cache)return this.cache[e];0==e&&t&&this.restart();for(var n=t?this.counter:0,r=void 0;n<this.events.length&&!(this.events[n].step>e);n++)void 0!==this.heldEvent&&this.events[n].step!==e||(r=this.events[n]);return t&&(this.counter=Math.max(0,n-1)),void 0===r?(this.cache[e]=this.currentEvent,this.currentEvent):(this.currentEvent=r,this.heldEvent=void 0,this.cache[e]=r,r)}}]),n}(cs),fs=2,ds=3,ms=4,vs=5,gs=6,ys=7,bs=8,ks=9,Es=10,Os=11,Ss=12,Ps=13,ws=14,js=15,Ts=16,xs=function(){function e(t,n){Object(o.a)(this,e),this.mix=t,this.type=n}return Object(c.a)(e,[{key:"execute",value:function(){}},{key:"getDuration",value:function(e){for(var t=0;t<this.events.length;t++){var n=this.events[t];if(void 0===e)return n.step-e.step}return 0}},{key:"calculateDurations",value:function(){for(var e=[],t=void 0,n=0;n<this.events.length;n++){var r=this.events[n];void 0!==t&&r.isEquivalent(t)||e.push(r),t=r}this.events=e,t=void 0;for(var a=0;a<this.events.length;a++){var i=this.events[a];void 0!==t&&(t.duration=i.step-t.step),t=i}}},{key:"mixByType",get:function(){var e=xe(this.type)?this.mix.deterministicMixesByType:this.mix.mixesByType;return this.type in e||(xe(this.type)?e[this.type]=new hs(this.type):e[this.type]=new cs(this.type)),e[this.type]}},{key:"events",get:function(){return this.mixByType.events},set:function(e){this.mixByType.events=e}}]),e}();function Cs(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ns=function(e){Object(u.a)(n,e);var t=Cs(n);function n(e,r,a,i){var s;return Object(o.a)(this,n),(s=t.call(this,e,r.getType())).event=r,s.time=a,s.trackStep=i,s}return Object(c.a)(n,[{key:"execute",value:function(){if(this.event.setTime(this.time,this.trackStep),0==this.events.length||this.events[this.events.length-1].step<=this.trackStep)this.events.push(this.event);else{for(var e=0,t=this.events.length-1,n=void 0;e<=t;){if(n=Math.floor((e+t)/2),this.events[n].step<this.trackStep)e=n+1;else{if(!(this.events[n].step>this.trackStep))break;t=n-1}if(n>=1&&this.events[n-1].step<=this.trackStep&&this.events[n].step>=this.trackStep)break}this.events[n].step===this.trackStep?this.events[n]=this.event:this.events=this.events.slice(0,n).concat([this.event]).concat(this.events.slice(n)),this.counter=n}}},{key:"events",get:function(){return this.mixByType.events},set:function(e){this.mixByType.events=e}},{key:"counter",get:function(){return this.mixByType.counter},set:function(e){this.mixByType.counter=e}}]),n}(xs);function Rs(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ds=function(e){Object(u.a)(n,e);var t=Rs(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"execute",value:function(){Object(q.a)(Object(p.a)(n.prototype),"execute",this).call(this),this.currentEvent=this.event}},{key:"currentEvent",set:function(e){this.mixByType.currentEvent=e}}]),n}(Ns);function qs(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ms=function(e){Object(u.a)(n,e);var t=qs(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this,e,r.getType())).event=r,i.duration=a,i}return Object(c.a)(n,[{key:"addEvent",value:function(e,t,n){new Ds(this.mix,e,t,n).execute()}},{key:"execute",value:function(){for(var e in this.events){var t=this.events[e];if(!t.isPrunable()){if(this.event.step===t.step||this.event.step===t.step+t.duration)return;if(this.event.step>t.step&&this.event.step<t.step+t.duration){var n=this.event.initialSubEvent;return n.step=this.event.step,void t.addSubEvent(n)}}}this.addEvent(this.event,0,this.event.step);var r=new fe(!1,this.event.initialSubEvent.resolution);r.step=this.event.step+this.duration,this.addEvent(r,0,r.step)}}]),n}(xs);function As(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Is=function(e){Object(u.a)(n,e);var t=As(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this,e,r.getType())).event=r,i.duration=a,i}return Object(c.a)(n,[{key:"addEvent",value:function(e,t,n){e.isDeterministic()?new Ds(this.mix,e,t,n).execute():new Ns(this.mix,e,t,n).execute()}},{key:"execute",value:function(){if(!isNaN(this.event.step)){for(var e in this.events){var t=this.events[e];if(!t.isPrunable()&&void 0!==t.duration&&t.step<this.event.step&&t.step+t.duration>this.duration+this.event.step){var n=t.getCopy(this.mix.sequencerEngine);return n.step=this.event.step+this.duration,void this.addEvent(n,0,n.step)}}this.addEvent(this.event,0,this.event.step)}}}]),n}(xs);function Ls(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Fs=function(e){Object(u.a)(n,e);var t=Ls(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(o.a)(this,n),(a=t.call(this,e,r.getType())).event=r,a.inPlace=i,a}return Object(c.a)(n,[{key:"execute",value:function(){var e=this.events.indexOf(this.event);if(e>-1&&this.events.splice(e,1),!this.inPlace){var t=this.event.duration;for(var n in this.events)if(this.events[n].step>this.event.step&&(this.events[n].step-=t,this.inPlace))return}this.mix.restart()}}]),n}(xs);function Bs(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Hs=function(e){Object(u.a)(n,e);var t=Bs(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this,e,r.getType())).event=r,i.subEvent=a,i}return Object(c.a)(n,[{key:"execute",value:function(){var e=this.subEvent.step,t=this.subEvent.duration,n=this.event.deleteSubEvent(this.subEvent);if(!(n<0)){if(this.event.isEmpty())return n=this.mixByType.events.indexOf(this.event),this.mixByType.events.splice(n,1),this.mixByType.calculateDurations(),void this.mix.updateAllTypeRedux();var r=this.event.subEvents;for(var a in r)if(r[a].step>e){r[a].step-=t;break}this.mix.restart(),this.event.calculateDurations(),this.mixByType.calculateDurations(),this.mix.updateAllTypeRedux()}}}]),n}(xs);function Vs(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Us=function(e){Object(u.a)(n,e);var t=Vs(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this,e,r.getType())).event=r,i.resolution=a,i}return Object(c.a)(n,[{key:"execute",value:function(){void 0!==this.resolution&&(this.event.resolution=this.resolution)}}]),n}(xs);function Js(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var _s=function(e){Object(u.a)(n,e);var t=Js(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this,e,r.getType())).event=r,i.patternNumber=a,i}return Object(c.a)(n,[{key:"execute",value:function(){this.event.patternNumber=this.patternNumber}}]),n}(xs);function Gs(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var zs=function(e){Object(u.a)(n,e);var t=Gs(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this,e,r.getType())).event=r,i.xTransform=a-i.event.step,i}return Object(c.a)(n,[{key:"execute",value:function(){var e=this,t=this.mixByType.getNextEvent(this.event);if(void 0!==t){var n=this.mixByType.getNextEvent(t);(void 0===n||t.step+this.xTransform<=n.step)&&(this.event.step+=this.xTransform,t.step+=this.xTransform,this.event.initialSubEvent.step+=this.xTransform,this.event.subEvents.forEach(function(t){return t.step+=e.xTransform}),t.initialSubEvent.step+=this.xTransform,t.subEvents.forEach(function(t){return t.step+=e.xTransform}))}}}]),n}(xs),Ws=function(){function e(t,n,r){Object(o.a)(this,e),this.track=t,this.pattern=n,this.step=r}return Object(c.a)(e,[{key:"execute",value:function(){var e=this.pattern.split(this.step);this.track.patterns.push(e),this.track.updateSteps(!0);var t={};t[15]=e,this.track.sequencerEngine.store.dispatch(Object(O.zc)(t))}}]),e}();function Ks(e,t,n){Qs(e.patterns.find(function(e){return e.overlapsStep(t)&&e.startStep<t}),t),Qs(e.patterns.find(function(e){return e.overlapsStep(n)&&e.startStep<n}),n);var r=e.patterns.filter(function(e){var r=e.startStep,a=e.startStep+e.length();return!(r>=t&&r<n||a>t&&a<=n)});e.patterns=r,e.updateSteps(!0)}function Qs(e,t){void 0!==e&&new Ws(e.track,e,t).execute()}function Xs(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ys=function(e){Object(u.a)(n,e);var t=Xs(n);function n(e,r){var a;return Object(o.a)(this,n),(a=t.call(this,e,void 0)).selection=r,a.start=a.selection.start,a.end=a.selection.end,a}return Object(c.a)(n,[{key:"execute",value:function(){if(void 0!==this.mix.subSequence){for(var e in this.mix.mixesByType){var t=this.mix.mixesByType[e];this.deleteByType(parseInt(e),t)}for(var n in this.mix.deterministicMixesByType){var r=this.mix.deterministicMixesByType[n];this.deleteByType(parseInt(n),r)}this.mix.subSequence.isTrack&&this.executeForTrack(this.mix.subSequence.tracks[0])}else{var a=this.mix.deterministicMixesByType[Se];this.deleteByType(Se,a)}}},{key:"deleteByType",value:function(e,t,n){var r=t.getEventsBetween(this.start,this.end,!0).filter(function(e){return!e.isPrunable()});for(var a in r){var i=r[a];if(void 0!==i.initialSubEvent){var s=Object(M.a)(i.subEvents);for(var o in s)new Hs(this.mix,i,s[o]).execute();new Hs(this.mix,i,i.initialSubEvent).execute()}else new Fs(this.mix,i,!0).execute()}if("LINEAR"===t.getMixType()){var c=Te(e);if(void 0!==c){var u=t.getValueAtStep(this.start),l=Te(e);c.step=this.start,l.step=this.end-1,c.setValue(u),l.setValue(u),c.subSequence=this.mix.subSequence,l.subSequence=this.mix.subSequence,new Is(this.mix,c,1).execute(),new Is(this.mix,l,1).execute()}}}},{key:"executeForTrack",value:function(e){Ks(e,this.start,this.end)}}]),n}(xs);function Zs(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var $s=function(e){Object(u.a)(n,e);var t=Zs(n);function n(e,r,a,i){var s;return Object(o.a)(this,n),(s=t.call(this,e,void 0)).step=r,s.selection=a,s.start=s.selection.start,s.end=s.selection.end,s.mixType=i,s}return Object(c.a)(n,[{key:"execute",value:function(){if(this.mix.subSequence.id===je.id&&(this.mixType=Se),void 0===this.mixType){for(var e in this.mix.mixesByType){var t=this.mix.mixesByType[e];this.executeByType(parseInt(e),t)}for(var n in this.mix.deterministicMixesByType){var r=this.mix.deterministicMixesByType[n];this.executeByType(parseInt(n),r)}this.mix.subSequence.isTrack&&this.executeForTrack(this.mix.subSequence.tracks[0])}else this.mix.mixesByType[this.mixType]?this.executeByType(this.mixType,this.mix.mixesByType[this.mixType]):this.mix.deterministicMixesByType[this.mixType]&&this.executeByType(this.mixType,this.mix.deterministicMixesByType[this.mixType])}},{key:"executeByType",value:function(e,t,n){}},{key:"executeForTrack",value:function(){}},{key:"splitIntersectingPatterns",value:function(e){var t=this,n=e.patterns.find(function(e){return e.overlapsStep(t.start)&&e.startStep<t.start});this.splitPattern(n,this.start);var r=e.patterns.find(function(e){return e.overlapsStep(t.end)&&e.startStep<t.end});this.splitPattern(r,this.end)}},{key:"splitPattern",value:function(e,t){void 0!==e&&new Ws(e.track,e,t).execute()}}]),n}(xs);function eo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var to=function(e){Object(u.a)(n,e);var t=eo(n);function n(e,r,a,i,s){var c;return Object(o.a)(this,n),(c=t.call(this,e,r,a,i)).track=s,c}return Object(c.a)(n,[{key:"executeByType",value:function(e,t,n){var r=this,a=t.getEventsBetween(this.start,this.end,!0).filter(function(e){return!e.isPrunable()}).map(function(e){var t=e.getCopy(r.mix.sequencerEngine);return t.setTime(void 0,r.step+e.step-r.start),t.subEvents&&t.subEvents.forEach(function(e){return e.step=r.step+e.step-r.start}),t.duration=e.duration,t.subSequence=r.mix.subSequence,t});if("DETERMINISTIC"===t.getMixType()){var i=t.getEvent(this.start,!1).getCopy(this.mix.sequencerEngine);i.isPrunable()||(i.setTime(void 0,this.step),a.push(i))}if("LINEAR"===t.getMixType()){var s=Te(e);if(void 0!==s){var o=t.getValueAtStep(this.start),c=t.getValueAtStep(this.end-1);s.setValue(o),s.setTime(void 0,this.step),s.subSequence=this.mix.subSequence;var u=Te(e);u.setValue(c),u.setTime(void 0,this.step+this.end-this.start-1),u.subSequence=this.mix.subSequence;var l=Te(e);l.setValue(c),l.setTime(void 0,this.step-1),l.subSequence=this.mix.subSequence,a.push(s),a.push(u),a.push(l)}}for(var p in a){var h=a[p];e===Se?new Ms(this.mix,h,h.duration).execute():new Is(this.mix,h,h.duration).execute()}}},{key:"executeForTrack",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r,a,i,s,o,c,u;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=1/0,a=-1/0,e.t0=N.a.keys(t.patterns);case 4:if((e.t1=e.t0()).done){e.next=33;break}if(i=e.t1.value,!((s=t.patterns[i]).startStep>=this.start&&s.startStep<this.end||s.endStep>=this.start&&s.endStep<this.end)){e.next=31;break}if(o=void 0,!(s.startStep<this.start)){e.next=16;break}return c=this.start-s.startStep,e.next=13,s.getCopy(c,c+s.endStep-this.start);case 13:o=e.sent,e.next=25;break;case 16:if(!(s.endStep>this.end)){e.next=22;break}return e.next=19,s.getCopy(0,this.end-s.startStep);case 19:o=e.sent,e.next=25;break;case 22:return e.next=24,s.getCopy();case 24:o=e.sent;case 25:o.startStep<r&&(r=o.startStep),o.endStep>a&&(a=o.endStep),o.track=this.track,u=o.startStep-this.start,o.startStep=this.step+u,n.push(o);case 31:e.next=4;break;case 33:r!==1/0&&a!==-1/0&&Ks(this.track,this.step+r-this.start,this.step+a-this.start),this.track.patterns=[].concat(Object(M.a)(this.track.patterns),n),this.track.updateSteps();case 36:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),n}($s);function no(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ro=function(e){Object(u.a)(n,e);var t=no(n);function n(e,r,a,i){return Object(o.a)(this,n),t.call(this,e,r,a,i)}return Object(c.a)(n,[{key:"getEventsAfter",value:function(e,t){return e.events.filter(function(e){return e.step>=t})}},{key:"executeByType",value:function(e,t,n){var r=this.getEventsAfter(t,this.start);for(var a in r){var i=r[a],s=(i.step,this.step-this.start);if(i.setTime(void 0,i.step+s),i.subEvents)for(var o in i.subEvents){i.subEvents[o].step+=s}}}}]),n}($s);function ao(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var io=function(e){Object(u.a)(n,e);var t=ao(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this,e,void 0,r,a)).step=i.end,i}return Object(c.a)(n,[{key:"execute",value:function(){var e={start:this.end};new ro(this.mix,this.end+this.duration,e).execute(),Object(q.a)(Object(p.a)(n.prototype),"execute",this).call(this)}},{key:"executeForTrack",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r,a,i,s,o=this;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.mix.subSequence.tracks[0],this.splitIntersectingPatterns(t),n=this.end-this.start,t.patterns.filter(function(e){return e.startStep>=o.end}).forEach(function(e){return e.startStep+=n}),e.t0=N.a.keys(t.patterns);case 5:if((e.t1=e.t0()).done){e.next=17;break}if(r=e.t1.value,!((a=t.patterns[r]).startStep>=this.start&&a.startStep<this.end)){e.next=15;break}return i=a.startStep-this.start,e.next=12,a.getCopy();case 12:(s=e.sent).startStep=this.end+i,t.patterns.push(s);case 15:e.next=5;break;case 17:t.updateSteps();case 18:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"duration",get:function(){return this.end-this.start}}]),n}(to),so=function(){function e(t,n,r){Object(o.a)(this,e),this.track=t,this.pattern=n,this.startStep=r}return Object(c.a)(e,[{key:"execute",value:function(){this.pattern.startStep=this.startStep}}]),e}(),oo=100;var co=140,uo=(new Xe(16,!1),function(){function e(t,n,r){Object(o.a)(this,e),this.pattern=n,this.step=r,this.track=t}return Object(c.a)(e,[{key:"execute",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Ks(this.track,this.step,this.step+this.pattern.length()),e.next=3,this.pattern.getCopy();case 3:(t=e.sent).track=this.track,t.startStep=this.step,this.track.patterns.push(t),this.track.updateSteps(!0),(n={})[15]=t,this.track.sequencerEngine.store.dispatch(Object(O.zc)(n)),r=this.step+t.length(),this.track.sequencerEngine.store.dispatch(Object(O.y)(r));case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"xScale",get:function(){return this.track.sequencerEngine.state.arrangement.xScale}}]),e}()),lo=function(){function e(t,n){Object(o.a)(this,e),this.pattern=n,this.track=t}return Object(c.a)(e,[{key:"execute",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Ks(this.track,this.pattern.endStep,this.pattern.endStep+this.pattern.length()),e.next=3,this.pattern.getCopy();case 3:(t=e.sent).track=this.track,t.startStep=this.pattern.startStep+this.pattern.length(),this.track.patterns.push(t),this.track.updateSteps(!0),(n={})[15]=t,this.track.sequencerEngine.store.dispatch(Object(O.zc)(n)),r=t.startStep,this.track.sequencerEngine.store.dispatch(Object(O.y)(r));case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"xScale",get:function(){return this.track.sequencerEngine.state.arrangement.xScale}}]),e}(),po=function(){function e(t,n,r){Object(o.a)(this,e),this.pattern=t,this.direction=n,this.resizedStep=r}return Object(c.a)(e,[{key:"findOverlappingPattern",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.resizedStep;return this.pattern.track.patterns.filter(function(t){return t!==e.pattern}).find(function(e){return e.overlapsStep(t)})}},{key:"cutOverlappingPattern",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.resizedStep;if(void 0!==e)if("LEFT"===this.direction){var n=t-e.startStep;if(n<=0)return void this.deletePattern(e);e.changeLength(n)}else{var r=t-e.startStep;if(e.cutFromStart(r),e.startStep=t,0===e.length())return void this.deletePattern(e)}}},{key:"deletePattern",value:function(e){var t=e.track;t.patterns=t.patterns.filter(function(t){return t!==e})}},{key:"execute",value:function(){if("RIGHT"===this.direction){var e=this.resizedStep-this.pattern.startStep;if(e<=0)return;e>this.pattern.length()&&this.cutOverlappingPattern(this.findOverlappingPattern()),this.pattern.changeLength(e,!1)}else this.resizedStep<this.pattern.startStep?(this.cutOverlappingPattern(this.findOverlappingPattern()),this.pattern.addToStart(this.pattern.startStep-this.resizedStep)):(this.pattern.cutFromStart(this.resizedStep-this.pattern.startStep),0===this.pattern.length()&&this.deletePattern(this.pattern)),this.pattern.startStep=this.resizedStep;this.pattern.track.updateSteps(!0)}}]),e}();function ho(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var fo=function(e){Object(u.a)(n,e);var t=ho(n);function n(e,r,a,i){var s;return Object(o.a)(this,n),(s=t.call(this,e,r.getType())).event=r,s.difference=a,s.inPlace=i,s}return Object(c.a)(n,[{key:"execute",value:function(){this.event.duration=this.getDuration(this.event);this.events.map(function(e){return e.step});if(0!==this.differeence){for(var e=void 0,t=0;t<this.events.length;t++){var n=this.events[t];if(n.step>this.event.step){n.step+=this.difference;var r=this.events[t+1];if(r&&r.step<=n.step&&(e=t),this.inPlace)break}}void 0!==e&&this.events.splice(e,1),this.events.map(function(e){return e.step}),this.calculateDurations()}}}]),n}(xs);function mo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var vo=function(e){Object(u.a)(n,e);var t=mo(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this,e,r[0].getType())).eventsToPaste=r,i.stepNumber=a,i}return Object(c.a)(n,[{key:"insertEvent",value:function(e,t){new Is(this.mix,e,t).execute()}},{key:"execute",value:function(){var e=this.eventsToPaste[0].step;for(var t in this.eventsToPaste){var n=this.eventsToPaste[t];n.step=n.step-e+this.stepNumber,this.insertEvent(n,n.duration)}}}]),n}(xs);function go(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var yo=function(e){Object(u.a)(n,e);var t=go(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this,void 0,Pe)).sequenceRollEvent=e,i.event=r,i.difference=a,i}return Object(c.a)(n,[{key:"execute",value:function(){for(var e=void 0,t=0;t<this.events.length;t++){var n=this.events[t];if(n.step>this.event.step){n.step+=this.difference;var r=this.events[t+1];r&&r.step<=n.step&&(e=t),n.duration+this.difference<0&&(e=t);break}}void 0!==e&&this.sequenceRollEvent.subEvents.splice(e-1,1),this.sequenceRollEvent.calculateDurations()}},{key:"events",get:function(){return this.sequenceRollEvent.events},set:function(e){this.sequenceRollEvent.events=e}}]),n}(xs);function bo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ko="LEFT",Eo=function(e){Object(u.a)(n,e);var t=bo(n);function n(e,r,a,i,s){var c;return Object(o.a)(this,n),(c=t.call(this,e,r.getType())).sequenceRollEvent=r,c.resolutionChangeEvent=a,i===ko?c.newStart=s:c.difference=s,c.direction=i,c}return Object(c.a)(n,[{key:"execute",value:function(){this.direction===ko?this.resizeLeftSide():this.resizeRightSide()}},{key:"resizeLeftSide",value:function(){0===this.sequenceRollEvent.getSubEvents().indexOf(this.resolutionChangeEvent)&&(this.sequenceRollEvent.step=this.newStart),this.resolutionChangeEvent.step=this.newStart,this.sequenceRollEvent.calculateDurations()}},{key:"resizeRightSide",value:function(){this.sequenceRollEvent.step,this.sequenceRollEvent.duration;var e=this.sequenceRollEvent.getSubEvents(),t=-1;for(var n in e)e[n].step===this.resolutionChangeEvent.step&&(t=parseInt(n));t===e.length-1?new fo(this.mix,this.sequenceRollEvent,this.difference,!0).execute():new yo(this.sequenceRollEvent,this.resolutionChangeEvent,this.difference).execute()}},{key:"getResolutionDuration",value:function(e){var t=e.step+e.duration,n=this.mix.getValuesBetweenSteps(Se,e.step,t);for(var r in n)if(!n[r].value)return n[r].step-e.step;return e.duration}}]),n}(xs);function Oo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var So=function(e){Object(u.a)(n,e);var t=Oo(n);function n(e,r){var a;return Object(o.a)(this,n),(a=t.call(this,e,r)).mixesByType={},a.mixesByType[we]=new ls(we,e,r),a.deterministicMixesByType={},a.deterministicMixesByType[Pe]=new hs(Pe,new ue(new Xe)),a.deterministicMixesByType[Se]=new hs(Se,new fe(!1,new Xe)),a.deterministicMixesByType[de]=new hs(de,new _(0)),r&&a.updateAllTypeRedux(),a}return Object(c.a)(n,[{key:"getValue",value:function(e,t){var n=this.deterministicMixesByType[e];if(void 0!==n)return n.getValue(t,!0)}},{key:"getEvent",value:function(e,t){var n=this.deterministicMixesByType[e];if(void 0!==n)return n.getEvent(t)}},{key:"getValuesBetweenSteps",value:function(e,t,n){var r=this.deterministicMixesByType[e];if(void 0!==r)return r.getValuesBetweenSteps(t,n)}},{key:"holdEvent",value:function(e){if(e.isDeterministic()){var t=e.getType();!t in this.deterministicMixesByType&&(this.deterministicMixesByType[t]=new hs),this.deterministicMixesByType[t].holdEvent(e)}}},{key:"dispatch",value:function(e){!function(e,t){void 0===t&&(t=e);var n=t.payload,r=void 0;switch(t.type){case fs:(r=new Ms(e,n.event,n.duration)).execute();break;case ys:(r=new Is(e,n.event,n.duration)).execute();break;case ds:(r=new Fs(e,n.event,n.inPlace)).execute();break;case ms:(r=new Hs(e,n.event,n.subEvent)).execute();break;case vs:(r=new Us(e,n.event,n.resolution)).execute();break;case gs:(r=new _s(e,n.event,n.pattern)).execute();break;case bs:(r=new zs(e,n.event,n.newStep)).execute();break;case ks:(r=new to(e,n.step,n.selection,n.eventType,n.track)).execute();break;case Es:(r=new Ys(e,n.selection)).execute();break;case Os:(r=new io(e,n.selection,n.eventType)).execute();break;case Ss:return(r=new so(n.track,n.pattern,n.startStep)).execute(),r;case Ps:return(r=new Ws(n.track,n.pattern,n.step)).execute(),r;case ws:return(r=new uo(n.track,n.pattern,n.step)).execute(),r;case js:return(r=new lo(n.track,n.pattern)).execute(),r;case Ts:return(r=new po(n.pattern,n.direction,n.resizedStep)).execute(),r;default:return}n.event?n.event.parentEvent?(e.updateTypeRedux(n.event.parentEvent.getType()),e.prune(n.event.parentEvent.getType())):(e.updateTypeRedux(n.event.getType()),e.prune(n.event.getType())):e.updateAllTypeRedux()}(this,e)}},{key:"addEvent",value:function(e){var t=this.getTimeForEventToAdd(e);if(void 0!==t){e.subSequence=this.subSequence;e.cancel(),e.isDeterministic()?new Ds(this,e,t.time,t.step).execute():new Ns(this,e,t.time,t.step).execute(),setTimeout(function(){e.canceled=!1},5e3),e.isDeterministic()&&this.updateAllTypeRedux()}}},{key:"getNextEvent",value:function(e){var t=e.getType();return this.deterministicMixesByType[t].getNextEvent(e)}},{key:"getPreviousEvent",value:function(e){var t=e.getType();return this.deterministicMixesByType[t].getPreviousEvent(e)}},{key:"resizeEvent",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];new fo(this,e,t,n).execute(),this.updateAllTypeRedux()}},{key:"resizeSequenceRoll",value:function(e,t,n,r){new Eo(this,e,t,n,r).execute(),this.updateAllTypeRedux()}},{key:"insertEvent",value:function(e,t){new Is(this,e,t).execute(),this.updateAllTypeRedux()}},{key:"pasteEvents",value:function(e,t){new vo(this,e,t).execute(),this.updateAllTypeRedux()}},{key:"deleteEvent",value:function(e,t){new Fs(this,e,t).execute(),this.updateAllTypeRedux()}},{key:"deleteCompoundEvent",value:function(e,t){new Hs(this,e,t).execute(),this.updateAllTypeRedux()}},{key:"seekToTrackStep",value:function(e){for(var t in this.mixesByType)this.mixesByType[t].seekToTrackStep(e);for(var n in this.deterministicMixesByType)this.deterministicMixesByType[n].seekToTrackStep(e)}},{key:"restart",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var t in this.mixesByType)this.mixesByType[t].restart(e);for(var n in this.deterministicMixesByType)this.deterministicMixesByType[n].restart(e)}},{key:"scheduleNext",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r,a,i;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(i in r=new x.a.Time(x.a.Master.context.currentTime).toMilliseconds(),a=new x.a.Time(n).toMilliseconds()-r,this.mixesByType)this.mixesByType[i].scheduleNext(t,a,this.sequencerEngine);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"eraseEventsAtStep",value:function(e){for(var t in this.mixesByType)this.mixesByType[t].eraseEventsAtStep(e)}},{key:"schedule",value:function(){for(var e in this.mixesByType)this.mixesByType[e].schedule()}},{key:"getJson",value:function(){var e={};for(var t in this.mixesByType)e[t]=this.mixesByType[t].getJson();var n={};for(var r in this.deterministicMixesByType)n[r]=this.deterministicMixesByType[r].getJson();return{name:this.name,mixesByType:e,deterministicMixesByType:n}}},{key:"getCopy",value:function(){var e=new n(this.name);return e.mixesByType=this.mixesByType,e.deterministicMixesByType=this.deterministicMixesByType,e}},{key:"getFirstEvent",value:function(e){return this.deterministicMixesByType[e].defaultValue}},{key:"loadFromJson",value:function(e,t){if(void 0!==e){for(var n in t=this.sequencerEngine,e.mixesByType)this.mixesByType[n]=new ls(parseInt(n),t,this.subSequence),this.mixesByType[n].loadFromJson(e.mixesByType[n],t,this.subSequence);for(var r in e.deterministicMixesByType){var a=void 0;(r=parseInt(r))===de?a=new _(0):r===Se?a=new fe(!1,new Xe):r===Pe&&(a=new ue(new Xe)),this.deterministicMixesByType[r]=new hs(parseInt(r),a),this.deterministicMixesByType[r].loadFromJson(e.deterministicMixesByType[r],t)}this.updateAllTypeRedux()}}},{key:"updateTypeRedux",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O.Rb,n=this.deterministicMixesByType[e],r=[],a=this.getFirstEvent(e);a.step=0;for(var i=0;i<n.events.length;i++)a.duration=n.events[i].step-a.step,r.push(a),a=n.events[i];var s=n.events[n.events.length-1]||a;s&&(s.duration=void 0,r.push(s)),this.sequencerEngine.store.dispatch(t(this.subSequence.id,e,r))}},{key:"updateAllTypeRedux",value:function(){for(var e in this.mixesByType)this.mixesByType[e].updateRedux(this.subSequence,this.sequencerEngine);this.updateTypeRedux(de,O.Rb),this.updateTypeRedux(Se,O.Rb)}},{key:"clear",value:function(){for(var e in this.deterministicMixesByType)this.deterministicMixesByType[e].clear();for(var t in this.mixesByType)this.mixesByType[t].clear();this.updateAllTypeRedux()}},{key:"prune",value:function(e){e in this.deterministicMixesByType&&this.deterministicMixesByType[e].prune(),e in this.mixesByType&&this.deterministicMixesByType[e].prune()}},{key:"length",get:function(){var e=[];for(var t in this.deterministicMixesByType){var n=this.deterministicMixesByType[t];e=[].concat(Object(M.a)(e),Object(M.a)(n.events.map(function(e){return e.step})))}for(var r in this.mixesByType){var a=this.mixesByType[r];e=[].concat(Object(M.a)(e),Object(M.a)(a.events.map(function(e){return e.step})))}var i=Math.max.apply(Math,Object(M.a)(e.filter(function(e){return void 0!==e&&!isNaN(e)})));return i===-1/0?0:i}}]),n}(function(){function e(t,n){Object(o.a)(this,e),this.sequencerEngine=t,this.subSequence=void 0===n?je:n}return Object(c.a)(e,[{key:"getTimeForEventToAdd",value:function(e){if(this.sequencerEngine.playing){var t=new x.a.Time(x.a.Master.currentTime).toMilliseconds()-new x.a.Time(this.sequencerEngine.automationTime).toMilliseconds(),n=this.sequencerEngine.automationStep||0;return e.isDeterministic()||n--,{time:t,step:n}}}},{key:"seekToTrackStep",value:function(e){}},{key:"resizeEvent",value:function(e,t,n){}},{key:"deleteEvent",value:function(e,t){}},{key:"deleteCompoundEvent",value:function(e,t){}},{key:"insertEvent",value:function(e,t){}},{key:"pasteEvents",value:function(e,t){}},{key:"restart",value:function(){}},{key:"addEvent",value:function(e){}},{key:"holdEvent",value:function(e){}},{key:"scheduleNext",value:function(e,t){}},{key:"schedule",value:function(){}},{key:"getValue",value:function(e,t){}},{key:"getEvent",value:function(e,t){}}]),e}());function Po(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var wo=function(e){Object(u.a)(n,e);var t=Po(n);function n(e,r,a,i){var s;return Object(o.a)(this,n),(s=t.call(this,i)).pattern=e,s.stepNumber=r,s.resolution=a,s}return Object(c.a)(n,[{key:"search",value:function(e,t){if(void 0!==this.stepNumber){void 0===this.resolution||this.resolution.toString();if(this.stepNumber===e&&t.equals(this.resolution))return this;if(void 0!==this.children)for(var n in this.children){var r=this.children[n].search(e,t);if(void 0!==r)return r}}else for(var a in this.children){var i=this.children[a].search(e,t);if(void 0!==i)return i}}},{key:"toggle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this.on){var t=this.getAllLeaves().filter(function(e){return e.on}),n=[];for(var r in t){var a=t[r];n.push({stepBucket:this.stepBuckets[a.stepNumber],stepNumber:a.stepNumber});var i=e||this.stepBuckets[a.stepNumber].getAllOnSteps()[0].id;this.stepBuckets[a.stepNumber]=new ze(this.pattern.track,this.resolution.isTriplet),this.stepBuckets[a.stepNumber].steps[0].id=i}return n}var s=this.getLeftMostLeaf();this.on=!0,e=e||this.stepBuckets[s.stepNumber].steps[0].id,this.getLeftMostBucket().steps[0].id=e;var o=new ze(this.pattern.track,this.resolution.isTriplet);return o.steps[0].id=e,[{stepBucket:o,stepNumber:s.stepNumber}]}},{key:"getLeftMostBucket",value:function(){var e=this.getLeftMostLeaf();return this.stepBuckets[e.stepNumber]}},{key:"getJson",value:function(){return void 0===this.children?{stepNumber:this.stepNumber,resolution:this.resolution}:{stepNumber:this.stepNumber,resolution:this.resolution,children:this.children.map(function(e){return e.getJson()})}}},{key:"stepBuckets",get:function(){return this.resolution.isTriplet?this.pattern.tripletStepBuckets:this.pattern.stepBuckets}},{key:"on",set:function(e){this.getLeftMostBucket().steps[0].on=e},get:function(){return void 0===this.children?this.stepBuckets[this.stepNumber].anyOn():this.getAllLeaves().some(function(e){return e.on})}}]),n}(function(){function e(t){Object(o.a)(this,e),this.children=t}return Object(c.a)(e,[{key:"getAllLeaves",value:function(){if(void 0===this.children)return[this];var e=[];for(var t in this.children)e=e.concat(this.children[t].getAllLeaves());return e}},{key:"getLeftMostLeaf",value:function(){var e=this.getAllLeaves();if(e.length>0)return e[0]}}]),e}());function jo(e,t){for(var n=new Xe(1,t),r=e.length(n),a=[],i=0;i<r;i++){var s=new wo(e,i,n,void 0);a.push(To(s,e,t))}return new wo(e,void 0,void 0,a)}function To(e,t,n){var r=e.resolution;if(32===r.resolution)return e;var a=new Xe(2*r.resolution,r.isTriplet);if(n){var i=new wo(t,3*e.stepNumber,a,void 0),s=new wo(t,3*e.stepNumber+1,a,void 0),o=new wo(t,3*e.stepNumber+2,a,void 0);e.children=[To(i,t),To(s,t),To(o,t)]}else{var c=new wo(t,2*e.stepNumber,a,void 0),u=new wo(t,2*e.stepNumber+1,a,void 0);e.children=[To(c,t),To(u,t)]}return e}var xo=new Xe(32,!1),Co=new Xe(32,!0),No=new Xe(16,!1),Ro=0,Do=function(){function e(t,n){Object(o.a)(this,e),this.steps=[],this.id=Ro++,this.sequencerEngine=t,this.store=t.store,this.track=n,this.mix=new So(t),this.stepBuckets=[],this.tripletStepBuckets=[],this.stepBucketsMatrix={},this.tripletStepBucketsMatrix={},this.transformBucketsIntoStepsCache={},this.stepFills=[],this.tripletStepFills=[],this.volume=75,this.panning=0,this.muted=!1,this.initBlankPattern(),this.color=void 0,this.loopsPlaying={},this.sequencerEngine.multiSequencerEngine||this.updateStepResolutionTree(),this.needsSync=!1,this._startStep=void 0,this.repeats=void 0}return Object(c.a)(e,[{key:"updateStepResolutionTree",value:function(){this.stepResolutionTree=jo(this,!1),this.tripletStepResolutionTree=jo(this,!0)}},{key:"getStepResolutionTree",value:function(e){return e?this.tripletStepResolutionTree:this.stepResolutionTree}},{key:"getBucketsForStepAtResolution",value:function(e,t){for(var n=this.getRangeOfStepsAtResolution(t),r=t.isTriplet?this.tripletStepBuckets:this.stepBuckets,a=t.isTriplet?Co.transformStepAtResolution(e,t):xo.transformStepAtResolution(e,t),i=[],s=a=Math.floor(a);s<n+a;s++)i.push(r[s%r.length]);return i}},{key:"deleteStepNumber",value:function(e){this.stepBuckets[e]=new ze(this.track)}},{key:"getRangeOfStepsAtResolution",value:function(e){return e.isTriplet?Co.numSteps()/e.numSteps():xo.numSteps()/e.numSteps()}},{key:"getAllOnStepAtResolutionAtAnyPosition",value:function(e,t){this.getRangeOfStepsAtResolution(t);var n=this.getBucketsForStepAtResolution(e,t),r=[];for(var a in n)r=r.concat(n[a].getAllOnSteps());return r}},{key:"getStepAtResolution",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=(this.getRangeOfStepsAtResolution(t),this.getBucketsForStepAtResolution(e,t));for(var i in a)if(void 0!==a[i]){var s=a[i].getStep(r);if(s.getPolyphony().some(function(e){return e.on&&n(e)}))return s}a.length}},{key:"getPolyphonicStepsAtResolution",value:function(e,t){var n=t.isTriplet?Co.numSteps()/t.numSteps():xo.numSteps()/t.numSteps(),r=[];if(t.isTriplet){var a=Co.transformStepAtResolution(e,t);this.tripletStepBuckets[a%this.tripletStepBuckets.length];for(var i=a;i<n+a;i++){var s=this.tripletStepBuckets[i%this.tripletStepBuckets.length].steps,o=function(e){var t=s[e].getPolyphony().filter(function(e){return e.on}).map(function(t){return{position:e,step:t}});r=r.concat(t)};for(var c in s)o(c)}}else{var u=xo.transformStepAtResolution(e,t);this.stepBuckets[u%this.stepBuckets.length];for(var l=u;l<n+u;l++){var p=this.stepBuckets[l%this.stepBuckets.length].steps,h=function(e){var t=p[e].getPolyphony().filter(function(e){return e.on}).map(function(t){return{position:e,step:t}});r=r.concat(t)};for(var f in p)h(f)}}return r}},{key:"setStepAtResolution",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;(void 0===t||isNaN(t))&&(t=0),(void 0===r||isNaN(r))&&(r=0),t=n.isTriplet?Co.transformStepAtResolution2(t,n):xo.transformStepAtResolution2(t,n);var a=Math.floor(t);if((r+=t-a)>=1){var i=Math.floor(r);a+=i,r-=i}n.isTriplet?this.tripletStepBuckets[a%this.tripletStepBuckets.length].setStepAtPosition(e,r):this.stepBuckets[a%this.stepBuckets.length].setStepAtPosition(e,r)}},{key:"addNote",value:function(e,t,n){var r=new Ge;r.on=!0,r.duration=t,r.transpose=n,r.stepNumber=e,this.stepBuckets[e].setStep(0,r)}},{key:"clearCache",value:function(){this.transformBucketsIntoStepsCache={}}},{key:"loadStepBuckets",value:function(e){e&&(this.stepBuckets=e),this.tripletStepBuckets=Co.transformBucketsAtResolution(this.stepBuckets,xo),this.updateStepResolutionTree(),this.transformBucketsIntoStepsCache={},this.syncMatrix()}},{key:"syncBuckets",value:function(e){(e=void 0!==e&&e)?this.stepBuckets=xo.transformBucketsAtResolution(this.tripletStepBuckets,Co):this.tripletStepBuckets=Co.transformBucketsAtResolution(this.stepBuckets,xo),this.syncMatrix()}},{key:"syncMatrixBySteps",value:function(e,t){for(var n in this.needsSync=!1,e){var r=e[n];n=xo.transformStepAtResolution(n,t),r=xo.transformStepAtResolution(r,t);var a=this.stepBuckets[n],i=this.stepBuckets[r];a&&a.anyOn()?this.stepBucketsMatrix[n]=a:delete this.stepBucketsMatrix[n],i&&i.anyOn()?this.stepBucketsMatrix[r]=i:delete this.stepBucketsMatrix[r]}}},{key:"syncMatrix",value:function(){this.stepBucketsMatrix={},this.tripletStepBucketsMatrix={};for(var e=0;e<this.stepBuckets.length;e++){var t=this.stepBuckets[e];t.anyOn()&&(this.stepBucketsMatrix[e]=t)}for(var n=0;n<this.tripletStepBuckets.length;n++){var r=this.tripletStepBuckets[n];r.anyOn()&&(this.tripletStepBucketsMatrix[n]=r)}this.needsSync=!1}},{key:"getBucket",value:function(e,t){return e=(t=t||xo).isTriplet?Co.transformStepAtResolution2(e,t):xo.transformStepAtResolution2(e,t),t.isTriplet?this.tripletStepBuckets[e]:this.stepBuckets[e]}},{key:"clear",value:function(){this.stepBuckets.map(function(e){return e.clear()}),this.syncBuckets(),this.clearCache()}},{key:"changeLength",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e=Math.ceil(e),this.stepBuckets=this.stepBuckets.slice(0,e);for(var n=this.stepBuckets.length;n<e;n++)this.stepBuckets.push(new ze(this.track));this.clearCache(),t&&this.syncBuckets()}},{key:"length",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xo;if(e===xo)return e.isTriplet?this.tripletStepBuckets.length:this.stepBuckets.length;var t=e.isTriplet?this.tripletStepBuckets.length:this.stepBuckets.length;return e.isTriplet?Math.ceil(e.transformStepAtResolution2(t,Co)):Math.ceil(e.transformStepAtResolution2(t,xo))}},{key:"initBlankPattern",value:function(){for(var e=0;e<xo.numSteps();e++)this.stepBuckets.push(new ze(this.track)),this.stepFills.push(!1);if(!this.sequencerEngine.multiSequencerEngine)for(e=0;e<Co.numSteps();e++)this.tripletStepBuckets.push(new ze(this.track,!0)),this.tripletStepFills.push(!1)}},{key:"getFillsAtResolution",value:function(e){return e.isTriplet?e.transformList(this.tripletStepFills):e.transformList(this.stepFills)}},{key:"getStepsAtResolution",value:function(e){var t=e.isTriplet?this.tripletStepBuckets:this.stepBuckets;if(!(e in this.transformBucketsIntoStepsCache)){var n=e.transformBucketsIntoSteps(t);return this.transformBucketsIntoStepsCache[e]=n,n}return this.transformBucketsIntoStepsCache[e]}},{key:"getAnyStep",value:function(e){for(var t in this.stepBuckets[e].steps){var n=this.stepBuckets[e].steps[t];if(n.on)return n}return this.stepBuckets[e].steps[0]}},{key:"getBucketsAtResolution",value:function(e){var t=e.isTriplet?this.tripletStepBuckets:this.stepBuckets;return e.transformList(t)}},{key:"setLength",value:function(e){this.stepBuckets=[];for(var t=0;t<e;t++)this.stepBuckets.push(new ze(this.track));this.syncBuckets(!1)}},{key:"doubleTrackLength",value:function(){for(var e=this.stepBuckets.length,t=0;t<e;t++)this.stepBuckets.push(new ze(this.track)),this.stepFills.push(!1);e=this.tripletStepBuckets.length;for(var n=0;n<e;n++)this.tripletStepBuckets.push(new ze(this.track,!0)),this.tripletStepFills.push(!1);this.clearCache(),this.updateStepResolutionTree()}},{key:"halfTrackLength",value:function(){var e=this.length()/2;this.stepBuckets=this.stepBuckets.slice(0,e),this.stepFills=this.stepFills.slice(0,e),e=this.tripletStepBuckets.length/2,this.tripletStepBuckets=this.tripletStepBuckets.slice(0,e),this.tripletStepFills=this.tripletStepFills.slice(0,e),this.clearCache(),this.updateStepResolutionTree()}},{key:"loadFromJson",value:function(e){if(void 0===e.newVolume){var t=e.volume+40;this.volume=128*t/60}else this.volume=e.volume;this.panning="panning"in e?e.panning:0,this.muted=e.muted,this.loopsPlaying="loopsPlaying"in e?e.loopsPlaying:{},"startStep"in e&&(this.startStep=e.startStep),"repeats"in e&&(this.repeats=e.repeats)}},{key:"calculateFillsHelper",value:function(e,t,n){n.isTriplet?this.tripletStepFills.fill(!1):this.stepFills.fill(!1);for(var r=t.length,a=0;a<r;a++){var i=-16;for(var s in t[a].steps){var o=t[a].getStep(s);if(o.on){var c=null==o.duration?e.duration:o.duration;i<(c=2*Math.floor(c))&&(i=c)}}if(!(i<1))for(var u=0;u<i;u++){var l=(a+u)%r;n.isTriplet?this.tripletStepFills[l]=!0:this.stepFills[l]=!0}}}},{key:"calculateFills",value:function(e){this.calculateFillsHelper(e,this.stepBuckets,xo),this.calculateFillsHelper(e,this.tripletStepBuckets,Co)}},{key:"getJson",value:function(){return{newVolume:!0,automations:this.mix.getJson(),volume:this.volume,panning:this.panning,muted:this.muted,loopsPlaying:this.loopsPlaying,startStep:this.startStep,repats:this.repeats}}},{key:"getCopy",value:function(){var t=Object(R.a)(N.a.mark(function t(){var n,r,a,i,s,o,c=this,u=arguments;return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=u.length>0&&void 0!==u[0]?u[0]:0,r=u.length>1&&void 0!==u[1]?u[1]:this.stepBuckets.length,a=u.length>2&&void 0!==u[2]?u[2]:this.track,(i=new e(this.sequencerEngine,a)).stepBuckets=[],i.mix=this.mix,i.tripletStepBuckets=[],i.volume=this.volume,i.panning=this.panning,i.muted=this.muted,i.steps=[],i.loopsPlaying={},Object.keys(this.loopsPlaying).map(function(e){return i.loopsPlaying[e]=c.loopsPlaying[e]}),s=n;case 14:if(!(s<r)){t.next=23;break}return t.next=17,this.stepBuckets[s].getCopy(a);case 17:o=t.sent,i.stepBuckets.push(o),i.stepFills.push(this.stepFills[s]);case 20:s++,t.next=14;break;case 23:return i.startStep=void 0===this.startStep?void 0:this.startStep+n,i.updateStepResolutionTree(),i.syncBuckets(),t.abrupt("return",i);case 27:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"chooseColor",value:function(e){this.color=e}},{key:"getUpdateStepsAction",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=No,r=this.length(n),a=new Array(r).fill(!1),i={},s={},o={},c={},u=new Array(r),l=this.getEasyPattern();t&&l.update();var p=n.isTriplet?this.tripletStepBucketsMatrix:this.stepBucketsMatrix,h=n.isTriplet?new Xe(32,!0):new Xe(32,!1),f=function(t){var l=Math.floor(n.transformStepAtResolution2(t,h));a[l]=!0;var f=h.resolution/n.resolution,d=(t-l*f)/f,m={},v=[];if(void 0===p[t])return"continue";var g={};for(var y in p[t].steps){var b=p[t].steps[y].getPolyphony();for(var k in b){var E=b[k];if(E.on){var O=e.snapTransposeToScale(Math.round(E.transpose));m[O]=parseFloat(y)/f+d;var S=new Xe(16,!1);g[O]=n.transformStepAtResolution2(E.duration,S),v.push(E)}}}var P=p[t].getAllOnSteps()[0];u[l]=P;var w={};for(var j in v.filter(function(e){return e.on}).forEach(function(t){return w[e.snapTransposeToScale(null==t.transpose?e.trackData.transpose:t.transpose)]=!0}),m)j in i||(i[j]={}),i[j][parseInt(l)]=P.id,j in s||(s[j]={}),s[j][parseInt(l)]=m[j];for(var T in g)T in o||(o[T]={}),o[T][parseInt(l)]=g[T];for(var x in v){var C=v[x];if(C.on)for(var N=n.transformStepAtResolution2(C.duration,new Xe(16,!1)),R=0;R<N;R++){var D=(parseInt(l)+parseInt(R))%r;c[parseInt(D)]=!0}}};for(var d in p)f(d);return this.sequencerEngine.midi&&this.sequencerEngine.cursor.track===this.trackNumber&&this.sequencerEngine.midi.updateSteps(a),{trackNumber:this.subSequence.isTrack?this.subSequence.id:this.trackNumber,steps:a,pianoRollSteps:i,trackFills:c,stepToId:u,pianoRollPositions:s,pianoRollDurations:o,muted:this.track.muted}}},{key:"snapTransposeToScale",value:function(e){return this.track.sequencerEngine.rules.snapTransposeToScale(e)}},{key:"getTrackStepsAction",value:function(){var e=No,t=this.length(e),n=new Array(t).fill(!1),r=e.isTriplet?this.tripletStepBucketsMatrix:this.stepBucketsMatrix,a=e.isTriplet?new Xe(32,!0):new Xe(32,!1);for(var i in r){n[Math.floor(e.transformStepAtResolution2(i,a))]=!0}return n}},{key:"getEasyPattern",value:function(){return new os(this,this.trackData)}},{key:"split",value:function(t){var n=t-this.startStep,r=(this.length(),new e(this.sequencerEngine,this.track));return r.stepBuckets=this.stepBuckets.slice(n),this.stepBuckets=this.stepBuckets.slice(0,n),r.startStep=t,this.syncBuckets(),r.syncBuckets(),r}},{key:"overlapsStep",value:function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?e>=this.startStep&&e<=this.startStep+this.length():e>=this.startStep&&e<this.startStep+this.length()}},{key:"addToStart",value:function(e){for(var t=[],n=0;n<e;n++)t.push(new ze(this.track));this.stepBuckets=[].concat(t,Object(M.a)(this.stepBuckets)),this.syncBuckets()}},{key:"cutFromStart",value:function(e){this.stepBuckets=this.stepBuckets.slice(e),this.syncBuckets()}},{key:"startStep",set:function(e){e<0||(this._startStep=e,void 0!==e&&this.sequencerEngine.store.dispatch(Object(O.C)(this.track.subSequence.id,this.id,e)))},get:function(){return this._startStep}},{key:"step",get:function(){return this._startStep}},{key:"duration",get:function(){return this.length()}},{key:"endStep",get:function(){return this._startStep+this.length()}},{key:"trackPatternSteps",get:function(){var e=this.subSequence.isTrack?this.subSequence.id:this.trackNumber;return this.sequencerEngine.state.tracks.trackPatternSteps[e]||{}}},{key:"subSequence",get:function(){return this.track.subSequence}},{key:"trackNumber",get:function(){return this.track.trackNumber}},{key:"trackData",get:function(){return this.track.trackData}}]),e}();function qo(){if(!(this instanceof qo))return arguments.length>1||"number"!==typeof arguments[0]?qo.apply(new qo(arguments.length),arguments):new qo(arguments[0]);if(0===arguments.length)throw new Error("Missing Argument: You must pass a valid buffer length");return this.size=this.start=0,this.overflow=null,arguments.length>1||"number"!==typeof arguments[0]?(this.data=new Array(arguments.length),this.end=(this.length=arguments.length)-1,this.push.apply(this,arguments)):(this.data=new Array(arguments[0]),this.end=(this.length=arguments[0])-1),this}function Mo(e,t){return e==t?0:e>t?1:-1}qo.prototype={constructor:qo,pop:function(){var e;if(0!==this.size)return e=this.data[this.end],delete this.data[this.end],this.end=(this.end-1+this.length)%this.length,this.size--,e},push:function(){var e=0;if(this.overflow&&this.size+arguments.length>this.length)for(;e<this.size+arguments.length-this.length;e++)this.overflow(this.data[(this.end+e+1)%this.length],this);for(e=0;e<arguments.length;e++)this.data[(this.end+e+1)%this.length]=arguments[e];return this.size<this.length&&(this.size+e>this.length?this.size=this.length:this.size+=e),this.end=(this.end+e)%this.length,this.start=(this.length+this.end-this.size+1)%this.length,this.size},reverse:function(){for(var e,t=0;t<~~(this.size/2);t++)e=this.data[(this.start+t)%this.length],this.data[(this.start+t)%this.length]=this.data[(this.start+(this.size-t-1))%this.length],this.data[(this.start+(this.size-t-1))%this.length]=e;return this},rotateLeft:function(e){if("undefined"===typeof e&&(e=1),"number"!==typeof e)throw new Error("Argument must be a number");for(;--e>=0;)this.push(this.shift());return this},rotateRight:function(e){if("undefined"===typeof e&&(e=1),"number"!==typeof e)throw new Error("Argument must be a number");for(;--e>=0;)this.unshift(this.pop());return this},shift:function(){var e;if(0!==this.size)return e=this.data[this.start],this.start=(this.start+1)%this.length,this.size--,e},sort:function(e){return this.data.sort(e||Mo),this.start=0,this.end=this.size-1,this},unshift:function(){var e=0;if(this.overflow&&this.size+arguments.length>this.length)for(;e<this.size+arguments.length-this.length;e++)this.overflow(this.data[this.end-e%this.length],this);for(e=0;e<arguments.length;e++)this.data[(this.length+this.start-e%this.length-1)%this.length]=arguments[e];return this.length-this.size-e<0&&(this.end+=this.length-this.size-e,this.end<0&&(this.end=this.length+this.end%this.length)),this.size<this.length&&(this.size+e>this.length?this.size=this.length:this.size+=e),this.start-=arguments.length,this.start<0&&(this.start=this.length+this.start%this.length),this.size},indexOf:function(e,t){for(t||(t=0);t<this.size;t++)if(this.data[(this.start+t)%this.length]===e)return t;return-1},lastIndexOf:function(e,t){for(t||(t=this.size-1);t>=0;t--)if(this.data[(this.start+t)%this.length]===e)return t;return-1},sortedIndex:function(e,t,n){t=t||Mo;var r=this.start,a=this.size-1;for(r&&t.call(n,e,this.data[a])>0&&(r=0,a=this.end);r<a;){var i=r+a>>>1;t.call(n,e,this.data[i])>0?r=i+1:a=i}return((r-this.start)%this.size+this.size)%this.size},every:function(e,t){for(var n=0;n<this.size;n++)if(!e.call(t,this.data[(this.start+n)%this.length],n,this))return!1;return!0},forEach:function(e,t){for(var n=0;n<this.size;n++)e.call(t,this.data[(this.start+n)%this.length],n,this)},some:function(e,t){for(var n=0;n<this.size;n++)if(e.call(t,this.data[(this.start+n)%this.length],n,this))return!0;return!1},avg:function(){return 0==this.size?0:this.sum()/this.size},sum:function(){for(var e=this.size,t=0;e--;)t+=this.data[e];return t},median:function(){if(0===this.size)return 0;var e=this.slice().sort(Mo),t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2},empty:function(){return this.size=this.start=0,this.end=this.length-1,this},fill:function(e){var t=0;if("function"===typeof e)for(;this.data[t]=e(),++t<this.length;);else for(;this.data[t]=e,++t<this.length;);return this.start=0,this.end=this.length-1,this.size=this.length,this},first:function(){return this.data[this.start]},last:function(){return this.data[this.end]},get:function(e){return this.data[(this.start+e)%this.length]},isFull:function(e){return this.length===this.size},set:function(e,t){return this.data[(this.start+e)%this.length]=t},toArray:function(){return this.slice()},slice:function(e,t){var n=this.size;if((e=+e||0)<0){if(e>=t)return[];e=-e>n?0:n+e}null==t||t>n?t=n:t<0?t+=n:t=+t||0,n=e<t?t-e:0;for(var r=Array(n),a=0;a<n;a++)r[a]=this.data[(this.start+e+a)%this.length];return r}};var Ao=qo;var Io=function(e,t){this.timestretch=function(e){for(var t=e.getChannelData(0),n=e.getChannelData(1),r=[],a=[],i=0;i<100;i++)this.process(t[i],r),this.process(n[i],a);t=new Float32Array(r),n=new Float32Array(a),e.set(x.a.Buffer.fromArray([t,n]))},this.process=function(e,t){var n=function(e){for(var t=new Float32Array(e.length),n=0;n<e.length;n++)t[n]=i[n]*e[n];return t}(e);return function(e,t,n,r,a,i,s){for(var o,c=0,u=0;u<e;u++)o=a.shift()||0,c=r.shift()||0,s.push(c/(o<.01?1:o)),r.push(0),a.push(0);for(var u=0;u<i;u++)c=r.shift(),r.push(t[u]+c),o=a.shift(),a.push(n[u]+o)}(a,n,s,h,f,c,t),m=!1,a},this.beta_fn=function(e){return n<=1?2:n<=1.2?2:n<=1.4?2:n<=1.8?2.5:3},this.overlap_fn=function(e){return e<1.25?e+.15:e>=1.25&&e<1.5?e+.2:e>=1.5&&e<1.8?e+.6:e>=1.8&&e<2?e+.9:e+2.2},this.get_hs=function(){return a},this.get_ha=function(){return r},this.get_alpha=function(){return n},this.get_real_alpha=function(){return a/r},this.get_overlap_factor=function(){return l},this.clear_buffers=function(){h=new Ao(c),f=new Ao(c),m=!0},this.set_window_type=function(e){p=o[e]?e:p},this.set_alpha=function(e,t,i){n=e,void 0==i?this.set_beta(this.beta_fn(n)):this.set_beta(i),l=void 0==t?this.overlap_fn(n):t,r=Math.round(c/l),a=Math.round(n*r)},this.set_beta=function(e){i=function(e,t,n){for(var r=new Float32Array(e),a=0;a<e;a++)r[a]=o[n](e,a,t);return r}(c,u=e,p),s=new Float32Array(i.length);for(var t=0;t<s.length;t++)s[t]=Math.pow(i[t],1)};var n,r,a,i,s,o={Lanczos:function(e,t,n){var r=2*t/(e-1)-1;return Math.pow(Math.sin(Math.PI*r)/(Math.PI*r),n)},Triangular:function(e,t,n){return Math.pow(2/e*(e/2-Math.abs(t-(e-1)/2)),n)},Bartlett:function(e,t,n){return Math.pow(2/(e-1)*((e-1)/2-Math.abs(t-(e-1)/2)),n)},BartlettHann:function(e,t,n){return Math.pow(.62-.48*Math.abs(t/(e-1)-.5)-.38*Math.cos(2*Math.PI*t/(e-1)),n)},Blackman:function(e,t,n){var r=n/2;return(1-n)/2-.5*Math.cos(2*Math.PI*t/(e-1))+r*Math.cos(4*Math.PI*t/(e-1))},Cosine:function(e,t,n){return Math.pow(Math.cos(Math.PI*t/(e-1)-Math.PI/2),n)},Gauss:function(e,t,n){return Math.pow(Math.E,-.5*Math.pow((t-(e-1)/2)/(n*(e-1)/2),2))},Hamming:function(e,t,n){return Math.pow(.54-.46*Math.cos(2*Math.PI*t/(e-1)),n)},Hann:function(e,t,n){return Math.pow(.5*(1-Math.cos(2*Math.PI*t/(e-1))),n)},Rectangular:function(e,t,n){return n},SinBeta:function(e,t,n){return Math.pow(Math.sin(Math.PI*t/e),n)},Trapezoidal:function(e,t,n){var r=Math.round(e/4),a=r-1,i=9*r-1;return t<=a?Math.pow(t/a,n):t>=i?Math.pow(i/t,n):1}},c=e,u=1,l=1.1,p="Lanczos";this.set_alpha(1),this.set_beta(u);for(var h=new Ao(c),f=new Ao(c),d=0;d<c;d++)h.push(0),f.push(0);var m=!0;this.is_clean=function(){return m}};var Lo=function(e){var t,n=e||4096,r=new Io(n),a=new Io(n),i=0,s=1,o=new Ao(Math.round(1.2*n)),c=new Ao(Math.round(1.2*n)),u=new Float32Array(e);this.process=function(e){if(t){for(var l=0,p=t.getChannelData(0),h=t.getChannelData(1),f=e.getChannelData(0),d=e.getChannelData(1);c.size>0&&l<e.length;)f[g=l++]=o.shift(),d[g]=c.shift();if(l!=e.length)do{var m=p.subarray(i,i+n),v=h.subarray(i,i+n);void 0!=s&&s!=r.get_alpha()&&(r.set_alpha(s),a.set_alpha(s),s=void 0),m.length<n?(u.set(0,m),r.process(u,o),u.set(0,v),a.process(u,c),u.fill(0)):(r.process(m,o),a.process(v,c));for(var g=l;o.size>0&&g<e.length;g++)f[g]=o.shift(),d[g]=c.shift();l+=r.get_hs(),i+=r.get_ha()}while(l<e.length)}},this.set_audio_buffer=function(e){t=e},Object.defineProperties(this,{position:{get:function(){return i},set:function(e){i=new Number(e)}},alpha:{get:function(){return r.get_alpha()},set:function(e){s=new Number(e)}}})},Fo=(n(527),n(2320),n(1651),n(387)),Bo=8,Ho=new x.a.Time("16n"),Vo=new x.a.Time("32n"),Uo=x.a.Frequency("C3"),Jo=0,_o=function(){function e(t,n,r,a,i){var s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];Object(o.a)(this,e),this.id=Jo++,this.store=t.store,this.parameters=[],this.counter=0,this.baseTranspose=0,this.sample=n,this.tempo=n.tempo||i.tempo,this.samplerData=i,this.onsets=n.onsets||[],this.sliceData=a,this.track=t,this.note=null,this.slices=[],this.transposeParameter=new Be("transpose",this,function(e,t){return[]},{defaultValue:0,min:-32,max:32}),this.registerParameter(this.transposeParameter),s||(this.gainNode=new x.a.Volume,this.volumeParameter=new Fn("volume",this.gainNode.volume,{min:-100,max:0,unit:"db",defaultValue:0}),this.registerParameter(this.volumeParameter)),this.alpha=1,this.tempoSynced=!1,this.audioBuffer=n.audioBuffer,this.setVolume(i.volume),this.offset=i.offset,this.transpose=i.transpose,this.onNewSampler=r,this.baseBuffer=new x.a.Buffer(n.audioBuffer),a=void 0===a?[{startTime:0,endTime:this.getDuration()}]:a,this.sliceData=a,this.pitchEnvelopes=[];for(var c=s?1:Bo,u=0;u<c;u++){var l=new x.a.ScaledEnvelope({attack:.01,decay:.01,min:0,max:1,sustain:1,release:.01,curve:"linear"});l._releaseCurve="linear",l._decayCurve="linear",this.pitchEnvelopes.push(l)}this.pitchEnvelopeIndex=0,this.detuneSignal=new x.a.Signal(0),this.detuneParameter=new Fn("detune",this.detuneSignal,{min:-200,max:200,automationRate:F}),this.registerParameter(this.detuneParameter)}return Object(c.a)(e,[{key:"registerParameter",value:function(e){e.setStore(this.store),e.setContext((new Wr).forInstrument(this).forTrack(this.track)),this.parameters.push(e)}},{key:"init",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.samplerData;var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sliceData,t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return void 0!==this.tempo||t||(this.tempo=this.analyze()),0==this.slices.length&&this.loadSlices(e),this}},{key:"sleep",value:function(e){return new Promise(function(t,n){setTimeout(function(){return t()},e)})}},{key:"analyze",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.baseBuffer,t=this.track.sequencerEngine.aubio,n=this.state.waveform.onsetThreshold,r=Object(Fo.a)(e,t,n),a=r.tempo,i=r.onsets,s=r.onsetToPitch;return this.onsets=i,this.onsetToPitch=s,a}},{key:"loadSlices",value:function(e){var t=this;e.map(function(e){return t.newSlice(e.startTime,e.endTime)})}},{key:"getVolume",value:function(){return this.volumeParameter.get()}},{key:"setVolume",value:function(e){void 0!==this.volumeParameter&&this.volumeParameter.set(e)}},{key:"getJson",value:function(){return{slices:this.slices.map(function(e){return e.getJson()}),volume:this.gainNode.volume.value,tempoSynced:this.tempoSynced,tempo:this.tempo,transpose:this.transpose,alpha:this.alpha,offset:this.offset,reversed:this.isReversed(),sampleId:this.sample.getId()}}},{key:"release",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,n=this.get(e),r=x.a.Master.context.currentTime,a=void 0!==t?this.getNoteFromTranspose(t):this.lastNote;n.triggerRelease(a,r),this.triggerReleaseWaveformAnimation()}},{key:"getNoteFromTranspose",value:function(e){return e+=this.track.sequencerEngine.transpose,e+=this.baseTranspose,Uo.transpose(e).transpose(this.transpose)}},{key:"releaseAll",value:function(e){var t=this;this.slices.map(function(n){return n.sampler.triggerRelease(t.lastNote,e)})}},{key:"trigger",value:function(){var t=Object(R.a)(N.a.mark(function t(n){var r,a,i,s,o,c,u,l,p,h,f,d,m;return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.getDefaultTriggerConfig(n),r=n.stepData,a=n.time,void 0===n.transpose&&(n.transpose=n.stepData.transpose||0),i=n.stepData.duration,void 0!==(s=this.get(n.sliceNumber))&&null!==s&&s.loaded){t.next=8;break}return t.abrupt("return");case 8:for(o=null,null==i||(o="number"===typeof i?Ho*i:new x.a.Time(i)),c=this.getNoteFromTranspose(n.transpose),u=n.velocity||r.velocity,l=r.chop,p=(null==o?Ho:o)/l,a=a||x.a.Master.context.currentTime,a=Vo*this.offset+a,h=new x.a.Time(a),s.attack=new x.a.Time(r.attack/1e3),s.release=new x.a.Time(r.release/1e3),r.reverse!==this.isReversed()&&this.reverse(r.reverse),f=h,d=0;d<l;d++)n.gated||null==this.lastNote||(this.releaseAll(h),this.triggerReleaseWaveformAnimation(h)),m=this.getPitchEnvelope(s,c,a,u,r),n.gated&&!n.skipRelease?this.triggerAttackRelease(s,c,o,h,u,[m],this.convertToStartTime(n.sliceNumber,r.start)):this.triggerAttack(s,c,h,u,[m],this.convertToStartTime(n.sliceNumber,r.start)),h+=p;this.lastNote=c,this.triggerWaveformAnimation(n.skipRelease?void 0:f,n.gated&&!n.skipRelease?o:void 0,n.sliceNumber,n.transpose,this.convertToStartTime(n.sliceNumber,r.start));case 25:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"convertToStartTime",value:function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)/100*this.getSlice(e).buffer.duration}},{key:"getPitchEnvelope",value:function(e,t,n,r,a){x.a.Frequency(t).toMidi();var i=this.pitchEnvelopes[this.pitchEnvelopeIndex];i.cancel(n-.001),this.pitchEnvelopeIndex=(this.pitchEnvelopeIndex+1)%this.pitchEnvelopes.length;var s=null===a.pitchSustain?1:a.pitchSustain;return i.attack=null==a.pitchAttack?0:a.pitchAttack/1e3,i.attack+=.001,i.decay=null==a.pitchDecay?0:a.pitchDecay/1e3,i.decay+=.001,i.min=0,i.max=6*s*100,i.sustain=s,i.sustain+=.001,i.release=null==a.pitchRelease?0:a.pitchRelease/1e3,i.release+=.001,i}},{key:"triggerAttack",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.get(0),n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return new Promise(function(){var c=Object(R.a)(N.a.mark(function c(u,l){var p,h;return N.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:p=function(t){e.triggerReleaseWaveformAnimation(),setTimeout(function(){void 0===t||void 0===t._source||e.isDisposed()||(e.detuneSignal.disconnect(t._source.detune),i.forEach(function(e){return e.disconnect(t._source.detune)}))},4e3),u()};try{void 0!==(h=t.triggerAttack(n,r,a,s,p,o))&&void 0!==h._source&&(i.forEach(function(e){return e.connect(h._source.detune)}),e.detuneSignal.connect(h._source.detune),i.forEach(function(e){return e.triggerAttack(r)}))}catch(l){console.log(l)}e.lastNote=n;case 3:case"end":return c.stop()}},c)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"triggerAttackRelease",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.get(0),n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,c=arguments.length>7?arguments[7]:void 0;return new Promise(function(){var u=Object(R.a)(N.a.mark(function u(l,p){var h,f;return N.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:h=1===s.length?function(){return l()}:function(t){setTimeout(function(){void 0===t||void 0===t._source||e.isDisposed()||(e.detuneSignal.disconnect(t._source.detune),s.forEach(function(e){return e.disconnect(t._source.detune)}))},4e3),l()};try{a<0&&(a=0),void 0!==(f=t.triggerAttackRelease(n,r,a,i,o,h,c))&&void 0!==f._source&&(s.forEach(function(e){return e.connect(f._source.detune)}),e.detuneSignal.connect(f._source.detune),s.length>1?s.forEach(function(e){0===e.release?e.triggerAttack(a):e.triggerAttackRelease(r,a)}):s[0].triggerAttackRelease(r,a))}catch(p){console.log(p)}e.lastNote=n;case 3:case"end":return u.stop()}},u)}));return function(e,t){return u.apply(this,arguments)}}())}},{key:"getDuration",value:function(){return this.baseBuffer.duration}},{key:"sliceFirstOnset",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r,a,i,s,o=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]&&o[0],!(void 0===this.onsets||0===this.onsets.length||this.slices.length>1)){e.next=3;break}return e.abrupt("return");case 3:if(0===(n=this.getSlice(0)).startTime&&(r=this.onsets[0]/1e3)<n.endTime&&this.slice(0,r,n.endTime,!0),!t){e.next=7;break}return e.abrupt("return");case 7:for(a=Math.floor((this.onsets.length-1)/5),i=1;i<Math.min(5,this.onsets.length);i++)(s=this.onsets[i*a]/1e3)<n.endTime&&this.newSlice(s,n.endTime);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"slice",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this.slices[e];n=void 0==n?this.getDuration():n,i.startTime=t,i.endTime=n;this.alpha;var s=++this.counter;setTimeout(function(){if(s===r.counter||a){var e=r.baseBuffer.slice(t,n);i.buffer.set(e),r.onNewSampler(r)}},100),this.sliceData[e]={startTime:t,endTime:n},this.updateSlicesState()}},{key:"updateSlicesState",value:function(){this.store.dispatch(Object(O.xc)(this.id,this.slices.map(function(e){return e.getJson()})))}},{key:"syncTempo",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null!=this.tempo&&(t?(this.alpha=this.tempo/e,this.timestretch()):this.baseTranspose=12*(e/this.tempo-1)),this.tempoSynced=!0}},{key:"unsyncTempo",value:function(){this.alpha=1,this.tempoSynced=!1,this.baseTranspose=0}},{key:"timestretch",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r,a,i;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(1!=this.alpha){e.next=3;break}return this.unsyncTempo(),e.abrupt("return");case 3:t=this.getDuration(),n=new Lo(4096),r=this.alpha,n.alpha=r,a=t*r*x.a.context.sampleRate-4096*this.alpha,i=x.a.context.createBuffer(2,a,x.a.context.sampleRate),n.set_audio_buffer(this.baseBuffer.get()),n.process(i);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"reverse",value:function(e){var t=this;this.baseBuffer.reverse=e,this.slices.forEach(function(e,n){return t.slice(n,e.startTime,e.endTime,!0)})}},{key:"isReversed",value:function(){return void 0!==this.baseBuffer&&this.baseBuffer.reverse}},{key:"deleteSlice",value:function(e){1!==this.slices.length&&(this.slices.splice(e,1),this.sliceData.splice(e,1),this.updateSlicesState())}},{key:"newSlice",value:function(e,t){if(void 0!==e||void 0!==t){t=t||this.getDuration();var n=this.baseBuffer.slice(e,t),r=new Go(n,new x.a.Sampler({C3:n},{curve:"linear"}),e,t);return r.sampler.connect(this.gainNode),this.slices.push(r),this.sliceData.push({startTime:e,endTime:t}),this.slice(this.slices.length-1,e,t,!0),this.slices[this.slices.length-1]}}},{key:"getStartTime",value:function(e){return this.slices[e].startTime}},{key:"getEndTime",value:function(e){return null==this.slices[e].endTime&&(this.slices[e].endTime=this.slices[0].buffer._buffer.duration),this.slices[e].endTime}},{key:"getNumberOfSlices",value:function(){return this.slices.length}},{key:"dispose",value:function(){this.audioBuffer=void 0,this.baseBuffer.dispose(),this.slices.forEach(function(e){return e.dispose()}),this.gainNode.dispose(),this.pitchEnvelopes.forEach(function(e){return e.dispose()}),this.baseBuffer=void 0,this.slices=void 0,this.gainNode=void 0,this.pitchEnvelopes=void 0}},{key:"get",value:function(e){return this.slices[e%this.slices.length].sampler}},{key:"getSlice",value:function(e){return this.slices[e%this.slices.length]}},{key:"isLoaded",value:function(){return this.slices.length>0&&this.slices[0].sampler.loaded}},{key:"triggerWaveformAnimation",value:function(e,t,n,r,a){}},{key:"triggerReleaseWaveformAnimation",value:function(e){this.showWaveformAnimation()}},{key:"showWaveformAnimation",value:function(){return!0}},{key:"isMixViewShown",value:function(){var e=this.track.subSequence.id;return this.track.sequencerEngine.currentSubSequence.id===e&&"MIX_VIEW"===this.state.sequencer.viewMode}},{key:"isWaveformShown",value:function(){return!!this.showingPrettyWaveform||this.track.subSequence.id===this.track.sequencerEngine.currentSubSequence.id&&"SOUND_DETAILS_VIEW"===this.state.sequencer.viewMode&&this.track.sequencerEngine.cursor.track===this.track.trackNumber}},{key:"getCopy",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.track,r={volume:this.volume,offset:this.offset,transpose:this.transpose,reversed:this.isReversed()},a=new e(n,this.sample,t,this.sliceData,r);return a.init(),a}},{key:"isDisposed",value:function(){return void 0===this.audioBuffer}},{key:"transpose",get:function(){return this.transposeParameter.get()},set:function(e){this.transposeParameter.set(e)}},{key:"volume",get:function(){return this.volumeParameter.get()},set:function(e){this.volumeParameter.set(e)}},{key:"state",get:function(){return this.store.getState()}}],[{key:"getDefaultTriggerConfig",value:function(e){return void 0===e.gated&&(e.gated=!0),void 0===e.sliceNumber&&(e.sliceNumber=0),void 0===e.skipRelease&&(e.skipRelease=!1),e}}]),e}(),Go=function(){function e(t,n,r,a){Object(o.a)(this,e),this.buffer=t,this.originalBuffer=t.get(),this.sampler=n,this.startTime=void 0==r?0:r,this.endTime=a,this.slice=void 0}return Object(c.a)(e,[{key:"getDuration",value:function(){return this.endTime-this.startTime}},{key:"dispose",value:function(){this.buffer.dispose(),this.sampler.dispose(),this.originalBuffer=void 0,this.buffer=void 0,this.sampler=void 0,this.startTime=void 0,this.endTime=void 0}},{key:"getJson",value:function(){return{startTime:this.startTime,endTime:this.endTime}}},{key:"getCopy",value:function(){return new e(this.buffer,this.sampler,this.startTime,this.endTime)}}]),e}(),zo=_o;var Wo="DOWN",Ko=function(){function e(){Object(o.a)(this,e),this.enabled=!1,this.noteToDuration={},this.notes=[],this.index=0,this.currentOctave=0,this.arpRate=new Xe(8,!1),this.arpDirection=Wo}return Object(c.a)(e,[{key:"clear",value:function(){this.notesToDuration={},this.notes=[],this.index=0,this.currentOctave=0}},{key:"setEnabled",value:function(e){this.enabled=e}},{key:"toggleEnabled",value:function(){this.enabled=!this.enabled}},{key:"addNote",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;void 0!==t&&(e in this.noteToDuration?this.noteToDuration[e]=this.noteToDuration[e]+2*t:this.noteToDuration[e]=2*t),this.notes.indexOf(e)<0&&(this.notes.push(e),this.notes=this.notes.sort(),this.arpDirection===Wo&&this.notes.reverse(),this.index=this.notes.indexOf(e))}},{key:"removeNote",value:function(e){var t=this.notes.indexOf(e);t>-1&&this.notes.splice(t,1),this.index>=this.notes.length&&(this.index=0,this.currentOctave=0)}},{key:"nextNote",value:function(e){if(0!=this.notes.length){var t=this.notes[this.index];return this.index=(this.index+1)%this.notes.length,0==this.index&&e>0&&("UP"===this.arpDirection?this.currentOctave=(this.currentOctave+1)%(e+1):this.arpDirection===Wo&&(this.currentOctave=(this.currentOctave-1)%(e+1))),t+12*this.currentOctave}}},{key:"getNextTriggers",value:function(e,t){var n=this,r=Da(t,e.arpRate).map(function(t){return{transpose:n.nextNote(e.arpOctaves),time:t.time,step:t.step}}).filter(function(e){return void 0!==e.transpose});for(var a in this.noteToDuration)this.noteToDuration[a]-=1,this.noteToDuration[a]<=0&&(delete this.noteToDuration[a],this.removeNote(parseInt(a)));return r}}]),e}(),Qo=function(){function e(t,n){Object(o.a)(this,e),this.envelope=t,this.mode=n}return Object(c.a)(e,[{key:"equals",value:function(e){return this.envelope===e.envelope&&this.mode===e.mode}},{key:"getJson",value:function(){return{envelope:this.envelope.number-1,mode:this.mode}}}]),e}(),Xo=d.a.presets,Yo=new Xe(32,!1),Zo=new Xe(16,!1),$o={Track:function(){function e(t,n,r,a,i,s){var c=this;Object(o.a)(this,e),this.subSequence=s,this.id=Object(A.uuid)(),this.trackNumber=t,this.gated=!0,this.sequencerEngine=n,this.store=n.store,this.parameters=[],this.update=i,this.gainNode=new x.a.PanVol,this.volumeNode=new x.a.Volume,this.muteableNode=new x.a.Volume,this.trackNode=new x.a.Solo,this.volumeParameter=new Fn("volume",this.volumeNode.volume,{defaultValue:0,min:-100,max:0}),this.registerParameter(this.volumeParameter),this.trackMeter=new x.a.Meter(.9),this.faderNode=new x.a.Gain,this.trackNode.connect(this.volumeNode),this.volumeNode.connect(this.faderNode),this.faderNode.connect(this.muteableNode),this.muteableNode.connect(this.trackMeter),this.muted=!1,this.sendNodes=[],this.sendNodeVolumeParameters=[],this.patternNumberLocked=void 0,this.pattern=new Do(this.sequencerEngine,this),this.patterns=[this.pattern];for(var u=1;u<a;u++)this.patterns.push(new Do(this.sequencerEngine,this));this.currentPattern=this.getInitialPattern(),this.soundIds=[],this.auditionedSounds=[],this.toAudition=[],this.trackData=new Ge(this.sequencerEngine,this.mix,(new Wr).forTrack(this)),this.trackData.loadDefaults(),this.on=!1,this.samplers={},this.group=null,this.selectedStep=void 0,this.name=void 0,this.videoId="",this.sample=void 0,this.arpManager=new Ko,this.resampler=void 0,this.masterResampler=new Wi(this.sequencerEngine,this.volumeNode),this.effectsChains=[new wa(this.gainNode,this.trackNode,(new Wr).forTrack(this),this.sequencerEngine)],this.effectsChains[0].initDefault(),this.midiEffects=new Ci(this),this.liveEffects=new Ji(this),this.midiInputs=new as,this.samples=[],this.connectedEnvelopes=[],this.frozenSamplesToSave=[],this.chokes=new Ki(this),this.outputTypeConfigured=Qi,this.outputTypeParameter=new Be("outputType",this,function(e,t){return c.changeOutputType(t)},{defaultValue:Qi}),this.registerParameter(this.outputTypeParameter)}return Object(c.a)(e,[{key:"changeOutputType",value:function(e){this.outputTypeConfigured!==e&&(this.outputTypeConfigured=e,"SENDS_ONLY"===e?(this.muteableNode.disconnect(),this.reconnectAll()):this.addToGroup(this.group))}},{key:"registerParameter",value:function(e){this.parameters.push(e),e.setStore(this.store),e.setContext((new Wr).forTrack(this))}},{key:"newEffectsChain",value:function(){var e=new wa(this.gainNode,this.trackNode,(new Wr).forTrack(this),this.sequencerEngine);e.initDefault(),this.effectsChains.push(e),this.store.dispatch(Object(O.jb)(this.subSequence.id,this.trackNumber,this.effectsChains.length-1))}},{key:"deleteEffectsChain",value:function(){var e=this.effectsChains[this.chainNumber];void 0!==e&&(e.dispose(),this.effectsChains.splice(this.chainNumber,1),this.store.dispatch(Object(O.jb)(this.subSequence.id,this.trackNumber,this.effectsChains.length-1)))}},{key:"getEffects",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.chainNumber;return this.effectsChains[e].effects}},{key:"connectToEnvelope",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"POST_FX";for(var n in this.sequencerEngine.tracks){var r=this.sequencerEngine.tracks[n];r.isConnectedToEnvelope(e)&&r.disconnectFromEnvelope(e)}this.connectedEnvelopes.push(new Qo(e,t))}},{key:"disconnectFromEnvelope",value:function(e){for(var t=0;t<this.connectedEnvelopes.length;t++)if(this.connectedEnvelopes[t].envelope===e)return void this.connectedEnvelopes.splice(t,1)}},{key:"getEnvelopeMode",value:function(e){return this.connectedEnvelopes.filter(function(t){return t.envelope===e}).map(function(e){return e.mode})[0]}},{key:"setEnvelopeMode",value:function(e,t){return this.connectedEnvelopes.filter(function(t){return t.envelope===e}).forEach(function(e){return e.mode=t})}},{key:"isConnectedToEnvelope",value:function(e){return this.connectedEnvelopes.some(function(t){return t.envelope===e})}},{key:"start",value:function(){if(this.effectsChains.forEach(function(e){return e.start()}),this.midiEffects.clear(),this.liveEffects.clear(),this.getTrackType()===zr.b){var e=this.getInstrument();e.hasLFO()&&(e.stop(),e.start())}this.patterns.forEach(function(e){return e.isRecording=!1}),this.scheduleTrackPatternChangeIfAny()}},{key:"linearRampFade",value:function(e,t,n){this.faderNode.gain.linearRampTo(e,.001,x.a.Master.context.currentTime+.001),this.faderNode.gain.linearRampTo(t,n,x.a.Master.context.currentTime+.003)}},{key:"deletePatternLocks",value:function(){this.getAllPatternLockedParameters().forEach(function(e){return e.deleteLocks()}),this.store.dispatch(Object(O.Pd)(this.subSequence.id,this.trackNumber,{}))}},{key:"togglePatternLock",value:function(){this.store.dispatch(Object(O.Od)(this.subSequence.id,this.trackNumber,this.currentPattern,!this.patternLocked)),this.getAllPatternLockedParameters().forEach(function(e){return e.updateRedux()})}},{key:"getName",value:function(e){return void 0!==e?this.samples[e].name:void 0===this.sample?"":this.sample.name}},{key:"isRecordable",value:function(){return!1}},{key:"setSequencerEngine",value:function(e){this.sequencerEngine=e}},{key:"triggerMidiNoteOn",value:function(e,t){this.triggerSample(0,!1,this.resolution.getTimeInStep(),e+this.trackData.transpose,!0)}},{key:"triggerMidiNoteOff",value:function(e){}},{key:"initPatternBuffer",value:function(e){var t=this.pattern.stepBuckets.length;this.patternRollStepNumber=e%t}},{key:"updatePatternRollStepNumber",value:function(e){if(void 0!==this.patternRollStepNumber){var t=e.getNumberOfStepsAtBaseResolution();this.patternRollStepNumber-=this.patternRollStepNumber%t}}},{key:"getFactoredResolution",value:function(){var e=this.sequencerEngine.rollingResolution,t=this.liveEffects.getEffect(Di);return t&&((e=e.getCopy()).resolution*=t.rollFactor),e}},{key:"solo",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.trackNode.solo=e,t&&this.store.dispatch(Object(O.Sd)(this.trackNumber,e))}},{key:"getSolo",value:function(){return this.trackNode.solo}},{key:"dispose",value:function(){var e=this.getAllParameters(),t=e.filter(function(e){return e.automations&&e.automations.length>0});this.sequencerEngine.store.dispatch(Object(O.b)(t)),this.trackNode.disconnect(this.volumeNode),this.muteableNode.disconnect(this.trackMeter),this.gainNode.dispose(),this.trackNode.dispose(),this.muteableNode.dispose(),this.trackMeter.dispose(),this.faderNode.dispose(),this.sendNodes.forEach(function(e){return e.dispose()}),this.effectsChains.forEach(function(e){return e.dispose()}),this.getSamplers().filter(function(e){return void 0!==e}).forEach(function(e){return e.dispose()}),this.faderNode=void 0,this.gainNode=void 0,this.muteableNode=void 0,this.trackNode=void 0,this.trackMeter=void 0,this.sendNodes=void 0,this.pattern=void 0,this.patterns=void 0,this.soundIds=void 0,this.auditionedSounds=void 0,this.trackData=void 0,this.samplerConnectedToMaster=!1,this.samplers=void 0,this.group=null,this.selectedStep=void 0,this.name=void 0,this.videoId=void 0,this.sample&&this.sample.dispose(!0),this.sample=void 0,this.arpManager=void 0,this.presetId=void 0,this.samplesStream&&(this.samplesStream.dispose(),this.samplesStream=void 0),e.forEach(function(e){return e.dispose()})}},{key:"getTrackType",value:function(){return zr.e}},{key:"addToGroup",value:function(e){this.outputTypeParameter.get()===Qi&&this.muteableNode.connect(e.inputNode),this.group=e}},{key:"disconnectFromGroup",value:function(){this.muteableNode.disconnect(),this.reconnectAll(),this.group=void 0}},{key:"getLoadedSampleIfAny",value:function(e){return this.sequencerEngine.loadedSamples[e]}},{key:"addSound",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n,r){var a;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.store.dispatch(Object(O.Ld)(this.subSequence.id,this.trackNumber,!0)),"string"!==typeof t&&"number"!==typeof t){e.next=20;break}if(a=t,this.soundIds.push(a),void 0===this.getLoadedSampleIfAny(a)){e.next=9;break}t=this.getLoadedSampleIfAny(a),void 0===this.sample&&(this.sample=t),e.next=18;break;case 9:return t=new Dn.a(a),void 0===this.sample&&(this.sample=t),e.prev=11,e.next=14,t.load();case 14:e.next=18;break;case 16:e.prev=16,e.t0=e.catch(11);case 18:e.next=32;break;case 20:if(void 0===this.sample&&(this.sample=t),this.sample.isLoaded()){e.next=31;break}return e.prev=22,e.next=25,this.sample.load();case 25:e.next=31;break;case 27:return e.prev=27,e.t1=e.catch(22),console.log("error in track load"),e.abrupt("return");case 31:this.soundIds.push(t.getId());case 32:if(t.isLoaded()){e.next=34;break}return e.abrupt("return");case 34:this.samples.push(t),r=r||!1,this.loadTrackInfo(r,t,n),this.samplesStream=new Mn(t,this.sequencerEngine),this.store.dispatch(Object(O.Ld)(this.subSequence.id,this.trackNumber,!1));case 39:case"end":return e.stop()}},e,this,[[11,16],[22,27]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getSamplesStream",value:function(){return this.samplesStream}},{key:"auditionNext",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r,a,i,s=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]&&s[0],console.log("audition next called"),n=(new Date).getTime(),e.prev=3,!this.loadingAudition){e.next=6;break}return e.abrupt("return");case 6:if(r=this.getSamplesStream(),console.log("samplesStream =",r),r.hasNext()){e.next=11;break}return console.log("no next"),e.abrupt("return");case 11:return this.loadingAudition=!0,e.next=14,r.getNext();case 14:a=e.sent,this.loadingAudition=!1,this.useSound(a,t),i=(new Date).getTime(),i-n,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(3),this.loadingAudition=!1;case 24:case"end":return e.stop()}},e,this,[[3,21]])}));return function(){return e.apply(this,arguments)}}()},{key:"auditionPrevious",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r,a=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]&&a[0],e.prev=1,n=this.getSamplesStream(),!this.loadingAudition){e.next=5;break}return e.abrupt("return");case 5:if(n.hasPrevious()){e.next=7;break}return e.abrupt("return");case 7:return this.loadingAudition=!0,e.next=10,n.getPrevious();case 10:r=e.sent,this.loadingAudition=!1,this.useSound(r,t),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(1),this.loadingAudition=!1;case 18:case"end":return e.stop()}},e,this,[[1,15]])}));return function(){return e.apply(this,arguments)}}()},{key:"useSound",value:function(e,t){if(t)for(var n in this.samplers)this.samplers[n].dispose(),delete this.samplers[n];this.sample=e,this.soundIds=[e.getId()],this.toAudition.push(e.getId()),console.log("loadTrackInfo =",e.getId()),this.loadTrackInfo(!0,e)}},{key:"auditionSound",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r,a=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.length>1&&void 0!==a[1]&&a[1],r=a.length>2?a[2]:void 0,t.isLoaded()){e.next=5;break}return e.next=5,t.load();case 5:this.savedSoundIds=Object(M.a)(this.soundIds),this.soundIds=[t.getId()],this.toAudition.push(t.getId()),this.auditionedSounds.push(t.getId()),this.samplesStream&&n&&this.samplesStream.dispose(),this.samplesStream=r||new Mn(t,this.sequencerEngine),this.loadTrackInfo(!0,t);case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"isAuditioning",value:function(){return this.auditionedSounds.length>0}},{key:"completeAudition",value:function(){for(var e in this.auditionedSounds)if(-1==this.soundIds.indexOf(this.auditionedSounds[e])){var t=this.samplers[this.auditionedSounds[e]];t&&(t.dispose(),delete this.samplers[this.auditionedSounds[e]])}this.auditionedSounds=[],this.store.dispatch(Object(O.vc)(void 0))}},{key:"cancelAudition",value:function(){this.isAuditioning()&&(this.soundIds=this.savedSoundIds,this.revertAuditionedSounds()),this.store.dispatch(Object(O.vc)(void 0))}},{key:"revertAuditionedSounds",value:function(){for(var e in this.auditionedSounds){var t=this.samplers[this.auditionedSounds[e]];t&&(t.dispose(),delete this.samplers[this.auditionedSounds[e]])}this.auditionedSounds=[]}},{key:"loadTrackInfo",value:function(e,t,n){var r=this;void 0===n&&(n={slices:void 0,offset:0,transpose:0,volume:0}),e=e||!0;var a=this;this.store.dispatch(Object(O.uc)(t.getId(),t.getJson())),e?(this.videoId=t.videoId,this.sample=t,void 0===this.videoId&&"MIDI"!==this.getTrackType()&&(this.name=t.name),this.update()):(this.name=t.name,this.update());var i=n.slices;this.samplers[t.getId()]=new zo(this,t,function(e){return r.onNewSampler(a,e)},i,n),this.samplers[t.getId()].init(),t.addedToProject=!0}},{key:"updateEffects",value:function(e){void 0===e&&(e=this.effects),this.effectsChains[this.chainNumber].updateEffects(e)}},{key:"onNewSampler",value:function(e,t){for(var n in this.samplers)if(t===this.samplers[n]&&this.toAudition.indexOf(n)>-1&&this.isWarped()){var r=this.toAudition.indexOf(n);this.toAudition.splice(r,1),t.sliceFirstOnset();break}t.gainNode.connect(this.gainNode),e.switchToPattern(e.currentPattern),e.setVolume(e.getVolume(),!0),e.setPanning(e.getPanning())}},{key:"liveTrigger",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.triggerSample(t,e.transpose,!0,e.velocity),this.chokes.liveTrigger()}},{key:"releaseAll",value:function(e){this.getSamplers().filter(function(e){return void 0!==e}).filter(function(e){return e.isLoaded()}).map(function(t){return t.releaseAll(e)})}},{key:"liveTriggerRelease",value:function(e,t){this.gated&&(this.triggerRelease(e,t),this.chokes.liveRelease())}},{key:"trigger",value:function(e,t,n){var r=this;t=t||x.a.Master.context.currentTime,this.getSamplers().filter(function(e){return void 0!==e}).filter(function(e){return e.isLoaded()}).map(function(n){return n.trigger({gated:!!r.isWarped()||r.gated,stepData:e,time:t,sliceNumber:e.slice})})}},{key:"triggerFrozenSample",value:function(e,t){this.getSamplers().filter(function(e){return void 0!==e}).filter(function(e){return e.isLoaded()}).map(function(n){return n.trigger({gated:!1,stepData:e,time:t,sliceNumber:e.slice})})}},{key:"triggerSamples",value:function(e,t,n){var r=this;this.soundIds.filter(function(e){return r.isRecordingPlaying(e)}).map(function(e){return r.samplers[e]}).filter(function(e){return void 0!==e}).filter(function(e){return e.isLoaded()}).map(function(n){return n.trigger({gated:!1,stepData:e,time:t})})}},{key:"triggerSlice",value:function(e){var t=this.trackData.transpose;this.triggerSample(e,t)}},{key:"triggerSample",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;this.getSamplers().filter(function(e){return void 0!==e}).filter(function(e){return e.isLoaded()}).forEach(function(i){return i.trigger({gated:!!n.isWarped()||n.gated,sliceNumber:e,stepData:n.trackData,velocity:a,transpose:t,skipRelease:r})})}},{key:"triggerRelease",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.getSamplers().filter(function(e){return e.isLoaded()}).forEach(function(n){return n.release(t,e)})}},{key:"setSends",value:function(e){var t=this;this.sends=e,this.sends.getSends().map(function(e){return t.newSend(e)})}},{key:"setSendVolume",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.addEvent(new re(this,e,t),n),this.sendNodeVolumeParameters[e].set(t),this.store.dispatch(Object(O.Rd)(this.trackNumber,e,t))}},{key:"setupEffects",value:function(){var e=this.effectsChains[this.chainNumber];e&&e.setupEffects()}},{key:"newSend",value:function(e){var t=new x.a.Volume(-100);this.muteableNode.connect(t),e.connectToTrack(t),this.sendNodes.push(t);var n=new Fn("send volume",t.volume,{defaultValue:-100,min:-100,max:0});this.registerParameter(n),this.sendNodeVolumeParameters.push(n)}},{key:"reconnectAll",value:function(){var e=this;this.sendNodes.forEach(function(t){return e.muteableNode.connect(t)}),this.muteableNode.connect(this.trackMeter)}},{key:"toggleEnabled",value:function(){this.setIsEnabled(!this.isEnabled)}},{key:"setIsEnabled",value:function(e){this.isEnabled=e,this.isEnabled&&this.store.dispatch(Object(O.ce)(!1)),this.store.dispatch(Object(O.Kd)(this.subSequence.id,this.trackNumber,this.isEnabled))}},{key:"getSendNodes",value:function(){return this.sendNodes}},{key:"getSampler",value:function(e){return e=e||0,this.samplers[this.soundIds[e]]}},{key:"getSamplers",value:function(){var e=this;return this.soundIds.map(function(t){return e.samplers[t]})}},{key:"deleteSound",value:function(e){var t=this.soundIds.indexOf(e);t>-1&&(this.soundIds.splice(t,1),delete this.samplers[e],this.soundId=this.soundIds[0])}},{key:"getVolume",value:function(){return this.pattern.volume}},{key:"getMuted",value:function(){return this.pattern.isMuted}},{key:"newPattern",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r=this;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((new Date).getTime(),!(t=void 0!==t&&t)){e.next=14;break}return e.next=5,this.pattern.getCopy();case 5:n=e.sent,this.patterns.push(n),(new Date).getTime(),this.patterns.length-1,this.getAllPatternLockedParameters().forEach(function(e){return e.newPattern(r.currentPattern,r.patterns.length-1)}),this.store.dispatch(Object(O.Od)(this.subSequence.id,this.trackNumber,this.patterns.length-1,this.patternLocked)),e.next=15;break;case 14:this.patterns.push(new Do.Pattern(this.sequencerEngine,this));case 15:(new Date).getTime();case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"switchToPattern",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e>=0&&e<this.patterns.length){var t=this.patterns[e],n=t.volume,r=t.muted;this.pattern=t,this.currentPattern=e,this.setVolume(n,!0),this.mute(r,!0);(new Date).getTime();var a=this.getAllPatternLockedParameters(),i={};for(var s in a){var o=a[s].updateRedux(!0);void 0!==o&&(i[o.id]=o.value)}this.store.dispatch(Object(O.hb)(i));(new Date).getTime();return this.setPanning(this.pattern.panning),i}return{}}},{key:"getAllParameters",value:function(){var e=[].concat(Object(M.a)(this.trackData.parameters),Object(M.a)(this.parameters),[this.outputTypeParameter]);for(var t in this.effectsChains)e=[].concat(Object(M.a)(e),Object(M.a)(this.effectsChains[t].getAllParameters()));return e=[].concat(Object(M.a)(e),Object(M.a)(this.midiEffects.getAllParameters()),Object(M.a)(this.liveEffects.getAllParameters()))}},{key:"getAllPatternLockedParameters",value:function(){return this.getAllParameters().filter(function(e){return e.hasPatternLockedValues()})}},{key:"deletePattern",value:function(e){if(this.patterns.splice(e,1),this.getAllPatternLockedParameters().forEach(function(t){return t.deletePattern(e)}),void 0!==this.store.getState().tracks.trackPatternLocks[this.subSequence.id]){var t=Object(D.a)({},this.store.getState().tracks.trackPatternLocks[this.subSequence.id][this.trackNumber]);this.store.dispatch(Object(O.Pd)(this.subSequence.id,this.trackNumber,Le(e,t)))}}},{key:"movePatternTo",value:function(e,t){if(e!=t){var n=[];e>t?(n=this.patterns.slice(0,t).concat([this.patterns[e]]).concat(this.patterns.slice(t,e)),this.patterns.length>e+1&&(n=n.concat(this.patterns.slice(e+1)))):(n=this.patterns.slice(0,e).concat(this.patterns.slice(e+1,t)).concat([this.patterns[t],this.patterns[e]]),this.patterns.length>t+1&&(n=n.concat(this.patterns.slice(t+1)))),this.patterns=n,this.getAllPatternLockedParameters().forEach(function(n){return n.movePatternTo(e,t)});var r=Object(D.a)({},this.store.getState().tracks.trackPatternLocks[this.subSequence.id][this.trackNumber]);this.store.dispatch(Object(O.Pd)(this.subSequence.id,this.trackNumber,Ie(e,t,r)))}}},{key:"getStepAtResolution",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.resolution,n=this.getStepsAtResolution(t);return n[Math.floor(e)%n.length]}},{key:"getStepsAtResolution",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yo;return this.pattern.getStepsAtResolution(e).slice(0,this.pattern.length(e))}},{key:"getBucketsAtResolution",value:function(e){return this.pattern.getBucketsAtResolution(e)}},{key:"getFillsAtResolution",value:function(e){return this.pattern.getFillsAtResolution(e)}},{key:"getStepDataForStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.getCopy(!1,!1,!0,!0,t),r=n.getPolyphony();for(var a in r){var i=r[a];i.duration=null==i.durationParameter.value?this.trackData.duration:i.duration,i.transpose=null==i.transposeParameter.value?this.trackData.transpose:i.transpose,i.velocity=null==i.velocityParameter.value?this.trackData.velocity:i.velocity,i.start=null==i.startParameter.value?this.trackData.start:i.start,i.chop=null==i.chopParameter.value?this.trackData.chop:i.chop,i.chopDuration=null==i.chopDurationParameter.value?this.trackData.chopDuration:i.chopDuration,i.attack=null==i.attackParameter.value?this.trackData.attack:i.attack,i.release=null==i.releaseParameter.value?this.trackData.release:i.release,i.slice=null==i.sliceParameter.value?this.trackData.slice:i.slice,i.panning=i.panningParameter.value,i.pitchAttack=null==i.pitchAttackParameter.value?this.trackData.pitchAttack:i.pitchAttack,i.pitchDecay=null==i.pitchDecayParameter.value?this.trackData.pitchDecay:i.pitchDecay,i.pitchSustain=null==i.pitchSustainParameter.value?this.trackData.pitchSustain:i.pitchSustain,i.pitchRelease=null==i.pitchReleaseParameter.value?this.trackData.pitchRelease:i.pitchRelease,i.monophonic=null==i.monophonicParameter.value?this.trackData.monophonic:i.monophonic,i.reverse=null==i.reverse?this.trackData.reverse:i.reverse,i.effectAutomations=i.effectAutomations}return n}},{key:"getMainSoundId",value:function(){return this.soundIds[0]}},{key:"calculateFills",value:function(){this.pattern.calculateFills(this.trackData)}},{key:"updateStepDuration",value:function(e,t,n){n=n||Yo;var r=this.getBucketsAtResolution(n);for(var a in r[e].steps){var i=r[e].getStep(a);i.on&&(i.duration=t)}this.pattern.calculateFills(this.trackData),this.updateSteps()}},{key:"doubleTrackLength",value:function(){this.pattern.doubleTrackLength(),this.pattern.calculateFills(this.trackData),this.updateSteps(!0)}},{key:"halfTrackLength",value:function(){this.pattern.halfTrackLength(),this.pattern.calculateFills(this.trackData),this.updateSteps(!0)}},{key:"getJson",value:function(){for(var e={},t=0;t<this.soundIds.length;t++){var n=this.samplers[this.soundIds[t]];n&&(e[this.soundIds[t]]=n.getJson())}var r=this.store.getState().tracks.trackPatternLocks[this.trackNumber]||{},a=[];for(var i in this.sendNodeVolumeParameters){var s=this.sendNodeVolumeParameters[i],o={volume:s.get()};o=sr(o,"volumeParameter",s),a.push(o)}var c=sr({},"outputTypeParameter",this.outputTypeParameter);return Object(D.a)({},c,{outputType:this.outputTypeParameter.get(),annotations:this.annotations.map(function(e){return e.getJson()}),isMuted:this.pattern.isMuted,sends:a,isNewVolume:!0,volume:this.pattern.volume,samplers:e,gated:this.gated,type:this.getTrackType(),patternLocks:r,envelopeConnections:this.connectedEnvelopes.map(function(e){return e.getJson()}),isFrozen:this.isFrozen,isFrozenPlaying:this.isFrozenPlaying,frozenJson:this.frozenJson,chokes:this.chokes.getJson(),rawVolume:this.volumeNode.volume.value})}},{key:"setPanning",value:function(e,t){void 0!==t?this.gainNode.pan.linearRampToValueAtTime(e,Math.max(0,t)):this.gainNode.pan.value=e,this.pattern.panning=e,this.store.dispatch(Object(O.Nd)(this.trackNumber,e))}},{key:"getPanning",value:function(){return this.pattern.panning}},{key:"setVolume",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.addEvent(new Q(this,e),t),this.pattern.volume=e,e>6&&(e=Yi(e,0,128)),this.volumeParameter.set(e),this.store.dispatch(Object(O.Vd)(this.trackNumber,e))}},{key:"setRawVolume",value:function(e){this.volumeParameter.set(e),this.pattern.volume=e+15}},{key:"mute",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=void 0===e||e,this.addEvent(new $(this,e),t),this.muted=e,this.muteableNode.mute=e,this.pattern.muted=e,this.store.dispatch(Object(O.Md)(this.trackNumber,e))}},{key:"moveEffectTo",value:function(e,t){this.effectsChains[this.chainNumber].moveEffectTo(e,t)}},{key:"moveMidiEffectTo",value:function(e,t){this.midiEffects.moveEffectTo(e,t)}},{key:"onBPMUpdated",value:function(){this.effectsChains.forEach(function(e){return e.onBPMUpdated()})}},{key:"getEffectNumber",value:function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.midiEffects.getEffectNumber(e):this.effectsChains[this.chainNumber].getEffectNumber(e)}},{key:"deleteEffect",value:function(e){this.effectsChains[this.chainNumber].deleteEffect(e)}},{key:"numberOfSlices",value:function(){var e=0;for(var t in this.samplers)this.samplers[t].slices.length>e&&(e=this.samplers[t].slices.length);return e}},{key:"isLoaded",value:function(){return this.soundIds.length>0&&void 0!==this.getSampler(0)&&this.getSampler(0).isLoaded()}},{key:"updateStepData",value:function(e,t,n){var r=Yo.transformStepAtResolution(t,n),a=Math.floor(r),i=this.pattern.stepBuckets[a];for(var s in i.steps){if(i.getStep(s).on){i.setStep(s,e,!0),this.pattern.syncBuckets();break}}this.updateSteps()}},{key:"stepSelected",value:function(e){this.selectedStep=e}},{key:"stepUnselected",value:function(e){this.selectedStep=void 0}},{key:"isReversed",value:function(){return this.getSamplers().filter(function(e){return void 0!==e}).some(function(e){return e.isReversed()})}},{key:"reverse",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.getSamplers().forEach(function(t){return t.reverse(e)})}},{key:"addEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.store.getState();!t&&this.isRecordingAutomations()&&this.mix.addEvent(e)}},{key:"isRecordingAutomations",value:function(){return"RECORD"===this.state.sequencer.automationMode&&this.state.sequencer.isRecording||this.state.mix.isRecordingMix}},{key:"setKeyboardEngine",value:function(e){this.keyboardEngine=e}},{key:"updateSteps",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.multiSequencerEngine)if(this.instrumentRack)this.instrumentRack.updateSteps(e,t);else{t||(this.store.dispatch(Object(O.Vd)(this.trackNumber,this.pattern.volume)),this.store.dispatch(Object(O.Nd)(this.trackNumber,this.pattern.panning)),this.store.dispatch(Object(O.Md)(this.trackNumber,this.muted)),this.store.dispatch(Object(O.Kd)(this.subSequence.id,this.trackNumber,this.isEnabled)));var n=this.pattern.getUpdateStepsAction(e),r=void 0;if(this.subSequence.isTrack)for(var a in r={},this.patterns)r[a]=this.patterns[a].getTrackStepsAction();this.store.dispatch(Object(O.t)(n.trackNumber,n.steps,n.pianoRollSteps,n.trackFills,n.stepToId,n.pianoRollPositions,n.pianoRollDurations,r))}}},{key:"getUpdateStepsAction",value:function(){return this.pattern.getUpdateStepsAction()}},{key:"getEasyPattern",value:function(){return new os(this.pattern,this.trackData)}},{key:"deleteMidiInput",value:function(e){this.midiInputs.deleteMidiInput(e)}},{key:"addMidiInput",value:function(e){this.midiInputs.addMidiInput(e)}},{key:"getInstrumentType",value:function(){return zr.e}},{key:"clearEffectsAndSamplers",value:function(){this.effectsChains.forEach(function(e){return e.dispose()}),this.midiEffects.effects=[],this.liveEffects.effects=[],this.samplers={};var e=this.getSamplers();this.soundIds=[],e.filter(function(e){return void 0!==e}).forEach(function(e){return e.dispose()}),this.trackData=new Ge(this.sequencerEngine,this.mix,(new Wr).forTrack(this)),this.trackData.loadDefaults()}},{key:"freeze",value:function(e){var t=this.sample;t&&(e.name=t.name,e.tags=e.tags.concat(t.tags),e.videoId=t.videoId,e.sourceSample=t,this.frozenSamplesToSave=[e]),this.frozenJson=this.sequencerEngine.getTrackPreset(this.trackNumber),this.store.dispatch(Object(O.Jd)(this.subSequence.id,this.trackNumber,!0)),this.clearEffectsAndSamplers(),this.effectsChains=[new wa(this.gainNode,this.trackNode,(new Wr).forTrack(this),this.sequencerEngine)],this.effectsChains[0].initDefault(),this.loadTrackInfo(!1,e),this.soundIds=[e.getId()],this.isFrozenPlaying=!0}},{key:"unfreezeInstrument",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.frozenJson;this.sequencerEngine.loadSamplersIntoTrack(this,e.trackParameters,this.sequencerEngine.tracks.length,this.sequencerEngine.currentSubSequence)}},{key:"unfreeze",value:function(){var e=Object(R.a)(N.a.mark(function e(){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.clearEffectsAndSamplers(),this.store.dispatch(Object(O.Jd)(this.subSequence.id,this.trackNumber,!1)),this.unfreezeInstrument(),this.trackData=new Ge(this.sequencerEngine,this.mix,(new Wr).forTrack(this)),this.trackData.loadDefaults(),this.trackData.loadFromJson(this.frozenJson.trackData,void 0,!1,!1,this.sequencerEngine),e.next=8,this.sequencerEngine.loadEffectsPreset(this.frozenJson,!1,this);case 8:this.effectsChains.forEach(function(e){return e.effects.forEach(function(e){return e.parameters.forEach(function(e){e.set(e.get())})})});case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fromJson",value:function(e){if(void 0!==e.isFrozen&&(this.isFrozen=e.isFrozen),e.outputType&&this.outputTypeParameter.set(e.outputType),or(e,"outputTypeParameter",this.outputTypeParameter),void 0!==e.isFrozenPlaying&&(this.isFrozenPlaying=e.isFrozenPlaying),this.frozenJson=e.frozenJson,this.currentPattern=this.getInitialPattern(),e.sends)for(var t in e.sends)this.sendNodeVolumeParameters[t]&&(this.sendNodeVolumeParameters[t].set(e.sends[t].volume),or(e.sends[t],"volumeParameter",this.sendNodeVolumeParameters[t]))}},{key:"warp",value:function(){var e=this.midiEffects.effects.filter(function(e){return"Warp"===e.name})[0];e?this.operationManager.dispatch(vt(e,this)):this.operationManager.dispatch(mt(new mi(this),this)),this.getSamplers()[0]&&this.getSamplers()[0].sliceFirstOnset()}},{key:"isWarped",value:function(){return this.midiEffects.effects.filter(function(e){return"Warp"===e.name}).filter(function(e){return e.enabled}).length>0}},{key:"mateWithPreset",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r,a,i,s,o,c=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:.5,r=c.length>2?c[2]:void 0,e.next=4,Xo.getPresetData(t.contentHash);case 4:for(i in(a=e.sent).lfos)this.sequencerEngine.lfos[i].lfo.mateJson(a.lfos[i],n);if(this.instrument.mateJson(a.trackParameters.instrument,n),!r){e.next=14;break}return e.next=10,this.sequencerEngine.getEffectsPreset(a,this);case 10:for(s=e.sent,this.effectsChains[0].mate(s.effectsChains[0],n),o=1;o<s.effectsChains.length;o++)s.effectsChains[o].dispose();s.midiEffects&&this.midiEffects.mate(s.midiEffects,n);case 14:return this.sequencerEngine.update(),e.abrupt("return");case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"extractStems",value:function(){var e=this;return new Promise(function(t){var n=e.sample.audioBuffer,r=[n.getChannelData(0),n.getChannelData(1)];new zi.a(2).exportToWAV(r,function(){var n=Object(R.a)(N.a.mark(function n(r){var a;return N.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Gt.a.addBytesArray(r);case 2:a=n.sent,fetch("/splitStems/"+a,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(){var n=Object(R.a)(N.a.mark(function n(r){var a,i,s,o,c;return N.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a=r.drums?e.sample.getCopyWith(r.drums,"drums"):void 0,i=r.vocals?e.sample.getCopyWith(r.vocals,"vocals"):void 0,s=r.bass?e.sample.getCopyWith(r.bass,"bass"):void 0,o=r.other?e.sample.getCopyWith(r.other,"other"):void 0,c=[a,i,s,o].filter(function(e){return void 0!==e}).map(function(e){return e.fetchAudio()}),n.next=7,Promise.all(c);case 7:a&&(e.sequencerEngine.addSound(a),e.sequencerEngine.addSampleToSync(a)),i&&(e.sequencerEngine.addSound(i),e.sequencerEngine.addSampleToSync(i)),s&&(e.sequencerEngine.addSound(s),e.sequencerEngine.addSampleToSync(s)),o&&(e.sequencerEngine.addSound(o),e.sequencerEngine.addSampleToSync(o)),t();case 12:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}());case 4:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}())})}},{key:"extractGroove",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r,a,i,s,o,c,u,l,p,h;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getSamplers()[0],n=t.onsets,r=t.tempo,a=t.slices[0].startTime,n=n.filter(function(e){return e/1e3>=a}),i=$i(n,r,this.sequencerEngine.bpm),"QmRHeFU644J9LFZoPzd93M4WqF8tyhydDYL2EZWS6dmbF8",e.next=9,this.sequencerEngine.addSound("QmRHeFU644J9LFZoPzd93M4WqF8tyhydDYL2EZWS6dmbF8");case 9:for(c in s=e.sent,o=s.getEasyPattern(),i.steps.forEach(function(e){return o.addStep(s.getNewStep(),e.stepNumber,Yo,e.offset,!1,!0)}),i.timings)u=i.timings[c].resolution,l=i.timings[c].odd,p=i.timings[c].even,(h=new _a(s)).oddOffset=l,h.evenOffset=p,h.resolution=32/u,s.midiEffects.addEffect(h);o.update(!1),s.updateSteps();case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getNewStep",value:function(){var e=new Ge(this.sequencerEngine,void 0,void 0,this);return e.on=!0,e}},{key:"showEffects",value:function(e){this.store.dispatch(Object(O.jd)(this.trackNumber,e))}},{key:"isEffectsShowing",value:function(){return this.state.tracks.showTrackEffects[this.trackNumber]}},{key:"restart",value:function(){}},{key:"onStepEnded",value:function(){}},{key:"onNewStep",value:function(e){this.midiEffects.onNewStep()}},{key:"getInitialPattern",value:function(){if(!this.subSequence.isTrack)return 0}},{key:"scheduleTrackPatternChangeIfAny",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine.trackStep;arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.subSequence.isTrack&&!this.patterns.some(function(e){return e.isRecording})){for(var t in this.patterns){t=parseInt(t);var n=this.patterns[t],r=n.startStep;if(void 0!==r&&(e>=r&&e<r+n.length()))return void(t!==this.currentPattern&&this.switchToPattern(t))}this.currentPattern=void 0,this.pattern=this.patterns[0]}}},{key:"getGuildIds",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.sample){e.next=2;break}return e.abrupt("return",[0]);case 2:return e.next=4,d.a.guildSamples.getGuildIdForSound(this.sample.getId());case 4:return t=e.sent,e.abrupt("return",void 0===t?[0]:[t]);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"makePublicIfNeeded",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getGuildIds();case 2:if(0===e.sent[0]||!this.sample){e.next=8;break}return e.next=6,d.a.guildSamples.saveSample(this.sample);case 6:t=e.sent,this.replaceSoundId(this.sample.getId(),t);case 8:e.t0=N.a.keys(this.effectsChains);case 9:if((e.t1=e.t0()).done){e.next=15;break}return n=e.t1.value,e.next=13,this.effectsChains[n].makePublicIfNeeded();case 13:e.next=9;break;case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"replaceSoundId",value:function(e,t){var n=this.soundIds.indexOf(e);if(-1!==n){this.soundIds[n]=t;var r=this.samplers[this.sample.getId()];this.samplers[t]=r,this.sample.ipfsHash=t,delete this.samplers[e]}}},{key:"deleteAtStep",value:function(e){this.pattern.deleteStepNumber(e)}},{key:"rolling",get:function(){var e=this.liveEffects.getEffect(Di);if(!e)return this.sequencerEngine.rolling;switch(e.mode){case Ii:return!0;case Mi:return!1;default:return this.sequencerEngine.rolling}}},{key:"patternLocked",get:function(){var e=this.store.getState().tracks.trackPatternLocks[this.subSequence.id];return void 0!==e&&((e[this.trackNumber]||{})[this.currentPattern]||!1)}},{key:"fade",set:function(e){var t=function(e){return Math.exp(1-1/Math.pow(e,1.01))}(e);this.faderNode.gain.setValueAtTime(t,1e-4)}},{key:"patternLocks",set:function(e){for(var t in e)this.store.dispatch(Object(O.Od)(this.subSequence.id,this.trackNumber,t,e[t]));this.getAllPatternLockedParameters().forEach(function(e){return e.updateRedux()})}},{key:"resolution",get:function(){return this.sequencerEngine.resolution}},{key:"mix",get:function(){return this.state.sequencer.isRecording&&"RECORD"===this.state.sequencer.automationMode?this.pattern.mix:this.subSequence.mix}},{key:"chainNumber",get:function(){return(this.store.getState().effects.effectsChainToShow[this.subSequence.id]||{})[this.trackNumber]||0}},{key:"effectsChain",get:function(){return this.effectsChains[this.chainNumber]}},{key:"effects",get:function(){return void 0===this.effectsChains[this.chainNumber]?[]:this.effectsChains[this.chainNumber].effects}},{key:"length",get:function(){return this.pattern.length()}},{key:"state",get:function(){return this.store.getState()}},{key:"isFrozen",get:function(){return(this.store.getState().tracks.tracksFrozen[this.subSequence.id]||{})[this.trackNumber]},set:function(e){this.store.dispatch(Object(O.Jd)(this.subSequence.id,this.trackNumber,e))}},{key:"isFrozenPlaying",get:function(){return(this.store.getState().tracks.frozenTracksPlaying[this.subSequence.id]||{})[this.trackNumber]},set:function(e){this.store.dispatch(Object(O.nb)(this.subSequence.id,this.trackNumber,e))}},{key:"tempo",get:function(){return void 0===this.getSamplers()[0]?void 0:this.getSamplers()[0].tempo}},{key:"operationManager",get:function(){return this.sequencerEngine.operationManager}}]),e}(),baseResolution:Yo,oldDefaultResolution:Zo};function ec(e,t){var n=t.split("=");if(2!=n.length)return!1;var r=n[0],a=n[1];if(!Object(B.a)(a))return!1;if(a=parseFloat(a),"length"===r)return function(e,t){t=$o.baseResolution.transformStepAtResolution2(t,e.resolution);var n=e.getSelectedTrack();n.pattern.changeLength(t),n.updateSteps()}(e,a),!0;var i=Rn(e);for(var s in i){var o=i[s];if(!(r in o))return!1;o[r]=a}return e.getSelectedTrack().updateSteps(),!0}var tc=function(){function e(t){Object(o.a)(this,e),this.sequencerEngine=t}return Object(c.a)(e,[{key:"run",value:function(e){return"run"!==e&&(e.indexOf("=")>-1?ec(this.sequencerEngine,e):e in this&&(this[e](),!0))}},{key:"warp",value:function(){this.track&&(this.track.warp(),this.sequencerEngine.update())}},{key:"gate",value:function(){this.track&&(this.track.gated=!0)}},{key:"ungate",value:function(){this.track&&(this.track.gated=!1)}},{key:"sampleSynth",value:function(){this.sequencerEngine.autoResampleMode=!0,this.sequencerEngine.masterResampler.prepare(),this.sequencerEngine.store.dispatch(Object(O.rc)(!0))}},{key:"makeInstrument",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.sequencerEngine.addSampledInstrumentTrack(),e.t0=N.a.keys(this.sequencerEngine.tracks);case 2:if((e.t1=e.t0()).done){e.next=10;break}if(n=e.t1.value,!(r=this.sequencerEngine.tracks[n].sample)){e.next=8;break}return e.next=8,t.instrument.newSample(void 0,r);case 8:e.next=2;break;case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"track",get:function(){return this.sequencerEngine.getSelectedTrack()}}]),e}(),nc=500;function rc(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;t.cursor.step;ac(t)&&function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.getSelectedStepData(),r=new Set;for(;n.on;)if(r.add(n.id),t?e.right(!1):e.left(!1),n=e.getSelectedStepData(),r.has(n.id))return void e.cursor.updateRedux();e.cursor.updateRedux()}(t,e),ic(t,e)}function ac(e){var t=e.cursor.getStep(e.resolution);return e.getSelectedTrack().getEasyPattern().getStepsAtStepNumber(t,e.resolution).map(function(e){return e.step}).some(function(e){return e.on})}function ic(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.getSelectedStepData(),r=new Set,a=0;!n.on;)if(a++,r.add(n.id),t?e.right(!1):e.left(!1),n=e.getSelectedStepData(),r.has(n.id)||a>nc)return void e.cursor.updateRedux();e.cursor.updateRedux()}function sc(e){for(var t=e.getSelectedStep()%e.resolution.numSteps(),n=0;n<t;n++)e.left(!1);e.cursor.updateRedux()}function oc(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.resolution.numSteps(),r=0;r<n;r++)e.right(!1);t&&e.cursor.updateRedux()}function cc(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.resolution.numSteps(),r=0;r<n;r++)e.left(!1);e.cursor.updateRedux(),t&&e.cursor.updateRedux()}var uc=500;function lc(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];ac(e)||ic(e);for(var n=e.getSelectedTrack(),r=n.getEasyPattern(),a=[],i=new Set,s=0;ac(e);){s++;var o=e.getSelectedStepData();if(i.has(o)||s>uc)return;i.add(o);var c=e.cursor.getStep(e.resolution),u=r.getStepsAtStepNumber(c,e.resolution).map(function(t){return Object(D.a)({},t,{stepNumber:e.cursor.step})});a=[].concat(Object(M.a)(a),Object(M.a)(u)),e.right()}var l=hc(a);return t&&e.operationManager.dispatch(ht(n,a.map(function(e){return e.step}))),l}function pc(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];sc(e);for(var n=e.resolution.numSteps(),r=e.resolution.getNumberOfStepsAtBaseResolution(),a=[],i=e.getSelectedTrack(),s=i.getEasyPattern(),o=e.cursor.step,c=0;c<n;c++){var u=s.getStepsAtStepNumber(o).map(function(e){return Object(D.a)({},e,{stepNumber:o})});a=[].concat(Object(M.a)(a),Object(M.a)(u)),o+=r}var l=hc(a);return t&&e.operationManager.dispatch(ht(i,a.map(function(e){return e.step}))),l}function hc(e){var t=[];for(var n in e)t.push(Object(D.a)({},e[n],{step:e[n].step.getCopy(!0,!1,!0,!1,!1)}));return t}var fc=function(){function e(t){var n=this;Object(o.a)(this,e),this.sequencerEngine=t,this.cursor=t.cursor,this.currentCommand=void 0,this.number=void 0,this.killRing=[],this[0]=function(){n.zero()}}return Object(c.a)(e,[{key:"run",value:function(e){e in this&&(this.currentCommand&&this.number?(this[e](parseInt(this.number)),this.number=void 0,this.currentCommand=void 0):(this[e](),this.currentCommand=e)),Object(B.a)(e)&&(void 0===this.number&&(this.number=""),this.number+=e)}},{key:"d",value:function(e){if(e=void 0===e?1:e,"d"==this.currentCommand){this.killRing=[];for(var t=0;t<e;t++)this.killRing=[].concat(Object(M.a)(this.killRing),Object(M.a)(pc(this.sequencerEngine))),oc(this.sequencerEngine,!1);for(var n=0;n<e;n++)cc(this.sequencerEngine,!1);this.updateRedux(),this.currentCommand=void 0}}},{key:"x",value:function(){this.killRing=function(e){var t=e.getSelectedTrack();if(ac(e)){var n=e.getSelectedStepData(),r=e.cursor.step,a=hc([{stepNumber:r,step:n}]);return e.operationManager.dispatch(ut(t,r)),a}return[]}(this.sequencerEngine)}},{key:"w",value:function(e){if("d"!=this.currentCommand)if("y"!=this.currentCommand){e=void 0===e?1:e-1;for(var t=0;t<e;t++)rc(!0,this.sequencerEngine)}else{e=void 0===e?1:e,this.killRing=[];for(var n=0;n<e;n++)this.killRing=[].concat(Object(M.a)(this.killRing),Object(M.a)(lc(this.sequencerEngine,!1)));this.currentCommand=void 0}else{e=void 0===e?1:e,this.killRing=[];for(var r=0;r<e;r++)this.killRing=[].concat(Object(M.a)(this.killRing),Object(M.a)(lc(this.sequencerEngine)));this.currentCommand=void 0}}},{key:"b",value:function(e){e=void 0===e?1:e-1;for(var t=0;t<e;t++)rc(!1,this.sequencerEngine)}},{key:"h",value:function(){this.sequencerEngine.left()}},{key:"l",value:function(){this.sequencerEngine.right()}},{key:"j",value:function(){oc(this.sequencerEngine)}},{key:"k",value:function(){cc(this.sequencerEngine)}},{key:"t",value:function(){this.dispatch(lt(this.track,this.stepNumber,this.resolution))}},{key:"e",value:function(){this.cursor.show=!this.cursor.show}},{key:"zero",value:function(){sc(this.sequencerEngine)}},{key:"a",value:function(){this.track.doubleTrackLength()}},{key:"s",value:function(){this.track.halfTrackLength()}},{key:"o",value:function(){!function(e){var t=Rn(e,e.cursor.step);for(var n in t){var r=t[n].duration||1;t[n].duration=r+1}e.getSelectedTrack().updateSteps()}(this.sequencerEngine)}},{key:"i",value:function(){!function(e){var t=Rn(e,e.cursor.step);for(var n in t){var r=t[n].duration||1;t[n].duration=Math.max(1,r-1)}e.getSelectedTrack().updateSteps()}(this.sequencerEngine)}},{key:"y",value:function(e){if(e=void 0===e?1:e,"y"==this.currentCommand){this.killRing=[];for(var t=0;t<e;t++)this.killRing=[].concat(Object(M.a)(this.killRing),Object(M.a)(pc(this.sequencerEngine,!1))),oc(this.sequencerEngine,!1);for(var n=0;n<e;n++)cc(this.sequencerEngine,!1);this.updateRedux(),this.currentCommand=void 0}}},{key:"p",value:function(){!function(e,t){var n=e.getSelectedTrack(),r=e.cursor.step,a=Math.min.apply(Math,Object(M.a)(t.map(function(e){return e.stepNumber})));t=t.map(function(e){return Object(D.a)({},e,{stepNumber:r+e.stepNumber-a})});var i=e.operationManager;t.forEach(function(e){return i.dispatch(ot(n,e.step.getCopy(!0,!1,!0,!1,!1),e.stepNumber))}),n.updateSteps()}(this.sequencerEngine,Object(M.a)(this.killRing))}},{key:"dispatch",value:function(e){this.op.dispatch(e)}},{key:"updateRedux",value:function(){this.cursor.updateRedux()}},{key:"stepNumber",get:function(){return this.sequencerEngine.getSelectedStep()}},{key:"track",get:function(){return this.sequencerEngine.getSelectedTrack()}},{key:"op",get:function(){return this.sequencerEngine.operationManager}},{key:"resolution",get:function(){return this.sequencerEngine.resolution}}]),e}();function dc(e,t){var n=e.getSelectedTrack();if(void 0!==n){var r=function(e){if(e.includes("[")){var t=e.slice(0,e.indexOf("[")),n=function(e){for(var t=[],n="",r="",a=!0,i=!1,s=0;s<e.length;s++){var o=e.charAt(s);if("="!=o){if(a)n+=o;else if(i){if(" "==o){t.push({parameter:n,value:r}),i=!1,a=!0,n="",r="";continue}r+=o}}else a=!1,i=!0}""!==n&&t.push({parameter:n,value:r});return t}(e=e.includes("]")?e.slice(e.indexOf("[")+1,e.indexOf("]")):e.slice(e.indexOf("[")+1));return{effectName:t,parameters:n}}return{effectName:e,parameters:[]}}(t),a=r.effectName,i=r.parameters;if(a in Oa){var s=Oa[a](e);return n.effects.push(s),s.enable(!0),n.updateEffects(),console.log(s),n.showEffects(!0),e.store.dispatch(Object(O.Ac)(s.id)),void mc(s,i)}if(a in Ti){var o=Ti[a](n);n.midiEffects.addEffect(o),o.enabled=!0,n.showEffects(!0),e.store.dispatch(Object(O.Ac)(o.id)),mc(o,i)}}}function mc(e,t){var n=function(n){var r=t[n],a=r.parameter,i=r.value,s=a.split(" ").join(""),o=e.parameters.find(function(e){return e.name.toLowerCase()===a.toLowerCase()||e.name.toLowerCase()===s.toLowerCase()});if(void 0===o)return"continue";if(i.includes("%")){i=parseFloat(i.slice(0,i.indexOf("%")));var c=o.max-o.min;o.set(c*(i/100))}else i=parseFloat(i),o.set(i)};for(var r in t)n(r)}function vc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var gc=function(){function e(t){Object(o.a)(this,e),this.sequencerEngine=t,this.emacsScripting=new tc(this.sequencerEngine),this.viScripting=new fc(this.sequencerEngine),this.cursor=t.cursor,this.clipboard=[],this.cmd={},this.stepFunctions={},this.stepTimes={},this.commandHistory=[],this.historyCounter=0,this.futureCalls=[]}return Object(c.a)(e,[{key:"viCommand",value:function(e){var t=void 0!==this.viScripting.currentCommand;return this.viScripting.run(e),t}},{key:"emacsCommand",value:function(e){this.emacsScripting.run(e)}},{key:"isEmacsCommand",value:function(){return"M-x"===this.sequencerEngine.state.commands.commandPrefix}},{key:"runScript",value:function(e){if(this.isEmacsCommand())return this.emacsScripting.run(e),!0;try{if(this.commandHistory.push({cursor:this.cursor.getJson(),command:e,enabled:!0}),e.startsWith("/"))this.search(e.slice(1));else if(e.startsWith("+"))this.addCommand(e.slice(1));else{if(e.startsWith(":"))return this.emacsScripting.run(e.slice(1));t=this,new Function("with(this) { "+e+"}").call(t)}return this.historyCounter=0,!0}catch(n){return void 0!==this.onFlashInfo&&this.onFlashInfo(n.message),!1}var t}},{key:"runEmacsCommand",value:function(e){}},{key:"search",value:function(e){var t=e.endsWith("/");t&&(e=e.slice(0,e.length-1));var n=e.split("+");this.sequencerEngine.searchForSounds(n,t)}},{key:"addCommand",value:function(e){dc(this.sequencerEngine,e)}},{key:"getJson",value:function(){return{commandHistory:this.commandHistory.filter(function(e){return e.enabled})}}},{key:"fromJson",value:function(e){for(var t=e.commandHistory,n=0;n<t.length;n++){var r=null;if("string"===typeof t[n])this.cursor.step=0,this.cursor.track=0,r=t[n];else if("cursor"in t[n]){var a=t[n].cursor;this.cursor.step=a.step,this.cursor.track=a.track,r=t[n].command}this.runScript(r)}}},{key:"recordMix",value:function(e){this.sequencerEngine.recordingMix=e}},{key:"slice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.sequencerEngine.getSelectedTrack().getSamplers()[0];return new Nn(t,e)}},{key:"midiFX",value:function(){var e=this;this.sequencerEngine.getSelectedTrack(),this.sequencrerEngine.midiEffects;return function(){e.sequencerEngine.getSelectedTrack()}}},{key:"left",value:function(){this.sequencerEngine.left()}},{key:"right",value:function(){this.sequencerEngine.right()}},{key:"up",value:function(){this.sequencerEngine.up()}},{key:"down",value:function(){this.sequencerEngine.down()}},{key:"arp",value:function(e){this.sequencerEngine.getSelectedTrack().trackData.arpOn=e}},{key:"arpRate",value:function(e,t){this.sequencerEngine.getSelectedTrack()}},{key:"arpOctaves",value:function(e){this.sequencerEngine.getSelectedTrack().trackData.arpOctaves=e}},{key:"steps",value:function(e){var t=this.sequencerEngine.getSelectedTrack(),n=t.getStepsAtResolution(this.sequencerEngine.resolution);void 0===e&&(e=n.length),e+this.sequencerEngine.getSelectedStep()>=n.length&&(e-=e+this.sequencerEngine.getSelectedStep()-n.length);var r=this.sequencerEngine.getSelectedStep();return new yc(this.sequencerEngine,t,n.slice(r,r+e),r)}},{key:"copy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.clipboard=this.steps(e).map(function(e){return e.getCopy()}),this.clipboard[0]}},{key:"paste",value:function(){for(var e=this.steps(this.clipboard.length).stepDataList,t=0;t<e.length;t++)e[t].copyFrom(this.clipboard[t]);this.sequencerEngine.getSelectedTrack().syncBuckets(this.sequencerEngine.resolution),this.sequencerEngine.getSelectedTrack().updateSteps()}},{key:"rand",value:function(){return Math.random()}},{key:"onStepReached",value:function(e){if(e in this.stepFunctions){try{this.stepFunctions[e].map(function(e){return e()})}catch(t){void 0!==this.onFlashInfo&&this.onFlashInfo(t.message)}this.stepTimes[e]++}}},{key:"stepFunction",value:function(e){var t=this,n=this.steps().get(0),r=(this.sequencerEngine.getSelectedTrack(),this.cursor.step),a=function(){e(n,t.stepTimes[r])};r in this.stepFunctions?this.stepFunctions[r].push(a):(this.stepFunctions[r]=[a],this.stepTimes[r]=0)}},{key:"volume",value:function(e){this.sequencerEngine.getSelectedTrack().setRawVolume(e)}},{key:"start",value:function(){this.cursor.step=0}},{key:"end",value:function(){var e=this.sequencerEngine.getTrackLength();this.cursor.setStep(e-1,this.sequencerEngine.resolution)}},{key:"line",value:function(e){var t=this;this.steps(e).map(function(){t.right()})}},{key:"clearStepFunctions",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=0;t<e;t++){var n=this.cursor.step+t;delete this.stepFunctions[n]}}},{key:"pattern",value:function(e){this.sequencerEngine.switchToPattern(e)}},{key:"clearSequence",value:function(){this.sequencerEngine.clearSequence()}},{key:"clear",value:function(){this.sequencerEngine.getSelectedTrack().pattern.clear()}},{key:"upHistory",value:function(){var e=this.commandHistory.length-this.historyCounter-1,t=this.commandHistory[e];return this.historyCounter=Math.min(this.historyCounter+1,this.commandHistory.length),void 0===t?"":t.command}},{key:"downHistory",value:function(){return this.historyCounter--,this.historyCounter<=0?(this.historyCounter=0,""):this.commandHistory[this.commandHistory.length-this.historyCounter].command}},{key:"deleteHistoryForTrack",value:function(e){for(var t=[],n=0;n<this.commandHistory.length;n++)this.commandHistory[n].cursor.track!=e&&t.push(this.commandHistory[n]);this.commandHistory=t}},{key:"map",value:function(e){this.sequencerEngine.stepNumberScript=e}},{key:"com",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){for(var n=e,r=t.length-1;r>=0;r--)n=t[r](n);return n}}},{key:"currentStep",get:function(){return this.sequencerEngine.trackStep}},{key:"phi",get:function(){return 1.61803398875}}]),e}();var yc=function(e){Object(u.a)(n,e);var t=vc(n);function n(e,r,a,i){var s,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return Object(o.a)(this,n),(s=t.call(this,e)).stepDataList=a,s.step=i,s.stepOffset=c,s.track=r,s}return Object(c.a)(n,[{key:"filter",value:function(e){return new n(this.sequencerEngine,this.track,this.stepDataList.filter(e),this.step)}},{key:"isOn",value:function(){return this.filter(function(e){return e.on})}},{key:"sync",value:function(){this.sequencerEngine.getSelectedTrack().syncBuckets(this.sequencerEngine.resolution),this.track.updateSteps()}},{key:"get",value:function(e){return this.stepDataList[e]}},{key:"even",value:function(){for(var e=[],t=0;t<this.stepDataList.length;t+=2)e.push(this.stepDataList[t]);return new n(this.sequencerEngine,this.track,e,this.step,2*this.stepOffset)}},{key:"odd",value:function(){for(var e=[],t=1;t<this.stepDataList.length;t+=2)e.push(this.stepDataList[t]);var r=this.sequencerEngine.resolution.transformStepAtBaseResolution(1);return new n(this.sequencerEngine,this.track,e,this.step+r,2*this.stepOffset)}},{key:"stepFunction",value:function(e){var t=this;this.do(function(){return t.sequencerEngine.scripting.stepFunction(e)})}},{key:"do",value:function(e){var t=this.sequencerEngine.cursor,n=t.step,r=this.step;for(var a in this.stepDataList)t.step=r,e(),r+=this.sequencerEngine.resolution.transformStepAtBaseResolution(this.stepOffset);t.step=n}},{key:"map",value:function(e){var t=this.stepDataList.map(e);return this.sync(),t}},{key:"on",set:function(e){this.map(function(t,n){return t.on="function"===typeof e?e(n):e}),this.sync()},get:function(){return this.map(function(e){return e.on})}},{key:"duration",set:function(e){this.map(function(t,n){return t.duration="function"===typeof e?e(n):e}),this.sync()},get:function(){return this.map(function(e){return e.duration})}},{key:"chop",set:function(e){this.map(function(t,n){return t.chop="function"===typeof e?e(n):e}),this.sync()},get:function(){return this.map(function(e){return e.chop})}},{key:"velocity",set:function(e){this.map(function(t,n){return t.velocity="function"===typeof e?e(n):e}),this.sync()},get:function(){return this.map(function(e){return e.velocity})}},{key:"transpose",set:function(e){this.map(function(t,n){return t.transpose="function"===typeof e?e(n):e}),this.sync()},get:function(){return this.map(function(e){return e.transpose})}},{key:"attack",set:function(e){this.map(function(t,n){return t.transpose="function"===typeof e?e(n):e}),this.sync()},get:function(){return this.map(function(e){return e.attack})}},{key:"release",set:function(e){this.map(function(t,n){return t.transpose="function"===typeof e?e(n):e}),this.sync()},get:function(){return this.map(function(e){return e.release})}}]),n}(gc),bc=gc;function kc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ec=function(e){Object(u.a)(n,e);var t=kc(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"onClickCommand",value:function(e){this.props.scripting.commandHistory[e].enabled=!this.props.scripting.commandHistory[e].enabled,console.log(this.props.scripting.commandHistory[e]),this.setState(this.state)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",null,a.a.createElement("div",{className:"header"},"Scripting History"),a.a.createElement("div",{className:"back-button",onClick:function(){return e.props.setViewMode("SEQUENCER_VIEW")}},"Back"),this.props.scripting.commandHistory.map(function(t,n){return a.a.createElement(Oc,{cmd:t,onClick:function(){return e.onClickCommand(n)}})}))}}]),n}(r.Component),Oc=function(e){Object(u.a)(n,e);var t=kc(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{onClick:this.props.onClick,className:this.props.cmd.enabled?"command":"disabled-command command"},this.props.cmd.command," - track: ",this.props.cmd.cursor.track," - step: ",this.props.cmd.cursor.step)}}]),n}(r.Component),Sc=(Object(g.b)(null,function(e){return{setViewMode:function(t){return e(Object(O.de)(t))}}})(Ec),n(18)),Pc=n(249),wc=n(250),jc=n.n(wc),Tc=function(e){var t=e.sketch,n=Object(Pc.a)(e,["sketch"]),i=a.a.createRef();return Object(r.useEffect)(function(){var e=new jc.a(function(e){return t(e,n)},i.current);return function(){e.remove()}}),a.a.createElement("div",{id:"sketchContainer",ref:i})},xc=(n(754),n(1659),new wt.a,{drawStyle:"tris",noiseRes:.4,noiseDev:5,circMix:.3,lineThickness:2,lineSpeed:6,numLines:3,noiseSeed:103,lineColSpeed:.2,colorSwing:.7,trail:.5}),Cc=["noiseRes","noiseDev","circMix","lineThickness","lineSpeed","numLines","noiseSeed","lineColSpeed","colorSwing","trail"],Nc=[1,30,1,4,20,12,200,1,1,1],Rc={},Dc=function(e,t){var n=[],r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Date.now()/1e3*e+t},a=function(t,n){return 2*(e.noise(t,n)-.5)},i=0,s=function(e){return(Math.sin(1001*(e+1))+1)/2},u=function(e){return[255*s(e),255*s(e+10*s(e)),255*s(e+10*s(2*e))]},l=function(e,t){return Object(M.a)(Array(t-e).keys()).map(function(t){return t+e})},p=function(e){return Array.from(new Array(Math.floor(e)),function(){return 0})},h=function(e,t,n){return{x:e.x*(1-n)+t.x*n,y:e.y*(1-n)+t.y*n}},f=function(e,t){return Math.pow(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2),.5)};var d=function(){function t(n,r,a,i,s){Object(o.a)(this,t),this.ind=a,this.pos=n,this.rad=r,this.lim=i,this.color=s,this.speed=.5+.5*e.random(),this.pts=l(0,3).map(function(t){return jc.a.Vector.add(n,e.createVector((e.random()-.5)*r,(e.random()-.5)*r))}),this.pts=function(e){for(var t=e.length,n=p(t),r=[],a=0;a<t;a++){var i=e[a],s=e[(a+1)%t],o=f(i,s),c=[];n[a]=o;for(var u=0;u<1;u++){var l=e[a];l.isCorner=!0,c.push(l)}r.push(c);for(var d=Math.floor(o/10),m=0;m<d;m++){var v=(m+1)/(d+1);r.push([h(i,s,v)])}}return r.flat(1)}(this.pts).map(function(t){return e.createVector(t.x,t.y)})}return Object(c.a)(t,[{key:"getDev",value:function(t){var n=xc.noiseSeed,i=.3*Math.pow(xc.noiseRes,4);return e.createVector(a(r(0,n),t.y*i)*(xc.noiseDev+2),a(r(0,n),t.x*i)*(xc.noiseDev+2)).mult(this.speed)}},{key:"update",value:function(){var e=this,t=this.pos;t.add(this.getDev(t)),this.pts=this.pts.map(function(n){n.add(e.getDev(n));var r=jc.a.Vector.dist(t,n);return r>e.lim&&(n=jc.a.Vector.lerp(t,n,e.lim/r)),n})}},{key:"draw",value:function(){e.push();var t,n,r,a,i,s,o=this.color?this.color:u(this.ind),c=(t=this.pts,a=this.pos,i=this.rad/2,s=this.pts.length,n=p(s).map(function(t,n){return e.createVector(a.x+e.cos(n/s*e.PI*2)*i,a.y+e.sin(n/s*e.PI*2)*i)}),r=xc.circMix,t.map(function(e,t){return h(e,n[t],r)}));e.fill.apply(e,Object(M.a)(o)),"tris"===xc.drawStyle?(e.beginShape(),c.forEach(function(t){return e.curveVertex(t.x,t.y)}),c.length>3&&l(0,4).forEach(function(t){return e.curveVertex(c[t].x,c[t].y)}),e.endShape(e.CLOSE),e.fill(0)):"pts"===xc.drawStyle&&(c.forEach(function(t){return e.ellipse(t.x,t.y,2)}),e.ellipse(this.pos.x,this.pos.y,15)),e.pop(),P().length}}]),t}();var m=t.sequencerEngine,v=m.store,g=[];for(var y in m.tracks){var b=m.tracks[y];b.getParametersToShow().forEach(function(e){return g.push(e.id)}),b.sendNodeVolumeParameters.forEach(function(e,t){return g.push(e.id)})}var k=function(e,t){if(e.context.macro){var n=e.context.macro;if(t.indexOf(n.name)>-1)return!0}return!1},E=(v.getState().effects.effectParameters,v.getState().tracks.trackPianoRollSteps,{}),O={},S=void 0;e.setup=function(){(S=e.createCanvas(75,75)).style("width","100%"),S.style("height","100%"),e.frameRate(20),window.addEventListener("TRIGGER_SAMPLE",w)};var P=function(){var e=[];for(var t in E)E[t].time>=O[t]&&e.push(Object(D.a)({},E[t],{trackPosition:m.tracks[t].loopPosition}));return e},w=function(t){var a,s,o,c,l,p,h,f=t.trackNumber,v=(t.duration,t.time,t.transpose,t.loopPosition,t.stepNumber),g=m.tracks.length,y={x:v/16*e.width,y:f/g*e.height};a=y.x,s=y.y,c=u(f+103),l=u(f+103+10),h=r(2),p=(Math.sin(h)+1)/2*xc.colorSwing,o=c.map(function(e,t){return function(e,t,n){return e*(1-n)+t*n}(e,l[t],p)}),n.push(new d(e.createVector(a,s),3*e.width/16,i,3*e.width/16,o)),i++};e.draw=function(){e.noStroke(),e.fill(0,0,0,20*xc.trail),e.rect(0,0,e.width,e.height);var t=e.get(0,0,e.width,e.height);e.set(0,0,t),(n=n.slice(-40)).forEach(function(e){e.update(),e.draw()}),p(xc.numLines).forEach(function(t,n){var a=40*Math.pow(xc.lineColSpeed,3);e.fill(255*e.noise(10*n,r(a))),e.rect(0,(e.height/xc.numLines*(n+.5)+r(xc.lineSpeed))%e.height,e.width,xc.lineThickness)});g.length;var a=function(){var e=m.store.getState().installation,t=e.knobsEnabled,n=e.sendsEnabled,r=[];for(var a in m.tracks){var i=m.tracks[a];i.getParametersToShow().filter(function(e){return k(e,t)}).forEach(function(e){return r.push(e.id)}),n.indexOf(parseInt(a))>=0&&i.sendNodeVolumeParameters.forEach(function(e,t){return r.push(e.id)})}return r}();a.forEach(function(e,t){var n=Cc[t%Cc.length],r=Nc[t%Nc.length],i=j(t,a);xc[n]=i*r,Rc[t]!=i&&console.log("changed",t),Rc[t]=i})};var j=function(e,t){return function(e,t){var n=m.idToParameter[e]?m.idToParameter[e]:{min:-100,max:0},r=n.min;return(t-r)/(n.max-r)}(t[e],function(e,t){return v.getState().effects.effectParameters[t[e]]}(e,t))}},qc=Object(r.memo)(function(e){var t=e.sequencerEngine;return a.a.createElement("div",{className:"song-visuals"},a.a.createElement(Tc,{sketch:Dc,sequencerEngine:t}))}),Mc=Object(g.b)(null,null)(qc),Ac=n(37);function Ic(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Lc=function(e){Object(u.a)(n,e);var t=Ic(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={minValue:r.min,maxValue:r.max},r}return Object(c.a)(n,[{key:"onChangeMin",value:function(e){(Object(B.a)(e)||"."===e||""===e||"-"===e)&&(this.setState({minValue:e}),Object(B.a)(e)?(console.log("returning because = "+e),this.mod.min=e):"."!==e&&""!==e&&"-"!==e||(this.mod.min=0))}},{key:"onChangeMax",value:function(e){Object(B.a)(e)||"."===e||""===e||"-"===e?(this.setState({maxValue:e}),Object(B.a)(e)?this.mod.max=e:"."!==e&&""!==e&&"-"!==e||(this.mod.max=0)):console.log("returning because = "+e)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"parameter-mod"},a.a.createElement("div",{className:"parameter-mod-pieces"},a.a.createElement("div",{className:"parameter-mod-modulator"},this.mod.type," ",this.mod.modulator.number," "),a.a.createElement("div",{className:"parameter-mod-text"},"mod"),a.a.createElement("div",{className:"parameter-mod-parameter"},this.parameter.name," ")),a.a.createElement("div",{className:"parameter-mod-min"},"Min:",a.a.createElement(Fc,{placeholder:"Min",onChange:function(t){return e.onChangeMin(t)},number:this.state.minValue})),a.a.createElement("div",{className:"parameter-mod-max"},"Max:",a.a.createElement(Fc,{placeholder:"Max",onChange:function(t){return e.onChangeMax(t)},number:this.state.maxValue})))}},{key:"parameter",get:function(){return this.props.parameterMod.parameter}},{key:"mod",get:function(){return this.props.parameterMod}},{key:"min",get:function(){return this.mod.scale.min}},{key:"max",get:function(){return this.mod.scale.max}}]),n}(r.Component),Fc=function(e){Object(u.a)(n,e);var t=Ic(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"number-input-container"},a.a.createElement(Ac.g,Object(An.a)({onChange:function(t){return e.props.onChange(t.target.value)},value:this.props.number,className:"search-input",placeholder:this.props.placeholder},"className","number-input")))}}]),n}(r.Component),Bc=Lc,Hc=n(32),Vc=n.n(Hc);function Uc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}r.Component;var Jc=function(e){Object(u.a)(n,e);var t=Uc(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={option:void 0},r}return Object(c.a)(n,[{key:"onChooseParameter",value:function(e){this.setState({option:e})}},{key:"render",value:function(){var e=this;return a.a.createElement(Vc.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.options,onChange:function(t){return e.onChooseParameter(t)},value:this.state.option,placeholder:"Parameter"})}},{key:"options",get:function(){return this.props.parameters.map(function(e){return{value:e,label:e.name}})}}]),n}(r.Component);function _c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Gc=function(e){Object(u.a)(n,e);var t=_c(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return a.a.createElement("div",null,this.parameterMods.map(function(e,t){return a.a.createElement(Bc,{key:"mod-"+t+"-"+e.parameter.id,parameterMod:e})}))}},{key:"parameterMods",get:function(){var e=[];return this.props.parameters.forEach(function(t){return e=e.concat(t.parameterMods)}),e}}]),n}(r.Component);function zc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Wc=function(e){Object(u.a)(n,e);var t=zc(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return this.props.condition?this.props.children:a.a.createElement("div",null)}}]),n}(r.Component);n(1665);function Kc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Qc=function(e){Object(u.a)(n,e);var t=Kc(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={showMods:!1,isCollapsed:e.isMixCollapsed||e.isCollapsed,isDraggable:void 0===e.isDraggable||e.isDraggable},console.log("draggable = ",e.isDraggable,r.state.isDraggable),r.onClickMods=r.onClickMods.bind(Object(W.a)(r)),r}return Object(c.a)(n,[{key:"onMouseEnter",value:function(){}},{key:"onMouseLeave",value:function(){}},{key:"shouldComponentUpdate",value:function(e){return e.isCollapsed!==this.props.isCollapsed&&(this.state.isCollapsed=e.isCollapsed),!0}},{key:"toggleCollapsed",value:function(){this.props.effect.isEnabled()&&this.props.setEffectCollapsed(this.props.effect.id,!this.state.isCollapsed)}},{key:"onClickMods",value:function(){this.setState({showMods:!this.state.showMods})}},{key:"deleteEffect",value:function(){var e,t,n,r;this.operationManager.dispatch((e=this.props.effect,t=this.props.track,n=this.props.group,r=this.props.send,{type:"DELETE_EFFECT",payload:{effect:e,track:t,group:n,send:r}})),this.props.onDeleteEffect()}},{key:"handleToggle",value:function(){this.operationManager.dispatch(vt(this.props.effect,this.props.track,this.props.group,this.props.send)),this.props.onToggle()}},{key:"getTrackOrGroup",value:function(){return this.props.send||this.props.track||this.props.group}},{key:"getContextNumber",value:function(){return void 0!==this.props.track?this.props.track.trackNumber:void 0!==this.props.group?this.props.group.groupNumber:1}},{key:"onDragStart",value:function(e){if(this.state.isDraggable&&!this.props.automation&&this.getTrackOrGroup()){var t=this.getTrackOrGroup().getEffectNumber(this.props.effect,this.props.isMidiEffect);this.props.isMidiEffect?this.props.dragMidiEffect({number:this.getContextNumber(),effectNumber:t}):this.props.dragEffect({number:this.getContextNumber(),effectNumber:t})}}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"onDragOver",value:function(e){this.state.isDraggable&&e.preventDefault()}},{key:"onDrop",value:function(e){if(this.state.isDraggable&&!this.props.automation&&this.getTrackOrGroup()){if(void 0!==this.props.effectDragging){var t=this.getTrackOrGroup().getEffectNumber(this.props.effect,this.props.isMidiEffect);if(this.props.isMidiEffect)return void this.props.dragEffect(void 0);this.props.effectDragging.number===this.getContextNumber()&&this.operationManager.dispatch(gt(this.props.effectDragging.effectNumber,t,!1,this.props.track,this.props.group,this.props.send)),this.props.dragEffect(void 0)}else{if(void 0===this.props.midiEffectDragging)return;var n=this.getTrackOrGroup().getEffectNumber(this.props.effect,this.props.isMidiEffect);this.props.isMidiEffect&&this.props.midiEffectDragging.number===this.getContextNumber()&&this.operationManager.dispatch(gt(this.props.midiEffectDragging.effectNumber,n,!0,this.props.track,this.props.group,this.props.send)),this.props.dragMidiEffect(void 0),this.props.dragEffect(void 0)}this.props.onDeleteEffect()}}},{key:"getClassName",value:function(e){return this.props.effect.isEnabled()?e:e+" disabled"}},{key:"selectEffect",value:function(e){e.stopPropagation(),this.props.track&&(this.props.track.sequencerEngine.selectedEffect=this.props.effect),this.props.setSelectedEffect(this.props.effect.id)}},{key:"render",value:function(){var e=this,t=this.props.isTall?"tall-effect effect":"effect";this.props.effectClass&&(t+=" "+this.props.effectClass);var n=void 0!==this.props.automation?"enabled "+t+" effect-automation":this.props.effect.isEnabled()?t+" enabled":"effect disabled";return this.state.isCollapsed&&(n+=" collapsed"),this.props.isSelected&&(n+=" selected"),this.props.isMidiEffect&&(n+=" midi"),a.a.createElement("div",{onClick:function(t){return e.selectEffect(t)},onMouseEnter:function(t){return e.onMouseEnter(t)},onMouseLeave:function(t){return e.onMouseLeave(t)},onDragStart:function(t){return e.onDragStart(t)},onDragOver:function(t){return e.onDragOver(t)},onDrop:function(t){e.onDrop(t)},draggable:this.state.isDraggable,className:n},a.a.createElement("div",{className:"effect-header"},a.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"EFFECT_TOGGLE_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.handleToggle()},className:"effect-toggle"},a.a.createElement("div",{className:"toggle-icon"})),a.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"EFFECT_COLLAPSE_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.toggleCollapsed()},className:"collapse-toggle"},a.a.createElement(Wc,{condition:this.state.isCollapsed},a.a.createElement("div",{className:"arrow-down"})),a.a.createElement(Wc,{condition:!this.state.isCollapsed},a.a.createElement("div",{className:"arrow-right"}))),a.a.createElement(Wc,{condition:this.props.effect.isEnabled()&&!this.state.isCollapsed},a.a.createElement("div",{className:"effect-name"},this.props.effect.name)),a.a.createElement(Wc,{condition:this.props.effect.isEnabled()&&!this.state.isCollapsed},this.props.alternateButton?this.props.alternateButton:a.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"PARAMETER_MODS_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:this.onClickMods,className:"mods-button small-button"},this.state.showMods?"Back":"Mods")),a.a.createElement(Wc,{condition:void 0===this.props.automation&&!this.state.isCollapsed},a.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"EFFECT_DELETE_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"delete-button",onClick:function(){return e.deleteEffect()}},"x"))),a.a.createElement("div",{className:"inner-effect"},a.a.createElement(Wc,{condition:!this.props.effect.isEnabled()||this.state.isCollapsed},a.a.createElement("div",{className:"effect-name"},this.props.effect.name)),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(Wc,{condition:this.state.showMods},a.a.createElement(Gc,{parameters:this.props.effect.parameters})),a.a.createElement(Wc,{condition:!this.state.showMods&&!this.state.isCollapsed},this.props.children),a.a.createElement("div",{className:"clear-fix"})))}},{key:"operationManager",get:function(){return this.props.sequencerEngine.operationManager}}]),n}(r.Component),Xc=Object(g.b)(function(e,t){return{effectDragging:e.sequencer.effectDragging,midiEffectDragging:e.effects.midiEffectDragging,isCollapsed:e.effects.effectCollapsed[t.effect.id],isSelected:e.effects.selectedEffect===t.effect.id,isEnabled:t.effect.isEnabled()}},function(e,t){return{setContextualHelp:function(t){return e(Object(O.U)(t))},dragEffect:function(t){return e(Object(O.e)(t))},dragMidiEffect:function(t){return e(Object(O.Pb)(t))},setEffectCollapsed:function(t,n){return e(Object(O.fb)(t,n))},setSelectedEffect:function(t){return e(Object(O.Ac)(t))}}})(Qc);function Yc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Zc=function(e){Object(u.a)(n,e);var t=Yc(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"hasAutomationSet",value:function(){return void 0!==this.props.automation&&void 0!==this.props.automation.get(this.props.parameter)}},{key:"deleteAutomation",value:function(){this.props.automation.delete(this.props.parameter)}},{key:"render",value:function(){var e=this;eu(this.props.value);return a.a.createElement("div",{className:"lfo-rate-dropdown"},this.props.hideLabel?"":a.a.createElement("div",{className:"lfo-rate-label"},"Rate:"),a.a.createElement(Vc.a,{className:"osc-type-dropdown float-left",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:$c,onChange:function(t){return e.props.onChange(t.value)},value:eu(this.props.value),placeholder:"Rate"}),a.a.createElement(Wc,{condition:this.hasAutomationSet()},a.a.createElement("div",{onClick:function(){return e.deleteAutomation()},className:"automation-label float-right"},"AUTOMATION")),a.a.createElement("div",{className:"clear-fix"}))}}]),n}(r.Component),$c=[{value:new Xe(4,!1),label:"1/4"},{value:new Xe(4,!0),label:"1/4t"},{value:new Xe(8,!1),label:"1/8"},{value:new Xe(8,!0),label:"1/8t"},{value:new Xe(16,!1),label:"1/16"},{value:new Xe(16,!0),label:"1/16t"},{value:new Xe(32,!1),label:"1/32"},{value:new Xe(32,!0),label:"1/32t"}];function eu(e){for(var t=0;t<$c.length;t++)if($c[t].value.resolution==e.resolution&&$c[t].value.isTriplet==e.isTriplet)return $c[t];return null}var tu=Object(g.b)(function(e,t){return{value:void 0===t.automation||void 0===t.automation.get(t.parameter)?t.parameter.get():t.automation.get(t.parameter).value}},void 0)(Zc);function nu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ru=function(e){Object(u.a)(n,e);var t=nu(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"isToggled",value:function(){return void 0!==this.props.instrument?this.props.instrument.isParameterConnectedToLFO(this.props.parameter,this.props.lfo):this.props.parameter.isConnectedToLFO(this.props.lfo)}},{key:"toggle",value:function(){void 0!==this.props.instrument?this.props.instrument.toggleParameterWithLFO(this.props.parameter,this.props.lfo):(this.props.parameter.isAudioParamEnabled()||this.props.parameter.enableAudioParam(),this.isToggled()?this.props.parameter.disconnectFromLFO(this.props.lfo):(this.props.parameter.connectToLFO(this.props.lfo),this.props.setShowLFOs(!0),this.props.setSelectedLFO(this.props.lfo.number))),this.setState(this.state)}},{key:"onMouseOver",value:function(e){e.stopPropagation(),console.log("on mouse over = LFO_TOGGLE_BUTTON"),this.props.setContextualHelp("LFO_TOGGLE_BUTTON")}},{key:"render",value:function(){var e=this,t=this.isToggled()?" toggled ":"",n=this.props.lfos.indexOf(this.props.lfo);return a.a.createElement("div",{onMouseOver:function(t){return e.onMouseOver(t)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.toggle()},className:"parameter-lfo-toggle lfo-"+n+t},n+1)}}]),n}(r.Component),au=Object(g.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(O.U)(t))},setSelectedLFO:function(t){return e(Object(O.Ec)(t))},setShowLFOs:function(t){return e(Object(O.Yc)(t))}}})(ru);function iu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var su=function(e){Object(u.a)(n,e);var t=iu(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"isToggled",value:function(){return this.props.parameter.isConnectedToEnvelope(this.props.envelope)}},{key:"toggle",value:function(){this.props.parameter.isAudioParamEnabled()||this.props.parameter.enableAudioParam(),this.isToggled()?this.props.parameter.disconnectFromEnvelope(this.props.envelope):(this.props.parameter.connectToEnvelope(this.props.envelope),this.props.setSelectedEnvelope(this.props.envelope.number),this.props.setShowEnvelopes(!0)),this.setState(this.state)}},{key:"onMouseOver",value:function(e){e.stopPropagation(),this.props.setContextualHelp("ENVELOPE_TOGGLE_BUTTON")}},{key:"render",value:function(){var e=this,t=this.isToggled()?" toggled ":"",n=this.props.envelopes.indexOf(this.props.envelope);return a.a.createElement("div",{onMouseOver:function(t){return e.onMouseOver(t)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.toggle()},className:"parameter-envelope-toggle lfo-"+n+t},n+1)}}]),n}(r.Component),ou=Object(g.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(O.U)(t))},setSelectedEnvelope:function(t){return e(Object(O.Bc)(t))},setShowEnvelopes:function(t){return e(Object(O.Vc)(t))}}})(su),cu="MAP";function uu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var lu=new wt.a,pu=function(e){Object(u.a)(n,e);var t=uu(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={parameter:r.props.parameter,showModulators:!!r.props.parameter.isConnectedToAnyModulator&&r.props.parameter.isConnectedToAnyModulator(),editing:!1,value:r.props.value},r}return Object(c.a)(n,[{key:"onEdit",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.stopPropagation(),t!==this.state.editing&&t&&this.setState({value:this.props.value}),this.setState({editing:t})}},{key:"shouldComponentUpdate",value:function(e){return this.state.parameter=e.parameter,e.parameter.isConnectedToAnyModulator&&(this.state.showModulators=e.parameter.isConnectedToAnyModulator()),e.value!==parseFloat(this.state.value)&&(this.state.value=e.value),!0}},{key:"onUpdateParameter",value:function(e){if("."===e)e=0;else if("-"===e)e=0;else if(""===e)e=0;else if(!Object(B.a)(e))return;if(e=parseFloat(e),this.props.midiMapMode===cu&&this.props.setParameterMidiMapSelection(this.props.parameter.id),this.props.isParameter?this.operationManager?this.operationManager.dispatch(yt(this.state.parameter,e)):this.state.parameter.set(e):void 0===this.props.updateFunction?this.state.parameter.value=e:this.props.updateFunction(e),void 0!==this.props.automation){var t=this.props.automation.get(this.props.parameter);void 0===t?this.props.automation.set(this.props.parameter,new Ue(this.props.effectNumber,this.props.parameter,e,this.props.automationContext)):t.value=e}void 0!==this.props.onParameterChanged&&this.props.onParameterChanged(this.state.parameter,e)}},{key:"deleteAutomation",value:function(){this.props.automation.delete(this.props.parameter)}},{key:"hasAutomationSet",value:function(){return void 0!==this.props.automation&&void 0!==this.props.automation.get(this.props.parameter)}},{key:"getValue",value:function(){var e=void 0!==this.value?this.value:this.props.isParameter?this.props.parameter.get():this.props.getValue();if(void 0===this.props.automation)return e;var t=this.props.automation.get(this.props.parameter);return void 0===t?e:t.value}},{key:"getLFOs",value:function(){return void 0!==this.props.sequencerEngine?this.props.sequencerEngine.lfosTrack.lfos.map(function(e){return e.lfo}):this.props.lfoEnabled?this.props.lfos:[]}},{key:"onClickParameterName",value:function(){this.props.midiMapMode===cu?this.props.deleteParameterMidiMapping(this.props.parameter.id):void 0!==this.props.sequencerEngine&&this.setState({showModulators:!0})}},{key:"getEnvelopes",value:function(){return void 0===this.props.sequencerEngine?[]:this.props.sequencerEngine.envelopes}},{key:"onMouseOver",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"onTypedInputChanged",value:function(e){(Object(B.a)(e)||"."===e||""===e||"-"===e)&&(this.state.value=e,this.onUpdateParameter(e))}},{key:"onKeyPress",value:function(e){"Enter"===e.key&&this.setState({editing:!1})}},{key:"getMacroOverlayIfNeeded",value:function(){var e=this,t=this.props,n=t.isMacroMapping,r=t.parameter,i=t.isParameterToMap;if(n&&r){var s="macro-overlay";i&&(s+=" parameter-to-map"),r.hasMacro&&(s+=" mapped");var o={};this.props.parameter.hasMacro&&(o={backgroundColor:lu.getColorForHash(r.hasMacro.id)});var c=r.hasMacro&&r.hasMacro.name;return a.a.createElement("div",{onClick:function(){return e.props.setParameterToMap(e.props.parameter)},className:s},a.a.createElement("div",{className:"overlay-main"}),a.a.createElement("div",{className:"overlay-detail",style:o},c))}return""}},{key:"render",value:function(){var e=this,t=(this.getValue(),this.getLFOs()),n=this.getEnvelopes(),r=void 0!==this.props.customClassName?this.props.customClassName:"";r+=this.props.selectedParameter===this.props.parameter?" selected-parameter parameter-box":"parameter-box";var i=this.props.refined?.01:this.props.step;this.props.isMidiSelected&&this.props.midiMapMode===cu&&(r+=" midi-selected");var s=this.props.contextualHelp||"EFFECT_PARAMETER";return a.a.createElement("div",{className:r},this.getMacroOverlayIfNeeded(),a.a.createElement("div",{className:"parameter-label-container"},a.a.createElement("div",{className:"parameter-label effect-parameter-label"},a.a.createElement("div",{onClick:function(){return e.onClickParameterName()},onMouseOver:function(t){return e.onMouseOver(t,s)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"parameter-label-name"},this.props.name,": "),a.a.createElement(Wc,{condition:this.state.editing},a.a.createElement(Ac.h,{className:"tag-sound-input"},a.a.createElement(Ac.g,{value:this.state.value,onKeyUp:function(t){return e.onKeyPress(t)},onChange:function(t){return e.onTypedInputChanged(t.target.value)},placeholder:"Parameter",className:"parameter-input-box"}))),a.a.createElement(Wc,{condition:!this.state.editing},a.a.createElement("div",{onMouseOver:function(t){return e.onMouseOver(t,"PARAMETER_VALUE")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"parameter-label-value",onClick:function(t){return e.onEdit(t)}},this.displayValue)),a.a.createElement(Wc,{condition:this.hasAutomationSet()},a.a.createElement("div",{onClick:function(){return e.deleteAutomation()},className:"automation-label"},"AUTOMATION")))),a.a.createElement(Wc,{condition:this.props.lfoEnabled&&(void 0===this.props.sequencerEngine||this.state.showModulators)},a.a.createElement("div",{className:"lfo-boxes"},t.map(function(n,r){var i;return a.a.createElement(au,(i={parameter:e.props.parameter,lfo:n,lfos:t},Object(An.a)(i,"parameter",e.props.parameter),Object(An.a)(i,"instrument",e.props.instrument),i))}),n.map(function(t,r){var i;return a.a.createElement(ou,(i={parameter:e.props.parameter,envelope:t,envelopes:n},Object(An.a)(i,"parameter",e.props.parameter),Object(An.a)(i,"instrument",e.props.instrument),i))}))),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(Wc,{condition:!this.props.hideSlider},a.a.createElement(xt.a,{value:parseFloat(this.value),change:function(t){return e.onUpdateParameter(t.target.value)},step:i,max:this.props.max,min:this.props.min,orientation:"horizontal",reversed:!1})))}},{key:"operationManager",get:function(){return this.props.sequencerEngine&&this.props.sequencerEngine.operationManager}},{key:"value",get:function(){var e=this.props.value;return"object"===typeof e?e.toSeconds?e=e.toSeconds():e._val&&(e=new x.a.Time(e._val).toSeconds()):"string"===typeof e&&(e=new x.a.Time(e).toSeconds()),e}},{key:"displayValue",get:function(){var e,t=this.props.unit||"";return(void 0===this.props.displayFunction?(e=this.value,Math.round(1e3*e)/1e3):this.props.displayFunction(this.value))+" "+t}}]),n}(r.Component);var hu=Object(g.b)(function(e,t){return{value:void 0!==t.value?t.value:t.isParameter&&void 0===t.automation?e.effects.effectParameters[t.parameter.id]:t.isParameter&&void 0!==t.automation.get(t.parameter)?t.automation.get(t.parameter).value:t.isParameter?t.parameter.get():t.getValue(),isMidiSelected:t.parameter.id===e.midi.parameterSelected,midiMapMode:e.midi.midiMapMode,isMacroMapping:e.effects.isMacroMapping,isParameterToMap:t.parameter&&e.effects.parameterToMap===t.parameter}},function(e){return{setContextualHelp:function(t){return e(Object(O.U)(t))},setParameterMidiMapSelection:function(t){return e(Object(O.Zb)(t))},deleteParameterMidiMapping:function(t){return e(Object(O.d)(t))},setParameterToMap:function(t){return e(Object(O.bc)(t))}}})(pu);function fu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var du=function(e){Object(u.a)(n,e);var t=fu(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={effect:e.effect},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"handleOptionChange",value:function(e){this.setState(this.state)}},{key:"handleParameterChange",value:function(e,t){if(this.props.automation){var n=this.props.automation.get(e);void 0===n?this.props.automation.set(this.props.parameter,new Ue(this.props.effectNumber,e,t)):n.value=t}else this.props.sequencerEngine.operationManager.dispatch(yt(e,t))}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"getParameter",value:function(e){var t=e.get();if(this.props.automation){var n=this.props.automation.get(e);if(void 0!==n)return n.value}return t}},{key:"render",value:function(){var e,t=this;return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement(tu,{automation:this.props.automation,onChange:function(e){return t.handleParameterChange(t.state.effect.arpRateParameter,e)},parameter:this.state.effect.arpRateParameter}),a.a.createElement("div",{className:"lfo-rate-dropdown"},a.a.createElement("div",{className:"lfo-rate-label"},"Direction:"),a.a.createElement(Vc.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:mu,onChange:function(e){return t.handleParameterChange(t.state.effect.arpDirectionParameter,e.value)},value:(e=this.getParameter(this.state.effect.arpDirectionParameter),mu.filter(function(t){return t.value===e})[0]),placeholder:"Direction"}),a.a.createElement("div",{className:"clear-fix"})),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Octaves",parameter:this.state.effect.arpOctavesParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:0,max:6}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Repeats",parameter:this.state.effect.arpRepeatParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:1,max:8}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Duration Factor",parameter:this.state.effect.arpDurationFactorParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.1,min:.1,max:8})):"")}}]),n}(r.Component),mu=[{value:Aa,label:"Down"},{value:Ia,label:"Up"}];var vu=Object(g.b)(function(e,t){return{arpDirection:t.effect.arpDirectionParameter.get()}},null)(du);function gu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var yu=function(e){Object(u.a)(n,e);var t=gu(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"getParameterOptions",value:function(){return this.props.effect.getAvailableParameters().map(function(e){return{label:e.name,value:e}})}},{key:"getParameterOption",value:function(e){if(void 0!==e){var t=this.getParameterOptions().filter(function(t){return t.value===e});return t.length>0?t[0]:void 0}}},{key:"handleParameterChange",value:function(e){this.props.effect.parameter=e.value,this.setState(this.state)}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",null,a.a.createElement(Wc,{condition:this.isEnabled()},a.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"PARAMETERIZER_DROPDOWN")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"parameter-dropdown-container"},a.a.createElement("div",{className:"lfo-rate-label"},"Parameter:"),a.a.createElement(Vc.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.getParameterOptions(),onChange:function(t){return e.handleParameterChange(t)},value:this.getParameterOption(this.props.effect.parameter),placeholder:"Parameter"})),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,contextualHelp:"PARAMETERIZER_FACTOR",name:"Factor",automation:this.props.automation,parameter:this.props.effect.factorParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.01,min:.01,max:8}),a.a.createElement(hu,{contextualHelp:"PARAMETERIZER_OFFSET",effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Offset",parameter:this.props.effect.offsetParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.1,min:-12,max:12}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Probability",contextualHelp:"PROBABILITY",automation:this.props.automation,parameter:this.props.effect.probabilityParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:0,max:100})))}}]),n}(r.Component),bu=Object(g.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(O.U)(t))}}})(yu);function ku(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Eu=function(e){Object(u.a)(n,e);var t=ku(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"handleResolutionChange",value:function(e){this.props.effect.resolution=e.value,this.setState(this.state)}},{key:"render",value:function(){var e,t=this;return a.a.createElement("div",null,a.a.createElement(Wc,{condition:this.isEnabled()},a.a.createElement("div",{className:"lfo-rate-dropdown"},a.a.createElement("div",{className:"lfo-rate-label"},"Resolution:"),a.a.createElement(Vc.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:Ou,onChange:function(e){return t.handleResolutionChange(e)},value:(e=this.props.effect.resolution,Ou.filter(function(t){return t.value===e})[0]),placeholder:"Rate"}),a.a.createElement("div",{className:"clear-fix"})),a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Odd Timing Offset",parameter:this.props.effect.evenOffsetParameter,onParameterChanged:this.props.onParameterChanged,automation:this.props.automation,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.01,min:-.5,max:4}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Even Timing Offset",parameter:this.props.effect.oddOffsetParameter,automation:this.props.automation,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.01,min:-.5,max:4}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Probability",parameter:this.props.effect.probabilityParameter,automation:this.props.automation,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:0,max:100})))}}]),n}(r.Component),Ou=[{value:32,label:"1"},{value:16,label:"1/2"},{value:8,label:"1/4"},{value:4,label:"1/8"},{value:2,label:"1/16"},{value:1,label:"1/32"}];var Su=Eu;function Pu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var wu=function(e){Object(u.a)(n,e);var t=Pu(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"onChangeResolution",value:function(e){this.props.sequencerEngine.operationManager.dispatch(yt(this.props.effect.resolutionParameter,e))}},{key:"onChangeSliceRetrigger",value:function(e){document.activeElement.blur(),this.props.effect.sliceRetrigger=!this.props.effect.sliceRetrigger,this.setState(this.state)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",null,a.a.createElement(Wc,{condition:this.isEnabled()},a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(tu,{automation:this.props.automation,parameter:this.props.effect.resolutionParameter,onChange:function(t){return e.onChangeResolution(t)}}),a.a.createElement(Wc,{condition:!window.installation},a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Warp Speed",parameter:this.props.effect.warpLengthParameter,automation:this.props.automation,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.01,min:.01,max:16}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Warp Factor",parameter:this.props.effect.warpFactorParameter,onParameterChanged:this.props.onParameterChanged,automation:this.props.automation,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:1,max:8})),a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Loop Length",automation:this.props.automation,parameter:this.props.effect.loopLengthParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,unit:"%",step:.1,min:.1,max:100}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Grain Size",automation:this.props.automation,parameter:this.props.effect.durationFactorParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.01,min:.01,max:2}),a.a.createElement(Wc,{condition:!window.installation},a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Smoothness",parameter:this.props.effect.smoothnessParameter,automation:this.props.automation,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.1,min:1,max:20})),a.a.createElement("div",{className:"refined-checkbox-preferences"},a.a.createElement("label",null,a.a.createElement("input",{type:"checkbox",value:"reversed",checked:this.props.effect.sliceRetrigger,onChange:function(t){return e.onChangeSliceRetrigger(t.target.value)}}),"Slice Retrigger"))))}}]),n}(r.Component),ju=Object(g.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(O.U)(t))}}})(wu);function Tu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var xu=function(e){Object(u.a)(n,e);var t=Tu(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={value:r.props.effect.cycleString},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e){return e.cycle!==this.props.cycle&&(this.state.value=ki(e.cycle),console.log("cycle changed =",this.state.value)),!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"onEditCycle",value:function(e){this.setState({value:e})}},{key:"preventDragging",value:function(e,t){e.target.parentNode.parentNode.parentNode.parentNode.setAttribute("draggable",t)}},{key:"onKeyDown",value:function(e){"Enter"===e.key&&this.submit()}},{key:"submit",value:function(){var e=this,t=function(e){e=" "+e+" ";for(var t=[],n=[t],r={cycle:void 0,transpose:"",operand:"",operator:void 0},a=0;a<e.length;a++){var i=e.charAt(a);switch(i){case"*":""===r.transpose&&(r.cycle=t.pop()),r.operator="*";break;case"/":""===r.transpose&&(r.cycle=t.pop()),r.operator="/";break;case"~":r.transpose=null;break;case" ":bi(r,t),r={cycle:void 0,transpose:"",operand:"",operator:void 0};break;case"[":bi(r,t),t=[],n.push(t),r={cycle:void 0,transpose:"",operand:"",operator:void 0};break;case"]":bi(r,t);var s=n.pop();(t=n[n.length-1]||[]).push(s),r={cycle:void 0,transpose:"",operand:"",operator:void 0};break;default:r.operator?r.operand+=i:r.transpose+=i}}return n[0]}(this.state.value);t&&t.length>0?(console.log("cycle =",t),this.props.sequencerEngine.operationManager.dispatch(yt(this.props.effect.cycleParameter,t))):(this.setState({showError:!0}),setTimeout(function(){e.setState({showError:!1})},1e3))}},{key:"onChangeCycleRetrigger",value:function(e){document.activeElement.blur(),this.props.effect.cycleRetrigger=!this.props.effect.cycleRetrigger,this.setState(this.state)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",null,a.a.createElement(Wc,{condition:this.isEnabled()},a.a.createElement("div",{className:"tidal-component"},a.a.createElement(Ac.g,{value:this.state.value,onKeyDown:function(t){return e.onKeyDown(t)},onMouseDown:function(t){e.preventDragging(t,!1)},onMouseUp:function(t){e.preventDragging(t,!0),t.target.parentNode.parentNode.parentNode.parentNode.setAttribute("draggable",!0)},onChange:function(t){return e.onEditCycle(t.target.value)},placeholder:"Output Note",className:"tidal-input"}),a.a.createElement("div",{className:"enter-button",onClick:function(){return e.submit()}},"Enter")),a.a.createElement(Wc,{condition:this.state.showError},a.a.createElement("div",{className:"error-box"},"Syntax Error")),a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Cycle Length",parameter:this.props.effect.cycleLengthParameter,automation:this.props.automation,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:4,max:64}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Duration Factor",parameter:this.props.effect.durationFactorParameter,automation:this.props.automation,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.01,min:0,max:4}),a.a.createElement("div",{className:"refined-checkbox-preferences"},a.a.createElement("label",null,a.a.createElement("input",{type:"checkbox",value:"reversed",checked:this.props.effect.cycleRetrigger,onChange:function(t){return e.onChangeCycleRetrigger(t.target.value)}}),"Cycle Retrigger"))))}}]),n}(r.Component),Cu=Object(g.b)(function(e,t){return{cycle:t.effect.cycle}},null)(xu);function Nu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ru=function(e){Object(u.a)(n,e);var t=Nu(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"getParameterOptions",value:function(){return this.props.sequencerEngine.tracks.map(function(e){return{label:e.trackNumber+1,value:e}})}},{key:"getParameterOption",value:function(e){if(void 0!==e){e=this.props.sequencerEngine.tracks[e];var t=this.getParameterOptions().filter(function(t){return t.value===e});return t.length>0?t[0]:void 0}}},{key:"handleParameterChange",value:function(e){this.props.effect.trackOutput=e.value.trackNumber,this.setState(this.state)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",null,a.a.createElement(Wc,{condition:this.isEnabled()},a.a.createElement("div",{className:"parameter-dropdown-container"},a.a.createElement("div",{className:"lfo-rate-label"},"Track:"),a.a.createElement(Vc.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.getParameterOptions(),onChange:function(t){return e.handleParameterChange(t)},value:this.getParameterOption(this.props.effect.trackOutput),placeholder:"Output"})),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Probability",parameter:this.props.effect.probabilityParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:0,max:100})))}}]),n}(r.Component);function Du(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var qu=function(e){Object(u.a)(n,e);var t=Du(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"render",value:function(){var e=this.props.effect.ccParameters;return a.a.createElement("div",null,a.a.createElement("div",{className:"external-instrument-name"},this.props.effect.midiOutput.name),a.a.createElement("div",{className:"midi-interface-effect"},a.a.createElement(Wc,{condition:this.isEnabled()},e.map(function(e){return a.a.createElement("div",{className:"instrument-section"},Object.keys(e).map(function(t){return a.a.createElement(Mu,{section:e[t],sectionName:t})}))}))))}}]),n}(r.Component),Mu=function(e){Object(u.a)(n,e);var t=Du(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"external-instrument-subsection"},a.a.createElement("div",{className:"instrument-subsection-name"},this.props.sectionName),a.a.createElement("div",{className:"clear-fix"}),Object.keys(this.props.section).map(function(t){return a.a.createElement(hu,{effectNumber:e.props.effectNumber,name:t,parameter:e.props.section[t],onParameterChanged:e.props.onParameterChanged,isParameter:!0,step:1,min:0,max:127})}))}}]),n}(r.Component),Au=qu;function Iu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Lu=function(e){Object(u.a)(n,e);var t=Iu(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"getParameterOptions",value:function(){return this.props.effect.getAvailableParameters().map(function(e){return{label:e.name,value:e}})}},{key:"getParameterOption",value:function(e){if(void 0!==e){var t=this.getParameterOptions().filter(function(t){return t.value===e});return t.length>0?t[0]:void 0}}},{key:"handleParameterChange",value:function(e){this.props.effect.parameter=e.value,this.setState(this.state)}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement(Wc,{condition:this.isEnabled()},a.a.createElement(hu,{effectNumber:this.props.effectNumber,contextualHelp:"PARAMETERIZER_FACTOR",name:"Pitch",parameter:this.props.effect.pitchParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.1,min:-32,max:32}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,contextualHelp:"PARAMETERIZER_FACTOR",name:"Velocity",parameter:this.props.effect.velocityParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.01,min:0,max:1}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,contextualHelp:"PARAMETERIZER_FACTOR",name:"Timing Offset",parameter:this.props.effect.timingOffsetParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.01,min:0,max:4}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Probability",contextualHelp:"PROBABILITY",parameter:this.props.effect.probabilityParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:0,max:100})))}}]),n}(r.Component),Fu=Object(g.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(O.U)(t))}}})(Lu);function Bu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Hu=function(e){Object(u.a)(n,e);var t=Bu(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"render",value:function(){var e=this;return console.log("last note played = "+this.props.lastNotePlayed),a.a.createElement("div",null,a.a.createElement(Wc,{condition:this.isEnabled()},[0,1,2,3,4,5,6,7,8,9,10,11].map(function(t){return a.a.createElement(Vu,{isLastNote:e.props.lastNotePlayed===t,input:t,effect:e.props.effect})})))}}]),n}(r.Component),Vu=function(e){Object(u.a)(n,e);var t=Bu(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"getOutput",value:function(){return this.props.effect.tuningMappings[this.props.input]}},{key:"onUpdateOutput",value:function(e){try{e=parseFloat(e),this.props.effect.tuningMappings[this.props.input]=e}catch(t){console.log("error")}this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.props.isLastNote?"note-mapping highlighted":"note-mapping";return a.a.createElement("div",{className:t},a.a.createElement("label",{className:"input-note"},this.props.input,":"),a.a.createElement(Ac.g,{value:this.getOutput(),onChange:function(t){return e.onUpdateOutput(t.target.value)},placeholder:"Output Note",className:"note-mapping-output"}))}}]),n}(r.Component),Uu=Object(g.b)(function(e,t){return{lastNotePlayed:e.keyboard.lastNotePlayed}},function(e,t){return{setContextualHelp:function(t){return e(Object(O.U)(t))}}})(Hu);function Ju(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var _u=function(e){Object(u.a)(n,e);var t=Ju(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,name:"Wet",parameter:this.props.effect.wetParameter,lfoEnabled:!0,onParameterChanged:this.props.onParameterChanged,isParameter:!0,displayFunction:function(e){return Math.floor(100*e)},unit:"%",step:.01,max:1,min:0})}}]),n}(r.Component);function Gu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var zu=function(e){Object(u.a)(n,e);var t=Gu(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement(Wc,{condition:this.isEnabled()},a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Steps Delay",parameter:this.props.effect.delayTimeParameter,automation:this.props.automation,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:1,max:64}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Repeats",parameter:this.props.effect.repeatsParameter,automation:this.props.automation,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:1,max:32}),a.a.createElement(_u,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})))}}]),n}(r.Component);var Wu=Object(g.b)(function(e,t){return{value:e.effects.effectParameters[t.parameter.id]}},null)(function(e){var t=Object(r.useCallback)(function(t){document.activeElement.blur(),console.log("setting parameter to = "+!e.value),e.parameter.set(!e.value)},[e.parameter,e.value]);return a.a.createElement("div",{className:"checkbox-parameter"},a.a.createElement("label",null,a.a.createElement("input",{type:"checkbox",value:"checked",checked:e.value,onChange:function(e){return t(e.target.value)}}),e.name))});function Ku(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Qu=function(e){Object(u.a)(n,e);var t=Ku(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"addParameter",value:function(){this.props.effect.newParameter(),this.setState(this.state)}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"getParameterOptions",value:function(){return this.props.effect.getAvailableParameters().map(function(e){return{label:e.name,value:e}})}},{key:"getParameterOption",value:function(e){if(void 0!==e){var t=this.getParameterOptions().filter(function(t){return t.value===e});return t.length>0?t[0]:void 0}}},{key:"handleParameterChange",value:function(e){this.props.effect.parameter=e.value,this.setState(this.state)}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",null,a.a.createElement(Wc,{condition:this.isEnabled()},a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Every",contextualHelp:"PROBABILITY",unit:"th trigger",automation:this.props.automation,parameter:this.props.effect.everyParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:1,max:16}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Trigger Offset",contextualHelp:"PROBABILITY",unit:"th trigger",automation:this.props.automation,parameter:this.props.effect.offsetParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:0,max:8}),a.a.createElement(Wu,{name:"Gate",parameter:this.props.effect.gateParameter}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Gate Probability",contextualHelp:"PROBABILITY",automation:this.props.automation,parameter:this.props.effect.gateProbabilityParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:0,max:100}),this.props.effect.parameterEffects.map(function(t){return a.a.createElement(bu,{isSimple:!0,effect:t,sequencerEngine:e.props.sequencerEngine})}),a.a.createElement("div",{onClick:function(){return e.addParameter()},className:"add-parameterizer-button"},"Add Parameter")))}}]),n}(r.Component),Xu=Object(g.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(O.U)(t))}}})(Qu);function Yu(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Zu=function(e){Object(u.a)(n,e);var t=Yu(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement(Wc,{condition:this.isEnabled()},a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Duration Factor",parameter:this.props.effect.durationFactorParameter,onParameterChanged:this.props.onParameterChanged,automation:this.props.automation,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.01,min:.1,max:2}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Even Delay Time",automation:this.props.automation,parameter:this.props.effect.oddDelayTimeParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:.01,max:16}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Odd Delay Time",automation:this.props.automation,parameter:this.props.effect.evenDelayTimeParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:.01,max:16}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Repeats",automation:this.props.automation,parameter:this.props.effect.repeatsParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:1,max:8}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Velocity Spread",automation:this.props.automation,parameter:this.props.effect.velocitySpreadParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.01,min:1,max:100}),a.a.createElement(Wu,{name:"Synced",parameter:this.props.effect.syncedParameter})))}}]),n}(r.Component),$u=Object(g.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(O.U)(t))}}})(Zu);function el(e){var t=e.line;if(void 0===t)return a.a.createElement("div",null);var n=Object(r.useCallback)(function(t){console.log("on change value = "+t),e.onChangeValue({brightness:t})},[]),i=t.brightness||1;return a.a.createElement("div",{className:"line-parameters"},a.a.createElement("div",null,"Brightness: ",i),a.a.createElement(xt.a,{value:parseFloat(i),change:function(e){return n(e.target.value)},step:.01,max:1,min:0,orientation:"horizontal",reversed:!1}))}var tl=10;function nl(e,t,n){for(var r in e){var a=e[r];if(rl(t,n,a.x1,a.y1)<tl)return{x:a.x1,y:a.y1};if(rl(t,n,a.x2,a.y2)<tl)return{x:a.x2,y:a.y2}}return{x:t,y:n}}function rl(e,t,n,r){return Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2))}var al=new wt.a,il="#eb3434",sl="#ebe534";function ol(e){var t=Object(r.useState)(!1),n=Object(j.a)(t,2),i=n[0],s=n[1],o=e.line,c=i||e.isSelected?sl:il;c=al.brighten(c,o.brightness||1);var u=Object(r.useCallback)(function(t){t.cancelBubble=!0,e.onClickLine()},[e.onClickLine]),l=Object(r.useCallback)(function(t,n,r){t.cancelBubble=!0,e.onClickPoint(n,r)},[e.onClickPoint]);return a.a.createElement(Sc.Group,null,a.a.createElement(Sc.Line,{onMouseLeave:function(){return s(!1)},onMouseOver:function(){return s(!0)},onMouseDown:u,strokeWidth:10,alpha:.1,stroke:"black",points:[o.x1,o.y1,o.x2,o.y2]}),a.a.createElement(Sc.Line,{onMouseDown:u,strokeWidth:2,stroke:c,points:[o.x1,o.y1,o.x2,o.y2]}),a.a.createElement(Sc.Circle,{onMouseDown:function(e){return l(e,o.x1,o.y1)},x:o.x1,y:o.y1,radius:8,fill:"black"}),a.a.createElement(Sc.Circle,{x:o.x1,y:o.y1,radius:2,fill:"red"}),a.a.createElement(Sc.Circle,{onMouseDown:function(e){return l(e,o.x2,o.y2)},x:o.x2,y:o.y2,radius:8,fill:"black"}),a.a.createElement(Sc.Circle,{x:o.x2,y:o.y2,radius:2,fill:"red"}))}var cl="rgb(2, 30, 11)";function ul(e){var t=Array(16).fill(0),n=e.width/16,r=e.width/16;return a.a.createElement(Sc.Group,null,t.map(function(t,r){return a.a.createElement(Sc.Line,{stroke:cl,strokeWidth:1,points:[r*n,0,r*n,e.height]})}),t.map(function(t,n){return a.a.createElement(Sc.Line,{stroke:cl,strokeWidth:1,points:[0,n*r,e.width,n*r]})}))}n(1666);var ll=400,pl=400,hl="PENCIL",fl="LINE";function dl(e){var t=Object(r.useState)(hl),n=Object(j.a)(t,2),i=(n[0],n[1],Object(r.useState)(void 0)),s=Object(j.a)(i,2),o=s[0],c=s[1],u=Object(r.useState)(void 0),l=Object(j.a)(u,2),p=l[0],h=l[1],f=Object(r.useState)(!1),d=Object(j.a)(f,2),m=d[0],v=d[1],g=Object(r.useState)([]),y=Object(j.a)(g,2),b=y[0],k=y[1],E=Object(r.useState)(fl),O=Object(j.a)(E,2),S=O[0],P=O[1],w=Object(r.useState)([]),T=Object(j.a)(w,2),x=T[0],C=T[1],N=Object(r.useCallback)(function(e){P(e)},[P]),R=Object(r.useCallback)(function(e){if(m)if(S===fl){var t=nl(b,e.evt.layerX,e.evt.layerY),n=t.x,r=t.y,a=Object(D.a)({},o,{x2:n,y2:r});c(a)}else{var i=e.evt.layerX,s=e.evt.layerY;C([].concat(Object(M.a)(x),[{x:i,y:s}]))}},[m,C,x,S,o,c,b]),q=function(t){e.onLinesChanged(t.map(function(e){var t=e.x1,n=e.y1,r=e.x2,a=e.y2,i=e.brightness;return{x1:t/pl,y1:n/ll,x2:r/pl,y2:a/ll,brightness:i}}))},A=Object(r.useCallback)(function(e){if(o){var t=[].concat(Object(M.a)(b),[o]);k(t),q(t)}v(!1),c(void 0)},[k,b,v,o,c]),I=Object(r.useCallback)(function(t){k([]),e.onLinesChanged([])},[k]),L=Object(r.useCallback)(function(e){if(void 0!==p){var t=b.indexOf(p);b.splice(t,1),k(b),h(void 0),q(b)}},[k,p,h]),F=Object(r.useCallback)(function(e){if(p)h(void 0);else{var t=nl(b,e.evt.layerX,e.evt.layerY),n=t.x,r=t.y;c({x1:n,y1:r,x2:n,y2:r}),v(!0)}},[v,c,b,h,p]),B=Object(r.useCallback)(function(e){h(e===p?void 0:e)},[h,p]),H=Object(r.useCallback)(function(e){var t=Object(M.a)(b),n=t.indexOf(p);t[n]=Object(D.a)({},p,e),k(t),h(t[n]),q(t)},[h,b,p,k]),V=Object(r.useCallback)(function(e,t,n){var r=Object(D.a)({},e);t===e.x1&&n===e.y1&&(r={x1:r.x2,y1:r.y2,x2:r.x1,y2:r.y1});var a=b.indexOf(e);b.splice(a,1),k(b),c(r),v(!0)},[k,c,b,v]);return Object(r.useEffect)(function(){k(e.lines.map(function(e){var t=e.x1,n=e.y1,r=e.x2,a=e.y2,i=e.brightness;return{x1:pl*t,y1:ll*n,x2:pl*r,y2:ll*a,brightness:i}}))},[e.lines,k]),a.a.createElement("div",{className:"draw-component"},a.a.createElement(Sc.Stage,{onMouseDown:F,onMouseMove:R,onMouseLeave:function(){return v(!1)},onMouseUp:A,width:pl,height:ll},a.a.createElement(Sc.Layer,null,a.a.createElement(Sc.Rect,{x:0,y:0,width:pl,height:ll,fill:"black"}),a.a.createElement(ul,{width:pl,height:ll}),x.map(function(e){return a.a.createElement(Sc.Circle,{x:e.x,y:e.y,radius:5,fill:"red"})}),a.a.createElement(vl,{currentLine:o}),b.map(function(e){return a.a.createElement(ol,{onClickPoint:function(t,n){return V(e,t,n)},isSelected:p===e,onClickLine:function(){return B(e)},line:e})}))),a.a.createElement("div",{className:"draw-toolbar"},a.a.createElement(ml,{name:"Line",isSelected:S===fl,onClick:function(){return N(fl)}}),a.a.createElement(ml,{name:"Pencil",isSelected:S===hl,onClick:function(){return N(hl)}}),a.a.createElement("div",{className:"option",onClick:I},"Clear"),a.a.createElement("div",{className:"option",onClick:L},"Delete")),a.a.createElement(el,{line:p,onChangeValue:H}))}function ml(e){var t="option";return e.isSelected&&(t+=" selected"),a.a.createElement("div",{onClick:e.onClick,className:t},e.name)}function vl(e){if(e.currentLine){var t=e.currentLine;return a.a.createElement(Sc.Line,{strokeWidth:2,stroke:"red",points:[t.x1,t.y1,t.x2,t.y2]})}return a.a.createElement(Sc.Circle,{x:0,y:0,radius:1,fill:"black"})}function gl(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var yl=function(e){Object(u.a)(n,e);var t=gl(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"render",value:function(){var e=this;return a.a.createElement("div",null,a.a.createElement(Wc,{condition:this.isEnabled()},a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(dl,{lines:this.props.effect.rawLines,onLinesChanged:function(t){return e.props.effect.linesParameter.set(t)}})))}}]),n}(r.Component),bl=Object(g.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(O.U)(t))}}})(yl);function kl(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var El=function(e){Object(u.a)(n,e);var t=kl(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"render",value:function(){var e=this;return"Arpeggiator"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(vu,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Parameterizer"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(bu,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Every"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(Xu,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Timing"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(Su,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Midi Outputter"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(Ru,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Midi Interface"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(Au,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Harmony"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(Fu,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Alternate Tuning"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(Uu,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Warp"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(ju,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Midi Delay"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(zu,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Chord Rhythm"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),a.a.createElement($u,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Chord Sculptor"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(bl,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Tidal"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(Cu,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):void 0}}]),n}(r.Component),Ol=Object(g.b)(function(e,t){return{isMacroMapping:e.effects.isMacroMapping}},function(e){return{setIsMacroMapping:function(t){return e(Object(O.Bb)(t))}}})(function(e){e.track;var t=e.isMacroMapping,n=e.setIsMacroMapping,r="macro-map-button";return t&&(r+=" mapping"),a.a.createElement("div",{onClick:function(){return n(!t)},className:r},"Map")});function Sl(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Pl=function(e){Object(u.a)(n,e);var t=Sl(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={effect:e.effect},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"handleModeChange",value:function(e){this.state.effect.mode=e.value,this.setState(this.state)}},{key:"handleFactorChange",value:function(e){this.state.effect.rollFactor=e.value,this.setState(this.state)}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){var e,t=this;void 0!==this.props.automation||this.state.effect.isEnabled();return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement("div",{className:"lfo-rate-dropdown roll-factor"},a.a.createElement("div",{className:"lfo-rate-label"},"Mode:"),a.a.createElement(Vc.a,{className:"osc-type-dropdown roll-factor-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:Tl,onChange:function(e){return t.handleModeChange(e)},value:(e=this.state.effect.mode,Tl.filter(function(t){return t.value===e})[0]),placeholder:"Rate"}),a.a.createElement("div",{className:"clear-fix"})),a.a.createElement("div",{className:"lfo-rate-dropdown roll-factor"},a.a.createElement("div",{className:"lfo-rate-label"},"Roll Factor:"),a.a.createElement(Vc.a,{className:"osc-type-dropdown roll-factor-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:wl,onChange:function(e){return t.handleFactorChange(e)},value:jl(this.state.effect.rollFactor),placeholder:"Rate"}),a.a.createElement("div",{className:"clear-fix"}))):"")}}]),n}(r.Component),wl=[{value:.125,label:"1/8"},{value:.25,label:"1/4"},{value:.5,label:"1/2"},{value:1,label:"1"},{value:2,label:"2"},{value:4,label:"4"},{value:8,label:"8"}];function jl(e){return wl.filter(function(t){return t.value===e})[0]}var Tl=[{value:Ai,label:"Sync"},{value:Ii,label:"On"},{value:Mi,label:"Off"}];var xl=Pl,Cl=function(e,t,n){return Math.max(e,Math.min(t,n))},Nl=function(e,t){var n,r;return e.some(function(e){var a=Math.abs(t-e);if(a>=r)return!0;n=e,r=a}),n},Rl=function(e){var t=e.min,n=e.max;return(e.value-t)/(n-t)},Dl={37:-1,38:1,39:1,40:-1},ql=function(e){return function(t){return e(Object(D.a)({},t,{type:"START"}))}},Ml=function(e){return function(t){var n=Dl[t.keyCode];n&&(t.preventDefault(),e({type:"STEPS",direction:n}))}},Al=function(e,t){return document.body.addEventListener(e,t)},Il=function(e,t){return document.body.removeEventListener(e,t)},Ll=function(e){return Object(D.a)({},e,{isActive:!0},function(e){var t=e.container,n=e.size;return{startX:Math.floor(t.current.offsetLeft)+n/2,startY:Math.floor(t.current.offsetTop)+n/2}}(e))},Fl=function(e){var t=e.state,n=e.action,r=e.onChange,a=function(e){var t=e.startX,n=e.startY,r=e.scrollContainer,a=(e.size,e.pageX),i=e.pageY,s=e.angleOffset,o=e.angleRange,c=t-(r?r.current.scrollLeft:0)-a,u=n-(r?r.current.scrollTop:0)-i,l=180*Math.atan2(-u,-c)/Math.PI+90-s,p=l<0?l+360:l%360;return p<=o?Cl(0,1,p/o):+(p-o<(360-o)/2)}(Object(D.a)({},t,n)),i=function(e){var t=e.min;return t+(e.max-t)*e.percentage}(Object(D.a)({},t,{percentage:a}));return r(i),Object(D.a)({},t,{percentage:a,value:i})},Bl=function(e){return function(t,n){switch(n.type){case"START":return Ll(t);case"SCROLL_CONTAINER":return function(e,t){return Object(D.a)({},e,{scrollContainer:t.scrollContainer})}(t,n);case"MOVE":return Fl({state:t,action:n,onChange:e});case"STEPS":return function(e){var t=e.state,n=e.action,r=(e.onChange,Cl(t.min,t.max,t.value+1*n.direction));return Object(D.a)({},t,{value:r,percentage:Rl(Object(D.a)({},t,{value:r}))})}({state:t,action:n,onChange:e});default:return Object(D.a)({},t,{isActive:!1,value:t.value})}}},Hl=function(e){var t=e.min,n=e.max,a=e.initialValue,i=e.angleOffset,s=void 0===i?0:i,o=e.scrollContainer,c=e.angleRange,u=void 0===c?360:c,l=e.size,p=e.steps,h=(e.snap,e.onChange),f=Object(r.useRef)(),d=Object(r.useRef)(),m=Object(r.useReducer)(Bl(h),{isActive:!1,min:t,max:n,angleOffset:s,angleRange:u,percentage:void 0!==a?(a-t)/(n-t):0,value:a||0,svg:f,container:d,size:l}),v=Object(j.a)(m,2),g=v[0],y=g.percentage,b=g.value,k=g.angle,E=g.isActive,O=v[1];return Object(r.useEffect)(function(e){var t=e.dispatch,n=e.isActive;e.onChange;return function(){var e=function(e){var n=e.pageX,r=e.pageY;t({pageX:n,pageY:r,type:"MOVE"})},r=function(){return t({type:"STOP"})};if(n)return Al("mousemove",e),Al("mouseup",r),function(){Il("mousemove",e),Il("mouseup",r)}}}({dispatch:O,isActive:E,onChange:h}),[E]),{dispatch:O,svg:f,container:d,percentage:p?Nl(p,y):y,value:b,scrollContainer:o,angle:k,onStart:ql(O),onKeyDown:Ml(O),onScroll:function(e){}}},Vl=function(e,t,n){return{x:e+t*Math.cos(n),y:e+t*Math.sin(n)}},Ul=function(e){return Math.PI*e/180},Jl=function(e){var t=e.percentage,n=e.angleOffset,r=e.angleRange,a=e.arcWidth,i=e.radius,s=e.center,o=r*t,c=n-90,u=i-a,l=Ul(c),p=Ul(c+o),h=o<180?0:1,f=Vl(s,i,p),d=Vl(s,i,l),m=Vl(s,u,l),v=Vl(s,u,p);return"M".concat(f.x,",").concat(f.y," A").concat(i,",").concat(i," 0 ").concat(h," 0 ").concat(d.x,",").concat(d.y,"L").concat(m.x,",").concat(m.y," A").concat(u,",").concat(u," 0 ").concat(h," 1 ").concat(v.x,",").concat(v.y," L").concat(f.x,",").concat(f.y)},_l=Object(r.memo)(function(e){var t=e.color,n=e.background,r=Object(Pc.a)(e,["color","background"]);return a.a.createElement("g",null,n&&a.a.createElement("path",{d:Jl(Object(D.a)({},r,{percentage:1})),style:{fill:n}}),a.a.createElement("path",{d:Jl(r),style:{fill:t}}))}),Gl=Object(r.memo)(function(e){e.children;var t=e.width,n=e.height,r=void 0===n?t:n,i=e.angleOffset,s=e.angleRange,o=e.percentage,c=e.radius,u=e.center,l=e.type,p=e.color,h=e.className;return a.a.createElement("g",{transform:"\n        rotate(".concat(i+s*o," ").concat(u," ").concat(u,")\n        translate( ").concat(u-t/2," ").concat(u-c-r,")\n        ")},"rect"===l&&a.a.createElement("rect",{width:t,height:r,fill:p,className:h}),"circle"===l&&a.a.createElement("circle",{r:t,fill:p,className:h}))}),zl=function(e,t){return e&&t?Array.from({length:e+1},function(t,n){return 1/e*n}):void 0},Wl=function(e){var t,n=e.arcColor,i=e.arcBackground,s=e.arcWidth,o=e.pointerWidth,c=e.pointerHeight,u=e.pointerRadius,l=e.pointerType,p=e.pointerColor,h=e.min,f=e.max,d=e.value,m=e.angleOffset,v=void 0===m?0:m,g=e.angleRange,y=void 0===g?360:g,b=e.size,k=e.onChange,E=void 0===k?function(){}:k,O=(e.children,e.scrollContainer),S=e.steps,P=e.snap,w=void 0!==P&&P,j=e.ariaValueText,T=e.ariaLabelledBy,x=e.className,C=Hl({min:h,scrollContainer:O,max:f,initialValue:d,angleOffset:v,percentage:Rl(d),angleRange:y,size:b,steps:zl(S,w),onChange:E}),N=C.dispatch,R=C.onStart,D=C.svg,q=C.container,M=C.onKeyDown,A=C.onScroll,I=d,L=void 0!==d?(d-h)/(f-h):0;return Object(r.useEffect)(function(){N({scrollContainer:O,type:"SCROLL_CONTAINER"})},[O]),a.a.createElement("div",{ref:q,tabIndex:"0",style:{outline:"none",width:b,height:b},"aria-valuemax":f,"aria-valuemin":h,"aria-valuenow":I,"aria-valuetext":j,"aria-labelledby":T,onKeyDown:M,onWheel:A,className:x},a.a.createElement("svg",{onMouseDown:R,width:b,height:b,ref:D},a.a.createElement(_l,{percentage:L,size:b,value:I,angleOffset:v,angleRange:y,radius:b/2,center:b/2,arcWidth:s,color:n,background:i}),a.a.createElement(Gl,(t={percentage:L,size:b,value:I,angleOffset:v,angleRange:y,radius:u,height:c,width:o,center:b/2},Object(An.a)(t,"width",o),Object(An.a)(t,"type",l),Object(An.a)(t,"color",p),t))))},Kl=Object(g.b)(function(e,t){return{value:t.parameter.get()}},null)(function(e){var t=e.sequencerEngine,n=e.parameter,i=e.value,s=e.color,o=e.name,c=e.min,u=e.max,l=e.step,p=e.scrollContainer,h=Object(r.useCallback)(function(e){document.activeElement.blur(),t.operationManager.dispatch(yt(n,e))},[n]),f="";return(o||n.context.macro)&&(f=o||n.context.macro.name),a.a.createElement("div",{className:"parameter-knob"},a.a.createElement(Wl,{scrollContainer:p,size:50,angleOffset:220,angleRange:280,value:i,initialValue:i,step:l||1,min:c||n.min,max:u||n.max,onChange:h,arcWidth:3,arcColor:s||"white",arcBackground:"rgb(99, 99, 99)",pointerWidth:3,pointerHeight:15,pointerRadius:10,pointerType:"rect",pointerColor:s||"white"}),a.a.createElement("div",{className:"parameter-name"},f))}),Ql=new wt.a,Xl=Object(g.b)(function(e){return{isMacroMapping:e.effects.isMacroMapping,parameterToMap:e.effects.isMacroMapping&&e.effects.parameterToMap}},function(e){return{setIsMacroMapping:function(t){return e(Object(O.Bb)(t))}}})(function(e){var t=e.macro,n=e.parameterToMap,i=e.isMacroMapping,s=e.setIsMacroMapping,o=e.scrollContainer,c=t.macroParameter,u=t.name,l=Object(r.useState)(n&&t.isParameterMapped(n)),p=Object(j.a)(l,2),h=p[0],f=p[1];Object(r.useEffect)(function(){f(!!n&&t.isParameterMapped(n))},[n,f]);var d=Object(r.useCallback)(function(){i&&n&&(h?t.unmapParameter(n):t.addParameter(n),f(!h),s(!1),s(!0))},[n,f,h,i]);return a.a.createElement("div",{className:"macro-knob"},a.a.createElement("div",{className:"macro-name"},u),a.a.createElement(Kl,{scrollContainer:o,color:Ql.getColorForHash(t.id),parameter:c}),i?a.a.createElement("div",{onClick:d,className:"map-button"},h?"Unmap":"Map"):"")}),Yl=(n(755),function(e){var t=e.effect,n=e.scrollContainer;return t.isEnabled()?a.a.createElement("div",{className:"macros-container"},t.macros.map(function(e){return a.a.createElement(Xl,{scrollContainer:n,macro:e})})):a.a.createElement("div",null)});function Zl(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var $l=function(e){Object(u.a)(n,e);var t=Zl(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"getEffectChild",value:function(){switch(this.props.effect.effect){case Di:return a.a.createElement(xl,this.props);case qi:return a.a.createElement(Yl,this.props);default:return""}}},{key:"getMacroMapButton",value:function(){return a.a.createElement(Ol,null)}},{key:"render",value:function(){var e=this;return a.a.createElement(Xc,{onDeleteEffect:this.props.onDeleteEffect,isDraggable:!1,sequencerEngine:this.props.sequencerEngine,isMidiEffect:!0,alternateButton:this.props.effect.effect===qi?this.getMacroMapButton():void 0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation},this.getEffectChild())}}]),n}(r.Component),ep=300,tp=250;function np(e){var t=Object(r.useState)([]),n=Object(j.a)(t,2),i=n[0],s=(n[1],void 0!==e.automation||e.effect.isEnabled());void 0!==e.automation||e.effect.isEnabled();if(!s)return a.a.createElement("div",null);return a.a.createElement("div",null,a.a.createElement(Sc.Stage,{width:tp,height:ep},a.a.createElement(Sc.Layer,null,i.map(function(e,t){return function(e,t){e*=2;var n=Math.floor(tp*t/512),r=void 0,a=void 0;return e<0?(r=ep/2,a=Math.abs(e)*ep/2):(r=ep/2-e*ep/2,a=e*ep/2),{x:n,y:r,height:a,width:3}}(e,t)}).map(function(e){return a.a.createElement(Sc.Rect,{x:e.x,y:e.y,width:e.width,height:e.height,fill:"red"})}))))}function rp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ap=function(e){Object(u.a)(n,e);var t=rp(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"handleSendVolumeChange",value:function(e){-40===e&&(e=-100),this.props.track.setSendVolume(this.props.sendNumber,e)}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"render",value:function(){var e=this,t=0===this.props.sendNumber?"TRACK_SEND_A_SLIDER":"TRACK_SEND_B_SLIDER";return console.log("send contextual help = "+t),a.a.createElement("div",{onMouseOver:function(n){return e.setContextualHelp(n,t)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"enabled effect"},a.a.createElement("div",{className:"effect-name"},this.props.send.getName()),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(xt.a,{value:this.props.volume,change:function(t){return e.handleSendVolumeChange(t.target.value)},step:.1,max:3,min:-40,orientation:"vertical",reversed:!0}))}}]),n}(r.Component),ip=Object(g.b)(function(e,t){var n=void 0===t.track?void 0:e.tracks.trackSendVolumes[t.track.trackNumber];return{volume:void 0!==n?n[t.sendNumber]:t.sendNode&&t.sendNode.volume?t.sendNode.volume.value:0,isRecordingMix:e.mix.isRecordingMix,isRecording:e.sequencer.isRecording}},function(e){return{setContextualHelp:function(t){return e(Object(O.U)(t))},setTrackSendVolume:function(t,n,r){return e(Object(O.Rd)(t,n,r))}}})(ap),sp="SAMPLED_INSTRUMENT",op="SYNTH",cp="MULTI_SYNTH",up="FM_SYNTH",lp="METAL_SYNTH";function pp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var hp=function(e){Object(u.a)(n,e);var t=pp(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"lock-button-container"},a.a.createElement("img",{onMouseOver:function(t){return e.setContextualHelp(t,e.props.contextualHelp||"TRACK_LOCK_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.props.toggleLock()},className:"lock-button",src:this.props.patternLocked?"/closed-padlock.png":"/opened-padlock.png"}))}}]),n}(r.Component),fp=Object(g.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(O.U)(t))}}})(hp),dp=function(e){return e===Qi?"Master":"Sends Only"},mp=Object(g.b)(function(e,t){return{outputType:t.track.outputTypeParameter.get()}},null)(function(e){var t=e.track,n=e.outputType,i=Object(r.useCallback)(function(e){var n=e.value;t.outputTypeParameter.set(n)},[]),s=[{value:Qi,label:"Master"},{value:"SENDS_ONLY",label:"Sends Only"}],o={value:n,label:dp(n)};return a.a.createElement("div",{className:"track-output-type"},a.a.createElement("div",null,"Audio To"),a.a.createElement(Vc.a,{className:"osc-type-dropdown float-left",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:s,onChange:i,value:o,placeholder:"Audio To"}))});function vp(e){var t=e.sequencerEngine.resampleConfig,n=Object(r.useState)(t.samplesPerNote),i=Object(j.a)(n,2),s=(i[0],i[1]),o={label:t.samplesPerNote,value:t.samplesPerNote},c=Object(r.useCallback)(function(e){t.samplesPerNote=e,s(e)},[s]);return a.a.createElement("div",{className:"samples-per-note"},a.a.createElement("div",{className:"dropdown-label"},"Samples Per Note:"),a.a.createElement(Vc.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=[],n=1;n<=e;n++)t.push({label:n,value:n});return t}(),onChange:function(e){return c(e.value)},value:o,placeholder:"Samples per note"}))}function gp(e){var t=Object(r.useState)(e.sequencerEngine.autoResampleMode),n=Object(j.a)(t,2),i=n[0],s=n[1],o=Object(r.useCallback)(function(){var t=e.sequencerEngine;if(i)return t.autoResampleMode=!1,t.store.dispatch(Object(O.rc)(!1)),void s(!1);t.autoResampleMode=!0,t.masterResampler.prepare(),t.store.dispatch(Object(O.rc)(!0)),s(!0)},[i,s]),c=i?"sample-synth-button sampling":"sample-synth-button";return a.a.createElement("div",{className:"resample-config"},a.a.createElement("div",{onClick:o,className:c},i?"SAMPLING SYNTH...":"SAMPLE SYNTH"),a.a.createElement(vp,{sequencerEngine:e.sequencerEngine}))}function yp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var bp=function(e){Object(u.a)(n,e);var t=yp(n);function n(e){var r;Object(o.a)(this,n);var a=void 0===(r=t.call(this,e)).props.track.midiChannel?"all":r.props.track.midiChannel;return r.state={midiChannel:a},r}return Object(c.a)(n,[{key:"onSelectMidiChannel",value:function(e){this.state.midiChannel=e.value,this.props.track.midiChannel=e.value,this.setState(this.state)}},{key:"updateLatency",value:function(e){this.props.track.latency=e,this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.props.track.sequencerEngine.midi;return a.a.createElement("div",{className:"instrument external-instrument"},a.a.createElement("div",{className:"midi-channel-container"},a.a.createElement("div",{className:"midi-channel"},"Channel: "),a.a.createElement(Vc.a,{className:"midi-input-dropdown",controlClassName:"midi-input-control-dropdown",options:Ep,onChange:function(t){return e.onSelectMidiChannel(t)},value:Op(this.state.midiChannel),placeholder:"Midi Channel"})),a.a.createElement("div",{className:"midi-outputs-container"},t.getTrackedOutputs().map(function(t){return a.a.createElement(kp,{track:e.props.track,output:t})})),a.a.createElement("div",null,a.a.createElement("div",null,"Latency: ",this.props.track.latency," ms"),a.a.createElement(xt.a,{value:this.props.track.latency,change:function(t){return e.updateLatency(t.target.value)},step:1,max:100,min:1,orientation:"horizontal",reversed:!1})),a.a.createElement(gp,{sequencerEngine:this.props.track.sequencerEngine}))}}]),n}(r.Component),kp=function(e){Object(u.a)(n,e);var t=yp(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"isEnabled",value:function(){return this.props.track.getMidiOutputs().has(this.props.output)}},{key:"onClickMidiOutput",value:function(){this.isEnabled()?this.props.track.deleteMidiOutput(this.props.output):this.props.track.addMidiOutput(this.props.output),this.setState(this.state)}},{key:"render",value:function(){var e=this;this.isEnabled();return a.a.createElement("div",{className:this.isEnabled()?"midi-option enabled":"midi-option",onClick:function(){return e.onClickMidiOutput()}},this.props.output.name)}}]),n}(r.Component),Ep=[{value:"all",label:"All"},{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"},{value:5,label:"5"},{value:6,label:"6"},{value:7,label:"7"},{value:8,label:"8"},{value:9,label:"9"},{value:10,label:"10"},{value:11,label:"11"},{value:12,label:"12"}];function Op(e){for(var t=0;t<Ep.length;t++)if(Ep[t].value==e)return Ep[t];return null}var Sp=bp;var Pp=Object(g.b)(function(e,t){var n=0;return t.track&&(n=t.track.chainNumber),{chainNumber:n}},function(e,t){return{setEffectsChainToShow:function(t,n,r){return e(Object(O.jb)(t,n,r))}}})(function(e){if(void 0===e.track)return a.a.createElement("div",null);var t=e.track.effectsChains;return a.a.createElement("div",{className:"effects-chain-chooser"},t.map(function(t,n){return a.a.createElement("div",{onClick:function(){return function(t){e.setEffectsChainToShow(e.track.subSequence.id,e.track.trackNumber,t)}(n)},className:e.chainNumber===n?"effects-chain-btn selected":"effects-chain-btn"},n+1)}),a.a.createElement("div",{className:"new-effects-chain-btn",onClick:function(){e.track.newEffectsChain()}},"+"),a.a.createElement(Wc,{condition:e.track&&e.track.effectsChains.length>1},a.a.createElement("div",{className:"new-effects-chain-btn",onClick:function(){e.track.deleteEffectsChain()}},"-")))}),wp=[{value:"Bit Crusher",label:"Bit Crusher"},{value:"Chebyshev",label:"Chebyshev"},{value:"Chorus",label:"Chorus"},{value:"Compressor",label:"Compressor"},{value:"Convolver Reverb",label:"Convolver Reverb"},{value:"Delay",label:"Delay"},{value:"Distortion",label:"Distortion"},{value:"Effect Rack",label:"Effect Rack"},{value:"EQ8",label:"EQ 8"},{value:"Filter",label:"Filter"},{value:"Gate",label:"Gate"},{value:"Multiband Compressor",label:"Multiband Compressor"},{value:"Oscilloscope",label:"Oscilloscope"},{value:"Panner",label:"Panner"},{value:"Pitch Shift",label:"Pitch Shift"},{value:"Phaser",label:"Phaser"},{value:"Reverb",label:"Reverb"},{value:"Saturator",label:"Saturator"},{value:"Stereo Delay",label:"Stereo Delay"},{value:"Stereo Widener",label:"Stereo Widener"},{value:"Tape Delay",label:"Tape Delay"},{value:"Tremolo",label:"Tremolo"}];function jp(e,t){var n=null;return"Filter"===e?n=new Xn.FilterEffect(t):"Reverb"===e?n=new Xn.ReverbEffect(t):"Convolver Reverb"===e?n=new kr(t):"Delay"===e?n=new Zn(t):"Chorus"===e?n=new Xn.ChorusEffect(t):"Tremolo"===e?n=new Xn.TremoloEffect(t):"Auto Filter"===e?n=new Xn.AutoFilterEffect(t):"Compressor"===e?n=new jr(t):"Multiband Compressor"===e?n=new hr(t):"Distortion"===e?n=new xr(t):"Bit Crusher"===e?n=new Pr(t):"EQ 3"===e?n=new Mr(t):"EQ 10"===e?n=new Lr(t):"Phaser"===e?n=new dr(t):"Auto Wah"===e?n=new er(t):"Gate"===e?n=new Br(t):"Pitch Shift"===e?n=new Nr(t):"Panner"===e?n=new Dr(t):"EQ8"===e?n=new Gr(t):"Chebyshev"===e?n=new Or(t):"Stereo Widener"===e?n=new rr(t):"Saturator"===e?n=new Zr(t):"Tape Delay"===e?n=new ea(t):"Stereo Delay"===e?n=new Ea(t):"Oscilloscope"===e?n=new ir(t):"Effect Rack"===e&&(n=new ba(t)),n.toggle(),n}function Tp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var xp=[{value:"Alternate Tuning",label:"Alternate Tuning"},{value:"Arpeggiator",label:"Arpeggiator"},{value:"Every",label:"Every"},{value:"Harmony",label:"Harmony"},{value:"Midi Delay",label:"Delay"},{value:"Parametizer",label:"Parametizer"},{value:"Tidal",label:"Tidal"},{value:"Timing",label:"Timing"},{value:"Midi Outputter",label:"Midi Outputter"},{value:"Warp",label:"Warp"}];var Cp=[{value:qi,label:"Macro"},{value:Di,label:"Roll"}];var Np=function(e){Object(u.a)(n,e);var t=Tp(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={showOptions:!0},r}return Object(c.a)(n,[{key:"handleChooseLiveEffect",value:function(e){var t=null;e===Di?t=new Fi(this.props.track):e===qi&&(t=new Vi(this.props.track)),this.props.handleChooseLiveEffect(t)}},{key:"handleChooseMidiEffect",value:function(e){var t=null;"Arpeggiator"===e?t=new Fa(this.props.track):"Parametizer"===e?t=new Ua(this.props.track):"Harmony"===e?t=new Ha(this.props.track):"Every"===e?t=new ji(this.props.track):"Timing"===e?t=new _a(this.props.track):"Midi Outputter"===e?t=new za(this.props.track):"Midi Interface"===e?t=new ri(this.props.track):"Alternate Tuning"===e?t=new hi(this.props.track):"Warp"===e?t=new mi(this.props.track):"Midi Delay"===e?t=new ii(this.props.track):"Chord Rhythm"===e?t=new Qa(this.props.track):"Chord Sculptor"===e?t=new Ya(this.props.track):"Tidal"===e&&(t=new Pi(this.props.track)),this.props.handleChooseMidiEffect(t)}},{key:"handleChooseEffect",value:function(e){this.props.send;var t=jp(e,this.props.sequencerEngine);this.props.handleChooseEffect(t)}},{key:"onClickShowOptions",value:function(){this.state.showOptions=!0,this.setState(this.state)}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"render",value:function(){var e=this;if(this.state.showOptions)return a.a.createElement("div",{className:"enabled effect choose-effects"},a.a.createElement("div",{className:"add-effect-type"},a.a.createElement(Vc.a,{className:"delay-time-dropdown",options:wp,onChange:function(t){return e.handleChooseEffect(t.value)},placeholder:"Audio FX"})),a.a.createElement(Wc,{condition:void 0!==this.props.track},a.a.createElement("div",{className:"add-effect-type"},a.a.createElement(Vc.a,{className:"delay-time-dropdown",options:xp,onChange:function(t){return e.handleChooseMidiEffect(t.value)},placeholder:"MIDI FX"})),a.a.createElement(Wc,{condition:!window.installation},a.a.createElement("div",{className:"add-effect-type"},a.a.createElement(Vc.a,{className:"delay-time-dropdown",options:Cp,onChange:function(t){return e.handleChooseLiveEffect(t.value)},placeholder:"Live FX"})))));void 0===this.props.track||this.props.track.effectsChains;return a.a.createElement("div",{className:"effects-chooser-container"},a.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"ADD_EFFECTS_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onClickShowOptions()},className:this.props.addClassName},"+"),a.a.createElement(Wc,{condition:!window.installation},a.a.createElement(Pp,{track:this.props.track})))}}]),n}(r.Component),Rp=Object(g.b)(function(e,t){var n=0;return t.track&&(n=t.track.chainNumber),{chainNumber:n}},function(e,t){return{setContextualHelp:function(t){return e(Object(O.U)(t))},setEffectsChainToShow:function(t,n,r){return e(Object(O.jb)(t,n,r))}}})(Np);function Dp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var qp=function(e){Object(u.a)(n,e);var t=Dp(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props.instrument.getOscillator(this.props.selectedOscillator);this.props.instrument;return e.isInitialized()?a.a.createElement("div",null,a.a.createElement(hu,{sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,instrument:e,name:"Pulse Width",parameter:e.pulseWidthParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:1,step:.01}),a.a.createElement(hu,{sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,name:"Polyphony",parameter:e.polyphonyParameter,onParameterChanged:function(){return[]},isParameter:!0,min:1,max:16,step:1}),a.a.createElement(hu,{sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,name:"Glide",parameter:e.portamentoParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:50,step:.1})):a.a.createElement("div",null)}}]),n}(r.Component);function Mp(e,t){for(var n in e)if(t[n]!==e[n])return!1;for(var r in t)if(t[r]!==e[r])return!1;return!0}var Ap=function(){function e(t){Object(o.a)(this,e),this.filter=t,this.results=void 0}return Object(c.a)(e,[{key:"isEqual",value:function(e){return Mp(this.filter.instrumentTypes,e.filter.instrumentTypes)&&Mp(this.filter.tags,e.filter.tags)}},{key:"getPaginatedResults",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return void 0===this.results?[]:this.results.length>e+t?this.results.slice(e,e+t):this.results.slice(e)}}]),e}(),Ip=d.a.presets;function Lp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Fp=new(function(){function e(){Object(o.a)(this,e),this.queries=[]}return Object(c.a)(e,[{key:"clear",value:function(){this.queries=[]}},{key:"getPaginatedPresets",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r,a,i,s,o,c=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=c.length>2&&void 0!==c[2]?c[2]:10,a=c.length>3&&void 0!==c[3]?c[3]:0,t=Object(D.a)({},t),i=new Ap(t),void 0===(s=this.queries.find(function(e){return e.isEqual(i)}))){e.next=7;break}return e.abrupt("return",s.getPaginatedResults(n,r));case 7:return e.next=9,Ip.getPresets(t,a);case 9:return o=e.sent,i.results=o,this.queries.push(i),e.abrupt("return",i.getPaginatedResults(n,r));case 13:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}()),Bp=function(e){Object(u.a)(n,e);var t=Lp(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={presets:[],start:0,loading:!1,loadingCounter:0,probability:.5,crossbreedEffects:!0},r.getPresets(),r.onClickNext=r.onClickNext.bind(Object(W.a)(r)),r.onClickPrevious=r.onClickPrevious.bind(Object(W.a)(r)),r}return Object(c.a)(n,[{key:"onClickNext",value:function(){this.state.start=this.state.start+10,this.getPresets()}},{key:"onClickPrevious",value:function(){this.state.start=Math.max(0,this.state.start-10),this.getPresets()}},{key:"startLoading",value:function(){var e=this;this.setState({loading:!0}),this.loadingTimer=setInterval(function(){e.setState({loadingCounter:(e.state.loadingCounter+1)%5})},200)}},{key:"stopLoading",value:function(){this.setState({loading:!1}),clearInterval(this.loadingTimer)}},{key:"getPresets",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t={instrumentTypes:{},tags:{}}).instrumentTypes[this.props.track.instrument.getInstrumentType()]=!0,e.next=4,Fp.getPaginatedPresets(t,this.state.start);case 4:n=e.sent,this.setState({presets:n});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onUpdateProbability",value:function(e){this.setState({probability:e/100})}},{key:"onClickPreset",value:function(){var e=Object(R.a)(N.a.mark(function e(t){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.startLoading(),e.next=3,this.props.track.mateWithPreset(t,this.state.probability,this.state.crossbreedEffects);case 3:this.stopLoading();case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getEffectsClassName",value:function(e){return this.state.crossbreedEffects===e?"crossbreed-option enabled":"crossbreed-option"}},{key:"onClickEffects",value:function(e){this.setState({crossbreedEffects:e})}},{key:"render",value:function(){for(var e=this,t="",n=0;n<this.state.loadingCounter;n++)t+=".";return a.a.createElement("div",{className:"fm-genetix"},a.a.createElement("div",{onClick:this.props.onClickBack,className:"back-button"},"Back"),a.a.createElement(Wc,{condition:this.state.loading},a.a.createElement("div",{className:"loading-spinner"},"Loading ",t," ")),a.a.createElement(Wc,{condition:!this.state.loading},a.a.createElement("div",{className:"crossbreed-options"},a.a.createElement("div",null,a.a.createElement("div",{className:"crossbreed-probability"},"Crossbreed Preset: ",100*this.state.probability,"%"),a.a.createElement(xt.a,{value:100*this.state.probability,change:function(t){return e.onUpdateProbability(t.target.value)},step:.01,max:100,min:0,orientation:"horizontal",reversed:!1})),a.a.createElement("div",null,"Crossbreed Effects:",a.a.createElement("span",{onClick:function(){return e.onClickEffects(!0)},className:this.getEffectsClassName(!0)},"Yes"),a.a.createElement("span",{onClick:function(){return e.onClickEffects(!1)},className:this.getEffectsClassName(!1)},"No"))),a.a.createElement("div",{className:"presets"},this.state.presets.map(function(t,n){return a.a.createElement("div",{onClick:function(){return e.onClickPreset(t)},className:n%2===0?"preset":"preset odd"},t.title)})),a.a.createElement("div",{className:"pagination-buttons"},a.a.createElement(Wc,{condition:this.state.start>0},a.a.createElement("div",{onClick:this.onClickPrevious,className:"pagination-button"},"PREVIOUS")),a.a.createElement("div",{onClick:this.onClickNext,className:"pagination-button"},"NEXT"))))}}]),n}(r.Component),Hp=[{value:function(){return"128m"},label:"128"},{value:function(){return"64m"},label:"64"},{value:function(){return"32m"},label:"32"},{value:function(){return"16m"},label:"16"},{value:function(){return"8m"},label:"8"},{value:function(){return"4m"},label:"4"},{value:function(){return"2m"},label:"2"},{value:function(){return"1m"},label:"1"},{value:function(){return"2n"},label:"1/2"},{value:function(){return"4n"},label:"1/4"},{value:function(){return"4n."},label:"1/4."},{value:function(){return"4t"},label:"1/4t"},{value:function(){return"8n"},label:"1/8"},{value:function(){return"8n."},label:"1/8."},{value:function(){return"8t"},label:"1/8t"},{value:function(){return"16n"},label:"1/16"},{value:function(){return"16t"},label:"1/16t"},{value:function(){return"32n"},label:"1/32"}];function Vp(e){e="function"===typeof e?e():e;var t=Hp.filter(function(t){return t.value()===e});return 0==t.length?Hp[0]:t[0]}function Up(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Jp=function(e){Object(u.a)(n,e);var t=Up(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"onSelectLFOTime",value:function(e){this.props.lfo.lfoRate=e.value()}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"lfo-rate-dropdown"},a.a.createElement("div",{className:"lfo-rate-label"},"Rate:"),a.a.createElement(Vc.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:Hp,onChange:function(t){return e.onSelectLFOTime(t)},value:Vp(this.props.lfo.lfoRate),placeholder:"LFO"}),a.a.createElement("div",{className:"clear-fix"}))}}]),n}(r.Component),_p=[{value:"square",label:"Square"},{value:"sine",label:"Sine"},{value:"triangle",label:"Triangle"},{value:"sawtooth",label:"Sawtooth"}];function Gp(e){for(var t=0;t<_p.length;t++)if(_p[t].value===e)return _p[t];return null}function zp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Wp=function(e){Object(u.a)(n,e);var t=zp(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"onSelectLFOShape",value:function(e){this.props.lfo.lfoType=e.value}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"osc-type-dropdown-container"},a.a.createElement(Vc.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:_p,onChange:function(t){return e.onSelectLFOShape(t)},value:Gp(this.props.lfo.lfoType),placeholder:"LFO"}),a.a.createElement("div",{className:"clear-fix"}))}}]),n}(r.Component);n(282);function Kp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Qp=function(e){Object(u.a)(n,e);var t=Kp(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={selectedLFO:0},r}return Object(c.a)(n,[{key:"getLFOOptions",value:function(){return[{value:0,label:"LFO 1"},{value:1,label:"LFO 2"},{value:2,label:"LFO 3"},{value:3,label:"LFO 4"}]}},{key:"getLFOOption",value:function(e){for(var t=this.getLFOOptions(),n=0;n<t.length;n++)if(t[n].value==e)return t[n];return null}},{key:"onSelectLFO",value:function(e){this.setState({selectedLFO:e.value})}},{key:"onChangeSynced",value:function(e){this.getLFO().isSynced="unsynced"===e,this.setState(this.state)}},{key:"getLFO",value:function(){return this.props.instrument.lfos[this.state.selectedLFO]}},{key:"render",value:function(){var e=this,t=this.getLFO();return a.a.createElement("div",{className:"instrument-subsection"},a.a.createElement("div",{className:"instrument-subsection-name lfo-subsection-name colored-lfo-name-"+this.state.selectedLFO},"LFO"),a.a.createElement("div",{className:"osc-type-dropdown-container"},a.a.createElement(Vc.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.getLFOOptions(),onChange:function(t){return e.onSelectLFO(t)},value:this.getLFOOption(this.state.selectedLFO),placeholder:"LFO"})),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(Wp,{lfo:t}),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement("div",{className:"refined-checkbox-preferences"},a.a.createElement("label",null,a.a.createElement("input",{type:"checkbox",value:t.isSynced?"synced":"unsynced",checked:t.isSynced,onChange:function(t){return e.onChangeSynced(t.target.value)}}),"Synced")),t.isSynced?a.a.createElement(Jp,{lfo:t}):a.a.createElement(hu,{effectNumber:0,name:"Rate",parameter:t.lfoRateParameter,onParameterChanged:function(){return[]},isParameter:!0,step:.1,min:0,max:32}),a.a.createElement(hu,{effectNumber:0,name:"Min",parameter:t.lfoMinParameter,onParameterChanged:function(){return[]},isParameter:!0,min:-100,max:100,step:1}),a.a.createElement(hu,{effectNumber:0,name:"Max",parameter:t.lfoMaxParameter,onParameterChanged:function(){return[]},isParameter:!0,min:-100,max:100,step:1}))}}]),n}(r.Component);function Xp(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Yp=function(e){Object(u.a)(n,e);var t=Xp(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"enableOscillator",value:function(){this.props.sequencerEngine.operationManager.dispatch(yt(this.props.oscillator.enabledParameter,!0)),this.setState(this.state)}},{key:"disableOscillator",value:function(){this.props.sequencerEngine.operationManager.dispatch(yt(this.props.oscillator.enabledParameter,!1)),this.setState(this.state)}},{key:"onClick",value:function(){this.props.oscillator.enabled?this.props.selectedOscillator===this.props.number?this.disableOscillator():this.props.onChooseOscillator(this.props.number):(this.enableOscillator(),this.props.onChooseOscillator(this.props.number))}},{key:"render",value:function(){var e=this,t=this.props.number===this.props.selectedOscillator?"oscillator-option selected":"oscillator-option";return this.props.enabled||(t+=" disabled"),a.a.createElement("div",{onClick:function(){return e.onClick()},className:t},this.props.number+1)}}]),n}(r.Component),Zp=Object(g.b)(function(e,t){var n=t.oscillator.enabledParameter;return{enabled:e.effects.effectParameters[n.id]}},null)(Yp);function $p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var eh=function(e){Object(u.a)(n,e);var t=$p(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props.oscillator,t=e.partials;return a.a.createElement("div",{className:"harmonics-editor"},"Harmonics Editor",t.slice(0,16).map(function(t,n){return a.a.createElement(th,{oscillator:e,i:n})}))}}]),n}(r.Component),th=function(e){Object(u.a)(n,e);var t=$p(n);function n(e){var r;Object(o.a)(this,n);var a=(r=t.call(this,e)).props.oscillator.partials[r.props.i];return r.state={value:a},r}return Object(c.a)(n,[{key:"onChange",value:function(e){var t=Object(M.a)(this.props.oscillator.partials);t[this.props.i]=e,this.props.oscillator.partials=t,this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.props.oscillator.partials[this.props.i];return a.a.createElement("div",{className:"partial-editor"},a.a.createElement("div",{className:"partial-number"},this.props.i+1),a.a.createElement(xt.a,{value:t,change:function(t){return e.onChange(t.target.value)},step:.01,max:8,min:0,orientation:"horizontal",reversed:!1}))}}]),n}(r.Component),nh=eh;function rh(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ah=function(e){Object(u.a)(n,e);var t=rh(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={showHarmonics:!1},r}return Object(c.a)(n,[{key:"showHarmonics",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.setState({showHarmonics:e})}},{key:"getSelectedOscillatorType",value:function(){return this.props.oscillator.oscillatorType}},{key:"onSelectOscillatorType",value:function(e){var t="none"===e.value?void 0:e.value;this.props.sequencerEngine.operationManager.dispatch(yt(this.props.oscillator.oscillatorTypeParameter,t)),this.setState(this.state)}},{key:"render",value:function(){var e,t=this,n=this.props.oscillator,r=this.props.instrument;return n.isInitialized()?this.state.showHarmonics&&"custom"===n.oscillatorType?a.a.createElement("div",{className:"oscillator-component"},a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(nh,{oscillator:n}),a.a.createElement("div",{onClick:function(){return t.showHarmonics(!1)},className:"harmonics-button"},"Done Editing")):a.a.createElement("div",{className:"oscillator-component"},a.a.createElement("div",{className:"osc-type-dropdown-container"},a.a.createElement(Vc.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:ih,onChange:function(e){return t.onSelectOscillatorType(e)},value:(e=this.getSelectedOscillatorType(),ih.filter(function(t){return t.value===e})[0]),placeholder:"Osc. Type"})),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(hu,{automation:this.props.automation,name:"Volume",parameter:n.oscillatorLevelParameter,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,isParameter:!0,min:0,max:1,step:.01}),a.a.createElement(hu,{automation:this.props.automation,name:"Frequency",sequencerEngine:this.props.sequencerEngine,parameter:n.oscillatorFrequencyParameter,onParameterChanged:function(){return r.releaseAll()},displayFunction:function(e){return _i.a.fromTranspose(e).toString()},isParameter:!0,min:-32,max:32,step:1}),a.a.createElement(hu,{automation:this.props.automation,name:"Detune",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:n.detuneParameter,onParameterChanged:function(){return[]},isParameter:!0,min:-100,max:100,step:1}),a.a.createElement(Wc,{condition:"custom"===n.oscillatorType},a.a.createElement("div",{onClick:function(){return t.showHarmonics()},className:"harmonics-button"},"Edit Harmonics"))):a.a.createElement("div",null)}}]),n}(r.Component),ih=[{value:"square",label:"Square"},{value:"sine",label:"Sine"},{value:"triangle",label:"Triangle"},{value:"sawtooth",label:"Sawtooth"},{value:"pwm",label:"PWM"},{value:"pulse",label:"Pulse"},{value:"custom",label:"Custom"}];var sh=Object(g.b)(function(e,t){return{type:t.oscillator.oscillatorType}},null)(ah);function oh(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ch=function(e){Object(u.a)(n,e);var t=oh(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"render",value:function(){var e=this,t=this.props.instrument,n=this.props.instrument.getOscillator(this.props.selectedOscillator);return a.a.createElement("div",{className:"oscillators-component"},a.a.createElement("div",{className:"oscillator-subsection-header"},a.a.createElement("div",{className:"instrument-subsection-name"},"Oscillator"),a.a.createElement("div",{className:"oscillator-options"},a.a.createElement(Zp,{sequencerEngine:this.props.sequencerEngine,selectedOscillator:this.props.selectedOscillator,oscillator:t.getOscillator(0),number:0,onChooseOscillator:function(t){return e.props.onChooseOscillator(t)}}),a.a.createElement(Zp,{sequencerEngine:this.props.sequencerEngine,selectedOscillator:this.props.selectedOscillator,oscillator:t.getOscillator(1),number:1,onChooseOscillator:function(t){return e.props.onChooseOscillator(t)}}),a.a.createElement(Zp,{sequencerEngine:this.props.sequencerEngine,selectedOscillator:this.props.selectedOscillator,oscillator:t.getOscillator(2),number:2,onChooseOscillator:function(t){return e.props.onChooseOscillator(t)}}),a.a.createElement(Zp,{sequencerEngine:this.props.sequencerEngine,selectedOscillator:this.props.selectedOscillator,oscillator:t.getOscillator(3),number:3,onChooseOscillator:function(t){return e.props.onChooseOscillator(t)}}))),a.a.createElement(sh,{sequencerEngine:this.props.sequencerEngine,oscillator:n,instrument:t}))}}]),n}(r.Component);function uh(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}r.Component;var lh=n(43);function ph(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var hh=function(e){Object(u.a)(n,e);var t=ph(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={updateRate:100,x:0,y:0},r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.run()}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"run",value:function(){var e=this;this.timer=setInterval(function(){e.setState(e.state)},this.state.updateRate)}},{key:"startDragging",value:function(e){this.setState({dragging:e}),this.props.setSelectedPoint(e)}},{key:"stopDragging",value:function(e){this.setState({dragging:void 0})}},{key:"onMouseMove",value:function(e){var t=this.ref.getPointerPosition(),n=t.x,r=t.y;if(this.setState({x:n,y:r}),void 0!==this.state.dragging){var a=this.getTimeForXPosition(n,this.state.dragging);"ATTACK"===this.state.dragging?(this.props.envelope.attack=a,this.props.envelope.level=this.getLevelForYPosition(r)):"DECAY"===this.state.dragging?(this.props.envelope.decay=a,this.props.envelope.sustain=this.getSustainForYPosition(r)):"SUSTAIN"===this.state.dragging?this.props.envelope.sustain=this.getSustainForYPosition(r):"RELEASE"===this.state.dragging&&(this.props.envelope.release=a),this.props.onEnvelopeUpdated()}}},{key:"getGuideLines",value:function(){for(var e=[],t=0,n=0;n<=20;n++)e.push(a.a.createElement(Sc.Line,{points:[t,0,t,400],stroke:"#1f1f1f",strokeWidth:1})),t+=32.5;e.push(a.a.createElement(Sc.Line,{points:[0,100,650,100],stroke:"#1f1f1f",strokeWidth:1})),e.push(a.a.createElement(Sc.Line,{points:[0,300,650,300],stroke:"#1f1f1f",strokeWidth:1})),t=32.5;for(var r=this.props.zoom,i=0;i<20;i+=2)e.push(a.a.createElement(Sc.Text,{text:r+" ms",fill:"white",fontSize:6,fontFamily:"Arial",x:t+2,y:390})),t+=65,r+=2*this.props.zoom;return e}},{key:"getAttackCurve",value:function(){var e=this.getXPositionForTime(this.props.envelope.attack),t=this.getYForLevel();if("linear"===this.attackCurve)return a.a.createElement(Sc.Line,{points:[0,200,e,t],strokeWidth:2,stroke:"#6200EE"});if("exponential"===this.attackCurve)return this.getExponentialCurve(0,200,e,t,!0);var n=x.a.Envelope.Type[this.attackCurve];return this.getExplicitCurve(n.In,0,200,e,t,!1)}},{key:"getExplicitCurve",value:function(e,t,n,r,i,s){for(var o=(r-t)/e.length,c=[],u=0;u<e.length;u++){var l=s?this.getYForSustain(e[u]*this.props.envelope.sustain):this.getYForLevel(e[u]*this.level);c.push(t),c.push(l),t+=o}return a.a.createElement(Sc.Line,{points:c,strokeWidth:2,stroke:"#6200EE"})}},{key:"getDecayCurve",value:function(){if("linear"===this.decayCurve)return a.a.createElement(Sc.Line,{points:[this.attackX,this.getYForLevel(),this.decayX,this.sustainY],strokeWidth:2,stroke:"#6200EE"});if("exponential"===this.decayCurve)return this.getExponentialCurve(this.attackX,this.getYForLevel(),this.decayX,this.sustainY);var e=x.a.Envelope.Type[this.decayCurve];return this.getExplicitCurve(e.Out,this.attackX,this.getYForLevel(),this.decayX,this.sustainY)}},{key:"getSustainCurve",value:function(){return a.a.createElement(Sc.Line,{points:[this.decayX,this.sustainY,this.sustainX,this.sustainY],strokeWidth:2,stroke:"#6200EE"})}},{key:"getReleaseCurve",value:function(){if("linear"===this.releaseCurve)return a.a.createElement(Sc.Line,{points:[this.sustainX,this.sustainY,this.releaseX,200],strokeWidth:2,stroke:"#6200EE"});if("exponential"===this.releaseCurve)return this.getExponentialCurve(this.sustainX,this.sustainY,this.releaseX,200);var e=x.a.Envelope.Type[this.releaseCurve];return this.getExplicitCurve(e.Out,this.sustainX,this.sustainY,this.releaseX,200,!0)}},{key:"getExponentialCurve",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=(2*e+n)/3;i&&(s=(4*n+e)/5);var o=((t+r)/2+r)/2;return i&&(o=(t+r)/2),a.a.createElement(Sc.Line,{points:[e,t,s,o,n,r],tension:.3,strokeWidth:2,stroke:"#6200EE"})}},{key:"getAttackPoint",value:function(){var e=this,t="ATTACK"===this.props.selectedPoint?"yellow":"black";return a.a.createElement(Sc.Circle,{onMouseDown:function(t){return e.startDragging("ATTACK")},onMouseUp:function(t){return e.stopDragging("ATTACK")},x:this.attackX,y:this.getYForLevel(),radius:5,stroke:"yellow",fill:t})}},{key:"getDecayPoint",value:function(){var e=this,t="DECAY"===this.props.selectedPoint?"yellow":"black";return a.a.createElement(Sc.Circle,{onMouseDown:function(t){return e.startDragging("DECAY")},onMouseUp:function(t){return e.stopDragging("DECAY")},x:this.decayX,y:this.sustainY,radius:5,stroke:"yellow",fill:t})}},{key:"getSustainPoint",value:function(){var e=this,t="SUSTAIN"===this.props.selectedPoint?"yellow":"black";return a.a.createElement(Sc.Circle,{onMouseDown:function(t){return e.startDragging("SUSTAIN")},onMouseUp:function(t){return e.stopDragging("SUSTAIN")},x:this.sustainX,y:this.sustainY,radius:5,stroke:"yellow",fill:t})}},{key:"getReleasePoint",value:function(){var e=this,t="RELEASE"===this.props.selectedPoint?"yellow":"black";return a.a.createElement(Sc.Circle,{onMouseDown:function(t){return e.startDragging("RELEASE")},onMouseUp:function(t){return e.stopDragging("RELEASE")},x:this.releaseX,y:200,radius:5,stroke:"yellow",fill:t})}},{key:"getADSRPoints",value:function(){return[this.getAttackPoint(),this.getDecayPoint(),this.getSustainPoint(),this.getReleasePoint()]}},{key:"render",value:function(){var e=this;return a.a.createElement("div",null,a.a.createElement(Sc.Stage,{ref:function(t){return e.ref=t},width:650,height:400,onMouseLeave:function(){return e.stopDragging()},onMouseUp:function(t){return e.stopDragging()}},a.a.createElement(Sc.Layer,null,a.a.createElement(Sc.Rect,{onMouseMove:function(t){return e.onMouseMove(t)},onMouseUp:function(t){return e.stopDragging()},x:0,y:0,height:400,width:650,fill:"black"}),this.getGuideLines(),a.a.createElement(Sc.Line,{points:[0,200,650,200],strokeWidth:2,stroke:"red"}),this.getAttackCurve(),this.getDecayCurve(),this.getSustainCurve(),this.getReleaseCurve(),this.getADSRPoints(),a.a.createElement(Sc.Text,{text:this.state.x+","+this.state.y,fill:"white",fontSize:6,fontFamily:"Arial",x:30,y:300}))))}},{key:"getYForSustain",value:function(e){return 200-400*(e*=this.level)/2}},{key:"getYForLevel",value:function(){return 200-400*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.level)/2}},{key:"getLevelForYPosition",value:function(e){if(!this.props.showLevel)return 1;var t=2*(400-e)/400-1;return t>1?1:t<-1?0:t}},{key:"getSustainForYPosition",value:function(e){var t=2*(400-e)/400-1;return this.props.showLevel||(t=Math.abs(t)),(t/=this.level)>1?1:t<0?0:t}},{key:"getTimeForXPosition",value:function(e,t){return"DECAY"===t?e-=this.attackX:"SUSTAIN"===t?e-=this.decayX:"RELEASE"===t&&(e-=this.sustainX),Math.max(0,e/32.5*this.props.zoom)}},{key:"getXPositionForTime",value:function(e){return 32.5*e/this.props.zoom}},{key:"level",get:function(){return this.props.showLevel?this.props.envelope.level:1}},{key:"sustainY",get:function(){return 200-400*(this.props.envelope.sustain*this.level)/2}},{key:"attackX",get:function(){return this.getXPositionForTime(this.props.envelope.attack)}},{key:"decayX",get:function(){return this.getXPositionForTime(this.props.envelope.decay)+this.attackX}},{key:"sustainX",get:function(){return this.attackX+this.decayX+100}},{key:"releaseX",get:function(){return this.sustainX+this.getXPositionForTime(this.props.envelope.release)}},{key:"isSynthEnvelope",get:function(){return"PITCH"!==this.props.envelopeType}},{key:"attackCurve",get:function(){return this.props.envelope.attackCurve}},{key:"decayCurve",get:function(){return this.props.envelope.decayCurve}},{key:"sustainCurve",get:function(){return this.props.envelope.sustainCurve}},{key:"releaseCurve",get:function(){return this.props.envelope.releaseCurve}}]),n}(r.Component);function fh(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var dh=function(e){Object(u.a)(n,e);var t=fh(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"getOption",value:function(e){return this.getOptions().filter(function(t){return t.value===e})[0]}},{key:"getOptions",value:function(){var e=this,t=mh;return"DECAY"===this.props.selectedPoint&&(t=mh.filter(function(e){return"linear"===e.value||"exponential"===e.value})),t.map(function(t){return Object(D.a)({},t,{label:t.label+" "+e.props.selectedPoint.toLowerCase()})})}},{key:"onSelectOption",value:function(e){var t=e.value;"ATTACK"===this.props.selectedPoint?this.props.envelope.attackCurve=t:"DECAY"===this.props.selectedPoint?this.props.envelope.decayCurve=t:"RELEASE"===this.props.selectedPoint&&(this.props.envelope.releaseCurve=t),this.props.onUpdateEnvelopeCurve(e.value)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"envelope-curve-dropdown-container"},a.a.createElement(Vc.a,{className:"envelope-curve-dropdown",controlClassName:"envelope-curve-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.getOptions(),onChange:function(t){return e.onSelectOption(t)},value:this.getOption(this.curve),placeholder:"Curve"}))}},{key:"envelope",get:function(){return"PITCH"===this.props.envelopeType?this.props.envelope.envelope.envelope:this.props.envelope.envelope}},{key:"curve",get:function(){var e=this.envelope;return"ATTACK"===this.props.selectedPoint?e.attackCurve:"DECAY"===this.props.selectedPoint?e.decayCurve:"RELEASE"===this.props.selectedPoint?e.releaseCurve:""}}]),n}(r.Component),mh=[{value:"linear",label:"Linear"},{value:"exponential",label:"Exponential"},{value:"sine",label:"Sine"},{value:"cosine",label:"Cosine"},{value:"bounce",label:"Bounce"},{value:"ripple",label:"Ripple"},{value:"step",label:"Step"}],vh=dh;function gh(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var yh=200,bh=function(e){Object(u.a)(n,e);var t=gh(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={zoom:yh,selectedPoint:"ATTACK"},r.onClickDone=r.onClickDone.bind(Object(W.a)(r)),r.onClickCancel=r.onClickCancel.bind(Object(W.a)(r)),r}return Object(c.a)(n,[{key:"updateZoom",value:function(e){this.setState({zoom:e.target.value})}},{key:"onClickDone",value:function(){this.props.hide()}},{key:"onClickCancel",value:function(){this.props.hide()}},{key:"onEnvelopeUpdated",value:function(){this.setState(this.state)}},{key:"setSelectedPoint",value:function(e){this.setState({selectedPoint:e})}},{key:"onUpdateEnvelopeCurve",value:function(e){this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.props.envelope,n=this.props.name||this.props.envelopeType+" Envelope";return a.a.createElement(lh.a,{dialogClassName:"envelope-modal",show:this.props.show,onHide:this.onClickCancel},a.a.createElement(lh.a.Header,{closeButton:!0},a.a.createElement(lh.a.Title,null,n)),a.a.createElement(lh.a.Body,null,a.a.createElement(hh,{onEnvelopeUpdated:function(){return e.onEnvelopeUpdated()},envelopeType:this.props.envelopeType,setSelectedPoint:function(t){return e.setSelectedPoint(t)},selectedPoint:this.state.selectedPoint,showLevel:this.props.showLevel,zoom:this.state.zoom,envelope:this.props.envelope}),a.a.createElement("div",{className:"envelope-parameters-container"},a.a.createElement("div",null,a.a.createElement("div",null,"Zoom: ",this.state.zoom," ms"),a.a.createElement(xt.a,{value:this.state.zoom,change:function(t){return e.updateZoom(t)},step:1,max:1e3,min:1,orientation:"horizontal",reversed:!1})),a.a.createElement("div",{className:"envelope-parameters"},a.a.createElement("div",null,a.a.createElement("span",{className:"envelope-parameter"},"Level:",a.a.createElement("span",{className:"envelope-value"},Math.round(100*t.level)/100)),a.a.createElement("span",{className:"envelope-parameter"},"Attack:",a.a.createElement("span",{className:"envelope-value"},Math.round(100*t.attack)/100)),a.a.createElement("span",{className:"envelope-parameter"},"Decay:",a.a.createElement("span",{className:"envelope-value"},Math.round(100*t.decay)/100)),a.a.createElement("span",{className:"envelope-parameter"},"Sustain:",a.a.createElement("span",{className:"envelope-value"},Math.round(100*t.sustain)/100)),a.a.createElement("span",{className:"envelope-parameter"},"Release:",a.a.createElement("span",{className:"envelope-value"},Math.round(100*t.release)/100))),a.a.createElement("div",null,a.a.createElement(vh,{onUpdateEnvelopeCurve:function(t){return e.onUpdateEnvelopeCurve(t)},selectedPoint:this.state.selectedPoint,envelopeType:this.props.envelopeType,envelope:this.props.envelope}))))),a.a.createElement(lh.a.Footer,null,a.a.createElement(Ac.b,{variant:"secondary",onClick:this.onClickDone},"Done"),a.a.createElement(Ac.b,{variant:"primary",onClick:this.onClickCancel},"Cancel")))}}]),n}(r.Component);function kh(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Eh=function(e){Object(u.a)(n,e);var t=kh(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={showEnvelopeModal:!1},r}return Object(c.a)(n,[{key:"showEnvelopeModal",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.setState({showEnvelopeModal:e})}},{key:"render",value:function(){var e=this,t=this.props.envelope,n={envelopeType:this.props.envelopeType};return a.a.createElement("div",null,a.a.createElement(bh,{envelopeType:this.props.envelopeType,envelope:t,showLevel:this.props.showLevel,show:this.state.showEnvelopeModal,hide:function(){return e.showEnvelopeModal(!1)}}),a.a.createElement(Wc,{condition:this.props.showLevel},a.a.createElement(hu,{automation:this.props.automation,name:"Level",parameter:t.levelParameter,automationContext:n,sequencerEngine:this.props.sequencerEngine,onParameterChanged:function(){return[]},lfoEnabled:!0,isParameter:!0,min:-1,max:1,step:.01})),a.a.createElement(hu,{automation:this.props.automation,name:"Attack",parameter:t.attackParameter,automationContext:n,sequencerEngine:this.props.sequencerEngine,onParameterChanged:function(){return[]},lfoEnabled:!0,isParameter:!0,min:0,max:6e3,step:1}),a.a.createElement(hu,{automation:this.props.automation,name:"Decay",automationContext:n,sequencerEngine:this.props.sequencerEngine,parameter:t.decayParameter,onParameterChanged:function(){return[]},isParameter:!0,lfoEnabled:!0,min:0,max:6e3,step:1}),a.a.createElement(hu,{automation:this.props.automation,automationContext:n,name:"Sustain",parameter:t.sustainParameter,onParameterChanged:function(){return[]},isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,min:0,max:1,step:.01}),a.a.createElement(hu,{automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,automationContext:n,name:"Release",parameter:t.releaseParameter,onParameterChanged:function(){return[]},lfoEnabled:!0,isParameter:!0,min:0,max:1e4,step:1}),a.a.createElement("div",{onClick:function(){return e.showEnvelopeModal()},className:"draw-envelope-modal-button"},"DRAW"))}}]),n}(r.Component),Oh="AMP";function Sh(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ph=function(e){Object(u.a)(n,e);var t=Sh(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={selectedEnvelope:Oh},r}return Object(c.a)(n,[{key:"onSelectEnvelopeType",value:function(e){this.setState({selectedEnvelope:e.value})}},{key:"render",value:function(){var e=this,t=void 0,n=!0;return this.state.selectedEnvelope===Oh?(n=!1,t=this.props.instrument.ampEnvelope):"FILTER"===this.state.selectedEnvelope?t=this.props.instrument.filterEnvelope:"FILTER_2"===this.state.selectedEnvelope?t=this.props.instrument.filterEnvelope2:"PITCH"===this.state.selectedEnvelope?t=this.props.instrument.pitchEnvelope:"MODULATION"===this.state.selectedEnvelope&&(n=!1,t=this.props.instrument.modulationEnvelope),a.a.createElement("div",{className:"envelopes-component"},a.a.createElement("div",{className:"instrument-subsection-name"},"Envelopes"),a.a.createElement("div",{className:"osc-type-dropdown-container"},a.a.createElement(Vc.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.props.envelopeOptions,onChange:function(t){return e.onSelectEnvelopeType(t)},value:this.getEnvelopeOption(this.state.selectedEnvelope),placeholder:"Osc. Type"})),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(Eh,{automation:this.props.automation,envelopeType:this.state.selectedEnvelope,sequencerEngine:this.props.sequencerEngine,showLevel:n,instrument:this.props.instrument,envelope:t}))}},{key:"getEnvelopeOption",value:function(e){return this.props.envelopeOptions.filter(function(t){return t.value===e})[0]}}]),n}(r.Component);function wh(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var jh=function(e){Object(u.a)(n,e);var t=wh(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props.instrument,t={},n={};if(e.getInstrumentType()==up)t={"Carrier Oscillator":e.carrierOscillator,"Modulator Oscillator":e.modulatorOscillator};else{var r=e.oscillatorNodes[0],i=e.oscillatorNodes[1],s=e.oscillatorNodes[2],o=e.oscillatorNodes[3];t={"Oscillator 1":r,"Oscillator 2":i,"Oscillator 3":s,"Oscillator 4":o};var c=e.ampEnvelope,u=e.filterEnvelope,l=e.pitchEnvelope;n={"Amp Envelope":c,"Filter Envelope":u,"Pitch Envelope":l}}return console.log("envelopes = "),console.log(n),a.a.createElement("div",null,a.a.createElement(Th,{name:"Synth",parameters:e.parameters}),Object.keys(t).map(function(e){return a.a.createElement(Th,{name:e,parameters:t[e].parameters})}),Object.keys(n).map(function(e){return a.a.createElement(Th,{name:e,parameters:n[e].parameters})}))}}]),n}(r.Component),Th=function(e){Object(u.a)(n,e);var t=wh(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this.parameterMods;return 0===e.length?a.a.createElement("div",null):a.a.createElement("div",null,a.a.createElement("div",{className:"synth-mods-name"},this.props.name),e.map(function(e){return a.a.createElement(Bc,{parameterMod:e})}))}},{key:"parameterMods",get:function(){var e=[];return this.props.parameters.forEach(function(t){return e=e.concat(t.parameterMods)}),e}}]),n}(r.Component),xh=jh;function Ch(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Nh=function(e){Object(u.a)(n,e);var t=Ch(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={showMods:!1,showGenetix:!1,selectedOscillator:0},r.onClickMods=r.onClickMods.bind(Object(W.a)(r)),r.onClickGenetix=r.onClickGenetix.bind(Object(W.a)(r)),r}return Object(c.a)(n,[{key:"onChooseOscillator",value:function(e){this.setState({selectedOscillator:e})}},{key:"onClickGenetix",value:function(){this.setState({showGenetix:!this.state.showGenetix})}},{key:"onClickMods",value:function(){this.setState({showMods:!this.state.showMods})}},{key:"getOscillatorOptions",value:function(){return[{value:"square",label:"Square"},{value:"sine",label:"Sine"},{value:"triangle",label:"Triangle"},{value:"sawtooth",label:"Sawtooth"},{value:"pwm",label:"PWM"},{value:"pulse",label:"Pulse"}]}},{key:"getOscillatorOption",value:function(e){for(var t=this.getOscillatorOptions(),n=0;n<t.length;n++)if(t[n].value==e)return t[n];return null}},{key:"render",value:function(){var e=this,t=this.props.instrument;return a.a.createElement("div",{className:"instrument"},a.a.createElement(Wc,{condition:!this.state.showMods&&!this.state.showGenetix},a.a.createElement("div",{className:"clear-fix"}),a.a.createElement("div",{className:"instrument-section"},a.a.createElement("div",{className:"instrument-subsection"},a.a.createElement(ch,{selectedOscillator:this.state.selectedOscillator,onChooseOscillator:function(t){return e.onChooseOscillator(t)},sequencerEngine:this.props.sequencerEngine,instrument:t}))),a.a.createElement("div",{className:"instrument-section"},a.a.createElement("div",{className:"instrument-subsection"},a.a.createElement("div",{className:"instrument-subsection-name"},"Filter"),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(hu,{automation:this.props.automation,name:"Cutoff",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:t.filterCutoffParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:1e4,step:1}),a.a.createElement(hu,{automation:this.props.automation,name:"Q",sequencerEngine:this.props.sequencerEngine,parameter:t.filterQParameter,lfoEnabled:!0,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:9,step:1})),a.a.createElement("div",{className:"instrument-subsection"},a.a.createElement(qp,{sequencerEngine:this.props.sequencerEngine,selectedOscillator:this.state.selectedOscillator,instrument:t}))),a.a.createElement("div",{className:"instrument-section"},a.a.createElement("div",{className:"instrument-subsection"},a.a.createElement(Ph,{automation:this.props.automation,envelopeOptions:Rh,sequencerEngine:this.props.sequencerEngine,instrument:t})))),a.a.createElement(Wc,{condition:this.state.showMods},a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(xh,{instrument:t})),a.a.createElement(Wc,{condition:this.state.showGenetix},a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(Bp,{onClickBack:function(){return e.onClickGenetix()},track:this.props.track,instrument:t})),a.a.createElement(Wc,{condition:!this.state.showGenetix},a.a.createElement("div",{onClick:this.onClickMods,className:"mods-button common-button small-button"},this.state.showMods?"BACK":"MODS"),a.a.createElement("div",{onClick:this.onClickGenetix,className:"mods-button common-button pink-button small-button"},"GENETIX")))}}]),n}(r.Component),Rh=[{value:Oh,label:"Amp"},{value:"FILTER",label:"Filter"},{value:"PITCH",label:"Pitch"}],Dh=Nh,qh=Object(r.memo)(function(e){var t=e.waveformPoints,n=e.rmsPoints,r=e.color;return a.a.createElement(Sc.FastLayer,null,a.a.createElement(Sc.Line,{bezier:!0,points:n,stroke:r,strokeWidth:2}),a.a.createElement(Sc.Line,{bezier:!0,points:t,stroke:r,strokeWidth:2}))}),Mh=function(e,t,n){return e/t.duration*n},Ah=Object(r.memo)(function(e){var t=e.sampler,n=e.height,r=e.instrument,i=e.buffer,s=e.color,o=e.width,c=(e.step,e.setDraggingStart),u=e.setDraggingEnd;if(void 0===i)return a.a.createElement(Sc.Layer,null);var l=t.getLoopPoints(r.getLoopPoints(0,t)),p=l.loopStart,h=l.loopEnd;return p=Mh(p,i,o),h=Mh(h,i,o),a.a.createElement(Sc.Layer,null,a.a.createElement(Sc.Rect,{x:p,y:0,width:h-p,height:n,fill:s,opacity:.2}),a.a.createElement(Sc.Line,{points:[p,0,p,n],stroke:"red",strokeWidth:2}),a.a.createElement(Sc.Line,{onMouseDown:c,points:[p,0,p,n],stroke:"black",opacity:0,strokeWidth:20}),a.a.createElement(Sc.Line,{points:[h,0,h,n],stroke:"red",strokeWidth:2}),a.a.createElement(Sc.Line,{onMouseDown:u,points:[h,0,h,n],stroke:"black",opacity:0,strokeWidth:20}))}),Ih=Object(g.b)(function(e,t){var n=void 0===e.sequencer.sequencerEngine?void 0:e.sequencer.sequencerEngine.getSequenceId();return{step:void 0!==n&&e.sequencer.isPlaying[n]?e.sequencer.sequencerEngine.trackStep:0,loopStart:t.instrument.loopStart,loopLength:t.instrument.loopLength}},null)(Ah);function Lh(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Fh=function(e){Object(u.a)(n,e);var t=Lh(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={playTicks:{}},r.onTriggerSample=r.onTriggerSample.bind(Object(W.a)(r)),r.onReleaseSample=r.onReleaseSample.bind(Object(W.a)(r)),r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("TRIGGER_SAMPLE",this.onTriggerSample),window.addEventListener("RELEASE_SAMPLE",this.onReleaseSample)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("TRIGGER_SAMPLE",this.onTriggerSample),window.removeEventListener("RELEASE_SAMPLE",this.onReleaseSample)}},{key:"onReleaseSample",value:function(e){var t=this;setTimeout(function(){Object.keys(t.state.playTicks).forEach(function(e){return clearInterval(e)}),t.setState({playTicks:{}})},e)}},{key:"onTriggerSample",value:function(e){var t=this;if(e.soundId===this.props.soundId&&!(Object.keys(this.state.playTicks).length>=10)){var n=e.time,r=e.transpose,a=Math.pow(2,r/12);setTimeout(function(){var n=0,r=(new Date).getTime(),i=setInterval(function(){var s=(new Date).getTime();n=(s-r)/1e3;var o=t.state.playTicks,c=n*a;t.props.instrument&&t.props.instrument.loop&&(c%=t.props.instrument.defaultSampler.getDuration()*t.props.instrument.loopLength/100);var u=e.startTime+c;o[i]=t.props.convertSecondsToSpace(u),e.duration&&n>e.duration&&(clearInterval(i),delete o[i]),t.setState(t.state)},80),s=t.props.convertSecondsToSpace(e.startTime);t.state.playTicks[i]=s,t.setState(t.state)},n)}}},{key:"render",value:function(){var e=this;return Object.values(this.state.playTicks).map(function(t){return a.a.createElement(Sc.Rect,{x:t,y:0,width:2,height:e.props.height,fill:"rgb(35, 249, 111)"})})}}]),n}(r.Component),Bh=function(e,t){var n=[];for(var r in e)n.push(e[r].x),n.push(e[r][t]);return n},Hh=function(){function e(t,n){Object(o.a)(this,e),console.log("initializing waveform cache"),this.width=t,this.height=n,this.idToWaveform={},this.idToBasicWaveform={},this.reversedIdToWaveform={}}return Object(c.a)(e,[{key:"getBasicWaveform",value:function(e,t){var n=this;return new Promise(function(r,a){e in n.idToBasicWaveform?r(n.idToBasicWaveform[e]):n.computeBasicWaveform(t).then(function(t){n.idToBasicWaveform[e]=t,r(t)})})}},{key:"getWaveform",value:function(e,t){var n=this;return new Promise(function(r,a){e in n.idToWaveform?r(n.idToWaveform[e]):n.computeWaveformPoints(t,0,[],function(t){n.idToWaveform[e]=t,r(t)})})}},{key:"getReversedWaveform",value:function(e,t){var n=this;return new Promise(function(r,a){e in n.reversedIdToWaveform?r(n.reversedIdToWaveform[e]):n.computeWaveformPoints(t,0,[],function(t){n.reversedIdToWaveform[e]=t,r(t)})})}},{key:"computeWaveformPoints",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n,r,a){var i,s,o,c,u,l,p,h,f,d;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("computing waveforms!"),i=this.width/4,!((n+1)*i>this.width)){e.next=5;break}return a([]),e.abrupt("return");case 5:for(s=Math.floor(t.length/this.width),o=(o=t.getChannelData(0)).subarray(i*n*s,i*(n+1)*s),c=window.api.create_buffer(o.length),Math.min((n+1)*i,this.width),window.Module.HEAPF32.set(o,c>>2),window.api.getColoredWaveform(c,i,this.height,o.length,s,i*n),u=window.api.get_result_pointer(),l=new Uint16Array(window.Module.HEAP16.buffer,u,7*i),p=[],h=0;h<7*i;h+=7)f=[l[h+4],l[h+5],l[h+6]],p.push({x:l[h],y:l[h+1],width:l[h+2],height:l[h+3],rgb:f});d=this,window.api.destroy_buffer(c),setTimeout(function(){d.computeWaveformPoints(t,n+1,r.concat(p),function(e){a(p.concat(e))})},100);case 19:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"computeBasicWaveform",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r,a,i,s,o,c;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=Math.floor(t.length/this.width),r=t.getChannelData(0),a=window.api.create_buffer(r.length),this.width,window.Module.HEAPF32.set(r,a>>2),window.api.getWaveform(a,this.width,this.height,r.length,n),i=window.api.get_result_pointer(),s=new Uint16Array(window.Module.HEAP16.buffer,i,3*this.width),o=[],c=0;c<3*this.width;c+=3)o.push({x:s[c],y:s[c+1],rmsY:s[c+2]});return window.api.destroy_buffer(a),e.abrupt("return",o);case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function Vh(e){return e?.99*e.clientWidth:window.innerWidth-2}var Uh=window.innerWidth,Jh=130,_h=new wt.a,Gh=new Hh(540,120),zh=Object(g.b)(null,function(e,t){return{}})(function(e){var t=e.buffer,n=e.soundId,i=e.instrument,s=e.sampler,o=Object(r.useState)(!1),c=Object(j.a)(o,2),u=c[0],l=c[1],p=Object(r.useState)(!1),h=Object(j.a)(p,2),f=h[0],d=h[1],m=Object(r.useState)(e.width||Uh),v=Object(j.a)(m,2),g=v[0],y=v[1],b=Object(r.useState)(e.height),k=Object(j.a)(b,2),E=k[0],O=k[1],S=Object(r.useState)([]),P=Object(j.a)(S,2),w=P[0],T=P[1],x=Object(r.useState)([]),C=Object(j.a)(x,2),N=C[0],R=C[1],D=Object(r.useRef)(null);Object(r.useEffect)(function(){var r=e.width||Vh(e.div),a=e.height||Jh;return s.showingPrettyWaveform=!0,y(r),O(a),a===Gh.height&&r===Gh.width||(Gh=new Hh(r,a)),Gh.getBasicWaveform(n,t).then(function(e){e.sort(function(e,t){return e.x-t.x}),R(Bh(e,"rmsY")),T(Bh(e,"y"))}),function(){s.showingPrettyWaveform=!1}},[y,O,R,T,t,n,s]);var q=Object(r.useCallback)(function(){l(!1),d(!1)},[l,d]),M=Object(r.useCallback)(function(e){var t=D.current.getBoundingClientRect(),n=100*(e.clientX-t.left)/g;u&&i.loopStartParameter.set(n),f&&i.loopLengthParameter.set(n-i.loopStart)},[i,u,f,g,D]),A=_h.saturate(_h.getColorForHash(n),3);return a.a.createElement("div",{onMouseUp:q,onMouseLeave:q,onMouseMove:M,ref:D,className:"sound-waveform"},a.a.createElement(Sc.Stage,{width:g,height:E},a.a.createElement(Sc.Layer,{onMouseUp:q},a.a.createElement(Sc.Rect,{width:g,height:E,x:0,y:0,fill:"black"})),a.a.createElement(qh,{color:A,rmsPoints:N,waveformPoints:w}),a.a.createElement(Ih,{setDraggingStart:l,setDraggingEnd:d,instrument:i,color:A,buffer:t,sampler:s,width:g,height:E}),a.a.createElement(Sc.FastLayer,null,a.a.createElement(Fh,{instrument:i,soundId:n,height:E,convertSecondsToSpace:function(e){return Mh(e,t,g)}}))))}),Wh=new wt.a,Kh=Object(r.memo)(function(e){var t=e.sequencerEngine,n=e.selectedSampler,i=e.track,s=e.instrument,o=e.deleteSample,c=(e.sample,Object(r.useState)("")),u=Object(j.a)(c,2),l=u[0],p=u[1],h=Object(r.useCallback)(function(){i.auditionNext()},[i]),f=Object(r.useCallback)(function(){i.auditionPrevious()},[i]);Object(r.useEffect)(function(){if(n&&n.baseBuffer&&i.sample){var e=Wh.getColorForHash(n.sample.getId()),r=a.a.createElement(zh,{instrument:s,sequencerEngine:t,color:e,div:document.getElementsByClassName("sampled-instrument")[0],track:i,height:75,fullWidth:!1,hideButtons:!0,selectedSlice:0,slices:n.slices,isReversed:n.isReversed(),sampler:n,decentralized:!0,soundId:n.sample.getId(),onKeyDown:function(){return[]},onSelectSlice:function(){return[]},buffer:n.baseBuffer.get()});p(r)}},[n,p,i,s,i.sample]);var d=i.sample&&i.sample.tags||[];return a.a.createElement("div",null,a.a.createElement("div",{className:"waveform-toolbar"},a.a.createElement("div",{className:"sample-name"},n&&n.sample&&n.sample.name?Qh(n.sample.name):""),a.a.createElement("div",{className:"sample-chooser-buttons"},a.a.createElement("div",{onClick:f,className:"previous-button"}),a.a.createElement("div",{onClick:h,className:"next-button"})),d.map(function(e){return a.a.createElement(Ac.a,{color:"light"},Qh(e))}),a.a.createElement("div",{onClick:function(){return o(n)},className:"delete-button"},"x")),l)});function Qh(e){return e.length>=16?e.substring(0,16):e}var Xh=function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r,a,i;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.slice(0,t.length-1),a=t[t.length-1],n.selectedTags=r,e.next=5,n.getTopTags();case 5:return i=e.sent,n.selectedTags=[],i=i.map(function(e){return e.value}).filter(function(e){return e.toLowerCase().includes(a.toLowerCase())}),e.abrupt("return",Yh(i,r));case 9:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),Yh=function(e,t){if(1===e.length)return{tags:[].concat(Object(M.a)(t),[e[0]]),suggestions:[]};var n=e;if(""===t)return{suggestions:n};var r=Zh(e);return r?{suggestions:n,tags:[].concat(Object(M.a)(t),[r])}:{suggestions:n,tags:[]}},Zh=function(e){var t=void 0;for(var n in e)if(void 0===t)t=e[n];else if(void 0===(t=$h(e[n],t)))return;return t},$h=function(e,t){for(var n="",r=0;r<Math.min(e.length,t.length)&&e[r]===t[r];r++)n+=e[r];return""===n?void 0:n},ef=function(e){var t=e.instrument,n=e.hide,i=e.setSelectedSampler,s=t.sequencerEngine,o=Object(r.useRef)(null),c=Object(r.useState)(""),u=Object(j.a)(c,2),l=u[0],p=u[1],h=Object(r.useState)(!1),f=Object(j.a)(h,2),d=f[0],m=f[1],g=Object(r.useState)(""),y=Object(j.a)(g,2),b=y[0],k=y[1],E=Object(r.useState)([]),O=Object(j.a)(E,2),S=O[0],P=O[1],w=Object(r.useCallback)(Object(R.a)(N.a.mark(function e(){var r,a,o,c,u,p;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.split("+").filter(function(e){return""!==e}),k(!0),e.next=4,s.getSample(r);case 4:if(a=e.sent,o=a.sample,c=a.samplesStream,!o){e.next=17;break}return e.next=10,t.newSample(0,o,c);case 10:u=e.sent,p=u.sampler,u.samplers,i(p),n(),e.next=19;break;case 17:k(!1),m(!0);case 19:case"end":return e.stop()}},e)})),[n,i,l,k,m]);Object(r.useEffect)(function(){o.current.focus()},[]);var T=Object(r.useCallback)(function(e){var t=l.split("+");t=[].concat(Object(M.a)(t.slice(0,t.length-1)),[e]),p(t.join("+")+"+"),x([].concat(Object(M.a)(t),[""])),o.current.focus()},[p,l,x,P,o]),x=Object(r.useCallback)(function(){var e=Object(R.a)(N.a.mark(function e(n){var r,a,i,s;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Xh(n,t.sequencerEngine.searcher);case 2:r=e.sent,a=r.suggestions,i=r.tags,s=[].concat(Object(M.a)(i),Object(M.a)(a)),P(s);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[P]),C=Object(r.useCallback)(function(){var e=Object(R.a)(N.a.mark(function e(t){var n;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:p(t.target.value),n=t.target.value.split("+"),d&&m(!1),x(n);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[p,P,x,d,m]);return b?a.a.createElement("div",{className:"sample-search-container"},a.a.createElement(v.a,{sizeUnit:"px",size:10,color:"#42f4f1",loading:!0})):a.a.createElement("div",{className:"sample-search-container"},a.a.createElement("div",{className:"search-box-container"},a.a.createElement("input",{value:l,ref:o,placeholder:"Type sample tags to search",onChange:C,type:"text",className:"sample-search"}),a.a.createElement("div",{onClick:w,className:"search-button"},"Search")),d?a.a.createElement("div",{className:"no-results"},"No Results"):"",a.a.createElement("div",{className:"suggestions"},S.map(function(e){return a.a.createElement("div",{onClick:function(){return T(e)},className:"suggestion"},e)})))},tf="MIX",nf="ALTERNATE",rf="ROUND_ROBIN";function af(e){var t=Object(r.useState)(void 0),n=Object(j.a)(t,2),i=n[0],s=n[1],o=Object(r.useCallback)(function(t){e.instrument.mixMode=t.value,s(t.value)},[e.instrument]);return Object(r.useEffect)(function(){s(e.instrument.mixMode)},[]),a.a.createElement("div",{className:"interpolation-dropdown-container"},a.a.createElement(Vc.a,{className:"interpolation-dropdown",controlClassName:"interpolation-control-dropdown",arrowClassName:"interpolation-arrow-dropdown",options:of,onChange:o,value:sf(i),placeholder:"Mode"}))}function sf(e){return of.find(function(t){return t.value===e})}var of=[{value:tf,label:"Mix"},{value:nf,label:"Alternate"},{value:rf,label:"Round Robin"}],cf=new wt.a,uf=["a","b","c","d","e","f","g","h","i","j","k","l"],lf=function(e){var t=e.instrument,n=e.sampler,i=e.setSelectedSampler,s=e.toggleShowPiano,o=e.showPianoRoll,c=Object(r.useState)(!1),u=Object(j.a)(c,2),l=u[0],p=u[1],h=Object.keys(t.samplers).find(function(e){return t.samplers[e].indexOf(n)>-1}),f=t.samplers[h]||[],d="";return l&&(d=a.a.createElement(ef,{setSelectedSampler:i,hide:function(){return p(!1)},instrument:t})),a.a.createElement("div",{className:"advanced-controls"},a.a.createElement("div",{className:"samples-container"},f.map(function(e,t){return a.a.createElement("div",{className:n===e?"selected sampled-sound":"sampled-sound",onClick:function(){return i(e)},style:{backgroundColor:cf.getColorForHash(e.sample.getId())}},uf[t])}),a.a.createElement("div",{onClick:function(){return p(!0)},className:"add-sample-button"},"+"),a.a.createElement("img",{onClick:s,className:o?"piano-icon on":"piano-icon",src:"/piano-icon.png"})),d,a.a.createElement("div",{className:"drop-here"},"Drop samples here"),a.a.createElement("div",{className:"sampler-dropdowns"},a.a.createElement(Wu,{name:"Monophonic",parameter:t.monophonicParameter}),a.a.createElement(af,{instrument:t})))};function pf(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=r.createBuffer(e.numberOfChannels,a+n-t+1,r.sampleRate),s=i.getChannelData(0),o=e.getChannelData(0).subarray(t,n);if(s.set(o,a),e.numberOfChannels>1){var c=i.getChannelData(1),u=e.getChannelData(1).subarray(t,n);c.set(u,a)}return i}function hf(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ff=new wt.a,df=function(e){Object(u.a)(n,e);var t=hf(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={buffer:e.buffer,ticks:[],offset:0,endOffset:0},r.width=Vh(r.props.div),r.height=e.height||Jh,r.state.startX=r.convertSecondsToSpace(e.start,e.scale),r.state.endX=r.convertSecondsToSpace(e.end,e.scale),r.calculateTicks(void 0,void 0,void 0,!0),r}return Object(c.a)(n,[{key:"calculateTicks",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props.start,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.props.end,arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.props.scale,arguments.length>3&&void 0!==arguments[3]&&arguments[3]}},{key:"shouldComponentUpdate",value:function(e,t){if(this.width=Vh(e.div),this.state.buffer!=e.buffer||this.props.scale!==e.scale||this.props.zoomedStartTime!==e.zoomedStartTime||this.props.start!==e.start||this.props.end!==e.end){this.state.buffer=e.buffer;var n=e.start,r=e.end;this.state.startX=this.convertSecondsToSpace(n,e.scale),this.state.endX=this.convertSecondsToSpace(r,e.scale),this.calculateTicks(n,r,e.scale)}if(this.props.transpose!==e.transpose||this.props.bpm!==e.bpm){var a=e.start,i=e.end;this.calculateTicks(a,i,e.scale)}return!0}},{key:"convertSpaceToSeconds",value:function(e){return this.state.buffer.duration*e/this.width}},{key:"convertSecondsToSpace",value:function(e){return e/this.state.buffer.duration*this.width}},{key:"render",value:function(){var e=this,t=[0,0,30,30,0,30],n=[0,this.height,-30,this.height,0,this.height-30],r=this.props.color||ff.getColor(this.props.sliceNumber),i=this.state.startX,s=this.state.endX;return a.a.createElement(Sc.Group,null,this.props.isSelectedSlice?a.a.createElement(Sc.Rect,{x:i,y:0,width:s-i,opacity:s-i>Uh/2?.1:.2,height:this.height,fill:r}):a.a.createElement(Sc.Rect,null),a.a.createElement(Sc.Line,{points:[this.state.startX,0,this.state.startX,this.height],strokeWidth:1,stroke:"red",opacity:.5,alpha:.5,fill:"red"}),a.a.createElement(Sc.Line,{onMouseDown:function(t){return e.props.onStartSliceStartedDragging(t.evt.pageX-e.state.startX)},onMouseUp:this.props.onStartSliceStroppedDragging,onKeyDown:function(t){return e.props.onKeyDown(t)},x:this.state.startX,y:0,style:{cursor:"pointer"},points:t,closed:!0,strokeWidth:1,stroke:this.props.color,fill:this.props.color}),a.a.createElement(Sc.Line,{points:[this.state.endX,0,this.state.endX,this.height],strokeWidth:1,stroke:"red",fill:"red"}),a.a.createElement(Sc.Line,{onMouseDown:function(t){return e.props.onEndSliceStartedDragging(t.evt.pageX-e.state.endX)},onMouseUp:this.props.onEndSliceStoppedDragging,x:this.state.endX,y:0,style:{cursor:"pointer"},points:n,closed:!0,strokeWidth:1,stroke:this.props.color,fill:this.props.color}),this.props.isSelectedSlice?a.a.createElement(Sc.Rect,{x:i,y:this.height-3,width:s-i,alpha:.2,height:3,fill:r}):a.a.createElement(Sc.Rect,null),this.props.isSelectedSlice?this.state.ticks.map(function(t){return a.a.createElement(Sc.Line,{x:t,y:0,style:{cursor:"pointer"},points:[t.x,e.height,t.x,e.height-t.height],closed:!0,opacity:20===t.height?"0.55":"0.4",strokeWidth:1,stroke:e.props.color,fill:e.props.color})}):a.a.createElement(Sc.Rect,null))}}]),n}(r.Component),mf=Object(g.b)(function(e,t){var n=e.effects.effectParameters[t.transposeParameter.id],r=e.tracks.sampleSlices[t.sampler.id][t.sliceNumber];return void 0===r?{}:{bpm:e.user.bpm,transpose:n,start:r.startTime-t.zoomedStartTime,end:r.endTime-t.zoomedStartTime}},null)(df);function vf(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var gf=function(e){Object(u.a)(n,e);var t=vf(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"convertSecondsToSpace",value:function(e){return e/this.props.buffer.duration*this.props.width}},{key:"render",value:function(){var e=this,t="#0062ff";return this.props.showingOnsets||(t="#000010"),this.props.sampler.onsets.map(function(n,r){return a.a.createElement(Sc.Rect,{x:e.convertSecondsToSpace(n/1e3-e.props.zoomedStartTime),y:0,width:e.isSelectedOnset(r)?e.getOnsetWidth(r):1,height:e.props.height,opacity:e.isSelectedOnset(r)?.4:1,fill:e.isSelectedOnset(r)?"red":t})})}},{key:"getOnsetWidth",value:function(e){var t=this.props.sampler.onsets;return e===t.length-1?this.convertSecondsToSpace(this.props.sampler.getDuration()-t[e]/1e3):this.convertSecondsToSpace((t[e+1]-t[e])/1e3)}},{key:"isSelectedOnset",value:function(e){return this.props.selectedOnsets.indexOf(e)>-1}}]),n}(r.Component),yf=Object(g.b)(function(e,t){return{selectedOnsets:e.waveform.selectedOnsets[t.sampleId]||[]}},null)(gf);function bf(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var kf=function(e){Object(u.a)(n,e);var t=bf(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"onClick",value:function(){this.props.track.warp(),this.setState(this.state),this.props.onWarp&&this.props.onWarp()}},{key:"isWarped",value:function(){return this.props.track.midiEffects.effects.filter(function(e){return"Warp"===e.name}).filter(function(e){return e.enabled}).length>0}},{key:"render",value:function(){var e=this,t=this.props.isWarped?"warp-button selected":"warp-button";return a.a.createElement("div",{onClick:function(){return e.onClick()},className:t},"Warp")}}]),n}(r.Component),Ef=Object(g.b)(function(e,t){var n=t.track.subSequence.id;return{isWarped:e.tracks.trackWarps[n]&&e.tracks.trackWarps[n][t.track.trackNumber]}},null)(kf);function Of(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Sf=new wt.a,Pf=new Hh(Uh,Jh),wf=function(e){Object(u.a)(n,e);var t=Of(n);function n(e){var r,a;Object(o.a)(this,n),(a=t.call(this,e)).state=(r={x:0,slicing:!1,dragging:!1,end:null,buffer:e.buffer,isPlaying:!1,pts:[],slices:e.slices,fetchedSlices:void 0},Object(An.a)(r,"dragging",!1),Object(An.a)(r,"selection",null),Object(An.a)(r,"zoomedBuffer",void 0),Object(An.a)(r,"zommedIn",!1),Object(An.a)(r,"zoomedStartTime",0),Object(An.a)(r,"zoomedScale",1),Object(An.a)(r,"selectedRecording",a.props.track.selectedRecording),Object(An.a)(r,"xBounds",0),r),a.scale=1,a.width=Vh(a.props.div),a.height=e.height||Jh,Pf.width!==Vh(e.div)&&(Pf=new Hh(Vh(e.div),a.height)),a.markersDragging=!1;new Dn.a(a.props.soundId);return a.state.start=a.convertSecondsToSpace(e.start)/2,a.state.startX=a.convertSecondsToSpace(e.start),a.state.end=a.convertSecondsToSpace(e.end)/2,a.state.endX=a.convertSecondsToSpace(e.end),a.props.isReversed?Pf.getReversedWaveform(a.props.soundId,a.props.buffer).then(function(e){a.setState({pts:e})}):Pf.getWaveform(a.props.soundId,a.props.buffer).then(function(e){a.setState({pts:e})}),a.convertSpaceToSeconds.bind(Object(W.a)(a)),a.computeWaveformPoints.bind(Object(W.a)(a)),a.onWheel=a.onWheel.bind(Object(W.a)(a)),a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.props.hideButtons||window.addEventListener("mousewheel",this.onWheel,{passive:!1}),setTimeout(function(){var t=document.getElementsByClassName("sound-waveform")[0];t&&e.setState({xBounds:t.offsetLeft})},1e3)}},{key:"componentWillUnmount",value:function(){this.props.hideButtons||window.removeEventListener("mousewheel",this.onWheel)}},{key:"shouldComponentUpdate",value:function(e){var t=this;return(Pf.width!==e.width||Vh(e.div))&&(Pf=new Hh(Vh(e.div),this.height),this.width=e.width||Vh(e.div)),this.props.isReversed==e.isReversed&&e.soundId===this.props.soundId&&e.track.selectedRecording===this.state.selectedRecording||(this.state.selectedRecording=e.track.selectedRecording,e.isReversed?Pf.getReversedWaveform(e.soundId,e.buffer).then(function(e){t.setState({pts:e})}):Pf.getWaveform(e.soundId,e.buffer).then(function(e){t.setState({pts:e})})),!0}},{key:"computeWaveformPoints",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n,r,a){var i,s,o,c,u,l,p,h,f,d,m;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.index++,i=this.index,s=this.width,!((n+1)*s>this.width)){e.next=6;break}return a([]),e.abrupt("return");case 6:if(o=Math.floor(t.length/this.width),c=(c=t.getChannelData(0)).subarray(s*n*o,s*(n+1)*o),u=window.api.create_buffer(c.length),Math.min((n+1)*s,this.width),window.Module.HEAPF32.set(c,u>>2),window.api.getColoredWaveform(u,s,this.height,c.length,o,s*n),l=window.api.get_result_pointer(),p=new Uint16Array(window.Module.HEAP16.buffer,l,7*s),h=[],!(i<this.index)){e.next=18;break}return e.abrupt("return");case 18:for(f=0;f<7*s;f+=7)d=[p[f+4],p[f+5],p[f+6]],h.push({x:p[f],y:p[f+1],width:p[f+2],height:p[f+3],rgb:d});if(m=this,!(i<this.index)){e.next=22;break}return e.abrupt("return");case 22:m.state.pts=r.concat(h),m.setState(m.state),window.api.destroy_buffer(u);case 25:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"convertSpaceToSeconds",value:function(e){return(this.state.zoomedIn?this.state.zoomedBuffer:this.props.buffer).duration*e/this.width}},{key:"convertSecondsToSpace",value:function(e){return e/(this.state.zoomedIn?this.state.zoomedBuffer:this.props.buffer).duration*this.width}},{key:"newSlice",value:function(e){this.state.slicing&&(this.props.sampler.newSlice(this.convertSpaceToSeconds(e.evt.layerX)),this.state.slices=this.props.sampler.slices,this.state.slicing=!1,this.setState(this.state),this.props.onSelectSlice(this.state.slices.length-1))}},{key:"getSlices",value:function(){var e=this,t=this.props.sampler.slices.map(function(t,n){var r=t.getCopy();return r.startTime-=e.state.zoomedStartTime,r.endTime-=e.state.zoomedStartTime,r.i=n,r});t=t.filter(function(e){return e.startTime>=0});var n=-1;for(var r in t)if(t[r].i===this.props.selectedSlice){n=r;break}return-1===n?t:(n=t.splice(n,1)).concat(t)}},{key:"onClickShowOnsets",value:function(){this.props.setShowOnsets(!this.props.showingOnsets)}},{key:"onClickAddSlice",value:function(e){if(e.target.blur(),this.props.showingOnsets&&this.selectedOnsets.length>0){for(var t in this.selectedOnsets){var n=this.onsets[this.selectedOnsets[t]],r=this.onsets[this.selectedOnsets[t]+1];this.props.sampler.newSlice(n/1e3,r/1e3),this.state.slices=this.props.sampler.slices,this.props.onSelectSlice(this.state.slices.length-1)}return this.props.setSelectedOnsets([]),void this.props.setShowOnsets(!1)}if(null!==this.state.selection){var a=this.convertSpaceToSeconds(this.state.selection.start),i=this.convertSpaceToSeconds(this.state.selection.end);if(i-a<.01)return;this.props.sampler.newSlice(this.state.zoomedStartTime+a,i+this.state.zoomedStartTime),this.setState({selection:null,slices:this.props.sampler.slices}),this.props.onSelectSlice(this.state.slices.length-1)}}},{key:"onClickDeleteSlice",value:function(){this.props.sampler.deleteSlice(this.props.selectedSlice),this.setState(this.state)}},{key:"onClickAutoSlice",value:function(){var e=this;this.props.track.sample.noteSequence.notes.forEach(function(t){e.props.sampler.newSlice(t.startTime,t.endTime)}),this.setState(this.state)}},{key:"onClickLoadSlices",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n=this;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.props.decentralized){e.next=9;break}return t=new Dn.a(this.props.soundId),this.props.sampler.slices=[],this.setState(this.state),e.next=6,t.fetchSlices();case 6:e.sent.forEach(function(e){return n.props.sampler.newSlice(e.startTime,e.endTime)}),this.setState(this.state);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onClickSaveSlices",value:function(){if(this.props.decentralized){var e=this.props.sampler.slices.map(function(e){return Math.floor(1e3*e.startTime)}),t=this.props.sampler.slices.map(function(e){return Math.floor(1e3*e.endTime)});this.props.soundId;d.a.newSlices(this.props.soundId,e,t)}}},{key:"onMouseDown",value:function(e){var t=e.evt.layerX;if(!this.markersDragging){if(this.props.showingOnsets){for(var n=1e3*(this.state.zoomedStartTime+this.convertSpaceToSeconds(t)),r=-1,a=0;a<this.onsets.length;a++){this.onsets[a]<n&&(a===this.onsets.length-1?r=a:this.onsets[a+1]>n&&(r=a))}if(-1!==r){var i=this.selectedOnsets.indexOf(r);if(i>-1){var s=Object(M.a)(this.selectedOnsets);s.splice(i,1),this.props.setSelectedOnsets(s)}else this.props.setSelectedOnsets([].concat(Object(M.a)(this.selectedOnsets),[r]))}}this.state.dragging?this.setState({dragging:!1}):this.setState({selection:{start:t,end:t},dragging:!0})}}},{key:"onMouseMove",value:function(e){var t=e.evt.layerX;if(this.markersDragging)return t=Math.max(0,t-this.state.offset),void this.changeTheSlice(this.convertSpaceToSeconds(t)+this.state.zoomedStartTime);this.state.mouseX=e.evt.layerX,this.state.dragging&&this.setState({selection:{start:this.state.selection.start,end:e.evt.layerX}})}},{key:"changeTheSlice",value:function(e){var t=this.props.sampler.slices;if(void 0!==this.state.startSliceDragging){var n=t[this.state.startSliceDragging];if(e>n.endTime)return;this.props.sampler.slice(this.state.startSliceDragging,e,n.endTime)}else if(void 0!==this.state.endSliceDragging){var r=t[this.state.endSliceDragging];if(r.startTime>e)return;this.props.sampler.slice(this.state.endSliceDragging,r.startTime,e)}}},{key:"endDrag",value:function(e){if(this.markersDragging)return this.state.startSliceDragging=void 0,this.state.endSliceDragging=void 0,void(this.markersDragging=!1);this.state.dragging=!1}},{key:"scrollWaveform",value:function(e){e/=700*this.scale/this.duration;var t=this.state.zoomedStartTime||0;t+=e;var n=this.buffer.duration+this.state.zoomedStartTime;if(n+=e,!(t<0||n>this.duration)){var r=x.a.Master.context.sampleRate;this.state.zoomedStartTime=t;var a=pf(this.props.buffer,t*r,n*r,x.a.Master.context);this.state.zoomedBuffer=a,this.setState(this.state),this.computeWaveformPoints(a,0,[],function(e){})}}},{key:"zoomIn",value:function(e,t){if((t*=2)<=2)this.zoomOut();else{var n=this.state.zoomedStartTime||0,r=this.duration/t,a=n+this.convertSpaceToSeconds(e)-r*e/this.width,i=a+r;if(a<0&&(a=0),!(i-a<.001)){var s=this.props.buffer;this.state.zoomedStartTime=a,this.state.zoomedScale=t,this.state.zoomedIn=!0;var o=x.a.Master.context.sampleRate,c=pf(s,a*o,i*o,x.a.Master.context);this.state.zoomedBuffer=c,this.computeWaveformPoints(c,0,[],function(e){})}}}},{key:"zoomOut",value:function(){this.state.zoomedIn=!1,this.state.zoomedStartTime=0,this.state.zoomedBuffer=void 0,this.state.selection=null,this.computeWaveformPoints(this.props.buffer,0,[],function(e){})}},{key:"markerDraggingStarted",value:function(){this.markersDragging=!0,this.setState({selection:null,dragging:!1})}},{key:"markerDraggingEnded",value:function(){this.markersDragging=!1,this.setState({selection:null,dragging:!1})}},{key:"onClickSyncTempo",value:function(){var e=this.props.sampler;e.tempoSynced?e.unsyncTempo():e.syncTempo(x.a.Transport.bpm.value),document.activeElement.blur(),this.setState(this.state)}},{key:"onMouseOver",value:function(e){this.props.setContextualHelp("TRACK_WAVEFORM")}},{key:"onWheel",value:function(e){if(e.ctrlKey){e.preventDefault(),e.stopPropagation();var t=this.scale-.01*e.deltaY;t<=1&&(t=1),this.zoomIn(this.state.mouseX,t),this.scale=t}else{var n=e.deltaX;Math.abs(n)>0&&(e.preventDefault(),this.scrollWaveform(n))}}},{key:"onStartSliceStartedDragging",value:function(e,t){e-=this.state.xBounds,this.markersDragging=!0,this.props.onSelectSlice(t),this.state.offset=e,this.state.startSliceDragging=t}},{key:"onStartSliceStoppedDragging",value:function(e){this.markersDragging=!1,this.state.startSliceDragging=void 0}},{key:"onEndSliceStartedDragging",value:function(e,t){e-=this.state.xBounds,this.markersDragging=!0,this.props.onSelectSlice(t),this.state.endSliceDragging=t,this.state.offset=e}},{key:"onEndSliceStoppedDragging",value:function(e){this.markersDragging=!1,this.state.endSliceDragging=void 0}},{key:"onChangeOnsetThreshold",value:function(e){this.props.setOnsetThreshold(e),this.props.sampler.analyze(),this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.state.pts,n=null==this.state.selection?{start:0,end:0}:this.state.selection,r=this.state.zoomedIn?this.state.zoomedBuffer:this.props.buffer,i=this.getSlices()[this.props.selectedSlice],s=(void 0===i||this.convertSecondsToSpace(i.startTime),void 0===i||this.convertSecondsToSpace(i.endTime),void 0===i?"black":Sf.getColor(this.props.selectedSlice)),o=this.props.sampler.tempo,c=(this.props.sampler,a.a.createElement("div",{className:"sound-waveform details-view",onMouseOver:function(t){return e.onMouseOver(t)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)}},a.a.createElement(Sc.Stage,{onMouseDown:function(t){return e.onMouseDown(t)},onMouseUp:function(t){return e.endDrag(t)},onMouseMove:function(t){return e.onMouseMove(t)},onMouseLeave:function(t){return e.endDrag(t)},width:this.width+20,height:this.height},a.a.createElement(Sc.Layer,null,a.a.createElement(Sc.Rect,{onClick:function(t){return e.newSlice(t)},x:0,y:0,width:this.width,height:this.height,fill:"black"}),a.a.createElement(yf,{height:this.height,width:this.width,buffer:r,showingOnsets:this.props.showingOnsets,zoomedStartTime:this.state.zoomedStartTime,sampleId:this.props.track.sample.getId(),sampler:this.props.sampler,onUpdate:function(){return e.setState(e.state)}}),this.markersDragging?a.a.createElement(Sc.Rect,null):a.a.createElement(Sc.Rect,{x:n.start,y:0,width:n.end-n.start,height:this.height,fill:"orange"})),a.a.createElement(Sc.Layer,null,t.map(function(e){return a.a.createElement(Sc.Rect,{x:e.x,y:e.y,width:e.width,height:e.height,fill:"rgb("+e.rgb[0]+","+e.rgb[1]+","+e.rgb[2]+")"})})),a.a.createElement(Sc.Layer,null,a.a.createElement(Fh,{soundId:this.props.soundId,height:this.height,convertSecondsToSpace:function(t){return e.convertSecondsToSpace(t-e.state.zoomedStartTime)}})),a.a.createElement(Sc.Layer,null,this.getSlices().map(function(t,n){return a.a.createElement(mf,{key:"marker-"+n,height:e.height,div:e.props.div,transposeParameter:e.props.track.trackData.transposeParameter,scale:e.state.zoomedScale,onStartSliceStartedDragging:function(n){return e.onStartSliceStartedDragging(n,t.i)},onStartSliceStoppedDragging:function(){return e.onStartSliceStoppedDragging(t.i)},onEndSliceStartedDragging:function(n){return e.onEndSliceStartedDragging(n,t.i)},onEndSliceStoppedDragging:function(){return e.onEndSliceStoppedDragging(t.i)},onKeyDown:e.props.onKeyDown,isSelectedSlice:e.props.selectedSlice===t.i,buffer:r,onSelectSlice:function(){return e.props.onSelectSlice(t.i)},track:e.props.track,sliceNumber:t.i,sampler:e.props.sampler,zoomedStartTime:e.state.zoomedStartTime,color:e.props.color||Sf.getColor(t.i)})})))));return this.props.hideButtons?c:a.a.createElement("div",{className:"waveform-container"},c,a.a.createElement("div",{className:"common-button blue-button",onClick:function(t){return e.onClickAddSlice(t)}},this.selectedOnsets.length>0?"ADD SLICES":"ADD SLICE"),a.a.createElement("div",{className:"common-button blue-button",onClick:function(t){return e.onClickDeleteSlice(t)}},"DELETE SLICE ",a.a.createElement("div",{style:{backgroundColor:s},className:"dot"})),a.a.createElement("div",{onClick:function(){return e.onClickShowOnsets()},className:"common-button blue-button"},this.props.showingOnsets?"HIDE ONSETS":"SELECT ONSETS"),a.a.createElement(Wc,{condition:this.state.zoomedStartTime>0},a.a.createElement("div",{onClick:function(){return e.zoomOut()},className:"common-button blue-button"},"ZOOM OUT")),a.a.createElement(Ef,{track:this.props.track,onWarp:function(){return e.setState(e.state)}}),a.a.createElement("div",{className:"sample-tempo"},null==o?"":"TEMPO: "+o),a.a.createElement(Wc,{condition:this.props.showingOnsets},a.a.createElement("div",{className:"onset-threshold-container"},a.a.createElement("div",null,"Onset Threshold: ",this.props.onsetThreshold," db"),a.a.createElement(xt.a,{value:this.props.onsetThreshold,change:function(t){return e.onChangeOnsetThreshold(t.target.value)},step:.01,max:6,min:-10,orientation:"horizontal",reversed:!1}))))}},{key:"duration",get:function(){return this.props.buffer.duration}},{key:"onsets",get:function(){return this.props.sampler.onsets}},{key:"selectedOnsets",get:function(){return this.props.track.sequencerEngine.store.getState().waveform.selectedOnsets[this.props.track.sample.getId()]||[]}},{key:"buffer",get:function(){return this.state.zoomedBuffer||this.props.buffer}}]),n}(r.Component),jf=(Object(g.b)(function(e){return{onsetThreshold:e.waveform.onsetThreshold,showingOnsets:e.waveform.showingOnsets}},function(e,t){return{setContextualHelp:function(t){return e(Object(O.U)(t))},setOnsetThreshold:function(t){return e(Object(O.Wb)(t))},setSelectedOnsets:function(n){return e(Object(O.Fc)(t.track.sample.getId(),n))},setShowOnsets:function(t){return e(Object(O.ad)(t))}}})(wf),new wt.a);var Tf=Object(g.b)(function(e,t){return{isOn:t.sampler.on||t.instrument.mixMode===tf||t.isSelectedSampler}},function(e,t){return{setSampleDragging:function(t){return e(Object(O.wc)(t))}}})(function(e){var t=e.sample;if(void 0===t)return a.a.createElement("div",null);var n={backgroundColor:jf.getColorForHash(t.getId())},i=t.getThumbnail(),s=function(e){e.stopPropagation()},o=Object(r.useCallback)(function(n){e.setSampleDragging(t)},[t]),c="key-info";return e.isOn&&(c+=" on"),i?a.a.createElement("img",{draggable:!0,onDragStart:o,onDragOver:s,onClick:e.onClickSampler,className:c,src:i}):a.a.createElement("div",{draggable:!0,onDragStart:o,onDragOver:s,onClick:e.onClickSampler,style:n,className:c},e.i+1)});new wt.a;var xf=Object(g.b)(function(e,t){return{isPlaying:e.keyboard.lastNotePlayed===t.transpose,mixMode:t.instrument.mixMode}},function(e,t){return{setSampleDragging:function(t){return e(Object(O.wc)(t))}}})(function(e){var t=Object(r.useState)([]),n=Object(j.a)(t,2),i=n[0],s=n[1],o="key";e.note.isBlackNote()?o+=" black":o+=" white";var c=e.note.getTranspose(),u=(i.map(function(e){return e.sample}),Object(r.useCallback)(function(t){t.stopPropagation(),e.sampleDragging&&(e.instrument.newSample(c,e.sampleDragging).then(function(e){s(e.samplers)}),e.setSampleDragging(void 0))},[e.sampleDragging,s])),l=Object(r.useCallback)(function(t){if(void 0===t){var n=i.find(function(e){return e.on});e.onClickSampler(n)}else t!==e.selectedSampler&&(e.onClickSampler(t),e.instrument.selectSampler(c,t))},[c,i,e.onClickSampler,e.selectedSampler,e.mixMode]);Object(r.useEffect)(function(){if(c in e.instrument.samplers){var t=e.instrument.samplers[c];s(t)}},[e.instrument.samplers[c]],e.selectedSampler);var p="key-container";return i.indexOf(e.selectedSampler)>-1&&void 0!==e.selectedSampler&&(p+=" selected"),e.isPlaying&&(p+=" last-played"),a.a.createElement("div",{className:p},a.a.createElement("div",{onClick:function(){return l()},onDrop:u,className:o}),i.map(function(t,n){return a.a.createElement(Tf,{i:n,key:"sample-thumb-"+n,isSelectedSampler:t===e.selectedSampler,sampler:t,instrument:e.instrument,onClickSampler:function(){return l(t)},sample:t.sample})}))});new wt.a;function Cf(e){var t=_i.a.NOTES.map(function(t){return(t=t.getCopy()).octave=e.octave,t});return a.a.createElement("div",{className:"octave"},a.a.createElement("div",{className:"octave-label"},t[0].toString()),t.map(function(t){return a.a.createElement(xf,{key:t.toString(),selectedSampler:e.selectedSampler,onClickSampler:e.onClickSampler,sampleDragging:e.sampleDragging,octave:e.octave,transpose:t.getTranspose(),note:t,instrument:e.instrument})}))}var Nf=Object(r.memo)(function(e){var t=e.selectedSampler,n=e.onClickSampler,r=e.sampleDragging,i=e.instrument;return a.a.createElement("div",{className:"horizontal-piano-container"},a.a.createElement("div",{className:"horizontal-piano"},a.a.createElement(Cf,{selectedSampler:t,onClickSampler:n,octave:1,instrument:i,sampleDragging:r}),a.a.createElement(Cf,{selectedSampler:t,onClickSampler:n,octave:2,instrument:i,sampleDragging:r}),a.a.createElement(Cf,{selectedSampler:t,onClickSampler:n,octave:3,instrument:i,sampleDragging:r}),a.a.createElement(Cf,{selectedSampler:t,onClickSampler:n,octave:4,instrument:i,sampleDragging:r}),a.a.createElement(Cf,{selectedSampler:t,onClickSampler:n,octave:5,instrument:i,sampleDragging:r}),a.a.createElement(Cf,{selectedSampler:t,onClickSampler:n,octave:6,instrument:i,sampleDragging:r}),a.a.createElement(Cf,{selectedSampler:t,onClickSampler:n,octave:7,instrument:i,sampleDragging:r})))});var Rf=n(392);function Df(e){var t=e.sequencerEngine.lfosTrack.lfos.map(function(e){return e.lfo}),n=e.sequencerEngine.envelopes;return a.a.createElement("div",{className:"parameter-modulators"},a.a.createElement("div",{className:"lfo-buttons"},t.map(function(n){return a.a.createElement(au,{lfo:n,lfos:t,parameter:e.parameter})})),a.a.createElement("div",{className:"envelope-buttons"},n.map(function(t,r){return a.a.createElement(ou,{parameter:e.parameter,envelope:t,envelopes:n})})))}var qf=Object(r.memo)(function(e){var t=e.isExponential,n=e.name,i=e.min,s=e.max,o=e.round,c=e.parameter,u=e.value,l=e.sequencerEngine,p=Object(r.useState)(!1),h=Object(j.a)(p,2),f=h[0],d=h[1],m=Object(r.useCallback)(function(){l&&d(!0)},[d]),v="";f&&(v=a.a.createElement(Df,{sequencerEngine:l,parameter:c})),i=t?Math.cbrt(i):i,s=t?Math.cbrt(s):s;var g,y=t?Math.cbrt(u):u;return a.a.createElement("div",{className:"parameter-knob-container"},a.a.createElement(Rf.Knob,{size:40,angleOffset:220,angleRange:280,value:y,min:i,max:s,onChange:function(e){return n=e,document.activeElement.blur(),t&&(n=Math.pow(n,3)),o&&(n=Math.round(n)),void c.set(n);var n}},a.a.createElement(Rf.Arc,{arcWidth:3,color:"white",background:"#6c757a"}),a.a.createElement(Rf.Pointer,{width:3,height:11,radius:8,type:"rect",color:"white"})),a.a.createElement("div",{onClick:m,className:"knob-label"},n," : ",(g=u,Math.floor(10*g)/10)),v)}),Mf=(Object(g.b)(function(e,t){return void 0===t.parameter?{value:0}:{value:e.effects.effectParameters[t.parameter.id]}},null)(qf),1),Af=2;var If=new wt.a,Lf=Object(r.memo)(function(e){var t=e.name,n=e.setParameterToMap,r=e.parameter,i=e.value,s=e.onClick,o=e.isMacroMapping,c=e.isParameterToMap,u="parameter-button";e.isSelected&&(u+=" selected");var l;return a.a.createElement("div",{onClick:function(){return s(r)},className:u},function(){var e=r.parameter;if(o&&e){var t="macro-overlay";c&&(t+=" parameter-to-map"),e.hasMacro&&(t+=" mapped");var i={};e.hasMacro&&(i={backgroundColor:If.getColorForHash(e.hasMacro.id)});var s=e.hasMacro&&e.hasMacro.name;return a.a.createElement("div",{onClick:function(){return n(e)},className:t},a.a.createElement("div",{className:"overlay-main"}),a.a.createElement("div",{className:"overlay-detail",style:i},s))}return""}(),a.a.createElement("div",{className:"parameter-name"},t),a.a.createElement("div",{className:"parameter-value"},(l=i,Math.floor(100*l)/100)))}),Ff=Object(g.b)(function(e,t){return void 0===t.parameter?{value:0}:{value:e.effects.effectParameters[t.parameter.parameter.id],isMacroMapping:e.effects.isMacroMapping,isParameterToMap:t.parameter&&e.effects.parameterToMap===t.parameter.parameter,hasMacro:t.parameter.parameter.hasMacro}},function(e){return{setParameterToMap:function(t){return e(Object(O.bc)(t))}}})(Lf),Bf=Object(g.b)(function(e,t){return void 0===t.parameter?{value:0}:{value:t.parameter.parameter.get()}},null)(function(e){var t=e.parameter.parameter,n=t.min,r=t.max,i=t.value;return i=Math.cbrt(i),void 0!==e.parameter.min&&(n=e.parameter.min),void 0!==e.parameter.max&&(r=e.parameter.max),a.a.createElement("div",{className:"simple-parameter-slider"},a.a.createElement(xt.a,{value:i,change:function(t){return e.onChange(t)},step:.01,max:Math.cbrt(r),min:Math.cbrt(n),orientation:"horizontal",reversed:!1}))});function Hf(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Vf=function(e){Object(u.a)(n,e);var t=Hf(n);function n(e){var r;Object(o.a)(this,n),r=t.call(this,e);var a=e.parameters,i=a[Object.keys(a)[0]];return r.state={selectedParameter:i},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e){if(e.parameters!==this.props.parameters){var t=e.parameters,n=t[Object.keys(t)[0]];this.state.selectedParameter=n}return!0}},{key:"onSelect",value:function(e){this.setState({selectedParameter:e})}},{key:"onChangeValue",value:function(e){this.state.selectedParameter.parameter.set(Math.pow(e.target.value,3))}},{key:"render",value:function(){var e=this,t=this.props.parameters,n=void 0===this.props.showMods||this.props.showMods,r=Object.keys(t);return a.a.createElement("div",{className:"multiple-parameter-slider"},a.a.createElement("div",{className:"parameters"},r.map(function(n,r){return a.a.createElement(Ff,{key:"parameter-"+r,isSelected:t[n]===e.state.selectedParameter,onClick:function(t){return e.onSelect(t)},name:n,parameter:t[n]})})),a.a.createElement("div",{className:"slider-and-modulators"},a.a.createElement(Bf,{onChange:function(t){return e.onChangeValue(t)},parameter:this.state.selectedParameter}),n?a.a.createElement(Df,{sequencerEngine:this.props.sequencerEngine,parameter:this.state.selectedParameter.parameter}):""))}}]),n}(r.Component);function Uf(e){var t=Object(r.useState)(800),n=Object(j.a)(t,2),i=n[0],s=n[1],o=Object(r.useState)(!1),c=Object(j.a)(o,2),u=c[0],l=c[1],p=Object(r.useCallback)(Object(R.a)(N.a.mark(function t(){return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:l(!0),setTimeout(Object(R.a)(N.a.mark(function t(){return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.instrument.findLoop(void 0,.001,i);case 2:l(!1);case 3:case"end":return t.stop()}},t)})),50);case 2:case"end":return t.stop()}},t)})),[i,l]);return console.log("rendering isLoading = "+u),a.a.createElement("div",{className:"loop-finder"},a.a.createElement("div",{className:"samples-length-label"},"Length: ",i," - ",i+500," samples"),a.a.createElement(xt.a,{value:i,change:function(e){return s(e.target.value)},step:1,max:2e4,min:200,orientation:"horizontal",reversed:!1}),a.a.createElement("div",{onClick:function(){return p()},className:"loop-button"},u?a.a.createElement(v.a,{sizeUnit:"px",size:10,color:"#123abc",loading:u}):"New Loop"))}var Jf=1,_f=2,Gf=3,zf=4,Wf=5;function Kf(e){var t=e.instrument,n=e.sequencerEngine,i=e.sampler,s=Object(r.useState)(Jf),o=Object(j.a)(s,2),c=o[0],u=o[1],l="";if(c===Jf)l=a.a.createElement(Vf,{sequencerEngine:n,parameters:{Atk:{parameter:t.ampAttackParameter},Dcy:{parameter:t.ampDecayParameter},Sus:{parameter:t.ampSustainParameter},Rel:{parameter:t.ampReleaseParameter}}});else if(c===Gf)l=a.a.createElement("div",{className:"loop-container"},a.a.createElement(Vf,{sequencerEngine:n,parameters:{Strt:{parameter:t.loopStartParameter},Len:{parameter:t.loopLengthParameter},Smth:{parameter:t.smoothParameter}}}),a.a.createElement(Wu,{name:"Loop",parameter:t.loopParameter}));else if(c===_f){var p={Gld:{parameter:t.glideParameter},Detu:{parameter:t.detuneParameter}};i&&(p.Trspe={parameter:i.transposeParameter}),l=a.a.createElement(Vf,{sequencerEngine:n,parameters:p})}else l=c===zf?a.a.createElement(Uf,{instrument:t}):a.a.createElement(Gc,{parameters:t.parameters});var h=[];return t.parameters.forEach(function(e){return h=h.concat(e.parameterMods)}),a.a.createElement("div",{className:"top-parameter-container"},a.a.createElement("div",{className:"tab-options"},a.a.createElement(Qf,{option:Jf,name:"ADSR",isSelected:c===Jf,onClick:u}),a.a.createElement(Qf,{option:_f,name:"Pitch",isSelected:c===_f,onClick:u}),a.a.createElement(Qf,{option:Gf,name:"Loop",isSelected:c===Gf,onClick:u}),h.length>0?a.a.createElement(Qf,{option:Wf,name:"Mods ("+h.length+")",isSelected:c===Wf,onClick:u}):""),a.a.createElement("div",{className:"adsr-container"},l))}function Qf(e){var t="parameter-option";return e.isSelected&&(t+=" selected"),a.a.createElement("div",{onClick:function(){return e.onClick(e.option)},className:t},e.name)}new wt.a;var Xf=Object(g.b)(function(e,t){var n=t.track.selectedSampler;return{sampleDragging:e.selector.sampleDragging,sampleSlices:n?e.tracks.sampleSlices[n.id]:void 0,presetDragging:e.presets.presetDragging,sample:t.track.sample}},function(e,t){return{setSampleDragging:function(t){return e(Object(O.wc)(t))},setPresetDragging:function(t){return e(Object(O.mc)(t))}}})(function(e){var t=Object(r.useState)(void 0),n=Object(j.a)(t,2),i=(n[0],n[1]),s=e.track.instrument;Object(r.useCallback)(function(e){s.connectToTrack(e),i(e)}),Object(r.useEffect)(function(){i(s.connectedTrack)},[s.connectedTrack]);var o=Object(r.useState)(e.track.selectedSampler),c=Object(j.a)(o,2),u=c[0],l=c[1],p=Object(r.useState)(Object.keys(s.samplers).length>1),h=Object(j.a)(p,2),f=h[0],d=h[1];Object(r.useEffect)(function(){s.defaultSampler&&(l(s.defaultSampler),e.track.sample=s.defaultSampler.sample)},[]);var m=Object(r.useState)(""),v=Object(j.a)(m,2),g=(v[0],v[1]),y=Object(r.useCallback)(function(t){e.instrument.deleteSampler(u),g(""),l(s.allSamplers[0])},[u,l,e.instrument,g]),b=Object(r.useCallback)(function(t){void 0!==t&&(e.track.sample=t.sample,e.track.selectedSampler=t,u===t||l(t))},[u,l,e.track]),k=(Object(r.useCallback)(function(){s.playSampler(u)},[u]),Object(r.useCallback)(function(t){t.stopPropagation(),e.sampleDragging?(e.instrument.newSample(void 0,e.sampleDragging).then(function(t){var n=t.sampler;e.track.sample=n.sample,e.track.selectedSampler=n,l(n)}),e.setSampleDragging(void 0)):e.presetDragging&&(e.track.auditionPreset(e.presetDragging),e.setPresetDragging(void 0))},[e.track,l,e.sampleDragging,e.presetDragging,e.setPresetDragging]));return a.a.createElement("div",{onDrop:k,className:"instrument sampled-instrument"},a.a.createElement("div",null,a.a.createElement(Kh,{sequencerEngine:e.sequencerEngine,track:e.track,sample:e.track.sample,instrument:s,selectedSampler:u,deleteSample:y}),a.a.createElement("div",{className:"parameters-container"},a.a.createElement("div",{className:"pane"},a.a.createElement(Kf,{sampler:u,sequencerEngine:e.sequencerEngine,instrument:e.instrument})),a.a.createElement(lf,{showPianoRoll:f,toggleShowPiano:function(){return d(!f)},setSelectedSampler:b,sampler:u,instrument:s}))),a.a.createElement(Wc,{condition:f},a.a.createElement(Nf,{onClickSampler:b,selectedSampler:u,track:e.track,sampleDragging:e.sampleDragging,instrument:s})))});function Yf(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Zf=function(e){Object(u.a)(n,e);var t=Yf(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"getSelectedOscillatorType",value:function(){return this.props.oscillator.oscillatorType}},{key:"onSelectOscillatorType",value:function(e){var t="none"===e.value?void 0:e.value;this.props.sequencerEngine.operationManager.dispatch(yt(this.props.oscillator.oscillatorTypeParameter,t)),this.setState(this.state)}},{key:"render",value:function(){var e,t=this;return a.a.createElement("div",null,a.a.createElement("div",{className:"osc-type-dropdown-container"},a.a.createElement(Vc.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:$f,onChange:function(e){return t.onSelectOscillatorType(e)},value:(e=this.getSelectedOscillatorType(),$f.filter(function(t){return t.value===e})[0]),placeholder:"Osc. Type"})))}}]),n}(r.Component),$f=[{value:"square",label:"Square"},{value:"sine",label:"Sine"},{value:"triangle",label:"Triangle"},{value:"sawtooth",label:"Sawtooth"},{value:"pwm",label:"PWM"},{value:"pulse",label:"Pulse"},{value:"fatsquare",label:"Fat Square"},{value:"fatsine",label:"Fat Sine"},{value:"fattriangle",label:"Fat Triangle"},{value:"fatsawtooth",label:"Fat Sawtooth"},{value:"fmsquare",label:"FM Square"},{value:"fmsine",label:"FM Sine"},{value:"fmtriangle",label:"FM Triangle"},{value:"fmsawtooth",label:"FM Sawtooth"}];var ed=Object(g.b)(function(e,t){return{type:t.oscillator.oscillatorType}},null)(Zf);function td(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var nd=function(e){Object(u.a)(n,e);var t=td(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"onClickPartialCount",value:function(){this.props.oscillator.partialCountParameter.set((this.props.oscillator.partialCountParameter.get()+1)%16)}},{key:"render",value:function(){var e=this;this.props.oscillator;return a.a.createElement("div",{className:"partial-count-container"},a.a.createElement("div",{onClick:function(){return e.onClickPartialCount()},className:"partial-count"},this.props.value),a.a.createElement("div",null,"Partials"))}}]),n}(r.Component),rd=Object(g.b)(function(e,t){var n=t.oscillator.partialCountParameter;return{value:void 0===t.automation||void 0===t.automation.get(n)?e.effects.effectParameters[n.id]:t.automation.get(n).value}},null)(nd);function ad(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var id=[2,4,6,8,10,12,14,16,18],sd=[200,400,600,800,1e3,1200,1400,1600,1800],od=function(e){Object(u.a)(n,e);var t=ad(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={dragging:!1},r}return Object(c.a)(n,[{key:"updateParameter",value:function(e,t){this.props.sequencerEngine.operationManager.dispatch(yt(e,t))}},{key:"getHarmonicityX",value:function(e){return e/20*242}},{key:"getModulationIndexY",value:function(e){return 176-e/2e3*176}},{key:"getHelperLines",value:function(){return[a.a.createElement(Sc.Line,{closed:!1,points:[this.harmonicityX,0,this.harmonicityX,180],strokeWidth:1,stroke:"#0c46b2"}),a.a.createElement(Sc.Line,{closed:!1,points:[0,this.modulationIndexY,242,this.modulationIndexY],strokeWidth:1,stroke:"#0c46b2 "})]}},{key:"getHarmonicityLines",value:function(){var e=this;return id.map(function(t){return a.a.createElement(Sc.Line,{closed:!1,points:[e.getHarmonicityX(t),0,e.getHarmonicityX(t),180],strokeWidth:1,stroke:"#1f1f1f"})})}},{key:"getModulationIndexLines",value:function(){var e=this;return sd.map(function(t){return a.a.createElement(Sc.Line,{closed:!1,points:[0,e.getModulationIndexY(t),242,e.getModulationIndexY(t)],strokeWidth:1,stroke:"#1f1f1f"})})}},{key:"onMouseMove",value:function(e){var t=e.evt.layerX,n=e.evt.layerY;this.state.dragging&&this.setXAndY(t,n)}},{key:"setXAndY",value:function(e,t){this.harmonicity=Math.floor(20*e/242*1e3)/1e3,this.modulationIndex=Math.max(0,Math.floor(2e6*(176-t)/176)/1e3),this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.props.instrument.carrierOscillator;return a.a.createElement("div",null,a.a.createElement(Sc.Stage,{onMouseMove:function(t){return e.onMouseMove(t)},onClick:function(t){return e.setXAndY(t.evt.layerX,t.evt.layerY)},onMouseLeave:function(t){return e.dragging=!1},width:242,height:180},a.a.createElement(Sc.Layer,null,a.a.createElement(Sc.Rect,{width:242,height:180,fill:"black"}),this.getHarmonicityLines(),this.getModulationIndexLines(),this.getHelperLines(),a.a.createElement(Sc.Circle,{onMouseDown:function(t){return e.dragging=!0},onMouseUp:function(t){return e.dragging=!1},x:this.harmonicityX,y:this.modulationIndexY,radius:8,fill:"#6d6bff",stroke:"#0c46b2",strokeWidth:1}))),a.a.createElement(hu,{automation:this.props.automation,name:"Harmonicity",parameter:t.harmonicityParameter,lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,hideSlider:!0,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:20,step:.01}),a.a.createElement(hu,{automation:this.props.automation,name:"Modulation Index",lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,hideSlider:!0,parameter:t.modulationIndexParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:1e3,step:1}))}},{key:"dragging",set:function(e){this.setState({dragging:e})}},{key:"harmonicity",set:function(e){this.updateParameter(this.props.instrument.carrierOscillator.harmonicityParameter,e)},get:function(){return this.props.harmonicity}},{key:"modulationIndex",set:function(e){this.updateParameter(this.props.instrument.carrierOscillator.modulationIndexParameter,e)},get:function(){return this.props.modulationIndex}},{key:"harmonicityX",get:function(){return this.getHarmonicityX(this.harmonicity)}},{key:"modulationIndexY",get:function(){return this.getModulationIndexY(this.modulationIndex)}}]),n}(r.Component),cd=Object(g.b)(function(e,t){var n=t.instrument.carrierOscillator.harmonicityParameter,r=void 0===t.automation||void 0===t.automation.get(n)?e.effects.effectParameters[n.id]:t.automation.get(n).value,a=t.instrument.carrierOscillator.modulationIndexParameter;return{harmonicity:r,modulationIndex:void 0===t.automation||void 0===t.automation.get(a)?e.effects.effectParameters[a.id]:t.automation.get(a).value}},null)(od);function ud(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ld=function(e){Object(u.a)(n,e);var t=ud(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props.instrument.carrierOscillator,t=this.props.instrument.modulatorOscillator;return a.a.createElement("div",{className:"fm-parameters"},a.a.createElement("div",{className:"oscillator-types"},a.a.createElement("div",{className:"oscillator-type"},a.a.createElement(ed,{sequencerEngine:this.props.sequencerEngine,oscillator:t}),a.a.createElement(rd,{oscillator:t})),a.a.createElement("div",{className:"mod-label"},"mods"),a.a.createElement("div",{className:"oscillator-type"},a.a.createElement(ed,{sequencerEngine:this.props.sequencerEngine,oscillator:e}),a.a.createElement(rd,{oscillator:e}))),a.a.createElement(cd,{sequencerEngine:this.props.sequencerEngine,instrument:this.props.instrument}),a.a.createElement(hu,{automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,name:"Frequency",parameter:e.oscillatorFrequencyParameter,onParameterChanged:function(){return e.releaseAll()},displayFunction:function(e){return _i.a.fromTranspose(e).toString()},isParameter:!0,min:-32,max:32,step:1}),a.a.createElement(hu,{automation:this.props.automation,name:"Detune",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:e.detuneParameter,onParameterChanged:function(){return[]},isParameter:!0,min:-100,max:100,step:1}))}}]),n}(r.Component);function pd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var hd=function(e){Object(u.a)(n,e);var t=pd(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"getSelectedOscillatorType",value:function(){return this.props.oscillator.oscillatorType}},{key:"onSelectOscillatorType",value:function(e){var t="none"===e.value?void 0:e.value;this.props.oscillator.oscillatorType=t,this.setState(this.state)}},{key:"render",value:function(){var e=this.props.oscillator;return a.a.createElement("div",{className:"oscillator-component"},a.a.createElement(hu,{automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,name:"Polyphony",parameter:e.polyphonyParameter,onParameterChanged:function(){return[]},isParameter:!0,min:1,max:16,step:1}),a.a.createElement(hu,{automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,name:"Glide",parameter:e.portamentoParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:50,step:.1}))}}]),n}(r.Component);var fd=hd;function dd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}r.Component;var md=[{value:"square",label:"Square"},{value:"sine",label:"Sine"},{value:"triangle",label:"Triangle"},{value:"sawtooth",label:"Sawtooth"},{value:"pwm",label:"PWM"},{value:"pulse",label:"Pulse"},{value:"fatsquare",label:"Fat Square"},{value:"fatsine",label:"Fat Sine"},{value:"fattriangle",label:"Fat Triangle"},{value:"fatsawtooth",label:"Fat Sawtooth"},{value:"fmsquare",label:"FM Square"},{value:"fmsine",label:"FM Sine"},{value:"fmtriangle",label:"FM Triangle"},{value:"fmsawtooth",label:"FM Sawtooth"}];function vd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var gd=function(e){Object(u.a)(n,e);var t=vd(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={showMods:!1,showGenetix:!1},r.onClickMods=r.onClickMods.bind(Object(W.a)(r)),r.onClickGenetix=r.onClickGenetix.bind(Object(W.a)(r)),r}return Object(c.a)(n,[{key:"onClickMods",value:function(){this.setState({showMods:!this.state.showMods})}},{key:"onClickGenetix",value:function(){this.setState({showGenetix:!this.state.showGenetix})}},{key:"render",value:function(){var e=this,t=this.props.instrument;return a.a.createElement("div",{className:"instrument fm-synth"},a.a.createElement(Wc,{condition:!this.state.showMods&&!this.state.showGenetix},a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(ld,{sequencerEngine:this.props.sequencerEngine,instrument:t}),a.a.createElement("div",{className:"instrument-section"},a.a.createElement("div",{className:"instrument-subsection"},a.a.createElement("div",{className:"instrument-subsection-name"},"Filter"),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(hu,{automation:this.props.automation,name:"Cutoff",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:t.filterCutoffParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:1e4,step:1}),a.a.createElement(hu,{automation:this.props.automation,name:"Q",sequencerEngine:this.props.sequencerEngine,parameter:t.filterQParameter,lfoEnabled:!0,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:9,step:1}),a.a.createElement(hu,{automation:this.props.automation,name:"Noise Level",sequencerEngine:this.props.sequencerEngine,parameter:t.noiseVolumeParameter,lfoEnabled:!0,onParameterChanged:function(){return[]},unit:"db",isParameter:!0,min:-100,max:0,step:.1})),a.a.createElement("div",{className:"instrument-subsection"},a.a.createElement(fd,{automation:this.props.automation,oscillator:t.carrierOscillator,sequencerEngine:this.props.sequencerEngine,instrument:t}))),a.a.createElement("div",{className:"instrument-section"},a.a.createElement("div",{className:"instrument-subsection"},a.a.createElement(Ph,{automation:this.props.automation,envelopeOptions:yd,sequencerEngine:this.props.sequencerEngine,instrument:t})))),a.a.createElement(Wc,{condition:this.state.showGenetix},a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(Bp,{onClickBack:function(){return e.onClickGenetix()},track:this.props.track,instrument:t})),a.a.createElement(Wc,{condition:this.state.showMods},a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(xh,{instrument:t})),a.a.createElement(Wc,{condition:!this.state.showGenetix},a.a.createElement("div",{onClick:this.onClickMods,className:"mods-button common-button pink-button small-button"},this.state.showMods?"BACK":"MODS"),a.a.createElement("div",{onClick:this.onClickGenetix,className:"mods-button common-button pink-button small-button"},"GENETIX")))}}]),n}(r.Component),yd=[{value:Oh,label:"Amp"},{value:"FILTER",label:"Filter"},{value:"FILTER_2",label:"Filter 2"},{value:"MODULATION",label:"Modulation"}],bd=gd;function kd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ed=function(e){Object(u.a)(n,e);var t=kd(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={showMods:!1},r}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props.instrument;return a.a.createElement("div",{className:"instrument"},a.a.createElement("div",{className:"instrument-name"},this.props.instrument.getName()),a.a.createElement(Wc,{condition:!this.state.showMods},a.a.createElement("div",{className:"clear-fix"}),a.a.createElement("div",{className:"instrument-section"},a.a.createElement("div",{className:"instrument-subsection"},a.a.createElement("div",{className:"instrument-subsection-name"},"Filter"),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(hu,{effectNumber:0,name:"Frequency",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:e.frequencyParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:4e3,step:1}),a.a.createElement(hu,{effectNumber:0,name:"Resonance",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:e.resonanceParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:4e3,step:1}),a.a.createElement(hu,{effectNumber:0,name:"Harmonicity",sequencerEngine:this.props.sequencerEngine,parameter:e.harmonicityParameter,lfoEnabled:!0,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:200,step:1e-4}),a.a.createElement(hu,{effectNumber:0,name:"Modulation Index",sequencerEngine:this.props.sequencerEngine,parameter:e.modulationIndexParameter,lfoEnabled:!0,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:20,step:1e-4}))),a.a.createElement("div",{className:"instrument-section"},a.a.createElement("div",{className:"instrument-subsection"},a.a.createElement("div",{className:"instrument-subsection-name"},"Amp/Filter Envelope"),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(hu,{effectNumber:0,name:"Attack",parameter:e.attackParameter,sequencerEngine:this.props.sequencerEngine,onParameterChanged:function(){return[]},lfoEnabled:!0,isParameter:!0,min:0,max:6e3,step:1}),a.a.createElement(hu,{effectNumber:0,name:"Decay",sequencerEngine:this.props.sequencerEngine,parameter:e.decayParameter,onParameterChanged:function(){return[]},isParameter:!0,lfoEnabled:!0,min:0,max:6e3,step:1}),a.a.createElement(hu,{effectNumber:0,name:"Sustain",parameter:e.sustainParameter,onParameterChanged:function(){return[]},isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,min:0,max:1,step:.01}),a.a.createElement(hu,{effectNumber:0,sequencerEngine:this.props.sequencerEngine,name:"Release",parameter:e.releaseParameter,onParameterChanged:function(){return[]},lfoEnabled:!0,isParameter:!0,min:0,max:1e4,step:1})))))}}]),n}(r.Component);function Od(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Sd=function(e){Object(u.a)(n,e);var t=Od(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"getOscillatorOptions",value:function(){return[{value:"square",label:"Square"},{value:"sine",label:"Sine"},{value:"triangle",label:"Triangle"},{value:"sawtooth",label:"Sawtooth"},{value:"pwm",label:"PWM"},{value:"pulse",label:"Pulse"}]}},{key:"getOscillatorOption",value:function(e){for(var t=this.getOscillatorOptions(),n=0;n<t.length;n++)if(t[n].value==e)return t[n];return null}},{key:"getSelectedOscillatorType",value:function(){return this.props.instrument.oscillatorType}},{key:"onSelectOscillatorType",value:function(e){var t="none"===e.value?void 0:e.value;this.props.instrument.oscillatorType=t,this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.props.instrument;this.props.instrument.lfos[0];return a.a.createElement("div",{className:"instrument synth"},a.a.createElement("div",{className:"instrument-name"},this.props.instrument.getName()),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement("div",{className:"instrument-section"},a.a.createElement("div",{className:"instrument-subsection"},a.a.createElement("div",{className:"instrument-subsection-name"},"Oscillator"),a.a.createElement("div",{className:"osc-type-dropdown-container"},a.a.createElement(Vc.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.getOscillatorOptions(),onChange:function(t){return e.onSelectOscillatorType(t)},value:this.getOscillatorOption(this.getSelectedOscillatorType()),placeholder:"Osc. Type"})),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(hu,{name:"Frequency",automation:this.props.automation,parameter:t.oscillatorFrequencyParameter,onParameterChanged:function(){return t.releaseAll()},displayFunction:function(e){return _i.a.fromTranspose(e).toString()},isParameter:!0,min:-32,max:32,step:1}),a.a.createElement(hu,{name:"Detune",lfoEnabled:!0,automation:this.props.automation,instrument:t,lfos:t.lfos,parameter:t.detuneParameter,onParameterChanged:function(){return[]},isParameter:!0,min:-100,max:100,step:1}),a.a.createElement(hu,{lfoEnabled:!0,lfos:t.lfos,instrument:t,automation:this.props.automation,name:"Pulse Width",parameter:t.pulseWidthParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:1,step:.01}),a.a.createElement(hu,{name:"Polyphony",automation:this.props.automation,parameter:t.polyphonyParameter,onParameterChanged:function(){return[]},isParameter:!0,min:1,max:16,step:1}),a.a.createElement(hu,{name:"Glide",automation:this.props.automation,parameter:t.portamentoParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:50,step:.1})),a.a.createElement("div",{className:"instrument-subsection"},a.a.createElement("div",{className:"instrument-subsection-name"},"Filter"),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(hu,{name:"Cutoff",lfoEnabled:!0,automation:this.props.automation,lfos:t.lfos,instrument:t,parameter:t.filterCutoffParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:1e4,step:1}),a.a.createElement(hu,{name:"Q",lfoEnabled:!0,automation:this.props.automation,lfos:t.lfos,instrument:t,parameter:t.filterQParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:9,step:1}))),a.a.createElement("div",{className:"instrument-section"},a.a.createElement(Qp,{instrument:t}),a.a.createElement("div",{className:"instrument-subsection"},a.a.createElement("div",{className:"instrument-subsection-name"},"Amp Envelope"),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(hu,{automation:this.props.automation,name:"Amp Attack",lfoEnabled:!0,lfos:t.lfos,instrument:t,parameter:t.ampAttackParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:6e3,step:1}),a.a.createElement(hu,{automation:this.props.automation,name:"Amp Decay",lfoEnabled:!0,lfos:t.lfos,instrument:t,parameter:t.ampDecayParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:6e3,step:1}),a.a.createElement(hu,{name:"Amp Sustain",automation:this.props.automation,lfoEnabled:!0,lfos:t.lfos,instrument:t,parameter:t.ampSustainParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:1,step:.01}),a.a.createElement(hu,{name:"Amp Release",automation:this.props.automation,lfoEnabled:!0,lfos:t.lfos,instrument:t,parameter:t.ampReleaseParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:1e4,step:1}))),a.a.createElement("div",{className:"instrument-section"},a.a.createElement(Pd,{automation:this.props.automation,instrument:t})))}}]),n}(r.Component),Pd=function(e){Object(u.a)(n,e);var t=Od(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props.instrument.filterEnvelope;return a.a.createElement("div",{className:"instrument-subsection"},a.a.createElement("div",{className:"instrument-subsection-name"},"Filter Envelope"),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(hu,{name:"Frequency",parameter:e.baseFrequencyParameter,automation:this.props.automation,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:1e4,step:1}),a.a.createElement(hu,{name:"Octaves",parameter:e.octavesParameter,automation:this.props.automation,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:8,step:.1}),a.a.createElement(hu,{name:"Attack",parameter:e.attackParameter,automation:this.props.automation,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:8e3,step:1}),a.a.createElement(hu,{name:"Decay",parameter:e.decayParameter,automation:this.props.automation,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:8e3,step:1}),a.a.createElement(hu,{name:"Sustain",parameter:e.sustainParameter,automation:this.props.automation,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:1,step:.01}),a.a.createElement(hu,{name:"Release",automation:this.props.automation,parameter:e.releaseParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:8e3,step:1}))}}]),n}(r.Component),wd=Sd;function jd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Td=function(e){Object(u.a)(n,e);var t=jd(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"handleOptionChange",value:function(e){console.log("handleOptionChange("+e+")"),this.props.effect.setSideChainedTrack(this.props.tracks[e],e)}},{key:"getSideChainedTrack",value:function(){var e=this.props.effect.connectedTrack;return void 0===e?0:this.props.tracks.indexOf(e)+1}},{key:"getOptions",value:function(){return this.props.sequencerEngine.tracks.map(function(e){return{label:"Track "+(e.trackNumber+1),value:e.trackNumber}})}},{key:"getOption",value:function(e){if(void 0!==e)return this.getOptions().filter(function(t){return t.value===e.trackNumber})[0]}},{key:"render",value:function(){var e=this;void 0!==this.props.automation||this.props.effect.isEnabled();return a.a.createElement("div",null,this.props.effect.isEnabled()?a.a.createElement("div",null,a.a.createElement("div",{className:"sidechain-container"},a.a.createElement("div",{className:"parameter-label"},"Sidechain: "),a.a.createElement(Vc.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.getOptions(),onChange:function(t){return e.handleOptionChange(t.value)},value:this.getOption(this.props.effect.connectedTrack),placeholder:"None"})),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Smoothing",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,selectedParameter:this.props.selectedParameter,parameter:this.props.effect.smoothingParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:1e-4,max:2,min:1e-5}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Threshold",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,selectedParameter:this.props.selectedParameter,parameter:this.props.effect.thresholdParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.01,max:6,min:-120})):"")}}]),n}(r.Component);function xd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Cd=function(e){Object(u.a)(n,e);var t=xd(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"render",value:function(){var e=this,t=void 0!==this.automation?"enabled effect effect-automation":"effect enabled";return a.a.createElement("div",{className:t},a.a.createElement("div",{className:"effect-name"},"Pan"),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(xt.a,{value:this.props.panning,change:function(t){return e.props.onChangePanning(t.target.value)},step:.01,max:1,min:-1,orientation:"vertical",reversed:!1}))}}]),n}(r.Component);var Nd=Object(g.b)(function(e,t){return{value:t.effect.type}},null)(function(e){var t=e.effect,n=e.value,i=[{label:"Lowpass",value:"lowpass"},{label:"Highpass",value:"highpass"},{label:"Bandpass",value:"bandpass"},{label:"Notch",value:"notch"},{label:"Peaking",value:"peaking"}],s=Object(r.useCallback)(function(e){t.type=e},[]);return a.a.createElement("div",{className:"filter-dropdown-container"},a.a.createElement("div",{className:"dropdown-label"},"Type: "),a.a.createElement(Vc.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:i,onChange:function(e){return s(e.value)},value:function(e){return i.find(function(t){return t.value===e})}(n),placeholder:"Type"}))});function Rd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Dd=function(e){Object(u.a)(n,e);var t=Rd(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={filterEffect:e.filterEffect,refined:!1},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.filterEffect=e.filterEffect,!0}},{key:"handleOptionChange",value:function(e){document.activeElement.blur(),"lowpass"===e.target.value?this.state.filterEffect.lowpass():this.state.filterEffect.hipass(),this.setState(this.state)}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.filterEffect.isEnabled()}},{key:"onChangeRefined",value:function(e){this.setState({refined:"refined"===e})}},{key:"render",value:function(){var e=this,t=(this.state.filterEffect.type,void 0!==this.props.automation||this.state.filterEffect.isEnabled(),this.state.refined?400:1e4);return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement(Nd,{effect:this.props.filterEffect}),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(hu,{customClassName:"wider-slider",effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,name:"Cutoff",lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,unit:"HZ",parameter:this.state.filterEffect.cutoffParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:1,max:t,min:20}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,name:"Q",lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,parameter:this.state.filterEffect.qParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:1,max:10,min:0}),a.a.createElement("div",{className:""},a.a.createElement("label",null,a.a.createElement("input",{type:"checkbox",value:this.state.refined?"unrefined":"refined",checked:this.state.refined,onChange:function(t){return e.onChangeRefined(t.target.value)}}),"Refine"))):"")}}]),n}(r.Component);function qd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Md=function(e){Object(u.a)(n,e);var t=qd(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={filterEffect:e.filterEffect,frequency:e.filterEffect.getStoredLFOTime()},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.filterEffect=e.filterEffect,!0}},{key:"handleOptionChange",value:function(e){"lowpass"===e.target.value?this.state.filterEffect.lowpass():this.state.filterEffect.hipass(),this.setState(this.state)}},{key:"handleLFOTimeChange",value:function(e){this.state.frequency=e,this.state.filterEffect.setLFOTime(e()),this.setState(this.state)}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.filterEffect.isEnabled()}},{key:"render",value:function(){var e=this,t=this.state.filterEffect.getFilterType();this.state.filterEffect.getLFOTime(),void 0!==this.props.automation||this.state.filterEffect.isEnabled();return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement("form",null,a.a.createElement("div",{className:"radio"},a.a.createElement("label",null,a.a.createElement("input",{className:"filter-radio",type:"radio",value:"lowpass",checked:"lowpass"===t,onChange:function(t){return e.handleOptionChange(t)}}),"Lowpass"),a.a.createElement("label",null,a.a.createElement("input",{className:"filter-radio",type:"radio",value:"hipass",checked:"highpass"===t,onChange:function(t){return e.handleOptionChange(t)}}),"Hipass"),a.a.createElement(Vc.a,{className:"delay-time-dropdown",options:Ad,onChange:function(t){return e.handleLFOTimeChange(t.value)},value:Id(this.state.frequency),placeholder:"Delay Time"}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,name:"Cutoff",unit:"HZ",parameter:this.state.filterEffect.effectNode.baseFrequency,onParameterChanged:this.props.onParameterChanged,updateFunction:function(t){return e.state.filterEffect.effectNode.baseFrequency=t},getValue:function(){return e.state.filterEffect.effectNode.baseFrequency},step:5,max:1e4,min:10}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,name:"Octaves",parameter:this.state.filterEffect.effectNode.octaves,updateFunction:function(t){return e.state.filterEffect.effectNode.octaves=t},onParameterChanged:this.props.onParameterChanged,getValue:function(){return e.state.filterEffect.effectNode.octaves},step:.1,max:10,min:0}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,name:"Q",parameter:this.state.filterEffect.qParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:1,max:10,min:0})))):"")}}]),n}(r.Component),Ad=[{value:function(){return.03125*new x.a.Time("1m")},label:"4"},{value:function(){return.125*new x.a.Time("1m")},label:"2"},{value:function(){return.25*new x.a.Time("1m")},label:"1"},{value:function(){return.5*new x.a.Time("1m")},label:"1/2"},{value:function(){return.5*new x.a.Time("2m")},label:"1/4"},{value:function(){return 2*new x.a.Time("1m")},label:"1/8"},{value:function(){return 3*new x.a.Time("1m")},label:"1/8t"},{value:function(){return 4*new x.a.Time("1m")},label:"1/16"},{value:function(){return 6*new x.a.Time("1m")},label:"1/16t"},{value:function(){return 8*new x.a.Time("1m")},label:"1/32"}];function Id(e){e="function"===typeof e?e():e;var t=Ad.filter(function(t){return t.value()===e});return 0==t.length?Ad[0]:t[0]}var Ld=Md;function Fd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Bd=function(e){Object(u.a)(n,e);var t=Fd(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={reverbEffect:e.reverbEffect},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.reverbEffect=e.reverbEffect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.reverbEffect.isEnabled()}},{key:"render",value:function(){Math.round(10*this.state.reverbEffect.getRoomSize()),this.state.reverbEffect.getDampening(),this.state.reverbEffect.getWet(),void 0!==this.props.automation||this.state.reverbEffect.isEnabled();return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,name:"Room Size",parameter:this.state.reverbEffect.roomSizeParameter,lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.01,max:1,min:0}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,name:"Dampening",lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,parameter:this.state.reverbEffect.dampeningParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:100,max:8e3,min:0}),a.a.createElement(_u,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.state.reverbEffect})):"")}}]),n}(r.Component);function Hd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Vd=function(e){Object(u.a)(n,e);var t=Hd(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={reverbEffect:e.reverbEffect},r.getConvolverType(),r.getConvolverThumbnail(),r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return e.reverbEffect!==this.props.reverbEffect&&(this.state.reverbEffect=e.reverbEffect,this.getConvolverType(),this.getConvolverThumbnail()),!0}},{key:"handleConvolverTypeChange",value:function(e){this.state.reverbEffect.setConvolverType(e),this.getConvolverType(),this.getConvolverThumbnail(),this.setState(this.state)}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.isEnabled}},{key:"getConvolverThumbnail",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.state.reverbEffect).convolverSample){e.next=7;break}return e.next=4,d.a.getVideoIdForSound(t.convolverSample);case 4:n=e.sent,r="https://img.youtube.com/vi/"+n+"/1.jpg",this.setState({thumbnail:r});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getConvolverType",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.state.reverbEffect).convolverSample){e.next=9;break}return e.next=4,d.a.getTitleForSound(t.convolverSample);case 4:n=e.sent,this.state.convolverType={label:n,value:t.convolverSample},this.setState(this.state),e.next=13;break;case 9:r=Ud.filter(function(e){return e.value===t.convolverType}),this.state.convolverType=r[0],this.state.thumbnail=void 0,this.setState(this.state);case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onDrop",value:function(){var e=Object(R.a)(N.a.mark(function e(t){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.props.sampleDragging){e.next=9;break}return t.stopPropagation(),e.next=4,this.props.reverbEffect.setConvolverSample(this.props.sampleDragging.getId());case 4:return e.next=6,this.getConvolverType();case 6:return e.next=8,this.getConvolverThumbnail();case 8:this.props.setSampleDragging(void 0);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;this.state.reverbEffect.getWet(),void 0!==this.props.automation||this.state.reverbEffect.isEnabled();return a.a.createElement("div",{onDrop:function(t){return e.onDrop(t)}},this.isEnabled()?a.a.createElement("div",null,a.a.createElement(Vc.a,{className:"delay-time-dropdown",options:Ud,onChange:function(t){return e.handleConvolverTypeChange(t.value)},value:this.state.convolverType,placeholder:"Delay Time"}),a.a.createElement(Wc,{condition:this.state.thumbnail},a.a.createElement("img",{className:"convolver-thumbnail",src:this.state.thumbnail})),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Pitch",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,parameter:this.state.reverbEffect.pitchParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.1,max:24,min:-24}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Attack",unit:"%",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,parameter:this.state.reverbEffect.attackParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.1,max:100,min:0}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Release",unit:"%",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,parameter:this.state.reverbEffect.durationParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.1,max:100,min:0}),a.a.createElement(_u,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.state.reverbEffect})):"")}}]),n}(r.Component),Ud=[{value:"Giant Cave",label:"Giant Cave"},{value:"Hangar",label:"Airport Hangar"},{value:"Airport Terminal",label:"Airport Terminal"},{value:"Outdoor Blastoff",label:"Outdoor Blastoff"},{value:"Outdoor Stadium",label:"Outdoor Stadium"},{value:"Plate Large",label:"Plate Large"},{value:"Plate Medium",label:"Plate Medium"},{value:"Plate Small",label:"Plate Small"},{value:"Plate Super Dry",label:"Plate Super Dry"},{value:"Prime Long",label:"Prime Long"},{value:"Prime Medium",label:"Prime Medium"},{value:"Prime Short",label:"Prime Short"},{value:"Prime Extra Long",label:"Prime Extra Long"},{value:"Room Concert Hall",label:"Room Concert Hall"},{value:"Room Huge",label:"Room Huge"},{value:"Room Large",label:"Room Large"},{value:"Room Medium",label:"Room Medium"},{value:"Room Pool",label:"Room Pool"}],Jd=Object(g.b)(function(e,t){return{sampleDragging:e.selector.sampleDragging,isEnabled:t.reverbEffect.enabledParameter.get()}},function(e,t){return{setSampleDragging:function(t){return e(Object(O.wc)(t))}}})(Vd);function _d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Gd=function(e){Object(u.a)(n,e);var t=_d(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={chorusEffect:e.chorusEffect},r}return Object(c.a)(n,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.chorusEffect.isEnabled()}},{key:"render",value:function(){void 0!==this.props.automation||this.state.chorusEffect.isEnabled();return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Rate",selectedParameter:this.props.selectedParameter,parameter:this.state.chorusEffect.rateParameter,onParameterChanged:this.props.onParameterChanged,lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,isParameter:!0,step:.1,max:4,min:0}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Depth",selectedParameter:this.props.selectedParameter,parameter:this.state.chorusEffect.depthParameter,onParameterChanged:this.props.onParameterChanged,lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,isParameter:!0,step:.1,max:100,min:0}),a.a.createElement(_u,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.state.chorusEffect})):"")}}]),n}(r.Component);function zd(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Wd=function(e){Object(u.a)(n,e);var t=zd(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={tremoloEffect:e.tremoloEffect},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.tremoloEffect=e.tremoloEffect,!0}},{key:"handleDepthChange",value:function(e){this.state.tremoloEffect.setDepth(e),this.setState(this.state)}},{key:"handleRateChange",value:function(e){this.state.tremoloEffect.setRate(e),this.setState(this.state)}},{key:"handleWetChange",value:function(e){this.state.tremoloEffect.setWet(e),this.setState(this.state)}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.tremoloEffect.isEnabled()}},{key:"render",value:function(){var e=this;Math.round(10*this.state.tremoloEffect.getRate()),this.state.tremoloEffect.getDepth(),this.state.tremoloEffect.getWet(),void 0!==this.props.automation||this.state.tremoloEffect.isEnabled();return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Rate",selectedParameter:this.props.selectedParameter,displayFunction:function(t){return Math.round(10*e.state.tremoloEffect.getRate())/10},lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,onParameterChanged:this.props.onParameterChanged,parameter:this.state.tremoloEffect.rateParameter,isParameter:!0,step:.1,max:16,min:0}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Depth",selectedParameter:this.props.selectedParameter,parameter:this.state.tremoloEffect.depthParameter,onParameterChanged:this.props.onParameterChanged,lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,isParameter:!0,step:.1,max:1,min:0}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Spread",selectedParameter:this.props.selectedParameter,parameter:this.state.tremoloEffect.spreadParameter,onParameterChanged:this.props.onParameterChanged,lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,isParameter:!0,step:1,max:360,min:0}),a.a.createElement(_u,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,onParameterChanged:this.props.onParameterChanged,effect:this.state.tremoloEffect})):"")}}]),n}(r.Component),Kd=40;function Qd(e,t,n,r,a){var i=e.target.getBoundingClientRect(),s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,a=e/r,i=Math.pow(a,1.5);return t+(n-t)*i}(e.clientX-i.left,n,r,a);return isNaN(s)?-100:s}function Xd(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(e-t)/(n-t)}(e,t,n,r);return r*Math.sqrt(a)}var Yd=Object(g.b)(function(e,t){return void 0===t.track?{}:{volume:t.track.volumeParameter.get()}},null)(function(e){var t=e.track,n=e.rackTrack,i=e.volume,s=e.id,o=e.onVolumeChange,c=e.min,u=void 0===c?-40:c,l=e.max,p=void 0===l?4:l,h=e.width,f=void 0===h?Kd:h,d=e.display,m=(e.onVolumeChange2,Object(r.useState)(!1)),v=Object(j.a)(m,2),g=v[0],y=v[1],b={width:Xd(i,u,p,f)},k=function(){return s||"volume-"+n.trackNumber+"-"+t.trackNumber},E=Object(r.useCallback)(function(e){e.stopPropagation();var n=Qd(e,k(),u,p,f);o?o(n):t.volumeParameter.set(n,.01),y(!0)},[t,y]),O=Object(r.useCallback)(function(e){if(e.stopPropagation(),g){var n=Qd(e,k(),u,p,f);o?o(n):t.volumeParameter.set(n)}},[t,g]),S=function(e){return Math.round(10*e)/10};return a.a.createElement("div",{style:{width:f},id:k(),onClick:function(e){return e.stopPropagation()},onMouseUp:function(e){e.stopPropagation(),y(!1)},onMouseLeave:function(e){e.stopPropagation(),y(!1)},onMouseMove:O,onMouseDown:E,className:"volume-box"},a.a.createElement("div",{style:b,className:"volume-indicator"}),S(d?d(i):i)," db")}),Zd=new wt.a,$d=Object(g.b)(function(e,t){var n=t.track.track;return{id:void 0!==n.sample&&void 0!==n.sample.getId()?n.sample.getId():n.presetName||n.getName()}},null)(function(e){e.showMods;var t=e.name,n=e.rackTrack,r=e.track,i=e.onSelect,s=e.isSelected,o=e.onDelete,c=(e.id,"track-slot"),u={};return s&&(c+=" selected",u.backgroundColor=Zd.getColorForTrack(r.track)),t.length>16&&(t=t.substring(0,16)+"..."),a.a.createElement("div",{onClick:i,className:c,style:u},a.a.createElement("div",{className:"sub-instrument-name"},t),a.a.createElement(Yd,{rackTrack:n,track:r}),a.a.createElement(Wc,{condition:s},a.a.createElement("div",{onClick:o,className:"delete-button"},"x")))});n(1667);var em=Object(g.b)(function(e,t){return{instrumentTypeDragging:e.instruments.instrumentTypeDragging,presetDragging:e.presets.presetDragging,sampleDragging:e.selector.sampleDragging}},function(e,t){return{setInstrumentTypeDragging:function(t){return e(Object(O.zb)(t))},setPresetDragging:function(t){return e(Object(O.mc)(t))},setSampleDragging:function(t){return e(Object(O.wc)(t))}}})(function(e){var t=Object(r.useCallback)(function(t){t.stopPropagation(),e.instrumentTypeDragging?(e.newInstrument(e.instrumentTypeDragging),e.setInstrumentTypeDragging(void 0)):e.presetDragging?(e.newPreset(e.presetDragging),e.setPresetDragging(void 0)):e.sampleDragging&&(e.newSample(e.sampleDragging),e.setSampleDragging(void 0))},[e.instrumentTypeDragging,e.newInstrument,e.newPreset,e.newSample,e.presetDragging,e.sampleDragging]);return a.a.createElement("div",{onDragOver:function(e){return e.preventDefault()},onDrop:t,className:"drop-here"},a.a.createElement("span",null,"Drop inst, preset or sample here"))});var tm=Object(g.b)(function(e,t){return{selectedInstrument:e.tracks.selectedRackSubTrack[t.track.id],tracks:t.track.tracks}},function(e,t){return{setSelectedInstrument:function(n){return e(Object(O.Hc)(t.track.id,n))}}})(function(e){var t=e.track,n=e.selectedInstrument,i=e.setSelectedInstrument,s=Object(r.useState)(t.tracks),o=Object(j.a)(s,2),c=o[0],u=o[1],l=Object(r.useState)(!1),p=Object(j.a)(l,2),h=p[0],f=p[1],d=Object(r.useCallback)(function(e){var n=t.addInstrumentType(e);u(Object(M.a)(t.tracks)),i(n)},[t,u,i]);Object(r.useEffect)(function(){u(t.tracks)},[t.tracks,u]);var m=Object(r.useCallback)(function(){var e=Object(R.a)(N.a.mark(function e(n){var r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.addPreset(n);case 2:r=e.sent,u(Object(M.a)(t.tracks)),i(r);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[t,u,i]),v=Object(r.useCallback)(function(){var e=Object(R.a)(N.a.mark(function e(n){var r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.addSample(n);case 2:r=e.sent,u(Object(M.a)(t.tracks)),i(r);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[t,u,i]),g=Object(r.useCallback)(function(){t.deleteInstrument(n),i(void 0),u(Object(M.a)(t.tracks))},[t,u,i,n]),y=t.tracks.indexOf(n)>-1?function(e){var t=e.sequencerEngine;return a.a.createElement(og.EffectsView,{hideLock:!0,store:t.store,sequencerEngine:t,onParameterChanged:function(e){return[]},onEffectsChange:function(){return e.updateEffects()},panning:0,onChangePanning:function(e){return console.log("panning changed = "+e)},sends:t.sends,tracks:[],track:e,send:void 0,group:void 0})}(n.track):"",b=Object(r.useCallback)(function(){var e=Object(R.a)(N.a.mark(function e(n){var r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getCopy();case 2:r=e.sent,t.addInstrument(r),i(void 0),u(Object(M.a)(t.tracks));case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[u]),k=t.tracks.indexOf(n)>-1?function(e,t,n,r){var i=e.track.sequencerEngine,s=r?"toolbar-button selected":"toolbar-button";return a.a.createElement("div",null,a.a.createElement(Vf,{sequencerEngine:i,parameters:{Vol:{parameter:e.volumeParameter,min:-40,max:0}}}),a.a.createElement("div",{className:"toolbar"},a.a.createElement("div",{onClick:function(){return t(e)},className:"toolbar-button"},"Duplicate"),a.a.createElement("div",{onClick:function(){return n(!r)},className:s},"Mods")))}(n,b,f,h):"";return a.a.createElement("div",{className:"instrument instrument-rack"},a.a.createElement("div",{className:"instrument-rack-controller"},c.map(function(e){return a.a.createElement($d,{name:e.presetName||e.getName(),key:e.presetName||e.getName(),rackTrack:t,isSelected:n===e,onDelete:function(){return g()},onSelect:function(){return i(e===n?void 0:e)},track:e})}),k,h&&n?a.a.createElement(Gc,{parameters:n.getAllParameters(),setShowMods:f,showMods:h}):"",a.a.createElement(em,{newInstrument:d,newPreset:m,newSample:v,track:t})),y)});function nm(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var rm=function(e){Object(u.a)(n,e);var t=nm(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={delayEffect:e.delayEffect},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.delayEffect=e.delayEffect,!0}},{key:"handleOptionChange",value:function(e){this.setState(this.state)}},{key:"handleFeedbackChange",value:function(e){this.state.delayEffect.setFeedback(e),this.setState(this.state)}},{key:"handleDelayTimeChange",value:function(e){this.props.sequencerEngine.operationManager.dispatch(yt(this.state.delayEffect.rateParameter,e.value)),this.setState(this.state)}},{key:"handleWetChange",value:function(e){this.state.delayEffect.setWet(e),this.setState(this.state)}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.delayEffect.isEnabled()}},{key:"onChangeSynced",value:function(e){document.activeElement.blur(),this.delay.isSynced="unsynced"===e,this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.state.delayEffect,n=(t.getFeedback(),t.rawDelayRate,t.isSynced);t.getWet(),void 0!==this.props.automation||t.isEnabled();return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement("div",{className:"refined-checkbox-preferences lfo-synced-checkbox"},a.a.createElement("label",null,a.a.createElement("input",{type:"checkbox",value:n?"synced":"unsynced",checked:n,onChange:function(t){return e.onChangeSynced(t.target.value)}}),"Synced")),n?a.a.createElement("div",{className:"lfo-rate-dropdown"},a.a.createElement("div",{className:"lfo-rate-label"},"Rate:"),a.a.createElement(Vc.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:am,onChange:function(t){return e.handleDelayTimeChange(t)},value:im(this.delay.rawDelayRate),placeholder:"Rate"}),a.a.createElement("div",{className:"clear-fix"})):a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Rate",parameter:this.state.delayEffect.rateParameter,onParameterChanged:this.props.onParameterChanged,sequencerEngine:this.props.sequencerEngine,isParameter:!0,lfoEnabled:!0,step:1,min:1,max:1e3}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Feedback",lfoEnabled:!0,selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,unit:"%",parameter:this.state.delayEffect.feedbackParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,displayFunction:function(e){return Math.floor(100*e)},step:.01,max:1,min:0}),a.a.createElement(_u,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.state.delayEffect})):"")}},{key:"delay",get:function(){return this.state.delayEffect}}]),n}(r.Component),am=[{value:"1n",label:"1"},{value:"2n",label:"1/2"},{value:"4n",label:"1/4"},{value:"4t",label:"1/4t"},{value:"8n",label:"1/8"},{value:"8n.",label:"1/8."},{value:"8t",label:"1/8t"},{value:"16n",label:"1/16"},{value:"16t",label:"1/16t"},{value:"32n",label:"1/32"}];function im(e){var t=am.filter(function(t){return t.value===e});return 0==t.length?"16n":t[0]}var sm=Object(g.b)(function(e,t){return{rate:t.delayEffect.rateParameter.get(),isEnabled:t.delayEffect.isEnabled()}},null)(rm);function om(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var cm=function(e){Object(u.a)(n,e);var t=om(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={effect:e.effect},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){this.state.effect.compressorNode,this.state.effect.effectNode,void 0!==this.props.automation||this.state.effect.isEnabled();return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Gain",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:this.state.effect.gainParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.1,max:6,min:.1}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Threshold",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,selectedParameter:this.props.selectedParameter,parameter:this.state.effect.thresholdParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.1,max:8,min:-80}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Ratio",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,selectedParameter:this.props.selectedParameter,parameter:this.state.effect.ratioParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:20,min:1}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Knee",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,selectedParameter:this.props.selectedParameter,parameter:this.state.effect.kneeParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:40,min:0}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Attack",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,selectedParameter:this.props.selectedParameter,parameter:this.state.effect.attackParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.001,max:1,min:0}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Release",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:this.state.effect.releaseParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.001,max:1,min:.1})):"")}}]),n}(r.Component);function um(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var lm=function(e){Object(u.a)(n,e);var t=um(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={effect:e.effect},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){this.state.effect.compressorNode,this.state.effect.effectNode,void 0!==this.props.automation||this.state.effect.isEnabled();return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Order",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:this.state.effect.orderParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:1,max:100,min:1}),a.a.createElement(_u,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.state.effect})):"")}}]),n}(r.Component);function pm(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var hm=function(e){Object(u.a)(n,e);var t=pm(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={effect:e.effect},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){void 0!==this.props.automation||this.state.effect.isEnabled();return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Low",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.lowParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:10,min:-10}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Mid",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.midParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:10,min:-10}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"High",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.highParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:10,min:-10}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Low Frequency",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.lowFrequencyParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:10,max:400,min:0}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"High Frequency",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.highFrequencyParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:10,max:1e4,min:1e3})):"")}}]),n}(r.Component);function fm(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var dm=function(e){Object(u.a)(n,e);var t=fm(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={effect:e.effect},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){var e,t,n,r,i,s,o,c;void 0!==this.props.automation||this.state.effect.isEnabled();return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement(hu,(e={effectNumber:this.props.effectNumber,automation:this.props.automation,name:"31",unit:"db",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.gain31Parameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,step:.1,max:12,min:-12},Object(An.a)(e,"isParameter",!0),Object(An.a)(e,"lfoEnabled",!0),e)),a.a.createElement(hu,(t={effectNumber:this.props.effectNumber,automation:this.props.automation,name:"63",sequencerEngine:this.props.sequencerEngine,unit:"db",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.gain63Parameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:12,min:-12},Object(An.a)(t,"isParameter",!0),Object(An.a)(t,"lfoEnabled",!0),t)),a.a.createElement(hu,(n={effectNumber:this.props.effectNumber,automation:this.props.automation,name:"125",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.gain125Parameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,unit:"db",step:.1,max:12,min:-12,sequencerEngine:this.props.sequencerEngine},Object(An.a)(n,"isParameter",!0),Object(An.a)(n,"lfoEnabled",!0),n)),a.a.createElement(hu,(r={effectNumber:this.props.effectNumber,automation:this.props.automation,name:"250",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.gain250Parameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,unit:"db",step:.1,max:12,min:-12,sequencerEngine:this.props.sequencerEngine},Object(An.a)(r,"isParameter",!0),Object(An.a)(r,"lfoEnabled",!0),r)),a.a.createElement(hu,(i={effectNumber:this.props.effectNumber,automation:this.props.automation,name:"500",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,parameter:this.state.effect.gain500Parameter,onParameterChanged:this.props.onParameterChanged,unit:"db",isParameter:!0,step:.1,max:12,min:-12},Object(An.a)(i,"isParameter",!0),Object(An.a)(i,"lfoEnabled",!0),i)),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,name:"1k",unit:"db",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.gain1kParameter,onParameterChanged:this.props.onParameterChanged,lfoEnabled:!0,isParameter:!0,step:.1,max:12,min:-12}),a.a.createElement(hu,(s={effectNumber:this.props.effectNumber,automation:this.props.automation,name:"2k",unit:"db",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,parameter:this.state.effect.gain2kParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:12,min:-12},Object(An.a)(s,"isParameter",!0),Object(An.a)(s,"lfoEnabled",!0),s)),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"4k",unit:"db",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.gain4kParameter,onParameterChanged:this.props.onParameterChanged,lfoEnabled:!0,isParameter:!0,step:.1,max:12,sequencerEngine:this.props.sequencerEngine,min:-12}),a.a.createElement(hu,(o={effectNumber:this.props.effectNumber,automation:this.props.automation,name:"8k",unit:"db",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.gain8kParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:12,min:-12,sequencerEngine:this.props.sequencerEngine},Object(An.a)(o,"isParameter",!0),Object(An.a)(o,"lfoEnabled",!0),o)),a.a.createElement(hu,(c={effectNumber:this.props.effectNumber,automation:this.props.automation,unit:"db",name:"16k",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.gain16kParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:12,min:-12,sequencerEngine:this.props.sequencerEngine},Object(An.a)(c,"isParameter",!0),Object(An.a)(c,"lfoEnabled",!0),c))):"")}}]),n}(r.Component);function mm(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var vm=function(e){Object(u.a)(n,e);var t=mm(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"compressor-part"},a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Threshold",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,selectedParameter:this.props.selectedParameter,parameter:this.props.effect.thresholdParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.1,max:8,min:-80}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Ratio",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,selectedParameter:this.props.selectedParameter,parameter:this.props.effect.ratioParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:20,min:1}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Knee",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,selectedParameter:this.props.selectedParameter,parameter:this.props.effect.kneeParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:40,min:0}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Attack",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,selectedParameter:this.props.selectedParameter,parameter:this.props.effect.attackParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.001,max:1,min:0}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Release",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:this.props.effect.releaseParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.001,max:1,min:.1}))}}]),n}(r.Component);function gm(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ym="LOW",bm=function(e){Object(u.a)(n,e);var t=gm(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={selectedPart:ym},r}return Object(c.a)(n,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"onSelectCompressor",value:function(e){e=e.value,this.setState({selectedPart:e})}},{key:"getCompressor",value:function(){var e=this;return this.props.effect.compressors.find(function(t){return t.name===e.state.selectedPart})}},{key:"render",value:function(){var e=this;return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement("div",{className:"osc-type-dropdown-container"},a.a.createElement(Vc.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:km,onChange:function(t){return e.onSelectCompressor(t)},value:Em(this.state.selectedPart),placeholder:"LFO"})),a.a.createElement(vm,{selectedParameter:this.props.selectedParameter,automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,onParameterChanged:this.props.onParameterChanged,effect:this.getCompressor(),effectNumber:this.props.effectNumber})):"")}}]),n}(r.Component),km=[{value:"LOW",label:"Low"},{value:"MID",label:"Mid"},{value:"HIGH",label:"High"}];function Em(e){for(var t=0;t<km.length;t++)if(km[t].value==e)return km[t];return null}var Om=bm;function Sm(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Pm=function(e){Object(u.a)(n,e);var t=Sm(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={effect:e.effect},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){this.state.effect.compressorNode,this.state.effect.effectNode,void 0!==this.props.automation||this.state.effect.isEnabled();return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Rate",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:this.state.effect.rateParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.001,max:20,min:0}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Feedback",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:this.state.effect.feedbackParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.001,max:1,min:0}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Depth",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:this.state.effect.depthParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.01,max:1,min:0}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Wet",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:this.state.effect.wetParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.001,max:1,min:0})):"")}}]),n}(r.Component);function wm(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var jm=function(e){Object(u.a)(n,e);var t=wm(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={effect:e.effect},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){void 0!==this.props.automation||this.state.effect.isEnabled();return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Filter Cutoff",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.baseFrequencyParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:10,max:1e4,min:0}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Octave",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.octaveParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:10,min:0}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Q",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.qParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:1,max:10,min:0}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Sensitivity",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.sensitivityParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:1,max:3,min:-30}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Attack",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.attackParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:4,min:.1}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Release",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.releaseParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:4,min:.1}),a.a.createElement(_u,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.state.effect})):"")}}]),n}(r.Component);function Tm(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var xm=function(e){Object(u.a)(n,e);var t=Tm(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={effect:e.effect},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){void 0!==this.props.automation||this.state.effect.isEnabled();return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Distortion",parameter:this.state.effect.distortionParameter,lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.01,max:1,min:0}),a.a.createElement(_u,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.state.effect})):"")}}]),n}(r.Component);function Cm(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Nm=function(e){Object(u.a)(n,e);var t=Cm(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={effect:e.effect},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Bits",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,selectedParameter:this.props.selectedParameter,parameter:this.state.effect.bitsParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:1,max:8,min:1}),a.a.createElement(_u,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.state.effect})):"")}}]),n}(r.Component);function Rm(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Dm=function(e){Object(u.a)(n,e);var t=Rm(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={effect:e.effect},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){this.state.effect.compressorNode,this.state.effect.effectNode,void 0!==this.props.automation||this.state.effect.isEnabled();return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Drive",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:this.state.effect.driveParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.01,max:6,min:.01})):"")}}]),n}(r.Component);function qm(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Mm=function(e){Object(u.a)(n,e);var t=qm(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={effect:e.effect},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){void 0!==this.props.automation||this.state.effect.isEnabled();return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Pitch",parameter:this.state.effect.pitchParameter,lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.01,max:24,min:-24}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Window Size",parameter:this.state.effect.windowSizeParameter,lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.01,max:.2,min:.03}),a.a.createElement(_u,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.state.effect})):"")}}]),n}(r.Component);function Am(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Im=function(e){Object(u.a)(n,e);var t=Am(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={effect:e.effect},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){void 0!==this.props.automation||this.state.effect.isEnabled();return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,name:"Panning",parameter:this.state.effect.panningParameter,lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.01,max:1,min:-1})):"")}}]),n}(r.Component);function Lm(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Fm={},Bm={},Hm=[50,60,70,80,90,100,200,300,400,500,600,700,800,900,1e3,2e3,3e3,4e3,5e3,6e3,7e3,8e3,9e3,1e4],Vm=function(e){Object(u.a)(n,e);var t=Lm(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r.guideLines=r.getGuideLines(),r.fillCache(),r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e){return this.props.nextProps!==e.nextProps||JSON.stringify(this.props.equalizerPoints)!==JSON.stringify(e.equalizerPoints)}},{key:"fillCache",value:function(){for(var e=0;e<14e3;e++)this.getXPositionForFrequency(e);for(var t=0;t<650;t++)this.getFrequencyForXPosition(t)}},{key:"getFrequencyForXPosition",value:function(e){if(e in Fm)return Fm[e];var t=0,n=0,r=0;for(n=0;t<e;n++)t+=this.props.getWidth(n),r+=86;var a=this.props.getWidth(n),i=r-86+(e-(t-a))/a*86;return Fm[e]=i,i}},{key:"getXPositionForFrequency",value:function(e){if(e in Bm)return Bm[e];var t=0,n=0,r=0;for(t=0;r<e;t++)n+=this.props.getWidth(t),r+=86;return n-=this.props.getWidth(t),n+=(e-(r-86))/86*this.props.getWidth(t),Bm[e]=n,n}},{key:"getGainYPosition",value:function(e){return 80-5*e}},{key:"getEQCurve",value:function(){for(var e=[],t=this.equalizerPoints.filter(function(e){return e.enabled}),n=0;n<620;n+=2){var r=this.getFrequencyForXPosition(n),i=0;for(var s in t)i+=t[s].frequencyToGain(r);e.push(n),e.push(this.getGainYPosition(i))}return a.a.createElement(Sc.Line,{closed:!1,strokeWidth:2,lineCap:"butt",lineJoin:"miter",tension:.91,points:e,stroke:"#6200EE"})}},{key:"getEqualizerPoints",value:function(){var e=this,t=this.equalizerPoints.filter(function(e){return e.enabled});return t.map(function(n,r){var i=t[r],s=e.getXPositionForFrequency(n.frequency);return a.a.createElement(Sc.Group,null,a.a.createElement(Sc.Circle,{onMouseDown:function(t){return e.startDraggingPoint(i)},onMouseUp:function(t){return e.stopDraggingPoint(i)},x:s,y:e.getGainYPosition(n.gain),radius:8,fill:e.props.selectedPoint===i?"yellow":"black",stroke:"yellow",strokeWidth:2}),a.a.createElement(Sc.Text,{onMouseDown:function(t){return e.startDraggingPoint(i)},onMouseUp:function(t){return e.stopDraggingPoint(i)},text:i.number,fill:e.props.selectedPoint===i?"black":"yellow",fontSize:10,fontFamily:"Arial",x:s-3,y:e.getGainYPosition(n.gain)-5}))})}},{key:"getGuideLines",value:function(){var e=this;return Hm.map(function(t){return e.getXPositionForFrequency(t)}).map(function(e){return a.a.createElement(Sc.Line,{key:"eq-guideline-"+e,points:[e,0,e,160],stroke:"#1f1f1f",strokeWidth:1,closed:!1})})}},{key:"startDraggingPoint",value:function(e){this.props.setSelectedPoint(e),this.setState({draggingPoint:e})}},{key:"stopDraggingPoint",value:function(e){this.setState({draggingPoint:void 0})}},{key:"onMouseMove",value:function(e){var t=e.evt.layerX,n=e.evt.layerY,r=parseInt(this.getFrequencyForXPosition(t));void 0!==this.state.draggingPoint&&(this.state.draggingPoint.frequency=r,this.state.draggingPoint.gain=(80-n)/5,this.setState(this.state))}},{key:"onMouseLeave",value:function(){this.setState({draggingPoint:void 0})}},{key:"render",value:function(){var e=this;return a.a.createElement(Sc.Group,{onMouseMove:function(t){return e.onMouseMove(t)},onMouseLeave:function(t){return e.onMouseLeave()}},a.a.createElement(Sc.Line,{closed:!0,strokeWidth:2,lineCap:"round",lineJoin:"round",points:[0,0,620,0,620,160,0,160],stroke:"black"}),this.guideLines,this.getEQCurve(),this.getEqualizerPoints())}},{key:"equalizerPoints",get:function(){return this.props.effect.equalizerPoints||[]}}]),n}(r.Component),Um=Object(g.b)(function(e,t){var n=t.effect.equalizerPoints,r={};for(var a in n){var i=n[a],s=i.frequencyParameter,o=i.gainParameter,c=i.qParameter,u=i.enabledParameter;r[a]={frequency:e.effects.effectParameters[s.id],gain:e.effects.effectParameters[o.id],enabled:e.effects.effectParameters[u.id],q:e.effects.effectParameters[c.id]}}return{equalizerPoints:r}},null)(Vm);function Jm(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:256,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10;r=Math.log(r);var i=((a=Math.log(a))-r)/(n-t);return Math.exp(r+i*(e-t))}function _m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Gm={},zm=function(e){Object(u.a)(n,e);var t=_m(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={effect:e.effect,pts:[],updateRate:e.updateRate},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e){return this.state.updateRate!==e.updateRate&&(this.state.updateRate=e.updateRate,clearInterval(this.timer),this.run()),!0}},{key:"componentDidMount",value:function(){this.run()}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"run",value:function(){var e=this;this.timer=setInterval(function(){if(e.props.sequencerEngine.playing){var t=Array.from(e.props.effect.getSpectrum());e.setState({pts:t})}},this.state.updateRate)}},{key:"getXPositionForFrequency",value:function(e){if(void 0!==Gm[e])return Gm[e];for(var t=0,n=0;n<e;n++)t+=this.props.getWidth(n);return Gm[e]=t,t}},{key:"getBucketRect",value:function(e,t){var n=Jm(e,-160,0,1,160);return a.a.createElement(Sc.Rect,{width:this.props.getWidth(t),height:-2*n,y:160,x:this.getXPositionForFrequency(t),fill:this.rainbow(t)})}},{key:"rainbow",value:function(e){return"hsl("+e+",100%,50%)"}},{key:"render",value:function(){var e=this;return this.state.pts.map(function(t,n){return e.getBucketRect(t,n)})}}]),n}(r.Component);function Wm(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Km=function(e){Object(u.a)(n,e);var t=Wm(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props.equalizerPoint,t=e.enabled?"equalizer-point-info":"equalizer-point-info disabled";return this.props.selected&&(t+=" selected"),a.a.createElement("div",{onClick:this.props.onClick,className:t},a.a.createElement("div",{className:"equalizer-point-number"},e.number))}}]),n}(r.Component);function Qm(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Xm=function(e){Object(u.a)(n,e);var t=Qm(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"getOption",value:function(e){return Ym.filter(function(t){return t.value===e})[0]}},{key:"onSelectOption",value:function(e){this.props.onUpdateRateChanged(e.value)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"osc-type-dropdown-container"},a.a.createElement(Vc.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:Ym,onChange:function(t){return e.onSelectOption(t)},value:this.getOption(this.props.updateRate),placeholder:"LFO"}))}}]),n}(r.Component),Ym=[{value:100,label:"Fastest"},{value:Hr,label:"Fast"},{value:350,label:"Medium"},{value:1e3,label:"Slow"},{value:1e4,label:"Slowest"}],Zm=Xm;function $m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ev={},tv=function(e){Object(u.a)(n,e);var t=$m(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={effect:e.effect,pts:[],frequency:0,selectedPoint:e.effect.equalizerPoints[0]},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"handleOptionChange",value:function(e){this.setState(this.state)}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"onChangeSynced",value:function(e){document.activeElement.blur(),this.setState(this.state)}},{key:"getWidth",value:function(e){if(void 0!==ev[e])return ev[e];var t=void 0;return t=e<5?Jm(256-e,252,256,20,30):e<12?Jm(256-e,245,252,8,20):e<16?Jm(256-e,241,245,4,8):Jm(256-e,0,241,1,4),ev[e]=t,t}},{key:"setSelectedPoint",value:function(e){this.setState({selectedPoint:e})}},{key:"onClickEqualizerPoint",value:function(e){if(this.state.selectedPoint!==e)e.enabled||(e.enabled=!0),this.setState({selectedPoint:e});else{e.enabled=!1;var t=void 0;for(var n in this.state.effect.equalizerPoints){var r=this.state.effect.equalizerPoints[n];if(r.enabled){t=r;break}}this.setState({selectedPoint:t})}}},{key:"onUpdateRateChanged",value:function(e){this.state.effect.updateRate=e,this.setState(this.state)}},{key:"render",value:function(){var e,t,n,r=this;this.props.automation;return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement("div",{className:"spectrum-container"},a.a.createElement(Sc.Stage,{width:620,height:160},a.a.createElement(Sc.Layer,null,a.a.createElement(Sc.Rect,{width:620,height:160,fill:"black"}),a.a.createElement(zm,{updateRate:this.state.effect.updateRate,sequencerEngine:this.props.sequencerEngine,getWidth:function(e){return r.getWidth(e)},effect:this.state.effect})),a.a.createElement(Sc.Layer,null,a.a.createElement(Sc.Line,{closed:!1,points:[0,80,620,80],strokeWidth:2,stroke:"#1f1f1f"}),a.a.createElement(Um,{selectedPoint:this.state.selectedPoint,setSelectedPoint:function(e){return r.setSelectedPoint(e)},effect:this.props.effect,getWidth:function(e){return r.getWidth(e)},setDraggingPoint:function(e){return r.setState({draggingPoint:e})}})))),a.a.createElement("div",{className:"equalizer-parameters"},a.a.createElement("div",{className:"equalizer-points"},this.state.effect.equalizerPoints.map(function(e){return a.a.createElement(Km,{onClick:function(){return r.onClickEqualizerPoint(e)},selected:r.state.selectedPoint===e,equalizerPoint:e})}),a.a.createElement("div",{className:"eq8-update-rate-dropdown-container"},a.a.createElement(Zm,{updateRate:this.state.effect.updateRate,onUpdateRateChanged:function(e){return r.onUpdateRateChanged(e)}}))),a.a.createElement("div",{className:"equalizer-sliders-container"},a.a.createElement(hu,(e={effectNumber:this.props.effectNumber,automation:this.props.automation,unit:"hz",name:"Frequency",selectedParameter:this.props.selectedParameter,parameter:this.state.selectedPoint.frequencyParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:12e3,min:0,sequencerEngine:this.props.sequencerEngine},Object(An.a)(e,"isParameter",!0),Object(An.a)(e,"lfoEnabled",!0),e)),a.a.createElement(hu,(t={effectNumber:this.props.effectNumber,automation:this.props.automation,unit:"db",onParameterChanged:this.props.onParameterChanged,name:"Gain",selectedParameter:this.props.selectedParameter,parameter:this.state.selectedPoint.gainParameter,isParameter:!0,step:.1,max:12,min:-12,sequencerEngine:this.props.sequencerEngine},Object(An.a)(t,"isParameter",!0),Object(An.a)(t,"lfoEnabled",!0),t)),a.a.createElement(hu,(n={effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Q",selectedParameter:this.props.selectedParameter,parameter:this.state.selectedPoint.qParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.1,max:16,min:.1,sequencerEngine:this.props.sequencerEngine},Object(An.a)(n,"isParameter",!0),Object(An.a)(n,"lfoEnabled",!0),n))))):"")}}]),n}(r.Component);function nv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var rv=function(e){Object(u.a)(n,e);var t=nv(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={effect:e.effect},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){void 0!==this.props.automation||this.state.effect.isEnabled();return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Width",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:this.state.effect.widthParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.01,max:1,min:0}),a.a.createElement(_u,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.state.effect})):"")}}]),n}(r.Component);function av(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var iv=function(e){Object(u.a)(n,e);var t=av(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"render",value:function(){void 0!==this.props.automation||this.props.effect.isEnabled();return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Rate",parameter:this.props.effect.rateParameter,onParameterChanged:this.props.onParameterChanged,sequencerEngine:this.props.sequencerEngine,isParameter:!0,lfoEnabled:!0,step:1e-4,min:0,max:1}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Feedback",lfoEnabled:!0,selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,unit:"%",parameter:this.props.effect.feedbackParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,displayFunction:function(e){return Math.floor(100*e)},step:.01,max:1,min:0}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Saturation",lfoEnabled:!0,selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,parameter:this.props.effect.driveParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.01,max:6,min:.1}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Low",lfoEnabled:!0,selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,parameter:this.props.effect.lowEQParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.01,max:6,min:-40}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Mid",lfoEnabled:!0,selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,parameter:this.props.effect.midEQParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.01,max:6,min:-40}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"High",lfoEnabled:!0,selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,parameter:this.props.effect.highEQParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.01,max:6,min:-40}),a.a.createElement(_u,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"")}}]),n}(r.Component);function sv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ov=function(e){Object(u.a)(n,e);var t=sv(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={delayEffect:e.effect},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.delayEffect=e.effect,!0}},{key:"handleOptionChange",value:function(e){this.setState(this.state)}},{key:"handleFeedbackChange",value:function(e){this.state.delayEffect.setFeedback(e),this.setState(this.state)}},{key:"handleDelayTimeChange",value:function(e){"LEFT"===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"LEFT")?this.state.delayEffect.leftDelay.rate=e.value:this.state.delayEffect.rightDelay.rate=e.value,this.setState(this.state)}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.delayEffect.isEnabled()}},{key:"onChangeSynced",value:function(e){document.activeElement.blur(),this.props.effect.isSynced="unsynced"===e,this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.props.effect,n=t.isSynced;void 0!==this.props.automation||t.isEnabled();return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement("div",{className:"refined-checkbox-preferences lfo-synced-checkbox"},a.a.createElement("label",null,a.a.createElement("input",{type:"checkbox",value:n?"synced":"unsynced",checked:n,onChange:function(t){return e.onChangeSynced(t.target.value)}}),"Synced")),n?a.a.createElement("div",null,a.a.createElement("div",{className:"lfo-rate-dropdown"},a.a.createElement("div",{className:"lfo-rate-label"},"Left Rate:"),a.a.createElement(Vc.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:cv,onChange:function(t){return e.handleDelayTimeChange(t,"LEFT")},value:uv(this.props.effect.leftDelay.rawDelayRate),placeholder:"Rate"}),a.a.createElement("div",{className:"clear-fix"})),a.a.createElement("div",{className:"lfo-rate-dropdown"},a.a.createElement("div",{className:"lfo-rate-label"},"Right Rate:"),a.a.createElement(Vc.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:cv,onChange:function(t){return e.handleDelayTimeChange(t,"RIGHT")},value:uv(this.props.effect.rightDelay.rawDelayRate),placeholder:"Rate"}),a.a.createElement("div",{className:"clear-fix"}))):a.a.createElement("div",null,a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Left Rate",parameter:this.state.delayEffect.leftDelay.rateParameter,onParameterChanged:this.props.onParameterChanged,sequencerEngine:this.props.sequencerEngine,isParameter:!0,lfoEnabled:!0,step:1,min:1,max:1e3}),a.a.createElement(hu,{effectNumber:this.props.effectNumber,name:"Right Rate",parameter:this.state.delayEffect.rightDelay.rateParameter,onParameterChanged:this.props.onParameterChanged,sequencerEngine:this.props.sequencerEngine,isParameter:!0,lfoEnabled:!0,step:1,min:1,max:1e3})),a.a.createElement(hu,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Feedback",lfoEnabled:!0,selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,unit:"%",parameter:this.state.delayEffect.feedbackParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,displayFunction:function(e){return Math.floor(100*e)},step:.01,max:1,min:0}),a.a.createElement(_u,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.state.delayEffect})):"")}}]),n}(r.Component),cv=[{value:"1n",label:"1"},{value:"2n",label:"1/2"},{value:"4n",label:"1/4"},{value:"4t",label:"1/4t"},{value:"8n",label:"1/8"},{value:"8n.",label:"1/8."},{value:"8t",label:"1/8t"},{value:"16n",label:"1/16"},{value:"16t",label:"1/16t"},{value:"32n",label:"1/32"}];function uv(e){var t=cv.filter(function(t){return t.value===e});return 0==t.length?"16n":t[0]}var lv=ov,pv=function(e){var t=e.macros,n=e.setShowMacrosView,i=e.sequencerEngine,s=Object(r.useCallback)(function(){n(!1)},[n]);return a.a.createElement("div",{className:"effect-rack"},t.map(function(e){return a.a.createElement(hu,{effectNumber:0,automation:void 0,name:e.name,selectedParameter:void 0,sequencerEngine:i,lfoEnabled:!0,parameter:e.macroParameter,isParameter:!0,onParameterChanged:function(){return[]},step:.01,max:1,min:0})}),a.a.createElement("div",{onClick:s,className:"expand-macros-button"},"Expand"))};function hv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}r.Component;function fv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var dv=function(e){Object(u.a)(n,e);var t=fv(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={showMods:!1,waveformData:[]},r}return Object(c.a)(n,[{key:"onChangeSynced",value:function(e){document.activeElement.blur(),this.props.lfo.lfo.isSynced="unsynced"===e,console.log("isSynced is now = "+this.props.lfo.lfo.isSynced),this.setState(this.state)}},{key:"onClickModsButton",value:function(){this.setState({showMods:!this.state.showMods})}},{key:"isSelected",value:function(){return!this.props.hideSelection&&this.props.lfo.lfo.number===this.props.selectedLFO}},{key:"render",value:function(){var e=this,t=this.props.lfo.lfo,n=this.isSelected()?"lfo-component selected":"lfo-component";return a.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("LFO_COMPONENT")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.props.setSelectedLFO(t.number)},className:n},a.a.createElement("div",{className:"instrument-subsection-name lfo-subsection-name lfo-track-foreground-"+this.props.lfo.number},this.props.lfo.getName()),a.a.createElement(Wc,{condition:this.state.showMods},a.a.createElement(Gc,{parameters:this.props.lfo.lfo.parameters})),a.a.createElement(Wc,{condition:!this.state.showMods},a.a.createElement(Wp,{lfo:t}),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement("div",{className:"refined-checkbox-preferences lfo-synced-checkbox"},a.a.createElement("label",null,a.a.createElement("input",{type:"checkbox",value:t.isSynced?"synced":"unsynced",checked:t.isSynced,onChange:function(t){return e.onChangeSynced(t.target.value)}}),"Synced")),t.isSynced?a.a.createElement(Jp,{lfo:t}):a.a.createElement(hu,{effectNumber:0,name:"Rate",parameter:t.lfoRateParameter,onParameterChanged:function(){return[]},isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.1,min:0,max:32}),a.a.createElement(hu,{effectNumber:0,name:"Min",contextualHelp:"LFO_MIN_SLIDER",parameter:t.lfoMinParameter,sequencerEngine:this.props.sequencerEngine,onParameterChanged:function(){return[]},isParameter:!0,lfoEnabled:!0,min:-100,max:100,step:1}),a.a.createElement(hu,{effectNumber:0,name:"Max",parameter:t.lfoMaxParameter,contextualHelp:"LFO_MAX_SLIDER",sequencerEngine:this.props.sequencerEngine,onParameterChanged:function(){return[]},lfoEnabled:!0,isParameter:!0,min:-100,max:100,step:1}),a.a.createElement(hu,{effectNumber:0,name:"Phase",sequencerEngine:this.props.sequencerEngine,parameter:t.lfoPhaseParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:360,step:1})),a.a.createElement("div",{className:"mods-button",onClick:function(){return e.onClickModsButton()}},this.state.showMods?"BACK":"MODS"))}},{key:"meter",get:function(){return this.props.lfo.lfo.meter}}]),n}(r.Component),mv=Object(g.b)(function(e){return{selectedLFO:e.sequencer.selectedLFO}},function(e,t){return{setContextualHelp:function(t){return e(Object(O.U)(t))},setSelectedLFO:function(t){return e(Object(O.Ec)(t))}}})(dv),vv=20,gv=40,yv="INPUT",bv="OUTPUT",kv=500,Ev=300;function Ov(e,t,n){for(var r=0;Sv(e,t,n)&&r<40;)(e+=gv)>=kv-gv&&(e=gv,(t=t+vv+20)>=Ev-vv&&(t=vv+40)),r++;return{x:e,y:t}}function Sv(e,t,n){for(var r in n.effects){var a=n.effects[r],i=a.x,s=a.y;if(e>=i&&t>=s&&e<=i+gv&&t<=s+vv)return!0}return!1}function Pv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var wv=function(e){Object(u.a)(n,e);var t=Pv(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"onSelectTrack",value:function(e){for(var t in this.tracks)this.tracks[t].isConnectedToEnvelope(this.props.envelope)&&this.tracks[t].disconnectFromEnvelope(this.props.envelope);e.value.connectToEnvelope(this.props.envelope),this.setState(this.state)}},{key:"getTruncatedName",value:function(e){var t=e.getName();return void 0===t?"":t.length>=16?t.slice(0,16)+"...":t}},{key:"getOptions",value:function(){var e=this;return this.props.sequencerEngine.tracks.map(function(t){return{label:t.trackNumber+1+". "+e.getTruncatedName(t),value:t}})}},{key:"getSelectedOption",value:function(){var e=this;return this.getOptions().filter(function(t){return t.value.isConnectedToEnvelope(e.props.envelope)})[0]}},{key:"render",value:function(){var e=this,t=this.props.isSelected&&void 0===this.getSelectedOption()?"envelope-dropdown osc-type-dropdown-container selected":"envelope-dropdown osc-type-dropdown-container";return a.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("ENVELOPE_TRACK_DROPDOWN")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:t},a.a.createElement(Vc.a,{controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.getOptions(),onChange:function(t){return e.onSelectTrack(t)},value:this.getSelectedOption(),placeholder:"Track"}),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement("div",{className:"pre-post-options"},a.a.createElement("div",{onClick:function(){return e.onClickMode("PRE_FX")},className:this.preFXClassName},"Pre-FX"),a.a.createElement("div",{onClick:function(){return e.onClickMode("POST_FX")},className:this.postFXClassName},"Post-FX")))}},{key:"onClickMode",value:function(e){var t=this.connectedTrack;void 0!==t&&(t.setEnvelopeMode(this.props.envelope,e),this.setState(this.state))}},{key:"tracks",get:function(){return this.props.sequencerEngine.tracks}},{key:"connectedTrack",get:function(){var e=this;return this.tracks.filter(function(t){return t.isConnectedToEnvelope(e.props.envelope)})[0]}},{key:"mode",get:function(){var e=this.connectedTrack;if(void 0!==e)return e.getEnvelopeMode(this.props.envelope)}},{key:"preFXClassName",get:function(){return void 0!==this.mode&&"POST_FX"!==this.mode?"pre-post-option selected":"pre-post-option"}},{key:"postFXClassName",get:function(){return void 0!==this.mode&&"PRE_FX"!==this.mode?"pre-post-option selected":"pre-post-option"}}]),n}(r.Component),jv=Object(g.b)(function(e){return{tracks:e.tracks.trackSteps}},function(e,t){return{setContextualHelp:function(t){return e(Object(O.U)(t))}}})(wv);function Tv(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var xv=function(e){Object(u.a)(n,e);var t=Tv(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={showEnvelopeModal:!1,value:0},r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.interval=setInterval(function(){e.isSelected()&&e.setState({value:e.props.envelopeTrack.envelope.envelope.value})},100)}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"showEnvelopeModal",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.setState({showEnvelopeModal:e})}},{key:"isSelected",value:function(){return!this.props.hideSelection&&this.props.selectedEnvelope===this.props.envelopeTrack.number}},{key:"render",value:function(){var e=this,t="instrument-subsection-name lfo-subsection-name lfo-track-foreground-"+this.props.envelopeTrack.number,n=this.props.envelopeTrack.envelope,r=this.isSelected(),i=r?"envelope-component selected":"envelope-component",s={width:100*this.state.value+"%"};return a.a.createElement("div",{onClick:function(){return e.props.setSelectedEnvelope(e.props.envelopeTrack.number)},onMouseOver:function(){return e.props.setContextualHelp("ENVELOPE_COMPONENT")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:i},a.a.createElement(bh,{envelopeType:"SYSTEM",name:this.props.envelopeTrack.name,envelope:n,showLevel:!1,show:this.state.showEnvelopeModal,hide:function(){return e.showEnvelopeModal(!1)}}),a.a.createElement("div",{className:t},this.props.envelopeTrack.name),a.a.createElement(jv,{isSelected:r,sequencerEngine:this.props.sequencerEngine,envelope:n}),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(hu,{effectNumber:0,name:"Attack",parameter:n.attackParameter,sequencerEngine:this.props.sequencerEngine,onParameterChanged:function(){return[]},lfoEnabled:!0,isParameter:!0,min:0,max:6e3,step:1}),a.a.createElement(hu,{effectNumber:0,name:"Decay",sequencerEngine:this.props.sequencerEngine,parameter:n.decayParameter,onParameterChanged:function(){return[]},isParameter:!0,lfoEnabled:!0,min:0,max:6e3,step:1}),a.a.createElement(hu,{effectNumber:0,name:"Sustain",parameter:n.sustainParameter,onParameterChanged:function(){return[]},isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,min:0,max:1,step:.01}),a.a.createElement(hu,{effectNumber:0,sequencerEngine:this.props.sequencerEngine,name:"Release",parameter:n.releaseParameter,onParameterChanged:function(){return[]},lfoEnabled:!0,isParameter:!0,min:0,max:1e4,step:1}),a.a.createElement("div",{onClick:function(){return e.showEnvelopeModal()},className:"draw-envelope-modal-button"},"DRAW"),a.a.createElement("div",{className:"envelope-value-container"},a.a.createElement(Wc,{condition:this.isSelected()},a.a.createElement("div",{className:"envelope-value",style:s}))))}}]),n}(r.Component),Cv=Object(g.b)(function(e){return{selectedEnvelope:e.sequencer.selectedEnvelope}},function(e){return{setSelectedEnvelope:function(t){return e(Object(O.Bc)(t))},setContextualHelp:function(t){return e(Object(O.U)(t))}}})(xv);function Nv(e){var t=e.edge,n=e.sequencerEngine;return a.a.createElement("div",null,a.a.createElement("div",null,"Edge Properties:"),a.a.createElement(hu,{effectNumber:0,automation:void 0,name:"Gain",selectedParameter:void 0,sequencerEngine:n,lfoEnabled:!0,parameter:t.gainParameter,isParameter:!0,onParameterChanged:function(){return[]},step:.01,max:1,min:.01}))}var Rv="#4f4d54",Dv={INPUT:"Input for node",OUTPUT:"Output for node"};function qv(e){var t=e.x,n=e.y,r=e.mode,i=e.parameter,s=r===yv?"down":"up",o=Dv[r];return i&&i.name&&(o=i.name+": "+i.get()),n=r===yv?n-5:n+5,a.a.createElement(Sc.Label,{x:t,y:n},a.a.createElement(Sc.Tag,{fill:Rv,pointerDirection:s,pointerHeight:20,pointerWidth:10}),a.a.createElement(Sc.Text,{fontSize:10,text:o,padding:5,fill:"white"}))}var Mv=300;function Av(e){var t=e.x,n=e.y,i=e.number,s=e.mode,o=e.parameter,c=e.startDrawingEdge,u=(e.drawingEdge,e.effect),l=e.connectEdge,p=Object(r.useState)(!1),h=Object(j.a)(p,2),f=h[0],d=h[1],m=Object(r.useState)(!1),v=Object(j.a)(m,2),g=v[0],y=v[1],b=Object(r.useState)(null),k=Object(j.a)(b,2),E=k[0],O=k[1];n=s===yv?n:n+vv;var S=Object(r.useCallback)(function(){d(!0),O(setTimeout(function(){y(!0)},Mv))},[d,f,O,y]),P=Object(r.useCallback)(function(e){clearTimeout(E),y(!1),d(!1)},[d,y,E]),w=Object(r.useCallback)(function(){c(u,s,t+8*i,n)},[c,y,u,s,i,t,n]);return a.a.createElement(Sc.Group,null,a.a.createElement(Sc.Circle,{strokeWidth:f?2:0,stroke:f?"yellow":"black",x:t+8*i,onMouseDown:w,onMouseOver:f?function(){return[]}:S,onMouseLeave:P,onMouseUp:function(){return l(o||u,s)},y:n,radius:3,fill:"black"}),g?a.a.createElement(qv,{parameter:o,mode:s,x:t+8*i,y:n}):a.a.createElement(Sc.Rect,{x:0,y:0,width:0,height:0}))}var Iv=Object(r.memo)(function(e){var t=e.effect,n=e.x,r=e.y,i=(e.setDragging,e.connectEdge),s=e.startDrawingEdge,o=e.drawingEdge,c=(e.selectedEdge,e.setSelectedEdge,e.edges,[void 0]),u=[void 0];return t.parameters&&(u=[].concat(Object(M.a)(u),Object(M.a)(t.parameters.filter(function(e){return e.isAudioParamEnabled()})))).length>8&&(u=u.slice(0,8)),a.a.createElement(Sc.Group,null,u.map(function(e,c){return a.a.createElement(Av,{x:n,y:r,key:"intput-"+c,number:c+1,mode:yv,parameter:e,effect:t,connectEdge:i,drawingEdge:o,startDrawingEdge:s})}),c.map(function(e,c){return a.a.createElement(Av,{key:"output-"+c,x:n,y:r,parameter:e,drawingEdge:o,number:c+1,mode:bv,connectEdge:i,startDrawingEdge:s,effect:t})}))}),Lv=Object(g.b)(function(e,t){return void 0!==t.x?{}:{x:t.effect.x,y:t.effect.y}},null)(Iv);function Fv(e){return a.a.createElement("div",null,a.a.createElement(Vc.a,{className:"effect-dropdown",options:wp,onChange:function(t){return function(t){var n=jp(t,e.sequencerEngine);e.handleChooseEffect(n)}(t.value)},placeholder:"Add FX"}))}var Bv=function(e){var t=e.rack,n=e.sequencerEngine,i=e.handleChooseEffect,s=e.setShowMacrosView,o=e.setMacros,c=Object(r.useCallback)(function(){t.newMacro(),console.log("setting macros =",t.macros),o(Object(M.a)(t.macros))},[o]);return a.a.createElement("div",{className:"rack-toolbar"},a.a.createElement(Fv,{sequencerEngine:n,handleChooseEffect:i}),a.a.createElement("div",{onClick:c,className:"add-macro-button"},"Add Macro"),a.a.createElement("div",{onClick:function(){return s(!0)},className:"show-macros-button"},"Macros"))};function Hv(e){var t=e.drawingEdge;if(void 0===t)return a.a.createElement(Sc.Rect,{x:0,y:0,width:0,height:0});var n=t.x1,r=t.y1,i=t.x2,s=t.y2;return a.a.createElement(Sc.Arrow,{pointerLength:6,pointerWidth:4,points:[n,r,i,s],fill:"red",strokeWidth:2,stroke:"red"})}var Vv=new wt.a;function Uv(e){if(void 0===e)return 0;var t=e.context.macro||e.context.subDevice;if(void 0===t.parameters)return 0;var n=t.parameters.filter(function(e){return e.isAudioParamEnabled()}).indexOf(e);return t.x+15+8*n}var Jv=Object(g.b)(function(e,t){if(t.modulator){var n=t.edge.context.macro||t.edge.context.subDevice;return{x2:n.x,y2:n.y}}return t.macro?{x1:t.macro.x,y1:t.macro.y,x2:t.edge.parameter.context.subDevice.x,y2:t.edge.parameter.context.subDevice.y}:{x1:t.effect.x,y1:t.effect.y,x2:t.edge.effect.x,y2:t.edge.effect.y}},null)(function(e){var t=e.effect,n=e.edge,i=e.setSelectedEdge,s=e.selected,o=e.modulator,c=e.macro,u=Object(r.useState)(!1),l=Object(j.a)(u,2),p=l[0],h=l[1],f=function(e,t){return void 0===e?{x1:void 0,y1:void 0,x2:void 0,y2:void 0}:{x1:5+(e.getType()===Me?4+e.number:e.number)/9*500,y1:vv,x2:Uv(t),y2:(t.context.macro||t.context.subDevice).y}}(o,n),d=f.x1,m=f.y1,v=f.x2,g=f.y2;if(c){var y=function(e,t){return void 0===e?{x1:void 0,y1:void 0,x2:void 0,y2:void 0}:{x1:e.x+5,y1:e.y+vv,x2:Uv(t),y2:t.context.subDevice.y}}(c,n.parameter);d=y.x1,m=y.y1,v=y.x2,g=y.y2}else o||(d=t.x+8,m=t.y+vv,v=n.effect.x+8,g=n.effect.y);var b="#b942f5";o&&(b=o.getType()===Me?"#3abcd6":"#3ad688"),c&&(b="#ffc342");var k=s||p?"red":b,E=Object(r.useCallback)(function(){h(!0)},[h]),O=Object(r.useCallback)(function(){h(!1)},[h]),S=Object(r.useCallback)(function(){i(o?{modulator:o,edge:n}:n)},[i,n,o]);return o||c||void 0!==n.gainParameter?(p||o||s||c||(k=Vv.brighten(k,.2+Math.pow(4,n.gainParameter.get())/4)),a.a.createElement(Sc.Group,null,a.a.createElement(Sc.Arrow,{onMouseOver:E,onMouseLeave:O,onMouseDown:S,pointerLength:6,pointerWidth:4,fill:k,points:[d,m,v,g],strokeWidth:2,stroke:k}))):a.a.createElement(Sc.Group,null)}),_v=Object(r.memo)(function(e){var t=e.edges,n=e.rack,r=e.setSelectedEdge,i=e.selectedEdge,s=t[-1]||[],o=[],c=function(e){var s=n.effects[e],c=t[s.id];if(void 0===c)return"continue";o=[].concat(Object(M.a)(o),Object(M.a)(c.map(function(e,t){return a.a.createElement(Jv,{effect:s,key:"input-edge- "+t+"-"+s.id,edge:e,rack:n,setSelectedEdge:r,selected:i===e})})))};for(var u in n.effects)c(u);return a.a.createElement(Sc.Group,null,s.map(function(e,t){return a.a.createElement(Jv,{key:"edge- "+t,effect:n.inputNode,edge:e,rack:n,setSelectedEdge:r,selected:i===e})}),o)});function Gv(e){var t=e.lfoEdges,n=e.envelopeEdges,r=e.rack,i=e.setSelectedEdge,s=e.selectedEdge,o=[],c=function(e){var c=r.modulators[e],u="LFO"===c.getType()?t[c.number]:n[c.number];if(void 0===u)return"continue";o=[].concat(Object(M.a)(o),Object(M.a)(u.map(function(e){return a.a.createElement(Jv,{key:c.getType()+"-"+c.number+"-edge-"+e.id,modulator:c,edge:e,setSelectedEdge:i,selected:!!s&&(s.modulator===c&&s.edge===e)})})))};for(var u in r.modulators)c(u);return a.a.createElement(Sc.Group,null,o)}function zv(e){var t=e.macroEdges,n=e.rack,r=e.setSelectedEdge,i=(e.selectedEdge,[]),s=function(e){var s=n.macros[e],o=t[s.id];if(void 0===o)return"continue";i=[].concat(Object(M.a)(i),Object(M.a)(o.map(function(e){return a.a.createElement(Jv,{macro:s,edge:e,setSelectedEdge:r,selected:!1})})))};for(var o in n.macros)s(o);return a.a.createElement(Sc.Group,null,i)}var Wv=Object(r.memo)(function(e){var t=e.numberOfModulators,n=e.number,i=(e.startDrawing,e.setDragging),s=e.connectEdge,o=e.startDrawingEdge,c=e.setSelectedNode,u=e.drawingEdge,l=e.width,p=(e.height,e.modulator),h=e.selected,f=1*(n+1)/(t+1)*l,d=p.getType()===qe?"LFO "+p.number:"Env "+p.number,m=Object(r.useCallback)(function(){c(p)},[c,p]);return a.a.createElement(Sc.Group,null,a.a.createElement(Sc.Rect,{onMouseDown:m,fill:h?"red":"#4a4e4b",x:f,y:0,width:35,height:vv}),a.a.createElement(Sc.Text,{onMouseDown:m,text:d,fill:"white",fontSize:10,fontFamily:"Arial",x:f+3,y:5}),a.a.createElement(Av,{x:f,y:0,number:1,mode:bv,effect:p,setDragging:i,connectEdge:s,drawingEdge:u,startDrawingEdge:o}))}),Kv=(n(1668),Object(r.memo)(function(e){var t=e.effect,n=e.x,i=e.y,s=e.text,o=e.hasInput,c=e.hasOutput,u=e.setDragging,l=e.connectEdge,p=e.startDrawingEdge,h=e.drawingEdge,f=e.selected,d=e.selectedEdge,m=e.setSelectedEdge;e.edges;s||(s=t.name,o=!0,c=!0);var v=8+6*s.length,g=c?[void 0]:[],y=o?[void 0]:[],b=Object(r.useCallback)(function(e){u&&u({effect:t,x:e.evt.layerX-n,y:e.evt.layerY-i})},[u,n,i]),k=f?"red":"#4a4e4b";return a.a.createElement(Sc.Group,null,a.a.createElement(Sc.Rect,{onMouseDown:function(e){return b(e)},fill:k,x:n,y:i,width:v,height:vv}),a.a.createElement(Sc.Text,{onMouseDown:function(e){return b(e)},text:s,fill:"white",fontSize:10,fontFamily:"Arial",x:n+3,y:i+5}),y.map(function(e,r){return a.a.createElement(Av,{x:n,y:i,key:"intput-"+r,number:r+1,mode:yv,parameter:e,effect:t,connectEdge:l,drawingEdge:h,startDrawingEdge:p})}),g.map(function(e,r){return a.a.createElement(Av,{key:"output-"+r,x:n,y:i,parameter:e,setSelectedEdge:m,selectedEdge:d,drawingEdge:h,number:r+1,mode:bv,connectEdge:l,startDrawingEdge:p,effect:t})}))})),Qv=Object(g.b)(function(e,t){return void 0!==t.x?{}:{x:t.effect.x,y:t.effect.y}},null)(Kv),Xv=Object(r.memo)(function(e){var t=e.macro,n=e.x,i=e.y,s=e.setDragging,o=e.connectEdge,c=e.startDrawingEdge,u=e.drawingEdge,l=e.selected,p=e.selectedEdge,h=e.setSelectedEdge,f=(e.edges,t.name),d=8+6*f.length,m=Object(r.useCallback)(function(e){s&&s({effect:t,x:e.evt.layerX-n,y:e.evt.layerY-i})},[s,n,i]),v=l?"red":"#4a4e4b";return a.a.createElement(Sc.Group,null,a.a.createElement(Sc.Rect,{onMouseDown:function(e){return m(e)},fill:v,x:n,y:i,width:d,height:vv}),a.a.createElement(Sc.Text,{onMouseDown:function(e){return m(e)},text:f,fill:"white",fontSize:10,fontFamily:"Arial",x:n+3,y:i+5}),[0].map(function(e,r){return a.a.createElement(Av,{key:"output-"+r,x:n,y:i,parameter:e,setSelectedEdge:h,selectedEdge:p,drawingEdge:u,number:r+1,mode:bv,connectEdge:o,startDrawingEdge:c,effect:t})}))}),Yv=Object(g.b)(function(e,t){return{x:t.macro.x,y:t.macro.y}},null)(Xv),Zv=function(e){var t=e.subMacro,n=t.parameter,i=n.context,s=i.subDevice,o=i.effect,c=i.liveEffect,u=i.midiEffect,l=i.instrument;s=s||o||c||u||l;var p=Object(r.useState)(t.min),h=Object(j.a)(p,2),f=h[0],d=h[1],m=Object(r.useState)(t.max),v=Object(j.a)(m,2),g=v[0],y=v[1],b=Object(r.useCallback)(function(e){var r=e.target.value;r=parseFloat(r),n.isValidValue(r)?(t.min=r,d(e.target.value)):""!==e.target.value&&"."!==e.target.value||d(e.target.value)},[d]),k=Object(r.useCallback)(function(e){var r=e.target.value;r=parseFloat(r),n.isValidValue(r)?(t.max=r,y(e.target.value)):""!==e.target.value&&"."!==e.target.value||y(e.target.value)},[y]);return a.a.createElement("div",{className:"sub-macro"},a.a.createElement("div",{className:"sub-field effect"},s?s.name:o?o.name:l?l.name:""),a.a.createElement("div",{className:"sub-field parameter"},n.name),a.a.createElement("div",{className:"sub-field"},a.a.createElement("input",{className:"min-field",onChange:b,value:f,type:"text"})),a.a.createElement("div",{className:"sub-field"},a.a.createElement("input",{className:"max-field",onChange:k,value:g,type:"text"})))},$v=function(e){var t=e.macro,n=e.sequencerEngine,i=Object(r.useState)(t.name),s=Object(j.a)(i,2),o=s[0],c=s[1],u=t.subMacros,l=Object(r.useCallback)(function(e){t.name=e.target.value,c(t.name)},[c]);return a.a.createElement("div",{className:"macro-details"},a.a.createElement("input",{type:"text",className:"name-editor",value:o,onChange:l,placeholder:"Enter macro's name"}),a.a.createElement(hu,{effectNumber:0,automation:void 0,name:t.name,selectedParameter:void 0,sequencerEngine:n,lfoEnabled:!0,parameter:t.macroParameter,isParameter:!0,onParameterChanged:function(){return[]},step:.01,max:1,min:0}),u.map(function(e){return a.a.createElement(Zv,{subMacro:e})}))},eg="#2b2d3c";var tg=Object(g.b)(function(e,t){return{isSelected:e.effects.selectedEffect===t.effect.id}},function(e,t){return{setNodePosition:function(n,r,a){return e(Object(O.ib)(t.effect.id,n,r,a))}}})(function(e){var t=e.effect,n=Object(r.useState)(void 0),i=Object(j.a)(n,2),s=i[0],o=i[1],c=Object(r.useState)(void 0),u=Object(j.a)(c,2),l=u[0],p=u[1],h=Object(r.useState)(void 0),f=Object(j.a)(h,2),d=f[0],m=f[1],v=Object(r.useState)(t.effects),g=Object(j.a)(v,2),y=g[0],b=g[1],k=Object(r.useState)(void 0),E=Object(j.a)(k,2),O=E[0],S=E[1],P=Object(r.useState)(t.adjacencyLists),w=Object(j.a)(P,2),T=w[0],x=w[1],C=Object(r.useState)(t.lfoAdjacencyLists),N=Object(j.a)(C,2),R=N[0],q=N[1],I=Object(r.useState)(t.envelopeAdjacencyLists),L=Object(j.a)(I,2),F=L[0],B=L[1],H=Object(r.useState)(t.macroAdjacencyLists),V=Object(j.a)(H,2),U=V[0],J=V[1],_=Object(r.useState)(t.modulators),G=Object(j.a)(_,2),z=G[0],W=(G[1],Object(r.useState)(t.macros)),K=Object(j.a)(W,2),Q=K[0],X=K[1],Y=Object(r.useState)(t.macros.length>0),Z=Object(j.a)(Y,2),$=Z[0],ee=Z[1],te=Object(r.useCallback)(function(n){var r=100,a=200;s&&void 0===s.getType&&(r=s.x,a=s.y);var i=Ov(r,a,t),c=i.x,u=i.y;t.addEffect(n),n.x=c,n.y=u,e.setNodePosition(n.id,c,u),o(n),b(Object(M.a)(t.effects))},[b,o,s]);Object(r.useEffect)(function(){t.setSize(kv,Ev,gv,vv),b(Object(M.a)(t.effects))},[b]),Object(r.useEffect)(function(){d&&o(d.effect)},[d,o,p]),Object(r.useEffect)(function(){return window.addEventListener("keydown",ne),function(){return window.removeEventListener("keydown",ne)}},[l,o,s,x,b,e.isSelected]);var ne=Object(r.useCallback)(function(n){if("INPUT"!==n.target.tagName.toUpperCase()&&e.isSelected)if(n.stopPropagation(),"Backspace"===n.key)l?(t.deleteEdge(l),x(Object(D.a)({},t.adjacencyLists)),q(Object(D.a)({},t.lfoAdjacencyLists)),B(Object(D.a)({},t.envelopeAdjacencyLists))):s&&(t.isMacro(s)?(t.deleteMacro(s),X(Object(M.a)(t.macros)),J(Object(D.a)({},t.macroAdjacencyLists))):t.deleteEffect(s),o(void 0),q(Object(D.a)({},t.lfoAdjacencyLists)),B(Object(D.a)({},t.envelopeAdjacencyLists)),x(Object(D.a)({},t.adjacencyLists)),b(Object(M.a)(t.effects)));else if("d"===n.key&&(n.metaKey||n.ctrlKey)){if(n.preventDefault(),n.stopPropagation(),s&&void 0===s.getType){var r=s.getEffectCopy();r.id=Object(A.uuid)(),t.addEffect(r);var a=Ov(s.x,s.y,t),i=a.x,c=a.y;r.x=i,r.y=c,b(Object(M.a)(t.effects))}return!1}},[e.isSelected,l,o,s,x,b,q,B]);Object(r.useEffect)(function(){s&&p(void 0)},[s,p]),Object(r.useEffect)(function(){l&&o(void 0)},[l,o]);var re=Object(r.useCallback)(function(t){if(d){var n=t.evt.layerX-d.x,r=t.evt.layerY-d.y,a=d.effect;a.x=n,a.y=r,e.setNodePosition(a.id,n,r)}O&&S(Object(D.a)({},O,{x2:t.evt.layerX,y2:t.evt.layerY}))},[d,y,b,O,S]),ae=Object(r.useCallback)(function(e){m(void 0),S(void 0)},[m,S]),ie=Object(r.useCallback)(function(e,t,n,r){S({node:e,mode:t,x1:n,y1:r,x2:n,y2:r}),p(void 0)},[S,p]),se=Object(r.useCallback)(function(e,n){if(void 0!==O){if(n===yv){if(O.mode===yv)return;t.connectNodes(O.node,e)}else{if(O.mode===bv)return;t.connectNodes(e,O.node)}x(Object(D.a)({},t.adjacencyLists)),q(Object(D.a)({},t.lfoAdjacencyLists)),B(Object(D.a)({},t.envelopeAdjacencyLists)),J(Object(D.a)({},t.macroAdjacencyLists))}},[O,x,B,q,J]),oe="";if(s&&(oe=t.isMacro(s)?a.a.createElement($v,{sequencerEngine:e.sequencerEngine,macro:s}):s.getType?s.getType()===qe?a.a.createElement(mv,{hideSelection:!0,sequencerEngine:e.sequencerEngine,lfo:s.context.lfoTrack}):a.a.createElement(Cv,{hideSelection:!0,sequencerEngine:e.sequencerEngine,envelopeTrack:s.context.envelopeTrack}):a.a.createElement(og.EffectComponent,{sequencerEngine:e.sequencerEngine,onDeleteEffect:function(){return[]},effect:s,track:e.track,send:e.send})),l)if(l.effect)oe=a.a.createElement(Nv,{edge:l,sequencerEngine:e.sequencerEngine});else if(l.modulator){var ce=l.edge;oe=a.a.createElement("div",null,a.a.createElement("div",null,"Parameter Mod Properties: "),a.a.createElement(Gc,{parameters:[ce]}))}var ue={setSelectedEdge:p,setSelectedNode:o,selectedEdge:l,setDragging:m,rack:t,startDrawingEdge:ie,drawingEdge:O,connectEdge:se};return $?a.a.createElement(pv,{macros:Q,setShowMacrosView:ee,sequencerEngine:e.sequencerEngine}):a.a.createElement("div",{className:"effect-rack"},a.a.createElement(Bv,{rack:t,setMacros:X,sequencerEngine:e.sequencerEngine,setShowMacrosView:ee,handleChooseEffect:te}),a.a.createElement("div",{className:"horizontal"},a.a.createElement("div",{className:"draw-component"},a.a.createElement(Sc.Stage,{width:kv,height:Ev,onMouseUp:ae,onMouseMove:re},a.a.createElement(Sc.Layer,null,a.a.createElement(Sc.Rect,{x:0,y:0,width:kv,height:Ev,fill:eg}),a.a.createElement(Gv,{envelopeEdges:F,lfoEdges:R,rack:t,setSelectedEdge:p,selectedEdge:l}),a.a.createElement(zv,{macroEdges:U,rack:t,setSelectedEdge:p,selectedEdge:l}),z.map(function(e,t){return a.a.createElement(Wv,Object.assign({number:t},ue,{width:kv,height:Ev,modulator:e,selected:s===e,numberOfModulators:z.length}))}),Q.map(function(e,t){return a.a.createElement(Yv,Object.assign({number:t},ue,{width:kv,height:Ev,macro:e,selected:s===e,numberOfModulators:z.length}))})),a.a.createElement(Sc.Layer,null,y.filter(function(e){return s===e}).map(function(e,t){return a.a.createElement(Qv,Object.assign({},ue,{selected:!0,key:"node-"+e.id,edges:T[e.id],effect:e}))})),a.a.createElement(Sc.Layer,null,y.filter(function(e){return s!==e}).map(function(e,t){return a.a.createElement(Qv,Object.assign({},ue,{selected:!1,key:"node-"+e.id,edges:T[e.id],effect:e}))}),a.a.createElement(_v,{edges:T,rack:t,setSelectedEdge:p,selectedEdge:l})),a.a.createElement(Sc.Layer,null,a.a.createElement(Hv,{drawingEdge:O}),Q.map(function(e){return a.a.createElement(Lv,{key:"macro-"+e.id,setSelectedEdge:p,selectedEdge:l,rack:t,setDragging:m,startDrawingEdge:ie,drawingEdge:O,connectEdge:se,edges:U[e.id],effect:e})}),y.filter(function(e){return s===e}).map(function(e,n){return a.a.createElement(Lv,{key:"node-"+e.id,setSelectedEdge:p,selectedEdge:l,rack:t,setDragging:m,startDrawingEdge:ie,drawingEdge:O,connectEdge:se,edges:T[e.id],effect:e})})),a.a.createElement(Sc.Layer,null,y.filter(function(e){return s!==e}).map(function(e,n){return a.a.createElement(Lv,{key:"node-"+e.id,setSelectedEdge:p,selectedEdge:l,rack:t,setDragging:m,startDrawingEdge:ie,drawingEdge:O,connectEdge:se,edges:T[e.id],effect:e})}),a.a.createElement(Qv,{hasOutput:!0,effect:t.inputNode,rack:t,text:"Input",x:0,startDrawingEdge:ie,setSelectedEdge:p,selectedEdge:l,edges:T[-1],connectEdge:se,y:Ev/2-vv/2}),a.a.createElement(Qv,{hasInput:!0,text:"Output",startDrawingEdge:ie,setSelectedEdge:p,selectedEdge:l,effect:t.outputNode,x:kv-gv,connectEdge:se,y:Ev/2-vv/2})))),oe))});function ng(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var rg=function(e){Object(u.a)(n,e);var t=ng(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={effect:e.effect},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){this.state.effect.compressorNode,this.state.effect.effectNode,void 0!==this.props.automation||this.state.effect.isEnabled();return a.a.createElement("div",null,this.isEnabled()?a.a.createElement("div",null,a.a.createElement(tg,{track:this.props.track,send:this.props.send,sequencerEngine:this.props.sequencerEngine,effect:this.state.effect})):"")}}]),n}(r.Component);function ag(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ig=function(e){Object(u.a)(n,e);var t=ag(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"render",value:function(){var e=this;return"Filter"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,group:this.props.group,send:this.props.send,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(Dd,Object.assign({},this.props,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,filterEffect:this.props.effect}))):"Auto Filter"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{isTall:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,track:this.props.track,group:this.props.group,send:this.props.send,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(Ld,Object.assign({},this.props,{track:this.track,sequencerEngine:this.props.sequencerEngine,effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,filterEffect:this.props.effect}))):"Delay"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},effectNumber:this.props.effectNumber,onDeleteEffect:this.props.onDeleteEffect,track:this.props.track,send:this.props.send,group:this.props.group,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(sm,Object.assign({},this.props,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,delayEffect:this.props.effect}))):"Tremolo"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},effectNumber:this.props.effectNumber,isTall:!0,onDeleteEffect:this.props.onDeleteEffect,track:this.props.track,send:this.props.send,group:this.props.group,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(Wd,Object.assign({},this.props,{effectNumber:this.props.effectNumber,automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,tremoloEffect:this.props.effect}))):"Chorus"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},effectNumber:this.props.effectNumber,onDeleteEffect:this.props.onDeleteEffect,track:this.props.track,send:this.props.send,group:this.props.group,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(Gd,Object.assign({},this.props,{effectNumber:this.props.effectNumber,automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,chorusEffect:this.props.effect}))):"Reverb"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,track:this.props.track,send:this.props.send,group:this.props.group,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(Bd,Object.assign({},this.props,{effectNumber:this.props.effectNumber,automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,reverbEffect:this.props.effect}))):"Convolver Reverb"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},effectNumber:this.props.effectNumber,onDeleteEffect:this.props.onDeleteEffect,track:this.props.track,send:this.props.send,group:this.props.group,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(Jd,Object.assign({},this.props,{effectNumber:this.props.effectNumber,automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,reverbEffect:this.props.effect}))):"Compressor"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},effectNumber:this.props.effectNumber,isTall:!0,onDeleteEffect:this.props.onDeleteEffect,send:this.props.send,track:this.props.track,group:this.props.group,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(cm,Object.assign({},this.props,{effectNumber:this.props.effectNumber,automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect}))):"Distortion"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},effectNumber:this.props.effectNumber,onDeleteEffect:this.props.onDeleteEffect,send:this.props.send,track:this.props.track,group:this.props.group,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(xm,Object.assign({},this.props,{sequencerEngine:this.props.sequencerEngine,effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect}))):"EQ 3"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},effectNumber:this.props.effectNumber,isTall:!0,onDeleteEffect:this.props.onDeleteEffect,send:this.props.send,track:this.props.track,group:this.props.group,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(hm,Object.assign({},this.props,{sequencerEngine:this.props.sequencerEngine,effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect}))):"EQ 10"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},effectNumber:this.props.effectNumber,isTall:!0,onDeleteEffect:this.props.onDeleteEffect,send:this.props.send,track:this.props.track,group:this.props.group,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(dm,Object.assign({},this.props,{sequencerEngine:this.props.sequencerEngine,effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect}))):"Bit Crusher"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,track:this.props.track,group:this.props.group,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(Nm,Object.assign({},this.props,{effectNumber:this.props.effectNumber,automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect}))):"Ultra Phaser"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},isTall:!0,effectNumber:this.props.effectNumber,onDeleteEffect:this.props.onDeleteEffect,send:this.props.send,group:this.props.group,track:this.props.track,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(Pm,Object.assign({},this.props,{effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect}))):"Auto Wah"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},isTall:!0,track:this.props.track,effectNumber:this.props.effectNumber,onDeleteEffect:this.props.onDeleteEffect,send:this.props.send,group:this.props.group,effect:this.props.effect,automation:this.props.automation}),a.a.createElement(jm,Object.assign({},this.props,{effectNumber:this.props.effectNumber,automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect}))):"Gate"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),a.a.createElement(Td,Object.assign({},this.props,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect}))):"Pitch Shift"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),a.a.createElement(Mm,Object.assign({},this.props,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect}))):"Panner"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),a.a.createElement(Im,Object.assign({},this.props,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect}))):"EQ8"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),a.a.createElement(tv,Object.assign({},this.props,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect}))):"Chebyshev"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),a.a.createElement(lm,Object.assign({},this.props,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect}))):"Multiband Compressor"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),a.a.createElement(Om,Object.assign({},this.props,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect}))):"Stereo Widener"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),a.a.createElement(rv,Object.assign({},this.props,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect}))):"Saturator"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),a.a.createElement(Dm,Object.assign({},this.props,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect}))):"Tape Delay"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),a.a.createElement(iv,Object.assign({},this.props,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect}))):"Stereo Delay"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),a.a.createElement(lv,Object.assign({},this.props,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect}))):"Oscilloscope"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),a.a.createElement(np,Object.assign({},this.props,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect}))):"Effect Rack"===this.props.effect.name?a.a.createElement(Xc,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,effectClass:"rack",send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),a.a.createElement(rg,Object.assign({},this.props,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect}))):null}}]),n}(r.Component),sg=function(e){Object(u.a)(n,e);var t=ag(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={selectedParameter:void 0,effectsView:a.a.createRef()},r}return Object(c.a)(n,[{key:"handleChooseMidiEffect",value:function(e){this.props.sequencerEngine.operationManager.dispatch(mt(e,this.props.track,this.props.group,this.props.send)),this.setState(this.state)}},{key:"handleChooseLiveEffect",value:function(e){this.props.track.liveEffects.addEffect(e),this.setState(this.state)}},{key:"handleChooseEffect",value:function(e){e.enable(!0),this.props.sequencerEngine.operationManager.dispatch(mt(e,this.props.track,this.props.group,this.props.send)),this.setState(this.state)}},{key:"onParameterChanged",value:function(e,t){void 0===this.props.track&&void 0===this.props.group&&void 0===this.props.send||(this.props.setSelectedEffect(t.id),this.props.onParameterChanged(e))}},{key:"onDeleteEffect",value:function(){this.setState(this.state)}},{key:"toggleLock",value:function(){this.props.track.togglePatternLock()}},{key:"onChangePanning",value:function(e){void 0!==this.props.track?this.props.track.setPanning(e):void 0!==this.props.group&&this.props.group.setPanning(e)}},{key:"render",value:function(){var e=this,t=void 0!==this.props.send?this.props.send.effects:void 0!==this.props.track?this.props.track.effects:this.props.group.effects;this.props.track&&(t=this.props.track.getEffects(this.props.chainNumber));var n=void 0!==this.props.send?this.props.send.getSendNodes():void 0!==this.props.track?this.props.track.getSendNodes():this.props.group.getSendNodes(),r=void 0!==this.props.track?this.props.track.midiEffects.effects:[],i=void 0!==this.props.track?this.props.track.liveEffects.effects:[],s=function(e){if(void 0!==e){if("MIDI"===e.getTrackType())return a.a.createElement(Sp,{track:e});if("INSTRUMENT_RACK"===e.getTrackType())return a.a.createElement(tm,{track:e});if("INSTRUMENT"===e.getTrackType()){var t=e.sequencerEngine,n=e.instrument.getInstrumentType();return n===op?a.a.createElement(wd,{key:e.trackNumber+"-instrument",track:e,instrument:e.getInstrument()}):n===cp?a.a.createElement(Dh,{key:e.trackNumber+"-instrument",sequencerEngine:t,track:e,instrument:e.getInstrument()}):n===up?a.a.createElement(bd,{key:e.trackNumber+"-instrument",sequencerEngine:t,track:e,instrument:e.getInstrument()}):n===lp?a.a.createElement(Ed,{key:e.trackNumber+"-instrument",sequencerEngine:t,track:e,instrument:e.getInstrument()}):n===sp?a.a.createElement(Xf,{key:e.trackNumber+"-instrument",sequencerEngine:t,track:e,instrument:e.getInstrument()}):void 0}}}(this.props.track)||"";return this.props.isFrozen&&(s=""),void 0===t||void 0===i||void 0===r?a.a.createElement("div",null):a.a.createElement("div",{ref:this.state.effectsView,className:"effects-view"},i.map(function(t,n){return a.a.createElement($l,{key:"live-effect-"+n,scrollContainer:e.state.effectsView,sequencerEngine:e.props.sequencerEngine,onDeleteEffect:function(){return e.onDeleteEffect()},effect:t,selectedParameter:e.state.selectedParameter,track:e.props.track,tracks:e.props.tracks,onParameterChanged:function(n){return e.onParameterChanged(n,t)},onEffectsChange:e.props.onEffectsChange})}),s,r.map(function(t,n){return a.a.createElement(El,{key:"midi-effect-"+n,sequencerEngine:e.props.sequencerEngine,onDeleteEffect:function(){return e.onDeleteEffect()},effect:t,isMixCollapsed:e.props.isMixCollapsed,selectedParameter:e.state.selectedParameter,track:e.props.track,tracks:e.props.tracks,onParameterChanged:function(n){return e.onParameterChanged(n,t)},onEffectsChange:e.props.onEffectsChange})}),t.map(function(t,n){return a.a.createElement(ig,{sequencerEngine:e.props.sequencerEngine,key:"effect-"+n,onDeleteEffect:function(){return e.onDeleteEffect()},effect:t,isMixCollapsed:e.props.isMixCollapsed,selectedParameter:e.state.selectedParameter,track:e.props.track,group:e.props.group,send:e.props.send,tracks:e.props.tracks,onParameterChanged:function(n){return e.onParameterChanged(n,t)},onEffectsChange:e.props.onEffectsChange})}),a.a.createElement(Rp,{track:this.props.track,sequencerEngine:this.props.sequencerEngine,addClassName:"add-track-effects-button",handleChooseMidiEffect:function(t){return e.handleChooseMidiEffect(t)},handleChooseLiveEffect:function(t){return e.handleChooseLiveEffect(t)},handleChooseEffect:function(t){return e.handleChooseEffect(t)},store:this.props.store}),a.a.createElement("div",{className:"sends-and-options-container"},a.a.createElement("div",{className:"sends-container"},n.map(function(t,n){return a.a.createElement(ip,{key:"track-send-"+n,track:e.props.track,sequencerEngine:e.props.sequencerEngine,sendNumber:n,send:e.props.sends.getSends()[n],sendNode:t})}),a.a.createElement(Cd,{panning:this.props.panning,onChangePanning:function(t){return e.onChangePanning(t)}})),a.a.createElement(mp,{track:this.props.track})),a.a.createElement("div",{className:"effect-lock"},a.a.createElement(Wc,{condition:!this.props.hideLock},a.a.createElement(fp,{patternLocked:this.props.patternLocked,toggleLock:function(){return e.toggleLock()}}))))}}]),n}(r.Component),og={EffectsView:Object(g.b)(function(e,t){var n=!1,r=!1;void 0!==t.track&&(n=((e.tracks.trackPatternLocks[t.track.subSequence.id]||{})[t.track.trackNumber]||{})[t.track.currentPattern]||!1,r=t.track.isFrozen);var a=0,i=void 0;void 0!==t.track?(a=e.tracks.trackPannings[t.track.trackNumber]||0,i=t.track.chainNumber):void 0!==t.group&&(a=e.tracks.groupPannings[t.group.groupNumber]||0);var s=t.track||t.group||t.send;return{isFrozen:r,patternLocked:n,panning:a,chainNumber:i,effects:s.effects,midiEffects:s.midiEffects&&s.midiEffects.effects}},function(e){return{setSelectedEffect:function(t){return e(Object(O.Ac)(t))}}})(sg),EffectComponent:ig};function cg(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}r.Component;var ug=function(e){Object(u.a)(n,e);var t=cg(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"handleChooseEffect",value:function(e){var t=this.props.send,n=null;"Filter"===e?n=new Xn.FilterEffect(this.props.sequencerEngine):"Reverb"===e?n=new Xn.ReverbEffect(this.props.sequencerEngine):"Convolver Reverb"===e?n=new kr(this.props.sequencerEngine):"Delay"===e?n=new Zn(this.props.sequencerEngine):"Chorus"===e?n=new Xn.ChorusEffect(this.props.sequencerEngine):"Tremolo"===e?n=new Xn.TremoloEffect(this.props.sequencerEngine):"Auto Filter"===e?n=new Xn.AutoFilterEffect(this.props.sequencerEngine):"Compressor"===e?n=new jr(this.props.sequencerEngine):"Distortion"===e?n=new xr(this.props.sequencerEngine):"Bit Crusher"===e&&(n=new Pr(this.props.sequencerEngine)),n.toggle(),t.addEffect(n),this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.props.send.getEffects();return a.a.createElement("div",{className:"send-container"},a.a.createElement("div",{className:"send-name"},this.props.send.getName()),t.map(function(t){return a.a.createElement(lg,{onEffectsChange:function(){return e.props.send.onEffectsChange()},effect:t})}),a.a.createElement(Rp,{addClassName:"add-effects-button",handleChooseEffect:function(t){e.props.send.addEffect(t),e.setState(e.state)}}))}}]),n}(r.Component),lg=function(e){Object(u.a)(n,e);var t=cg(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props.effect,t="Filter"==e.getName(),n="Reverb"==e.getName(),r="Convolver Reverb"==e.getName(),i="Delay"==e.getName(),s="Chorus"==e.getName(),o="Tremolo"==e.getName(),c="AutoFilter"==e.getName();return t?a.a.createElement(og.FilterEffect,{onEffectsChange:this.props.onEffectsChange,filterEffect:e}):i?a.a.createElement(og.DelayEffect,{onEffectsChange:this.props.onEffectsChange,delayEffect:e}):n?a.a.createElement(og.ReverbEffect,{onEffectsChange:this.props.onEffectsChange,reverbEffect:e}):r?a.a.createElement(og.ConvolverReverbEffect,{onEffectsChange:this.props.onEffectsChange,reverbEffect:e}):s?a.a.createElement(og.ChorusEffect,{onEffectsChange:this.props.onEffectsChange,chorusEffect:e}):o?a.a.createElement(og.TremoloEffect,{onEffectsChange:this.props.onEffectsChange,tremoloEffect:e}):c?a.a.createElement(og.AutoFilterEffect,{onEffectsChange:this.props.onEffectsChange,tremoloEffect:e}):"Compressor"===e.getName()?a.a.createElement(og.CompressorEffect,{onEffectsChange:this.props.onEffectsChange,effect:e}):"Distortion"===e.getName()?a.a.createElement(og.DistortionEffect,{onEffectsChange:this.props.onEffectsChange,effect:e}):"Bit Crusher"===e.getName()?a.a.createElement(og.BitCrusherEffect,{onEffectsChange:this.props.onEffectsChange,effect:e}):a.a.createElement("div",null)}}]),n}(r.Component),pg=1,hg={1:300,2:225},fg=300,dg=50;Object(g.b)(null,function(e){return{setArrangementBottomResizing:function(t){return e(Object(O.x)(t))},setArrangementBottomHeight:function(t){return e(Object(O.w)(t))}}})(function(e){var t=Object(r.useState)(void 0),n=Object(j.a)(t,2),i=n[0],s=n[1],o=Object(r.useCallback)(function(t){e.setArrangementBottomResizing(!0);var n=(new Date).getTime();void 0!==i&&n-i<=fg&&(e.sequencerEngine.store.getState().arrangement.bottomHeight<=dg?e.setArrangementBottomHeight(hg[pg]):e.setArrangementBottomHeight(0)),s(n)},[i,s]);return a.a.createElement("div",{onMouseDown:o,className:"arrangement-resizing-edge"})});var mg=function(e){return e.trackData?e.getAllParameters().filter(function(e){return e.automations.length>0}):[]},vg=new wt.a,gg=function(e){return e&&{label:e.presetName||e.name||e.getName&&e.getName(),value:e}},yg=function(e){return e&&{label:e.prettyName,value:e}},bg=function(e){var t=e.parameters;return t.sort(function(e,t){return t.automations.length-e.automations.length}),t.filter(function(e){return e.automatable})},kg=function(e,t){var n=t.liveEffects.effects.find(function(e){return e.effect===qi});if(!n)return e;var r=[];for(var a in n.macros){var i=n.macros[a];i.subMacros.length>0&&r.push({label:i.name,value:i})}return[].concat(Object(M.a)(e),r)},Eg=function(e){var t=[];return e.instrument&&e.getTrackType()!==zr.c&&t.push({value:e.instrument,label:e.instrument.name}),t=[].concat(Object(M.a)(t),Object(M.a)(e.effects.map(function(e){return gg(e)})),Object(M.a)(e.midiEffects.effects.map(function(e){return gg(e)})))};var Og=Object(g.b)(function(e,t){return t.track?{numEffects:t.track.effects&&t.track.effects.length,selectedDevice:e.automation.trackDevice[t.track.id],subDevice:e.automation.trackSubDevice[t.track.id],selectedParameter:e.automation.trackParameter[t.track.id],showAutomation:e.automation.show,selectedRackDevice:e.automation.trackRackDevice[t.track.id],selectedInstrument:e.tracks.selectedRackSubTrack[t.track.id]}:{}},function(e,t){return{setTrackAutomationParameter:function(n){return e(Object(O.Fd)(t.track.id,n))},setShowPianoRoll:function(t){return e(Object(O.cd)(t))},setTrackAutomationDevice:function(n){return e(Object(O.Ed)(t.track.id,n))},setTrackAutomationRackDevice:function(n){return e(Object(O.Gd)(t.track.id,n))},setTrackAutomationSubDevice:function(n){return e(Object(O.Hd)(t.track.id,n))},setArrangementBottomResizing:function(t){return e(Object(O.x)(t))},setArrangementBottomHeight:function(t){return e(Object(O.w)(t))},setShowAutomation:function(t){return e(Object(O.Tc)(t))}}})(function(e){var t=e.track,n=e.selectedDevice,i=e.subDevice,s=e.selectedParameter,o=e.selectedRackDevice,c=[],u=[],l=[],p=mg(t),h=Object(r.useCallback)(function(t,n){if(t.stopPropagation(),e.showAutomation)return e.setShowAutomation(!1);e.setShowAutomation(!0),n.context.subDevice?(e.setTrackAutomationDevice(n.context.instrument||n.context.effect||n.context.midiEffect),e.setTrackAutomationRackDevice(n.context.subDevice)):(n.context.midiEffect||n.context.effect)&&e.setTrackAutomationDevice(n.context.midiEffect||n.context.effect),e.setTrackAutomationParameter(n)},[s,e.setTrackAutomationDevice,e.setTrackAutomationRackDevice,e.showAutomation]);for(var f in Object(r.useEffect)(function(){e.selectedInstrument&&S(e.selectedInstrument)},[e.selectedInstrument,S]),t.getTrackType()===zr.c&&(u=Object(M.a)(t.getSubDevices()),u=kg(u,t)),o&&o.track&&(t=o.track),t.instrument&&t.getTrackType()!==zr.c&&c.push({value:t.instrument,label:t.instrument.name}),c=kg(c,t),t.effects&&(c=[].concat(Object(M.a)(c),Object(M.a)(t.effects.map(function(e){return gg(e)})),Object(M.a)(t.midiEffects.effects.map(function(e){return gg(e)})))),e.sequencerEngine.lfos){var d=e.sequencerEngine.lfos[f].lfo;c.push({value:d,label:d.name})}var m=[];for(var v in t.effects&&n&&(m=i&&n.getSubDevices?bg(i).map(function(e){return yg(e)}):bg(n).map(function(e){return yg(e)}),n.getSubDevices&&(l=n.getSubDevices())),m)m[v].value.automations.length>0&&(m[v].className="has-automations");var g,y=Object(r.useState)(void 0),b=Object(j.a)(y,2),k=b[0],E=b[1],O=Object(r.useCallback)(function(e){},[k,E]),S=Object(r.useCallback)(function(t){if(e.setTrackAutomationRackDevice(t),t.macroParameter)e.setTrackAutomationDevice(t);else{var r=Eg(t.track),a=r[0].value;if(n){var i=r.find(function(e){return e.value.name===n.name});i&&(a=i.value)}e.setTrackAutomationDevice(a);var o=bg(a);if(s){var c=o.find(function(e){return e.name===s.name});if(c)return void e.setTrackAutomationParameter(c)}e.setTrackAutomationParameter(o[0])}},[n,s]),P=Object(r.useCallback)(function(t){if(e.setTrackAutomationDevice(t),t.getSubDevices&&t.getSubDevices().length>0){var n=t.getSubDevices()[0].value;e.setTrackAutomationSubDevice(n),t=n}var r=bg(t);if(s){var a=r.find(function(e){return e.name===s.name});if(a)return void e.setTrackAutomationParameter(a)}e.setTrackAutomationParameter(r[0])},[s,e.setTrackAutomationParameter,e.setTrackAutomationSubDevice,e.setTrackAutomationDevice]),w=Object(r.useCallback)(function(t){e.setTrackAutomationSubDevice(t);var n=bg(t);if(s){var r=n.find(function(e){return e.name===s.name});if(r)return void e.setTrackAutomationParameter(r)}e.setTrackAutomationParameter(n[0])},[s]),T=e.showAutomation?"/automation-icon-enabled.png":"/automation-icon-disabled.png",x=e.showAutomation?"dropdowns":"dropdowns disabled",C=vg.getColorForTrack(e.track);return a.a.createElement("div",{style:{},className:"automation-toolbar"},a.a.createElement("div",{className:x},u.length>0?a.a.createElement(Vc.a,{onMouseDown:function(e){return e.stopPropagation()},options:u,onChange:function(e){return S(e.value)},value:gg(o),placeholder:"Rack Device"}):"",a.a.createElement(Vc.a,{onMouseDown:function(e){return e.stopPropagation()},options:c,onChange:function(e){return P(e.value)},value:gg(n),placeholder:"Device"}),l.length>0?a.a.createElement(Vc.a,{onMouseDown:function(e){return e.stopPropagation()},options:l,onChange:function(e){return w(e.value)},value:(g=i,l.find(function(e){return e.value===g})),placeholder:"Sub Device"}):"",a.a.createElement(Vc.a,{onMouseDown:function(e){return e.stopPropagation()},options:m,onChange:function(t){return e.setTrackAutomationParameter(t.value)},value:yg(s),placeholder:"Parameter"})),a.a.createElement("img",{className:"automation-icon",src:T,onClick:function(){return e.setShowAutomation(!e.showAutomation)}}),a.a.createElement("div",{onMouseDown:O,onMouseUp:function(){return e.setArrangementBottomResizing(!1)},className:"toolbar-resizer"},p.map(function(t){return a.a.createElement("div",{onMouseDown:function(e){return h(e,t)},style:e.showAutomation&&s===t?{backgroundColor:C,color:"black"}:{},className:"parameter-button"},function(e){return e.context.effect?e.context.effect.name+" - "+e.prettyName:e.context.macro?e.context.macro.name:e.prettyName}(t))})))}),Sg=new wt.a,Pg=function(e){var t=e.track,n=e.sequencerEngine,r=e.isSelected,i=e.isDisabled,s=e.setContextualHelp,o="track-option",c={};r&&(o+=" selected",c.backgroundColor=Sg.getColorForTrack(t)),i&&(o+=" disabled-by-constraint");var u={backgroundColor:Sg.getColorForTrack(t)};return a.a.createElement("div",{onMouseOver:function(){return s("TRACK_TAB_BUTTON")},onMouseLeave:function(){return s(void 0)},onMouseDown:function(e){e.stopPropagation(),n.selectTrack(t.trackNumber)},style:c,className:o},t.presetName||t.getName(),a.a.createElement("div",{style:u,className:"track-dot"}))},wg=Object(g.b)(function(e,t){var n=t.sequencerEngine.tracks&&t.sequencerEngine.tracks[e.mix.selectedTrack];return{track:n,loadingSequence:e.sequencer.loadingSequence,numTracks:t.sequencerEngine.tracks.length,id:void 0===n?0:void 0!==n.sample&&void 0!==n.sample.getId()?n.sample.getId():n.presetName||n.getName(),tracksEnabled:e.installation.tracksEnabled,hideInterface:e.installation.hideInterface}},function(e,t){return{setArrangementBottomResizing:function(t){return e(Object(O.x)(t))},setContextualHelp:function(t){return e(Object(O.U)(t))}}})(function(e){var t=e.track,n=e.sequencerEngine,i=(e.setArrangementBottomResizing,e.tracksEnabled),s=e.hideInterface,o=e.setContextualHelp,c=Object(r.useCallback)(function(e){},[]);if(void 0===t)return a.a.createElement("div",null);var u=n.tracks;return a.a.createElement("div",{onMouseDown:c,className:s?"tracks-chooser-toolbar hide":"tracks-chooser-toolbar"},u.map(function(e){return a.a.createElement(Pg,{setContextualHelp:o,isSelected:t===e,isDisabled:-1===i.indexOf(e.trackNumber),track:e,sequencerEngine:n})}))}),jg="PIANO_ROOM",Tg=36,xg=24,Cg=20;function Ng(e,t){return t*Tg*e/2}function Rg(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return e.toFrequency&&(e=e.toFrequency()),e=(e-n)/(r-n),0===n&&(e=Math.sqrt(e)),Math.max(10,t-e*t-Cg)}function Dg(e,t){return 2*e/(Tg*t)}function qg(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=(t-(e+=Cg))/t;return 0===n&&(a=Math.pow(a,2)),Math.max(n,n+a*(r-n))}var Mg=function(e,t,n,r){if(0===e.automations.length){var a=n.toFrequency?n.toFrequency():n.get();return n.getNumberFromOption&&(a=n.getNumberFromOption(a)),{step:t,value:a}}var i=e.getClosestBefore(t);if(void 0===i)return{step:t,value:e.automations[0].value};var s=e.getNextEvent(i);if(void 0===s)return{step:t,value:e.automations[e.automations.length-1].value};s.step,i.step;var o=t-i.step,c=n.min,u=n.max,l=Rg(s.value,r,c,u),p=Rg(i.value,r,c,u);return{step:t,value:qg(p+o*((l-p)/(s.step-i.step)),r,c,u)}};window.selectionColor="#47413c";var Ag=Object(g.b)(function(e,t){return{selection:e.automation.selection}},null)(function(e){if(void 0===e.selection)return[];var t=e.selection,n=t.x,r=t.y,i=t.height,s=t.width;return a.a.createElement(Sc.Rect,{x:n,y:r,height:i,width:s,fill:window.selectionColor})});window.guideColor="#c7c8c9";var Ig=Object(r.memo)(function(e){var t=e.height,n=(e.xScale,e.width),r=e.selectedParameter;e.track;if(void 0===r)return[];for(var i=r.min,s=r.max,o=[],c=(s-i)/10,u=0;u<10;u++){var l=Rg(i+c*u,t,i,s);o.push(l)}var p=Rg(r.config.defaultValue,t,i,s);return a.a.createElement(Sc.Group,null,o.map(function(e){return a.a.createElement(Sc.Line,{points:[0,e,n,e],stroke:window.guideColor,strokeWidth:1})}),a.a.createElement(Sc.Line,{points:[0,p,n,p],stroke:"#3e434a",strokeWidth:1}))}),Lg=(a.a.createContext(),"#4f4d54"),Fg=30;function Bg(e){var t=e.value,n=e.x,r=e.y,i=(e.height,e.selectedParameter);t=i.toFrequency?i.quantize(t).toNotation():i.getOptionFromNumber?i.getOptionFromNumber(t):Math.round(1e3*t)/1e3;var s=r<Fg?"up":"down";return a.a.createElement(Sc.Label,{x:n,y:r},a.a.createElement(Sc.Tag,{fill:Lg,pointerDirection:s,pointerHeight:20,pointerWidth:10}),a.a.createElement(Sc.Text,{fontSize:10,text:t.toString(),padding:5,fill:"white"}))}var Hg=Object(r.memo)(function(e){var t=e.height,n=e.xScale,i=e.isSelected,s=e.setAutomationPointHovered,o=e.setPointsSelected,c=e.isHovered,u=e.selectedParameter,l=e.point,p=e.sequencerEngine,h=e.operationManager,f=e.setGuidePoint,d=e.isDragging,m=e.setPointDragging,v=e.automation,g=Object(r.useCallback)(function(e){s(l),f(void 0)},[,f]),y=Object(r.useCallback)(function(e){s(void 0)},[]),b=Object(r.useCallback)(function(){var e=p.state.automation.pointDragging;p.state.automation.pointHasMoved||h.dispatch(function(e,t){return{type:"REMOVE_AUTOMATION_BREAK_POINT",payload:{automation:e,point:t}}}(v,e))},[u,v]);if(void 0===u)return[];var k=Ng(l.step,n),E=Rg(l.value,t,u.min,u.max),O=i||c||d?"orange":"white",S=i||c||d?"orange":"red",P=c?5:3;return a.a.createElement(Sc.Group,null,a.a.createElement(Sc.Circle,{perfectDrawEnabled:!1,onMouseDown:function(e){e.evt.stopPropagation(),m(l),i||o([])},onMouseUp:b,onMouseOver:g,onMouseLeave:y,x:k,y:E,radius:P,fill:O,strokeWidth:2,stroke:S}),d||c?a.a.createElement(Bg,{height:t,x:k,y:E,selectedParameter:u,value:l.value}):[])}),Vg=Object(g.b)(null,function(e,t){return{setGuidePoint:function(t){return e(Object(O.E)(t))},setPointDragging:function(t){return e(Object(O.F)(t))},setPointsSelected:function(t){return e(Object(O.I)(t))},setAutomationPointHovered:function(t){return e(Object(O.H)(t))}}})(Hg),Ug=(Object(r.memo)(function(e){e.height,e.xScale,e.isDragging,e.selectedParameter,e.sequencerEngine,e.pointHasMoved,e.operationManager,e.automation,e.automations;return a.a.createElement(Sc.Layer,{pixelRatio:1})}),Object(L.a)([function(e){return e.width},function(e){return e.height},function(e){return e.selectedParameter},function(e){return e.xScale},function(e){return e.events}],function(e,t,n,r,a){return Jg(e,t,n,r,a)})),Jg=function(e,t,n,r,a){if(void 0===n)return[];var i=[];if(0===a.length){var s=n.toFrequency?n.toFrequency():n.get();n.getNumberFromOption&&(s=n.getNumberFromOption(s)),i=[0,Rg(s,t,n.min,n.max)]}else i=[0,Rg(a[0].value,t,n.min,n.max)];for(var o in a)i.push(Ng(a[o].step,r)),i.push(Rg(a[o].value,t,n.min,n.max));i[i.length-2];var c=i[i.length-1];return i.push(e),i.push(c),i},_g=new wt.a;window.otherColor="#637475";var Gg=Object(r.memo)(function(e){var t=e.automation,n=e.track,i=e.sequencerEngine,s=e.automations,o=e.pointHovered,c=e.pointsSelected,u=e.pointDragging,l=e.xScale,p=e.color,h=e.height,f=e.selectedParameter,d=e.setGuidePoint,m=e.width,v=Ug({width:m,height:h,selectedParameter:f,xScale:l,events:s=s||[]}),g=n.getAllParameters().filter(function(e){return e.automations.length>0}).filter(function(e){return e!==f}).map(function(e){return Ug({width:m,height:h,selectedParameter:e,xScale:l,events:e.automations})});Object(r.useCallback)(function(e){var t=e.evt.offsetX,n=e.evt.offsetY,r=Dg(t,l),a=qg(n,h,f.min,f.max);d({step:r,value:a})},[d,f,h,l]);return[a.a.createElement(Sc.FastLayer,{pixelRatio:1},g.map(function(e,t){return a.a.createElement(Sc.Line,{key:"line-"+t,closed:!1,strokeWidth:1,points:e,stroke:_g.brighten(p,.6)})}),a.a.createElement(Sc.Line,{closed:!1,strokeWidth:2,points:v,stroke:"red"})),a.a.createElement(Sc.Layer,null,s.map(function(e){return a.a.createElement(Vg,{key:"automation-"+e.id,sequencerEngine:i,operationManager:i.operationManager,isHovered:o===e,isDragging:u&&u.id===e.id,automation:t,isSelected:c.some(function(t){return e.id===t.id}),point:e,height:h,xScale:l,selectedParameter:f})}))]}),zg=Object(g.b)(function(e,t){var n=t.selectedParameter,r=n&&n.sequencerEngine.sequenceId,a=e.automation.parameterAutomations[r];return{automations:n&&a?a[n.id]:void 0,pointHovered:e.automation.pointHovered,pointDragging:e.automation.pointDragging,pointsSelected:e.automation.pointsSelected}},function(e,t){return{setGuidePoint:function(t){return e(Object(O.E)(t))}}})(Gg),Wg=function(e){var t;return t={guidePoint:void 0,selectedPoint:void 0,pointHasMoved:void 0,pointDragging:void 0},Object(An.a)(t,"guidePoint",void 0),Object(An.a)(t,"automations",e?e.automations:[]),t},Kg=function(e,t){switch(t.type){case"setGuidePoint":return Object(D.a)({},e,{guidePoint:t.payload});case"setSelectedPoint":return Object(D.a)({},e,{selectedPoint:t.payload});case"setPointHasMoved":return Object(D.a)({},e,{pointHasMoved:t.payload});case"setPointDragging":return Object(D.a)({},e,{pointDragging:t.payload});case"setAutomations":return Object(D.a)({},e,{automations:t.payload});case"setGuidePoint":return Object(D.a)({},e,{guidePoint:t.payload});default:return e}},Qg=Object(r.memo)(function(e){var t=e.setPointDragging,n=e.setPointHasMoved,i=e.setPointsSelected,s=e.track,o=e.guidePoint,c=e.selectedParameter,u=e.xScale,l=e.dispatch,p=e.pointDragging,h=e.height,f=e.clearGuidePoint,d=Object(r.useCallback)(function(){var e=Object(R.a)(N.a.mark(function e(r){var a,o,p,h,d;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.evt.stopPropagation(),a=s.sequencerEngine.operationManager,o=Dg(r.evt.offsetX,u),p=c.automation.getValueAtStep(o),e.next=6,a.dispatch(kt(c.automation,o,p,Object(A.uuid)()));case 6:h=e.sent,d=h&&h.point,l({type:"setSelectedPoint",payload:d}),f(),n(!0),i([]),t(d);case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[f,c,u,l]);if(void 0===o||void 0===c||void 0!==p)return a.a.createElement(Sc.Layer,null,a.a.createElement(Sc.Rect,{x:0,y:0,width:0,height:0}));var m=Ng(o.step,u),v=Rg(o.value,h,c.min,c.max);return a.a.createElement(Sc.Layer,{pixelRatio:1},a.a.createElement(Sc.Circle,{onMouseDown:d,x:m,y:v,radius:4,fill:"#5802d9",stroke:"#5802d9",strokeWidth:2}))}),Xg=Object(g.b)(function(e,t){return{guidePoint:e.automation.guidePoint}},function(e,t){return{clearGuidePoint:function(){return e(Object(O.E)(void 0))},setPointDragging:function(t){return e(Object(O.F)(t))},setPointsSelected:function(t){return e(Object(O.I)(t))},setPointHasMoved:function(t){return e(Object(O.G)(t))}}})(Qg);var Yg=Object(g.b)(function(e,t){var n=e.automation.trackParameter[t.track.id];return{numEffects:t.track.effects.length,height:e.arrangement.bottomHeight-62,selectedDevice:e.automation.trackDevice[t.track.id],selectedParameter:n,automation:n&&n.automation}},function(e,t){return{setPointDragging:function(){return e(Object(O.F)(void 0))},setGuidePoint:function(t){return e(Object(O.E)(t))},setPointHasMoved:function(t){return e(Object(O.G)(t))},setSelection:function(t){return e(Object(O.J)(t))},setSelectedPoints:function(t){return e(Object(O.I)(t))}}})(function(e){var t=e.track.sequencerEngine,n=t.operationManager,i=e.setGuidePoint,s=e.setPointHasMoved,o=e.selectedParameter,c=e.height,u=e.automation,l=e.track,p=e.xScale,h=Object(r.useReducer)(Kg,e.automation,Wg),f=Object(j.a)(h,2),d=f[0],m=f[1],v=(d.selectedPoint,l.pattern&&Ng(l.pattern.length(),p)||0),g=Object(r.useCallback)(function(t){var n=t.evt.offsetX,r=t.evt.offsetY;e.setSelection({x:n,y:r,height:0,width:0})},[k]),y=Object(r.useCallback)(function(r){if(void 0!==o){var a=t.state.automation,l=a.pointDragging,h=a.selection,f=a.pointsSelected,d=r.evt.offsetX,m=r.evt.offsetY;if(l){var v=Dg(d,e.xScale),g=qg(m,c,o.min,o.max);if(f.length>0){var y=v-l.step,b=g-l.value;n.dispatch(Ot(e.automation,f,y,b))}else n.dispatch(Et(e.automation,l,v,g));s(!0)}else if(h){var k=d-h.x,E=m-h.y;e.setSelection(Object(D.a)({},h,{width:k,height:E}))}else if(void 0===t.state.automation.pointHovered){var O=Dg(r.evt.offsetX,p),S=u.getValueAtStep(O),P=u.getDistanceToClosest({step:O,value:S}),w=P.distance;if(P.point,w<.1)i(void 0);else{var j=Mg(u,O,o,c);i(j)}}}},[u,p,o,c,s,i]),b=Object(r.useCallback)(function(){var r=t.state.automation,a=r.pointDragging,i=r.pointHasMoved,s=r.selection,c=r.pointsSelected;if(a&&i)return c.length>0?c.forEach(function(t){return n.dispatch(Pt(e.automation,t))}):n.dispatch(Pt(e.automation,a)),void k();if(s){var l=s.x,h=s.y,f=s.width,d=s.height,m=o.min,v=o.max,g=Dg(l,p),y=qg(h,e.height,m,v),b=Dg(l+f,p),E=qg(h+d,e.height,m,v),O=u.getSelectedPoints(Math.min(g,b),Math.min(y,E),Math.max(b,g),Math.max(y,E));e.setSelectedPoints(O),e.setSelection(void 0)}k()},[k,o,u,p,e.height]),k=Object(r.useCallback)(function(){e.setPointDragging(void 0),e.setSelection(void 0),s(!1)},[]);return a.a.createElement("div",{style:{width:v},onMouseUp:b,onMouseLeave:k,className:"parameter-automation"},a.a.createElement(Sc.Stage,{pixelRatio:1,width:v,height:c,onMouseMove:y,onMouseDown:g},a.a.createElement(Sc.Layer,{pixelRatio:1},a.a.createElement(Sc.Rect,{x:0,y:0,height:c,width:v,fill:"white"}),a.a.createElement(Ag,null),a.a.createElement(Ig,{width:v,selectedParameter:o,height:c,xScale:p})),a.a.createElement(zg,{track:l,color:e.color,sequencerEngine:t,automation:u,selectedParameter:o,xScale:p,width:v,height:c}),a.a.createElement(Xg,{selectedParameter:o,track:e.track,dispatch:m,xScale:p,width:v,height:c})))}),Zg=36,$g=30,ey=24;var ty=function(e,t,n){n=n.map(function(e){return e.getTranspose()});var r=void 0;for(var a in n){n[a];if(e===n[a]&&(r=-1),void 0!==r&&r++,void 0!==r&&t>=n[a])return r}return r},ny=Object(g.b)(function(e,t){return{selection:e.keyboard.pianoRollSelection,notes:e.keyboard.notes}},null)(function(e){if(void 0===e.selection||1===e.selection.numNotes&&1===e.selection.numSteps)return a.a.createElement("div",null);var t=e.xScale*Zg,n=ey*e.scale,r=e.notes[0].getTranspose(),i=ty(r,e.selection.transpose,e.notes),s=ty(e.selection.transpose,e.selection.transpose-e.selection.numNotes,e.notes),o=i*n,c=e.selection.stepNumber*t,u=s*n,l=e.selection.numSteps*t,p={left:c,top:o+$g,height:u,width:l};return a.a.createElement("div",{style:p,className:"piano-roll-selection"})});function ry(e){var t=Object(r.useState)(!1),n=Object(j.a)(t,2),i=n[0],s=n[1],o={height:xg*e.scale},c="C"===e.note.note?"note-blank-side note-c":"note-blank-side",u=e.note.isBlackNote()?"black-note note-name":"white-note note-name";i&&(u+=" triggering");var l=Object(r.useCallback)(function(e){},[s,e.note,e.track]),p=Object(r.useCallback)(function(e){},[s,e.note,e.track]),h=Object(r.useCallback)(function(e){},[s,e.note,e.track]),f="note-side-info";return e.isNoteEnabled||(f+=" disabled-by-constraint"),a.a.createElement("div",{style:o,draggable:!1,className:f},a.a.createElement("div",{className:c},e.noteIndex%3===0?e.note.toString():""),a.a.createElement("div",{onMouseDown:p,onMouseUp:h,onMouseLeave:l,className:u}))}function ay(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:co,r=function(e,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1)*(t.resolution/8)*e/32*oo}(32,t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1);return Math.floor(32*(e-n)/r)}var iy=Object(g.b)(function(e,t){return{cursor:e.keyboard.cursor}},null)(function(e){if(void 0===e.cursor)return a.a.createElement("div",null);var t={left:Math.max(0,Tg*e.xScale*e.cursor-1),height:e.height};return a.a.createElement("div",{style:t,className:"piano-roll-cursor flashit"})});function sy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var oy=new Xe(16,!1),cy=new wt.a,uy=function(e){Object(u.a)(n,e);var t=sy(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"render",value:function(){var e="";e+=this.props.isCurrentStep?" current-step ":"",this.props.stepNumber%4===0&&(e+=" bar");var t={width:36*this.props.xScale,minWidth:36*this.props.xScale,height:this.props.height};return Math.floor(this.props.stepNumber/4)%2==1&&(e+=" odd"),this.props.xScale<.8&&this.props.stepNumber%2===1&&(t.borderStyle="none"),this.props.isEnabled||(e+=" disabled-by-constraint",t.backgroundColor=this.props.color,t.borderColor=cy.brighten(this.props.color,1.15)),a.a.createElement("div",{style:t,className:e+" time-grid-step"},a.a.createElement(Wc,{condition:this.props.stepNumber%4===0},this.props.stepNumber%4===0?this.props.stepNumber/16+1:""))}}]),n}(r.Component),ly=Object(g.b)(function(e,t){t.sequencerEngine.getSequenceId();var n=oy;if(void 0!==t.track.pattern.startStep)return{resolution:n,isCurrentStep:$o.baseResolution.transformStepAtResolution2(t.stepNumber,n)===t.sequencerEngine.trackStep-t.track.pattern.startStep};var r=Math.floor((t.sequencerEngine.lastTrackStep||0)/($o.baseResolution.numSteps()/n.numSteps()));return{isCurrentStep:(r%=t.stepsLength)===t.stepNumber,resolution:n}},function(e,t){return{setContextualHelp:function(t){return e(Object(O.U)(t))}}})(uy),py=32;function hy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var fy=new wt.a,dy=function(e){Object(u.a)(n,e);var t=hy(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).mouseDown=!1,r.resolution=new Xe(16,!1),r}return Object(c.a)(n,[{key:"onMouseDown",value:function(e){}},{key:"onMouseUp",value:function(e){}},{key:"onMouseMove",value:function(e){}},{key:"isStepEnabled",value:function(e){return!!this.props.browseHistory||(this.props.stepsEnabled[this.track.trackNumber]||this.props.stepsEnabled[-1]).has(e)}},{key:"render",value:function(){var e=this;if(void 0===this.track.pattern)return a.a.createElement("div",null);var t=this.track.getStepsAtResolution(this.resolution),n=this.color,r={width:36*this.props.xScale*this.track.pattern.length(this.resolution),backgroundColor:n};return a.a.createElement("div",{style:r,onMouseLeave:function(t){return e.onMouseUp(t)},onMouseMove:function(t){return e.onMouseMove(t)},onMouseDown:function(t){return e.onMouseDown(t)},onMouseUp:function(t){return e.onMouseUp(t)},draggable:!1,className:"piano-roll-time-row"},t.map(function(t,r){return a.a.createElement(ly,{key:"piano-time-"+r,track:e.track,isEnabled:e.isStepEnabled(r),color:n,isLooping:e.props.isLooping,height:e.props.height,sequencerEngine:e.props.sequencerEngine,xScale:e.props.xScale,stepsLength:e.props.stepsLength,stepNumber:r})}))}},{key:"isAlternateColor",value:function(e,t,n){return Math.ceil((e+1)/t)%2!=0}},{key:"width",get:function(){return 36*this.resolution.resolution/16}},{key:"track",get:function(){return this.props.sequencerEngine.tracks[this.props.selectedTrack]}},{key:"color",get:function(){return fy.saturate(fy.getColorForTrack(this.track),.6)}}]),n}(r.Component),my=Object(g.b)(function(e,t){t.sequencerEngine.getSequenceId();var n=e.tracks.trackSteps[e.mix.selectedTrack];return{stepsLength:void 0===n?32:n.length,stepsEnabled:e.installation.stepsEnabled,selectedTrack:e.mix.selectedTrack,browseHistory:e.installation.browseHistory}},function(e,t){return{}})(dy),vy=function(e){e.mouseDown(!1),e.setStepToCopy(void 0),e.setIsDraggingDuration(!1),e.setStepDataDragging(void 0),e.setTransposeDragging(void 0)};function gy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var yy=new wt.a,by=(new Xe(16,!1),$o.baseResolution),ky=function(e){Object(u.a)(n,e);var t=gy(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={offset:void 0},r.operationManager=r.props.sequencerEngine.operationManager,r}return Object(c.a)(n,[{key:"deleteStep",value:function(){this.operationManager.dispatch(ht(this.props.track,[this.props.stepData])),this.props.setSelectedPianoRollSteps(void 0)}},{key:"onMouseDown",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.isEnabled){if(e.stopPropagation(),e.preventDefault(),this.props.setPianoRollDragOffset(this.getClickOffset(e)),this.props.mouseDown(!0),this.props.setDragStepTranspose(this.note.getTranspose()),t){var n=this.getStepNumber(e);this.props.setStepDragging(n)}this.props.setStepToCopy(this.props.stepData),this.props.setTransposeDragging(this.note.getTranspose());var r=this.props.stepData,a=this.lastClick;this.lastClick=(new Date).getTime();var i=this.getState();this.isSelectedStep()&&(void 0===i.keyboard.stepDataDragging||i.keyboard.stepDataDragging.id!==this.props.stepData.id)&&this.lastClick-a<600?this.deleteStep():void 0!==this.props.selectedPianoRollSteps&&this.props.selectedPianoRollSteps.filter(function(e){return void 0!==e}).some(function(e){return e.id===r.id})||this.props.setSelectedPianoRollSteps([this.props.stepData])}}},{key:"getState",value:function(){return this.props.sequencerEngine.store.getState()}},{key:"onMouseUp",value:function(e){if(this.isEnabled){e.stopPropagation(),e.preventDefault();var t=this.props.stepData,n=this.props.sequencerEngine.store.getState();n.keyboard.isDraggingDuration||(void 0!==n.keyboard.pianoRollSelection&&n.keyboard.pianoRollSelection.numNotes>1&&n.keyboard.pianoRollSelection.numNotes>1?this.props.setPianoRollSelection(void 0):void 0===n.keyboard.pianoRollSelection&&void 0!==n.keyboard.stepDataDragging&&t.id===n.keyboard.stepDataDragging.id&&this.snapToGridIfNecessary()),vy(this.props)}else console.log("not enabled!")}},{key:"dragStepDuration",value:function(e){this.isEnabled&&(this.props.setIsDraggingDuration(!0),this.props.setStepAndDataDragging(parseFloat(this.props.stepNumber)+parseFloat(this.props.position),this.getState().keyboard.stepToCopy),this.onMouseDown(e,!1))}},{key:"isSelectedStep",value:function(){return void 0!==this.props.selectedPianoRollSteps&&this.props.selectedPianoRollSteps.indexOf(this.props.stepData)>-1}},{key:"moveSteps",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[this.props.stepData],n=this.getClickOffset(e)/(Tg*this.props.xScale),r=this.props.position;n+=parseFloat(r);var a=this.getState().keyboard.dragOffset||0;a/=Tg*this.props.xScale,a+=parseFloat(r);var i=parseFloat(n)-parseFloat(a),s={stepDifference:by.transformStepAtResolution2(i,this.props.resolution),transposeDifference:0};Math.abs(s.stepDifference)<=.001||this.operationManager.dispatch(pt(this.props.track,t,s,by,!0))}},{key:"getStepNumber",value:function(e){return(this.scrollLeft+e.pageX-56)/(Tg*this.props.xScale)}},{key:"getClickOffset",value:function(e){return this.scrollLeft+e.pageX-this.getLeft()-62}},{key:"onMouseMove",value:function(e){if(this.isEnabled){var t=this.getState(),n=t.keyboard.isMouseDown,r=t.keyboard.pianoRollSelection;if(n&&!t.keyboard.isDraggingDuration&&void 0===r){e.stopPropagation();var a=this.getStepNumber(e);this.props.setStepAndDataDragging(a,t.keyboard.stepToCopy),void 0!==t.keyboard.selectedPianoRollSteps&&t.keyboard.selectedPianoRollSteps.length>=1&&this.moveSteps(e,t.keyboard.selectedPianoRollSteps)}else if(n&&this.getState().keyboard.isDraggingDuration){var i=this.getClickOffset(e)/this.width;this.updateDuration(i+.1)}}}},{key:"updateDuration",value:function(e){}},{key:"snapToGridIfNecessary",value:function(){if(this.getState().sequencer.quantized){var e=this.getState().keyboard.selectedPianoRollSteps;this.operationManager.dispatch(St(this.props.track,e,this.props.resolution)),this.props.track.updateSteps()}}},{key:"getLeft",value:function(){var e=this.props.position*Tg*this.props.xScale;return this.props.stepNumber*Tg*this.props.xScale+e}},{key:"getStyle",value:function(){var e={left:this.getLeft(),height:this.props.height};return this.props.stepData?e.width=this.width*Math.max(.1,this.props.stepData.duration):e.width=this.width*Math.max(.1,this.props.duration),this.isSelectedStep()?(e.borderColor=this.props.color,e.backgroundColor=yy.brighten(this.props.color,.3)):e.backgroundColor=this.props.color,e}},{key:"isQueuedAction",value:function(){return void 0!==this.props.stepData&&this.props.isQueuedAction}},{key:"render",value:function(){var e=this,t=this.props.isAlternateColor?"alternate ":"",n=!this.props.isGuideStep&&this.isSelectedStep();return t+=n?" selected ":"",this.props.isGuideStep&&(t+=" guide-step"),this.isQueuedAction()&&!n&&(t+=" queued"),a.a.createElement("div",{onMouseOver:function(){return e.props.isGuideStep?void 0:e.props.setContextualHelp("PIANO_ROLL_STEP")},onMouseLeave:function(){return e.props.isGuideStep?void 0:e.props.setContextualHelp(void 0)},draggable:!1,onMouseMove:function(t){return e.onMouseMove(t)},onMouseDown:function(t){return e.onMouseDown(t)},onMouseUp:function(t){return e.onMouseUp(t)},style:this.getStyle(),className:t+" grid-step toggled-grid-step on"},this.props.on?a.a.createElement("div",{draggable:!1,onMouseDown:function(t){return e.dragStepDuration(t)},className:"right-edge"}):"")}},{key:"scrollLeft",get:function(){if(this.props.parentClassName){var e=this.parentElement||document.getElementsByClassName(this.props.parentClassName)[0];return void 0===this.parentElement&&(this.parentElement=e),e.scrollLeft}return 0}},{key:"width",get:function(){return this.props.xScale*Tg*this.props.resolution.resolution/16}},{key:"note",get:function(){return this.getState().keyboard.notes[this.props.noteIndex]||_i.a.NOTES[0]}},{key:"isEnabled",get:function(){var e=this.getState();return!!e.installation.browseHistory||(e.installation.stepsEnabled[this.props.track.trackNumber]||e.installation.stepsEnabled[-1]).has(parseInt(this.props.stepNumber))}}]),n}(r.Component),Ey=Object(g.b)(null,function(e,t){return{mouseDown:function(t){return e(Object(O.k)(t))},dragToggle:function(t){return e(Object(O.i)(t))},setStepDragging:function(t){return e(Object(O.rd)(t))},setStepToCopy:function(t){return e(Object(O.ud)(t))},setTransposeDragging:function(t){return e(Object(O.Zd)(t))},setDragStepTranspose:function(t){return e(Object(O.h)(t))},setIsDraggingDuration:function(t){return e(Object(O.Ab)(t))},setStepDataDragging:function(t){return e(Object(O.qd)(t))},setStepAndDataDragging:function(t,n){return e(Object(O.pd)(t,n))},setPianoRollSelection:function(t,n,r,a){return e(Object(O.kc)(t,n,r,a))},setSelectedPianoRollSteps:function(t){return e(Object(O.Gc)(t))},setPianoRollDragOffset:function(t){return e(Object(O.hc)(t))},setPianoRollCursor:function(t){return e(Object(O.gc)(t))},setContextualHelp:function(t){return e(Object(O.U)(t))}}})(ky);Object(L.a)([function(e){return e.rowSteps},function(e){return e.queuedContentIds}],function(e,t){return void 0===e?[]:Object.keys(e).map(function(t){return e[t]}).filter(function(e){return t.indexOf(e)>-1})});function Oy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Sy=new wt.a,Py=function(e){Object(u.a)(n,e);var t=Oy(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"isEqual",value:function(e,t){if(void 0===e&&void 0!==t)return!1;if(void 0===t&&void 0!==e)return!1;if(void 0===e&&void 0===t)return!0;if("object"===typeof e){if(Object.keys(e).length!==Object.keys(t).length)return!1}else if(e.length!==t.length)return!1;for(var n in e)if(void 0!==e[n].id){if(e[n].id!==t[n].id)return!0}else if(e[n]!==t[n])return!1;return!0}},{key:"getState",value:function(){return this.props.sequencerEngine.store.getState()}},{key:"shouldComponentUpdate",value:function(e){return!(this.props.currentPattern==e.currentPattern&&this.isEqual(e.rowSteps,this.props.rowSteps)&&this.props.xScale===e.xScale&&this.props.selectedPianoRollSteps===e.selectedPianoRollSteps&&this.isEqual(e.allSteps,this.props.allSteps)&&this.isEqual(e.rowDurations,this.props.rowDurations)&&this.isEqual(e.rowPositions,this.props.rowPositions)&&this.props.resolution===e.resolution)}},{key:"getTrack",value:function(e){return this.props.sequencerEngine.tracks[e]}},{key:"getColorForTrack",value:function(e){var t=this.getTrack(e);return Sy.getColorForTrack(t)}},{key:"isStepEnabled",value:function(e){var t=this.getState();return!!t.installation.browseHistory||(t.installation.stepsEnabled[this.track.trackNumber]||t.installation.stepsEnabled[-1]).has(parseInt(e))}},{key:"getState",value:function(){return this.props.sequencerEngine.store.getState()}},{key:"render",value:function(){var e=this,t=this.props.rowSteps||{},n=this.props.allSteps||{};return a.a.createElement("div",{className:"toggled-piano-roll-steps-container"},Object.keys(n).map(function(t,r){return a.a.createElement(Ey,{key:"piano-grid-"+r,height:e.props.height,xScale:e.props.xScale,position:e.props.allPositions[t],sequencerEngine:e.props.sequencerEngine,resolution:e.props.resolution,parentClassName:e.props.parentClassName,color:e.getColorForTrack(n[t]),track:e.getTrack(n[t]),on:!0,isGuideStep:!0,selectedPianoRollSteps:e.props.selectedPianoRollSteps,duration:e.props.allDurations[t],stepNumber:t,noteIndex:e.props.noteIndex})}),Object.keys(t).map(function(t,n){var r=e.getStep(t);return a.a.createElement(Ey,{key:"piano-grid-"+n,height:e.props.height,xScale:e.props.xScale,position:e.props.rowPositions[t],isEnabled:e.isStepEnabled(t),sequencerEngine:e.props.sequencerEngine,resolution:e.props.resolution,parentClassName:e.props.parentClassName,isQueuedAction:e.queuedContentIds&&e.queuedContentIds.indexOf(r.id)>-1,color:Sy.getColorForTrack(e.track),track:e.track,on:!0,selectedPianoRollSteps:e.props.selectedPianoRollSteps,stepData:r,duration:r.duration,stepNumber:t,noteIndex:e.props.noteIndex})}))}},{key:"getStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.note,n=this.track.getEasyPattern().getStepWithTranspose(e,this.props.resolution,t.getTranspose());return void 0===n?new Ge:n}},{key:"track",get:function(){return this.props.sequencerEngine.tracks[this.getState().mix.selectedTrack]}},{key:"note",get:function(){return this.props.sequencerEngine.store.getState().keyboard.notes[this.props.noteIndex]||_i.a.NOTES[0]}},{key:"queuedContentIds",get:function(){return this.getState().installation.queuedContentIds}}]),n}(r.Component),wy=Object(g.b)(function(e,t){e.tracks.trackSteps[e.mix.selectedTrack];var n=void 0===e.keyboard.notes[t.noteIndex]?0:e.keyboard.notes[t.noteIndex].getTranspose(),r=e.tracks.trackPianoRollSteps[e.mix.selectedTrack],a=e.tracks.trackPianoRollPositions[e.mix.selectedTrack],i=e.tracks.trackPianoRollDurations[e.mix.selectedTrack];return{selectedPianoRollSteps:e.keyboard.selectedPianoRollSteps,allSteps:e.tracks.allSteps[n],allDurations:e.tracks.allDurations[n],allPositions:e.tracks.allPositions[n],rowSteps:r?r[n]:void 0,rowPositions:a?a[n]:void 0,rowDurations:i?i[n]:void 0,currentPattern:void 0===r?void 0:t.sequencerEngine.currentPattern}},null)(Py);function jy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ty=new Xe(16,!1),xy=$o.baseResolution,Cy=function(e){Object(u.a)(n,e);var t=jy(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).operationManager=r.props.sequencerEngine.operationManager,r}return Object(c.a)(n,[{key:"getState",value:function(){return this.props.sequencerEngine.store.getState()}},{key:"isEqual",value:function(e,t){if(void 0===e&&void 0!==t)return!1;if(void 0===t&&void 0!==e)return!1;if(void 0===e&&void 0===t)return!0;if("object"===typeof e){if(Object.keys(e).length!==Object.keys(t).length)return!1}else if(e.length!==t.length)return!1;for(var n in e)if(e[n]!==t[n])return!1;return!0}},{key:"shouldComponentUpdate",value:function(e){return e.stepsLength!==this.props.stepsLength||e.height!==this.props.height||e.xScale!==this.props.xScale||!this.isEqual(e.selection,this.props.selection)}},{key:"isDisabled",value:function(e){var t=this.getState();return!t.installation.browseHistory&&!(t.installation.stepsEnabled[this.track.trackNumber]||t.installation.stepsEnabled[-1]).has(Math.floor(this.getStepNumber(e)))}},{key:"onMouseUp",value:function(e){if(!this.isDisabled(e)&&(e.preventDefault(),this.getState().keyboard.isMouseDown)){var t=this.getStep(e),n=this.props.sequencerEngine.store.getState();if(this.getState().keyboard.isDraggingDuration);else if(void 0!==n.keyboard.pianoRollSelection&&n.keyboard.pianoRollSelection.numNotes>1&&n.keyboard.pianoRollSelection.numNotes>1){var r=this.track.getEasyPattern().getSelectedPianoRollSteps(n.keyboard.pianoRollSelection,this.resolution);this.props.setSelectedPianoRollSteps(r),this.props.setPianoRollSelection(void 0)}else if(void 0===t||void 0!==this.getState().keyboard.stepDataDragging&&t.id===this.getState().keyboard.stepDataDragging.id||!t.on){if(this.cursor!==Math.floor(this.getStepNumber(e))){var a=Math.floor(this.getStepNumber(e));this.props.setPianoRollCursor(a),this.props.sequencerEngine.cursor.setStep(a,this.resolution),this.props.setArrangementMouseX(void 0),this.props.setPianoRollSelection(void 0),this.props.setSelectedPianoRollSteps(void 0)}else if((t!==this.getState().keyboard.stepToCopy||void 0===t||!t.on)&&void 0===this.getState().keyboard.stepDataDragging){var i=new Ge;i.on=!0,i.transpose=this.note.getTranspose(),i.duration=this.track.length/64,this.operationManager.dispatch(ot(this.track,i,Math.floor(this.getStepNumber(e)),this.resolution)),this.props.setSelectedPianoRollSteps(void 0),this.props.setPianoRollSelection(void 0),this.props.setPianoRollCursor(void 0),this.track.updateSteps()}}else this.deleteStep(e),this.track.updateSteps();vy(this.props)}}},{key:"onMouseDown",value:function(e){if(!this.isDisabled(e)){e.preventDefault(),this.props.mouseDown(!0),this.props.setDragStepTranspose(this.note.getTranspose()),this.props.setStepToCopy(this.getStep(e)),this.props.setTransposeDragging(this.note.getTranspose()),this.props.setStepDragging(this.getStepNumber(e));this.getStep(e),this.props.sequencerEngine.store.getState();this.props.setPianoRollSelection(Math.floor(this.getStepNumber(e)),this.note.getTranspose(),1,1)}}},{key:"getStepNumber",value:function(e){return(this.scrollLeft+e.pageX-56)/(Tg*this.props.xScale)}},{key:"getOffset",value:function(e){return this.scrollLeft+e.pageX-this.getLeft(e)-53}},{key:"getLeft",value:function(e){return this.getStepNumber(e)*Tg*this.props.xScale}},{key:"onMouseOver",value:function(e){var t=e.pageX,n=(this.scrollLeft,this.props.sequencerEngine.store.getState()),r=n.keyboard.isMouseDown,a=(this.note.getTranspose(),this.resolution,n.keyboard.pianoRollSelection);if(r&&!this.getState().keyboard.isDraggingDuration&&void 0===a){if(this.isDisabled(e))return;void 0!==n.keyboard.selectedPianoRollSteps&&n.keyboard.selectedPianoRollSteps.length>1?this.moveSelection(t):this.moveSelection(t,[n.keyboard.stepToCopy]),this.props.setStepDataDragging(n.keyboard.stepToCopy)}else if(r&&!this.getState().keyboard.isDraggingDuration){if(this.isDisabled(e))return;this.updateSelection(e)}else if(r&&this.getState().keyboard.isDraggingDuration){if(this.isDisabled(e))return;this.updateDuration(e)}}},{key:"updateDuration",value:function(e){var t=this.getOffset(e)/(Tg*this.props.xScale)+this.getStepNumber(e)-this.getState().keyboard.stepDragging,n=Math.max(.1,Ty.transformStepAtResolution2(t,this.resolution)),r=(this.track.trackData.transpose,this.note.getTranspose(),this.getState().keyboard.stepToCopy);if(void 0!==r){var a=n/(null===r.duration?this.track.trackData.duration:r.duration),i=this.props.sequencerEngine.store.getState();if(void 0===i.keyboard.selectedPianoRollSteps&&this.operationManager.dispatch(dt(this.track,[r],void 0,n)),this.resolution.isTriplet&&this.track.pattern.syncBuckets(this.resolution.isTriplet),void 0!==i.keyboard.selectedPianoRollSteps&&a!==1/0){this.track.trackData.duration;var s=i.keyboard.selectedPianoRollSteps;this.operationManager.dispatch(dt(this.track,s,a))}this.track.updateSteps()}}},{key:"getStep",value:function(e){var t=this.track.getEasyPattern(),n=this.getStepNumber(e);if(n>0)return new Ge;var r=t.getStepWithTranspose(n,this.resolution,this.note.getTranspose());return void 0===r?new Ge:r}},{key:"moveSelection",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getState().keyboard.selectedPianoRollSteps,n=(this.track.getEasyPattern(),this.getTransformation(e));this.operationManager.dispatch(pt(this.track,t,n,xy,!0));var r=this.getStepNumber({pageX:e});this.props.setStepDragging(r),this.props.setTransposeDragging(this.note.getTranspose())}},{key:"getTransformation",value:function(e){var t=this.props.sequencerEngine.store.getState(),n=this.getStepNumber({pageX:e})-t.keyboard.stepDragging,r=void 0===t.keyboard.transposeDragging?this.track.trackData.transpose:t.keyboard.transposeDragging,a=this.note.getTranspose()-r;return{stepDifference:xy.transformStepAtResolution2(n,this.resolution),transposeDifference:a}}},{key:"updateSelection",value:function(e){var t=this.props.sequencerEngine.store.getState();this.note.getTranspose();if(void 0!==t.keyboard.pianoRollSelection)Math.floor(this.getStepNumber(e))}},{key:"moveStep",value:function(e){var t=this.note.getTranspose();this.track.getEasyPattern().deleteStep(this.getState().keyboard.stepToCopy),this.operationManager.dispatch(ct(this.track,this.getState().keyboard.stepToCopy,this.getState().keyboard.stepDragging,this.resolution)),this.getState().keyboard.stepToCopy.transpose=t,this.operationManager.dispatch(ot(this.track,this.getState().keyboard.stepToCopy,this.getStepNumber({pageX:e}),this.resolution))}},{key:"deleteStep",value:function(e){this.operationManager.dispatch(ct(this.track,this.getStep(e),this.getStepNumber(e),this.resolution)),this.props.setSelectedPianoRollSteps(void 0),this.track.updateSteps()}},{key:"render",value:function(){var e=this;this.props.scale,parseInt(this.resolution.numSteps());return a.a.createElement("div",{onMouseDown:function(t){return e.onMouseDown(t)},onMouseUp:function(t){return e.onMouseUp(t)},onMouseMove:function(t){return e.onMouseOver(t)},className:"grid-steps-container"},a.a.createElement(wy,{color:this.props.color,stepsLength:this.props.stepsLength,parentClassName:this.props.parentClassName,resolution:this.resolution,noteIndex:this.props.noteIndex,xScale:this.props.xScale,sequencerEngine:this.props.sequencerEngine,height:this.props.height,track:this.track}))}},{key:"isStepInSelection",value:function(e,t){return void 0!==e&&(t>=e.stepNumber&&t<e.stepNumber+e.numSteps)}},{key:"isAlternateColor",value:function(e,t,n){return Math.ceil((e+1)/t)%2!=0}},{key:"resolution",get:function(){return Ty}},{key:"note",get:function(){return this.getState().keyboard.notes[this.props.noteIndex]||_i.a.NOTES[0]}},{key:"cursor",get:function(){return this.getState().keyboard.cursor}},{key:"scrollLeft",get:function(){if(this.props.parentClassName){var e=this.parentElement||document.getElementsByClassName(this.props.parentClassName)[0];return void 0===this.parentElement&&(this.parentElement=e),e.scrollLeft}return 0}},{key:"track",get:function(){return this.props.sequencerEngine.tracks[this.getState().mix.selectedTrack]}}]),n}(r.Component);function Ny(e,t){if(void 0!==e)return t<=e.transpose&&t>e.transpose-e.numNotes?e:void 0}var Ry=Object(g.b)(function(e,t){var n=e.tracks.trackSteps[e.mix.selectedTrack],r=e.keyboard.notes[t.noteIndex],a=void 0===r?0:r.getTranspose();return{stepsLength:void 0===n?16:n.length,selection:Ny(e.keyboard.pianoRollSelection,a)}},function(e,t){return{mouseDown:function(t){return e(Object(O.k)(t))},dragToggle:function(t){return e(Object(O.i)(t))},setStepDragging:function(t){return e(Object(O.rd)(t))},setStepToCopy:function(t){return e(Object(O.ud)(t))},setTransposeDragging:function(t){return e(Object(O.Zd)(t))},setDragStepTranspose:function(t){return e(Object(O.h)(t))},setIsDraggingDuration:function(t){return e(Object(O.Ab)(t))},setStepDataDragging:function(t){return e(Object(O.qd)(t))},setPianoRollSelection:function(t,n,r,a){return e(Object(O.kc)(t,n,r,a))},setSelectedPianoRollSteps:function(t){return e(Object(O.Gc)(t))},setPianoRollCursor:function(t){return e(Object(O.gc)(t))},setArrangementMouseX:function(t){return e(Object(O.A)(t))}}})(Cy);function Dy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var qy=new wt.a,My=function(e){Object(u.a)(n,e);var t=Dy(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={triggering:!1},r}return Object(c.a)(n,[{key:"onMouseLeave",value:function(e){this.state.triggering&&(this.triggerRelease(e),this.setState({triggering:!1}))}},{key:"getState",value:function(){return this.props.sequencerEngine.store.getState()}},{key:"onMouseUp",value:function(){var e=this.getState();void 0!==e.keyboard.stepDataDragging&&void 0!==e.keyboard.selectedPianoRollSteps&&this.snapToGridIfNecessary(),vy(this.props)}},{key:"snapToGridIfNecessary",value:function(){if(this.getState().sequencer.quantized){var e=this.getState().keyboard.selectedPianoRollSteps;this.props.sequencerEngine.operationManager.dispatch(St(this.track,e,this.props.resolution)),this.track.updateSteps()}}},{key:"triggerRelease",value:function(e){e.stopPropagation(),this.track.midiEffects.liveInputRelease(this.transpose,0),this.setState({triggering:!1})}},{key:"render",value:function(){var e=this,t=xg*this.props.scale;if(void 0===this.track.pattern)return a.a.createElement("div",null);var n={height:t},r="piano-roll-row";r+=this.props.note.isBlackNote()?" black":"";this.props.note.note,this.props.note.isBlackNote();this.state.triggering;return this.props.isNoteEnabled||this.props.browseHistory||(r+=" disabled-by-constraint",n.backgroundColor=qy.getColorForTrack(this.track)),a.a.createElement("div",{draggable:!1,onMouseUp:function(){return e.onMouseUp()},style:n,className:r},"",a.a.createElement(Ry,{height:t,parentClassName:this.props.parentClassName,sequencerEngine:this.props.sequencerEngine,xScale:this.props.xScale,noteIndex:this.props.noteIndex}))}},{key:"transpose",get:function(){return this.props.note.getTranspose()}},{key:"track",get:function(){return this.props.sequencerEngine.tracks[this.getState().mix.selectedTrack]}}]),n}(r.Component),Ay=Object(g.b)(function(e,t){return{selectedTrack:!t.isNoteEnabled&&e.mix.selectedTrack,browseHistory:e.installation.browseHistory}},function(e,t){return{mouseDown:function(t){return e(Object(O.k)(t))},dragToggle:function(t){return e(Object(O.i)(t))},setStepDragging:function(t){return e(Object(O.rd)(t))},setStepToCopy:function(t){return e(Object(O.ud)(t))},setTransposeDragging:function(t){return e(Object(O.Zd)(t))},setDragStepTranspose:function(t){return e(Object(O.h)(t))},setIsDraggingDuration:function(t){return e(Object(O.Ab)(t))},setStepDataDragging:function(t){return e(Object(O.qd)(t))},setStepAndDataDragging:function(t,n){return e(Object(O.pd)(t,n))},setPianoRollSelection:function(t,n,r,a){return e(Object(O.kc)(t,n,r,a))},setSelectedPianoRollSteps:function(t){return e(Object(O.Gc)(t))},setPianoRollDragOffset:function(t){return e(Object(O.hc)(t))}}})(My);function Iy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ly=$o.baseResolution,Fy=function(e){Object(u.a)(n,e);var t=Iy(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"getOptions",value:function(){for(var e=2*this.value,t=(this.props.resolution.resolution,[]);e>1;)t.push({label:e,value:e}),e-=4;return t}},{key:"getOptionFromValue",value:function(e){for(var t=this.getOptions(),n=0;n<t.length;n++)if(t[n].value==e)return t[n];return null}},{key:"onChangeLength",value:function(e,t){e=Ly.transformStepAtResolution2(e,this.props.resolution),this.props.track.pattern.changeLength(e),this.props.track.updateSteps(),this.setState(this.state)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"track-length-container"},a.a.createElement("div",{className:"length-label"},"LENGTH"),a.a.createElement(Vc.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.getOptions(),onChange:function(t,n){return e.onChangeLength(t.value,n)},value:this.getOptionFromValue(this.value),placeholder:"Length"}))}},{key:"value",get:function(){return this.props.track.pattern.length(this.props.resolution)}}]),n}(r.Component);function By(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Hy=function(e){Object(u.a)(n,e);var t=By(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={transcribing:!1},r}return Object(c.a)(n,[{key:"transcribeButton",value:function(){var e=this;this.setState({transcribing:!0,loadingText:"Transcribing to MIDI..."}),setTimeout(function(){e.props.sequencerEngine.transcribeIntoMidi(e.props.track).then(function(){e.setState({transcribing:!1}),e.props.setTrackFocused(e.props.sequencerEngine.tracks.length-1)})},100)}},{key:"hasTracksToResample",value:function(){return void 0!==this.props.tracksToResample&&this.props.tracksToResample.length>0}},{key:"isTranscribing",value:function(){return void 0!==this.state.transcribing&&this.state.transcribing}},{key:"isLoading",value:function(){return this.isTranscribing()}},{key:"getLoadingText",value:function(){return this.isTranscribing()?"Transcribing to MIDI... ":this.hasTracksToResample()?"Waiting to resample... ":this.props.isResampling?"Resampling... ":void 0}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(e),this.props.setContextualHelp(t)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"piano-roll-toolbar"},a.a.createElement(Wc,{condition:this.props.track.getTrackType()===zr.e},a.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"TRANSCRIBE")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},draggable:!1,onClick:function(){return e.transcribeButton()},className:"transcribe-button"},"TRANSCRIBE")),a.a.createElement(Wc,{condition:this.isLoading()},this.getLoadingText()),a.a.createElement(v.a,{sizeUnit:"px",size:10,color:"#123abc",loading:this.isLoading()}),a.a.createElement(Fy,{onChange:this.props.onChangeLength,resolution:this.props.resolution,track:this.props.track}))}}]),n}(r.Component);Object(g.b)(function(e,t){return{tracksToResample:e.tracks.tracksToResample,isResampling:e.tracks.isResampling,resampleDuration:e.tracks.resampleDuration,resolution:e.sequencer.resolution}},function(e,t){return{setTracksToResample:function(t){return e(Object(O.Yd)(t))},setTrackFocused:function(t){return e(Object(O.Id)(t))},setResampleDuration:function(t){return e(Object(O.qc)(t))},setContextualHelp:function(t){return e(Object(O.U)(t))}}})(Hy);function Vy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Uy=function(e){Object(u.a)(n,e);var t=Vy(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"getStart",value:function(){return void 0!==this.props.paginationStart?this.props.paginationStart:this.props.start}},{key:"getEnd",value:function(){return void 0!==this.props.paginationEnd?this.props.paginationEnd:this.props.end}},{key:"onClickPreviousPage",value:function(){this.props.setPianoRollPagination(this.getStart()-py,this.getEnd()-py)}},{key:"onClickNextPage",value:function(){this.props.setPianoRollPagination(this.getStart()+py,this.getEnd()+py)}},{key:"onClickUnlock",value:function(){this.props.setPianoRollPagination(void 0,void 0)}},{key:"render",value:function(){var e,t,n=this;return a.a.createElement("div",{className:"pagination-buttons"},a.a.createElement("div",{className:"page-info"},(t=this.getStart(),1+Math.floor(t/32))," / ",(e=this.props.stepsLength)<py?1:Math.floor(e/32)),void 0!==this.props.paginationStart?a.a.createElement("div",{className:"unlock-button",onClick:function(){return n.onClickUnlock()}},"UNLOCK"):"",function(e){return e-py>=0}(this.getStart())?a.a.createElement("div",{onClick:function(){return n.onClickPreviousPage()},className:"previous-page-button"},"PREVIOUS"):"",function(e,t){return e+py<=t}(this.getEnd(),this.props.stepsLength)?a.a.createElement("div",{onClick:function(){return n.onClickNextPage()},className:"next-page-button"},"NEXT"):"")}}]),n}(r.Component);Object(g.b)(function(e,t){var n=e.tracks.trackSteps[t.track.trackNumber],r=t.sequencerEngine.getSequenceId(),a=Math.floor((e.sequencer.currentStep[r]||0)/($o.baseResolution.numSteps()/e.sequencer.resolution.numSteps()));a=void 0===n?0:a%n.length;var i=void 0===n?0:function(e,t){var n=0,r=t;return e%py==0?(n=e,r=e+py):(n=32*Math.floor(e/32),r=32*(Math.floor(e/32)+1)),r>=t&&(r=t),{start:n,end:r}}(a,n.length);return{stepsLength:void 0==n?16:n.length,paginationStart:void 0===e.keyboard.pianoRollPagination?void 0:e.keyboard.pianoRollPagination.start,paginationEnd:void 0===e.keyboard.pianoRollPagination?void 0:e.keyboard.pianoRollPagination.end,start:i.start,end:i.end}},function(e,t){return{setPianoRollPagination:function(t,n){return e(Object(O.jc)(t,n))}}})(Uy),n(1669);function Jy(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var _y=new Xe(16,!1),Gy={},zy=.35,Wy=new wt.a,Ky=function(e){Object(u.a)(n,e);var t=Jy(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={loading:!1,notes:[],overZoom:!1,xScale:Math.max(zy,r.getMinXScale())},r.ref=a.a.createRef(),r.note=r.getInitialNote(),r.updateNotes(),r.scale=r.calculateScale(),r.lastKeyDownEvent=void 0,r.operationManager=r.props.sequencerEngine.operationManager,r.onKeyDown=r.onKeyDown.bind(Object(W.a)(r)),r.onKeyUp=r.onKeyUp.bind(Object(W.a)(r)),r.onWheel=r.onWheel.bind(Object(W.a)(r)),r}return Object(c.a)(n,[{key:"getInitialNote",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props;return _i.a.NOTES[0]}},{key:"shouldComponentUpdate",value:function(e){return e.stepsLength!==this.props.stepsLength&&(this.state.xScale=Math.max(zy,this.getMinXScale(e))),void 0!==e.mouseX&&e.mouseX!==this.props.mouseX&&this.updateCursorFromArrangement(e),(e.bottomHeight!==this.props.bottomHeight||e.track!==this.props.track||!e.isPlayingMix&&void 0!==e.track)&&(this.note=this.getInitialNote(e),this.scale=this.calculateScale()),!0}},{key:"calculateScale",value:function(){return console.log("notes length = ",this.props.sequencerEngine.state.keyboard.notes.length),24/this.props.sequencerEngine.state.keyboard.notes.length*.8}},{key:"updateNotes",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props;var e=this.rules.getScale();e.sort(function(e,t){return t.getTranspose()-e.getTranspose()}),this.props.setPianoRollNotes(e.slice(5))}},{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp);document.getElementsByClassName("arrangement-bottom-container")[0];if(void 0!==this.props.mouseX)this.updateCursorFromArrangement()}},{key:"updateCursorFromArrangement",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,t=this.props.sequencerEngine.store.getState(),n=ay(e.mouseX,this.resolution,void 0,t.arrangement.xScale)/2;this.props.setPianoRollCursor(n);var r=55+36*n*this.state.xScale;return document.getElementsByClassName("piano-roll-wrapper")[0].scrollLeft=r-200,n}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}},{key:"onKeyUp",value:function(e){"Space"!==e.key&&(void 0,delete Gy[e.keyCode],91==e.keyCode&&(Gy={}))}},{key:"onKeyDown",value:function(e){if("Space"!==e.key){if(Gy[e.keyCode])return"a"!==e.key||!e.metaKey||(e.preventDefault(),!1);Gy[e.keyCode]=!0,e}}},{key:"getSelectedSteps",value:function(){return this.props.sequencerEngine.store.getState().keyboard.selectedPianoRollSteps}},{key:"hasSelection",value:function(){var e=this.getSelectedSteps();return void 0!==e&&e.length>0}},{key:"getNumNotes",value:function(){var e=17*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props).bottomHeight/460;return Math.max(Math.ceil(e/this.scale),1)}},{key:"onMouseDown",value:function(e,t,n){this.mouseDown=!0,this.dragStartY=e.pageY,void 0===this.dragStartX&&(this.dragStartX=e.pageX),this.setState({zoomedNote:t,zoomedNoteRatio:n/this.getNumNotes()})}},{key:"onMouseUp",value:function(e){this.mouseDown=!1,this.dragStartX=void 0}},{key:"scrollVertically",value:function(e){var t=this.props.notes[0].getTranspose();if(!(this.props.notes[this.props.notes.length-1].getTranspose()+e<-36)&&!(t+e>92)){var n=this.props.notes.map(function(t){return t.addTranspose(e)});this.note=this.props.notes[0],this.props.setPianoRollNotes(n)}}},{key:"onMouseMove",value:function(e){if(this.mouseDown){this.dragY=e.pageY;var t=this.dragY-this.dragStartY,n=Math.floor(t/this.scale/60);Math.abs(n)>=1&&this.scrollVertically(n);var r=e.pageX-this.dragStartX;if(Math.abs(r)<=2)return;this.scale+=r/50,this.scale<=.4&&(this.scale=.4),this.scale>=2&&(this.scale=2),this.updateNotes()}}},{key:"onMouseLeave",value:function(e){}},{key:"onWheel",value:function(e){if(this.mouseOverPianoRoll){if(e.ctrlKey)e.preventDefault(),e.stopPropagation(),this.scale-=.01*e.deltaY,this.scale<=.4&&(this.scale=.4),this.updateNotes();else{if(Math.abs(e.wheelDeltaX)>=5&&Math.abs(e.wheelDeltaY)<=10)return!1;e.preventDefault(),e.stopPropagation();var t=e.wheelDeltaY/this.scale/40;t=t<0?Math.ceil(t):Math.floor(t),this.scrollVertically(t)}return!1}}},{key:"getMinXScale",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,t=(window.innerWidth-56)/(36*e.stepsLength);return Math.max(zy,t)}},{key:"zoomHorizontally",value:function(e){var t=this.state.xScale+e/50;t<this.getMinXScale()||t>this.maxXScale||this.setState({xScale:t})}},{key:"onMouseOverNote",value:function(e,t){this.mouseDown||(this.note=e,this.noteIndex=t)}},{key:"onChangeLength",value:function(){this.setState({xScale:this.minXScale})}},{key:"onMouseOverPianoRoll",value:function(e){this.mouseOverPianoRoll=e}},{key:"isNoteEnabled",value:function(e){return this.props.notesEnabled.has(e.getTranspose())}},{key:"render",value:function(){var e=this,t={height:xg*this.props.scale+50},n=this.props.showAutomation?"whole-wrapper showing-automation":"whole-wrapper";return a.a.createElement("div",{draggable:!1,className:this.props.hideInterface?"piano-roll-container hide":"piano-roll-container"},a.a.createElement("div",{className:"clear-fix"}),a.a.createElement("div",{onMouseOver:function(t){return e.onMouseOverPianoRoll(!0)},onMouseLeave:function(t){return e.onMouseOverPianoRoll(!1)},className:n},a.a.createElement("div",{className:"notes-side-panel"},this.props.notes.map(function(t,n){return a.a.createElement(ry,{scale:e.scale,isNoteEnabled:e.isNoteEnabled(t),onMouseOver:function(t){return e.onMouseOverNote(t,n)},onMouseDown:function(r){return e.onMouseDown(r,t,n)},onMouseUp:function(t){return e.onMouseUp(t)},noteIndex:n,onMouseMove:function(t){return e.onMouseMove(t)},note:t})})),a.a.createElement("div",{style:t,draggable:!1,onMouseUp:function(){return e.onMouseUp()},onMouseLeave:function(){return e.onMouseLeave()},className:"piano-roll-wrapper"},a.a.createElement(my,{height:this.props.bottomHeight,isLooping:this.props.isLooping,zoomHorizontally:function(t){return e.zoomHorizontally(t)},xScale:this.state.xScale,sequencerEngine:this.props.sequencerEngine}),a.a.createElement(iy,{height:this.props.bottomHeight-20,xScale:this.state.xScale,scale:this.scale}),a.a.createElement(ny,{xScale:this.state.xScale,scale:this.scale}),a.a.createElement("div",{className:"piano-roll-rows-container"},this.props.notes.map(function(t,n){return a.a.createElement(Ay,{xScale:e.state.xScale,key:"note-"+n,noteIndex:n,isNoteEnabled:e.isNoteEnabled(t),scale:e.scale,parentClassName:"piano-roll-wrapper",onMouseOver:function(t){return e.onMouseOverNote(t,n)},resolution:e.props.resolution,onMouseDown:function(r){return e.onMouseDown(r,t,n)},onMouseUp:function(t){return e.onMouseUp(t)},onMouseMove:function(t){return e.onMouseMove(t)},sequencerEngine:e.props.sequencerEngine,note:t})})),this.props.showAutomation?a.a.createElement(Yg,{color:Wy.getColorForTrack(this.props.track),sequencerEngine:this.props.sequencerEngine,xScale:this.state.xScale,track:this.props.track}):"")))}},{key:"resolution",get:function(){return _y}},{key:"rules",get:function(){return this.props.sequencerEngine.rules}},{key:"cursor",get:function(){return this.props.sequencerEngine.store.getState().keyboard.cursor}},{key:"selectedPianoRollSteps",get:function(){return this.props.sequencerEngine.store.getState().keyboard.selectedPianoRollSteps}},{key:"maxScale",get:function(){return 3}}]),n}(r.Component),Qy=Object(g.b)(function(e,t){var n=e.tracks.trackSteps[e.mix.selectedTrack],r=t.track;return r&&r.tracks&&r.tracks[0]&&(r=r.tracks[0].track),{stepsLength:void 0===n?16:n.length,tracksToResample:e.tracks.tracksToResample,notes:e.keyboard.notes,mouseX:e.arrangement.mouseX,bottomHeight:"ARRANGEMENT_VIEW"===e.sequencer.viewMode||t.installation?e.arrangement.bottomHeight:550,isPlayingMix:e.mix.isPlayingMix,showAutomation:e.automation.show,notesEnabled:e.installation.notesEnabled,hideInterface:e.installation.hideInterface}},function(e,t){return{mouseDown:function(t){return e(Object(O.k)(t))},setTrackFocused:function(t){return e(Object(O.Id)(t))},setSelectedPianoRollSteps:function(t){return e(Object(O.Gc)(t))},setPianoRollSelection:function(t,n,r,a){return e(Object(O.kc)(t,n,r,a))},setStepsToCopy:function(t){return e(Object(O.xd)(t))},setEasyPatternToCopy:function(t){return e(Object(O.eb)(t))},setTracksToResample:function(t){return e(Object(O.Yd)(t))},setPianoRollNotes:function(t){return e(Object(O.ic)(t))},setPianoRollCursor:function(t){return e(Object(O.gc)(t))},setSelectorMode:function(t){return e(Object(O.Nc)(t))},setSidebarViewMode:function(t){return e(Object(O.ld)(t))},setArrangementPatternDragging:function(t){return e(Object(O.B)(t))}}})(Ky);var Xy=Object(g.b)(function(e,t){t.sequencerEngine.engineId;var n=!1;return e.sequencer.sidebarCollapsed?n=!1:t.sequencerEngine.tracks&&0===t.sequencerEngine.tracks.length&&(n=!0),"MIX_VIEW"===e.viewMode&&(n=!0),{numTracks:t.sequencerEngine.tracks&&t.sequencerEngine.tracks.length,bottomHeight:e.arrangement.bottomHeight,bottomMode:e.arrangement.bottomMode,selectedRows:e.arrangement.selectedRows,selectedTrack:e.mix.selectedTrack,hide:n,roomType:e.installation.roomType}},function(e){return{setArrangementBottomResizing:function(t){return e(Object(O.x)(t))}}})(function(e){var t={height:e.bottomHeight},n=Object(r.useCallback)(function(){e.setArrangementBottomResizing(!1)},[e.setArrangementBottomResizing]),i="",s="";if(e.hide)return console.log("hiding toolbar"),a.a.createElement("div",null);if(void 0!==e.selectedTrack&&e.sequencerEngine.tracks){var o=e.sequencerEngine.tracks[e.selectedTrack];o&&(s=e.roomType===jg?a.a.createElement(wg,{track:o,sequencerEngine:e.sequencerEngine}):a.a.createElement(Og,{track:o,sequencerEngine:e.sequencerEngine}),e.bottomHeight>25&&(i=a.a.createElement(Qy,{parentClassName:"arrangement-bottom-container",isLooping:!1,installation:!0,sequencerEngine:e.sequencerEngine,hideToolbar:!0})))}return a.a.createElement("div",{onMouseUp:n,style:t,className:"arrangement-bottom-container"},s,i)}),Yy=(n(181),n(389)),Zy=n.n(Yy);function $y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var eb=function(e){Object(u.a)(n,e);var t=$y(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={username:"",password:"",loginFailed:!1},r.onClickDone=r.onClickDone.bind(Object(W.a)(r)),r.onClickCancel=r.onClickCancel.bind(Object(W.a)(r)),r}return Object(c.a)(n,[{key:"handlePasswordChange",value:function(e){this.setState({password:e.target.value})}},{key:"onClickDone",value:function(){var e=Object(R.a)(N.a.mark(function e(){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.props.signingUp){e.next=4;break}gn.a.signUp(this.state.userName,this.state.password),e.next=10;break;case 4:return e.next=6,gn.a.login(this.state.userName,this.state.password);case 6:if(e.sent){e.next=10;break}return this.setState({loginFailed:!0}),e.abrupt("return");case 10:this.setState({loginFailed:!1}),this.props.hide();case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onClickCancel",value:function(){this.props.hide()}},{key:"render",value:function(){var e=this;return a.a.createElement(lh.a,{dialogClassName:"preset-modal",show:this.props.show,onHide:this.onClickCancel},a.a.createElement(lh.a.Header,{closeButton:!0},a.a.createElement(lh.a.Title,null,this.props.signingUp?"Sign Up":"Log In")),a.a.createElement(lh.a.Body,null,a.a.createElement(Wc,{condition:this.state.loginFailed},"The username/password you entered was incorrect. Please try again."),a.a.createElement(Ac.h,null,a.a.createElement(Ac.g,{onChange:function(t){return e.setState({userName:t.target.value})},value:this.state.userName,placeholder:"Enter your username",className:"email-address-input"})),a.a.createElement(Zy.a,{id:"password",name:"password",placeholder:"Enter password",value:this.state.password,onChange:this.handlePasswordChange.bind(this)})),a.a.createElement(lh.a.Footer,null,a.a.createElement(Ac.b,{variant:"secondary",onClick:this.onClickDone},"Done"),a.a.createElement(Ac.b,{variant:"primary",onClick:this.onClickCancel},"Cancel")))}}]),n}(r.Component),tb=Object(g.b)(function(e){return{signingUp:e.sequencer.signingUp}},function(e){return{hide:function(t){return e(Object(O.Zc)(!1))}}})(eb);function nb(e,t){var n=new FileReader;t.name.includes(".wav")?(n.readAsArrayBuffer(t),n.onloadend=Object(R.a)(N.a.mark(function r(){var a,i;return N.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Gt.a.addArrayBuffer(n.result);case 2:return a=r.sent,i=new Dn.a(a),r.next=6,i.fetchAudio();case 6:i.name=t.name,e.recordingsToSave.push(i),e.addSound(i);case 9:case"end":return r.stop()}},r)}))):window.alert("Only accepts .wav files for now")}var rb=new x.a.Time("16n"),ab=function(){function e(t,n,r,a,i){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;Object(o.a)(this,e),this.sequencerEngine=a,this.velocity=s,this.startTime=x.a.Master.context.currentTime,this.currentStep=a.getCurrentStep(r,t),this.currentGlobalStep=a.lastTrackStep,this.currentStepUnquantized=a.trackStepReal,this.currentStepTime=a.currentStepTime,t.subSequence.isTrack||(this.currentStepUnquantized=this.currentStepUnquantized%t.pattern.length()),this.quantized=i,this.track=t,this.trackNumber=t?t.trackNumber:0,this.sliceNumber=n,this.resolution=r,this.rolling=!!t&&t.rolling}return Object(c.a)(e,[{key:"getDuration",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.quantized,t=x.a.Master.context.currentTime,n=void 0,r=void 0,a=rb.toMilliseconds()/1e3;if((void 0===this.currentStepTime||Math.abs(this.currentStepTime-this.startTime)>a)&&e){var i=Math.max(this.currentGlobalStep,0);n=(r=(this.sequencerEngine.lastTrackStep-i)/2)*rb.toMilliseconds()}else r=(n=new x.a.Time(t).toMilliseconds()-new x.a.Time(e?this.currentStepTime:this.startTime).toMilliseconds())/rb.toMilliseconds();return{duration:n,durationSixteenths:r}}},{key:"record",value:function(e,t,n){t=t||this.track,n=n||t.trackData.transpose,e=e||t.sequencerEngine;var r=this.getDuration(),a=r.duration,i=r.durationSixteenths,s=(c=new x.a.Time(this.startTime).toMilliseconds()-new x.a.Time(this.currentStepTime).toMilliseconds())/new x.a.Time("32n").toMilliseconds();if(this.quantized){s=Math.max(0,s);var o=this.currentStepUnquantized+s;o=Math.round(this.resolution.transformStepAtResolution2(o,$o.baseResolution)),t.subSequence.isTrack||(o%=this.track.pattern.length(this.resolution)),isNaN(o)&&(o=0),t.recordHit(o,this.resolution,this.sliceNumber,i,n,this.velocity)}else{var c;s=(c=new x.a.Time(this.startTime).toMilliseconds()-new x.a.Time(this.currentStepTime).toMilliseconds())/new x.a.Time("32n").toMilliseconds();if(c<0&&(s=1+s,0==this.currentStepUnquantized?this.currentStepUnquantized=31:this.currentStepUnquantized--),this.rolling)for(var u=this.getNumberOfRollsForDuration(a,t),l=32/this.resolution.numSteps(),p=this.getDurationOfRollTime(t),h=this.currentStepUnquantized+s;h<=this.currentStepUnquantized+l*u;h+=l){var f=Math.floor(h),d=h-f;t.recordUnquantizedHit(f,this.sliceNumber,p,d,n,this.velocity)}else t.recordUnquantizedHit(this.currentStepUnquantized,this.sliceNumber,i,s,n,this.velocity)}}},{key:"getDurationOfRollTime",value:function(e){return this.resolution.getTimeInStep().toMilliseconds()/rb.toMilliseconds()}},{key:"getStepsInRollTime",value:function(e){var t=this.resolution,n=t.numSteps()/t.baseResolution,r=t.numSteps();return 32===r?n:48===r?n:16===r?2*n:24==r?2*n:8===r?4*n:12===r?4*n:4===r?8*n:6==r?8*n:null}},{key:"getRollResolution",value:function(e){var t=e.liveEffects.getEffect(Di),n=this.resolution;return t&&((n=n.getCopy()).resolution*=t.rollFactor),n}},{key:"getNumberOfRollsForDuration",value:function(e,t){return e/this.resolution.getTimeInStep().toMilliseconds()}}]),e}(),ib=function(){function e(t,n,r,a,i){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;Object(o.a)(this,e),this.sliceNumber=0,this.recordedTriggers=n.map(function(e){return new ab(e,0,r,a,i,s)}),this.transpose=t,this.tracks=n}return Object(c.a)(e,[{key:"record",value:function(e,t,n){var r=this;this.recordedTriggers.map(function(t,n){return t.record(e,r.tracks[n],r.transpose+r.tracks[n].trackData.transpose)})}}]),e}(),sb={a:0,w:1,s:2,e:3,d:4,f:5,t:6,g:7,y:8,h:9,u:10,j:11,k:12,o:13,l:14},ob=function(){function e(){Object(o.a)(this,e),this.octave=0}return Object(c.a)(e,[{key:"getTransposeForKey",value:function(e){var t=12*this.octave;return(e=e.toLowerCase())in sb?t+sb[e]:void 0}},{key:"upOctave",value:function(){this.octave<3&&this.octave++}},{key:"downOctave",value:function(){this.octave>-2&&this.octave--}}]),e}(),cb=function(){function e(t,n){Object(o.a)(this,e),this.keyMappings={},this.midiMappings={},this.sequencerEngine=t,this.recordedMidiTriggers={},this.computerKeyboard=new ob,this.store=t.store}return Object(c.a)(e,[{key:"hasKeyMapping",value:function(e){return e in this.keyMappings}},{key:"deleteKeyMapping",value:function(e){delete this.keyMappings[e],this.sequencerEngine.store.dispatch(Object(O.Hb)(this.keyMappings))}},{key:"deleteTrack",value:function(e){this.keyMappings=this.deleteHelper(this.keyMappings,e),this.midiMappings=this.deleteMidiHelper(this.midiMappings,e),this.sequencerEngine.store.dispatch(Object(O.Hb)(this.keyMappings));var t=Object.keys(this.midiMappings)[0];this.sequencerEngine.store.dispatch(Object(O.Xb)(this.midiMappings[t]))}},{key:"deleteMidiHelper",value:function(e,t){var n={};for(var r in e)n[r]=this.deleteHelper(e[r],t);return n}},{key:"deleteHelper",value:function(e,t){var n={};for(var r in e){var a=e[r];t>=a.trackNumber?n[r]=a:t<a.trackNumber&&(a.trackNumber--,n[r]=a)}return n}},{key:"hasMidiMappings",value:function(){return Object.keys(this.midiMappings).length>0}},{key:"onKeyDown",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;e=e.toLowerCase(),this.handleOctaves(e);var s=r?_i.a.fromString(e).getTranspose():this.computerKeyboard.getTransposeForKey(e),o=s%12;o<0&&(o=12+o),this.store.dispatch(Object(O.Lb)(s)),this.onNoteDown(e,s,t,n,a,r,i)}},{key:"onNoteDown",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(0!==this.sequencerEngine.tracks.length){var o=this.getToggledTracks(a,i);if(o.length>0){if(void 0===t)return;o.filter(function(e){return!e.rolling}).forEach(function(e){var n=new Ge;n.copyFrom(e.trackData),n.slice=0,n.duration=null,n.transpose=t+e.trackData.transpose,n.velocity=s,e.midiEffects.liveInputTrigger(n)})}else e in this.keyMappings?this.keyMappings[e].trigger(this.sequencerEngine,n):t in this.keyMappings?this.keyMappings[t].trigger(this.sequencerEngine,n):a in this.midiMappings&&e.toUpperCase()in this.midiMappings[a]?this.midiMappings[a][e.toUpperCase()].trigger(this.sequencerEngine,n,s):void 0===a?this.alreadyMapped(this.sequencerEngine.cursor.track,0)||(this.map(e,this.sequencerEngine.cursor.track,0),this.onNoteDown(e,t,n,r,a,i,s)):"PADS"===this.sequencerEngine.midi.getInputMode(a)&&(this.alreadyMidiMapped(a,this.sequencerEngine.cursor.track,0)||(this.midiMap(a,e,this.sequencerEngine.cursor.track,0),this.onNoteDown(e,t,n,r,a,i,s)))}}},{key:"handleOctaves",value:function(e){"z"===e?this.computerKeyboard.downOctave():"x"===e&&this.computerKeyboard.upOctave()}},{key:"getToggledTracks",value:function(e,t){var n=this.sequencerEngine.tracks.filter(function(e){return e.isEnabled});for(var r in this.sequencerEngine.subSequences){var a=this.sequencerEngine.subSequences[r];a.isTrack&&a!==this.sequencerEngine.currentSubSequence&&(n=[].concat(Object(M.a)(n),Object(M.a)(a.tracks.filter(function(e){return e.isEnabled}))))}return n=n.filter(function(n){return n.midiInputs.accepts(t,e)})}},{key:"recordHit",value:function(e,t,n,r,a,i){var s=this.getToggledTracks(a,t);if(!(s.length>0)){if(e in this.keyMappings){var o=this.keyMappings[e];return new ab(this.sequencerEngine.tracks[o.trackNumber],o.sliceNumber,n,this.sequencerEngine,r)}if(a in this.midiMappings&&e in this.midiMappings[a]){o=this.midiMappings[a][e];return new ab(this.sequencerEngine.tracks[o.trackNumber],o.sliceNumber,n,this.sequencerEngine,r,i)}return null}var c=t?_i.a.fromString(e).getTranspose():this.computerKeyboard.getTransposeForKey(e);if(void 0!==c)return new ib(c,s,n,this.sequencerEngine,r,i)}},{key:"getRecordedMidiTrigger",value:function(e,t,n){return new ab(this.sequencerEngine.tracks[e.trackNumber],e.sliceNumber,t,this.sequencerEngine,n)}},{key:"alreadyMidiMapped",value:function(e,t,n){if(void 0===this.midiMappings[e])return!1;for(var r in this.midiMappings[e]){var a=this.midiMappings[e][r];if(a.trackNumber===t&&a.sliceNumber===n)return!0}return!1}},{key:"alreadyMapped",value:function(e,t){for(var n in this.keyMappings){var r=this.keyMappings[n];if(r.trackNumber===e&&r.sliceNumber===t)return!0}return!1}},{key:"map",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;void 0!==this.sequencerEngine.tracks[t]&&(this.keyMappings[e]=new ub(e,t,n),this.sequencerEngine.store.dispatch(Object(O.Hb)(this.keyMappings)))}},{key:"midiMap",value:function(e,t,n,r){t=t.toUpperCase();var a=new ub(t,n,r);e in this.midiMappings||(this.midiMappings[e]={}),this.midiMappings[e][t]=a;var i={};for(var s in this.midiMappings){var o=this.midiMappings[s];for(var c in o)i[c]=o[c]}"PADS"===this.midi.getInputMode(e)&&this.store.dispatch(Object(O.Xb)(i)),this.store.dispatch(Object(O.Kb)(t))}},{key:"getMappings",value:function(){return this.keyMappings}},{key:"getMidiMappings",value:function(){return this.midiMappings}},{key:"deleteMappingsForTrack",value:function(e){for(var t in this.keyMappings)this.keyMappings[t].trackNumber===e&&delete this.keyMappings[t];for(var n in this.midiMappings){var r=this.midiMappings[n];for(var a in r)r[a].trackNumber==e&&delete r[a]}}},{key:"midi",get:function(){return this.sequencerEngine.midi}}]),e}(),ub=function(){function e(t,n,r){Object(o.a)(this,e),this.key=t,this.trackNumber=n,this.sliceNumber=r}return Object(c.a)(e,[{key:"trigger",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(!e.tracks[this.trackNumber].rolling){var r=e.tracks[this.trackNumber],a=new Ge;a.copyFrom(r.trackData),a.slice=this.sliceNumber,a.velocity=n,a.duration=null,r.midiEffects.liveInputTrigger(a)}}}]),e}(),lb=cb;function pb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var hb=[1,2,4,8,16,32,64],fb=function(e){Object(u.a)(n,e);var t=pb(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r.onClickDone=r.onClickDone.bind(Object(W.a)(r)),r.onClickCancel=r.onClickCancel.bind(Object(W.a)(r)),r}return Object(c.a)(n,[{key:"onClickDone",value:function(){this.props.setShowSequenceModal(!1)}},{key:"onClickCancel",value:function(){this.props.setShowSequenceModal(!1)}},{key:"onClickResample",value:function(){this.props.sequencerEngine.masterResampler.prepare(),this.props.setResampleMaster(!0)}},{key:"isResampling",value:function(){return this.props.isResampling||this.props.resampleMaster}},{key:"getResamplingText",value:function(){return this.props.isResampling?"Resampling...":this.props.resampleMaster?"Waiting to resample...":""}},{key:"doubleTrackLength",value:function(){this.props.sequencerEngine.tracks.map(function(e){return e.doubleTrackLength()})}},{key:"halfTrackLength",value:function(){this.props.sequencerEngine.tracks.map(function(e){return e.halfTrackLength()})}},{key:"onClickShowGroups",value:function(){this.props.setShowGroups(!this.props.showGroups)}},{key:"clearPattern",value:function(){this.props.sequencerEngine.clearSequence()}},{key:"onClickResampleDuration",value:function(){if(64===this.props.resampleDuration)this.props.setResampleDuration(1);else{var e=hb.indexOf(this.props.resampleDuration);this.props.setResampleDuration(hb[e+1])}}},{key:"render",value:function(){var e=this;return a.a.createElement(lh.a,{dialogClassName:"preset-modal",show:this.props.show,onHide:this.onClickCancel},a.a.createElement(lh.a.Header,{closeButton:!0},a.a.createElement(lh.a.Title,null,"Pattern Actions")),a.a.createElement(lh.a.Body,null,a.a.createElement("div",{className:"sequence-action"},a.a.createElement("div",{className:"sequence-action-name"},"Pattern Length:"),a.a.createElement("div",{draggable:!1,onClick:function(){return e.doubleTrackLength()},className:"add-steps-button"},"+"),a.a.createElement("div",{draggable:!1,onClick:function(){return e.halfTrackLength()},className:"remove-steps-button"},"-")),a.a.createElement("div",{className:"sequence-action"},a.a.createElement("div",{onClick:function(){return e.clearPattern()},className:"clear-pattern-button common-button pink-button"},"Clear Pattern")),a.a.createElement("div",{className:"sequence-action"},a.a.createElement("div",{onClick:function(){return e.onClickShowGroups()},className:"clear-pattern-button common-button pink-button"},this.props.showGroups?"Show Tracks":"Show Groups")),a.a.createElement("div",{className:"resample-action"},a.a.createElement("div",{draggable:!1,onClick:function(){return e.onClickResample()},className:"transcribe-button"},"RESAMPLE"),a.a.createElement("div",{draggable:!1,onClick:function(){return e.onClickResampleDuration()},className:"resample-duration-button"},this.props.resampleDuration," x"),a.a.createElement(Wc,{condition:this.isResampling()},this.getResamplingText()),a.a.createElement(v.a,{sizeUnit:"px",size:10,color:"#123abc",loading:this.isResampling()}))),a.a.createElement(lh.a.Footer,null,a.a.createElement(Ac.b,{variant:"secondary",onClick:this.onClickDone},"Done"),a.a.createElement(Ac.b,{variant:"primary",onClick:this.onClickCancel},"Cancel")))}}]),n}(r.Component),db=Object(g.b)(function(e){return{show:e.sequencer.showSequenceModal,resampleMaster:e.sequencer.resampleMaster,isResampling:e.tracks.isResampling,resampleDuration:e.tracks.resampleDuration,showGroups:e.sequencer.showGroups}},function(e){return{setShowSequenceModal:function(t){return e(Object(O.fd)(t))},setResampleMaster:function(t){return e(Object(O.rc)(t))},setShowGroups:function(t){return e(Object(O.Wc)(t))},setResampleDuration:function(t){return e(Object(O.qc)(t))}}})(fb),mb=function(){function e(t,n,r,a){Object(o.a)(this,e),this.groups=[],this.subSequence=a,this.channelMixer=t,this.sends=n,this.sequencerEngine=r,this.doneLoading=!1}return Object(c.a)(e,[{key:"newGroup",value:function(e){var t=new vb([],this.channelMixer,this.groups.length,this.sequencerEngine,this.subSequence);this.groups.push(t),t.connectAudio(this.getMaxChannel()),this.addToGroup(e,t)}},{key:"fromJson",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r=this;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("groups.fromJson("),console.log("with currentSubSequence.id = "+n.currentSubSequence.id),e.abrupt("return",new Promise(function(){var e=Object(R.a)(N.a.mark(function e(a,i){var s,o,c,u,l,p;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=4;break}return r.sequencerEngine.tracks.forEach(function(e){return r.addTrack(e)}),a(),e.abrupt("return");case 4:s=0;case 5:if(!(s<t.length)){e.next=15;break}return o=t[s],e.next=9,new vb([],r.channelMixer,r.groups.length,r.sequencerEngine,r.subSequence).fromJson(o,n);case 9:(c=e.sent).tracks.length>0&&(c.connectAudio(r.getMaxChannel()),r.groups.push(c)),o.outputs&&(u=Object(j.a)(o.outputs,2),l=u[0],p=u[1],r.channelMixer.switchChannelOutput(c.outputNode,l,p)&&(c.outputs=[l,p]));case 12:s++,e.next=5;break;case 15:a();case 16:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateGroups",value:function(){this.groups.forEach(function(e){return e.setVolume(e.volume)}),this.groups.forEach(function(e){return e.setPanning(e.panning)})}},{key:"addToGroup",value:function(e,t){var n=e.group,r=1==n.tracks.length,a=this.groups.indexOf(n);e.disconnectFromGroup(),t.addTrack(e),t.tags=Array.from(new Set(t.tags.concat(n.tags))),r?(this.groups.splice(a,1),n.dispose()):(a=n.tracks.indexOf(e),n.tracks.splice(a,1))}},{key:"deleteTrack",value:function(e){var t=e.group;if(void 0!==t&&null!==t){var n=1==t.tracks.length,r=this.groups.indexOf(t);e.disconnectFromGroup(),n?(this.groups.splice(r,1),t.dispose()):(r=t.tracks.indexOf(e),t.tracks.splice(r,1))}}},{key:"addTrack",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.getTrackType(),e.next=e.t0===zr.e?3:10;break;case 3:if(void 0!==(n=t.sample.tags)){e.next=8;break}return e.next=7,t.sample.fetchTags();case 7:n=e.sent;case 8:return this.resolveTrackTags(t,n),e.abrupt("break",11);case 10:this.resolveTrackTags(t,[t.getTrackType()]);case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addMidiTrack",value:function(e){this.resolveTrackTags(e,["Midi Tracks"])}},{key:"resolveTrackTags",value:function(e,t){var n=0,r=null;for(var a in this.groups){var i=this.groups[a],s=gb(i.tags,t);s.length>n&&(r=i,n=s.length)}if(null==r){var o=new vb(t,this.channelMixer,this.groups.length,this.sequencerEngine,this.subSequence);return o.connectAudio(this.getMaxChannel()),o.addTrack(e),void this.groups.push(o)}r.tags=gb(r.tags,t),r.addTrack(e)}},{key:"dispose",value:function(){this.groups.forEach(function(e){return e.dispose()}),this.groups=[]}},{key:"getJson",value:function(e){return this.groups.map(function(t){return t.getJson(e)})}},{key:"getMaxChannel",value:function(){var e=[];this.groups.map(function(e){return e.outputs}).filter(function(e){return void 0!==e}).forEach(function(t){return e=e.concat(t)}),this.sends.sends.map(function(e){return e.outputs}).filter(function(e){return void 0!==e}).forEach(function(t){return e=e.concat(t)});var t=e.sort(function(e,t){return e-t}).reverse();if(0===t.length)return-1;for(var n=t[0],r=0;r<n;r+=2)if(-1==t.indexOf(r)&&-1==t.indexOf(r+1))return r-1;return n}}]),e}(),vb=function(){function e(t,n,r,a,i){Object(o.a)(this,e),this.tracks=[],this.subSequence=i,this.sequencerEngine=a,this.groupNumber=r,this.tags=t,this.inputNode=new x.a.Volume,this.outputNode=new x.a.PanVol,this.groupMeter=new x.a.Meter,this.muteableNode=new x.a.Volume,this.outputNode.connect(this.groupMeter),this.muteableNode.connect(this.outputNode),this.effectsChain=new wa(this.inputNode,this.muteableNode,(new Wr).forGroup(this),a),this.effectsChain.setupEffects(),this.setVolume(70),this.channelMixer=n,this.outputs=void 0,this.muted=!1,this.panning=0}return Object(c.a)(e,[{key:"getEffectNumber",value:function(e,t){return this.effects.indexOf(e)}},{key:"dispose",value:function(){this.outputs=this.channelMixer.disconnect(this.outputNode,this.outputs),this.inputNode.dispose(),this.muteableNode.dispose(),this.outputNode.dispose(),this.groupMeter.dispose(),this.inputNode=void 0,this.outputNode=void 0,this.groupMeter=void 0,this.effectsChain.dispose()}},{key:"mute",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.sequencerEngine.store.getState().mix.isRecordingMix&&this.mix.addEvent(new te(this.groupNumber,e)),this.muted=e,this.muteableNode.volume.value=e?-125:0,this.sequencerEngine.store.dispatch(Object(O.qb)(this.groupNumber,e))}},{key:"moveEffectTo",value:function(e,t){this.effectsChain.moveEffectTo(e,t)}},{key:"deleteEffect",value:function(e){this.effectsChain.deleteEffect(e)}},{key:"connectAudio",value:function(e){this.outputs=this.channelMixer.connect(this.outputNode)}},{key:"fromJson",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r,a,i,s,o,c,u,l;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t.newVolume?this.setVolume(t.volume):(r=128*(t.volume+40)/43,this.setVolume(r)),a=[],i=0;i<t.tracks.length;i++)void 0!==(s=n.tracks[t.tracks[i]])&&(s.getTrackType()===zr.e&&a.push(s.sample.fetchTags()),this.addTrack(s));o=0;case 4:if(!(o<t.effects.length)){e.next=13;break}return e.t0=this.effectsChain,e.next=8,Sa(t.effects[o],n.tracks,n);case 8:e.t1=e.sent,e.t0.addEffect.call(e.t0,e.t1);case 10:o++,e.next=4;break;case 13:return e.next=15,Promise.all(a);case 15:for(c=e.sent,u=new Set,l=0;l<c.length;l++)c[l].forEach(function(e){return u.add(e)});return this.tags=Array.from(u),e.abrupt("return",this);case 20:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSendNodes",value:function(){return[]}},{key:"addTrack",value:function(e){this.hasTrack(e)||(this.tracks.push(e),e.addToGroup(this))}},{key:"hasTrack",value:function(e){return this.tracks.indexOf(e)>-1}},{key:"setVolume",value:function(e){this.sequencerEngine.store.getState().mix.isRecordingMix&&this.mix.addEvent(new Y(this.groupNumber,e)),this.volume=e,this.outputNode.volume.value=Yi(e,0,128),this.sequencerEngine.store.dispatch(Object(O.sb)(this.groupNumber,e))}},{key:"setPanning",value:function(e){this.panning=e,this.outputNode.pan.value=e,this.sequencerEngine.store.dispatch(Object(O.rb)(this.groupNumber,e))}},{key:"updateEffects",value:function(e){this.effectsChain.updateEffects()}},{key:"getJson",value:function(e){return{newVolume:!0,tracks:this.tracks.map(function(e){return e.trackNumber}),effects:this.effectsChain.getJson(),volume:this.volume,outputs:this.outputs}}},{key:"mix",get:function(){return this.subSequence.mix}},{key:"solo",set:function(e){this.tracks.forEach(function(t){return t.solo(e)})},get:function(){var e=!1;for(var t in this.tracks)e=e||this.tracks[t].getSolo();return e}},{key:"effects",get:function(){return this.effectsChain.effects}}]),e}();function gb(e,t){return e.filter(function(e){return-1!==t.indexOf(e)})}var yb=mb;function bb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var kb=function(e){Object(u.a)(n,e);var t=bb(n);function n(e,r,a,i){var s;return Object(o.a)(this,n),(s=t.call(this,e,r,a,i)).lastValue=void 0,s.lastStep=void 0,s.envelope=new x.a.ScaledEnvelope,s.meter=new x.a.Analyser("waveform",32),s.envelope.connect(s.meter),s.envelope.min=0,s.envelope.max=1,s.parameters=[],s.setupParameters(),s.savedFrequency=void 0,s.parameterIdToVoiceToNode={},s}return Object(c.a)(n,[{key:"getType",value:function(){return Me}},{key:"dispose",value:function(){for(var e in this.envelope.dispose(),this.meter.dispose(),this.parameters.forEach(function(e){return e.dispose()}),this.parameterIdToVoiceToNode){var t=this.parameterIdToVoiceToNode[e];for(var n in t){t[n].filter(function(e){return e.dispose&&e._param}).forEach(function(e){return e.dispose()})}}this.parameterIdToVoiceToNode=void 0,this.envelope=void 0,this.meter=void 0,this.parameters=void 0}},{key:"getValue",value:function(e){if(e===this.lastStep)return this.lastValue;var t=this.meter.getValue()[0];return this.lastStep=e,this.lastValue=t,t}},{key:"getChain",value:function(e,t){return[new x.a.Scale(e.min,e.max),t]}},{key:"getModulator",value:function(){return this.envelope}},{key:"triggerAttack",value:function(e,t){this.envelope.cancel(e),this.envelope.triggerAttack(e,t)}},{key:"triggerAttackRelease",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;t=Math.max(t,0),this.envelope.cancel(t),this.envelope.triggerAttackRelease(e,t,n)}},{key:"triggerRelease",value:function(e){this.envelope.triggerRelease(e)}},{key:"setupParameters",value:function(){this.attackParameter=new Be("Attack",this.envelope,function(e,t){return e.attack=(t+1e-6)/1e3},{min:0,max:1e4,unit:"ms",defaultValue:1e3}),this.registerParameter(this.attackParameter),this.decayParameter=new Be("Decay",this.envelope,function(e,t){return e.decay=(t+1e-5)/1e3},{min:0,max:1e4,unit:"ms",defaultValue:1e3}),this.registerParameter(this.decayParameter),this.sustainParameter=new Be("Sustain",this.envelope,function(e,t){return e.sustain=t},{min:0,max:1,unit:"",defaultValue:.5}),this.registerParameter(this.sustainParameter),this.releaseParameter=new Be("Release",this.envelope,function(e,t){return e.release=(t+1e-6)/1e3},{min:0,max:1e4,unit:"ms",defaultValue:1e3}),this.registerParameter(this.releaseParameter),this.attackCurveParameter=new Be("Attack Curve",this.envelope,function(e,t){e.attackCurve=t},{min:0,max:1e4,unit:"",defaultValue:"linear"}),this.registerParameter(this.attackCurveParameter),this.decayCurveParameter=new Be("Decay Curve",this.envelope,function(e,t){return e.decayCurve=t},{min:0,max:1e4,unit:"",defaultValue:"linear"}),this.registerParameter(this.decayCurveParameter),this.releaseCurveParameter=new Be("Release Curve",this.envelope,function(e,t){return e.releaseCurve=t},{min:0,max:1e4,unit:"",defaultValue:"exponential"}),this.registerParameter(this.releaseCurveParameter)}},{key:"refresh",value:function(){this.attack=this.attack,this.decay=this.decay,this.release=this.release,this.sustain=this.sustain}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getJson",value:function(){var e={attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release,attackCurve:this.attackCurve,decayCurve:this.decayCurve,releaseCurve:this.releaseCurve};return e=sr(e,"attackParameter",this.attackParameter),e=sr(e,"decayParameter",this.decayParameter),e=sr(e,"sustainParameter",this.sustainParameter),e=sr(e,"releaseParameter",this.releaseParameter),e=sr(e,"attackCurveParameter",this.attackCurveParameter),e=sr(e,"decayCurveParameter",this.decayCurveParameter),e=sr(e,"releaseCurveParameter",this.releaseCurveParameter)}},{key:"fromJson",value:function(e){this.disconnectAllModulators(),this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,e.attackCurve&&(this.attackCurve=e.attackCurve),e.decayCurve&&(this.decayCurve=e.decayCurve),e.releaseCurve&&(this.releaseCurve=e.releaseCurve),or(e,"attackParameter",this.attackParameter,this.sequencerEngine),or(e,"decayParameter",this.decayParameter,this.sequencerEngine),or(e,"sustainParameter",this.sustainParameter,this.sequencerEngine),or(e,"releaseParameter",this.releaseParameter,this.sequencerEngine),or(e,"attackCurveParameter",this.attackCurveParameter,this.sequencerEngine),or(e,"decayCurveParameter",this.decayCurveParameter,this.sequencerEngine),or(e,"releaseCurveParameter",this.releaseCurveParameter,this.sequencerEngine)}},{key:"refresh",value:function(){}},{key:"getScaleFromChain",value:function(e){return e[0]}},{key:"mate",value:function(e,t){this.mateParameter(this.attackParameter,e.attackParameter,t),this.mateParameter(this.decayParameter,e.decayParameter,t),this.mateParameter(this.sustainParameter,e.sustainParameter,t),this.mateParameter(this.releaseParameter,e.releaseParameter,t)}},{key:"mateParameter",value:function(e,t,n){ra(this.sequencerEngine,e,t,n)}},{key:"attack",get:function(){return this.attackParameter.get()},set:function(e){this.attackParameter.set(e)}},{key:"decay",get:function(){return this.decayParameter.get()},set:function(e){this.decayParameter.set(e)}},{key:"sustain",get:function(){return this.sustainParameter.get()},set:function(e){this.sustainParameter.set(e)}},{key:"release",get:function(){return this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e)}},{key:"attackCurve",get:function(){return this.attackCurveParameter.get()},set:function(e){this.attackCurveParameter.set(e)}},{key:"decayCurve",get:function(){return this.decayCurveParameter.get()},set:function(e){this.decayCurveParameter.set(e)}},{key:"releaseCurve",get:function(){return this.releaseCurveParameter.get()},set:function(e){this.releaseCurveParameter.set(e)}}]),n}(ca),Eb=function(){function e(t,n,r,a){Object(o.a)(this,e),this.store=t.store,this.sequencerEngine=t,this.number=a,this.envelope=new kb(t,n,(new Wr).forEnvelopeTrack(this,r),a)}return Object(c.a)(e,[{key:"getJson",value:function(){return this.envelope.getJson()}},{key:"name",get:function(){return"Envelope "+this.number}}]),e}();var Ob=function(){function e(t,n){Object(o.a)(this,e),this.sequencerEngine=t,this.subSequence=n,this.store=t.store,this.envelopes=function(e,t){var n=[];return n.push(new Eb(e,e.mixSession,t,1)),n.push(new Eb(e,e.mixSession,t,2)),n.push(new Eb(e,e.mixSession,t,3)),n.push(new Eb(e,e.mixSession,t,4)),n}(t,this),this.currentPattern=0}return Object(c.a)(e,[{key:"switchToPattern",value:function(e){this.currentPattern=e,this.updateRedux()}},{key:"updateRedux",value:function(){this.getAllPatternLockedParameters().forEach(function(e){return e.updateRedux()})}},{key:"deletePattern",value:function(e){this.store.dispatch(Object(O.lb)(this.subSequence.id,Le(e,this.patternLocks)))}},{key:"movePatternTo",value:function(e,t){this.store.dispatch(Object(O.lb)(this.subSequence.id,Ie(e,t,this.patternLocks)))}},{key:"getAllPatternLockedParameters",value:function(){var e=[];return this.envelopes.forEach(function(t){return t.envelope.parameters.filter(function(e){return e.hasPatternLockedValues()}).forEach(function(t){return e.push(t)})}),e}},{key:"newPattern",value:function(e){var t=this,n=e-1;this.getAllPatternLockedParameters().forEach(function(e){return e.newPattern(t.currentPattern,n)});var r=this.patternLocks;r[n]=this.patternLocked,this.store.dispatch(Object(O.lb)(this.subSequence.id,r))}},{key:"togglePatternLocked",value:function(){this.patternLocked=!this.patternLocked}},{key:"patternLocks",get:function(){var e=this.store.getState().tracks.envelopePatternLocks[this.subSequence.id]||{};return Object(D.a)({},e)}},{key:"patternLocked",get:function(){return this.patternLocks[this.currentPattern]||!1},set:function(e){var t=this.patternLocks;t[this.currentPattern]=e,this.store.dispatch(Object(O.lb)(this.subSequence.id,t)),this.updateRedux()}}]),e}(),Sb=function(){function e(t,n){Object(o.a)(this,e),this.sequencerEngine=t,this.subSequence=n,this.initSteps()}return Object(c.a)(e,[{key:"initSteps",value:function(){for(var e in this.patterns=[new Do(this.sequencerEngine)],this.pattern=this.patterns[0],this.pattern.stepBuckets){var t=this.pattern.stepBuckets[e];for(var n in t.steps)t.steps[n].on=!0}this.currentPattern=0}},{key:"switchToPattern",value:function(e){if(e>=0&&e<this.patterns.length){var t=this.patterns[e];this.pattern=t,this.currentPattern=e}}},{key:"newPattern",value:function(){var e=this.pattern.getCopy();this.patterns.push(e);this.patterns.length}},{key:"deletePattern",value:function(e){this.patterns.splice(e,1)}},{key:"getBucket",value:function(e,t){return e.getBucket(t)}}]),e}(),Pb=function(){function e(t,n,r,a){Object(o.a)(this,e),this.store=t.store,this.sequencerEngine=t,this.number=a,this.lfo=new la(t,r,(new Wr).forLFOTrack(this,n),a),this.lfo.lfoMin=-100,this.lfo.lfoMax=100}return Object(c.a)(e,[{key:"start",value:function(){this.lfo.start()}},{key:"stop",value:function(){this.lfo.stop()}},{key:"getName",value:function(){return"LFO "+this.number}},{key:"getJson",value:function(){return this.lfo.getJson()}}]),e}();var wb=function(){function e(t,n){Object(o.a)(this,e),this.sequencerEngine=t,this.subSequence=n,this.store=t.store,this.lfos=function(e,t){var n=[];return n.push(new Pb(e,t,e.mixSession,1)),n.push(new Pb(e,t,e.mixSession,2)),n.push(new Pb(e,t,e.mixSession,3)),n.push(new Pb(e,t,e.mixSession,4)),n}(t,this),this.currentPattern=0}return Object(c.a)(e,[{key:"switchToPattern",value:function(e){this.currentPattern=e,this.updateRedux()}},{key:"updateRedux",value:function(){this.getAllPatternLockedParameters().forEach(function(e){return e.updateRedux()})}},{key:"deletePattern",value:function(e){var t=this.patternLocks;this.store.dispatch(Object(O.Jb)(this.subSequence.id,Le(e,t)))}},{key:"movePatternTo",value:function(e,t){var n=this.patternLocks;this.store.dispatch(Object(O.Jb)(this.subSequence.id,Ie(e,t,n)))}},{key:"getAllPatternLockedParameters",value:function(){var e=[];return this.lfos.forEach(function(t){return t.lfo.parameters.filter(function(e){return e.hasPatternLockedValues()}).forEach(function(t){return e.push(t)})}),e}},{key:"newPattern",value:function(e){var t=this,n=e-1;this.getAllPatternLockedParameters().forEach(function(e){return e.newPattern(t.currentPattern,n)});var r=this.patternLocks;r[n]=this.patternLocked,this.store.dispatch(Object(O.Jb)(this.subSequence.id,r))}},{key:"togglePatternLocked",value:function(){this.patternLocked=!this.patternLocked}},{key:"start",value:function(){for(var e in this.lfos){this.lfos[e].start()}}},{key:"stop",value:function(){for(var e in this.lfos){this.lfos[e].stop()}}},{key:"onBPMUpdated",value:function(){this.lfos.forEach(function(e){return e.lfo.onBPMUpdated()})}},{key:"patternLocks",get:function(){var e=this.store.getState().tracks.lfoPatternLocks[this.subSequence.id]||{};return Object(D.a)({},e)}},{key:"patternLocked",get:function(){return this.patternLocks[this.currentPattern]||!1},set:function(e){var t=this.patternLocks;t[this.currentPattern]=e,this.store.dispatch(Object(O.Jb)(this.subSequence.id,t)),this.updateRedux()}}]),e}(),jb=0,Tb=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(o.a)(this,e),this.sequencerEngine=t,this.store=t.store,this.isTrack=n,this.id=jb++,this.groups=new yb(t.channelMixer,t.sends,t,this),this.lfosTrack=new wb(t,this),this.envelopesTrack=new Ob(t,this),this.tracks=[],this.mix=new So(t,this),this.masterStepManager=new Sb(t,this),this.setAutomationToShow(de)}return Object(c.a)(e,[{key:"linearRampFade",value:function(e,t,n){this.tracks.forEach(function(r){return r.linearRampFade(e,t,n)})}},{key:"dispose",value:function(){this.tracks.forEach(function(e){return e.dispose()}),this.groups.dispose(),this.tracks=void 0,this.groups=void 0,this.lfos.forEach(function(e){return e.lfo.dispose()}),this.envelopes.forEach(function(e){return e.dispose()}),this.lfosTrack=void 0,this.envelopesTrack=void 0,this.id=0}},{key:"addTrack",value:function(e){e.subSequence=this,this.tracks.push(e),this.isTrack&&this.groups.addTrack(e)}},{key:"setId",value:function(e){this.id=e,jb=e+1}},{key:"setAutomationToShow",value:function(e){this.store.dispatch(Object(O.v)(this.id,e))}},{key:"updateVolumeFromAutomation",value:function(e){var t=this.volumeAutomationMix.getValueAtStep(e,this.fadeVolume);this.looping&&e===this.loopStart?(this.mix.restart(),this.fade=t):this.fadeVolume!==t&&this.store.dispatch(Object(O.yd)(this.id,t))}},{key:"getJson",value:function(){return{isTrack:this.isTrack}}},{key:"fromJson",value:function(e){void 0!==e.isTrack&&(this.isTrack=e.isTrack)}},{key:"fade",set:function(e){e=e||0,this.fadeVolume!==e&&(this.muted||this.tracks.forEach(function(t){return t.fade=e}),this.store.dispatch(Object(O.yd)(this.id,e)))}},{key:"mute",set:function(e){var t=e?0:this.fadeVolume;this.tracks.forEach(function(e){return e.fade=t}),this.store.dispatch(Object(O.zd)(this.id,e))}},{key:"channelMixer",get:function(){return this.sequencerEngine.channelMixer}},{key:"sends",get:function(){return this.sequencerEngine.sends}},{key:"lfos",get:function(){return this.lfosTrack.lfos}},{key:"envelopes",get:function(){return this.envelopesTrack.envelopes.map(function(e){return e.envelope})}},{key:"fadeVolume",get:function(){return this.store.getState().mix.subSequenceFades[this.id]||1}},{key:"volumeAutomationMix",get:function(){return this.mix.mixesByType[we]}},{key:"loopStart",get:function(){return this.store.getState().arrangement.selection.start}},{key:"looping",get:function(){return this.store.getState().arrangement.selection.start}}]),e}(),xb=(n(531),n(63),function(){function e(){Object(o.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"name",type:"bytes32"}],name:"syncClockMaster",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"name",type:"bytes32"}],name:"syncClockSlave",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"",type:"address"},{indexed:!0,name:"",type:"bytes32"},{indexed:!1,name:"index",type:"bytes32"}],name:"ClockSyncMaster",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"",type:"address"},{indexed:!0,name:"",type:"bytes32"},{indexed:!1,name:"index",type:"bytes32"}],name:"ClockSyncSlave",type:"event"}],this.contractAddress="0x17eafcd1dc39c8d78ff165e1dbd0fe9e82afbdc2"}return Object(c.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}());n(1670),n(73),n(1679);n(2218);var Cb=n(839),Nb=(d.a.web3,function(){function e(t){Object(o.a)(this,e),this.sequencerEngine=t,this.store=this.sequencerEngine.store,this.contract=(new xb).getContract(d.a.web3),this.listeningForClockSyncs=!1,this.connected=!1,this.isInitial=!0,this.userToSignal={}}return Object(c.a)(e,[{key:"setClockType",value:function(e){this.store.dispatch(Object(O.O)(e)),this.initiator="MASTER"===e,this.clockType=e,"NONE"!==e&&(this.setupWebRTC(),this.listeningForClockSyncs!==e&&this.listenForClockSyncs(e))}},{key:"retry",value:function(){this.setupWebRTC()}},{key:"startListening",value:function(){this.connected?console.log("is connected"):this.listenForClockSyncs("SLAVE")}},{key:"stopListening",value:function(){this.timer&&clearInterval(this.timer)}},{key:"listenForClockSyncs",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r=this;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.timer&&clearInterval(this.timer),this.listeningForClockSyncs=t,this.isInitial||this.store.dispatch(Object(O.T)("WAITING")),e.next=5,d.a.getUser();case 5:n=e.sent,this.listenCallback(t,n),this.timer=setInterval(function(){r.listenCallback(t,n)},1e4);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"listenCallback",value:function(e,t){var n=this;fetch("/getClockUsers/"+("MASTER"===e?"SLAVE":"MASTER")+"/"+t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(){var r=Object(R.a)(N.a.mark(function r(a){var i,s,o,c,u,l;return N.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,a.json();case 2:i=r.sent,console.log("fetch returned"),console.log(i),s=[],r.t0=N.a.keys(i);case 7:if((r.t1=r.t0()).done){r.next=22;break}if(o=r.t1.value,(c=i[o].userId)!==t){r.next=12;break}return r.abrupt("continue",7);case 12:if(u=i[o].signal,!(c in n.userToSignal)){r.next=15;break}return r.abrupt("continue",7);case 15:return n.userToSignal[c]=u,r.next=18,d.a.users.getUserName(c);case 18:l=r.sent,"MASTER"===e?(n.signal(u),n.store.dispatch(Object(O.S)(l))):(s.push(l),n.store.dispatch(Object(O.K)(s))),r.next=7;break;case 22:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}())}},{key:"syncToUser",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.isInitial=!1,this.setClockType("SLAVE"),this.signal(this.userToSignal[t]),e.next=5,d.a.users.getUserName(t);case 5:n=e.sent,console.log("sync to user the signal for username = "+n+" is "),this.userToConnectTo=t,this.store.dispatch(Object(O.S)(n));case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setupWebRTC",value:function(){var e=this;arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(t,n){e.connected=!1,e.peer=new Cb({initiator:e.initiator,trickle:!1}),e.peer.on("error",function(t){console.log(t),e.connected=!1,e.retry()}),e.peer.on("signal",function(t){return e.onSignal(t)}),e.peer.on("connect",function(){e.connected=!0,e.store.dispatch(Object(O.T)("SYNCED")),clearInterval(e.timer)}),e.peer.on("data",function(t){return e.onMessageFromPeer(t)}),e.peer.on("close",function(){e.connected=!1,e.store.dispatch(Object(O.T)("DISCONNECTED"))}),t()})}},{key:"onSignal",value:function(e){var t=this;console.log("Recieved a signal = "+e),Gt.a.addJson(e).then(function(){var e=Object(R.a)(N.a.mark(function e(n){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:"MASTER"===t.clockType?t.publishMaster(n):t.publishSlave(n,t.userToConnectTo);case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())}},{key:"onMessageFromPeer",value:function(e){var t,n=JSON.parse((t=e,String.fromCharCode.apply(null,new Uint16Array(t))));switch(n.type){case 1:this.lastTickTime=(new Date).getTime(),this.step=parseInt(n.payload.step),this.time=parseFloat(n.payload.time),this.length=parseInt(n.payload.length),this.peer.send(JSON.stringify({type:2,payload:""})),this.updateClockTickUI(this.step);break;case 2:this.peer.send(JSON.stringify({type:3}));break;case 4:this.sequencerEngine.stop();break;case 5:this.sequencerEngine.bpm=n.payload;break;case 3:this.rtt=(new Date).getTime()-this.lastTickTime;var r=this.rtt/2,a=this.step%this.sequencerEngine.length,i=this.sequencerEngine.length;if(i>this.length&&(i=this.length),a===i-2&&!this.initiator&&!this.sequencerEngine.playing&&this.isPlayScheduled){var s=this.lastTickTime-r+this.time-(new Date).getTime();s+=new x.a.Time("32n").toMilliseconds(),this.sequencerEngine.timeToCompare=(new Date).getTime()+s,this.sequencerEngine.play()}}}},{key:"updateClockTickUI",value:function(e){var t=this.length||this.sequencerEngine.length;if(0===(e%=t)%4){var n=e/t*100,r=25;n>=25&&n<50?r=50:n>=50&&n<75?r=75:n>=75&&(r=100),this.store.dispatch(Object(O.N)(r))}}},{key:"signal",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Gt.a.getJson(t);case 2:n=e.sent,this.peer.signal(n);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"publishMaster",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.store.dispatch(Object(O.T)("WAITING")),e.next=3,d.a.getUser();case 3:r=e.sent,fetch("/publishClock/"+r,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({clockType:"MASTER",signal:t})});case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"publishSlave",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.store.dispatch(Object(O.T)("WAITING")),e.next=3,d.a.getUser();case 3:r=e.sent,fetch("/publishClock/"+r,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({clockType:"SLAVE",signal:t,userToConnectTo:n})});case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"onStop",value:function(){var e=Object(R.a)(N.a.mark(function e(){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.connected&&this.initiator&&this.peer.send(JSON.stringify({type:4}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onBPMChanged",value:function(){var e=Object(R.a)(N.a.mark(function e(t){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.connected&&"MASTER"===this.clockType&&this.peer.send(JSON.stringify({type:5,payload:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onTick",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.connected&&"MASTER"===this.clockType&&(this.peer.send(JSON.stringify({type:1,payload:{step:n,time:t,length:this.sequencerEngine.length}})),this.updateClockTickUI(n));case 1:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"state",get:function(){return this.store.getState()}},{key:"isPlayScheduled",get:function(){return this.state.clock.playScheduled}}]),e}()),Rb=n(145),Db=n.n(Rb),qb=function(){function e(t,n){Object(o.a)(this,e),this.input=t,this.output=n,this.ccToCallback={}}return Object(c.a)(e,[{key:"setCallback",value:function(e,t){this.ccToCallback[e]=t}},{key:"send",value:function(e,t){(t=Math.round(t))<0?t=0:t>127&&(t=127),this.output.sendControlChange(e,t)}},{key:"onEvent",value:function(e){var t=this.ccToCallback[e.controller.number];t&&t(e.value)}}]),e}(),Mb="FILTER",Ab="DELAY",Ib="SEND_A",Lb=function(){function e(t){Object(o.a)(this,e),this.action=t}return Object(c.a)(e,[{key:"onChange",value:function(e,t){this.action===Ib&&e&&e.setSendVolume(0,Yi(t,0,128))}}]),e}(),Fb="RESOLUTION",Bb="TRACK_ROLL",Hb="SEQUENCE_ROLL",Vb={1:new Xe(4,!1),2:new Xe(4,!0),3:new Xe(8,!1),4:new Xe(8,!0),5:new Xe(16,!1),6:new Xe(16,!0),7:new Xe(32,!1),8:new Xe(32,!0)},Ub=function(){function e(t,n){Object(o.a)(this,e),this.sequencerEngine=t,this.ccToAction=this.convertConfig(n.cc),n.actions?this.noteToAction=this.convertConfig2(n.actions):this.noteToAction=this.convertConfig(n.note),this.overwrittenCC=new Set,this.knob1Action=new Lb(Mb),this.knob2Action=new Lb(Ab),this.knob3Action=new Lb(Ib),this.rollingCount=0}return Object(c.a)(e,[{key:"overwrite",value:function(e){this.overwrittenCC.add(e)}},{key:"onNoteOnEvent",value:function(e){var t=e.note.number,n=this.noteToAction[t];if(void 0!==n)switch(n.action){case Hb:this.onSequenceRollOn(n.track);break;case"PLAY":this.onPlay();break;case"RECORD":this.onRecord();break;case"CLEAR":this.onClear();break;case"PATTERN_SWITCH":this.onPatternSwitch(n.track);break;case"NEXT_PATTERN":this.onNextPattern();break;case"PREVIOUS_PATTERN":this.onPreviousPattern();break;default:return}}},{key:"onNoteOffEvent",value:function(e){var t=e.note.number,n=this.noteToAction[t];if(void 0!==n)switch(n.action){case Hb:this.onSequenceRollOff(n.track);break;case"PATTERN_SWITCH":break;default:return}}},{key:"onEvent",value:function(e,t){var n=this.ccToAction[e];if(void 0!==n&&!this.overwrittenCC.has(e))switch(n.action){case"VOLUME":this.onVolume(n.track,t);break;case"KNOB_1":this.onKnob1(n.track,t);break;case"KNOB_2":this.onKnob2(n.track,t);break;case"KNOB_3":this.onKnob3(n.track,t)}}},{key:"onVolume",value:function(e,t){var n=this.sequencerEngine.subSequences[e];void 0!==n&&(n.fade=t/128)}},{key:"onKnob1",value:function(e,t){var n=this.getTrack(e);this.knob1Action.onChange(n,t);var r=this.sequencerEngine.subSequences[e];void 0!==r&&this.sequencerEngine.switchToSubSequence(r.id)}},{key:"onKnob2",value:function(e,t){var n=this.getTrack(e);this.knob2Action.onChange(n,t);var r=this.sequencerEngine.subSequences[e];void 0!==r&&this.sequencerEngine.switchToSubSequence(r.id)}},{key:"onKnob3",value:function(e,t){var n=this.getTrack(e);this.knob3Action.onChange(n,t);var r=this.sequencerEngine.subSequences[e];void 0!==r&&this.sequencerEngine.switchToSubSequence(r.id)}},{key:"convertConfig2",value:function(e){var t={};for(var n in e){t[e[n]]={action:n}}return t}},{key:"convertConfig",value:function(e){var t={};for(var n in e){var r={track:Object(B.a)(n)?parseInt(n):n},a=e[n];for(var i in a){t[a[i]]=Object(D.a)({},r,{action:i})}}return t}},{key:"getTrack",value:function(e){if("MASTER"!==e)return this.sequencerEngine.tracks[e]}},{key:"onSequenceRollOn",value:function(e){var t=Vb[e];void 0!==t&&(this.sequencerEngine.resolution=t,this.sequencerEngine.trackRolling=!0,this.sequencerEngine.setSequenceRolling(!0,t),this.rollingCount++)}},{key:"onSequenceRollOff",value:function(e){this.rollingCount--,0===this.rollingCount&&(this.sequencerEngine.trackRolling=!1,this.sequencerEngine.setSequenceRolling(!1,void 0))}},{key:"onPatternSwitch",value:function(e){this.sequencerEngine.switchToPattern(e)}},{key:"onNextPattern",value:function(){this.sequencerEngine.switchToNextPattern()}},{key:"onPreviousPattern",value:function(){this.sequencerEngine.switchToPreviousPattern()}},{key:"onPlay",value:function(){this.sequencerEngine.play()}},{key:"onClear",value:function(){var e=this.sequencerEngine.getSelectedTrack();e&&(e.pattern.clear(),e.updateSteps())}},{key:"onRecord",value:function(){this.sequencerEngine.recording(!this.sequencerEngine.isRecording)}}]),e}(),Jb=n(951),_b=function(){function e(t,n,r){Object(o.a)(this,e),this.sequencerEngine=t,this.store=this.sequencerEngine.store,this.input=n,this.output=r,this.step=0,this.subSequenceNumber=0,this.patternNumber=0,this.numberOfPatterns=1,this.setupLights(),this.setupListeners()}return Object(c.a)(e,[{key:"setupListeners",value:function(){var e=this;this.input.addListener("noteon","all",function(e){}),this.input.addListener("noteoff","all",function(e){}),this.store.subscribe(function(){return e.onStateUpdate()})}},{key:"onStateUpdate",value:function(){var e=this.store.getState(),t=this.sequencerEngine.getSubSequence(e.sequencer.currentSubSequence);if(void 0!==t){var n=this.sequencerEngine.subSequences.indexOf(t),r=e.sequencer.currentPattern[t.id],a=e.sequencer.numberOfPatterns;this.subSequenceNumber===n&&this.patternNumber===r&&this.numberOfPatterns===a||(this.patternNumber=r,this.subSequenceNumber=n,this.idToPattern=e.sequencer.currentPattern,this.numberOfPatterns=a,this.onStateChanged())}}},{key:"onStateChanged",value:function(){this.pad.reset(8),console.log("patternNumber = "+this.patternNumber+" and subSequenceNumber = "+this.subSequenceNumber),this.color(this.pad.red,8,this.subSequenceNumber);for(var e=0;e<this.sequencerEngine.subSequences.length;e++)this.color(this.pad.red,0,e);for(var t in this.idToPattern){t=parseInt(t),console.log("id we got = "+t);var n=this.sequencerEngine.getSubSequence(t);if(void 0===n)return;var r=this.sequencerEngine.subSequences.indexOf(n),a=this.idToPattern[t],i=n.tracks[0];if(void 0!==i)for(var s=0;s<Math.min(8,i.patterns.length);s++)this.color(this.pad.yellow,s,r);console.log("coloring x = "+a+" y ="+r),this.color(this.pad.red,a,r)}}},{key:"onTick",value:function(){}},{key:"setupLights",value:function(){var e=this;this.pad=new Jb.a,this.pad.connect().then(function(){e.pad.reset(8),e.pad.on("key",function(t){return e.handleKeyPressed(t)}),e.onStateUpdate()})}},{key:"handleKeyPressed",value:function(e){var t=e.x,n=e.y;if(e.pressed){var r=this.sequencerEngine.subSequences[n];if(void 0!==r){var a=r.tracks[0];void 0!==a&&t<a.patterns.length&&(this.sequencerEngine.switchToSubSequence(r.id),this.sequencerEngine.switchToPattern(t))}}}},{key:"color",value:function(e,t,n){this.pad.col(e,{0:t,1:n,x:t,y:n,length:2,pressed:!0})}}]),e}(),Gb=["Launchpad Mini"],zb=["IAC Driver Bus 1","IAC Driver Bus 2","IAC Driver Bus 3"],Wb={"Akai MPD26 Port 1":"PADS","MPD218 Port A":"PADS"},Kb=function(){function e(t,n,r){var a=this;Object(o.a)(this,e);this.keyboardEngine=t,this.sequencerEngine=this.keyboardEngine.sequencerEngine,this.keyboardHelper=n,this.deviceToMidiCC={},this.sliders={},this.controllerInputs=[],this.controllerOutputs=[],this.inputToMode={},this.updateBpm=r,this.previousTimestamp=null,this.currentTimestamp=null,Db.a.enable(function(e){e?console.log("WebMidi could not be enabled.",e):a.setup()},!0)}return Object(c.a)(e,[{key:"setup",value:function(){var e=Object(R.a)(N.a.mark(function e(){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadAvailableDevices();case 2:this.setupKeyboardRouting(),void 0!==this.onEnableCallback&&this.onEnableCallback();case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loadAvailableDevices",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t=this;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){Db.a.inputs.filter(function(e){return!Gb.some(function(t){return t===e.name})&&!zb.some(function(t){return t===e.name})}).forEach(function(e){return t.trackInput(e,Wb[e.name]||"KEYBOARD")});var r=Db.a.inputs.filter(function(e){return Gb.some(function(t){return t===e.name})}),a=Db.a.outputs.filter(function(e){return Gb.some(function(t){return t===e.name})});r.length>0&&void 0===t.launchPad&&(t.launchPad=new _b(t.sequencerEngine,r[0],a[0])),Db.a.outputs.map(function(e){return t.trackOutput(e)}),e()}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"setStartCallback",value:function(e){this.startCallback=e}},{key:"setStopCallback",value:function(e){this.stopCallback=e}},{key:"getInputs",value:function(){return Db.a.inputs}},{key:"getOutputs",value:function(){return Db.a.outputs}},{key:"getTrackedInputs",value:function(){return this.controllerInputs}},{key:"getTrackedOutputs",value:function(){return this.controllerOutputs}},{key:"isOutputTracked",value:function(e){return this.controllerOutputs.some(function(t){return t.name==e.name})}},{key:"getOutput",value:function(e){var t=this.controllerOutputs.filter(function(e){return e.name==t.name});return t.length>0?t[0]:null}},{key:"playNote",value:function(e,t,n,r,a,i){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;t=t||"all",(n=Math.round(n))>70?n=70:n<-36&&(n=-36);var o=_i.a.fromTranspose(n).toString();if(null!=e&&(r-=0,e.playNote(o,t,{velocity:s,time:"+"+r}),void 0!==a)){var c=r+a-20;c-r<10&&(c+=10-(c-r)),e.stopNote(o,t,{time:"+"+c,release:i})}}},{key:"playNoteSimple",value:function(e,t,n,r){n=n||"all",e.playNote(t,n,{release:r})}},{key:"releaseNoteSimple",value:function(e,t,n,r){n=n||"all",e.stopNote(t,n,{release:r})}},{key:"trackOutput",value:function(e){for(var t in this.controllerOutputs)if(this.controllerOutputs[t].name===e.name)return;this.controllerOutputs.push(e),void 0===this.deviceToMidiCC[e.name]&&(this.deviceToMidiCC[e.name]=new qb),this.deviceToMidiCC[e.name].output=e}},{key:"untrackOutput",value:function(e){for(var t=-1,n=0;n<this.controllerOutputs.length;n++)if(this.controllerOutputs[n].name===e.name){t=n;break}t>-1&&(this.controllerOutputs.splice(t,1),delete this.inputToMode[e.name])}},{key:"trackInput",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"KEYBOARD";if(ti[e.name]&&void 0===this.sliders[e.name]){var n=ti[e.name];this.sliders[e.name]=new Ub(this.sequencerEngine,n,e)}else{for(var r in this.addControlChangeListeners(e),this.controllerInputs)if(this.controllerInputs[r].name===e.name)return;this.controllerInputs.push(e),this.setInputMode(e,t)}}},{key:"isInputTracked",value:function(e){return this.controllerInputs.some(function(t){return t.name==e.name})}},{key:"isInputSynced",value:function(e){return void 0!==this.systemInput&&this.systemInput.name==e.name}},{key:"untrackInput",value:function(e){for(var t=-1,n=0;n<this.controllerInputs.length;n++)if(this.controllerInputs[n].name===e.name){t=n;break}t>-1&&(this.controllerInputs.splice(t,1),delete this.inputToMode[e.name])}},{key:"setInputMode",value:function(e,t){this.inputToMode[e.name]=t}},{key:"syncOutput",value:function(e){this.systemOutput===e?this.systemOutput=void 0:this.systemOutput=e}},{key:"onTick",value:function(e,t,n){if(void 0!==this.systemOutput){var r=new x.a.Time("32n").toMilliseconds()/3;e+=20;for(var a=0;a<3;a++)this.systemOutput.sendClock({time:"+"+e}),e+=r}this.launchPad&&this.launchPad.onTick(t,n)}},{key:"onPlay",value:function(){void 0!==this.systemOutput&&this.systemOutput.sendStart({time:"+0"})}},{key:"onStop",value:function(){void 0!==this.systemOutput&&this.systemOutput.sendStop()}},{key:"syncInput",value:function(e){void 0!==this.systemInput&&this.removeSystemListeners(),this.systemInput=e,this.addSystemInputListeners()}},{key:"unsyncInput",value:function(e){this.removeSystemListeners(),this.systemInput=void 0}},{key:"removeSystemListeners",value:function(){this.systemInput.removeListener("clock","all"),this.systemInput.removeListener("start","all"),this.systemInput.removeListener("stop","all")}},{key:"addSystemInputListeners",value:function(){var e=this;this.last10=[],this.systemInput.addListener("start","all",function(t){e.sequencerEngine.play(0,!0)}),this.systemInput.addListener("stop","all",function(t){e.sequencerEngine.stop()})}},{key:"onEnable",value:function(e){this.onEnableCallback=e}},{key:"addControlChangeListeners",value:function(e){var t=this;e.removeListener("controlchange","all"),void 0===this.deviceToMidiCC[e.name]&&(this.deviceToMidiCC[e.name]=new qb);var n=this.deviceToMidiCC[e.name],r=this.sliders[e.name];n.input=e,console.log("add controll change listeners=",e.name),e.addListener("controlchange","all",function(e){if(n.onEvent(e),r&&r.onEvent(e.controller.number,e.value),118===e.controller.number)t.sequencerEngine.play();else if(117===e.controller.number)t.sequencerEngine.stop();else if(119===e.controller.number){var a=t.sequencerEngine.store.getState();t.sequencerEngine.recording(!a.sequencer.isRecording)}else 116===e.controller.number?t.sequencerEngine.switchToNextPattern():115===e.controller.number&&t.sequencerEngine.switchToPreviousPattern();if(e.controller.number>=1&&e.controller.number<=6){var i=t.sequencerEngine.groups.groups[e.controller.number-1];void 0!==i&&(1==i.tracks.length?i.tracks[0].setVolume(e.value):i.setVolume(e.value))}else{var s=e.controller.number;if("DELETE"===t.midiMapMode)t.store.dispatch(Object(O.c)(s));else if(t.midiMappings[s]&&(void 0===t.parameterSelected||t.midiMappings[s].indexOf(t.parameterSelected)>-1)){t.midiMappings[s].map(function(e){return t.sequencerEngine.idToParameter[e]}).filter(function(e){return e.object}).forEach(function(t){return t.normalizedSet(e.value/127)})}else if(t.actionMappings[s]&&(void 0===t.actionSelected||t.actionMappings[s].indexOf(t.actionSelected)>-1)){t.actionMappings[s].forEach(function(t){return t.execute(e.value)})}else t.midiMapMode===cu&&t.actionSelected?t.store.dispatch(Object(O.o)(t.actionSelected,s)):t.midiMapMode===cu&&t.parameterSelected&&t.store.dispatch(Object(O.ac)(t.parameterSelected,s))}})}},{key:"removeListeners",value:function(e){e.removeListener("noteon","all"),e.removeListener("noteoff","all")}},{key:"getInputsForMode",value:function(e){var t=this;return this.controllerInputs.filter(function(n){return n.name in t.inputToMode&&t.inputToMode[n.name]==e})}},{key:"getInputMode",value:function(e){return this.inputToMode[e]||"KEYBOARD"}},{key:"setupKeyboardRouting",value:function(){var e=this;Db.a.inputs.forEach(function(t){return e.removeListeners(t)}),this.addNoteOnListener(function(t,n,r){e.keyboardHelper.onNoteDown(n,!0,t,r)},void 0),this.addNoteOffListener(function(t,n){e.keyboardHelper.onNoteOff(n,!0,t)},void 0)}},{key:"addNoteOnListener",value:function(e,t){var n=this;void 0===t&&(t=function(){return n.controllerInputs});Db.a.inputs.map(function(r){return r.addListener("noteon","all",function(a){var i=n.sliders[r.name];if(i)i.onNoteOnEvent(a);else if(t().some(function(e){return e.name==r.name})){var s=a.note.name+a.note.octave;console.log("message velocity =",a.velocity),e(r.name,s,Math.min(1,a.velocity+.3))}})})}},{key:"addNoteOffListener",value:function(e,t){var n=this;void 0===t&&(t=function(){return n.controllerInputs});Db.a.inputs.map(function(r){return r.addListener("noteoff","all",function(a){var i=n.sliders[r.name];if(i)i.onNoteOffEvent(a);else if(t().some(function(e){return e.name==r.name})){var s=a.note.name+a.note.octave;e(r.name,s)}})})}},{key:"updateSteps",value:function(e){}},{key:"store",get:function(){return this.sequencerEngine.store}},{key:"state",get:function(){return this.store.getState()}},{key:"midiMapMode",get:function(){return this.state.midi.midiMapMode}},{key:"parameterSelected",get:function(){return this.state.midi.parameterSelected}},{key:"midiMappings",get:function(){return this.state.midi.mappings}},{key:"actionSelected",get:function(){return this.state.midi.actionSelected}},{key:"actionMappings",get:function(){return this.state.midi.actionMappings}}]),e}();function Qb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Xb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function Yb(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Zb=function(e){Object(u.a)(n,e);var t=Yb(n);function n(e,r,a,i,s,c){var u;return Object(o.a)(this,n),(u=t.call(this,e,r,a,i,s,c)).annotations=[],u}return Object(c.a)(n,[{key:"getCopy",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,r,a,i,s,o,c,u,l,p,h,f,d,m=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=m.length>0&&void 0!==m[0]?m[0]:function(e,t,r,a,i,s){return new n(e,t,r,a,i,s)},r=this.trackData.getCopy(),a=this.patterns.map(function(e){return e.getCopy()}),e.next=5,Promise.all(a);case 5:for(u in a=e.sent,i=this.currentPattern,s=a[i],o=[].concat(this.soundIds),c=t(this.trackNumber,this.sequencerEngine,this.mixSession,this.patterns.length,this.update,this.subSequence),a){for(p in(l=a[u]).stepBuckets)for(h in l.stepBuckets[p].track=c,l.stepBuckets[p].steps)l.stepBuckets[p].steps[h].track=c;l.track=c}for(d in this.sample&&(c.sample=this.sample.getCopy()),c.name=this.name,c.videoId=this.videoId,c.effectsChains[0].dispose(),c.effectsChains=this.effectsChains.map(function(e){return e.getCopy(c)}),c.midiEffects=this.midiEffects.getCopy(c),c.trackData=r,c.patterns=a,c.currentPattern=i,c.pattern=s,c.soundIds=o,f={},this.samplers)f[d]=this.samplers[d].getCopy(function(e){return c.onNewSampler(c,e)},c);return c.samplers=f,c.updateSteps(!0),this.samplesStream?c.samplesStream=this.samplesStream.getCopy(c.sample):c.samplesStream=new Mn(c.sample,this.sequencerEngine),e.abrupt("return",c);case 28:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"addNotes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sequencerEngine.bpm,r=x.a.Time("16n").toMilliseconds();e=e.map(function(e){var a=e.velocity/127;return{transpose:e.pitch-60,startTime:1e3*e.startTime,velocity:a,duration:n/t.sequencerEngine.bpm*(1e3*(e.endTime-e.startTime))/r}});x.a.Time("32n").toMilliseconds();var a=-1;for(var i in e){var s=ns(e[i].startTime,n,this.sequencerEngine.bpm);e[i].step=s.stepNumber,e[i].position=s.offset,e[i].step>a&&(a=e[i].step)}for(;a>=this.pattern.length();)this.sequencerEngine.doubleTrackLength(this.trackNumber);var o=this.getEasyPattern();e.forEach(function(e){return o.addStep(t.getStepDataForNote(e),e.step,$o.baseResolution,e.position,!1,!0)}),o.update(!1),this.updateSteps()}},{key:"getStepDataForNote",value:function(e){var t=new Ge(this.sequencerEngine,void 0,void 0,this);return t.on=!0,t.transpose=e.transpose,t.duration=e.duration,t.velocity=e.velocity,t}},{key:"toggleStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.store.getState().sequencer.resolution,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;this.pattern.toggleStep($o.baseResolution.transformStepAtResolution(e,t),t,n,this.trackData.transpose===n),this.pattern.syncBuckets(),this.updateSteps()}},{key:"getStep",value:function(e){return this.pattern.getAnyStep(e%this.pattern.length())}},{key:"recordHit",value:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;t=t||$o.baseResolution;var s=new Ge(void 0,void 0,void 0,this);if(s.on=!0,s.slice=n,s.duration=r,s.transpose=a,s.velocity=i,void 0===this.currentPattern){console.log("current pattern is undefined");var o=new Do(this.sequencerEngine,this),c=e-e%t.transformStepAtResolution2(16,$o.baseResolution);o.startStep=$o.baseResolution.transformStepAtResolution2(c,t),this.patterns.push(o),this.switchToPattern(this.patterns.length-1),this.updateSteps()}void 0!==this.pattern.startStep&&(console.log("pattern.startStep = %s",this.pattern.startStep),e-=t.transformStepAtResolution2(this.pattern.startStep,$o.baseResolution)),this.pattern.isRecording=!0,this.sequencerEngine.operationManager.dispatch(function(e,t,n,r){return{type:"RECORD_STEP",timestamp:(new Date).getTime(),payload:{track:e,step:t,stepNumber:n,resolution:r}}}(this,s,e,t))}},{key:"syncBuckets",value:function(e){this.pattern.syncBuckets(e.isTriplet),this.pattern.clearCache()}},{key:"recordUnquantizedHit",value:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=$o.baseResolution,o=new Ge;o.on=!0,o.slice=t,o.velocity=i,o.duration=n,o.transpose=a,this.getEasyPattern().addStep(o,e%this.pattern.length(s),s,r),this.updateSteps()}},{key:"selectSlice",value:function(e,t){for(var n=-16,r=0;r<this.soundIds.length;r++){var a=this.samplers[this.soundIds[r]].getNumberOfSlices();n<a&&(n=a)}t%=n;var i=this.pattern.stepBuckets[e];for(var s in i.steps)i.steps[s].slice=t}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=Qb(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"getParametersToShow",value:function(){var e=this.liveEffects.effects.find(function(e){return e.effect===qi});return void 0===e?[]:e.macros.filter(function(e){return e.subMacros.length>0}).map(function(e){return e.macroParameter})}},{key:"loopPosition",get:function(){return this.sequencerEngine.trackStep%this.length*100/this.length}}]),n}(e)}(function(e){return function(e){Object(u.a)(n,e);var t=Xb(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"convertToInstrumentRack",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r,a,i,s,o,c,u,l,p;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.sequencerEngine.addInstrumentRackTrack(!1,!0),n=this.patterns.map(function(e){return e.getCopy(void 0,void 0,t)}),e.next=4,Promise.all(n);case 4:for(r in n=e.sent){for(i in(a=n[r]).stepBuckets)for(s in a.stepBuckets[i].track=t,a.stepBuckets[i].steps)a.stepBuckets[i].steps[s].track=t;a.track=t}t.patterns=n,t.pattern=t.patterns[this.currentPattern],o=this.effectsChain.getJson(),c=this.trackNumber,(u=this.getTrackType())===zr.e?t.addSample(this.sample):u===zr.b&&(l=t.addInstrumentType(this.getInstrumentType()),p=this.getJson(),l.track.fromJson(p,!1)),this.sequencerEngine.deleteTrack(c,t),t.tracks[0].track.midiEffects.fromJson(this.midiEffects.getJson()),t.tracks[0].track.effectsChain.fromJson(o,this.sequencerEngine.tracks,this.trackNumber),t.pattern.updateStepResolutionTree(),this.sequencerEngine.updateSteps(),this.sequencerEngine.selectTrack(c);case 18:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),n}(e)}($o.Track)));function $b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ek=new Xe(4,!1),tk=function(e){Object(u.a)(n,e);var t=$b(n);function n(e,r,a,i){var s;return Object(o.a)(this,n),(s=t.call(this,-1,e,r,a,i,{id:-1})).initPattern(),s}return Object(c.a)(n,[{key:"initPattern",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Dn.a("QmfJwbUmKMiE1Mrme2xHpHUJP2bVM3BFeUtzQgpDqHssCw"),e.next=3,t.fetchAudio();case 3:this.addSound(t),(n=this.getEasyPattern()).addStep(this.getOnBeat(),0,ek,0),n.addStep(this.getOffBeat(),1,ek,0),n.addStep(this.getOffBeat(),2,ek,0),n.addStep(this.getOffBeat(),3,ek,0),this.muteableNode.toMaster(),this.mute(!0);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOnBeat",value:function(){var e=new Ge;return e.on=!0,e.velocity=1,e}},{key:"getOffBeat",value:function(){var e=new Ge;return e.on=!0,e.velocity=.4,e}},{key:"updateSteps",value:function(){}},{key:"getUpdateStepsAction",value:function(){return[]}}]),n}(Zb);function nk(e,t,n,r){for(var a in t.filter(function(e){return void 0!==e}).forEach(function(e){return e.chokes.onStep()}),n)if(void 0!==t[a]&&void 0!==t[a].chokes&&void 0!==t[a].chokes.choke){var i=t[a].chokes.choke,s=n[a];for(var o in s){var c=s[o],u=2*c.stepData.duration;i.chokes.newChoke(u,c.time)}}var l=function(e){var a=t[e];return void 0===a||void 0===a.chokes||a.chokes.isChoked()?"continue":void 0===n[e]?"continue":void n[e].forEach(function(e){a.trigger(e.stepData,e.time,r)})};for(var p in n)l(p)}var rk=function(){function e(){Object(o.a)(this,e),this.trackToSlices={},this.trackToTransposes={}}return Object(c.a)(e,[{key:"clear",value:function(){this.trackToSlices={},this.trackToTransposes={}}},{key:"addTrackSlice",value:function(e,t,n){void 0===n?e in this.trackToSlices?this.trackToSlices[e].add(t):this.trackToSlices[e]=new Set([t]):e in this.trackToTransposes?this.trackToTransposes[e].add(n):this.trackToTransposes[e]=new Set([n])}},{key:"deleteTrack",value:function(e){e in this.trackToSlices&&delete this.trackToSlices[e],e in this.trackToTransposes&&delete this.trackToTransposes[e]}},{key:"removeTrackSlice",value:function(e,t,n){if(void 0!==n){var r=this.trackToTransposes[e];void 0===r||(r.size<=1?delete this.trackToTransposes[e]:this.trackToTransposes[e].delete(n))}else{var a=this.trackToSlices[e];void 0===a||(a.size<=1?delete this.trackToSlices[e]:this.trackToSlices[e].delete(t))}}},{key:"getTrackSlicesRolling",value:function(e){var t=e.trackNumber,n=[];return(this.trackToTransposes[t]||[]).forEach(function(e){return n.push(new ak(parseInt(t),0,e))}),(this.trackToSlices[t]||[]).forEach(function(e){return n.push(new ak(parseInt(t),e,void 0))}),n}},{key:"getTriggerTimes",value:function(e,t){return Da(e,t)}},{key:"getTrackRollEffectIfAny",value:function(e){for(var t in e.liveEffects.effects){var n=e.liveEffects.effects[t];if(n.effect===Di)return n}}},{key:"getTriggers",value:function(e,t,n){var r=this.getTrackRollEffectIfAny(n);if(r){var a=r.rollFactor;(t=t.getCopy()).resolution*=a}var i=this.getTriggerTimes(e,t),s=[];return 0==i.length?s:(this.getTrackSlicesRolling(n).forEach(function(e){return i.forEach(function(t){return s.push(new ik(e,t.time,t.step))})}),s)}}]),e}(),ak=function e(t,n,r){Object(o.a)(this,e),this.trackNumber=t,this.sliceNumber=n,this.transpose=r},ik=function e(t,n,r){Object(o.a)(this,e),this.trackSlice=t,this.time=n,this.step=r},sk=rk;function ok(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ck=function(e){Object(u.a)(n,e);var t=ok(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return a.a.createElement(Sc.Rect,{x:this.props.start,y:0,width:this.props.end-this.props.start,height:this.props.height,fill:"yellow"})}}]),n}(r.Component),uk=Object(g.b)(function(e,t){return void 0===e.selector.waveformSelection?{}:e.selector.waveformSelection.id!==t.sampleId?{}:{start:e.selector.waveformSelection.start,end:e.selector.waveformSelection.end}},null)(ck);function lk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var pk=function(e){Object(u.a)(n,e);var t=lk(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={isPlaying:!1,x:0},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e){return e.isPlaying!==this.state.isPlaying&&(this.state.isPlaying=e.isPlaying,e.isPlaying?this.startTicker():clearInterval(this.timer)),!0}},{key:"startTicker",value:function(){var e=this;this.timer=setInterval(function(){var t=new Date,n=(1e3*e.props.startOffsetTime+(t-e.props.startTime))%(1e3*e.props.duration);e.setState({x:e.props.width*n/(1e3*e.props.duration)/2})},50)}},{key:"render",value:function(){return this.props.isPlaying?a.a.createElement(Sc.Line,{x:this.state.x,y:0,points:[this.state.x,0,this.state.x,this.props.height],strokeWidth:1,stroke:"red",fill:"red"}):a.a.createElement(Sc.Line,null)}}]),n}(r.Component);function hk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var fk=function(e){Object(u.a)(n,e);var t=hk(n);function n(e){var r;Object(o.a)(this,n),(r=t.call(this,e)).state={audioUnit:e.audioUnit,buffer:e.audioUnit.buffer,x:0,isPlaying:!1},r.dragging=!1,r.width=e.width||325,r.height=e.height||50,r.state.pts=[];var a=Object(W.a)(r);return r.computeWaveformInChunks(0,[],function(e){a.state.pts=e,a.setState(a.state)}),r.convertSpaceToSeconds.bind(Object(W.a)(r)),r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){if(this.state.buffer!==e.buffer){this.state.buffer=e.buffer;var n=this;return this.computeWaveformInChunks(0,[],function(e){n.state.pts=e}),!0}return this.dragging||this.state.isPlaying||this.state.pts!==t.pts||this.props.slices!==e.slices}},{key:"computeWaveformInChunks",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n,r){var a,i,s,o,c,u,l,p,h,f;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.width,!((t+1)*a>this.width)){e.next=4;break}return r([]),e.abrupt("return");case 4:if(void 0!==this.state.audioUnit.buffer){e.next=6;break}return e.abrupt("return");case 6:for(i=Math.floor(this.state.audioUnit.buffer.length/this.width),s=(s=this.state.audioUnit.buffer.getChannelData(0)).subarray(a*t*i,a*(t+1)*i),o=window.api.create_buffer(s.length),window.Module.HEAPF32.set(s,o>>2),window.api.getColoredWaveform(o,a,this.height,s.length,i,a*t),c=window.api.get_result_pointer(),u=new Uint16Array(window.Module.HEAP16.buffer,c,7*a),l=[],p=0;p<7*a;p+=7)h=[u[p+4],u[p+5],u[p+6]],l.push({x:u[p],y:u[p+1],width:u[p+2],height:u[p+3],rgb:h});(f=this).state.pts=n.concat(l),f.setState(f.state),window.api.destroy_buffer(o),setTimeout(function(){f.computeWaveformInChunks(t+1,n.concat(l),function(e){r(l.concat(e))})},100);case 21:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"computeWaveformPoints",value:function(){}},{key:"stopSound",value:function(){this.state.audioUnit.stopSound(),this.setState({isPlaying:!1})}},{key:"playSound",value:function(e,t){var n=e.state.audioUnit;if(e.state.isPlaying)e.stopSound();else{e.setState(e.state),e.state.isPlaying=!0;var r=e.convertSpaceToSeconds(t);n.playSound(r);var a=new Date;this.setState({startOffsetTime:r,startTime:a})}}},{key:"convertSpaceToSeconds",value:function(e){return this.state.audioUnit.buffer.duration*e/this.width}},{key:"convertSecondsToSpace",value:function(e){return e/this.state.audioUnit.buffer.duration*this.width}},{key:"startDrag",value:function(e,t){if(document.activeElement.blur(),t=t.evt,e.draggin?e.dragging=!1:(e.playSound(e,t.offsetX),void 0!==e.props.sample&&e.props.setWaveformSelection({start:t.offsetX,end:t.offsetX,id:e.props.sample.getId()}),e.dragging=!0),void 0!==this.props.slices){var n=this.getSliceFromCoordinate(t.offsetX);this.props.onSelectSlice(n)}}},{key:"getSliceFromCoordinate",value:function(e){var t=this.convertSpaceToSeconds(e),n=this.props.slices.filter(function(e){return e.startTime<=t&&e.endTime>=t});return 0==n.length?void 0:n[0]}},{key:"moveDrag",value:function(e,t){if(e.dragging){if(e.props.setWaveformSelectionEnd(t.evt.layerX),void 0===this.props.sequencerEngine)return;var n=this.props.sequencerEngine.store.getState(),r=this.convertSpaceToSeconds(n.selector.waveformSelection.start),a=this.convertSpaceToSeconds(t.evt.layerX);void 0!==this.props.onChooseSlice&&r<a&&this.props.onChooseSlice({startTime:r,endTime:a})}}},{key:"endDrag",value:function(e){this.dragging=!1,this.stopSound()}},{key:"isCurrentChord",value:function(e){var t=this.props.selectedChordSample;return void 0!==this.props.sample&&void 0!==t&&(this.props.sample.ipfsHash===t.sampleHash&&e.startTime===t.startTime&&e.endTime===t.endTime)}},{key:"render",value:function(){var e=this,t=this.state.pts,n=void 0===this.props.slices?[]:this.props.slices;return void 0===t||0==t.length?a.a.createElement("div",null):void 0===this.props.audioUnit?a.a.createElement("div",null,"Fetching sample..."):a.a.createElement("div",null,a.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("SELECTOR_WAVEFORM")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"sound-waveform details-view"},a.a.createElement(Sc.Stage,{onMouseDown:function(t){return e.startDrag(e,t)},onMouseUp:function(t){return e.endDrag(e,t)},onMouseMove:function(t){return e.moveDrag(e,t)},width:this.width,height:this.height},a.a.createElement(Sc.Layer,null,a.a.createElement(Sc.Rect,{x:0,y:0,width:this.width,height:this.height,fill:"black"}),a.a.createElement(uk,{height:this.height,sampleId:void 0!==this.props.sample?this.props.sample.getId():0}),n.map(function(t,n){return a.a.createElement(Sc.Rect,{x:e.convertSecondsToSpace(t.startTime),onMouseOver:function(){return e.props.onHoverSlice(t)},y:0,width:e.convertSecondsToSpace(t.endTime-t.startTime),height:e.height,fill:e.isCurrentChord(t)?"green":"yellow"})})),a.a.createElement(Sc.Layer,null,t.map(function(e,t){return a.a.createElement(Sc.Rect,{key:"point-"+t,x:e.x,y:e.y,width:e.width,height:e.height,fill:"rgb("+e.rgb[0]+","+e.rgb[1]+","+e.rgb[2]+")"})})),a.a.createElement(Sc.Layer,null,a.a.createElement(pk,{startTime:this.state.startTime,isPlaying:this.state.isPlaying,duration:this.state.audioUnit.buffer.duration,startOffsetTime:this.state.startOffsetTime,width:this.width,height:this.height})))))}}]),n}(r.Component),dk=Object(g.b)(function(e,t){return{selectedChordSample:e.selector.selectedChordSample}},function(e){return{dragSample:function(t){return e(Object(O.g)(t))},setWaveformSelection:function(t){return e(Object(O.ee)(t))},setWaveformSelectionEnd:function(t){return e(Object(O.fe)(t))},setContextualHelp:function(t){return e(Object(O.U)(t))}}})(fk);function mk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var vk=function(e){Object(u.a)(n,e);var t=mk(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={emailAddress:"",reasoning:""},r.onClickDone=r.onClickDone.bind(Object(W.a)(r)),r.onClickCancel=r.onClickCancel.bind(Object(W.a)(r)),r}return Object(c.a)(n,[{key:"onClickDone",value:function(){d.a.dmca.copyStrikeSample(this.props.sampleHash,this.state.emailAddress,this.state.reasoning),this.props.hide()}},{key:"onClickCancel",value:function(){this.props.hide()}},{key:"render",value:function(){var e=this;return a.a.createElement(lh.a,{dialogClassName:"preset-modal",show:this.props.show,onHide:this.onClickCancel},a.a.createElement(lh.a.Header,{closeButton:!0},a.a.createElement(lh.a.Title,null,"DMCA Takedown Form")),a.a.createElement(lh.a.Body,null,"Provide proof that you own the rights to this sample here, or email us at universalsequences@gmail.com with the sound identifier:",a.a.createElement("div",{className:"sample-identifier"},this.props.sampleHash),a.a.createElement(Ac.h,null,a.a.createElement("label",null,"Email Address: "),a.a.createElement(Ac.g,{onChange:function(t){return e.setState({emailAddress:t.target.value})},value:this.state.emailAddress,placeholder:"Enter your email address",className:"email-address-input"})),a.a.createElement(Ac.h,null,a.a.createElement(Ac.g,{onChange:function(t){return e.setState({reasoning:t.target.value})},value:this.state.reasoning,type:"textarea",placeholder:"Include proof here of your rights to this sound and other shit",className:"dmca-reasoning-input"}))),a.a.createElement(lh.a.Footer,null,a.a.createElement(Ac.b,{variant:"secondary",onClick:this.onClickDone},"Done"),a.a.createElement(Ac.b,{variant:"primary",onClick:this.onClickCancel},"Cancel")))}}]),n}(r.Component),gk=Object(g.b)(function(e){return{}},function(e){return{}})(vk);n(2287);function yk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var bk=new wt.a,kk=function(e){Object(u.a)(n,e);var t=yk(n);function n(e){var r;Object(o.a)(this,n),(r=t.call(this,e)).state={thumbnail:"",name:e.name,videoId:e.sample.videoId},r.apiKey="AIzaSyCf2k8RM7tFFlVGo4CVPvCsOhx86vWwTT0",r.getYoutubeTitle.bind(Object(W.a)(r)),r.getYoutubeThumbnail.bind(Object(W.a)(r));var a=r.props.sample.videoId;return void 0!==a&&""!==a&&r.getYoutubeThumbnail(a),r.props.coverArt&&r.getDiscogsThumbnail(r.props.coverArt),r.props.sample.coverArtHash&&(console.log("getting sample cover art hash = "+r.props.sample.coverArtHash),r.getDiscogsThumbnail(r.props.sample.coverArtHash)),r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){var n=!1;return e.id!==this.props.id&&(n=!0),e.selectedSampleTag!==this.props.selectedSampleTag&&(n=!0),e.sample.soundId===this.props.sample.soundId&&e.sample.ipfsHash===this.props.sample.ipfsHash||(n=!0),e.name!=this.state.name&&(this.state.name=e.name,n=!0),e.isCompactMode!==this.props.isCompactMode&&(n=!0),e.sample.videoId!==this.state.videoId&&(this.state.videoId=e.sample.videoId,this.getYoutubeThumbnail(this.state.videoId),n=!0),e.coverArt!==this.props.coverArt&&(this.getDiscogsThumbnail(e.coverArt),n=!0),e.sample.coverArtHash!==this.props.sample.coverArtHash&&(this.getDiscogsThumbnail(e.sample.coverArtHash),n=!0),void 0!==e.sample&&void 0!==e.name&&(this.state.name=e.name),t.thumbnail!==this.state.thumbnail&&(n=!0),e.isLoading!==this.props.isLoading&&(n=!0),n}},{key:"getYoutubeTitle",value:function(e){var t=this;if(void 0!==e&&null!==e&&""!==e){var n=e.split("="),r=this;if(n.length>1){var a=n[n.length-1];if(""===a)return this.state.name=this.props.name,void this.setState(this.state);f.a.get("https://www.googleapis.com/youtube/v3/videos?id="+a+"&key="+this.apiKey+"&fields=items(snippet(title))&part=snippet").then(function(e){return r.setState({name:void 0!==e.data.items[0]?t.truncateName(e.data.items[0].snippet.title):"Video deleted"})})}}else this.setState(this.state)}},{key:"getDiscogsThumbnail",value:function(e){console.log("got the thumbnail = "+Gt.a.getHashUrl(e)),this.state.thumbnail=Gt.a.getHashUrl(e),this.setState(this.state)}},{key:"getYoutubeThumbnail",value:function(e){if(""===e||void 0===e)return this.state.thumbnail="",void this.setState(this.state);var t="https://img.youtube.com/vi/"+e+"/1.jpg",n=this.state;n.thumbnail=t,this.setState(n)}},{key:"onClickTag",value:function(e){e===this.props.selectedSampleTag?this.props.setSelectedSampleTag(this.props.sample.getId(),void 0):this.props.setSelectedSampleTag(this.props.sample.getId(),e)}},{key:"onImgError",value:function(){this.setState({thumbnail:""})}},{key:"getTags",value:function(){return void 0!==this.props.selectedSampleTag?[this.props.selectedSampleTag]:this.props.isCompactMode&&this.props.sample.tags.length>0?[this.props.sample.tags[0]]:this.props.sample.tags}},{key:"truncateName",value:function(e){if(void 0===e||null===e)return null;var t=this.props.isCompactMode?14:Ek;return(e.length>t?e.substring(0,t)+"...":e).trim()}},{key:"onDragOver",value:function(e){e.stopPropagation()}},{key:"onDragStart",value:function(e){this.props.setSampleDragging(this.props.sample)}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(e),this.props.setContextualHelp(t)}},{key:"render",value:function(){var e=this,t=this.props.isBig?"big ":"";this.props.isCompactMode&&(t+=" compact ");var n={};if(""===this.state.thumbnail)if(this.props.track)n={backgroundColor:bk.getColorForTrack(this.props.track)};else{var r=void 0!==this.props.sample.getId()?this.props.sample.getId():void 0!==this.props.name?this.props.name:"other instrument";n={backgroundColor:bk.saturate(bk.getColorForHash(r),3)}}var i=this.props.contextualHelp||"TRACK_THUMBNAIL";return a.a.createElement("div",{className:"youtube-info"},a.a.createElement("div",null,this.props.showDelete?a.a.createElement("div",{className:"delete-button delete-track-button",onClick:this.props.onClickDelete},"x"):"",""===this.state.thumbnail?a.a.createElement("div",{draggable:!0,onDragStart:function(t){return e.onDragStart(t)},onDragOver:function(t){return e.onDragOver(t)},onMouseOver:function(t){return e.setContextualHelp(t,i)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:t+"sound-thumbnail",style:n,onClick:this.props.onClickThumbnail},a.a.createElement(v.a,{className:"track-loading-spinner",sizeUnit:"px",size:10,color:"#123abc",loading:this.props.isLoading})):a.a.createElement("img",{draggable:!0,onDragStart:function(t){return e.onDragStart(t)},onDragOver:function(t){return e.onDragOver(t)},onMouseOver:function(t){return e.setContextualHelp(t,i)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onError:function(){return e.onImgError()},className:this.props.isMuted?t+"muted youtube-thumbnail":t+"youtube-thumbnail",onClick:this.props.onClickThumbnail,src:this.state.thumbnail})),a.a.createElement(Wc,{condition:!this.props.hideName},a.a.createElement("div",{className:"youtube-name"},a.a.createElement("span",{onClick:this.props.onClickName},this.truncateName(this.state.name)))),this.props.children)}}]),n}(r.Component);var Ek=36,Ok=Object(g.b)(function(e,t){var n=e.tracks.selectedSampleTags[t.sample.getId()],r=t.track;return r&&r.tracks&&r.tracks[0]&&(r=r.tracks[0].track),{id:void 0===r?0:void 0!==r.sample&&void 0!==r.sample.getId()?r.sample.getId():r.presetName||r.getName(),selectedSampleTag:n,isCompactMode:e.sequencer.isCompactMode&&!t.isBig,isLoading:void 0!==t.track&&!!e.tracks.trackIsLoading[t.track.subSequence.id]&&!0===e.tracks.trackIsLoading[t.track.subSequence.id][t.track.trackNumber]}},function(e,t){return{setSelectedSampleTag:function(t,n){return e(Object(O.Ic)(t,n))},setContextualHelp:function(t){return e(Object(O.U)(t))},setSampleDragging:function(t){return e(Object(O.wc)(t))}}})(kk);n(334),n(2288);function Sk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Pk=function(e){Object(u.a)(n,e);var t=Sk(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={name:void 0,soundId:e.soundId,selections:[],favorited:!1,density:void 0,tags:[],videoId:"",slices:[],waveforms:0,dropdownOpen:!1,showDMCAModal:!1,guildName:void 0},r.selectedSlices=[],r.slices={},r.originalSoundId=r.state.soundId,r.handleLoadBuffer.bind(Object(W.a)(r)),r.undoCropStack=[],r.undoCropIdStack=[],void 0!==r.props.sample?(r.audioUnit=r.props.audioUnit,r.loadSample(r.props.sample),r.state.slices=r.props.chordSlices):(r.sample=new Dn.a(void 0!==e.soundId?e.soundId:e.soundHash),r.state.videoId=r.props.videoId,r.state.name=r.props.name,r.audioUnit.loadRawBuffer(r.props.buffer),r.state.buffer=r.props.buffer,r.state.waveforms++,r.setState(r.state)),r}return Object(c.a)(n,[{key:"exploreSample",value:function(){this.props.setSampleToExplore(this.sample)}},{key:"toggleDropdown",value:function(){this.setState({dropdownOpen:!this.state.dropdownOpen})}},{key:"loadFavorites",value:function(){var e=Object(R.a)(N.a.mark(function e(t){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.getFavoritesForSound(t);case 2:e.sent.userFavorited>0?this.setState({favorited:!0}):this.setState({favorited:!1});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadChords",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(t=this.props.sequencerEngine.store.getState().selector.chordSelected)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.sample.fetchNoteSequence();case 5:if(void 0!==(n=e.sent)){e.next=8;break}return e.abrupt("return");case 8:r=(new cn.a).getChordsFromSequence(n,t),this.state.slices=r,this.setState(this.state.slices);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onConvolver",value:function(){this.props.setShowConvolverModal(!0,this.sample.ipfsHash)}},{key:"onClickFavorite",value:function(){this.state.favorited?(d.a.unfavoriteSound(this.sample.ipfsHash),this.setState({favorited:!1})):(d.a.favoriteSound(this.sample.ipfsHash),this.setState({favorited:!0}))}},{key:"shouldComponentUpdate",value:function(e){return e.audioUnit!==this.audioUnit&&(e.sample.getId()!==this.sample.getId()&&this.audioUnit&&this.audioUnit.dispose(),this.audioUnit=e.audioUnit,this.loadSample(e.sample)),(e.soundId!=this.state.soundId&&e.soundId!=this.originalSoundId||e.sample.ipfsHash!==this.state.ipfsHash)&&(this.state.soundId=e.soundId,this.state.slices=this.props.chordSlices),!0}},{key:"onChooseSlice",value:function(e){this.selectedSlices=[e]}},{key:"onSelectSlice",value:function(e){if(void 0!==e){var t=this.selectedSlices.indexOf(e);t>-1?this.selectedSlices.splice(t,1):this.selectedSlices.push(e)}else this.selectedSlices=[]}},{key:"loadSample",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t.ipfsHash){e.next=2;break}return e.abrupt("return");case 2:if(this.sample&&this.sample!==t&&this.sample.dispose(),this.sample=t,this.state.ipfsHash=t.ipfsHash,void 0!==t.tags&&(this.state.tags=t.tags),this.state.videoId=t.videoId,this.setState(this.state),void 0===this.state.videoId&&(this.state.name=t.name,this.setState({name:t.name})),this.handleLoadBuffer(this,t.audioBuffer),this.loadFavorites(t.ipfsHash),this.loadChords(),0!==this.sample.guildId&&void 0!==this.sample.guildId){e.next=16;break}this.setState({guildName:void 0}),e.next=20;break;case 16:return e.next=18,d.a.guilds.getGuildName(this.sample.guildId);case 18:n=e.sent,this.setState({guildName:n});case 20:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"handleLoadBuffer",value:function(e,t){var n=e.state;n.buffer=t,e.setState(n)}},{key:"onClickSelection",value:function(e,t){this.undoCropStack.push(t),this.undoCropIdStack.push(this.state.soundId),this.state.soundId=e,this.state.waveforms+=2,this.setState(this.state)}},{key:"sequence",value:function(){this.props.history.push("/create/"+this.state.soundId)}},{key:"onHoverSlice",value:function(e){this.setState({density:e.density})}},{key:"addSample",value:function(){void 0!==this.sample.audioBuffer&&(document.activeElement.blur(),this.props.onAddSample(this.sample,this.selectedSlices))}},{key:"onLayer",value:function(){void 0!==this.sample.audioBuffer&&this.props.onLayerSample(this.sample)}},{key:"onAudition",value:function(){void 0!==this.sample.audioBuffer&&this.props.onAudition(this.sample)}},{key:"onDownvote",value:function(){d.a.unfavoriteSound(this.sample.ipfsHash)}},{key:"similarSounds",value:function(){var e=this.sample.getId();this.props.setSimilarSoundsToFind(e),window.dispatchEvent(new Event("SIMILAR_SOUNDS"))}},{key:"formatTag",value:function(e){return e.length>20&&(e=e.slice(0,20)),e}},{key:"componentWillUnmount",value:function(){this.audioUnit&&this.audioUnit.dispose(),this.sample&&this.sample.dispose()}},{key:"dmcaTakeDown",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.setState({showDMCAModal:e})}},{key:"render",value:function(){var e=this,t="sound-row";return this.props.auditioning&&(t+=" auditioning"),this.props.i%2===0&&(t+=" odd"),a.a.createElement("div",{className:t},a.a.createElement(gk,{hide:function(){return e.dmcaTakeDown(!1)},show:this.state.showDMCAModal,sampleHash:this.sample.getId()}),a.a.createElement("a",{name:"sample-"+this.sample.ipfsHash}),a.a.createElement("div",{className:this.props.i%2==0?"playlist-row":"playlist-row odd"},a.a.createElement("div",{className:"sound-and-tags"},a.a.createElement(Wc,{condition:void 0!==this.audioUnit},a.a.createElement(dk,{selections:this.state.selections,buffer:void 0===this.audioUnit?void 0:this.audioUnit.buffer,audioUnit:this.audioUnit,sample:this.props.sample,slices:this.state.slices,onChooseSlice:function(t){return e.onChooseSlice(t)},onHoverSlice:function(t){return e.onHoverSlice(t)},sequencerEngine:this.props.sequencerEngine,onSelectSlice:function(t){return e.onSelectSlice(t)},waveformId:this.state.waveforms})),a.a.createElement(Wc,{condition:void 0===this.audioUnit},a.a.createElement("div",{className:"downloading-sample"},"Downloading sample...")),a.a.createElement("div",{className:"sample-tags"},a.a.createElement("div",{className:"tags-sound-wrapper"},a.a.createElement("div",{className:"sample-name"},a.a.createElement("span",{className:"name-text"},function(e){if(void 0===e||null===e)return null;return(e.length>36?e.substring(0,36)+"...":e).trim()}(this.props.sample.name)),a.a.createElement(Wc,{condition:this.state.guildName},a.a.createElement("span",{className:"name-text guild-name-text"},this.state.guildName))),void 0!==this.props.sample.tags?this.props.sample.tags.map(function(t){return a.a.createElement(Ac.a,{color:"light"},e.formatTag(t))}):"")),a.a.createElement("div",{className:"clear-fix"})),a.a.createElement("div",{className:"youtube-info"},a.a.createElement(Ok,{contextualHelp:"ADD_SOUND_BUTTON",hideName:this.props.hideName,onClickThumbnail:function(){return e.addSample()},isBig:!0,isSelector:!0,name:this.sample.name,isMuted:!1,sample:this.sample,onNewSound:this.props.onNewSound}),a.a.createElement("div",{className:"sound-buttons"},a.a.createElement("div",{className:"preset-dropdown"},a.a.createElement(Ac.c,{size:"sm",show:this.state.dropdownOpen,isOpen:this.state.dropdownOpen,toggle:function(){return e.toggleDropdown()}},a.a.createElement(Ac.b,{onClick:function(){return e.addSample()},id:"caret",color:"secondary"},a.a.createElement("span",{className:"medium"},"+")),a.a.createElement(Ac.f,{size:"sm",caret:!0,color:"secondary"}),a.a.createElement(Ac.e,null,a.a.createElement(Ac.d,{onMouseOver:function(){return e.props.setContextualHelp("ADD_SOUND_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){e.addSample()},size:"sm"},"ADD SOUND"),a.a.createElement(Ac.d,{onMouseOver:function(){return e.props.setContextualHelp("AUDITION_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onAudition()},size:"sm"},"AUDITION"),a.a.createElement(Ac.d,{onMouseOver:function(){return e.props.setContextualHelp("CONVOLVER_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onConvolver()},size:"sm"},"CONVOLVER")))),a.a.createElement("div",{onClick:function(){return e.onClickFavorite()},className:this.state.favorited?"result-heart heart favorited":"result-heart heart"})))))}},{key:"save",value:function(){var e=new FormData,t=this,n=new Worker("/recorderWorker.js");n.postMessage({command:"init",config:{sampleRate:x.a.context.sampleRate,numChannels:t.audioUnit.buffer.numberOfChannels}});var r="/saveCropped/"+("cropped at "+new Date)+"/"+t.state.soundId+"/"+t.state.selection.start+"/"+t.state.selection.end;n.onmessage=function(n){var a=n.data;e.append("body",a),f()({method:"POST",url:r,data:a,headers:{"Content-Type":"application/octet-stream"}}).then(function(e){t.undoCropIdStack.push(t.state.soundId),t.state.soundId=e.data.soundId,t.props.onSoundIdChange(e.data.soundId)})};var a=[t.audioUnit.buffer.getChannelData(0)];2==t.audioUnit.buffer.numberOfChannels&&a.push(t.audioUnit.buffer.getChannelData(1)),n.postMessage({command:"record",buffer:a}),n.postMessage({command:"exportWAV",type:"audio/wav"})}}]),n}(r.Component);r.Component;Object(g.b)(null,function(e){return{setShowConvolverModal:function(t,n){return e(Object(O.Uc)(t,n))},setContextualHelp:function(t){return e(Object(O.U)(t))},setShowSamples2D:function(t){return e(Object(O.ed)(t))},setSimilarSoundsToFind:function(t){return e(Object(O.nd)(t))},setSampleToExplore:function(t){return e(Object(O.yc)(t))}}})(Pk);var wk=function(){function e(t){Object(o.a)(this,e),this.type=t}return Object(c.a)(e,[{key:"execute",value:function(e){}}]),e}();function jk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Tk=function(e){Object(u.a)(n,e);var t=jk(n);function n(e,r){var a;return Object(o.a)(this,n),(a=t.call(this,Fb)).sequencerEngine=e,a.resolution=r,a}return Object(c.a)(n,[{key:"execute",value:function(e){var t=this,n=xk.filter(function(e){return e.isTriplet===t.resolution.isTriplet}),r=127/n.length,a=Math.floor(e/r);a>=n.length&&(a=n.length-1);var i=n[a];this.sequencerEngine.resolution.equals(i)||(this.sequencerEngine.resolution=i)}}]),n}(wk),xk=[new Xe(4,!1),new Xe(4,!0),new Xe(8,!1),new Xe(8,!0),new Xe(16,!1),new Xe(16,!0),new Xe(32,!1),new Xe(32,!0)],Ck=Tk,Nk=function(){function e(){Object(o.a)(this,e),this.parameterLocks=[]}return Object(c.a)(e,[{key:"addParameterLock",value:function(e,t,n,r,a){this.parameterLocks.push(new Rk(e,t,n,r,a))}},{key:"deleteParameterLock",value:function(e){var t=this.parameterLocks.indexOf(e);t>-1&&this.parameterLocks.splice(t,1)}},{key:"fromJson",value:function(e,t){for(var n in e){var r=e[n],a=void 0===r.effectNumber?this.getTrackParameterFromJson(r,t):this.getEffectParameterFromJson(r,t);void 0!==a&&this.parameterLocks.push(new Rk(r.trackNumber,r.groupNumber,r.sendNumber,r.effectNumber,a))}}},{key:"getTrackParameterFromJson",value:function(e,t){var n=e.trackNumber;if(void 0!==n){var r=t.tracks[n].trackData,a=e.parameter.name,i=r.parameters.filter(function(e){return e.name===a});if(!(i.length<1)){var s=i[0];return s.min=e.parameter.min,s.max=e.parameter.max,s}}}},{key:"getEffectParameterFromJson",value:function(e,t){var n=void 0;if(void 0!==e.trackNumber)n=t.tracks[e.trackNumber].effects[e.effectNumber];else if(void 0!==e.groupNumber){var r=t.groups.groups[e.groupNumber];if(void 0===r)return;n=r.effects[e.effectNumber]}else if(void 0!==e.sendNumber){n=t.sends.sends[e.sendNumber].effects[e.effectNumber]}if(void 0!==n){var a=e.parameter.name,i=n.parameters.filter(function(e){return e.name===a});if(!(i.length<1)){var s=i[0];return s.min=e.parameter.min,s.max=e.parameter.max,s}}}},{key:"getJson",value:function(){return this.parameterLocks.map(function(e){return e.getJson()})}}]),e}(),Rk=function(){function e(t,n,r,a,i){Object(o.a)(this,e),this.trackNumber=t,this.sendNumber=r,this.groupNumber=n,this.effectNumber=a,this.parameter=i}return Object(c.a)(e,[{key:"getJson",value:function(){var e={parameter:this.parameter.getJson(),effectNumber:this.effectNumber};return void 0!==this.trackNumber&&(e.trackNumber=this.trackNumber),void 0!==this.groupNumber&&(e.groupNumber=this.groupNumber),void 0!==this.sendNumber&&(e.sendNumber=this.sendNumber),e}}]),e}(),Dk=Nk;new _(0);function qk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Mk=function(e){Object(u.a)(n,e);var t=qk(n);function n(e,r,a,i,s,c){var u;return Object(o.a)(this,n),(u=t.call(this,e,r,a,i,s,c)).audioInputChannel=void 0,u.isRecording=!1,u.soundUploader=new zi.a(1,function(e,t,n){return u.onSoundUploaded(t,n)}),u}return Object(c.a)(n,[{key:"isRecordable",value:function(){return!0}},{key:"onSoundUploaded",value:function(e,t){this.soundIds.splice(this.soundIds.indexOf(t),1);var n=this.samplers[t];delete this.samplers[t],this.samplers[e]=n;var r=this.pattern.loopsPlaying[t];delete this.pattern.loopsPlaying[t],this.pattern.loopsPlaying[e]=r,this.soundIds.push(e),new Dn.a(e).name="Recording "+this.getName()}},{key:"setAudioInputManager",value:function(e){this.audioInputManager=e}},{key:"setAudioInput",value:function(e){console.log("setting audio input to channel = "+e),void 0!==this.audioInputChannel&&this.disconnectAudioInput(this.audioInputChannel),this.audioInputChannel=e,void 0!==e?(console.log("channel was not undefined so connecting"),console.log("gain node"),console.log(this.gainNode),console.log(e),this.audioInputManager.connect(this.gainNode,e),this.recorder=this.audioInputManager.getRecorder()):this.disconnectAudioInput(this.audioInputChannel)}},{key:"disconnectAudioInput",value:function(e){console.log("disconnecting channel = "+e),this.audioInputManager.disconnect(this.gainNode,e),this.audioInputChannel=void 0}},{key:"isAudioInputChannelConnected",value:function(e){return this.audioInputChannel===e}},{key:"recording",value:function(e){this.isRecording=e}},{key:"startRecording",value:function(e){if(void 0!==this.recorder){var t=this,n=Gi(e);setTimeout(function(){t.recorder.record()},n+0)}}},{key:"stopRecording",value:function(e){if(void 0!==this.recorder){var t=this;setTimeout(function(){t.recorder.stop(),t.recorder.getBuffer(function(e){return t.saveBuffer(e)})},Gi(e)+10)}}},{key:"saveBuffer",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r,a,i,s,o,c,u,l,p=this;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,r={slices:void 0,offset:0,transpose:0,volume:4},a=t[0].length,(i=x.a.Master.context.createBuffer(2,a,x.a.Master.context.sampleRate)).copyToChannel(t[0],0,0),i.copyToChannel(t[0],1,0),s=[{startTime:0,endTime:i.duration}],o=new Dn.a,this.sample=o,o.isResampled=!0,o.tags=["Recorded"],o.name="Recorded",o.audioBuffer=i,(c=new zo(this,o,function(e){return p.onNewRecordedSampler(n,e)},s,r)).init(),u=n.soundIds.length,this.samplers[u]=c,this.soundIds.push(u),this.pattern.loopsPlaying[u]=!0,this.recorder.clear(),e.next=22,this.soundUploader.uploadBufferToIpfs(t,!0,u);case 22:l=e.sent,o.ipfsHash=l,this.sequencerEngine.newRecordingToSaveLater(o);case 25:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onNewRecordedSampler",value:function(e,t){t.gainNode.connect(this.gainNode),e.switchToPattern(e.currentPattern),e.setVolume(e.getVolume()),e.setPanning(e.getPanning())}}]),n}(Zb);function Ak(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ik=new x.a.Time("16n"),Lk=function(e){Object(u.a)(n,e);var t=Ak(n);function n(e,r,a,i,s,c,u){var l;return Object(o.a)(this,n),(l=t.call(this,e,r,a,i,s,c)).midiOutputs=new Set,l.midiEngine=void 0,l.isRecordingMidi=!1,l.isEnabled=!1,l.recordedTriggers={},void 0!=u&&u||l.setupEffects(),l.audioInputManager=void 0,l.midiChannel=void 0,l.gated=!0,l.latency=0,l}return Object(c.a)(n,[{key:"getInstrumentType",value:function(){return"EXTERNAL_INSTRUMENT"}},{key:"getName",value:function(){return"External Instrument"}},{key:"getCopy",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getCopy",this).call(this,function(e,t,r,a,i,s){return new n(e,t,r,a,i,s)});return e.setMidiEngine(this.midiEngine),e.midiChannel=this.middieChannel,e.sequencerEngine=this.sequencerEngine,e.midiOutputs=new Set(this.midiOutputs),e.latency=this.latency,e}},{key:"getSoundUploader",value:function(){return this.soundUploader}},{key:"setAudioSettings",value:function(e){this.audioSettings=e}},{key:"setSequencerEngine",value:function(e){this.sequencerEngine=e}},{key:"recording",value:function(e){this.isRecordingMidi=e}},{key:"toggleRecording",value:function(e){this.pattern.loopsPlaying[e]=!this.pattern.loopsPlaying[e]}},{key:"isRecordingPlaying",value:function(e){return this.pattern.loopsPlaying[e]}},{key:"getRecordings",value:function(){return this.getSamplers()}},{key:"deleteMidiOutput",value:function(e){this.midiOutputs.has(e)&&this.midiOutputs.delete(e)}},{key:"addMidiOutput",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.name in ei&&!t&&this.addMidiInterfaceEffect(e,ei[e.name]),this.midiOutputs.add(e)}},{key:"addMidiInterfaceEffect",value:function(e,t){if(!this.midiEffects.effects.filter(function(e){return"Midi Interface"===e.name})[0]){var n=new ri(this);n.setConfig(e,t),this.midiEffects.addEffect(n),this.sequencerEngine.update()}}},{key:"setAudioInputManager",value:function(e){this.audioInputManager=e}},{key:"onLoadTrackUrl",value:function(e,t,r){return Object(q.a)(Object(p.a)(n.prototype),"onLoadTrackUrl",this).call(this,e,t,r)}},{key:"disconnect",value:function(){void 0!==this.audioChannel&&this.audioInputManager.disconnect(this.gainNode,this.audioChannel),this.audioChannel=void 0}},{key:"getMidiOutputs",value:function(){return this.midiOutputs}},{key:"setMidiEngine",value:function(e){this.midiEngine=e;var t=this;setTimeout(function(){t.setupMidiInput()},1e3)}},{key:"inputNoteForStep",value:function(e,t){var n=_i.a.fromString(t).getTranspose();this.getStepsAtResolution(this.sequencerEngine.resolution)[e].transpose=n,this.syncBuckets(this.sequencerEngine.resolution),this.update()}},{key:"triggerMidiNoteOn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.onNoteOn(void 0,_i.a.fromTranspose(e).toString(),t)}},{key:"onNoteOn",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;void 0!==this.sequencerEngine.cursor.step&&this.sequencerEngine.cursor.show&&this.inputNoteForStep(this.sequencerEngine.cursor.getStep(this.sequencerEngine.resolution),t),this.isEnabled&&(this.midiOutputs.size>0&&!this.arpManager.enabled&&this.midiOutputs.forEach(function(e){return n.midiEngine.playNoteSimple(e,t,n.midiChannel,0,0,r)}),this.isRecordingMidi)}},{key:"triggerMidiNoteOff",value:function(e){this.onNoteOff(void 0,_i.a.fromTranspose(e).toString())}},{key:"onNoteOff",value:function(e,t){var n=this;this.midiOutputs.size>0&&this.midiOutputs.forEach(function(e){return n.midiEngine.releaseNoteSimple(e,t,n.midiChannel,0)}),this.isRecordingMidi&&this.recordedTriggers}},{key:"setupMidiInput",value:function(){}},{key:"getTrackType",value:function(){return zr.d}},{key:"liveTrigger",value:function(e){this.triggerMidiNoteOn(e.transpose)}},{key:"liveTriggerRelease",value:function(e){this.triggerMidiNoteOff(e)}},{key:"trigger",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r,a,i,s,o,c,u,l,p=this;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n-=this.latency/1e3,r=t.transpose,a=new x.a.Time(new x.a.Time(t.duration)*Ik),Gi(n),i=t.release/16,s=t.chop,o=(null==a?Ik:a)/s,c=n,u=t.velocity,u*=1-t.start,l=0;l<s;l++)this.midiOutputs.forEach(function(e){return p.midiEngine.playNote(e,p.midiChannel,r,Gi(c),a.toMilliseconds(),i,u)}),c+=o;case 12:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"expandRecordedTracks",value:function(){var e=this,t=Object.keys(this.pattern.loopsPlaying).filter(function(t){return e.pattern.loopsPlaying[t]});console.log("loops playing = "),console.log(t),console.log(this.samplers),t.forEach(function(t){return e.sequencerEngine.addSound(t,void 0,void 0,void 0,!0)})}},{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{latency:this.latency})}},{key:"fromJson",value:function(e){e.latency&&(this.latency=e.latency)}}]),n}(Mk),Fk=new x.a.Time("16n"),Bk=new x.a.Time("16n"),Hk=function(){function e(){Object(o.a)(this,e),this.offset=0,this.parameters=[]}return Object(c.a)(e,[{key:"registerParameter",value:function(e,t){var n=this.context.forInstrument(this);e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(n),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getSubDevices",value:function(){return[]}},{key:"getSubDeviceIndex",value:function(e){return this.getSubDevices().map(function(e){return e.value}).indexOf(e)}},{key:"getSubDevice",value:function(e){return this.getSubDevices().map(function(e){return e.value})[e]}},{key:"getName",value:function(){return""}},{key:"connect",value:function(e){void 0!==e&&(this.getInstrument().connect(e),this.node=e)}},{key:"disconnect",value:function(e){this.getInstrument().disconnect(e),this.node=void 0}},{key:"dispose",value:function(){this.disconnect(),this.parameters.forEach(function(e){return e.dispose()})}},{key:"isMonophonic",value:function(){return!1}},{key:"getEnvelope",value:function(){}},{key:"getInstrument",value:function(){}},{key:"getInstrumentType",value:function(){}},{key:"releaseAll",value:function(){}},{key:"getJson",value:function(){return{instrumentType:this.getInstrumentType()}}},{key:"hasLFO",value:function(){return!1}},{key:"release",value:function(e){e=void 0!==e?e:this.lastNote,this.isMonophonic()&&this.lastNote!==e||void 0!==this.lastNote&&this.getInstrument().triggerRelease([e])}},{key:"trigger",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n=e.start,r=null;null==e.duration||(r="number"===typeof e.duration?Fk*e.duration:new x.a.Time(e.duration));var a=this.getNoteFromTranspose(e.transpose),i=null===e.velocity?1:e.velocity,s=null==e.chop?1:e.chop,o=(null==r?Fk:r)/s.toString();t=t||void 0,this.offset>0&&(void 0===t&&(t=x.a.Master.context.currentTime),t=Bk*this.offset+t);var c=new x.a.Time(t);this.setEnvelopes(e);for(var u=this.getInstrument(),l=!this.track||this.track.gated,p=0;p<s;p++)this.lastNote=a,null!==r&&l?u.triggerAttackRelease(a,r,c,i,n):u.triggerAttack(a,c,i,n),c+=o}},{key:"hasNotes",value:function(){return!0}},{key:"setEnvelopes",value:function(e){var t=this.getEnvelopes();t.forEach(function(t){return t.attack=new x.a.Time((1+e.attack)/1e3)}),t.forEach(function(t){return t.release=new x.a.Time((1+e.release)/1e3)})}},{key:"getNoteFromTranspose",value:function(e){return e+this.sequencerEngine.transpose}},{key:"getDefaultNote",value:function(){return x.a.Frequency("C3")}},{key:"getParameters",value:function(){return this.parameters}},{key:"getEnvelopes",value:function(){return[]}},{key:"findParameter",value:function(e,t){var n=this.getParameters().filter(function(e){return t===e.name});return 0===n.length?0:n[0]}},{key:"name",get:function(){return this.getName()}}]),e}(),Vk=function(){function e(t,n,r,a){Object(o.a)(this,e),this.synth=t,this.store=n,this.mixSession=r,this.context=a,this.parameters=[],this.setupParameters()}return Object(c.a)(e,[{key:"onNewSynth",value:function(e){this.synth=e,this.refreshParameters()}},{key:"refreshParameters",value:function(){this.baseFrequency=this.baseFrequency,this.octaves=this.octaves,this.attack=this.attack,this.decay=this.decay,this.sustain=this.sustain,this.release=this.release}},{key:"setupParameters",value:function(){this.attackParameter=new Be("Filter Envelope Attack",this,function(e,t){return e.synth.set({filterEnvelope:{attack:t/1e3}})},{min:0,max:1e4,unit:"ms",defaultValue:60}),this.registerParameter(this.attackParameter),this.decayParameter=new Be("Filter Envelope Decay",this,function(e,t){return e.synth.set({filterEnvelope:{decay:t/1e3}})},{min:0,max:1,unit:"ms",defaultValue:60}),this.registerParameter(this.decayParameter),this.sustainParameter=new Be("Filter Envelope Sustain",this,function(e,t){return e.synth.set({filterEnvelope:{sustain:t}})},{min:0,max:1,unit:"",defaultValue:.9}),this.registerParameter(this.sustainParameter),this.releaseParameter=new Be("Filter Envelope Release",this,function(e,t){return e.synth.set({filterEnvelope:{release:t/1e3}})},{min:0,max:1,unit:"ms",defaultValue:60}),this.registerParameter(this.releaseParameter),this.baseFrequencyParameter=new He("Filter Envelope Base Frequency",this,function(e,t){return e.synth.set({filterEnvelope:{baseFrequency:t}})},{min:0,max:1e4,unit:"HZ",defaultValue:100}),this.registerParameter(this.baseFrequencyParameter),this.octavesParameter=new He("Filter Envelope Octaves",this,function(e,t){return e.synth.set({filterEnvelope:{octaves:t}})},{min:0,max:10,unit:"",defaultValue:1}),this.registerParameter(this.octavesParameter)}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),this.parameters.push(e)}},{key:"copyFrom",value:function(e){this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.baseFrequency=e.baseFrequency,this.octaves=e.octaves}},{key:"getJson",value:function(){return{baseFrequency:this.baseFrequency,octaves:this.octaves,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release}}},{key:"fromJson",value:function(e){"baseFrequency"in e&&(this.baseFrequency=e.baseFrequency),"octaves"in e&&(this.octaves=e.octaves),"attack"in e&&(this.attack=e.attack),"decay"in e&&(this.decay=e.decay),"sustain"in e&&(this.sustain=e.sustain),"releease"in e&&(this.release=e.release)}},{key:"attack",get:function(){return this.attackParameter.get()},set:function(e){this.attackParameter.set(e)}},{key:"decay",get:function(){return this.decayParameter.get()},set:function(e){this.decayParameter.set(e)}},{key:"sustain",get:function(){return this.sustainParameter.get()},set:function(e){this.sustainParameter.set(e)}},{key:"release",get:function(){return this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e)}},{key:"baseFrequency",get:function(){return this.baseFrequencyParameter.get()},set:function(e){this.baseFrequencyParameter.set(e)}},{key:"octaves",get:function(){return this.octavesParameter.get()},set:function(e){this.octavesParameter.set(e)}}]),e}();function Uk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Jk=function(e){Object(u.a)(n,e);var t=Uk(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this)).sequencerEngine=e,i.store=e.store,i.mixSession=r,i.context=a,i.synth=new x.a.PolySynth(1,x.a.MonoSynth),i.synth.volume.value=-4,i.lfos=[i.createLFO(),i.createLFO(),i.createLFO(),i.createLFO()],i.filterEnvelope=new Vk(i.synth,i.store,r,a),i.polyphonySet=!1,i.parameters=[],i.parameterToSignal={},i.parameterToLFOs={},i.setupParameters(),i.lfos.forEach(function(e){return e.start()}),i.refreshParameters(),i.node=void 0,i}return Object(c.a)(n,[{key:"getName",value:function(){return"Synth"}},{key:"isMonophonic",value:function(){return 1===this.polyphony}},{key:"getInstrument",value:function(){return this}},{key:"getInstrumentType",value:function(){return op}},{key:"hasLFO",value:function(){return!0}},{key:"start",value:function(){this.lfos.forEach(function(e){return e.start()})}},{key:"stop",value:function(){this.lfos.forEach(function(e){return e.stop()})}},{key:"refreshParameters",value:function(){this.pulseWidth=this.pulseWidth,this.oscillatorType=this.oscillatorType,this.filterQ=this.filterQ,this.portamento=this.portamento,this.filterCutoff=this.filterCutoff}},{key:"createNewSynth",value:function(e){var t=this.node;this.disconnect(t),this.synth=new x.a.PolySynth(e,x.a.MonoSynth),this.filterEnvelope.onNewSynth(this.synth),this.connect(t),this.polyphonySet=!1,this.refreshParameters(),this.reconnectAllLFOParameters()}},{key:"triggerAttack",value:function(e,t,n){var r=this.getNoteFromTranspose(e);this.synth.triggerAttack(r,t,n)}},{key:"triggerAttackRelease",value:function(e,t,n,r){var a=this.getNoteFromTranspose(e);this.synth.triggerAttackRelease(a,t,n,r)}},{key:"triggerRelease",value:function(e){var t=this,n=e.map(function(e){return t.getNoteFromTranspose(e)});this.synth.triggerRelease(n)}},{key:"createLFO",value:function(){return new la(this.sequencerEngine,this.mixSession,this.context)}},{key:"setupParameters",value:function(e){var t=this;this.oscillatorTypeParameter=new Be("Oscillator Type",this,function(e,t){return e.synth.set({oscillator:{type:t}})},{min:0,max:1,unit:"",defaultValue:"triangle",automatable:!1}),this.registerParameter(this.oscillatorTypeParameter),this.oscillatorFrequencyParameter=new Be("Oscillator Frequency",this,function(e,t){return[]},{min:0,max:1,unit:"",defaultValue:0,automatable:!1}),this.registerParameter(this.oscillatorFrequencyParameter),this.pulseWidthParameter=new Be("Pulse Width",this,function(e,t){return e.synth.set({oscillator:{width:t}})},{min:0,max:1,unit:"",defaultValue:.1}),this.registerParameter(this.pulseWidthParameter,function(e){return e.oscillator.width}),this.filterCutoffParameter=new He("Filter Cutoff",this,function(e,t){e.synth.set({filter:{frequency:t}})},{min:0,max:1e4,unit:"HZ",defaultValue:1200}),this.registerParameter(this.filterCutoffParameter,function(e){return e.filter.frequency}),this.filterQParameter=new He("Filter Q",this,function(e,t){return e.synth.set({filter:{Q:t}})},{min:0,max:9,unit:"",defaultValue:1}),this.registerParameter(this.filterQParameter,function(e){return e.filter.Q}),this.portamentoParameter=new Be("Portamento",this,function(e,t){return e.synth.set({portamento:t/20})},{min:0,max:10,unit:"",defaultValue:0}),this.registerParameter(this.portamentoParameter),this.detuneParameter=new He("Detune",this,function(e,t){e.synth.set({detune:t})},{min:-100,max:100,unit:"",defaultValue:0,automatable:!1}),this.parameterToSignal[this.detuneParameter.name]=function(e){return e.oscillator.detune},this.registerParameter(this.detuneParameter),this.polyphonyParameter=new He("Polyphony",this,function(e,n){t.polyphonySet&&t.createNewSynth(n),t.polyphonySet=!0},{min:0,max:16,unit:"",defaultValue:1,automatable:!1}),this.registerParameter(this.polyphonyParameter),this.ampAttackParameter=new Be("Amp Attack",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:10}),this.registerParameter(this.ampAttackParameter),this.ampDecayParameter=new Be("Amp Decay",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:10}),this.registerParameter(this.ampDecayParameter),this.ampSustainParameter=new Be("Amp Sustain",this,function(e,t){return t},{min:0,max:1,unit:"",defaultValue:1}),this.registerParameter(this.ampSustainParameter),this.ampReleaseParameter=new Be("Amp Release",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:10}),this.registerParameter(this.ampReleaseParameter)}},{key:"registerParameter",value:function(e,t){void 0!==t&&(this.parameterToSignal[e.name]=t),e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getCopy",value:function(e){var t=this,r=new n(this.store,this.mixSession,e);for(var a in r.instrumentType=this.instrumentType,r.oscillatorFrequency=this.oscillatorFrequency,r.filterCutoff=this.filterCutoff,r.filterQ=this.filterQ,r.polyphony=this.polyphony,r.portamento=this.portamento,r.filterEnvelope.copyFrom(this.filterEnvelope),r.oscillatorType=this.oscillatorType,r.pulseWidth=this.pulseWidth,r.lfos)r.lfos[a].copyFrom(this.lfos[a]);r.parameterToLFOs={};var i=function(e){var n=t.parameterToLFOs[e],a=r.getParameterByName(e);n.forEach(function(e){var n=r.lfos[t.lfos.indexOf(e)];r.connectLFOToParameter(n,a)})};for(var s in this.parameterToLFOs)i(s);return r}},{key:"getParameters",value:function(){return[].concat(Object(M.a)(this.parameters),Object(M.a)(this.filterEnvelope.parameters))}},{key:"getJson",value:function(){var e={instrumentType:this.getInstrumentType(),oscillatorType:this.oscillatorType,oscillatorFrequency:this.oscillatorFrequency,filterCutoff:this.filterCutoff,filterQ:this.filterQ,polyphony:this.polyphony,portamento:this.portamento,pulseWidth:this.pulseWidth,lfos:this.lfos.map(function(e){return e.getJson()}),parameterToLFOs:this.getParameterToLFOsJson(),filterEnvelope:this.filterEnvelope.getJson(),ampAttack:this.ampAttack,ampDecay:this.ampDecay,ampSustain:this.ampSustain,ampRelease:this.ampRelease};return e=sr(e,"filterCutoffParameter",this.filterCutoffParameter),e=sr(e,"filterQParameter",this.filterQParameter),e=sr(e,"portamentoParameter",this.portamentoParameter),e=sr(e,"pulseWidthParameter",this.pulseWidthParameter),e=sr(e,"oscillatorFrequencyParameter",this.oscillatorFrequencyParameter),e=sr(e,"oscillatorTypeParameter",this.oscillatorTypeParameter),e=sr(e,"ampAttackParameter",this.ampAttackParameter),e=sr(e,"ampDecayParameter",this.ampDecayParameter),e=sr(e,"ampSustainParameter",this.ampSustainParameter),e=sr(e,"ampReleaseParameter",this.ampReleaseParameter)}},{key:"getParameterToLFOsJson",value:function(){var e=this,t={},n=function(n){var r=[];e.parameterToLFOs[n].forEach(function(t){return r.push(e.lfos.indexOf(t))}),t[n]=r};for(var r in this.parameterToLFOs)n(r);return t}},{key:"fromJson",value:function(e){if("instrumentType"in e&&(this.instrumentType=e.instrumentType),"polyphony"in e&&(this.polyphony=e.polyphony),"oscillatorFrequency"in e&&(this.oscillatorFrequency=e.oscillatorFrequency),"pulseWidth"in e&&(this.pulseWidth=e.pulseWidth),"oscillatorType"in e&&(this.oscillatorType=e.oscillatorType),"filterCutoff"in e&&(this.filterCutoff=e.filterCutoff),"filterQ"in e&&(this.filterQ=e.filterQ),"portamento"in e&&(this.portamento=e.portamento),"filterEnvelope"in e&&this.filterEnvelope.fromJson(e.filterEnvelope),"lfos"in e)for(var t in e.lfos)this.lfos[t].fromJson(e.lfos[t]);"parameterToLFOs"in e&&this.loadParameterToLFOsJson(e.parameterToLFOs),"ampAttack"in e&&(this.ampAttack=e.ampAttack),"ampDecay"in e&&(this.ampDecay=e.ampDecay),"ampSustain"in e&&(this.ampSustain=e.ampSustain),"ampRelease"in e&&(this.ampRelease=e.ampRelease),or(e,"filterCutoffParameter",this.filterCutoffParameter,this.sequencerEngine),or(e,"filterQParameter",this.filterQParameter,this.sequencerEngine),or(e,"portamentoParameter",this.portamentoParameter,this.sequencerEngine),or(e,"pulseWidthParameter",this.pulseWidthParameter,this.sequencerEngine),or(e,"oscillatorFrequencyParameter",this.oscillatorFrequencyParameter,this.sequencerEngine),or(e,"oscillatorTypeParameter",this.oscillatorTypeParameter,this.sequencerEngine),or(e,"ampAttackParameter",this.ampAttackParameter,this.sequencerEngine),or(e,"ampDecayParameter",this.ampDecayParameter,this.sequencerEngine),or(e,"ampSustainParameter",this.ampSustainParameter,this.sequencerEngine),or(e,"ampReleaseParameter",this.ampReleaseParameter,this.sequencerEngine)}},{key:"getParameterByName",value:function(e){var t=this.parameters.filter(function(t){return t.name===e});if(!(t.length<1))return t[0]}},{key:"loadParameterToLFOsJson",value:function(e){var t=this,n=function(n){var r=t.getParameterByName(n);if(void 0===r)return"continue";e[n].forEach(function(e){return t.connectLFOToParameter(t.lfos[e],r)})};for(var r in e)n(r)}},{key:"connectLFOToParameter",value:function(e,t){var n=this,r=!1;void 0!==this.parameterToSignal[t.name]&&(this.synth.voices.forEach(function(a,i){var s=n.parameterToSignal[t.name](a);void 0===s?r=!0:e.connect(s,t,i)}),r||(t.name in this.parameterToLFOs?this.parameterToLFOs[t.name].add(e):this.parameterToLFOs[t.name]=new Set([e]),this.refreshParameters()))}},{key:"disconnectLFOToParameter",value:function(e,t){var n=this;this.parameterToLFOs[t.name].has(e)&&(this.synth.voices.forEach(function(r,a){e.disconnect(n.parameterToSignal[t.name](r),t,a)}),this.parameterToLFOs[t.name].delete(e))}},{key:"isParameterConnectedToLFO",value:function(e,t){return e.name in this.parameterToLFOs&&this.parameterToLFOs[e.name].has(t)}},{key:"toggleParameterWithLFO",value:function(e,t){this.isParameterConnectedToLFO(e,t)?this.disconnectLFOToParameter(t,e):this.connectLFOToParameter(t,e)}},{key:"reconnectAllLFOParameters",value:function(){var e=this,t=function(t){var n=e.parameterToLFOs[t],r=e.getParameterByName(t);n.forEach(function(t){return e.connectLFOToParameter(t,r)})};for(var n in this.parameterToLFOs)t(n)}},{key:"onChangeToPulse",value:function(){var e=this;this.pulseWidthParameter.name in this.parameterToLFOs&&this.parameterToLFOs[this.pulseWidthParameter.name].forEach(function(t){return e.connectLFOToParameter(t,e.pulseWidthParameter,!0)})}},{key:"connect",value:function(e){void 0!==e&&(this.synth.connect(e),this.node=e)}},{key:"disconnect",value:function(e){this.synth.disconnect(e),this.node=void 0}},{key:"getEnvelopes",value:function(){return this.synth.voices.map(function(e){return e.envelope})}},{key:"releaseAll",value:function(){this.lastNote=void 0,this.synth.releaseAll()}},{key:"getNoteFromTranspose",value:function(e){return e+=this.sequencerEngine.transpose,this.getDefaultNote().transpose(e+this.oscillatorFrequency)}},{key:"setEnvelopes",value:function(e){var t=this,n=this.getEnvelopes();n.forEach(function(e){return e.attack=new x.a.Time((1+t.ampAttack)/1e3)}),n.forEach(function(e){return e.release=new x.a.Time((1+t.ampRelease)/1e3)}),n.forEach(function(e){return e.sustain=Math.min(.99,t.ampSustain)}),n.forEach(function(e){return e.decay=new x.a.Time((1+t.ampDecay)/1e3)})}},{key:"releaseAll",value:function(){this.synth.voices.forEach(function(e){return e.triggerRelease()})}},{key:"oscillatorType",get:function(){return this.oscillatorTypeParameter.get()},set:function(e){var t=this.oscillatorTypeParameter.get();this.oscillatorTypeParameter.set(e),"pulse"===e&&t!==e&&this.onChangeToPulse()}},{key:"oscillatorFrequency",get:function(){return this.oscillatorFrequencyParameter.get()},set:function(e){this.oscillatorFrequencyParameter.set(e)}},{key:"filterCutoff",get:function(){return this.filterCutoffParameter.get()},set:function(e){this.filterCutoffParameter.set(e)}},{key:"filterQ",get:function(){return this.filterQParameter.get()},set:function(e){this.filterQParameter.set(e)}},{key:"portamento",get:function(){return this.portamentoParameter.get()},set:function(e){this.portamentoParameter.set(e)}},{key:"polyphony",get:function(){return void 0===this.polyphonyParameter?8:this.polyphonyParameter.get()},set:function(e){this.polyphonyParameter.set(e)}},{key:"detune",get:function(){return this.detuneParameter.get()},set:function(e){this.detuneParameter.set(e)}},{key:"pulseWidth",get:function(){return this.pulseWidthParameter.get()},set:function(e){this.pulseWidthParameter.set(e)}},{key:"ampAttack",get:function(){return this.ampAttackParameter.get()},set:function(e){return this.ampAttackParameter.set(e)}},{key:"ampDecay",get:function(){return this.ampDecayParameter.get()},set:function(e){return this.ampDecayParameter.set(e)}},{key:"ampSustain",get:function(){return this.ampSustainParameter.get()},set:function(e){return this.ampSustainParameter.set(e)}},{key:"ampRelease",get:function(){return this.ampReleaseParameter.get()},set:function(e){return this.ampReleaseParameter.set(e)}}]),n}(Hk);function _k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Gk=function(e){Object(u.a)(n,e);var t=_k(n);function n(e,r,a,i,s,c){var u,l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return Object(o.a)(this,n),(u=t.call(this,e,r,a,i,s,c)).setupEffects(),u.instrument=void 0,l&&u.setInstrument(new Jk(r,a,(new Wr).forTrack(Object(W.a)(u)))),u}return Object(c.a)(n,[{key:"getInstrumentType",value:function(){return this.instrument.getInstrumentType()}},{key:"setIsEnabled",value:function(e){Object(q.a)(Object(p.a)(n.prototype),"setIsEnabled",this).call(this,e),e||this.getInstrument().releaseAll()}},{key:"makePublicIfNeeded",value:function(){}},{key:"dispose",value:function(){Object(q.a)(Object(p.a)(n.prototype),"dispose",this).call(this),this.instrument.dispose()}},{key:"getAllParameters",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getAllParameters",this).call(this),t=this.getInstrument().getParameters();return[].concat(Object(M.a)(e),Object(M.a)(t))}},{key:"getAllPatternLockedParameters",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getAllPatternLockedParameters",this).call(this),t=this.getInstrument().getParameters();return t=t.filter(function(e){return e.hasPatternLockedValues()}),e.concat(t)}},{key:"getCopy",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(q.a)(Object(p.a)(n.prototype),"getCopy",this).call(this,function(e,t,r,a,i,s){return new n(e,t,r,a,i,s)});case 2:return t=e.sent,e.next=5,this.instrument.getCopy((new Wr).forTrack(t));case 5:return r=e.sent,t.setInstrument(r),e.abrupt("return",t);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getName",value:function(){return void 0===this.instrument?"Instrument":this.instrument.getName()}},{key:"getTrackType",value:function(){return zr.b}},{key:"getInstrument",value:function(){return this.instrument}},{key:"setInstrument",value:function(e){void 0!==this.instrument&&this.instrument.disconnect(this.gainNode),this.instrument=e,void 0!==this.instrument&&this.instrument.connect(this.gainNode)}},{key:"liveTrigger",value:function(e){this.trigger(e,0,!0)}},{key:"liveTriggerRelease",value:function(e){this.triggerRelease(e)}},{key:"trigger",value:function(e,t,n){void 0!==this.instrument&&this.instrument.trigger(e,t)}},{key:"triggerRelease",value:function(e){void 0!==this.instrument&&this.instrument.release(e)}},{key:"getJson",value:function(){return Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{instrumentType:this.instrument.getInstrumentType(),instrument:this.instrument.getJson(),presetName:this.presetName})}},{key:"fromJson",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var r,a,i,s,o=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(o.length>1&&void 0!==o[1])||o[1],Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,t),r&&this.store.dispatch(Object(O.Ld)(this.subSequence.id,this.trackNumber,!0)),t.envelopes)for(a in t.envelopes)this.connectToEnvelope(this.sequencerEngine.envelopes[t.envelopes[a]]);if("envelopeConnections"in t)for(i in t.envelopeConnections)s=t.envelopeConnections[i],this.connectToEnvelope(this.subSequence.envelopes[s.envelope],s.mode);if(t.isFrozen){e.next=8;break}return e.next=8,this.instrument.fromJson(t.instrument);case 8:void 0!==t.presetName&&(this.presetName=t.presetName),r&&this.store.dispatch(Object(O.Ld)(this.subSequence.id,this.trackNumber,!1));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"unfreezeInstrument",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.frozenJson;this.instrument.fromJson(e.trackParameters.instrument)}}]),n}(Zb),zk=function(){function e(t,n,r,a,i,s){Object(o.a)(this,e),this.sequencerEngine=t,this.store=this.sequencerEngine.store,this.mixSession=n,this.context=r.getCopy().forSubDevice(this),this.envelope=new x.a.ScaledEnvelope,void 0!==a&&(this.audioNode=a,this.envelope.connect(a)),this.min=i,this.max=s,this.parameters=[],this.setupParameters(),this.savedFrequency=void 0}return Object(c.a)(e,[{key:"dispose",value:function(){this.envelope.dispose(),this.envelope=void 0}},{key:"connect",value:function(e){this.envelope.connect(e)}},{key:"disconnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.audioNode;this.envelope.disconnect(e)}},{key:"triggerAttack",value:function(e,t){this.envelope.triggerAttack(e,t)}},{key:"triggerAttackRelease",value:function(e,t,n){t=Math.max(t,0),this.envelope.triggerAttackRelease(e,t,n)}},{key:"triggerRelease",value:function(e){e=Math.max(e,0),this.envelope.triggerRelease(e)}},{key:"setupParameters",value:function(){var e=this;this.attackParameter=new Be("Attack",this.envelope,function(e,t){return e.attack=(t+1e-6)/1e3},{min:0,max:1e4,unit:"ms",defaultValue:80}),this.registerParameter(this.attackParameter),this.decayParameter=new Be("Decay",this.envelope,function(e,t){return e.decay=(t+1e-5)/1e3},{min:0,max:3e3,unit:"ms",defaultValue:500}),this.registerParameter(this.decayParameter),this.sustainParameter=new Be("Sustain",this.envelope,function(e,t){return e.sustain=Math.min(t,.999)},{min:0,max:1,unit:"",defaultValue:.8}),this.registerParameter(this.sustainParameter),this.releaseParameter=new Be("Release",this.envelope,function(e,t){return e.release=(t+1e-6)/1e3},{min:0,max:3e3,unit:"ms",defaultValue:100}),this.registerParameter(this.releaseParameter),this.attackCurveParameter=new Be("Attack Curve",this.envelope,function(e,t){e.attackCurve=t},{min:0,max:1e4,unit:"",defaultValue:"exponential",automatable:!1}),this.registerParameter(this.attackCurveParameter),this.decayCurveParameter=new Be("Decay Curve",this.envelope,function(e,t){return e.decayCurve=t},{min:0,max:1e4,unit:"",defaultValue:"exponential",automatable:!1}),this.registerParameter(this.decayCurveParameter),this.releaseCurveParameter=new Be("Release Curve",this.envelope,function(e,t){return e.releaseCurve=t},{min:0,max:1e4,unit:"",defaultValue:"exponential",automatable:!1}),this.registerParameter(this.releaseCurveParameter),this.levelParameter=new Be("Level",this,function(t,n){return e.frequency=e.savedFrequency||0},{min:-1,max:1,unit:"",defaultValue:0}),this.registerParameter(this.levelParameter)}},{key:"refresh",value:function(){this.attack=this.attack,this.decay=this.decay,this.level=this.level,this.release=this.release,this.sustain=this.sustain}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getJson",value:function(){var e={level:this.level,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release,attackCurve:this.attackCurve,decayCurve:this.decayCurve,releaseCurve:this.releaseCurve};return e=sr(e,"attackParameter",this.attackParameter),e=sr(e,"decayParameter",this.decayParameter),e=sr(e,"sustainParameter",this.sustainParameter),e=sr(e,"releaseParameter",this.releaseParameter),e=sr(e,"attackCurveParameter",this.attackCurveParameter),e=sr(e,"decayCurveParameter",this.decayCurveParameter),e=sr(e,"releaseCurveParameter",this.releaseCurveParameter),e=sr(e,"levelParameter",this.levelParameter)}},{key:"fromJson",value:function(e){this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.level=e.level,e.attackCurve&&(this.attackCurve=e.attackCurve),e.decayCurve&&(this.decayCurve=e.decayCurve),e.releaseCurve&&(this.releaseCurve=e.releaseCurve),or(e,"attackParameter",this.attackParameter,this.sequencerEngine),or(e,"decayParameter",this.decayParameter,this.sequencerEngine),or(e,"sustainParameter",this.sustainParameter,this.sequencerEngine),or(e,"releaseParameter",this.releaseParameter,this.sequencerEngine),or(e,"attackCurveParameter",this.attackCurveParameter,this.sequencerEngine),or(e,"decayCurveParameter",this.decayCurveParameter,this.sequencerEngine),or(e,"releaseCurveParameter",this.releaseCurveParameter,this.sequencerEngine),or(e,"levelParameter",this.levelParameter,this.sequencerEngine)}},{key:"refresh",value:function(){this.parameters.filter(function(e){return e.isConnectedToAnyLFO()}).forEach(function(e){return e.callSetter()})}},{key:"mateJson",value:function(e,t){this.mateParameter("attack",e,this.attackParameter,t),this.mateParameter("decay",e,this.decayParameter,t),this.mateParameter("sustain",e,this.sustainParameter,t),this.mateParameter("release",e,this.releaseParameter,t)}},{key:"mateParameter",value:function(e,t,n,r){ra(this.sequencerEngine,e,t,n,r)}},{key:"dispose",value:function(){this.envelope.dispose()}},{key:"frequency",set:function(e){this.savedFrequency=e;var t=void 0;t=this.level>0?void 0!==this.max?e+this.level*(this.max-e):e+this.level*e*2:void 0!==this.min&&this.min<0?-1*this.level*(this.min+e):this.level*e,this.envelope.min=2*e,this.envelope.max=t}},{key:"level",set:function(e){this.levelParameter.set(e)},get:function(){return void 0===this.levelParameter||void 0===this.levelParameter.get()?0:this.levelParameter.get()}},{key:"attack",get:function(){return this.attackParameter.get()},set:function(e){this.attackParameter.set(e)}},{key:"decay",get:function(){return this.decayParameter.get()},set:function(e){this.decayParameter.set(e)}},{key:"sustain",get:function(){return this.sustainParameter.get()},set:function(e){this.sustainParameter.set(e)}},{key:"release",get:function(){return this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e)}},{key:"attackCurve",get:function(){return this.attackCurveParameter.get()},set:function(e){this.attackCurveParameter.set(e)}},{key:"decayCurve",get:function(){return this.decayCurveParameter.get()},set:function(e){this.decayCurveParameter.set(e)}},{key:"releaseCurve",get:function(){return this.releaseCurveParameter.get()},set:function(e){this.releaseCurveParameter.set(e)}}]),e}(),Wk=function(){function e(t,n,r){Object(o.a)(this,e),this.sequencerEngine=t,this.store=t.store,this.mixSession=n,this.context=r.getCopy().forSubDevice(this),this.parameters=[],this.envelope=new zk(this.sequencerEngine,this.mixSession,this.context,void 0,-2e3,2e3),this.setupParameters()}return Object(c.a)(e,[{key:"setupParameters",value:function(){var e=this;this.attackParameter=new Be("Attack",this,function(t,n){return e.envelope.attack=n},{min:0,max:1e4,unit:"ms",defaultValue:1e3}),this.registerParameter(this.attackParameter),this.decayParameter=new Be("Decay",this,function(t,n){return e.envelope.decay=n},{min:0,max:1,unit:"ms",defaultValue:1e3}),this.registerParameter(this.decayParameter),this.sustainParameter=new Be("Sustain",this,function(t,n){return e.envelope.sustain=n},{min:0,max:1,unit:"",defaultValue:.5}),this.registerParameter(this.sustainParameter),this.releaseParameter=new Be("Release",this.envelope,function(t,n){return e.envelope.release=n},{min:0,max:1,unit:"ms",defaultValue:1e3}),this.registerParameter(this.releaseParameter),this.levelParameter=new Be("Level",this,function(t,n){return e.envelope.level=n},{min:-1,max:1,unit:"",defaultValue:0}),this.registerParameter(this.levelParameter),this.attackCurveParameter=new Be("Attack Curve",this.envelope,function(e,t){return e.attackCurve=t},{min:0,max:1e4,unit:"",defaultValue:"linear"}),this.registerParameter(this.attackCurveParameter),this.decayCurveParameter=new Be("Decay Curve",this.envelope,function(e,t){return e.decayCurve=t},{min:0,max:1e4,unit:"",defaultValue:"linear"}),this.registerParameter(this.decayCurveParameter),this.releaseCurveParameter=new Be("Release Curve",this.envelope,function(e,t){return e.releaseCurve=t},{min:0,max:1e4,unit:"",defaultValue:"exponential"}),this.registerParameter(this.releaseCurveParameter)}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getJson",value:function(){var e={level:this.level,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release,attackCurve:this.attackCurve,decayCurve:this.decayCurve,releaseCurve:this.releaseCurve};return e=sr(e,"attackParameter",this.attackParameter),e=sr(e,"decayParameter",this.decayParameter),e=sr(e,"sustainParameter",this.sustainParameter),e=sr(e,"releaseParameter",this.releaseParameter),e=sr(e,"levelParameter",this.levelParameter),e=sr(e,"attackCurveParameter",this.attackCurveParameter),e=sr(e,"decayCurveParameter",this.decayCurveParameter),e=sr(e,"releaseCurveParameter",this.releaseCurveParameter)}},{key:"fromJson",value:function(e){this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.level=e.level,e.attackCurve&&(this.attackCurve=e.attackCurve),e.decayCurve&&(this.decayCurve=e.decayCurve),e.releaseCurve&&(this.releaseCurve=e.releaseCurve),or(e,"attackParameter",this.attackParameter,this.sequencerEngine),or(e,"decayParameter",this.decayParameter,this.sequencerEngine),or(e,"sustainParameter",this.sustainParameter,this.sequencerEngine),or(e,"releaseParameter",this.releaseParameter,this.sequencerEngine),or(e,"levelParameter",this.levelParameter,this.sequencerEngine),or(e,"attackCurveParameter",this.attackCurveParameter,this.sequencerEngine),or(e,"decayCurveParameter",this.decayCurveParameter,this.sequencerEngine),or(e,"releaseCurveParameter",this.releaseCurveParameter,this.sequencerEngine)}},{key:"getCopy",value:function(t){var n=new e(this.sequencerEngine,this.mixSession,t);return n.fromJson(this.getJson()),n}},{key:"refresh",value:function(){this.parameters.filter(function(e){return e.isConnectedToAnyLFO()}).forEach(function(e){return e.callSetter()})}},{key:"mateJson",value:function(e,t){this.mateParameter("attack",e,this.attackParameter,t),this.mateParameter("decay",e,this.decayParameter,t),this.mateParameter("sustain",e,this.sustainParameter,t),this.mateParameter("release",e,this.releaseParameter,t)}},{key:"mateParameter",value:function(e,t,n,r){ra(this.sequencerEngine,e,t,n,r)}},{key:"dispose",value:function(){this.envelope.dispose(),this.envelope=void 0}},{key:"attack",get:function(){return this.attackParameter.get()},set:function(e){this.attackParameter.set(e)}},{key:"decay",get:function(){return this.decayParameter.get()},set:function(e){this.decayParameter.set(e)}},{key:"sustain",get:function(){return this.sustainParameter.get()},set:function(e){this.sustainParameter.set(e)}},{key:"release",get:function(){return this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e)}},{key:"level",get:function(){return this.levelParameter.get()},set:function(e){this.levelParameter.set(e)}},{key:"attackCurve",get:function(){return this.attackCurveParameter.get()},set:function(e){this.attackCurveParameter.set(e)}},{key:"decayCurve",get:function(){return this.decayCurveParameter.get()},set:function(e){this.decayCurveParameter.set(e)}},{key:"releaseCurve",get:function(){return this.releaseCurveParameter.get()},set:function(e){this.releaseCurveParameter.set(e)}}]),e}(),Kk=new x.a.Frequency("C3"),Qk=0,Xk=function(){function e(t,n,r,a,i){var s=this,c=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];Object(o.a)(this,e),this.sequencerEngine=t,this.id=Qk++,this.store=t.store,this.mixSession=n,this.context=r.getCopy().forSubDevice(this),this.pitchEnvelope=i,this.synthFactory=a,this.polyphonySet=!1,this.parameters=[],this.volume=new x.a.Gain,this.enabledParameter=new Be("Enabled",this,function(e,t){t&&!s.isInitialized()&&s.create()},{min:!1,max:!0,unit:"",defaultValue:!1,automatable:!1}),this.registerParameter(this.enabledParameter),c&&this.create()}return Object(c.a)(e,[{key:"dispose",value:function(){this.synth&&this.synth.dispose(),this.volume&&this.volume.dispose(),this.parameters.forEach(function(e){return e.dispose()}),this.parameters=void 0,this.synth=void 0,this.volume=void 0}},{key:"create",value:function(){this.synth=this.synthFactory(1),this.synth.volume.value=-4,this.synth.connect(this.volume),this.setupParameters()}},{key:"isInitialized",value:function(){return void 0!==this.synth}},{key:"setupParameters",value:function(){var e=this;this.oscillatorLevelParameter=new Fn("Oscillator Level",this.volume.gain,{min:0,max:1,defaultValue:.8}),this.registerParameter(this.oscillatorLevelParameter),this.oscillatorTypeParameter=new Be("Oscillator Type",this,function(e,t){return e.synth.set({oscillator:{type:t}})},{min:0,max:1,unit:"",defaultValue:"triangle",automatable:!1}),this.registerParameter(this.oscillatorTypeParameter),this.oscillatorFrequencyParameter=new Be("Oscillator Frequency",this,function(e,t){return[]},{min:0,max:1,unit:"",defaultValue:0,automatable:!1}),this.registerParameter(this.oscillatorFrequencyParameter),this.detuneParameter=new He("Detune",this,function(e,t){e.synth.set({detune:t})},{min:-1e3,max:1e3,unit:"",defaultValue:0}),this.registerParameter(this.detuneParameter),this.portamentoParameter=new Be("Portamento",this,function(e,t){return e.synth.set({portamento:t/20})},{min:0,max:10,unit:"",defaultValue:0}),this.registerParameter(this.portamentoParameter),this.polyphonyParameter=new He("Polyphony",this,function(t,n){e.polyphonySet&&e.createNewSynth(n),e.polyphonySet=!0},{min:0,max:16,unit:"",defaultValue:1,automatable:!1}),this.registerParameter(this.polyphonyParameter),this.partialsParameter=new Be("Partials",this,function(e,t){return e.synth.set({oscillator:{partials:t}})},{unit:"",defaultValue:null,automatable:!1}),this.registerParameter(this.partialsParameter),this.synth.set({filter:{frequency:1e4},filterEnvelope:{attack:1e-4,decay:1e-4,sustain:1,release:10}}),this.refreshLFOs()}},{key:"registerParameter",value:function(e,t){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"disconnectSynthFromPitchEnvelope",value:function(){}},{key:"removeBuiltInFilterEnvelope",value:function(){}},{key:"connectSynthToPitchEnvelope",value:function(){}},{key:"createNewSynth",value:function(e){if(void 0!==this.polyphonyParameter&&e===this.synth.voices.length)return;var t=this.synth;this.parameters.forEach(function(e){return e.disconnectFromAllModulators()}),this.synth.disconnect(this.volume),this.disconnectSynthFromPitchEnvelope(this.synth),this.synth=this.synthFactory(e),this.synth.connect(this.volume),this.polyphonySet=!1,this.refreshParameters(),this.connectSynthToPitchEnvelope(this.synth),this.voiceCounter=0,t.dispose(),this.refreshLFOs(),this.removeBuiltInFilterEnvelope(this.synth),this.onNewSynth&&this.onNewSynth()}},{key:"getDetuneVoices",value:function(){return this.synth.voices.map(function(e){return e.detune})}},{key:"refreshParameters",value:function(){this.oscillatorType=this.oscillatorType,this.portamento=this.portamento,null!==this.partials&&(this.partials=this.partials)}},{key:"getCopy",value:function(e,t,n){return n.oscillatorFrequency=this.oscillatorFrequency,n.oscillatorLevel=this.oscillatorLevel,n.detune=this.detune,n.polyphony=this.polyphony,n.portamento=this.portamento,n.oscillatorType=this.oscillatorType,n.pulseWidth=this.pulseWidth,n}},{key:"getJson",value:function(){var e={enabled:this.enabled,oscillatorType:this.oscillatorType,oscillatorFrequency:this.oscillatorFrequency,oscillatorLevel:this.oscillatorLevel,polyphony:this.polyphony,portamento:this.portamento,detune:this.detune,partials:this.partials};return e=sr(e,"enabledParameter",this.enabledParameter),e=sr(e,"oscillatorLevelParameter",this.oscillatorLevelParameter),e=sr(e,"detuneParameter",this.detuneParameter),e=sr(e,"portamentoParameter",this.portamentoParameter),e=sr(e,"oscillatorFrequencyParameter",this.oscillatorFrequencyParameter),e=sr(e,"oscillatorTypeParameter",this.oscillatorTypeParameter),e=sr(e,"partialsParameter",this.partialsParameter)}},{key:"fromJson",value:function(e){this.enabled=e.enabled,this.enabled&&!this.isInitialized()&&this.create(),this.polyphony=e.polyphony,this.oscillatorFrequency=e.oscillatorFrequency,Object(B.a)(e.detune)&&(this.detune=e.detune),this.oscillatorType=e.oscillatorType,this.portamento=e.portamento,this.oscillatorLevel=e.oscillatorLevel,void 0!==e.partials&&null!==e.partials&&(this.partials=e.partials),or(e,"enabledParameter",this.enabledParameter,this.sequencerEngine),or(e,"portamentoParameter",this.portamentoParameter,this.sequencerEngine),or(e,"detuneParameter",this.detuneParameter,this.sequencerEngine),or(e,"oscillatorFrequencyParameter",this.oscillatorFrequencyParameter,this.sequencerEngine),or(e,"oscillatorTypeParameter",this.oscillatorTypeParameter,this.sequencerEngine),or(e,"oscillatorLevelParameter",this.oscillatorLevelParameter,this.sequencerEngine),or(e,"partialsParameter",this.partialsParameter,this.sequencerEngine)}},{key:"setEnvelopes",value:function(e,t){this.getAmpEnvelopes();this.synth.set({envelope:{attack:new x.a.Time((1+t.attack)/1e3),decay:new x.a.Time((1+t.decay)/1e3),sustain:Math.min(t.sustain,.99),release:new x.a.Time((1+t.release)/1e3)}})}},{key:"getAmpEnvelopes",value:function(){return this.synth.voices.map(function(e){return e.envelope})}},{key:"releaseAll",value:function(){this.synth.releaseAll(),this.synth.voices.forEach(function(e){return e.triggerRelease()}),this.pitchEnvelope&&this.pitchEnvelope.triggerRelease(),this.lastNote=void 0}},{key:"getNoteFromTranspose",value:function(e){return this.getDefaultNote().transpose(e+this.oscillatorFrequency)}},{key:"getDefaultNote",value:function(){return Kk}},{key:"connect",value:function(e){void 0!==e&&(this.volume.connect(e),this.node=e)}},{key:"disconnect",value:function(e){this.volume.disconnect(e),this.node=void 0}},{key:"refreshLFOs",value:function(){this.detuneParameter.setAudioParams(this.synth.voices.map(function(e){return e.oscillator.detune}))}},{key:"mateParameter",value:function(e,t,n,r){ra(this.sequencerEngine,e,t,n,r)}},{key:"mateJson",value:function(e,t){this.mateParameter("enabled",e,this.enabledParameter,t),this.enabled&&(this.enabled=!0,this.mateParameter("polyphony",e,this.polyphonyParameter,t),this.mateParameter("oscillatorType",e,this.oscillatorTypeParameter,t),this.mateParameter("oscillatorFrequency",e,this.oscillatorFrequencyParameter,t),this.mateParameter("detune",e,this.detuneParameter,t),this.mateParameter("portamento",e,this.portamentoParameter,t))}},{key:"enabled",get:function(){return this.enabledParameter.get()},set:function(e){this.enabledParameter.set(e)}},{key:"oscillatorLevel",get:function(){return this.oscillatorLevelParameter.get()},set:function(e){return this.oscillatorLevelParameter.set(e)}},{key:"oscillatorType",get:function(){return this.oscillatorTypeParameter.get()},set:function(e){this.oscillatorTypeParameter.get();this.oscillatorTypeParameter.set(e),"custom"===e&&(this.partials=[1,1,1,1,1,1,0,1,0,1,0,1].concat(Array(32).fill(0)))}},{key:"partials",set:function(e){"custom"!==this.oscillatorType&&(this.oscillatorType="custom"),this.partialsParameter.set(e)},get:function(){return this.partialsParameter.get()}},{key:"oscillatorFrequency",get:function(){return this.oscillatorFrequencyParameter.get()},set:function(e){this.oscillatorFrequencyParameter.set(e)}},{key:"detune",get:function(){return this.detuneParameter.get()},set:function(e){this.detuneParameter.set(e)}},{key:"pulseWidth",get:function(){return this.pulseWidthParameter.get()},set:function(e){this.pulseWidthParameter.set(e)}},{key:"portamento",get:function(){return this.portamentoParameter.get()},set:function(e){this.portamentoParameter.set(e)}},{key:"polyphony",get:function(){return void 0===this.polyphonyParameter?8:this.polyphonyParameter.get()},set:function(e){this.polyphonyParameter.set(e)}}]),e}();function Yk(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Zk=function(e){Object(u.a)(n,e);var t=Yk(n);function n(e,r,a,i){var s,c=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return Object(o.a)(this,n),(s=t.call(this,e,r,a,function(e){return new x.a.PolySynth(e,x.a.MonoSynth,{disableFilter:!0})},i,c)).lastNote=void 0,s.frequencyToVoice={},s.voiceCounter=0,s.node=void 0,s}return Object(c.a)(n,[{key:"create",value:function(){Object(q.a)(Object(p.a)(n.prototype),"create",this).call(this),this.removeBuiltInFilterEnvelope(this.synth),this.connectSynthToPitchEnvelope(this.synth)}},{key:"triggerAttack",value:function(e,t,n){if(this.enabled){var r=this.getNoteFromTranspose(e);this.lastNote=e,this.synth.voices[this.voiceCounter].triggerAttack(r,t,n),this.frequencyToVoice[r.toFrequency()]=this.voiceCounter,this.voiceCounter=(this.voiceCounter+1)%this.polyphony}}},{key:"hasCustomWaveform",value:function(){return null!==this.partialsParameter.get()}},{key:"triggerAttackRelease",value:function(e,t,n,r){if(this.enabled){var a=this.getNoteFromTranspose(e);this.synth.voices[this.voiceCounter].triggerAttackRelease(a,t,n,r),this.frequencyToVoice[a.toFrequency()]=this.voiceCounter,this.voiceCounter=(this.voiceCounter+1)%this.polyphony}}},{key:"triggerRelease",value:function(e){var t=this;if(this.enabled&&(void 0===e.map&&(e=[e]),1!=this.polyphony||e[0]===this.lastNote)){var n=e.map(function(e){return t.getNoteFromTranspose(e)}),r=this.frequencyToVoice[n[0].toFrequency()];void 0!==r?(this.pitchEnvelope.triggerRelease(r),this.synth.voices[r].triggerRelease()):this.synth.triggerRelease(n)}}},{key:"setupParameters",value:function(){Object(q.a)(Object(p.a)(n.prototype),"setupParameters",this).call(this),this.pulseWidthParameter=new Be("Pulse Width",this,function(e,t){return e.synth.set({oscillator:{width:t}})},{min:0,max:1,unit:"",defaultValue:.1}),this.registerParameter(this.pulseWidthParameter)}},{key:"refreshParameters",value:function(){Object(q.a)(Object(p.a)(n.prototype),"refreshParameters",this).call(this),this.pulseWidth=this.pulseWidth}},{key:"removeBuiltInFilterEnvelope",value:function(e){}},{key:"connectSynthToPitchEnvelope",value:function(e){var t=this;this.getDetuneVoices().forEach(function(e){return t.pitchEnvelope.connect(e)})}},{key:"disconnectSynthFromPitchEnvelope",value:function(e){var t=this;this.getDetuneVoices().forEach(function(e){return t.pitchEnvelope.disconnect(e)})}},{key:"getCopy",value:function(e,t){var r=new n(this.store,this.mixSession,e,t);return this.getCopy(e,t,r)}},{key:"getJson",value:function(){return sr(Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{pulseWidth:this.pulseWidth}),"pulseWidthParameter",this.pulseWidthParameter)}},{key:"fromJson",value:function(e){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e),this.pulseWidth=e.pulseWidth,or(e,"pulseWidthParameter",this.pulseWidthParameter)}}]),n}(Xk);function $k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var eE=function(e){Object(u.a)(n,e);var t=$k(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this)).sequencerEngine=e,i.store=e.store,i.mixSession=r,i.context=a.getCopy().forInstrument(Object(W.a)(i)),i.pitchEnvelope=new Wk(e,r,i.context),i.oscillatorNodes=[i.createNewOscillator(),i.createNewOscillator(),i.createNewOscillator(!1),i.createNewOscillator(!1)],i.oscillators[0].enabled=!0,i.oscillators[1].enabled=!0,i.filter=new Xn.FilterEffect(e,F),i.ampEnvelope=new zk(e,r,i.context),i.filterEnvelope=new zk(e,r,i.context,i.filter.effectNode.frequency,0,1e4),i.connectAudioNodes(),i.polyphonySet=!1,i.parameters=[],i.setupParameters(),i.refreshParameters(),i.filter.cutoffParameter.audioParam.input.automationRate="a-rate",i}return Object(c.a)(n,[{key:"getSubDevices",value:function(){return[{label:"Filter",value:this},{label:"Oscillator 1",value:this.oscillatorNodes[0]},{label:"Oscillator 2",value:this.oscillatorNodes[1]},{label:"Oscillator 3",value:this.oscillatorNodes[2]},{label:"Oscillator 4",value:this.oscillatorNodes[3]},{label:"Amp. Envelope",value:this.ampEnvelope},{label:"Filter Envelope",value:this.filterEnvelope},{label:"Pitch Envelope",value:this.pitchEnvelope}]}},{key:"getSubDeviceIndex",value:function(e){return this.getSubDevices().map(function(e){return e.value}).indexOf(e)}},{key:"getSubDevice",value:function(e){return this.getSubDevices().map(function(e){return e.value})[e]}},{key:"getOscillator",value:function(e){return this.oscillatorNodes[e]}},{key:"connectAudioNodes",value:function(){var e=this;this.oscillatorNodes.forEach(function(t){return t.connect(e.filter.effectNode)})}},{key:"connect",value:function(e){void 0!==e&&this.filter.connect(e)}},{key:"disconnect",value:function(e){this.filter.disconnect(e)}},{key:"createNewOscillator",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Zk(this.sequencerEngine,this.mixSession,this.context,this.pitchEnvelope.envelope,e)}},{key:"addNewOscillator",value:function(){this.oscillators.push(this.createNewOscillator())}},{key:"triggerAttack",value:function(e,t,n){this.pitchEnvelope.refresh(),this.filterEnvelope.refresh(),this.filterEnvelope.triggerAttack(t,n),this.pitchEnvelope.envelope.triggerAttack(t,n),this.oscillators.forEach(function(r){return r.triggerAttack(e,t,n)})}},{key:"triggerAttackRelease",value:function(e,t,n,r){this.pitchEnvelope.refresh(),this.filterEnvelope.refresh(),this.filterEnvelope.triggerAttackRelease(t,n,r),this.pitchEnvelope.envelope.triggerAttackRelease(t,n,r),this.oscillators.forEach(function(a){return a.triggerAttackRelease(e,t,n,r)})}},{key:"triggerRelease",value:function(e){this.filterEnvelope.triggerRelease(),this.pitchEnvelope.envelope.triggerRelease(),this.oscillators.forEach(function(t){return t.triggerRelease(e)})}},{key:"getName",value:function(){return"M. Synth"}},{key:"getInstrument",value:function(){return this}},{key:"getInstrumentType",value:function(){return cp}},{key:"refreshParameters",value:function(){this.filterQ=this.filterQ,this.filterCutoff=this.filterCutoff}},{key:"createLFO",value:function(){return new la(this.sequencerEngine,this.mixSession,this.context)}},{key:"setupParameters",value:function(e){var t=this;this.filterCutoffParameter=new Ln("Filter Cutoff",this.filter.effectNode.frequency,function(e,n){t.filterEnvelope.frequency=n,t.filter.cutoffFrequency=n,t.oscillators.forEach(function(e){return e.cutoffFrequency=n})},{min:0,max:1e4,unit:"HZ",defaultValue:1200,constantAutomationRate:!0}),this.registerParameter(this.filterCutoffParameter,function(e){return e.filter.frequency}),this.filterQParameter=new Ln("Filter Q",this.filter.effectNode.Q,function(e,n){return t.filter.Q=n},{min:0,max:9,unit:"",defaultValue:1}),this.registerParameter(this.filterQParameter,function(e){return e.filter.Q})}},{key:"getCopy",value:function(e){var t=new n(this.sequencerEngine,this.mixSession,e);return t.fromJson(this.getJson()),t}},{key:"getJson",value:function(){var e={instrumentType:this.getInstrumentType(),filterCutoff:this.filterCutoff,filterQ:this.filterQ,oscillators:this.oscillators.map(function(e){return e.getJson()}),ampEnvelope:this.ampEnvelope.getJson(),filterEnvelope:this.filterEnvelope.getJson(),pitchEnvelope:this.pitchEnvelope.getJson()};return e=sr(e,"filterCutoffParameter",this.filterCutoffParameter),e=sr(e,"filterQParameter",this.filterQParameter)}},{key:"fromJson",value:function(e){for(var t in this.instrumentType=e.instrumentType,this.filterCutoff=e.filterCutoff,this.filterQ=e.filterQ,this.oscillators){t=parseInt(t),this.oscillators[t].fromJson(e.oscillators[t])}this.filterEnvelope.fromJson(e.filterEnvelope),this.ampEnvelope.fromJson(e.ampEnvelope),this.pitchEnvelope.fromJson(e.pitchEnvelope),or(e,"filterCutoffParameter",this.filterCutoffParameter,this.sequencerEngine),or(e,"filterQParameter",this.filterQParameter,this.sequencerEngine)}},{key:"releaseAll",value:function(){this.oscillators.forEach(function(e){return e.releaseAll()})}},{key:"isMonophonic",value:function(){return this.oscillators.every(function(e){return 1==e.polyphony})}},{key:"setEnvelopes",value:function(e){var t=this;this.oscillators.forEach(function(n){return n.setEnvelopes(e,t.ampEnvelope)})}},{key:"getParameters",value:function(){var e=Object(M.a)(this.parameters);for(var t in this.oscillators)e=e.concat(this.oscillators[t].parameters);return(e=e.concat(this.ampEnvelope.parameters).concat(this.pitchEnvelope.parameters).concat(this.filterEnvelope.parameters)).filter(function(e){return void 0!==e})}},{key:"findParameter",value:function(e,t){var n=e.envelopeType,r=this.getParameters();n===Oh?r=this.ampEnvelope.parameters:"PITCH"===n?r=this.pitchEnvelope.parameters:"FILTER"===n&&(r=this.filterEnvelope.parameters);var a=r.filter(function(e){return e.name===t});if(0!==a.length)return a[0]}},{key:"mateJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;for(var n in e.oscillators){this.getOscillator(n).mateJson(e.oscillators[n])}this.ampEnvelope.mateJson(e.ampEnvelope,t),this.filterEnvelope.mateJson(e.filterEnvelope,t),this.pitchEnvelope.mateJson(e.pitchEnvelope,t),this.mateParameter("filterCutoff",e,this.filterCutoffParameter,t),this.mateParameter("filterQ",e,this.filterQParameter,t),this.mateParameter("noiseVolume",e,this.noiseVolumeParameter,t)}},{key:"mateParameter",value:function(e,t,n,r){ra(this.sequencerEngine,e,t,n,r)}},{key:"dispose",value:function(){this.oscillatorNodes.forEach(function(e){return e.dispose()}),this.filter.dispose(),this.pitchEnvelope.dispose(),this.filterEnvelope.dispose(),this.ampEnvelope.dispose(),this.oscillatorNodes=void 0,this.filter=void 0,this.pitchEnvelope=void 0,this.filterEnvelope=void 0,this.ampEnvelope=void 0,this.parameters.forEach(function(e){return e.dispose()}),this.parameters=void 0}},{key:"oscillators",get:function(){return this.oscillatorNodes.filter(function(e){return e.isInitialized()})}},{key:"name",get:function(){return this.getName()}},{key:"filterCutoff",get:function(){return this.filterCutoffParameter.get()},set:function(e){this.filterCutoffParameter.set(e)}},{key:"filterQ",get:function(){return this.filterQParameter.get()},set:function(e){this.filterQParameter.set(e)}}]),n}(Hk);function tE(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var nE=function(e){Object(u.a)(n,e);var t=tE(n);function n(e,r,a,i,s,c){var u;return Object(o.a)(this,n),(u=t.call(this,e,r,a,i,s,c,!1)).setInstrument(new eE(r,a,(new Wr).forTrack(Object(W.a)(u)))),u}return n}(Gk);function rE(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var aE=function(e){Object(u.a)(n,e);var t=rE(n);function n(e,r,a){return Object(o.a)(this,n),t.call(this,e,r,a,function(e){return new x.a.PolySynth(e,x.a.FMSynth)})}return Object(c.a)(n,[{key:"setupParameters",value:function(){Object(q.a)(Object(p.a)(n.prototype),"setupParameters",this).call(this),this.harmonicityParameter=new Ln("Harmonicity",this,function(e,t){return e.synth.set({harmonicity:t})},{min:0,max:20,unit:"",defaultValue:3}),this.registerParameter(this.harmonicityParameter),this.modulationIndexParameter=new Ln("modulationIndex",this,function(e,t){return e.synth.set({modulationIndex:t})},{min:0,max:1e3,unit:"",defaultValue:10}),this.harmonicityParameter.setAudioParams(this.synth.voices.map(function(e){return e.harmonicity})),this.modulationIndexParameter.setAudioParams(this.synth.voices.map(function(e){return e.modulationIndex})),this.partialCountParameter=new Be("Partial Count",this,function(e,t){return e.synth.set({oscillator:{partialCount:t}})},{min:0,automatable:!1,max:16,unit:"",defaultValue:0}),this.registerParameter(this.partialCountParameter),this.registerParameter(this.modulationIndexParameter)}},{key:"refreshParameters",value:function(){Object(q.a)(Object(p.a)(n.prototype),"refreshParameters",this).call(this),this.harmonicity=this.harmonicity,this.modulationIndex=this.modulationIndex,this.partialCount=this.partialCount,this.harmonicityParameter.setAudioParams(this.synth.voices.map(function(e){return e.harmonicity})),this.modulationIndexParameter.setAudioParams(this.synth.voices.map(function(e){return e.modulationIndex}))}},{key:"getJson",value:function(){var e=Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{harmonicity:this.harmonicity,modulationIndex:this.modulationIndex,partialCount:this.partialCount});return e=sr(e,"harmonicityParameter",this.harmonicityParameter),e=sr(e,"modulationIndexParameter",this.modulationIndexParameter),e=sr(e,"partialCountParameter",this.partialCountParameter)}},{key:"fromJson",value:function(e){Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,e),this.harmonicity=parseFloat(e.harmonicity),this.modulationIndex=parseFloat(e.modulationIndex),this.partialCount=e.partialCount,or(e,"harmonicityParameter",this.harmonicityParameter,this.sequencerEngine),or(e,"modulationIndexParameter",this.modulationIndexParameter,this.sequencerEngine),or(e,"partialCountParameter",this.partialCountParameter,this.sequencerEngine)}},{key:"mateJson",value:function(e,t){Object(q.a)(Object(p.a)(n.prototype),"mateJson",this).call(this,e,t),this.mateParameter("harmonicity",e,this.harmonicityParameter,t),this.mateParameter("modulationIndex",e,this.modulationIndexParameter,t),this.mateParameter("partialCount",e,this.partialCountParameter,t)}},{key:"harmonicity",get:function(){return this.harmonicityParameter.get()},set:function(e){return this.harmonicityParameter.set(e)}},{key:"modulationIndex",get:function(){return this.modulationIndexParameter.get()},set:function(e){return this.modulationIndexParameter.set(e)}},{key:"partialCount",get:function(){return this.partialCountParameter.get()},set:function(e){return this.partialCountParameter.set(e)}}]),n}(Xk),iE=function(){function e(t,n,r,a){Object(o.a)(this,e),this.sequencerEngine=t,this.store=t.store,this.mixSession=n,this.context=r.getCopy().forSubDevice(this),this.fmSynth=a,this.parameters=[],this.setupParameters()}return Object(c.a)(e,[{key:"setupParameters",value:function(){this.oscillatorTypeParameter=new Be("Oscillator Type",this,function(e,t){return e.synth.set({modulation:{type:t}})},{min:0,max:1,unit:"",defaultValue:"triangle",automatable:!1}),this.registerParameter(this.oscillatorTypeParameter),this.partialCountParameter=new Be("Partial Count",this,function(e,t){return e.synth.set({modulation:{partialCount:t}})},{min:0,max:16,unit:"",defaultValue:0}),this.registerParameter(this.partialCountParameter)}},{key:"refreshParameters",value:function(){this.oscillatorType=this.oscillatorType}},{key:"registerParameter",value:function(e,t){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getJson",value:function(){var e={oscillatorType:this.oscillatorType,partialCount:this.partialCount};return e=sr(e,"partialCountParameter",this.partialCountParameter),sr(e,"oscillatorTypeParameter",this.oscillatorTypeParameter)}},{key:"fromJson",value:function(e){this.oscillatorType=e.oscillatorType,e.partialCount&&(this.partialCount=e.partialCount),or(e,"oscillatorTypeParameter",this.oscillatorTypeParameter),or(e,"partialCountParameter",this.partialCountParameter)}},{key:"mateJson",value:function(e,t){this.mateParameter("partialCount",e,this.partialCountParameter,t),this.mateParameter("oscillatorType",e,this.oscillatorTypeParameter,t)}},{key:"mateParameter",value:function(e,t,n,r){ra(this.sequencerEngine,e,t,n,r)}},{key:"synth",get:function(){return this.fmSynth.synth}},{key:"oscillatorType",get:function(){return this.oscillatorTypeParameter.get()},set:function(e){this.oscillatorTypeParameter.set(e)}},{key:"partialCount",get:function(){return this.partialCountParameter.get()},set:function(e){return this.partialCountParameter.set(e)}}]),e}();function sE(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var oE=function(e){Object(u.a)(n,e);var t=sE(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this)).notes=[],i.sequencerEngine=e,i.store=e.store,i.mixSession=r,i.context=a.getCopy().forInstrument(Object(W.a)(i)),i.ampEnvelope=new zk(e,r,i.context),i.modulationEnvelope=new zk(e,r,i.context),i.filter=new Xn.FilterEffect(e,F),i.filterEnvelope=new zk(e,r,i.context,i.filter.effectNode.frequency,0,1e4),i.filterEnvelope2=new zk(e,r,i.context,i.filter.effectNode.frequency,0,1e4),i.carrierOscillator=new aE(e,r,i.context),i.modulatorOscillator=new iE(e,r,i.context,Object(W.a)(i)),i.noiseOscillator=new x.a.NoiseSynth,i.connectSynthToFilter(),i.parameters=[],i.setupParameters(),i.carrierOscillator.onNewSynth=function(){return i.onNewSynth()},i.lastTime=void 0,i.currentNotes=[],i}return Object(c.a)(n,[{key:"getSubDevices",value:function(){return[{label:"Filter",value:this},{label:"Carrier Oscillator",value:this.carrierOscillator},{label:"Modulator Oscillator",value:this.modulatorOscillator},{label:"Amp Envelope",value:this.ampEnvelope},{label:"Filter Envelope",value:this.filterEnvelope},{label:"Filter Envelope 2",value:this.filterEnvelope2},{label:"Modulation Envelope",value:this.modulationEnvelope}]}},{key:"onNewSynth",value:function(){this.connectSynthToFilter(),this.modulatorOscillator.refreshParameters()}},{key:"triggerAttack",value:function(e,t,n){this.filterEnvelope.refresh(),this.filterEnvelope2.refresh();var r=this.carrierOscillator.getNoteFromTranspose(e);this.notes.push(r),this.filterEnvelope.triggerAttack(t,n),this.filterEnvelope2.triggerAttack(t,n),this.synth.triggerAttack(r,t,n),this.noiseOscillator.triggerAttack(t,n)}},{key:"triggerAttackRelease",value:function(e,t,n,r){var a=this.carrierOscillator.getNoteFromTranspose(e);this.notes.push(a),this.filterEnvelope.refresh(),this.filterEnvelope2.refresh(),this.filterEnvelope.triggerAttackRelease(t,n,r),this.filterEnvelope2.triggerAttackRelease(t,n,r),this.synth.triggerAttackRelease(a,t,n,r),this.noiseOscillator.triggerAttackRelease(t,n,r)}},{key:"triggerRelease",value:function(e){var t=this,n=e.map(function(e){return t.carrierOscillator.getNoteFromTranspose(e)});this.filterEnvelope.triggerRelease(),this.filterEnvelope2.triggerRelease(),this.synth.triggerRelease(n),this.noiseOscillator.triggerRelease(x.a.Master.context.currentTime)}},{key:"releaseAll",value:function(){this.synth.releaseAll(),this.notes=[]}},{key:"setEnvelopes",value:function(e){this.carrierOscillator.setEnvelopes(e,this.ampEnvelope),this.setModulationEnvelopes(),this.setAmpEnvelopeForNoise(e)}},{key:"setModulationEnvelopes",value:function(){this.synth.set({modulationEnvelope:{attack:new x.a.Time((1+this.modulationEnvelope.attack)/1e3),decay:new x.a.Time((1+this.modulationEnvelope.decay)/1e3),sustain:this.modulationEnvelope.sustain,release:new x.a.Time((1+this.modulationEnvelope.release)/1e3)}})}},{key:"setAmpEnvelopeForNoise",value:function(){this.noiseOscillator.envelope.attack=new x.a.Time((1+this.ampEnvelope.attack)/1e3),this.noiseOscillator.envelope.decay=new x.a.Time((1+this.ampEnvelope.decay)/1e3),this.noiseOscillator.envelope.sustain=this.ampEnvelope.sustain,this.noiseOscillator.envelope.release=new x.a.Time((1+this.ampEnvelope.release)/1e3)}},{key:"dispose",value:function(){console.log("disposing fm synth =",this),this.noiseOscillator.dispose(),this.filterEnvelope.dispose(),this.filterEnvelope2.dispose(),this.filter.dispose(),this.carrierOscillator.dispose(),this.noiseOscillator=void 0,this.filterEnvelope=void 0,this.filterEnvelope2=void 0,this.filter=void 0,this.carrierOscillator=void 0}},{key:"connectSynthToFilter",value:function(){this.synth.connect(this.filter.effectNode),this.noiseOscillator.connect(this.filter.effectNode)}},{key:"connect",value:function(e){void 0!==e&&this.filter.connect(e)}},{key:"disconnect",value:function(e){this.filter.disconnect(e)}},{key:"setupParameters",value:function(){var e=this;this.filterCutoffParameter=new Ln("Filter Cutoff",this.filter.effectNode.frequency,function(t,n){e.filterEnvelope.frequency=n,e.filterEnvelope2.frequency=n,e.filter.cutoffFrequency=n},{min:0,max:1e4,unit:"HZ",defaultValue:1200,constantAutomationRate:!0}),this.registerParameter(this.filterCutoffParameter,function(e){return e.filter.frequency}),this.filterQParameter=new Ln("Filter Q",this.filter.effectNode.Q,function(t,n){return e.filter.Q=n},{min:0,max:9,unit:"",defaultValue:1}),this.registerParameter(this.filterQParameter,function(e){return e.filter.Q}),this.noiseVolumeParameter=new Ln("noiseVolume",this.noiseOscillator.volume,function(t,n){return e.noiseOscillator.volume.value=n},{min:-100,max:-4,unit:"db",defaultValue:-100}),this.registerParameter(this.noiseVolumeParameter)}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getParameters",value:function(){return[].concat(Object(M.a)(this.parameters),Object(M.a)(this.ampEnvelope.parameters),Object(M.a)(this.filterEnvelope.parameters),Object(M.a)(this.filterEnvelope2.parameters),Object(M.a)(this.modulationEnvelope.parameters),Object(M.a)(this.carrierOscillator.parameters),Object(M.a)(this.modulatorOscillator.parameters))}},{key:"isMonophonic",value:function(){return 1===this.carrierOscillator.polyphony}},{key:"refreshParameters",value:function(){this.filterQ=this.filterQ,this.filterCutoff=this.filterCutoff}},{key:"getName",value:function(){return"FM Synth"}},{key:"getInstrument",value:function(){return this}},{key:"getInstrumentType",value:function(){return up}},{key:"getJson",value:function(){var e={instrumentType:this.getInstrumentType(),filterCutoff:this.filterCutoff,filterQ:this.filterQ,carrierOscillator:this.carrierOscillator.getJson(),modulatorOscillator:this.modulatorOscillator.getJson(),ampEnvelope:this.ampEnvelope.getJson(),filterEnvelope:this.filterEnvelope.getJson(),filterEnvelope2:this.filterEnvelope2.getJson(),modulationEnvelope:this.modulationEnvelope.getJson(),noiseVolume:this.noiseVolumeParameter.get()};return e=sr(e,"filterCutoffParameter",this.filterCutoffParameter),e=sr(e,"filterQParameter",this.filterQParameter),e=sr(e,"noiseVolumeParameter",this.noiseVolumeParameter)}},{key:"fromJson",value:function(e){for(var t in this.instrumentType=e.instrumentType,this.filterCutoff=e.filterCutoff,this.filterQ=e.filterQ,e.lfos)this.lfos[t].fromJson(e.lfos[t]);void 0!==e.noiseVolume&&this.noiseVolumeParameter.set(e.noiseVolume),this.carrierOscillator.fromJson(e.carrierOscillator),this.modulatorOscillator.fromJson(e.modulatorOscillator),this.filterEnvelope.fromJson(e.filterEnvelope),e.filterEnvelope2&&this.filterEnvelope2.fromJson(e.filterEnvelope2),this.ampEnvelope.fromJson(e.ampEnvelope),this.modulationEnvelope.fromJson(e.modulationEnvelope),or(e,"filterCutoffParameter",this.filterCutoffParameter,this.sequencerEngine),or(e,"filterQParameter",this.filterQParameter,this.sequencerEngine),or(e,"noiseVolumeParameter",this.noiseVolumeParameter,this.sequencerEngine)}},{key:"getCopy",value:function(e){var t=new n(this.sequencerEngine,this.mixSession,e);return t.fromJson(this.getJson()),t}},{key:"mateJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;this.carrierOscillator.mateJson(e.carrierOscillator,t),this.modulatorOscillator.mateJson(e.modulatorOscillator,t),this.ampEnvelope.mateJson(e.ampEnvelope,t),this.filterEnvelope.mateJson(e.filterEnvelope,t),this.filterEnvelope2.mateJson(e.filterEnvelope2,t),this.modulationEnvelope.mateJson(e.modulationEnvelope,t),this.mateParameter("filterCutoff",e,this.filterCutoffParameter,t),this.mateParameter("filterQ",e,this.filterQParameter,t),this.mateParameter("noiseVolume",e,this.noiseVolumeParameter,t)}},{key:"mateParameter",value:function(e,t,n,r){ra(this.sequencerEngine,e,t,n,r)}},{key:"findParameter",value:function(e,t){var n=e.envelopeType,r=this.getParameters();n===Oh?r=this.ampEnvelope.parameters:"MODULATION"===n?r=this.modulationEnvelope.parameters:"FILTER"===n?r=this.filterEnvelope.parameters:"FILTER_2"===n&&(r=this.filterEnvelope2.parameters);var a=r.filter(function(e){return e.name===t});if(0!==a.length)return a[0]}},{key:"synth",get:function(){return this.carrierOscillator.synth}},{key:"filterCutoff",get:function(){return this.filterCutoffParameter.get()},set:function(e){this.filterCutoffParameter.set(e)}},{key:"filterQ",get:function(){return this.filterQParameter.get()},set:function(e){this.filterQParameter.set(e)}}]),n}(Hk);function cE(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var uE=function(e){Object(u.a)(n,e);var t=cE(n);function n(e,r,a,i,s,c){var u;return Object(o.a)(this,n),(u=t.call(this,e,r,a,i,s,c,!1)).setInstrument(new oE(r,a,(new Wr).forTrack(Object(W.a)(u)))),u}return n}(Gk);function lE(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var pE=function(e){Object(u.a)(n,e);var t=lE(n);function n(e,r,a,i,s){var c;return Object(o.a)(this,n),(c=t.call(this,e,r,a,i,s,!0)).parameters=[],c.onParameter=new Be("on",Object(W.a)(c),function(e,t){return[]},{min:!1,max:!0,unit:"",defaultValue:!1}),c.registerParameter(c.onParameter),c.loopParameter=new Be("loop",Object(W.a)(c),function(e,t){return[]},{min:!1,max:!0,unit:"",defaultValue:!1}),c.registerParameter(c.loopParameter),c.loadFromJson(s),c.startTime=void 0,c.endTime=void 0,c.samplesStream=new Mn(r,e.sequencerEngine),c}return Object(c.a)(n,[{key:"auditionSound",value:function(e){this.sample=e,this.audioBuffer=e.audioBuffer,this.baseBuffer=new x.a.Buffer(e.audioBuffer),this.sampler._buffers._buffers[48]=this.baseBuffer,this.slice(0,0,this.getDuration()),this.registerParameter(this.volumeParameter)}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.samplerData,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sliceData,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(q.a)(Object(p.a)(n.prototype),"init",this).call(this,e,t,r),this.sampler=new x.a.Sampler({C3:this.baseBuffer},{curve:"linear"}),this.volumeParameter=new Fn("volume",this.sampler.output.volume,{min:-100,max:0,unit:"db",defaultValue:0}),this.registerParameter(this.volumeParameter),this}},{key:"dispose",value:function(){this.sample.dispose(),this.sampler.dispose(),this.baseBuffer.dispose(),this.slices=[],this.detuneSignal.dispose(),this.pitchEnvelopes.forEach(function(e){return e.dispose()}),this.sample=void 0,this.sampler=void 0,this.baseBuffer=void 0,this.pitchEnvelopes=void 0,this.detuneSignal=void 0}},{key:"isDisposed",value:function(){return void 0===this.sampler}},{key:"getSlice",value:function(){var e=this;return{buffer:this.baseBuffer,startTime:this.startTime,endTime:this.endTime,getDuration:function(){return e.endTime-e.startTime}}}},{key:"get",value:function(){return this.sampler}},{key:"newSlice",value:function(e,t){return this.startTime=e,this.endTime=t,this.slices.push(new hE(this.baseBuffer,e,t)),this.sliceData.push({startTime:e,endTime:t}),this.slice(this.slices.length-1,e,t,!0),this.slices[this.slices.length-1]}},{key:"slice",value:function(e,t,n){arguments.length>3&&void 0!==arguments[3]&&arguments[3];var r=this.slices[e];n=void 0==n?this.getDuration():n,r.startTime=t,r.endTime=n;this.alpha;this.sliceData[e]={startTime:t,endTime:n},this.startTime=t,this.endTime=n,this.updateSlicesState()}},{key:"loadFromJson",value:function(e){this.onParameter.set(void 0===e.on||e.on),or(e,"onParameter",this.onParameter),this.loop=e.loop||!1,or(e,"loopParameter",this.loopParameter),this.detune=e.detune||0,or(e,"detuneParameter",this.detuneParameter)}},{key:"getJson",value:function(){var e=Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{on:this.onParameter.get(),loop:this.loop,detune:this.detune});return e=sr(e,"onParameter",this.onParameter),e=sr(e,"loopParameter",this.loopParameter),e=sr(e,"detuneParameter",this.detuneParameter)}},{key:"triggerAttack",value:function(){var e=Object(R.a)(N.a.mark(function e(t,r,a,i,s,o){var c,u,l,h,f,d;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getNoteFromTranspose(t),c=this.get(0),u=i.start,u=this.convertToStartTime(0,u),u+=this.startTime,c.loop=this.loop,l=this.getLoopPoints(i),h=l.loopStart,f=l.loopEnd,u=h,c.loopStart=h,c.loopEnd=f,d=[this.getPitchEnvelope(c,t,r,a,this.track.trackData)],s&&d.push(s),this.triggerWaveformAnimation(r,void 0,0,0,u),e.next=15,Object(q.a)(Object(p.a)(n.prototype),"triggerAttack",this).call(this,c,t,r,a,d,u,o);case 15:case"end":return e.stop()}},e,this)}));return function(t,n,r,a,i,s){return e.apply(this,arguments)}}()},{key:"triggerAttackRelease",value:function(){var e=Object(R.a)(N.a.mark(function e(t,r,a,i,s,o,c){var u,l,h,f,d,m,v,g=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=g.length>7&&void 0!==g[7]?g[7]:0,t=this.getNoteFromTranspose(t),l=s.start,l=this.convertToStartTime(0,l),l+=this.startTime,(h=this.get(0)).loop=this.loop,f=this.getLoopPoints(s),d=f.loopStart,m=f.loopEnd,l=d,l+=this.convertToStartTime(0,u),h.loopStart=d,h.loopEnd=m,this.triggerWaveformAnimation(a,r,0,0,l),v=[this.getPitchEnvelope(h,t,a,i,this.track.trackData)],o&&v.push(o),e.next=17,Object(q.a)(Object(p.a)(n.prototype),"triggerAttackRelease",this).call(this,h,t,r,a,i,v,l,c);case 17:case"end":return e.stop()}},e,this)}));return function(t,n,r,a,i,s,o){return e.apply(this,arguments)}}()},{key:"triggerRelease",value:function(e){var t=this;this.triggerReleaseWaveformAnimation(),e=e.map(function(e){return t.getNoteFromTranspose(e)}),this.get(0).triggerRelease(e)}},{key:"getLoopPoints",value:function(e){var t=e.loopStart,n=e.loopLength,r=(t=this.startTime+this.getDuration()*(t/100))+this.getDuration()*(n/100);return{loopStart:t,loopEnd:Math.min(r,this.endTime)}}},{key:"setLoopPoints",value:function(e){var t=this.getLoopPoints(e),n=t.loopStart,r=t.loopEnd;for(var a in this.sampler._activeSources){this.sampler._activeSources[a].forEach(function(e){e.loopStart=n,e.loopEnd=r})}}},{key:"gainNode",get:function(){return this.sampler.output}},{key:"detune",set:function(e){this.detuneParameter.set(e)},get:function(){return this.detuneParameter.get()}},{key:"on",set:function(e){this.onParameter.set(e)},get:function(){return this.onParameter.get()}},{key:"loop",set:function(e){this.loopParameter.set(e)},get:function(){return this.loopParameter.get()}}]),n}(zo),hE=function(){function e(t,n,r){Object(o.a)(this,e),this.buffer=t,this.originalBuffer=t,this.startTime=n,this.endTime=r}return Object(c.a)(e,[{key:"getCopy",value:function(){return new e(this.buffer,this.startTime,this.endTime)}},{key:"getJson",value:function(){return{buffer:this.buffer,startTime:this.startTime,endTime:this.endTime}}},{key:"dispose",value:function(){}}]),e}(),fE=pE;var dE=function(){function e(t){Object(o.a)(this,e),this.input=this.output=new x.a.Gain(1)}return Object(c.a)(e,[{key:"restart",value:function(e){this.lfo&&(this.lfo.stop(e),this.lfo.start(e))}},{key:"onTick",value:function(e){}},{key:"trigger",value:function(e,t,n){var r=t.loopLengthSeconds;if(void 0!==this.lfo&&!(r<=0)){var a=x.a.Frequency(r,"s").transpose(n);isNaN(a)||void 0===a||(this.lfo.frequency.value=a),this.restart(e)}}},{key:"loop",set:function(e){e&&void 0===this.lfo?(this.lfo=new x.a.LFO({type:"triangle",phase:90,min:.7,max:1}),this.lfo.connect(this.input.gain)):e||void 0===this.lfo||(this.lfo.dispose(),this.lfo=void 0)}},{key:"smooth",set:function(e){this.lfo&&(this.lfo.min=e)}}]),e}(),mE=1,vE=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;arguments.length>1&&arguments[1];Object(o.a)(this,e),this.outputNode=new x.a.Gain(1),this.voiceNumber=t,this.ampEnvelope=new x.a.AmplitudeEnvelope(10,10,1,100),this.ampLFO=new dE,this.ampEnvelope.connect(this.ampLFO.input),this.ampLFO.output.connect(this.outputNode),this.ampEnvelope.releaseCurve="linear",this.ampEnvelope.attackCurve="linear",this.ampEnvelope.decayCurve="linear",this.samplerToTriggers={},this.samplerToTransposes={},this.idToSampler={},this.samplerLimit=mE}return Object(c.a)(e,[{key:"clear",value:function(e){this.samplerToTriggers={},this.idToSampler={}}},{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"dispose",value:function(){this.outputNode.dispose(),this.ampEnvelope.dispose(),this.outputNode=void 0,this.ampEnvelope=void 0,this.samplerToTriggers=void 0}},{key:"useSampler",value:function(e,t,n,r){void 0!==this.samplerToTriggers[e.id]&&void 0!==this.samplerToTriggers[e.id][n]&&0!==this.samplerToTriggers[e.id][n]||(this.samplerToTriggers[e.id]={},this.samplerToTriggers[e.id][n]=0),this.samplerToTriggers[e.id][n]++,this.idToSampler[e.id]=e,this.ampLFO.trigger(t,r,n+e.transpose),this.tooManyTriggers()>0&&this.releaseOldestTrigger(e,0,t)}},{key:"onVoiceRelease",value:function(e,t){this.samplerToTriggers[e.id]&&delete this.samplerToTriggers[e.id][t]}},{key:"disconnectSampler",value:function(e,t){return void 0===this.samplerToTriggers[e.id]||void 0===this.samplerToTriggers[e.id][t]||0===this.samplerToTriggers[e.id][t]&&(delete this.samplerToTriggers[e.id][t],!0)}},{key:"isUsed",value:function(){return Object.keys(this.samplerToTriggers).length>0}},{key:"isUsingSampler",value:function(e){return void 0!==this.samplerToTriggers[e.id]&&Object.keys(this.samplerToTriggers[e.id]).length>0}},{key:"tooManyTriggers",value:function(){return this.totalTriggers-mE}},{key:"getFromMap",value:function(e,t){return Object.keys(e).filter(function(t){return e[t]&&e[t].length>0})[t]}},{key:"releaseOldestTrigger",value:function(e,t,n){for(var r in(n-=.005)<0&&(n=0),this.idToSampler)if(this.idToSampler[r]!==e){var a=this.idToSampler[r].sampler,i=this.getFromMap(a._activeSources,t);if(void 0!==i){new x.a.Midi(i).toFrequency();return void a.triggerRelease(new x.a.Midi(i).toFrequency(),n,.1)}}var s=e.sampler,o=this.getFromMap(s._activeSources,t);s.triggerRelease(new x.a.Midi(o).toFrequency(),n,.1)}},{key:"totalTriggers",get:function(){var e=0;for(var t in this.samplerToTriggers){var n=this.samplerToTriggers[t];for(var r in n)e+=n[r]}return e}}]),e}(),gE=function(){function e(t,n,r){Object(o.a)(this,e),this.sampledInstrument=r,this.voices=[],this.outputNode=new x.a.Gain(1);for(var a=0;a<t;a++){var i=new vE(a,r);i.connect(this.outputNode),this.voices.push(i)}this.unusedVoices=Object(M.a)(this.voices),this.outputNode.connect(n),this.numVoices=t,this.samplersUsed=new Set}return Object(c.a)(e,[{key:"getVoices",value:function(){return 1===this.numVoices?[this.voices[0]]:this.voices}},{key:"clear",value:function(){this.voices.forEach(function(e){return e.clear()}),this.samplersUsed=new Set}},{key:"dispose",value:function(){this.voices.forEach(function(e){return e.dispose()}),this.outputNode.dispose(),this.voices=void 0,this.outputNode=void 0}},{key:"getUnusedVoiceIfAny",value:function(e){return 1===this.numVoices?this.voices[0]:0===this.unusedVoices.length?this.voices[Math.floor(Math.random()*this.numVoices)]:this.unusedVoices.shift()}},{key:"getVoiceUsingSampler",value:function(e,t){return this.voices.find(function(n){return n.samplerToTriggers[e.id]&&n.samplerToTriggers[e.id][t]})}},{key:"useSamplerWithVoice",value:function(e,t,n,r,a){t.useSampler(e,n,r,a),this.samplersUsed.add(e)}},{key:"disconnectSamplerFromVoice",value:function(e,t,n){t.disconnectSampler(e,n)&&(t.isUsed()||(this.unusedVoices.push(t),this.samplersUsed.delete(e)))}},{key:"triggerAttack",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n,r,a,i,s){var o;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.getUnusedVoiceIfAny(t),this.useSamplerWithVoice(t,o,r,n,i),o.ampEnvelope.triggerAttack(r,a),e.next=5,t.triggerAttack(n,r,a,i,s,o.ampEnvelope);case 5:t.loop||this.disconnectSamplerFromVoice(t,o,n);case 6:case"end":return e.stop()}},e,this)}));return function(t,n,r,a,i,s){return e.apply(this,arguments)}}()},{key:"triggerAttackRelease",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n,r,a,i,s,o,c){var u;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=this.getUnusedVoiceIfAny(t),this.useSamplerWithVoice(t,u,a,n,s),u.ampEnvelope.triggerAttackRelease(r,a,i,s),e.next=5,t.triggerAttackRelease(n,r,a,i,s,o,u.ampEnvelope,c);case 5:u.onVoiceRelease(t,n),this.disconnectSamplerFromVoice(t,u,n);case 7:case"end":return e.stop()}},e,this)}));return function(t,n,r,a,i,s,o,c){return e.apply(this,arguments)}}()},{key:"triggerRelease",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.triggerRelease(n),void 0!==(r=this.getVoiceUsingSampler(t,n[0]))){e.next=4;break}return e.abrupt("return");case 4:r.totalTriggers<=1&&r.ampEnvelope.triggerRelease(),r.onVoiceRelease(t,n[0]);case 6:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"ampEnvelopes",get:function(){return this.voices.map(function(e){return e.ampEnvelope})}}]),e}(),yE=n(373),bE=function(){function e(){Object(o.a)(this,e),this.isRecording=!1}return Object(c.a)(e,[{key:"startRecordLoop",value:function(){var e=Object(R.a)(N.a.mark(function e(){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("start record loop");case 1:if(void 0===this.recorder){e.next=7;break}return e.next=4,this.sleep(1e4);case 4:this.isRecording||(console.log("clearing"),this.recorder.clear()),e.next=1;break;case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"sleep",value:function(e){return new Promise(function(){var t=Object(R.a)(N.a.mark(function t(n,r){return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:setTimeout(function(){n()},e);case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"start",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.recorder.clear(),this.isRecording=!0}},{key:"stop",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(function(){var n=Object(R.a)(N.a.mark(function n(r,a){return N.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.sleep(t);case 2:e.recorder.getBuffer(function(t){var n=e.getSample(t);e.recorder.clear(),e.isRecording=!1,r(n)});case 3:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getSample",value:function(e){var t=e[0].length,n=x.a.Master.context.createBuffer(2,t,x.a.Master.context.sampleRate);n.copyToChannel(e[0],0,0),n.copyToChannel(e[1],1,0);var r=new Dn.a;return r.audioBuffer=n,r}},{key:"input",set:function(e){if(void 0===e)return this.recorder.clear(),this.recorder.stop(),this.recorder=void 0,void(this.isRecording=!1);this.recorder=new window.Recorder(e,{numChannels:2,bufferLen:1024}),this.recorder.record((new Date).getTime()),this.startRecordLoop()}}]),e}();var kE=.025,EE=800;function OE(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:kE,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:EE,a=e.getChannelData(0),i=window.api.create_buffer(a.length);window.Module.HEAPF32.set(a,i>>2),window.api.findLoop(i,a.length,t,n,r);var s=window.api.get_result_pointer(),o=new Uint16Array(window.Module.HEAP16.buffer,s,2);if(console.log("resultView = ",o),0!=o[0]||0!=o[1]){var c={start:o[0],end:o[1],difference:1};return window.api.destroy_buffer(i),c}}function SE(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var PE=6,wE=function(e){Object(u.a)(n,e);var t=SE(n);function n(e,r,a,i){var s;return Object(o.a)(this,n),(s=t.call(this)).cache={},s.sequencerEngine=e,s.store=e.store,s.mixSession=r,s.context=a,s.track=i,s.solutionNumber=0,s.outputNode=new x.a.Gain(1),s.voices=new gE(PE,s.outputNode,Object(W.a)(s)),s.resampler=new bE,s.samplers={},s.interpolationModeParameter=new Be("interpolationMode",Object(W.a)(s),function(e,t){return[]},{min:Mf,max:Af,unit:"",defaultValue:Mf,automatable:!1}),s.registerParameter(s.interpolationModeParameter),s.mixModeParameter=new Ma("mixMode",Object(W.a)(s),function(e,t){return[]},{min:0,prettyName:"Mix Mode",options:{0:rf,.5:tf,1:nf},max:1,unit:"",defaultValue:rf}),s.registerParameter(s.mixModeParameter),s.monophonicParameter=new Be("monophonic",Object(W.a)(s),function(e,t){s.voices.numVoices=t?1:PE},{min:!1,max:!0,unit:"",defaultValue:!1,automatable:!1}),s.registerParameter(s.monophonicParameter),s.detuneSignal=new x.a.Signal(1e3),s.detuneParameter=new Fn("detune",s.detuneSignal,{min:-1e4,max:1e4,defaultValue:0,automationRate:F}),s.registerParameter(s.detuneParameter),s.setupLoopParameters(),s.setupAmpEnvelopeParameters(),s.smoothParameter=new Be("smooth",Object(W.a)(s),function(e,t){var n=1-t;s.voices.voices.forEach(function(e){return e.ampLFO.smooth=n})},{min:0,max:1,unit:"",defaultValue:!1}),s.registerParameter(s.smoothParameter),s.glideParameter=new Be("glide",Object(W.a)(s),function(e,t){return[]},{min:0,max:5e3,unit:"",defaultValue:0}),s.registerParameter(s.glideParameter),s.lastTranspose=void 0,s.triggerCounters={},s}return Object(c.a)(n,[{key:"onAttackChanged",value:function(e){for(var t in this.ampEnvelopes)this.ampEnvelopes[t].attack=e/1e3}},{key:"onDecayChanged",value:function(e){for(var t in this.ampEnvelopes)this.ampEnvelopes[t].decay=e/1e3}},{key:"onSustainChanged",value:function(e){for(var t in this.ampEnvelopes)this.ampEnvelopes[t].sustain=Math.min(.99,e)}},{key:"onReleaseChanged",value:function(e){for(var t in this.ampEnvelopes)this.ampEnvelopes[t].release=e/1e3}},{key:"setupAmpEnvelopeParameters",value:function(){var e=this;this.ampAttackParameter=new Be("ampAttack",this,function(t,n){e.onAttackChanged(n)},{min:0,max:5e3,unit:"",defaultValue:10}),this.registerParameter(this.ampAttackParameter),this.ampDecayParameter=new Be("ampDecay",this,function(t,n){for(var r in e.ampEnvelopes)e.ampEnvelopes[r].decay=n/1e3},{min:0,max:5e3,unit:"",defaultValue:10}),this.registerParameter(this.ampDecayParameter),this.ampSustainParameter=new Be("ampSustain",this,function(t,n){e.onSustainChanged(n)},{min:0,max:1,unit:"",defaultValue:.8}),this.registerParameter(this.ampSustainParameter),this.ampReleaseParameter=new Be("ampRelease",this,function(t,n){e.onReleaseChanged(n)},{min:0,max:5e3,unit:"",defaultValue:10}),this.registerParameter(this.ampReleaseParameter)}},{key:"setupLoopParameters",value:function(){var e=this;this.loopParameter=new Be("loop",this,function(t,n){e.loop=n},{min:!1,max:!0,unit:"",defaultValue:!1}),this.registerParameter(this.loopParameter),this.loopStartParameter=new Be("loopStart",this,function(t,n){Array.from(e.voices.samplersUsed).forEach(function(t){return t.setLoopPoints({loopStart:n,loopLength:e.loopLength})})},{min:0,max:100,unit:"",defaultValue:0}),this.registerParameter(this.loopStartParameter),this.loopLengthParameter=new Be("loopLength",this,function(t,n){Array.from(e.voices.samplersUsed).forEach(function(t){return t.setLoopPoints({loopStart:e.loopStart,loopLength:n})})},{min:0,max:100,unit:"",defaultValue:100}),this.registerParameter(this.loopLengthParameter)}},{key:"onNewStep",value:function(e){var t=this;if(this.currentStep=e,this.oldMixMode!==this.mixMode&&(this.cache={}),this.oldMixMode=this.mixMode,this.onAttackChanged(this.ampAttack),this.onDecayChanged(this.ampDecay),this.onSustainChanged(this.ampSustain),this.onReleaseChanged(this.ampRelease),this.loop&&(this.loopStartParameter.isConnectedToAnyModulator()||this.loopLengthParameter.isConnectedToAnyModulator()||0!==this.loopStartParameter.automations.length||0!==this.loopLengthParameter.automations.length)){var n=1-this.smoothParameter.get();this.voices.voices.filter(function(e){return e.ampLFO.lfo}).forEach(function(e){return e.ampLFO.lfo.min=n}),Array.from(this.voices.samplersUsed).forEach(function(e){return e.setLoopPoints({loopStart:t.loopStart,loopLength:t.loopLength})})}}},{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(){this.outputNode.disconnect()}},{key:"connectToTrack",value:function(e){if(!e)return this.connectedTrack=void 0,void(this.resampler.input=void 0);this.connectedTrack=e,this.resampler.input=e.volumeNode}},{key:"getInstrument",value:function(){return this}},{key:"getInstrumentType",value:function(){return sp}},{key:"getName",value:function(){return"Sampled Instrument"}},{key:"getPitchEnvelope",value:function(e){if(0!==this.glide){var t=100*((void 0===this.lastTranspose?e:this.lastTranspose)-e),n=new x.a.ScaledEnvelope({attack:this.glide/1e3,decay:.01,min:t,max:0,sustain:1,release:0,curve:"linear"});return n._releaseCurve="linear",n._decayCurve="linear",n}}},{key:"triggerAttack",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x.a.Master.context.currentTime,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=this.getSampler(e,!1),i=a.samplers,s=a.closest;if(void 0!==i){var o=this.getPitchEnvelope(e);for(var c in this.lastTranspose=parseFloat(e),this.monophonic&&this.releaseAll(t),i)i[c].sampler.attack=this.ampAttack/1e3,i[c].sampler.release=this.ampRelease/1e3,this.voices.triggerAttack(i[c],e-s,t,n,this.getLoopPoints(r,i[c]),o)}}},{key:"playSampler",value:function(e){this.voices.triggerAttack(e,0,0,1,0,void 0)}},{key:"triggerAttackRelease",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n,r,a,i){var s,o,c,u,l,p;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=this.getSampler(t,!0),o=s.samplers,c=s.closest,void 0!==o){e.next=3;break}return e.abrupt("return");case 3:for(l in u=this.getPitchEnvelope(t),this.lastTranspose=parseFloat(t),this.monophonic&&this.releaseAll(r),o)(p=o[l]).sampler.release=this.ampRelease/1e3,p.sampler.attack=this.ampAttack/1e3,this.voices.triggerAttackRelease(p,t-c,n,r,a,this.getLoopPoints(i,p),u,i);case 7:case"end":return e.stop()}},e,this)}));return function(t,n,r,a,i){return e.apply(this,arguments)}}()},{key:"getLoopPoints",value:function(e,t){return{start:e,loopStart:this.loopStart,loopLength:this.loopLength,loopLengthSeconds:(t.endTime-t.startTime)*(this.loopLength/100)}}},{key:"triggerRelease",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r,a,i,s,o,c,u=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=u.length>0&&void 0!==u[0]?u[0]:[0],e.t0=N.a.keys(t);case 2:if((e.t1=e.t0()).done){e.next=11;break}if(n=e.t1.value,r=t[n],a=this.getSampler(r,!0),i=a.samplers,s=a.closest,void 0!==i){e.next=8;break}return e.abrupt("continue",2);case 8:for(o in i)c=i[o],this.voices.triggerRelease(c,[r-s]);e.next=2;break;case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"releaseAll",value:function(e){for(var t in this.voices.clear(),this.samplers){this.samplers[t].forEach(function(t){t.get(0).releaseAll(e,.01)})}}},{key:"newSample",value:function(e,t,n){var r=this;return new Promise(function(){var a=Object(R.a)(N.a.mark(function a(i,s){var o,c;return N.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t=t.getCopy(),r.track.samplesStream=n||new Mn(t,r.sequencerEngine),void 0!==t.audioBuffer){a.next=5;break}return a.next=5,t.fetchAudio();case 5:o={slices:void 0,offset:0,transpose:0,volume:0},(c=new fE(r.track,t,function(){return[]},void 0,o)).samplesStream=n,setTimeout(Object(R.a)(N.a.mark(function n(){var a,s;return N.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(c.init(),r.detuneSignal.connect(c.detuneSignal.input),r.detuneParameter.set(r.detuneParameter.get()),void 0===e){n.next=10;break}return n.next=6,r.getPitch(t);case 6:void 0===(a=n.sent)?void 0===e&&(e=0):(void 0===e&&(e=a),(s=e-a)<-30&&(s+=36),c.transpose=s),n.next=11;break;case 10:void 0===e&&(e=0);case 11:r.cache={},void 0===r.samplers[e]&&(r.samplers[e]=[]),r.samplers[e]=[].concat(Object(M.a)(r.samplers[e]),[c]),r.selectSampler(e,c),i({sampler:c,samplers:r.samplers[e]});case 16:case"end":return n.stop()}},n)})),500);case 9:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"getTriggerCount",value:function(e){return this.triggerCounters[e]||0}},{key:"getAllSamplersAtExactTranspose",value:function(e){var t=this.samplers[e];return this.mixMode===nf&&(t=this.samplers[e].filter(function(e){return e.on})),t}},{key:"filterNeededSamplers",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0!==e){if(this.mixMode===rf){var r=[e[this.getTriggerCount(t)%e.length]];return n&&(this.triggerCounters[t]=this.getTriggerCount(t)+1),r}return e}}},{key:"getSampler",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e in this.cache){var n=this.cache[e];return Object(D.a)({},n,{samplers:this.filterNeededSamplers(n.samplers,e,t)})}var r=e;e in this.samplers||(r=this.findClosest(e));var a=this.getAllSamplersAtExactTranspose(r);return this.cache[e]={closest:parseFloat(r),samplers:a},{closest:parseFloat(r),samplers:this.filterNeededSamplers(a,e,t)}}},{key:"findClosest",value:function(e){return this.interpolationMode===Mf?function(e,t){var n=void 0,r=void 0;for(var a in t){a=parseInt(a);var i=Math.abs(e-a);void 0!==n?i<r&&(n=a,r=i):(n=a,r=i)}return parseFloat(n)}(e,this.samplers):function(e,t){var n=_i.a.fromTranspose(e);n.octave=0;var r=void 0,a=void 0,i=void 0;for(var s in t){var o=_i.a.fromTranspose(s);o.octave=0;var c=Math.abs(n.getTranspose()-o.getTranspose()),u=Math.abs(e-s);(void 0===i||c<i||c===i&&u<a)&&(r=s,i=c,a=u)}return parseFloat(r)}(e,this.samplers)}},{key:"getJson",value:function(){var e=Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{ampAttack:this.ampAttack,ampDecay:this.ampDecay,ampSustain:this.ampSustain,ampRelease:this.ampRelease,interpolationMode:this.interpolationMode,mixMode:this.mixMode,samplers:{},glide:this.glide,monophonic:this.monophonic,detune:this.detuneParameter.get(),loopStart:this.loopStart,loopLength:this.loopLength,loop:this.loopParameter.get(),smooth:this.smoothParameter.get()});for(var t in this.samplers)e.samplers[t]=this.samplers[t].map(function(e){return e.getJson()});return e=sr(e,"ampAttackParameter",this.ampAttackParameter),e=sr(e,"ampDecayParameter",this.ampDecayParameter),e=sr(e,"ampSustainParameter",this.ampSustainParameter),e=sr(e,"ampReleaseParameter",this.ampReleaseParameter),e=sr(e,"interpolationModeParameter",this.interpolationModeParameter),e=sr(e,"mixModeParameter",this.mixModeParameter),e=sr(e,"glideParameter",this.glideParameter),e=sr(e,"monophonicParameter",this.monophonicParameter),e=sr(e,"detuneParameter",this.detuneParameter),e=sr(e,"loopStartParameter",this.loopStartParameter),e=sr(e,"loopLengthParameter",this.loopLengthParameter),e=sr(e,"smoothParameter",this.smoothParameter),e=sr(e,"loopParameter",this.loopParameter)}},{key:"fromJson",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r,a;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.clearSamples(),this.ampAttackParameter.set(t.ampAttack),this.ampDecayParameter.set(t.ampDecay),this.ampSustainParameter.set(t.ampSustain),this.ampReleaseParameter.set(t.ampRelease),void 0!==t.loopStart&&this.loopStartParameter.set(t.loopStart),void 0!==t.loopLength&&this.loopLengthParameter.set(t.loopLength),void 0!==t.loop&&this.loopParameter.set(t.loop),t.interpolationMode&&(this.interpolationMode=t.interpolationMode),void 0!==t.mixMode&&(this.mixMode=Object(B.a)(t.mixMode)?rf:t.mixMode),void 0!==t.glide&&(this.glide=t.glide),void 0!==t.monophonic&&(this.monophonic=t.monophonic),void 0!==t.smooth&&this.smoothParameter.set(t.smooth),or(t,"ampAttackParameter",this.ampAttackParameter,this.sequencerEngine),or(t,"ampDecayParameter",this.ampDecayParameter,this.sequencerEngine),or(t,"ampSustainParameter",this.ampSustainParameter,this.sequencerEngine),or(t,"ampReleaseParameter",this.ampReleaseParameter,this.sequencerEngine),or(t,"interpolationModeParameter",this.interpolationModeParameter),or(t,"mixModeParameter",this.mixModeParameter),or(t,"glideParameter",this.glideParameter,this.sequencerEngine),or(t,"monophonicParameter",this.monophonicParameter,this.sequencerEngine),or(t,"detuneParameter",this.detuneParameter,this.sequencerEngine),or(t,"loopStartParameter",this.loopStartParameter,this.sequencerEngine),or(t,"loopLengthParameter",this.loopLengthParameter,this.sequencerEngine),or(t,"loopParameter",this.loopParameter,this.sequencerEngine),or(t,"smoothParameter",this.smoothParameter,this.sequencerEngine),e.t0=N.a.keys(t.samplers);case 27:if((e.t1=e.t0()).done){e.next=44;break}if(n=e.t1.value,void 0===t.samplers[n].length){e.next=40;break}e.t2=N.a.keys(t.samplers[n]);case 31:if((e.t3=e.t2()).done){e.next=38;break}return r=e.t3.value,a=t.samplers[n][r],e.next=36,this.loadSamplerFromJson(parseFloat(n),a);case 36:e.next=31;break;case 38:e.next=42;break;case 40:return e.next=42,this.loadSamplerFromJson(parseFloat(n),t.samplers[n]);case 42:e.next=27;break;case 44:this.samples=Object(D.a)({},this.samplers),this.loop=this.loop,void 0!==t.detune?this.detuneParameter.set(t.detune):this.detuneParameter.set(0);case 47:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadSamplerFromJson",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r,a;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Dn.a(n.sampleId,this.sequencerEngine.encryptedIpfs),e.prev=1,e.next=4,r.load();case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return");case 9:(a=new fE(this.track,r,function(){return[]},n.slices,n)).init(void 0,void 0,!0),this.detuneSignal.connect(a.detuneSignal,0,0),void 0===this.samplers[t]&&(this.samplers[t]=[]),this.samplers[t].push(a),this.cache={};case 15:case"end":return e.stop()}},e,this,[[1,6]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearSamples",value:function(){for(var e in this.samplers){for(var t in this.samplers[e])this.samplers[e][t].dispose();delete this.samplers[e]}}},{key:"dispose",value:function(){this.clearSamples(),this.voices.dispose(),this.voices=void 0,this.samplers=void 0,this.outputNode.dispose(),this.outputNode=void 0}},{key:"getPitch",value:function(e){var t=this;arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(){var n=Object(R.a)(N.a.mark(function n(r,a){var i,s,o;return N.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0===(i=t.getNoteFromName(e.name))){n.next=4;break}return r(i),n.abrupt("return");case 4:return r(void 0),n.abrupt("return");case 10:(s=n.sent).notes.length>0&&(s.notes.sort(function(e,t){return t.endTime-t.starTime-(e.endTime-e.startTime)}),o=s.notes[0].pitch-48,r(o)),r(void 0);case 13:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"deleteSampler",value:function(e){for(var t in this.samplers){var n=this.samplers[t].indexOf(e);n>-1&&(this.samplers[t].splice(n,1),e.dispose()),0===this.samplers[t].length&&delete this.samplers[t]}this.cache={},this.voices.clear()}},{key:"selectSampler",value:function(e,t){this.cache={},this.samplers[e].filter(function(e){return e!==t}).forEach(function(e){return e.on=!1}),t.on=!0}},{key:"getNoteFromName",value:function(e){var t=void 0;if(2===e.length?t=e.substring(0,1):3===e.length&&(t=e.substring(0,2)),t&&_i.a.baseNotes.indexOf(t)>-1)return _i.a.fromString(e).getTranspose()}},{key:"findLoop",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n,r){var a,i,s,o,c;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(this.solutionNumber+=500,t=this.solutionNumber),a=this.getAllSamplersAtExactTranspose(0)[0],i=OE(a.audioBuffer,t,n,r),s=i.start,!((o=i.end)<s)){e.next=7;break}return this.solutionNumber=Math.ceil(10*Math.random()),this.findLoop(void 0,n,r),e.abrupt("return");case 7:c=100*s/(x.a.Master.context.sampleRate*a.getDuration()),this.loopStartParameter.set(c),this.loopLengthParameter.set(100*(o-s)/(x.a.Master.context.sampleRate*a.getDuration()));case 10:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getCopy",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,r,a=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:this.context,r=new n(this.sequencerEngine,this.mixSession,t,t.track),e.next=4,r.fromJson(this.getJson());case 4:return e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"makePublicIfNeeded",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n,r,a,i,s,o;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=N.a.keys(this.samplers);case 1:if((e.t1=e.t0()).done){e.next=22;break}t=e.t1.value,n=this.samplers[t],e.t2=N.a.keys(n);case 5:if((e.t3=e.t2()).done){e.next=20;break}return r=e.t3.value,a=this.samplers[t][r],i=a.sample,e.next=11,d.a.guildSamples.getGuildIdForSound(i.getId());case 11:if(void 0===(s=e.sent)||0===s){e.next=18;break}return console.log("guildId foor sample=%s was =%s so saving",i.getId(),s),e.next=16,d.a.guildSamples.saveSample(i);case 16:o=e.sent,i.ipfsHash=o;case 18:e.next=5;break;case 20:e.next=1;break;case 22:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"allSamplers",get:function(){var e=[];for(var t in this.samplers)e=[].concat(Object(M.a)(e),Object(M.a)(this.samplers[t]));return e}},{key:"loop",get:function(){return this.allSamplers.every(function(e){return e.loop})},set:function(e){this.allSamplers.forEach(function(t){return t.loop=e})}},{key:"ampEnvelopes",get:function(){return this.voices.ampEnvelopes}},{key:"loopStart",get:function(){return this.loopStartParameter.getAtStep(this.currentStep)}},{key:"loopLength",get:function(){return this.loopLengthParameter.getAtStep(this.currentStep)}},{key:"glide",get:function(){return this.glideParameter.getAtStep(this.trackStep)},set:function(e){this.glideParameter.set(e)}},{key:"interpolationMode",get:function(){return this.interpolationModeParameter.getAtStep(this.trackStep)},set:function(e){this.interpolationModeParameter.set(e),this.cache={}}},{key:"monophonic",get:function(){return this.monophonicParameter.get()},set:function(e){this.monophonicParameter.set(e)}},{key:"mixMode",get:function(){return this.mixModeParameter.get()},set:function(e){this.mixModeParameter.set(e),this.cache={}}},{key:"trackStep",get:function(){return this.sequencerEngine.trackStep}},{key:"ampAttack",get:function(){return this.ampAttackParameter.getAtStep(this.currentStep)}},{key:"ampDecay",get:function(){return this.ampDecayParameter.getAtStep(this.currentStep)}},{key:"ampSustain",get:function(){return this.ampSustainParameter.getAtStep(this.currentStep)}},{key:"ampRelease",get:function(){return this.ampReleaseParameter.getAtStep(this.currentStep)}},{key:"numberOfSamplers",get:function(){var e=0;for(var t in this.samplers)e+=this.samplers[t].length;return e}},{key:"defaultSampler",get:function(){var e=Object.keys(this.samplers)[0];if(void 0!==e)return this.samplers[e][0]}}]),n}(Hk);function jE(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var TE=d.a.presets,xE=function(e){Object(u.a)(n,e);var t=jE(n);function n(e,r,a,i,s,c){var u;!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return Object(o.a)(this,n),(u=t.call(this,e,r,a,i,s,c,!1)).setInstrument(new wE(r,a,(new Wr).forTrack(Object(W.a)(u)),Object(W.a)(u))),u.name="Sampled Instrument",u}return Object(c.a)(n,[{key:"auditionPreset",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.name,e.next=3,TE.getPresetData(t);case 3:r=e.sent,this.fromJson(r.trackParameters),this.presetName=n,this.update();case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fromJson",value:function(){var e=Object(R.a)(N.a.mark(function e(t,r){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,t,r);case 2:this.instrument.defaultSampler&&(this.sample=this.instrument.defaultSampler.sample);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadTrackInfo",value:function(e,t){var n=this.selectedSampler||this.instrument.defaultSampler;n&&(this.sample=t,n.auditionSound(t),this.presetName=t.name,this.sequencerEngine.update())}},{key:"restart",value:function(){this.instrument.triggerCounters={},this.instrument.cache={},this.instrument.voices.clear()}},{key:"start",value:function(){Object(q.a)(Object(p.a)(n.prototype),"start",this).call(this),this.restart()}},{key:"onNewStep",value:function(e){Object(q.a)(Object(p.a)(n.prototype),"onNewStep",this).call(this),this.instrument.onNewStep(e)}},{key:"getSamplesStream",value:function(){var e=this.selectedSampler||this.instrument.defaultSampler;return e?e.samplesStream:this.samplesStream}},{key:"getCopy",value:function(){var e=Object(R.a)(N.a.mark(function e(){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(q.a)(Object(p.a)(n.prototype),"getCopy",this).call(this,function(e,t,r,a,i,s){return new n(e,t,r,a,i,s)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"makePublicIfNeeded",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.instrument.makePublicIfNeeded(),e.t0=N.a.keys(this.effectsChains);case 2:if((e.t1=e.t0()).done){e.next=8;break}return t=e.t1.value,e.next=6,this.effectsChains[t].makePublicIfNeeded();case 6:e.next=2;break;case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"tempo",get:function(){var e=this.selectedSampler||this.instrument.defaultSampler;return void 0===e?0:e.tempo}}]),n}(Gk),CE=function(){function e(t,n){Object(o.a)(this,e),this.track=t,this.instrumentRack=n,this.track.instrumentRack=this.instrumentRack,this.sequencerEngine=t.sequencerEngine,this.store=this.sequencerEngine.store,this.parameters=[],this.volumeParameter=new Fn("volume",this.track.volumeNode.volume,{min:0,max:1,unit:"db",defaultValue:0}),this.registerParameter(this.volumeParameter),this.track.effectsChains[0].parameterContext=(new Wr).forTrack(n);var r=this.track.instrument.parameters;for(var a in r)r[a].setContext(r[a].context.forSubDevice(r[a].track).forTrack(n));this.track.instrumentRack=n}return Object(c.a)(e,[{key:"getName",value:function(){return this.track.getName()}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setContext((new Wr).forTrack(this.instrumentRack)),this.parameters.push(e)}},{key:"getJson",value:function(){var e={track:this.track.getJson(),effectsChains:this.track.effectsChains.map(function(e){return e.getJson()}),midiEffects:this.track.midiEffects.getJson(),volume:this.volumeParameter.get(),sendVolumes:this.track.getSendNodes().map(function(e){return e.volume.value})};return e=sr(e,"volumeParameter",this.volumeParameter)}},{key:"fromJson",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r,a;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.track.fromJson(t.track,!1);case 2:if(this.track.effectsChains[0].clear(),this.track.effectsChains[0].fromJson(t.effectsChains[0],this.sequencerEngine.tracks,n),this.track.midiEffects.fromJson(t.midiEffects),this.volumeParameter.set(t.volume),t.sendVolumes)for(r=this.track.getSendNodes(),a=0;a<Math.min(t.sendVolumes.length,r.length);a++)r[a].volume.value=t.sendVolumes[a];or(t,"volumeParameter",this.volumeParameter,this.sequencerEngine);case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getCopy",value:function(){var t=Object(R.a)(N.a.mark(function t(){var n,r,a;return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.track.getCopy();case 2:return n=t.sent,r=new e(n,this.instrumentRack),a=this.getJson(),t.next=7,r.fromJson(a);case 7:return t.abrupt("return",r);case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"getAllParameters",value:function(){return[].concat(Object(M.a)(this.parameters),Object(M.a)(this.track.getAllParameters()))}},{key:"effectsChains",get:function(){return this.track.effectsChains}},{key:"presetName",get:function(){return this.track.presetName}},{key:"trackNumber",get:function(){return this.track.trackNumber}}]),e}();function NE(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.numberOfPatterns(),a=void 0;if(t===zr.b)switch(n){case up:a=new uE(e.tracks.length,e,e.mixSession,r,function(){return e.update()},e.currentSubSequence);break;case cp:a=new nE(e.tracks.length,e,e.mixSession,r,function(){return e.update()},e.currentSubSequence);break;case op:a=new Gk(e.tracks.length,e,e.mixSession,r,function(){return e.update()},e.currentSubSequence);break;case sp:a=new xE(e.tracks.length,e,e.mixSession,r,function(){return e.update()},e.currentSubSequence)}else t===zr.c&&(a=new qE(e.tracks.length,e,e.mixSession,r,function(){return e.update()},e.currentSubSequence));if(void 0!==a)return a}function RE(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var DE=d.a.presets,qE=function(e){Object(u.a)(n,e);var t=RE(n);function n(e,r,a,i,s,c){var u;!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return Object(o.a)(this,n),(u=t.call(this,e,r,a,i,s,c)).setupEffects(),u.tracks=[],u.name="Instrument Rack",u}return Object(c.a)(n,[{key:"addPreset",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r,a,i;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.name,e.next=3,DE.getPresetData(t);case 3:return r=e.sent,e.next=6,this.sequencerEngine.loadTrackPreset(r,void 0,!0,!1,n);case 6:return(a=e.sent).presetName=n,i=new CE(a,this),e.abrupt("return",this.addInstrument(i));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addSample",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=this.addInstrumentType(sp)).track.instrument.newSample(0,t),n.track.presetName=t.name,e.abrupt("return",n);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSubDevices",value:function(){return this.tracks.map(function(e){return{value:e,label:e.presetName||e.getName()}})}},{key:"getSubDeviceIndex",value:function(e){return this.tracks.indexOf(e)}},{key:"getSubDevice",value:function(e){return this.tracks[e]}},{key:"getSamplesStream",value:function(){var e=this.getSelectedTrack();if(e)return e.track.samplesStream}},{key:"getSelectedTrack",value:function(){return this.sequencerEngine.state.tracks.selectedRackSubTrack[this.id]}},{key:"loadTrackInfo",value:function(e,t){var n=this.getSelectedTrack();n?(n.track.loadTrackInfo(e,t),this.tracks=Object(M.a)(this.tracks)):(this.addSample(t),this.tracks=Object(M.a)(this.tracks)),this.updateSteps()}},{key:"addInstrumentType",value:function(e){var t=NE(this.sequencerEngine,"INSTRUMENT",e);t.setSends(this.sequencerEngine.sends),t.effectsChains[0].clear();var n=new CE(t,this);return this.addInstrument(n)}},{key:"getName",value:function(){return"Instrument Rack"}},{key:"getTrackType",value:function(){return zr.c}},{key:"addInstrument",value:function(e){var t=e.track;return t.trackNumber=this.tracks.length,this.tracks=[].concat(Object(M.a)(this.tracks),[e]),t.muteableNode.connect(this.gainNode),t.group=this,e}},{key:"deleteInstrument",value:function(e){var t=this.tracks.indexOf(e);-1!==t&&(this.tracks.splice(t,1),e.track.dispose())}},{key:"liveTrigger",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.tracks.forEach(function(t){return t.track.midiEffects.liveInputTrigger(e)})}},{key:"releaseAll",value:function(e){this.tracks.forEach(function(t){return t.track.releaseAll(e)})}},{key:"liveTriggerRelease",value:function(e,t){this.tracks.forEach(function(n){return n.track.midiEffects.liveInputRelease(e,t)})}},{key:"trigger",value:function(e,t,n){this.tracks.forEach(function(r){return r.track.midiEffects.input(e,t,n)})}},{key:"triggerSamples",value:function(e,t){this.tracks.forEach(function(n){return n.track.triggerSamples(e,t)})}},{key:"triggerSlice",value:function(e){this.tracks.forEach(function(t){return t.track.triggerSlice(e)})}},{key:"triggerSample",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.tracks.forEach(function(r){return r.track.triggerSample(e,t,n)})}},{key:"triggerRelease",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.tracks.forEach(function(n){return n.track.triggerRelease(e,t)})}},{key:"getJson",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this);return e.tracks=this.tracks.map(function(e){return e.getJson()}),e}},{key:"onBPMUpdated",value:function(){for(var e in this.effectsChains.forEach(function(e){return e.onBPMUpdated()}),this.tracks)for(var t in this.tracks[e].effectsChains)this.tracks[e].effectsChains[t].onBPMUpdated()}},{key:"fromJson",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var r,a,i,s,o,c;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Object(q.a)(Object(p.a)(n.prototype),"fromJson",this).call(this,t),this.store.dispatch(Object(O.Ld)(this.subSequence.id,this.trackNumber,!0)),e.t0=N.a.keys(t.tracks);case 3:if((e.t1=e.t0()).done){e.next=14;break}return r=e.t1.value,a=t.tracks[r].track,i=a.type,s=a.instrumentType,(o=NE(this.sequencerEngine,i,s)).setSends(this.sequencerEngine.sends),c=new CE(o,this),e.next=11,c.fromJson(t.tracks[r],!1);case 11:this.addInstrument(c),e.next=3;break;case 14:this.store.dispatch(Object(O.Ld)(this.subSequence.id,this.trackNumber,!1));case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onNewStep",value:function(e){Object(q.a)(Object(p.a)(n.prototype),"onNewStep",this).call(this),this.tracks.forEach(function(t){return t.track.onNewStep(e)})}},{key:"onStepEnded",value:function(e,t){var n=this,r=function(r){var a=n.tracks[r].track;a.midiEffects.output(e,t,t).forEach(function(e){return a.trigger(e.stepData,e.time,t)})};for(var a in this.tracks)r(a)}},{key:"start",value:function(){Object(q.a)(Object(p.a)(n.prototype),"start",this).call(this),this.tracks.forEach(function(e){return e.track.start()})}},{key:"solo",value:function(e){Object(q.a)(Object(p.a)(n.prototype),"solo",this).call(this,e),this.tracks.forEach(function(t){return t.track.solo(e,void 0,!1)})}},{key:"getCopy",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getCopy",this).call(this,function(e,t,r,a,i,s){return new n(e,t,r,a,i,s)});return e.fromJson(this.getJson()),e}},{key:"getAllParameters",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getAllParameters",this).call(this);for(var t in this.tracks)e=[].concat(Object(M.a)(e),Object(M.a)(this.tracks[t].getAllParameters()));return e}},{key:"instrument",get:function(){return this}},{key:"inputNode",get:function(){return this.gainNode}}]),n}(Zb);function ME(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var AE=function(e){Object(u.a)(n,e);var t=ME(n);function n(e,r,a){var i;return Object(o.a)(this,n),(i=t.call(this)).sequencerEngine=e,i.store=e.store,i.mixSession=r,i.context=a,i.synth=new x.a.MetalSynth,i.setupParameters(),i}return Object(c.a)(n,[{key:"getInstrumentType",value:function(){return lp}},{key:"getName",value:function(){return"Metal Synth"}},{key:"setupParameters",value:function(){var e=this;this.frequencyParameter=new Be("Frequency",this,function(t,n){return e.synth.frequency.value=n},{min:0,max:15e3,unit:"",defaultValue:200}),this.registerParameter(this.frequencyParameter),this.resonanceParameter=new Be("Resonance",this,function(t,n){return e.synth.resonance=n},{min:0,max:1e4,unit:"",defaultValue:100}),this.registerParameter(this.resonanceParameter),this.harmonicityParameter=new Be("Harmonicity",this,function(t,n){return e.synth.harmonicity=n},{min:0,max:200,unit:"",defaultValue:100}),this.registerParameter(this.harmonicityParameter),this.modulationIndexParameter=new Be("Modulation Index",this,function(t,n){return e.synth.modulationIndex=n},{min:0,max:200,unit:"",defaultValue:20}),this.registerParameter(this.modulationIndexParameter),this.attackParameter=new Be("Attack",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:10}),this.registerParameter(this.attackParameter),this.decayParameter=new Be("Decay",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:200}),this.registerParameter(this.decayParameter),this.sustainParameter=new Be("Sustain",this,function(e,t){return t},{min:0,max:1,unit:"",defaultValue:1}),this.registerParameter(this.sustainParameter),this.releaseParameter=new Be("Release",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:1e3}),this.registerParameter(this.releaseParameter)}},{key:"setEnvelopes",value:function(e){var t=this,n=this.getEnvelopes();n.forEach(function(e){return e.attack=new x.a.Time((1+t.ampAttack)/1e3)}),n.forEach(function(e){return e.release=new x.a.Time((1+t.ampRelease)/1e3)}),n.forEach(function(e){return e.sustain=t.ampSustain}),n.forEach(function(e){return e.decay=new x.a.Time((1+t.ampDecay)/1e3)})}},{key:"getInstrument",value:function(){return this.synth}},{key:"getEnvelopes",value:function(){return[this.synth.envelope]}},{key:"hasNotes",value:function(){return!1}},{key:"getJson",value:function(){var e=Object(D.a)({},Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this),{frequency:this.frequency,resonance:this.resonance,harmonicity:this.harmonicity,modulationIndex:this.modulationIndex,ampAttack:this.ampAttack,ampDecay:this.ampDecay,ampSustain:this.ampSustain,ampRelease:this.ampRelease});return e=sr(e,"frequencyParameter",this.frequencyParameter),e=sr(e,"resonanceParameter",this.resonanceParameter),e=sr(e,"harmonicityParameter",this.harmonicityParameter),e=sr(e,"modulationIndexParameter",this.modulationIndexParameter),e=sr(e,"attackParameter",this.attackParameter),e=sr(e,"decayParameter",this.decayParameter),e=sr(e,"sustainParameter",this.sustainParameter),e=sr(e,"releaseParameter",this.releaseParameter)}},{key:"fromJson",value:function(e){this.frequency=e.frequency,this.resonance=e.resonance,this.harmonicity=e.harmonicity,this.modulationIndex=e.modulationIndex,this.ampAttack=e.ampAttack,this.ampDecay=e.ampDecay,this.ampSustain=e.ampSustain,this.ampRelease=e.ampRelease,or(e,"frequencyParameter",this.frequencyParameter),or(e,"resonanceParameter",this.resonanceParameter),or(e,"modulationIndexParameter",this.modulationIndexParameter),or(e,"harmonicityParameter",this.harmonicityParameter),or(e,"attackParameter",this.attackParameter),or(e,"decayParameter",this.decayParameter),or(e,"sustainParameter",this.sustainParameter),or(e,"releaseParameter",this.releaseParameter)}},{key:"frequency",get:function(){return this.frequencyParameter.get()},set:function(e){this.frequencyParameter.set(e)}},{key:"resonance",get:function(){return this.resonanceParameter.get()},set:function(e){this.resonanceParameter.set(e)}},{key:"harmonicity",get:function(){return this.harmonicityParameter.get()},set:function(e){this.harmonicityParameter.set(e)}},{key:"modulationIndex",get:function(){return this.modulationIndexParameter.get()},set:function(e){this.modulationIndexParameter.set(e)}},{key:"ampAttack",get:function(){return this.attackParameter.get()},set:function(e){this.attackParameter.set(e)}},{key:"ampDecay",get:function(){return this.decayParameter.get()},set:function(e){this.decayParameter.set(e)}},{key:"ampSustain",get:function(){return this.sustainParameter.get()},set:function(e){this.sustainParameter.set(e)}},{key:"ampRelease",get:function(){return this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e)}}]),n}(Hk);function IE(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var LE=function(e){Object(u.a)(n,e);var t=IE(n);function n(e,r,a,i,s,c){var u;return Object(o.a)(this,n),(u=t.call(this,e,r,a,i,s,c)).setInstrument(new AE(r,a,(new Wr).forTrack(Object(W.a)(u)))),u}return n}(Gk),FE=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return new _i.a.Note(e,t)},BE={},HE=[FE("C"),FE("D"),FE("D#"),FE("F"),FE("G"),FE("G#"),FE("A#")],VE=function(){function e(t){Object(o.a)(this,e),this.scale=this.calculateScale()}return Object(c.a)(e,[{key:"getSendsToShow",value:function(){return[4,5,6]}},{key:"newScale",value:function(e){this.scale=this.calculateScale(e.map(function(e){return FE(e)}))}},{key:"getScale",value:function(){return Object(M.a)(this.scale)}},{key:"calculateScale",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:HE,t=[],n=e.length<=5?4:3,r=function(n){t=[].concat(Object(M.a)(t),Object(M.a)(e.map(function(e){return e.addTranspose(12*n)})))},a=0;a<n;a++)r(a);return t}},{key:"snapTransposeToScale",value:function(e){if(e=Math.round(e),void 0!==BE[e])return BE[e];var t=this.getScale().map(function(e){return e.getTranspose()}),n=t[0];for(var r in t){var a=t[r];Math.abs(a-e)<Math.abs(n-e)&&(n=a)}return BE[e]=n,n}}]),e}();function UE(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var JE=function(e){Object(u.a)(n,e);var t=UE(n);function n(e,r,a,i,s,c){var u;return Object(o.a)(this,n),(u=t.call(this,e,r,a,i,s,c)).setupEffects(),u}return Object(c.a)(n,[{key:"isRecorable",value:function(){return!0}},{key:"getCopy",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getCopy",this).call(this,function(e,t,r,a,i,s){return new n(e,t,r,i,a,i,s)});return e.selectedRecording=this.selectedRecording,e}},{key:"getName",value:function(){return"Audio Track"}},{key:"getSelectedRecording",value:function(){return this.selectedRecording}},{key:"setSelectedRecording",value:function(e){this.selectedRecording=e}},{key:"getRecordings",value:function(){return Object(q.a)(Object(p.a)(n.prototype),"getSamplers",this).call(this)}},{key:"getJson",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getJson",this).call(this);return e.selectedRecording=this.selectedRecording,e}},{key:"fromJson",value:function(e){this.selectedRecording=e.selectedRecording}},{key:"getSelectedRecordingSampler",value:function(){return Object(q.a)(Object(p.a)(n.prototype),"getSamplers",this).call(this)[this.selectedRecording]}},{key:"getSelectedRecordingSoundId",value:function(){return this.soundIds[this.selectedRecording]}},{key:"getSamplers",value:function(){var e=Object(q.a)(Object(p.a)(n.prototype),"getSamplers",this).call(this);return e.length>0?[e[this.selectedRecording]]:e}},{key:"getTrackType",value:function(){return zr.a}},{key:"selectedRecording",get:function(){return this.trackData.selectedRecording},set:function(e){this.trackData.selectedRecording=e}}]),n}(Mk),_E=["A","B","C","D","E","F","G","H"],GE=function(){function e(t,n,r){Object(o.a)(this,e),this.sends=[],this.channelMixer=n,this.sequencerEngine=r,this.masterBus=new zE("Master Bus",void 0,void 0,void 0,r);var a=new zE("A",this.masterBus,n,0,r),i=new kr(r);i.enable(!0),i.setWet(1),a.addEffect(i);var s=new zE("B",this.masterBus,n,1,r),c=new Zn(r);c.enable(!0),c.setWet(1),s.addEffect(c),this.sends.push(a),this.sends.push(s),a.setSends(this),s.setSends(this)}return Object(c.a)(e,[{key:"createNewSend",value:function(){var e=new zE(_E[this.sends.length],this.masterBus,this.channelMixer,this.sends.length,this.sequencerEngine);for(var t in e.setSends(this),this.sends.push(e),this.sequencerEngine.subSequences){var n=this.sequencerEngine.subSequences[t];for(var r in n.tracks)n.tracks[r].newSend(e)}}},{key:"dispose",value:function(){this.sends.forEach(function(e){return e.dispose()}),this.masterBus.dispose(),this.sends=void 0}},{key:"getSends",value:function(){return this.sends}},{key:"getJson",value:function(){return this.sends.map(function(e){return e.getJson()})}},{key:"loadFromJson",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<t.length)){e.next=9;break}return r=t[n],n>=this.sends.length&&this.createNewSend(),e.next=6,this.sends[n].fromJson(r);case 6:n++,e.next=1;break;case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),zE=function(){function e(t,n,r,a,i){Object(o.a)(this,e),this.name=t,this.sequencerEngine=i,this.sendNumber=a,this.inputVolume=new x.a.Volume(0),this.outputVolume=new x.a.Volume(0),this.muteableNode=new x.a.Volume(0),this.muteableNode.connect(this.outputVolume),this.tracks=[],this.muted=!1,this.effectsChain=new wa(this.inputVolume,this.muteableNode,(new Wr).forSend(this),i),void 0===n?this.inputVolume.connect(this.outputVolume):this.outputs=r.connect(this.outputVolume),this.sendNodes=[],this.channelMixer=r}return Object(c.a)(e,[{key:"dispose",value:function(){this.inputVolume.dispose(),this.outputVolume.dispose(),this.muteableNode.dispose(),this.effectsChain.dispose(),this.effectsChain=void 0,this.inputVolume=void 0,this.outputVolume=void 0,this.muteableNode=void 0,this.effectsChain=void 0}},{key:"newSend",value:function(e){var t=new x.a.Volume(-100);this.outputVolume.connect(t),e.connectToTrack(t),this.sendNodes.push(t)}},{key:"getSendNodes",value:function(){return this.sendNodes}},{key:"setSends",value:function(e){this.sends=e}},{key:"moveEffectTo",value:function(e,t){this.effectsChain.moveEffectTo(e,t)}},{key:"deleteEffect",value:function(e){this.effectsChain.deleteEffect(e)}},{key:"mute",value:function(e){this.muted=e,this.muteableNode.volume.value=e?-120:0}},{key:"updateEffects",value:function(){this.effectsChain.updateEffects()}},{key:"getVolume",value:function(){return this.outputVolume.volume.value}},{key:"setVolume",value:function(e){this.outputVolume.volume.value=e}},{key:"connectToTrack",value:function(e,t){(t=t||!1)&&e.disconnect(this.inputVolume),e.connect(this.inputVolume)}},{key:"getEffects",value:function(){return this.effectsChain.effects}},{key:"getName",value:function(){return this.name}},{key:"addEffect",value:function(e){this.effectsChain.addEffect(e)}},{key:"getLastEffect",value:function(){return 0==this.effectsChain.effects.length?this.inputVolume:this.effectsChain.effects[this.effectsChain.effects.length-1]}},{key:"getJson",value:function(){return{volume:this.getVolume(),effectsChain:this.effectsChain.getJson(),outputs:this.outputs}}},{key:"fromJson",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r,a,i,s;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.setVolume(t.volume),n=[],this.effectsChain.effects.forEach(function(e){return e.dispose()}),this.effectsChain.effects=[],n=t.effectsChain?t.effectsChain:t.effects,e.t0=N.a.keys(n);case 6:if((e.t1=e.t0()).done){e.next=15;break}return r=e.t1.value,e.t2=this.effectsChain,e.next=11,Sa(n[r],void 0,this.sequencerEngine);case 11:e.t3=e.sent,e.t2.addEffect.call(e.t2,e.t3),e.next=6;break;case 15:t.outputs&&(a=Object(j.a)(t.outputs,2),i=a[0],s=a[1],this.channelMixer.switchChannelOutput(this.outputNode,i,s)&&(this.outputs=[i,s]));case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"outputNode",get:function(){return this.outputVolume}},{key:"effects",get:function(){return this.effectsChain.effects}}]),e}(),WE=GE,KE=function(){function e(t){Object(o.a)(this,e),this.store=t,this.input=void 0,this.splitter=void 0,this.init(),this.deviceId=void 0}return Object(c.a)(e,[{key:"init",value:function(){var e=Object(R.a)(N.a.mark(function e(){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"getInputChannels",value:function(){return void 0===this.input?[]:[1,2]}},{key:"connect",value:function(e,t){1==t?this.splitter.left.connect(e):this.splitter.right.connect(e)}},{key:"disconnect",value:function(e,t){1==t?this.splitter.left.disconnect():this.splitter.right.disconnect()}},{key:"getRecorder",value:function(){return new window.Recorder(this.input,{numChannels:1,bufferLen:1024})}},{key:"newInputSource",value:function(e,t){this.input&&this.splitter,this.startUserMedia(e),t&&(this.deviceId=t),this.store.dispatch(Object(O.D)(t))}},{key:"startUserMedia",value:function(e){console.log("start user media called"),this.input=this.audioContext.createMediaStreamSource(e),this.splitter=new x.a.Split,this.input.connect(this.splitter)}},{key:"setupRecording",value:function(){var e=this;try{window.AudioContext=x.a.Master.context,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia,window.URL=window.URL||window.webkitURL,this.audioContext=x.a.Master.context}catch(t){console.log("No web audio support in this browser!")}void 0!==navigator.mediaDevices&&navigator.mediaDevices.getUserMedia({audio:{mandatory:{echoCancellation:!1}}}).then(function(t){return e.startUserMedia(t)}).catch(function(e){console.log("No live audio input: "+e)})}}]),e}(),QE=function(){function e(){Object(o.a)(this,e),this.latency=0}return Object(c.a)(e,[{key:"getLatency",value:function(){return this.latency}},{key:"setLatency",value:function(e){this.latency=e}}]),e}(),XE=(Xn.FilterEffect,function(){function e(t,n,r){Object(o.a)(this,e),this.input=n,this.output=r,this.sequencerEngine=t,this.eq=new Gr(t,!1),this.auxSend=new x.a.Gain(0),this.getLowEQ().frequencyParameter.set(250),this.getMidEQ().frequencyParameter.set(1e3),this.getMidEQ().qParameter.set(.9),this.getHighEQ().frequencyParameter.set(3400),this.input.connect(this.eq.effectNode),this.eq.connect(this.output),this.eq.outputNode.connect(this.auxSend)}return Object(c.a)(e,[{key:"dispose",value:function(){this.eq.dispose(),this.auxSend.dispose(),this.auxSend=void 0,this.eq=void 0,this.input=void 0,this.output=void 0}},{key:"getLowEQ",value:function(){return this.eq.equalizerPoints[0]}},{key:"getMidEQ",value:function(){return this.eq.equalizerPoints[4]}},{key:"getHighEQ",value:function(){return this.eq.equalizerPoints[7]}},{key:"color",set:function(e){this.auxSend.gain.value=e}}]),e}()),YE=function(){function e(t){Object(o.a)(this,e),this.sequencerEngine=t,this.isMulti=!1,this.lazyConnections=[],this.ctxt=x.a.Master.context._context,console.log("max channel count = "+this.ctxt.destination.maxChannelCount),this.ctxt.destination.maxChannelCount>=2&&(this.ctxt.destination.channelCount=this.ctxt.destination.maxChannelCount,this.ctxt.destination.channelCountMode="explicit",this.ctxt.destination.channelInterpretation="discrete"),this.stereoMerger=new x.a.Volume(0),this.mutableNode=new x.a.Volume(0),this.stereoOnly=!0,this.maxChannel=0,this.stereoConnected=!0,this.stereoMerger.connect(this.mutableNode),this.mutableNode.connect(x.a.Master),this.outputConnections=[],this.stereoOnly||this.switchOutputs(!0)}return Object(c.a)(e,[{key:"updateChannelCount",value:function(){x.a.Master.context._context.destination.maxChannelCount>=2&&(this.ctxt.destination.channelCount=this.ctxt.destination.maxChannelCount,this.ctxt.destination.channelCountMode="explicit",this.ctxt.destination.channelInterpretation="discrete")}},{key:"connectMixEffects",value:function(){this.stereoMerger.disconnect(),this.mixEffects=new XE(this.sequencerEngine,this.stereoMerger,x.a.Master)}},{key:"dispose",value:function(){this.mixEffects&&this.mixEffects.dispose(),this.stereoMerger.dispose(),this.stereoMerger=null}},{key:"setVolume",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.05;this.stereoMerger.volume.exponentialRampToValueAtTime(e,x.a.Master.context.currentTime+t),this.sequencerEngine.store.dispatch(Object(O.Ob)(this.sequencerEngine.getSequenceId(),e))}},{key:"mute",value:function(e){this.mutableNode.mute=e}},{key:"numberOfChannels",value:function(){return this.stereoConnected?2:this.ctxt.destination.channelCount}},{key:"disconnect",value:function(e,t){e.disconnect(this.stereoMerger)}},{key:"switchChannelOutput",value:function(e,t,n){if(this.stereoOnly||t>=this.numberOfChannels()||n>=this.numberOfChannels())return!1;var r=this.outputConnections.find(function(t){return t.output===e});return r.splitter.disconnect(),r.splitter.connect(this.multiMerger,0,t),n&&r.splitter.connect(this.multiMerger,1,n),!0}},{key:"connect",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.maxChannel;if(e.connect(this.stereoMerger),!this.stereoOnly){var r=function(){var r=x.a.Master.context.createChannelSplitter(2);e.connect(r);var a=n%t.channelCount,i=(n+1)%t.channelCount;return r.connect(t.multiMerger,0,a),r.connect(t.multiMerger,1,i),{splitter:r,output:e,leftChannel:a,rightChannel:i}};this.isMulti?this.outputConnections.push(r()):this.lazyConnections.push(r)}return[n%32,(n+1)%32]}},{key:"switchOutputs",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isMulti=t,t?(this.stereoOnly||(console.log("connecting multi merger!"),console.log(x.a.Master),void 0===this.multiMerger&&(this.stereoOnly||(this.multiMerger=x.a.Master.context.createChannelMerger(32))),console.log("multiMerger = ",this.multiMerger,x.a.Master),this.multiMerger.connect(x.a.Master),x.a.Master.channelCount=32,this.lazyConnections.forEach(function(t){e.outputConnections.push(t())}),this.lazyConnections=[]),this.stereoConnected&&this.stereoMerger.disconnect(x.a.Master)):(this.stereoMerger.connect(x.a.Master),this.stereoConnected||this.stereoOnly||this.multiMerger.disconnect(x.a.Master)),this.stereoConnected=!t,console.log("stereo connected = "+this.stereoConnected)}},{key:"channelCount",get:function(){return this.multiMerger.numberOfInputs}}]),e}(),ZE=function(){function e(t){Object(o.a)(this,e),this.sequencerEngine=t}return Object(c.a)(e,[{key:"execute",value:function(){}},{key:"undo",value:function(){}},{key:"serialize",value:function(e,t){var n=Object(D.a)({},e);return n.payload=Object(D.a)({},n.payload),n.payload.track&&(n.payload.subSequence=n.payload.track.subSequence.id,n.payload.track=n.payload.track.trackNumber),n.contentId=this.getContentId(e),{type:"operation",operation:Object(D.a)({},n,{uuid:t,timestamp:Date.now()})}}},{key:"deserialize",value:function(e){var t=Object(D.a)({},e.payload);if(void 0!==t.track)if(void 0!==t.subSequence){var n=this.sequencerEngine.getSubSequence(t.subSequence);n&&(t.track=n.tracks[e.payload.track])}else t.track=this.sequencerEngine.tracks[e.payload.track];return e.payload.resolution&&(t.resolution=(new Xe).fromJson(e.payload.resolution)),Object(D.a)({},e,{payload:t})}},{key:"deserializeStep",value:function(e,t,n){var r=new Ge;return r.track=t,r.stepNumber=n,r.loadFromJson(e,t.effects,void 0,void 0,void 0,t,t.midiEffects),r.id=e.id,r}},{key:"getStepsForStepNumbers",value:function(e,t){var n=t.getEasyPattern(),r=[],a=n.getAllSteps(),i=function(t){var n=e[t],i=a.find(function(e){return e.id===n.id});i&&r.push(i)};for(var s in e)i(s);return r}},{key:"sleep",value:function(e){return new Promise(function(){var t=Object(R.a)(N.a.mark(function t(n){return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:setTimeout(n,e);case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}},{key:"getContentId",value:function(){return 0}},{key:"getDependentActions",value:function(){return[]}},{key:"dependsOn",value:function(e){return this.getDependentActions().indexOf(e)>-1}},{key:"conflictsWith",value:function(e,t){return this.dependsOn(t.type)&&e.contentId===t.contentId}},{key:"getStepLocations",value:function(e,t,n){var r=e.getStepNumbers(t),a=[];for(var i in r){var s=r[i][0];a.push({id:s.id,transpose:s.transpose,stepNumber:n?r[i][1]+s.position:r[i][1]})}return a}},{key:"state",get:function(){return this.sequencerEngine.store.getState()}}]),e}();function $E(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var eO=function(e){Object(u.a)(n,e);var t=$E(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"serialize",value:function(e,t){var r=Object(q.a)(Object(p.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation;return a.payload.step&&(a.payload.step=a.payload.step.getJson()),r}},{key:"deserialize",value:function(e){var t=Object(q.a)(Object(p.a)(n.prototype),"deserialize",this).call(this,e),r=t.payload,a=r.track;if(void 0!==a)return r.step&&(r.step=this.deserializeStep(r.step,a,r.stepNumber)),t}}]),n}(ZE);function tO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var nO=function(e){Object(u.a)(n,e);var t=tO(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.steps,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===t)return{stepsDeleted:[]};var a=t.getEasyPattern().getStepNumbers(n,$o.baseResolution);return t.getEasyPattern().deleteSteps(n,!1),r&&t.updateSteps(),{stepsDeleted:a}}},{key:"undo",value:function(e,t){var n=new oO(this.sequencerEngine),r=e.payload.stepsDeleted;for(var a in r)n.execute({track:e.payload.track,step:r[a][0],stepNumber:r[a][1],resolution:$o.baseResolution},t);t&&e.payload.track.updateSteps()}},{key:"serialize",value:function(e,t){var r=Object(q.a)(Object(p.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation;return a.payload.steps=a.payload.steps.map(function(e){return e.getJson()}),a.payload.stepsDeleted=a.payload.stepsDeleted.map(function(e){var t=Object(j.a)(e,2),n=t[0],r=t[1];return[n.getJson(),r]}),r}},{key:"deserialize",value:function(e){var t=this,r=Object(q.a)(Object(p.a)(n.prototype),"deserialize",this).call(this,e),a=r.payload,i=a.track;if(void 0!==i){var s=a.steps.map(function(e){return t.deserializeStep(e,i,e.stepNumber)});a.steps=this.getStepsForStepNumbers(s,i,$o.baseResolution);var o=a.stepsDeleted.map(function(e){var n=Object(j.a)(e,2),r=n[0],a=n[1];return[t.deserializeStep(r,i,a),a]});return a.stepsDeleted=o,r}}},{key:"getContentId",value:function(e){return e.payload.steps.map(function(e){return e&&e.id})}},{key:"getDependentActions",value:function(){return["DELETE_STEPS",it,"ADD_STEP"]}}]),n}(ZE),rO=function(e,t){var n=t.payload;return n.stepNumbers.map(function(e){var t=Object(j.a)(e,2),r=(t[0],t[1]);return Math.round((r+n.transformation.stepDifference)/2)}).some(function(t){return t===e.payload.stepNumber})},aO=function(e,t){if(void 0!==e.length){if(e.length!==t.length)return!1;for(var n in e)if(e[n]!==t[n])return!1;return!0}return e===t},iO=function(e,t){if(console.log("areContentIdsConflicting ",e,t),void 0!==e.length){for(var n in e){if(void 0===t.length&&e[n]===t)return console.log("yes"),!0;if(void 0!==t.length&&t.indexOf(e[n])>-1)return console.log("yes"),!0}for(var r in t){if(void 0===e.length&&t[r]===e)return console.log("yes"),!0;if(void 0!==e.length&&e.indexOf(t[r])>-1)return console.log("yes"),!0}return console.log("no"),!1}var a=e===t;return a?console.log("Yes"):console.log("No"),a};function sO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var oO=function(e){Object(u.a)(n,e);var t=sO(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.step,r=e.stepNumber,a=e.resolution,i=void 0===a?$o.baseResolution:a,s=e.isRecording,o=void 0!==s&&s,c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===t)return{};var u=Math.floor(r),l=r-u;return t.getEasyPattern().addStep(n,u,i,l,!0,void 0,o),c&&this.updateRedux(n,u,l,t,i),{}}},{key:"getContentId",value:function(e){return e.payload.step.id}},{key:"updateRedux",value:function(e,t,n,r,a){var i=r.subSequence.isTrack?r.subSequence.id:r.trackNumber,s=Object(M.a)(this.state.tracks.trackSteps[i]||[]),o=Object(D.a)({},this.state.tracks.trackFills[i]),c=Object(D.a)({},this.state.tracks.trackStepIds[i]),u=this.state.tracks.trackPianoRollSteps[i]||{},l=this.state.tracks.trackPianoRollPositions[i]||{},p=this.state.tracks.trackPianoRollDurations[i]||{},h=this.state.tracks.trackPatternSteps[i]||{};u[e.transpose]=Object(D.a)({},u[e.transpose]),l[e.transpose]=Object(D.a)({},l[e.transpose]),p[e.transpose]=Object(D.a)({},p[e.transpose]),o=o||new Array(s.length).fill(!1),s[t]=!0,c[t]=e,h[r.currentPattern]=Object(M.a)(s),u[e.transpose][t]=e.id,l[e.transpose][t]=n;var f=new Xe(16,!1);p[e.transpose][t]=a.transformStepAtResolution2(e.duration,f);for(var d=0;d<e.duration;d++)o[(d+t)%s.length]=!0;this.sequencerEngine.store.dispatch(Object(O.t)(i,s,u,o,c,l,p,h))}},{key:"undo",value:function(e,t){new nO(this.sequencerEngine).execute(Object(D.a)({},e.payload,{steps:[e.payload.step]}),t),t&&e.payload.track.updateSteps()}},{key:"getDependentActions",value:function(){return["ADD_STEP","DELETE_STEPS"]}},{key:"conflictsWith",value:function(e,t){return!(!this.dependsOn(t.type)||!iO(e.contentId,t.contentId))||(e.type===t.type?e.stepNumber===t.stepNumber:t.type===it&&rO(e,t))}},{key:"state",get:function(){return this.sequencerEngine.store.getState()}}]),n}(eO);function cO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var uO=function(e){Object(u.a)(n,e);var t=cO(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"execute",value:function(e){e.effect,e.track,e.group,e.send}},{key:"undo",value:function(e){}},{key:"serialize",value:function(e,t){var r=Object(q.a)(Object(p.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation,i=a.payload;return void 0!==i.group&&(i.group=i.group.groupNumber),void 0!==a.send&&(i.send=i.send.sendNumber),i.isMidiEffect=i.effect.isMidiEffect(),i.effect=i.effect.getJson(),r}},{key:"deserialize",value:function(e){var t,r=Object(q.a)(Object(p.a)(n.prototype),"deserialize",this).call(this,e),a=r.payload,i=a.track||a.group||a.send;return a.isMidiEffect?void 0===(t=i.midiEffects.getEffectById(a.effect.id))&&(t=xi(a.effect,i)).fromJson(a.effect):void 0===(t=i.effectsChain.getEffectById(a.effect.id))&&(t=jp(a.effect.name,this.sequencerEngine)).fromJson(a.effect,this.sequencerEngine.tracks,a.track.trackNumber),a.effect=t,r}}]),n}(ZE);function lO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var pO=function(e){Object(u.a)(n,e);var t=lO(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.effect,n=e.track,r=e.group,a=e.send,i=n||r||a;t.isMidiEffect()?i.midiEffects.addEffect(t):i.effectsChain.addEffect(t)}}]),n}(uO);function hO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var fO=function(e){Object(u.a)(n,e);var t=hO(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.effect,n=e.track,r=e.group,a=e.send,i=n||r||a;t.isMidiEffect()?i.midiEffects.deleteEffect(t):i.effectsChain.deleteEffect(t)}}]),n}(uO);function dO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var mO=function(e){Object(u.a)(n,e);var t=dO(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.effect,n=e.track,r=e.group,a=e.send,i=n||r||a;t.toggleEnabled(),t.isMidiEffect()||i.effectsChain.updateEffects()}}]),n}(uO);function vO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var gO=function(e){Object(u.a)(n,e);var t=vO(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.from,n=e.to,r=e.isMidiEffect,a=void 0!==r&&r,i=e.track,s=e.group,o=e.send,c=i||s||o;a?c.midiEffects.moveEffectTo(t,n):c.effectsChain.moveEffectTo(t,n),i&&i.updateSteps()}},{key:"undo",value:function(e){}},{key:"serialize",value:function(e,t){var r=Object(q.a)(Object(p.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation,i=a.payload;return void 0!==i.group&&(i.group=i.group.groupNumber),void 0!==a.send&&(i.send=i.send.sendNumber),r}}]),n}(ZE);function yO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var bO=function(e){Object(u.a)(n,e);var t=yO(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.step,r=e.stepNumber,a=e.resolution,i=void 0===a?$o.baseResolution:a,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=Math.floor(r);return t.getEasyPattern().deleteStepAtStepNumber(n,o,i),s&&t.updateSteps(),{}}},{key:"undo",value:function(e,t){new oO(this.sequencerEngine).execute({track:e.payload.track,step:e.payload.step,stepNumber:e.payload.stepNumber,resolution:e.payload.resolution},t),t&&e.payload.track.updateSteps()}},{key:"getContentId",value:function(e){return e.payload.step.id}}]),n}(eO);function kO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var EO=function(e){Object(u.a)(n,e);var t=kO(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.stepNumber,r=e.resolution,a=void 0===r?$o.baseResolution:r,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=t.getEasyPattern(),o=s.getStepsAtStepNumber(n,a),c=o.map(function(e){return Object(D.a)({},e,{step:e.step.getCopy()})});return s.deleteSteps(o.map(function(e){return e.step})),i&&t.updateSteps(),{stepsDeleted:c}}},{key:"undo",value:function(e){}}]),n}(ZE);function OO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var SO=0,PO=function(e){Object(u.a)(n,e);var t=OO(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=this,n=e.track,r=e.steps,a=e.transformation,i=e.resolution,s=void 0===i?$o.baseResolution:i,o=e.wrap,c=void 0===o||o,u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=n.getEasyPattern(),h=p.getStepNumbers(r,s),f=h.map(function(e){var t=Object(j.a)(e,2),n=t[0];t[1];return n.transpose}),d=this.getStepLocations(p,r,!0),m=n.getEasyPattern().transformSteps(r,Object(M.a)(h),a,s,c),v=this.getStepLocations(p,r,!0);for(var g in v)v[g].stepDifference=s.transformStepAtResolution2(v[g].stepNumber-d[g].stepNumber),v[g].transposeDifference=v[g].transpose-d[g].transpose;if(u)if(l){var y=++SO;setTimeout(function(){y===SO&&t.updateRedux(n,m,f,s)},50)}else this.updateRedux(n,m,f,s);return u&&!l&&function(){var e=t.sequencerEngine.store.getState().keyboard.selectedPianoRollSteps,n=function(t){if(void 0===e[t])return"continue";var n=m.find(function(n){return n.id===e[t].id});e[t]=n};for(var r in e)n(r);t.sequencerEngine.store.dispatch(Object(O.Gc)(e))}(),{stepNumbers:h,transformation:Object(D.a)({},v[0])}}},{key:"updateRedux",value:function(e,t,n,r){var a=this,i=e.subSequence.isTrack?e.subSequence.id:e.trackNumber,s=Object(M.a)(this.state.tracks.trackSteps[i]||[]),o=Object(D.a)({},this.state.tracks.trackFills[i]),c=Object(D.a)({},this.state.tracks.trackStepIds[i]),u=this.state.tracks.trackPianoRollSteps[i]||{},l=this.state.tracks.trackPianoRollPositions[i]||{},p=this.state.tracks.trackPianoRollDurations[i]||{},h=this.state.tracks.trackPatternSteps[i]||{},f=new Set;t.forEach(function(e){return f.add(a.snapTransposeToScale(e.transpose))}),n.forEach(function(e){return f.add(a.snapTransposeToScale(e))}),f=Array.from(f);var d=e.pattern.getUpdateStepsAction(!1);for(var m in f){var v=f[m];u[v]=d.pianoRollSteps[v],p[v]=d.pianoRollDurations[v],l[v]=d.pianoRollPositions[v]}s=Object(M.a)(d.steps),o=Object(D.a)({},d.trackFills),this.sequencerEngine.store.dispatch(Object(O.t)(i,s,u,o,c,l,p,h,!1))}},{key:"snapTransposeToScale",value:function(e){return this.sequencerEngine.rules.snapTransposeToScale(e)}},{key:"undo",value:function(e,t){var n=Object(D.a)({},e.payload.transformation);n.stepDifference=-1*n.stepDifference,n.transposeDifference=-1*n.transposeDifference,this.execute(Object(D.a)({},e.payload,{transformation:n}),t)}},{key:"serialize",value:function(){var e=Object(R.a)(N.a.mark(function e(t,r){var a,i;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(q.a)(Object(p.a)(n.prototype),"serialize",this).call(this,t,r),(i=a.operation).payload.steps=i.payload.steps.map(function(e){return e.id}),i.payload.stepNumbers=i.payload.stepNumbers.map(function(e){var t=Object(j.a)(e,2),n=t[0],r=t[1];return[n.id,r]}),e.abrupt("return",a);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getContentId",value:function(e){return e.payload.steps.map(function(e){return e&&e.id})}},{key:"deserialize",value:function(e){var t=Object(q.a)(Object(p.a)(n.prototype),"deserialize",this).call(this,e),r=t.payload,a=r.track;if(void 0!==a){var i=r.steps.map(function(e){return{id:e}});return r.steps=this.getStepsForStepNumbers(i,a,$o.baseResolution),t}}},{key:"getDependentActions",value:function(){return["ADD_STEP",it,"DELETE_STEP","DELETE_STEPS"]}},{key:"conflictsWith",value:function(e,t){return!(!this.dependsOn(t.type)||!iO(e.contentId,t.contentId))||"ADD_STEP"===t.type&&rO(t,e)}}]),n}(ZE);function wO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var jO=function(e){Object(u.a)(n,e);var t=wO(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.steps,r=e.stepNumber,a=e.resolution,i=void 0===a?$o.baseResolution:a,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===t)return{steps:[]};t.instrumentTrack&&(t=t.instrumentTrack);var o=t.getEasyPattern(),c=o.pattern.getStepResolutionTree(i.isTriplet).search(r,i).toggle(n&&n[0]?n[0].stepBucket.steps[0].id:void 0);return o.update(i.isTriplet),s&&t.updateSteps(),{steps:c}}},{key:"getContentId",value:function(e){return e.payload.steps[0].id}},{key:"undo",value:function(e,t){var n=e.payload.track.getEasyPattern();if(void 0!==e.payload.steps){var r=e.payload.resolution.isTriplet?n.pattern.tripletStepBuckets:n.pattern.stepBuckets;for(var a in e.payload.steps){var i=e.payload.steps[a];r[i.stepNumber]=i.stepBucket}}t&&(n.update(e.payload.resolution.isTriplet),e.payload.track.updateSteps())}},{key:"serialize",value:function(e,t){var r=Object(q.a)(Object(p.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation;return a.payload.steps&&(a.payload.steps=a.payload.steps.map(function(e){return Object(D.a)({},e,{stepBucket:e.stepBucket.getJson()})})),r}},{key:"deserialize",value:function(e){var t=Object(q.a)(Object(p.a)(n.prototype),"deserialize",this).call(this,e),r=t.payload;if(void 0!==r.track){var a=r.track,i=[];if(e.payload.steps)for(var s in e.payload.steps){var o=e.payload.steps[s],c=o.stepBucket,u=o.stepNumber,l=new ze(a,c.isTriplet);for(var h in c){var f=c[h],d=new Ge;d.track=a,d.stepNumber=u,d.loadFromJson(f,a.effects,void 0,void 0,void 0,a,a.midiEffects),d.id=f.id,l.steps[h]=d}i.push({stepNumber:u,stepBucket:l})}return r.steps=i,t}}}]),n}(ZE);function TO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var xO=function(e){Object(u.a)(n,e);var t=TO(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.patternNumber,n=this.sequencerEngine.tracks.map(function(e){return e.patterns[t]});return this.sequencerEngine.deletePattern(t),{patterns:n,patternNumber:t}}},{key:"undo",value:function(e){var t=e.payload.patterns,n=e.payload.patternNumber;for(var r in t){var a=this.sequencerEngine.tracks[r],i=a.patterns.slice(0,n).concat([t[r]]).concat(a.patterns.slice(n));a.patterns=i,a.switchToPattern(a.currentPattern),a.updateSteps()}this.sequencerEngine.store.dispatch(Object(O.Vb)(this.sequencerEngine.numberOfPatterns()))}}]),n}(ZE);function CO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var NO=function(e){Object(u.a)(n,e);var t=CO(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.track,r=e.step,a=e.stepNumber,i=e.resolution,s=void 0===i?$o.baseResolution:i,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(q.a)(Object(p.a)(n.prototype),"execute",this).call(this,{track:t,step:r,stepNumber:a,resolution:s,isRecording:!0},o)}}]),n}(oO);function RO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var DO=0,qO=function(e){Object(u.a)(n,e);var t=RO(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.track,n=(e.step,e.parameter),r=e.value,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=n.get();if(n.set(r),a)if(i){var o=++DO;setTimeout(function(){o===DO&&t.updateSteps()},50)}else t.updateSteps();return{previousValue:s}}},{key:"undo",value:function(e,t){var n=e.payload;this.execute(Object(D.a)({},n,{value:n.savedValue}),t)}},{key:"serialize",value:function(e,t){var r=Object(q.a)(Object(p.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation;return a.payload.step=a.payload.step.id,a.payload.parameter=a.payload.parameter.name,r}},{key:"deserialize",value:function(e){var t=Object(q.a)(Object(p.a)(n.prototype),"deserialize",this).call(this,e),r=t.payload,a=r.track;if(void 0!==a&&(r.step=this.getStepsForStepNumbers([{id:r.step}],a)[0],void 0!==r.step))return r.parameter=r.step.parameters.find(function(e){return e.name===r.parameter}),t}},{key:"getContentId",value:function(e){return[e.payload.parameter.id,e.payload.step.id]}},{key:"state",get:function(){return this.sequencerEngine.store.getState()}}]),n}(ZE);function MO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var AO=0,IO=function(e){Object(u.a)(n,e);var t=MO(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.steps,r=e.factor,a=e.value,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n.forEach(function(e){return void 0!==a?a:e.duration*=r}),i)if(s){var o=++AO;setTimeout(function(){o===AO&&t.updateSteps()},50)}else t.updateSteps()}},{key:"undo",value:function(e,t){var n=e.payload;this.execute(Object(D.a)({},n,{factor:1/n.factor}),t)}},{key:"serialize",value:function(){var e=Object(R.a)(N.a.mark(function e(t,r){var a,i;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(q.a)(Object(p.a)(n.prototype),"serialize",this).call(this,t,r),(i=a.operation).payload.steps=i.payload.steps.map(function(e){return e.id}),e.abrupt("return",a);case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"deserialize",value:function(e){var t=Object(q.a)(Object(p.a)(n.prototype),"deserialize",this).call(this,e),r=t.payload,a=r.track;if(void 0!==a){var i=r.steps.map(function(e){return{id:e}});return r.steps=this.getStepsForStepNumbers(i,a,$o.baseResolution),t}}},{key:"getContentId",value:function(e){return e.payload.steps.map(function(e){return e.id})}},{key:"state",get:function(){return this.sequencerEngine.store.getState()}}]),n}(ZE);function LO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var FO=function(e){Object(u.a)(n,e);var t=LO(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"serialize",value:function(e,t){var r=Object(q.a)(Object(p.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation.payload;if(a.parameter&&(a.parameter=a.parameter.getJson()),a.automation){var i=a.automation.parameter;a.parameter=i.getJson(),a.automation=a.automation.id}return r}},{key:"deserialize",value:function(e){var t=Object(q.a)(Object(p.a)(n.prototype),"deserialize",this).call(this,e),r=t.payload,a=r.parameter,i=a.id,s=a.name,o=a.context,c=void 0;if(void 0!==o.track&&(r.track=this.sequencerEngine.tracks[o.track]),void 0!==o.subTrack&&(r.track=r.track.tracks[o.subTrack].track),void 0!==o.midiEffect){if(r.track){var u=r.track.midiEffects.effects[o.midiEffect].parameters.find(function(e){return e.name===s});u?(c=u,r.parameter=u):r.parameter=void 0}}else if(void 0!==o.liveEffect){if(r.track){var l=r.track.liveEffects.effects[o.liveEffect];if(o.macro){var h=l.macros.find(function(e){return e.id===o.macro});r.parameter=h.macroParameter,c=h.macroParameter}}}else if(void 0!==o.effect&&-1!==o.effect){if(r.track){var f=r.track.effects[o.effect];o.subDevice&&(f=f.getSubDevice(o.subDevice)),o.macro&&(f=f.macros.find(function(e){return e.id===o.macro}));var d=f.getParameters().find(function(e){return e.name===s});d?(r.parameter=d,c=d):r.parameter=void 0}}else if(o.isInstrument){if(r.instrument=r.track.instrument,o.subDevice){var m=r.instrument.getSubDevice(o.subDevice);r.parameter=m.parameters.find(function(e){return e.name===s})}else r.parameter=r.instrument.parameters.find(function(e){return e.name===s});c=r.parameter}if(void 0===c&&(c=r.track.sendNodeVolumeParameters.find(function(e){return e.id===i}),r.parameter=c),void 0===c&&(r.parameter=r.track.getAllParameters().find(function(e){return e.name===s}),c=r.parameter),r.automation&&r.parameter&&(r.automation=r.parameter.unlockedAutomation),void 0!==c)return t}},{key:"getContentId",value:function(e){var t=e.payload;return t.point?t.point.id:t.parameter?t.parameter.id:0}}]),n}(ZE);function BO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var HO=function(e){Object(u.a)(n,e);var t=BO(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.parameter,n=e.value,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];void 0!==t&&t.set(n,void 0,!r)}},{key:"undo",value:function(e){var t=e.payload,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.parameter.set(t.savedValue,void 0,!n)}},{key:"getContentId",value:function(e){return e.payload.parameter.id}}]),n}(FO);function VO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var UO=function(e){Object(u.a)(n,e);var t=VO(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.steps,r=e.resolution,a=void 0===r?$o.baseResolution:r,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=t.getEasyPattern(),o=this.getStepLocations(s,n,!0);s.snapToGrid(n,a);var c=this.getStepLocations(s,n,!1);for(var u in c)c[u].stepDifference=c[u].stepNumber-o[u].stepNumber,c[u].transposeDifference=c[u].transpose-o[u].transpose;return i&&t.updateSteps(),{stepLocations:c}}},{key:"undo",value:function(e,t){var n=e.payload,r=n.stepLocations,a=n.steps,i=n.track,s=(n.resolution,i.getEasyPattern(),new PO(this.sequencerEngine));for(var o in r){var c=a[o],u={stepDifference:-1*r[o].stepDifference,transposeDifference:-1*r[o].transposeDifference};s.execute({track:i,steps:[c],transformation:u},t)}}},{key:"serialize",value:function(e,t){var r=Object(q.a)(Object(p.a)(n.prototype),"serialize",this).call(this,e,t),a=r.operation;return a.payload.steps=a.payload.steps.map(function(e){return e.getJson()}),r}},{key:"deserialize",value:function(e){var t=this,r=Object(q.a)(Object(p.a)(n.prototype),"deserialize",this).call(this,e),a=r.payload,i=a.track;if(void 0!==i){var s=a.steps.map(function(e){return t.deserializeStep(e,i,e.stepNumber)});return a.steps=this.getStepsForStepNumbers(s,i,$o.baseResolution),r}}},{key:"getContentId",value:function(e){return e.payload.steps.map(function(e){return e.id})}}]),n}(ZE);function JO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var _O=function(e){Object(u.a)(n,e);var t=JO(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.value;t&&!isNaN(n)&&t.setVolume(n)}}]),n}(ZE);function GO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var zO=function(e){Object(u.a)(n,e);var t=GO(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.track,n=e.mute;t&&t.mute(n)}}]),n}(ZE);function WO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var KO=function(e){Object(u.a)(n,e);var t=WO(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.automation,n=e.step,r=e.value,a=e.pointId;return{point:t.addBreakPoint(n,r,a)}}},{key:"undo",value:function(e){var t=e.payload;t.automation.removeBreakPoint(t.point)}}]),n}(FO);function QO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var XO=function(e){Object(u.a)(n,e);var t=QO(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.automation,n=e.point;t.removeBreakPoint(n)}},{key:"undo",value:function(e){var t=e.payload;t.automation.addBreakPoint(t.point.step,t.point.value,t.point.id)}}]),n}(FO);function YO(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ZO=function(e){Object(u.a)(n,e);var t=YO(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.automation,n=e.points;t.removeBreakPoints(n)}},{key:"undo",value:function(e){var t=e.payload,n=t.automation;t.points.forEach(function(e){return n.addBreakPoint(e.step,e.value,e.id)})}}]),n}(FO);function $O(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var eS=function(e){Object(u.a)(n,e);var t=$O(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.automation,n=e.point,r=e.step,a=e.value;t.movePoint(n,r,a)}},{key:"undo",value:function(e){var t=e.payload;this.execute(Object(D.a)({},t,{step:t.savedStep,value:t.savedValue}))}}]),n}(FO);function tS(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var nS=function(e){Object(u.a)(n,e);var t=tS(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.automation,n=e.points,r=e.stepDiff,a=e.valueDiff;t.movePoints(n,r,a)}}]),n}(FO);function rS(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var aS=function(e){Object(u.a)(n,e);var t=rS(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e.automation,n=e.point,r=n.getJson?n.getJson():n;return t.quantizePoint(n),{savedPoint:r}}},{key:"undo",value:function(e){var t=e.payload;t.automation.movePoint(t.point,t.savedPoint.step,t.savedPoint.value)}}]),n}(FO),iS=function(){function e(t){Object(o.a)(this,e),this.addStepAction=new oO(t),this.deleteStepAction=new bO(t),this.deleteStepNumberAction=new EO(t),this.moveStepsAction=new PO(t),this.deleteStepsAction=new nO(t),this.toggleStepAction=new jO(t),this.deletePatternAction=new xO(t),this.recordStepAction=new NO(t),this.updateStepParameterAction=new qO(t),this.addEffectAction=new pO(t),this.deleteEffectAction=new fO(t),this.toggleEffectAction=new mO(t),this.moveEffectAction=new gO(t),this.updateParameterAction=new HO(t),this.updateTrackVolumeAction=new _O(t),this.updateTrackMuteAction=new zO(t),this.addAutomationBreakPointAction=new KO(t),this.removeAutomationBreakPointAction=new XO(t),this.removeAutomationBreakPointsAction=new ZO(t),this.moveAutomationBreakPointAction=new eS(t),this.moveAutomationBreakPointsAction=new nS(t),this.snapToGridAction=new UO(t),this.snapAutomationBreakPoint=new aS(t),this.updateStepDurations=new IO(t)}return Object(c.a)(e,[{key:"getAction",value:function(e){switch(e.type){case"ADD_STEP":return this.addStepAction;case"DELETE_STEP":return this.deleteStepAction;case"DELETE_STEP_NUMBER":return this.deleteStepNumberAction;case"RECORD_STEP":return this.recordStepAction;case it:return this.moveStepsAction;case"DELETE_STEPS":return this.deleteStepsAction;case"TOGGLE_STEP":return this.toggleStepAction;case"DELETE_PATTERN":return this.deletePatternAction;case"UPDATE_STEP_PARAMETER":return this.updateStepParameterAction;case"ADD_EFFECT":return this.addEffectAction;case"DELETE_EFFECT":return this.deleteEffectAction;case"TOGGLE_EFFECT":return this.toggleEffectAction;case"MOVE_EFFECT":return this.moveEffectAction;case"UPDATE_PARAMETER":return this.updateParameterAction;case"UPDATE_TRACK_VOLUME":return this.updateTrackVolumeAction;case"UPDATE_TRACK_MUTE":return this.updateTrackMuteAction;case"ADD_AUTOMATION_BREAK_POINT":return this.addAutomationBreakPointAction;case"REMOVE_AUTOMATION_BREAK_POINT":return this.removeAutomationBreakPointAction;case"REMOVE_AUTOMATION_BREAK_POINTS":return this.removeAutomationBreakPointsAction;case"MOVE_AUTOMATION_BREAK_POINT":return this.moveAutomationBreakPointAction;case"MOVE_AUTOMATION_BREAK_POINTS":return this.moveAutomationBreakPointsAction;case st:return this.snapToGridAction;case"SNAP_AUTOMATION_BREAK_POINT":return this.snapAutomationBreakPoint;case"UPDATE_STEP_DURATIONS":return this.updateStepDurations;default:return}}},{key:"makeCopyOfAction",value:function(e){var t;switch(e.type){case"ADD_STEP":case"DELETE_STEP":case"RECORD_STEP":return(t=Object(D.a)({},e)).payload.step=t.payload.step.getCopy(!0,!0,!0),t;case it:return(t=Object(D.a)({},e)).payload.steps=e.payload.steps,t;case"DELETE_STEPS":return(t=Object(D.a)({},e)).payload.steps=e.payload.steps.map(function(e){return e.getCopy(!0,!0,!0)}),t;case"UPDATE_STEP_PARAMETER":case"UPDATE_PARAMETER":return(t=Object(D.a)({},e)).payload.savedValue=e.payload.parameter.get(),t;case"MOVE_AUTOMATION_BREAK_POINT":return(t=Object(D.a)({},e)).payload.savedStep=e.payload.point.step,t.payload.savedValue=e.payload.point.value,t;default:return Object(D.a)({},e)}}}]),e}(),sS=n(393),oS=n(391);function cS(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var uS=function(e){Object(u.a)(n,e);var t=cS(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"".concat(window.location.host,"/ws");return Object(o.a)(this,n),(e=t.call(this)).ackTimeoutMS=5e3,e.open=!1,e.callbacks={},e.s=new WebSocket("ws://".concat(r)),e.s.addEventListener("open",e.onOpen.bind(Object(W.a)(e))),e.s.addEventListener("message",e.onMessage.bind(Object(W.a)(e))),e.s.addEventListener("close",e.onClose.bind(Object(W.a)(e))),e.s.addEventListener("error",e.onError.bind(Object(W.a)(e))),e}return Object(c.a)(n,[{key:"onOpen",value:function(e){this.open=!0,this.dispatchEvent(new Event("open")),console.log("websocket opened:",e)}},{key:"onMessage",value:function(e){var t=JSON.parse(e.data);t.id?this.dispatchEvent(new CustomEvent(t.id,{detail:t})):this.dispatch(t)}},{key:"onClose",value:function(e){this.open=!1,this.dispatchEvent(new Event("closed")),console.log("websocket closed:",e)}},{key:"onError",value:function(e){this.dispatchEvent(new CustomEvent("error",{detail:e})),console.error("websocket error:",e)}},{key:"send",value:function(){var e=Object(R.a)(N.a.mark(function e(t){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.open){e.next=3;break}return console.log("send attempted before websocket connection was open"),e.abrupt("return",!1);case 3:return e.next=5,this.s.send(JSON.stringify(t));case 5:return e.abrupt("return",!0);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"sendWithResponse",value:function(e){var t=this;return new Promise(function(){var n=Object(R.a)(N.a.mark(function n(r,a){return N.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e.id){n.next=3;break}return a('input must be an object with an "id" property'),n.abrupt("return");case 3:return n.next=5,t.send(e);case 5:if(n.sent){n.next=8;break}return a("sendWithResponse attempted before websocket connection was open"),n.abrupt("return");case 8:t.addEventListener(e.id,function(e){return r(e.detail)}),setTimeout(function(){return a("response ".concat(e.id," not received after ").concat(t.ackTimeoutMS,"ms"))},t.ackTimeoutMS);case 10:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"dispatch",value:function(e){if(e.type){var t=this.callbacks[e.type];t?t(e):console.log("received message with unregistered type:",e)}else console.error("received message with no type:",e)}},{key:"register",value:function(e,t){this.callbacks[e]=t}}]),n}(Object(oS.a)(EventTarget)),lS=(n(2303),function(){function e(t,n){Object(o.a)(this,e),this.roomActionsManager=t,this.sequencerEngine=t.sequencerEngine,this.onSyncedOperations=n,sS.initializeApp({apiKey:"AIzaSyDwXxldpqZT1X3IK82OtJ2SzkjX6OhXGaY",authDomain:"fir-test-9a9f3.firebaseapp.com",databaseURL:"https://fir-test-9a9f3.firebaseio.com",projectId:"fir-test-9a9f3",storageBucket:"fir-test-9a9f3.appspot.com",messagingSenderId:"1043409033882",appId:"1:1043409033882:web:102b9f24ce8fd87ec15d23",measurementId:"G-4Z8FM61HPQ"}),this.db=sS.firestore(),this.auth=sS.auth(),this.users=this.db.collection("users"),this.rooms=this.db.collection("rooms"),this.roomsLoaded=!1,this.init()}return Object(c.a)(e,[{key:"init",value:function(){this.initOnRoomData()}},{key:"initUser",value:function(){var e=this;this.auth.onAuthStateChanged(function(t){t?(console.log("user signed in",t),e.installationUserLoggedIn=!0,e.userDoc=e.users.doc(t.uid),e.lastOperationsCol=e.userDoc.collection("lastOperations"),e.socket||(e.socket=new uS,e.socket.register("operationsUpdate",function(e){this.onSyncedOperations(e.operations)}.bind(e)),e.socket.register("clearState",function(e){}),e.socket.register("numMembersUpdate",function(t){e.roomActionsManager.numMembers=t.numMembers}),e.socket.addEventListener("open",Object(R.a)(N.a.mark(function n(){return N.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.socket.sendWithResponse({id:Object(A.uuid)(),type:"announce",userID:t.uid});case 3:if(!n.sent.error){n.next=7;break}return e.sequencerEngine.store.dispatch(Object(O.Sb)(!0)),n.abrupt("return");case 7:n.next=12;break;case 9:n.prev=9,n.t0=n.catch(0),console.log("unable to connect and enter room:",n.t0);case 12:case"end":return n.stop()}},n,null,[[0,9]])}))))):(console.log("no user signed in, creating user"),e.auth.signInAnonymously().catch(function(e){return console.log("error signing in anonymously:",e)}))})}},{key:"enterRoom",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r,a=this;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.sequencerEngine.store.dispatch(Object(O.Mb)(0)),this.sequencerEngine.store.dispatch(Object(O.Nb)(!0)),this.sequencerEngine.channelMixer.setVolume(-200,.01),e.next=6,this.socket.sendWithResponse({id:Object(A.uuid)(),type:"enterRoom",roomName:t});case 6:return n=e.sent,this.roomActionsManager.currentRoom=t,this.roomActionsManager.queuedActions=[],e.t0=this.roomActionsManager,e.t1=t,e.next=13,this.getLastOperation(t);case 13:return e.t2=e.sent,e.t3={lastOperation:e.t2},e.t0.setRoomStatePartial.call(e.t0,e.t1,e.t3),this.roomActionsManager.actionsRemaining=this.roomActionsManager.getCurrentRoomState().actionsAllowed,this.roomActionsManager.numMembers=n.roomDoc.NumMembers,this.roomActionsManager.updateCurrentRoomState(),console.log("entered the room",n.roomDoc),r=this.roomActionsManager.getCurrentRoomState().hash,e.next=23,this.sequencerEngine.loadSequence(r);case 23:return console.log("applying ".concat(n.operations.length," operations from room ").concat(t)),e.next=26,this.onSyncedOperations(n.operations,!0);case 26:this.sequencerEngine.updateSteps(!0),this.sequencerEngine.store.dispatch(Object(O.Nb)(!1)),setTimeout(function(){a.sequencerEngine.channelMixer.setVolume(0,4),a.sequencerEngine.play()},250),e.next=34;break;case 31:e.prev=31,e.t4=e.catch(0),console.error("unable to enter room",e.t4);case 34:case"end":return e.stop()}},e,this,[[0,31]])}));return function(t){return e.apply(this,arguments)}}()},{key:"leaveRoom",value:function(){var e=Object(R.a)(N.a.mark(function e(){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.socket.sendWithResponse({id:Object(A.uuid)(),type:"exitRoom",roomName:this.roomActionsManager.currentRoom});case 2:e.sent,this.roomActionsManager.currentRoom=void 0,this.roomActionsManager.queuedActions=[],this.sequencerEngine.operationManager.reset(),this.roomActionsManager.updateQueuedContentIds(),this.sequencerEngine.newSequence();case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getLastOperation",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.lastOperationsCol.doc(t).get();case 3:return n=e.sent,e.abrupt("return",n.get("lastOperation"));case 7:return e.prev=7,e.t0=e.catch(0),console.log("unable to get lastOperation doc",e.t0),e.abrupt("return",void 0);case 11:case"end":return e.stop()}},e,this,[[0,7]])}));return function(t){return e.apply(this,arguments)}}()},{key:"updateLastOperation",value:function(){var e=Date.now(),t=this.roomActionsManager.currentRoom;this.roomActionsManager.setRoomStatePartial(t,{lastOperation:e}),this.lastOperationsCol.doc(t).set({lastOperation:e}).catch(function(e){console.log("unable to update lastOperation timestamp: ".concat(e.message))})}},{key:"initOnRoomData",value:function(){var e=this;this.rooms.where("active","==",!0).onSnapshot(function(t){t.size||console.log("No rooms."),t.docChanges().forEach(function(t){var n=t.doc.id,r=t.doc.data();"added"===t.type?(console.log("added room ".concat(n),r),e.roomActionsManager.setRoomState(n,r.active,r.type,r.hash,r.thumbnail,r.description,r.actionsAllowed,r.actionWaitTime,r.rules,void 0)):"removed"===t.type?e.roomActionsManager.removeRoomState(n):(e.roomActionsManager.setRoomStatePartial(n,Object(D.a)({},r)),e.roomActionsManager.currentRoom===n&&e.roomActionsManager.updateCurrentRoomState(!0))}),e.roomsLoaded||(e.roomsLoaded=!0,e.initUser())})}},{key:"installationUserLoggedIn",set:function(e){this.sequencerEngine.store.dispatch(Object(O.yb)(e))},get:function(){return this.sequencerEngine.store.getState().installation.userLoggedIn}}]),e}());function pS(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return hS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return hS(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function hS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var fS=function(){function e(t,n){Object(o.a)(this,e),this.param1=t,this.param2=n,this.nextMilestone=t}return Object(c.a)(e,[{key:"onHistoryChanged",value:function(e,t){var n=this;if(e>=this.nextMilestone){var r,a=Object(D.a)({},t.stepsEnabled),i=pS(t.sequencerEngine.tracks);try{var s=function(){var e=r.value,t=e.trackNumber,i=e.length/2,s=Array.from(a[t]||a[-1]);a[t]=new Set(s.map(function(e){return(e+n.param2)%i}))};for(i.s();!(r=i.n()).done;)s()}catch(o){i.e(o)}finally{i.f()}t.stepsEnabled=a,this.nextMilestone+=this.param1}}}]),e}();function dS(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return mS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return mS(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function mS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}new wt.a;var vS=function(){function e(t){Object(o.a)(this,e),this.sequencerEngine=t,this.historyLength=void 0,this.listenForHistoryChanges()}return Object(c.a)(e,[{key:"applyRules",value:function(e){console.log("applying rules ",e);var t,n=dS(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=r.ruleType,i=r.ruleParams;switch(console.log("type = ",a,i),a){case"NOTES_ENABLED":this.notesEnabled=this.getNotesByName(i);break;case"KNOBS_ENABLED":this.knobsEnabled=i;break;case"SENDS_ENABLED":this.sendsEnabled=i;break;case"TRACKS_ENABLED":this.tracksEnabled=i;break;case"STEPS_ENABLED":this.stepsEnabled={"-1":new Set(i)};break;case"STEPS_ALGORITHM":this.stepsAlgorithmChanged(i);break;case"SCALE":this.scale=i}}}catch(s){n.e(s)}finally{n.f()}}},{key:"getNotesByName",value:function(e){return e.map(function(e){return _i.a.fromString(e).getTranspose()})}},{key:"dispatch",value:function(e){return this.sequencerEngine.store.dispatch(e)}},{key:"listenForHistoryChanges",value:function(){var e=this;this.sequencerEngine.store.subscribe(function(){e.state.installation.historyLength!==e.historyLength&&(e.historyLength=e.state.installation.historyLength,e.onHistoryChanged(e.historyLength))})}},{key:"onHistoryChanged",value:function(e){this.stepsAlgorithm&&this.stepsAlgorithm.onHistoryChanged(e,this)}},{key:"stepsAlgorithmChanged",value:function(e){switch(e[0]){case"ALGORITHM_1":this.stepsAlgorithm=new fS(e[1],e[2])}}},{key:"selectedTrack",get:function(){return this.sequencerEngine.store.getState().mix.selectedTrack}},{key:"scale",set:function(e){this.sequencerEngine.rules.newScale(e)}},{key:"notesEnabled",set:function(e){this.dispatch(Object(O.Tb)(new Set(e)))}},{key:"sendsEnabled",set:function(e){this.dispatch(Object(O.Oc)(e))}},{key:"knobsEnabled",set:function(e){this.dispatch(Object(O.Ib)(e))}},{key:"stepsEnabled",set:function(e){this.dispatch(Object(O.vd)(e))},get:function(){return this.state.installation.stepsEnabled}},{key:"tracksEnabled",set:function(e){if(-1===e.indexOf(this.selectedTrack)){var t=e[0];this.sequencerEngine.selectTrack(t)}this.dispatch(Object(O.Xd)(e))}},{key:"state",get:function(){return this.sequencerEngine.store.getState()}}]),e}(),gS=function(e,t){var n=e.operation;if(kS(n.type))return yS(e,t);for(var r=t.length-1;r>=0;r--){if(!bS(n,t[r]))break}return[].concat(Object(M.a)(t.slice(0,r+1)),[e])},yS=function(e,t){for(var n=e.operation,r=t.length-1;r>=0;r--){var a=t[r];if(!bS(n,a)){r++;break}n=PS(n,a.operation)}return[].concat(Object(M.a)(t.slice(0,r)),[Object(D.a)({},e,{operation:n})])};function bS(e,t){return t.length&&(t=t[t.length-1]),t.operation&&(t=t.operation),(e.type===t.type||e.type===st&&t.type===it)&&(!!OS(e.type)&&aO(e.contentId,t.contentId))}var kS=function(e){return ES.has(e)},ES=new Set([it,st,"UPDATE_STEP_DURATIONS"]),OS=function(e){return SS.has(e)},SS=new Set(["UPDATE_STEP_PARAMETER","UPDATE_STEP_DURATIONS","UPDATE_PARAMETER","UPDATE_TRACK_VOLUME","MOVE_AUTOMATION_BREAK_POINT","MOVE_AUTOMATION_BREAK_POINTS",it,st]),PS=function(e,t){var n=e.payload,r=t.payload;if(e.type===it){var a=n.transformation,i=r.transformation,s={stepDifference:a.stepDifference+i.stepDifference,transposeDifference:a.transposeDifference+i.transposeDifference};return Object(D.a)({},t,{payload:Object(D.a)({},r,{transformation:s})})}if("UPDATE_STEP_DURATIONS"===e.type){var o=n.factor*r.factor;return Object(D.a)({},t,{payload:Object(D.a)({},r,{factor:o})})}if(e.type===st&&t.type===it){var c=e.payload.stepLocations,u=r.transformation,l={stepDifference:u.stepDifference+c[0].stepDifference,transposeDifference:u.transposeDifference+c[0].transposeDifference};return Object(D.a)({},t,{payload:Object(D.a)({},r,{transformation:l})})}return e},wS=function(e){var t={};for(var n in e){var r=e[n].operation.type;TS.has(r)||(r in t||(t[r]=[]),t[r].push(e[n]))}var a=0;for(var i in t)a+=jS(t[i],i);return a},jS=function(e,t){return new Set(e.map(function(e){return e.operation.contentId})).size},TS=new Set([st,"SNAP_AUTOMATION_BREAK_POINT"]),xS=0,CS=function(){function e(t,n){Object(o.a)(this,e),this.sequencerEngine=t,this.firebaseHandler=new lS(this,n),this.rulesManager=new vS(this.sequencerEngine),this.actionsRemaining=this.getCurrentRoomState().actionsAllowed||xS,this.queuedActions=[]}return Object(c.a)(e,[{key:"updateCurrentRoomState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getCurrentRoomState();this.actionsRemaining>t.actionsAllowed&&(console.log("room updated to allow fewer actions"),this.actionsRemaining=t.actionsAllowed);var n=1e3*Math.floor((t.lastOperation+t.actionWaitTime-Date.now())/1e3);n>0?(this.actionsRemaining=0,this.timeRemaining=n,this.startActionTimer()):(clearInterval(this.timer),this.timeRemaining=0,this.actionsRemaining=this.actionsRemaining>0?this.actionsRemaining:this.initialActionsRemaining);var r=JSON.parse(t.rules);this.rulesManager.applyRules(r);var a="Rules have changed!";a+=" You're now allowed ".concat(t.actionsAllowed," actions every ").concat(t.actionWaitTime/1e3," seconds."),e&&this.sequencerEngine.operationManager.toast(a)}},{key:"getCurrentRoomState",value:function(){return this.currentRoom?this.getRoomState(this.currentRoom):{}}},{key:"getRoomState",value:function(e){return this.sequencerEngine.store.getState().installation.rooms[e]}},{key:"setRoomState",value:function(e,t,n,r,a,i,s,o,c,u){this.sequencerEngine.store.dispatch(Object(O.tc)(e,t,n,r,a,i,s,o,c,u))}},{key:"setRoomStatePartial",value:function(e,t){var n=this.getRoomState(e),r=Object(D.a)({},n,t);this.sequencerEngine.store.dispatch(O.tc.apply(void 0,Object(M.a)(Object.values(r))))}},{key:"removeRoomState",value:function(e){this.sequencerEngine.store.dispatch(Object(O.m)(e))}},{key:"updateQueuedContentIds",value:function(){var e=new Set;for(var t in this.queuedActions){var n=this.queuedActions[t].operation;Array.isArray(n.contentId)?n.contentId.forEach(function(t){return e.add(t)}):e.add(n.contentId)}e.size!==this.queuedContentIds.length&&(this.queuedContentIds=Array.from(e))}},{key:"logContentId",value:function(e){var t=this.sequencerEngine.store.getState().installation.queuedContentIds;Array.isArray(e)?this.queuedContentIds=Array.from(new Set([].concat(Object(M.a)(t),Object(M.a)(e)))):this.queuedContentIds=Array.from(new Set([].concat(Object(M.a)(t),[e])))}},{key:"logAction",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n,r){var a,i,s;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.serialize(r,t);case 2:if(!(a=e.sent)){e.next=11;break}return i=this.queuedActions.length,this.queuedActions=gS(a,this.queuedActions),s=this.queuedActions.length,this.updateQueuedContentIds(),this.queuedActions[this.queuedActions.length-1].operation.uuid=t,this.actionsRemaining=this.initialActionsRemaining-wS(this.queuedActions),e.abrupt("return",s===i);case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"submitActions",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.actionsRemaining<0)){e.next=2;break}return e.abrupt("return");case 2:return t={type:"operations",roomName:this.getCurrentRoomState().roomName,operations:this.queuedActions.map(function(e){return e.operation})},e.next=5,this.firebaseHandler.socket.send(t);case 5:this.sequencerEngine.operationManager.submitActions(this.queuedActions),this.actionsRemaining=0,this.queuedActions=[],this.timeRemaining=this.getCurrentRoomState().actionWaitTime||1e4,this.firebaseHandler.updateLastOperation(),this.startActionTimer(),this.updateQueuedContentIds(),this.sequencerEngine.updateSteps(!0);case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"startActionTimer",value:function(){var e=this;clearInterval(this.timer),this.timer=setInterval(function(){e.timeRemaining=e.timeRemaining-1e3,e.timeRemaining<=0&&(clearInterval(e.timer),e.actionsRemaining=e.getCurrentRoomState().actionsAllowed||xS)},1e3)}},{key:"removeActionWithId",value:function(e){this.queuedActions.length;this.queuedActions=this.queuedActions.filter(function(t){return t.operation.uuid!==e});this.queuedActions.length;this.actionsRemaining=this.initialActionsRemaining-wS(this.queuedActions),this.updateQueuedContentIds()}},{key:"queuedContentIds",set:function(e){this.sequencerEngine.store.dispatch(Object(O.pc)(e))},get:function(){return this.sequencerEngine.store.getState().installation.queuedContentIds}},{key:"initialActionsRemaining",get:function(){return this.getCurrentRoomState().actionsAllowed||xS}},{key:"actionsRemaining",set:function(e){this.sequencerEngine.store.dispatch(Object(O.p)(e))},get:function(){return this.sequencerEngine.store.getState().installation.actionsRemaining}},{key:"timeRemaining",set:function(e){this.sequencerEngine.store.dispatch(Object(O.Cd)(e))},get:function(){return this.sequencerEngine.store.getState().installation.timeRemaining}},{key:"numMembers",set:function(e){this.sequencerEngine.store.dispatch(Object(O.Ub)(e))},get:function(){return this.sequencerEngine.store.getState().installation.numMembers}},{key:"currentRoom",get:function(){return this.sequencerEngine.store.getState().installation.currentRoom},set:function(e){this.sequencerEngine.store.dispatch(Object(O.Y)(e))}},{key:"lastAction",get:function(){return this.queuedActions[this.queuedActions.length-1]}}]),e}();function NS(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return RS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return RS(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function RS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function DS(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function qS(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return MS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return MS(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function MS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function AS(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function IS(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return LS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return LS(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function LS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function FS(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function BS(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function HS(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var VS=function(e){Object(u.a)(n,e);var t=HS(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).sequencerEngine=e,r.uuids=new Set,r}return Object(c.a)(n,[{key:"dispatch",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r,a,i,s=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>1&&void 0!==s[1]&&s[1],r=s.length>2&&void 0!==s[2]&&s[2],n||!(!this.browseHistory&&this.roomActionsManager.actionsRemaining<=0||this.browseHistory&&this.futureHistoricalActions===[])){e.next=4;break}return e.abrupt("return",{});case 4:if(a=this.makeCopyOfAction(t),void 0!==this.getAction(t)){e.next=7;break}return e.abrupt("return",{});case 7:if(i=this.runAction(t,!r,n),a.payload=Object(D.a)({},a.payload,i),n){e.next=12;break}return e.next=12,this.logAction(a);case 12:return e.abrupt("return",i);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"runAction",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=this.getAction(e);if(void 0!==a)return n||r||this.roomActionsManager.logContentId(a.getContentId(e)),a.execute(e.payload,t,n)}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=BS(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).toastTimer=void 0,e}return Object(c.a)(n,[{key:"toast",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;clearTimeout(this.toastTimer),this.showToast=!1,this.toastMessage=e,this.showToast=!0,n>0&&(this.toastTimer=setTimeout(function(){t.showToast=!1},n))}},{key:"showToast",set:function(e){this.sequencerEngine.store.dispatch(Object(O.id)(e))},get:function(){return this.sequencerEngine.store.getState().installation.showToast}},{key:"toastMessage",set:function(e){this.sequencerEngine.store.dispatch(Object(O.Dd)(e))},get:function(){return this.sequencerEngine.store.getState().installation.toastMessage}},{key:"hideInterface",set:function(e){this.sequencerEngine.store.dispatch(Object(O.tb)(e))},get:function(){return this.sequencerEngine.store.getState().installation.hideInterface}}]),n}(e)}(function(e){return function(e){Object(u.a)(n,e);var t=AS(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).executedActions=[],e.undoneActions=[],e}return Object(c.a)(n,[{key:"logAction",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r,a,i;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(A.uuid)(),e.next=3,this.roomActionsManager.logAction(n,this.getAction(t),t);case 3:r=e.sent,t=Object(D.a)({},t,{payload:Object(D.a)({},t.payload),contentId:this.getAction(t).getContentId(t)}),kS(t.type)?void 0===(a=this.roomActionsManager.lastAction)?this.executedActions.push(t):(i=this.getAction(a.operation).deserialize(a.operation),r?this.executedActions[this.executedActions.length-1]=i:this.executedActions.push(i)):r||this.executedActions.push(Object(D.a)({},t,{uuid:n})),this.executedActions[this.executedActions.length-1].uuid=this.roomActionsManager.lastAction?this.roomActionsManager.lastAction.operation.uuid:n,this.updateUndoRedux();case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"undo",value:function(){if(this.executedActions.length>0){var e=this.executedActions.pop();if(!this.roomActionsManager.queuedActions.some(function(t){return t.operation.uuid===e.uuid}))return;this.undoAction(e),this.undoneActions.push(e),this.updateUndoRedux()}}},{key:"undoAction",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getAction(e);return void 0===n?{}:(this.roomActionsManager.removeActionWithId(e.uuid),n.undo(e,t))}},{key:"redo",value:function(){if(this.undoneActions.length>0){var e=this.undoneActions.pop();this.runAction(e),this.logAction(e),this.updateUndoRedux()}}},{key:"submitActions",value:function(e){this.addHistoricalActions(e.map(function(e){return e.operation})),this.executedActions=[],this.undoneActions=[],this.updateUndoRedux()}},{key:"resetUndo",value:function(){if(0!==this.executedActions.length){var e,t=qS(this.executedActions);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.undoAction(n,!1)}}catch(r){t.e(r)}finally{t.f()}this.sequencerEngine.updateSteps(!0),this.executedActions=[],this.undoneActions=[],this.roomActionsManager.queuedActions=[],this.roomActionsManager.updateQueuedContentIds()}}},{key:"reset",value:function(){this.executedActions=[],this.undoneActions=[],this.historicalActions=[],this.futureHistoricalActions=[],this.updateHistoryLength()}},{key:"updateUndoRedux",value:function(){this.sequencerEngine.store.dispatch(Object(O.ae)(this.executedActions.length,this.undoneActions.length))}}]),n}(e)}(function(e){return function(e){Object(u.a)(n,e);var t=DS(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"setupSyncing",value:function(){var e=this;this.roomActionsManager=new CS(this.sequencerEngine,function(t,n){return e.onSyncedOperations(t,n)})}},{key:"onSyncedOperations",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r,a,i,s,o,c,u,l=this,p=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=p.length>1&&void 0!==p[1]&&p[1],t=t.filter(function(e){return!l.uuids.has(e.uuid)}),n||this.browseHistory||this.resolveAnyMergeConflicts(t),r=0,a={},i=NS(t),e.prev=6,i.s();case 8:if((s=i.n()).done){e.next=27;break}if(o=s.value,!n){e.next=13;break}return e.next=13,this.updateLoadingProgress(r,t.length);case 13:if(!this.browseHistory){e.next=18;break}return this.addFutureHistoricalActions(o),e.abrupt("continue",25);case 18:this.addHistoricalActions(o);case 19:if(void 0!==(c=this.getAction(o))){e.next=22;break}return e.abrupt("continue",25);case 22:(u=c.deserialize(o))&&(this.dispatch(u,!0,n),"UPDATE_PARAMETER"===u.type&&(a[u.payload.parameter.id]=u.payload.value)),r++;case 25:e.next=8;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(6),i.e(e.t0);case 32:return e.prev=32,i.f(),e.finish(32);case 35:this.sequencerEngine.store.dispatch(Object(O.hb)(a));case 36:case"end":return e.stop()}},e,this,[[6,29,32,35]])}));return function(t){return e.apply(this,arguments)}}()},{key:"resolveAnyMergeConflicts",value:function(e){var t=this,n=this.roomActionsManager.queuedActions;console.log("Queued actions to check for conflicts =",Object(M.a)(this.roomActionsManager.queuedActions)),console.log("incoming actions = ",Object(M.a)(e));var r=n.filter(function(n){return e.some(function(e){return t.actionsConflict(n.operation,e)})}).map(function(e){var n=e.operation;return t.getAction(n).deserialize(n)});console.log("deserialized conflicts = ",r),r.reverse(),r.forEach(function(e){return t.undoAction(e,!1)}),this.sequencerEngine.updateSteps(!0),this.executedActions=this.executedActions.filter(function(e){return!r.some(function(t){return t.uuid===e.uuid})}),this.updateUndoRedux(),r.length>0&&this.roomActionsManager.updateQueuedContentIds()}},{key:"actionsConflict",value:function(e,t){return this.getAction(e).conflictsWith(e,t)}},{key:"updateLoadingProgress",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t%100!==0){e.next=4;break}return this.sequencerEngine.loadingProgress=75+t/n*25,e.next=4,this.sleep(5);case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"sleep",value:function(e){return new Promise(function(t,n){setTimeout(t,e)})}}]),n}(e)}(function(e){return function(e){Object(u.a)(n,e);var t=FS(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).historicalActions=[],e.futureHistoricalActions=[],e.lastHistoryReduxUpdate=0,e.needsUpdate=!1,e.HISTORY_REDUX_UPDATE_TIMEOUT_MS=100,e.HISTORY_REDUX_UPDATE_MAX_SIZE=3,e.bulkParameterValues={},e}return Object(c.a)(n,[{key:"updateHistoryLength",value:function(){this.historyLength=this.historicalActions.length+this.futureHistoricalActions.length}},{key:"addHistoricalActions",value:function(e){var t;Array.isArray(e)?(t=this.historicalActions).push.apply(t,Object(M.a)(e)):this.historicalActions.push(e),this.updateHistoryLength()}},{key:"addFutureHistoricalActions",value:function(e){var t;Array.isArray(e)?(t=this.futureHistoricalActions).push.apply(t,Object(M.a)(e)):this.futureHistoricalActions.push(e),this.updateHistoryLength()}},{key:"historySliderChanged",value:function(e){this.resetUndo();var t=e-this.historyPosition,n={};if(t<0){var r=this.historicalActions.slice(t);this.historicalActions=this.historicalActions.slice(0,t),this.futureHistoricalActions=[].concat(Object(M.a)(r),Object(M.a)(this.futureHistoricalActions)),r.reverse();var a,i=IS(r);try{for(i.s();!(a=i.n()).done;){var s=a.value;try{var o=this.getAction(s).deserialize(s);this.undoAction(o,!1),"UPDATE_PARAMETER"===o.type&&(n[o.payload.parameter.id]=o.payload.value)}catch(f){console.log("Error getting, deserializing, or undoing action:",s,f)}}}catch(d){i.e(d)}finally{i.f()}}else if(t>0){var c=this.futureHistoricalActions.slice(0,t);this.historicalActions=[].concat(Object(M.a)(this.historicalActions),Object(M.a)(c)),this.futureHistoricalActions=this.futureHistoricalActions.slice(t);var u,l=IS(c);try{for(l.s();!(u=l.n()).done;){var p=u.value;try{var h=this.getAction(p).deserialize(p);this.runAction(h,!1,!1,!0),"UPDATE_PARAMETER"===h.type&&(n[h.payload.parameter.id]=h.payload.value)}catch(f){console.log("Error getting, deserializing, or redoing action:",p,f)}}}catch(d){l.e(d)}finally{l.f()}}Math.abs(t)<=this.HISTORY_REDUX_UPDATE_MAX_SIZE&&Date.now()>this.lastHistoryReduxUpdate+this.HISTORY_REDUX_UPDATE_TIMEOUT_MS?(this.lastHistoryReduxUpdate=Date.now(),this.sequencerEngine.updateSteps(!0),this.needsUpdate=!1,this.setEffectParameterValues(n)):(this.needsUpdate=!0,this.bulkParameterValues=Object(D.a)({},this.bulkParameterValues,{bulkParameterValues:n})),this.historyPosition=e,this.historicalActions.length>0?this.historyTimestamp=this.historicalActions[this.historicalActions.length-1].timestamp:this.historyTimestamp=0}},{key:"historySliderStopped",value:function(e){this.needsUpdate&&(this.sequencerEngine.updateSteps(!0),this.setEffectParameterValues(this.bulkParameterValues),this.bulkParameterValues={})}},{key:"setEffectParameterValues",value:function(e){this.sequencerEngine.store.dispatch(Object(O.hb)(e))}},{key:"browseHistory",set:function(e){e?(this.historyPosition=this.historyLength,this.historicalActions.length>0?this.historyTimestamp=this.historicalActions[this.historicalActions.length-1].timestamp:this.historyTimestamp=0):(this.historySliderChanged(this.historyLength),this.historySliderStopped(this.historyLength)),this.sequencerEngine.store.dispatch(Object(O.M)(e)),this.updateUndoRedux()},get:function(){return this.sequencerEngine.store.getState().installation.browseHistory}},{key:"historyLength",set:function(e){this.sequencerEngine.store.dispatch(Object(O.ub)(e))},get:function(){return this.sequencerEngine.store.getState().installation.historyLength}},{key:"historyTimestamp",set:function(e){this.sequencerEngine.store.dispatch(Object(O.wb)(e))},get:function(){return this.sequencerEngine.store.getState().installation.historyTimestamp}},{key:"historyPosition",set:function(e){this.sequencerEngine.store.dispatch(Object(O.vb)(e))},get:function(){return this.sequencerEngine.store.getState().installation.historyPosition}}]),n}(e)}(iS))))),US=0,JS=function(){function e(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:x.a.Transport;var n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;Object(o.a)(this,e),this.idToParameter={},this.stereoOnly=r,this.engineId=US++,this.transport.swingSubvision="16n",this.ethereum=d.a,this.context=x.a.Master.context,this.store=t,this.encryptedIpfs=new gr.a(this.store,d.a.guilds,d.a.encryption,d.a.crypto),this.mix=new So(this),this.channelMixer=new YE(this),this.audioInputManager=new KE(this.store),this.sends=new WE(!1,this.channelMixer,this),this.subSequences=[],this.newSubSequence(),this.audioSettings=new QE,this.recordingsCounter=1,this.operationManager=new VS(this),this.parameterLocks=[new Dk,new Dk],void 0!==n?this.aubio=n:this.initAubio(),window.sequencerEngine=this,this.resampleConfig={samplesPerNote:1},this.rules=new VE,this.operationManager.setupSyncing()}return Object(c.a)(e,[{key:"initAubio",value:function(){var e=this;window.Aubio().then(function(t){console.log("initialized aubio"),e.aubio=t})}},{key:"newSubSequence",value:function(e,t){var n=new Tb(this,void 0!==t);return t&&n.addTrack(t),void 0!==e&&n.setId(e),this.addSubSequence(n,void 0===t),n}},{key:"deleteSubSequence",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentSubSequence.id;if(1!==this.subSequences.length){var t=-1;for(var n in this.subSequences)if(this.subSequences[n].id===e){t=n;break}if(!(t<0)){var r=this.subSequences.filter(function(t){return t.id!==e})[0];this.switchToSubSequence(r.id),this.subSequences[t].dispose(),this.subSequences.splice(t,1),this.store.dispatch(Object(O.Bd)(this.engineId,this.subSequences.map(function(e){return e.id})))}}}},{key:"addSubSequence",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.subSequences.push(e),this.currentSubSequence=e,this.store.dispatch(Object(O.Bd)(this.engineId,this.subSequences.map(function(e){return e.id}))),this.store.dispatch(Object(O.X)(e.id,0)),t&&this.store.dispatch(Object(O.Z)(this.engineId,this.currentSubSequence.id))}},{key:"switchToSubSequence",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.subSequences.filter(function(t){return t.id===e})[0];void 0!==n&&(this.currentSubSequence=n,this.store.dispatch(Object(O.Z)(this.engineId,this.currentSubSequence.id)),this.store.dispatch(Object(O.Vb)(this.currentSubSequence.id,this.numberOfPatterns())),t&&this.updateTracks(),this.groups.updateGroups())}},{key:"switchToNextSubSequence",value:function(){var e=this.subSequences.indexOf(this.currentSubSequence);e<this.subSequences.length-1?e++:e=0,this.switchToSubSequence(this.subSequences[e].id)}},{key:"switchToPreviousSubSequence",value:function(){var e=this.subSequences.indexOf(this.currentSubSequence);e>0?e--:e=this.subSequences.length-1,this.switchToSubSequence(this.subSequences[e].id)}},{key:"getSequenceId",value:function(){return void 0===this.loadedSequenceId?0:this.loadedSequenceId}},{key:"setMasterVolume",value:function(e,t){this.groups.channelMixer.setVolume(e,t)}},{key:"getMasterVolume",value:function(){this.groups.channelMixer.getVolume()}},{key:"getSubSequenceName",value:function(e){for(var t=["A","B","C","D","E","F","G","H","I","J","K"],n=0;n<this.subSequences.length;n++)if(this.subSequences[n].id===e)return t[n];return""}},{key:"getSubSequence",value:function(e){return this.subSequences.filter(function(t){return t.id===e})[0]||this.subSequences[0]}},{key:"auditionSound",value:function(e,t){var n=this.tracks[t];this.tracks.filter(function(e){return e!==n}).filter(function(e){return e.isAuditioning()}).forEach(function(e){return e.completeAudition()}),n.auditionSound(e)}},{key:"addSound",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n,r,a){var i,s,o,c=this,u=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=u.length>4&&void 0!==u[4]&&u[4],s={slices:void 0===r||0==r.length?void 0:r,offset:0,transpose:0,volume:0},void 0!==n){e.next=18;break}return(o=new Zb(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return c.update()},this.currentSubSequence)).setSends(this.sends),o.setupEffects(),this.currentSubSequence.addTrack(o),o.switchToPattern(this.currentPattern),e.next=10,o.addSound(t,s,!0);case 10:return this.groups.addTrack(o),i&&(this.recordingsCounter++,this.newRecordingToSaveLater(t)),this.selectTrack(this.tracks.length-1),this.tracks.filter(function(e){return e.isAuditioning()}).forEach(function(e){return e.completeAudition()}),o.updateSteps(),e.abrupt("return",o);case 18:if(!(this.tracks.length>n)){e.next=23;break}return(o=this.tracks[n]).addSound(t,s),this.selectTrack(n),e.abrupt("return",o);case 23:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"transcribeIntoMidi",value:function(e){var t=this;return new Promise(function(n,r){var a=e.getSamplers()[0],i=a.getSlice(0);Object(yE.a)(i.buffer._buffer).then(function(e){var r=e.notes;t.addMidiTrack().addNotes(r,a.tempo),n()})})}},{key:"duplicateTrack",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.tracks[t]){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.tracks[t].getCopy();case 4:n=e.sent,this.setupNewTrack(n,!0),n.setupEffects(),this.currentSubSequence.addTrack(n),this.updateTracks(),this.groups.addTrack(n),this.update();case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"deleteTrack",value:function(e,t){"MIDI"==this.tracks[e].getTrackType()&&this.tracks[e].disconnect();var n=this.tracks[e],r=n.sample,a=this.samplesToSync.indexOf(r);for(var i in a>-1&&this.samplesToSync.splice(a,1),this.tracks)this.tracks[i].chokes.choke===n&&(this.tracks[i].chokes.choke=void 0);n.group;this.groups.deleteTrack(n),this.rollingManager.deleteTrack(n),t?this.tracks[e]=t:this.tracks.splice(e,1),this.cursor.track>=e&&(this.cursor.track--,this.cursor.track<0&&(this.cursor.track=0)),this.scripting.deleteHistoryForTrack(e),this.keyboardEngine&&this.keyboardEngine.deleteTrack(e),this.tracks.forEach(function(e,t){e.trackNumber=t}),this.tracks.forEach(function(e,t){return e.updateSteps()});var s=n.subSequence.id,o=this.state.tracks.tracksFrozen[s]||{},c=this.state.tracks.frozenTracksPlaying[s]||{};this.store.dispatch(Object(O.ob)(s,Le(e,o)));this.store.dispatch(Object(O.pb)(s,Le(e,c)));var u=this.state.effects.effectsChainToShow[s]||{};this.store.dispatch(Object(O.kb)(s,Le(e,u))),this.updateSteps(),this.update(),this.selectTrack(Math.max(e-1,0));var l=this.tracks.map(function(e){return e.isWarped()});this.store.dispatch(Object(O.Ad)(s,l)),n.dispose()}},{key:"newPattern",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.numberOfPatterns()+1,r=this.tracks.map(function(e){return e.newPattern(t)}),e.next=4,Promise.all(r);case 4:this.store.dispatch(Object(O.Vb)(this.currentSubSequence.id,n)),this.lfosTrack.newPattern(n),this.envelopesTrack.newPattern(n);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"deletePattern",value:function(e){if(0!=this.tracks.length&&1!=this.tracks[0].patterns.length){e=e||this.tracks[0].currentPattern,this.tracks.map(function(t){return t.deletePattern(e)});var t=e>0?e-1:0;this.switchToPattern(t),this.store.dispatch(Object(O.Vb)(this.currentSubSequence.id,this.numberOfPatterns())),this.lfosTrack.deletePattern(e),this.envelopesTrack.deletePattern(e)}}},{key:"switchToPattern",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.currentSubSequence;e<0||n.tracks.length<=0||n.tracks[0].patterns.length<=e||(this.state.mix.isRecordingMix&&!t?n.mix.addEvent(new _(e)):t||n.mix.holdEvent(new _(e)),this.switchToPatternHelper(e,n),n.lfosTrack.switchToPattern(e),n.envelopesTrack.switchToPattern(e),this.getAllPatternLockedParameters().forEach(function(e){return e.updateRedux()}))}},{key:"getCurrentPattern",value:function(e){return this.store.getState().sequencer.currentPattern[e.id]}},{key:"switchToPatternHelper",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.currentSubSequence,n=((new Date).getTime(),t.tracks.map(function(t){return t.switchToPattern(e)})),r={};for(var a in n)r=Object(D.a)({},r,n[a]);this.store.dispatch(Object(O.hb)(r));(new Date).getTime();this.store.dispatch(Object(O.X)(t.id,e));(new Date).getTime();"ARRANGEMENT_VIEW"!==this.viewMode&&this.updateSteps();(new Date).getTime()}},{key:"updateSteps",value:function(e){var t=this.tracks.map(function(e){return e.getUpdateStepsAction()});this.store.dispatch(Object(O.le)(t))}},{key:"switchToLastPattern",value:function(){0!=this.tracks.length&&this.switchToPattern(this.numberOfPatterns()-1)}},{key:"switchToPreviousPattern",value:function(){if(0!=this.tracks.length){var e=this.tracks[0].currentPattern-1%this.tracks[0].patterns.length;this.switchToPattern(e)}}},{key:"switchToNextPattern",value:function(){if(0!=this.tracks.length){var e=this.tracks[0].currentPattern+1%this.tracks[0].patterns.length;this.switchToPattern(e)}}},{key:"movePatternTo",value:function(e,t){this.tracks.forEach(function(n){return n.movePatternTo(e,t)}),this.switchToPattern(t),this.lfosTrack.movePatternTo(e,t)}},{key:"numberOfPatterns",value:function(){return 0==this.tracks.length?1:this.tracks[0].patterns.length}},{key:"isLoaded",value:function(e){return void 0!==this.tracks&&void 0!==this.tracks[e]&&this.tracks[e].isLoaded()}},{key:"setUpdateCallback",value:function(e){this.callback=e}},{key:"update",value:function(e){void 0!==this.callback&&this.callback(e)}},{key:"addTrack",value:function(e){this.currentSubSequence.addTrack(e),e.setupEffects(),this.groups.addTrack(e),this.setupNewTrack(e)}},{key:"addAudioTrack",value:function(){var e=this,t=new JE(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence);return this.setupNewTrack(t),t}},{key:"addSampledInstrumentTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],new xE(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence));return this.groups.addTrack(t),this.setupNewTrack(t),t}},{key:"addInstrumentRackTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1]),n=new qE(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence);return this.groups.addTrack(n),this.setupNewTrack(n,t),n}},{key:"addInstrumentTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],new Gk(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence));return this.groups.addTrack(t),this.setupNewTrack(t),t}},{key:"addFMSynthTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],new uE(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence));return this.groups.addTrack(t),this.setupNewTrack(t),t}},{key:"addMetalSynthTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],new LE(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence));return this.groups.addTrack(t),this.setupNewTrack(t),t}},{key:"addMultiSynthTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],new nE(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence));return this.groups.addTrack(t),this.setupNewTrack(t),t}},{key:"addMidiTrack",value:function(){var e=this,t=new Lk(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence);return t.setMidiEngine(this.midi),t.setAudioSettings(this.audioSettings),this.setupNewTrack(t),t}},{key:"setupNewTrack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.isRecordable()&&this.setupRecordableTrack(e,t),e.sequencerEngine=this,n||e.setSends(this.sends),e.setKeyboardEngine(this.keyboardEngine),t||this.currentSubSequence.addTrack(e),t?e.switchToPattern(0):e.switchToPattern(this.tracks[0].currentPattern),this.update(),this.updateTracks()}},{key:"setupRecordableTrack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.setAudioInputManager(this.audioInputManager),t||this.groups.addTrack(e),e.setSequencerEngine(this)}},{key:"updateTracks",value:function(){var e=this;this.tracks.forEach(function(t,n){t.trackNumber=n,t.sequencerEngine=e,t.patterns.forEach(function(t){return t.sequencerEngine=e})});var t=this.tracks.map(function(e){return e.getUpdateStepsAction()});this.store.dispatch(Object(O.le)(t))}},{key:"dispose",value:function(){for(var e in this.loadedSamples)this.loadedSamples[e].dispose();this.loadedSamples={},this.channelMixer.dispose(),this.channelMixer=void 0,this.sends.dispose(),this.subSequences.forEach(function(e){return e.dispose()}),this.store.dispatch(Object(O.a)(this.sequenceId))}},{key:"newSequence",value:function(){for(var e in this.subSequences){this.subSequences[e].dispose()}this.subSequences=[],this.newSubSequence(),this.mix=new So(this),this.update(),this.store.dispatch(Object(O.Vb)(this.currentSubSequence.id,1)),this.store.dispatch(Object(O.l)()),this.loadedSequenceId=void 0,this.stop()}},{key:"scrollToSelectedTrack",value:function(){var e=this;this.tracks.length<3||setTimeout(function(){window.location.hash="",window.location.hash="track-"+(e.cursor.track+1)},50)}},{key:"togglePatternLock",value:function(){this.store.dispatch(Object(O.Qc)(this.currentPattern,!this.patternLocked))}},{key:"getAllPatternLockedParameters",value:function(){return this.parameters.filter(function(e){return e.hasPatternLockedValues()})}},{key:"transport",get:function(){return x.a.Transport}},{key:"mixes",get:function(){return[].concat(Object(M.a)(this.subSequences.map(function(e){return e.mix})),[this.mix])}},{key:"tracks",get:function(){return this.currentSubSequence.tracks},set:function(e){this.currentSubSequence.tracks=e}},{key:"groups",get:function(){return this.currentSubSequence.groups},set:function(e){this.currentSubSequence.groups=e}},{key:"sequenceId",get:function(){return this.getSequenceId()}},{key:"rollingResolution",set:function(e){if(this.store.getState().mix.isRecordingMix){var t=this.mix.getEvent(Se,this.automationStep),n=new ue(e);n.step=this.automationStep,t.addSubEvent(n)}else this.state.mix.isPlayingMix&&this.mix.holdEvent(new ue(e))},get:function(){if(this.store.getState().mix.isPlayingMix){var e=this.mix.getEvent(Se,this.automationStep);if(void 0!==e)return e.getSubEvent(this.automationStep).getValue()}return this.resolution}},{key:"resolution",set:function(e){if(this.resolution.isTriplet!==e.isTriplet)for(var t in this.subSequences)for(var n in this.subSequences[t].tracks){var r=this.subSequences[t].tracks[n];r.pattern.needsSync&&r.pattern.syncBuckets(this.resolution.isTriplet)}this.rollingResolution=e,this.state.midi.midiMapMode===cu&&this.store.dispatch(Object(O.n)(new Ck(this,e))),this.store.dispatch(Object(O.sc)(e)),this.tracks.forEach(function(t){return t.updatePatternRollStepNumber(e)}),"ARRANGEMENT_VIEW"!==this.state.sequencer.viewMode&&this.updateSteps()},get:function(){return this.state.sequencer.resolution}},{key:"state",get:function(){return this.store.getState()}},{key:"length",get:function(){var e=-1;for(var t in this.subSequences)for(var n in this.subSequences[t].tracks){var r=this.subSequences[t].tracks[n].length;r>=e&&(e=r)}return e}},{key:"subSequenceMix",get:function(){return this.currentSubSequence.mix}},{key:"currentPattern",get:function(){return this.getCurrentPattern(this.currentSubSequence)}},{key:"patternLocks",set:function(e){this.store.dispatch(Object(O.Rc)(e))}},{key:"viewMode",get:function(){return this.state.sequencer.viewMode}},{key:"patternLocked",get:function(){return this.store.getState().sequencer.patternLocks[this.currentPattern]||!1}},{key:"guildId",get:function(){return this.state.guilds.selectedGuild?this.state.guilds.selectedGuild.guildId:0}},{key:"metronomeOn",get:function(){return!this.metronome.muted},set:function(e){this.metronome.mute(!e)}}]),e}();function _S(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}function GS(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return zS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zS(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function zS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var WS=function(){function e(){Object(o.a)(this,e),this.addListeners(),this.currentChord=void 0,this.lastChordTime=void 0,this.newChordListeners=[],this.sameChordListeners=[],this.octaveUpListeners=[],this.octaveDownListeners=[]}return Object(c.a)(e,[{key:"addListeners",value:function(){var e=this;window.addEventListener("CHORD_ON_EVENT",function(t){e.chordOn(t.notesDown)}),window.addEventListener("CHORD_OFF_EVENT",function(t){e.chordOff(t.notesDown)})}},{key:"setCurrentChord",value:function(e){this.currentChord=e,this.lastChordTime=(new Date).getTime()}},{key:"chordOn",value:function(e){void 0===this.currentChord||(this.isSameChord(this.currentChord,e)?this.sameChord():this.isOctaveUp(this.currentChord,e)?this.octaveUp(e):this.isOctaveDown(this.currentChord,e)?this.octaveDown(e):this.isOctaveDown(this.currentChord,e,2)?(console.log("its two octaves down!"),this.twoOctavesDown(e)):this.isOctaveUp(this.currentChord,e,2)&&(console.log("its two octaves up!"),this.twoOctavesUp(e))),void 0!==this.currentChord&&(this.chordContains(this.currentChord,e)||this.isSameChord(this.currentChord,e))||this.newChord(e)}},{key:"dispatchEvent",value:function(e){var t=new Event(e);t.chord=this.currentChord,window.dispatchEvent(t)}},{key:"sameChord",value:function(){this.dispatchEvent("SAME_CHORD")}},{key:"octaveDown",value:function(e){this.dispatchEvent("OCTAVE_DOWN")}},{key:"twoOctavesDown",value:function(e){this.dispatchEvent("TWO_OCTAVES_DOWN")}},{key:"octaveUp",value:function(e){this.dispatchEvent("OCTAVE_UP")}},{key:"twoOctavesUp",value:function(e){this.dispatchEvent("TWO_OCTAVES_UP")}},{key:"newChord",value:function(e){this.setCurrentChord(e),this.dispatchEvent("NEW_CHORD")}},{key:"stripOctave",value:function(e){return new Set(Array.from(e).map(function(e){return _i.a.fromString(e).note}))}},{key:"chordContains",value:function(e,t){e=this.stripOctave(e);var n,r=GS(t=this.stripOctave(t));try{for(r.s();!(n=r.n()).done;){var a=n.value;if(!e.has(a))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}},{key:"isOctaveUp",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=!0,i=GS(e);try{for(i.s();!(n=i.n()).done;){var s=n.value,o=_i.a.fromString(s).addTranspose(12*r).toString();t.has(o)||(a=!1)}}catch(c){i.e(c)}finally{i.f()}return a}},{key:"isOctaveDown",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=!0,i=GS(e);try{for(i.s();!(n=i.n()).done;){var s=n.value,o=_i.a.fromString(s).addTranspose(-12*r).toString();t.has(o)||(a=!1)}}catch(c){i.e(c)}finally{i.f()}return a}},{key:"isSameChord",value:function(e,t){return this.eqSet(e,t)}},{key:"eqSet",value:function(e,t){if(e.size!==t.size)return!1;var n,r=GS(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(!t.has(a))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}},{key:"chordOff",value:function(e){}},{key:"addCallback",value:function(){}}]),e}(),KS=function(){function e(t,n){Object(o.a)(this,e),this.chordsManager=new WS,this.sequencerEngine=t,this.store=this.sequencerEngine.store,this.keyboardEngine=n,this.recordedTriggers={},this.notesDown=new Set}return Object(c.a)(e,[{key:"onNoteDown",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(n&&this.addNoteOn(e),!(e in this.recordedTriggers)){var i=this.store.getState().sequencer.resolution,s=this.store.getState().sequencer.quantized;this.keyboardEngine.onKeyDown(e,i,!this.sequencerEngine.rolling,n,r,a);var o=this.keyboardEngine.recordHit(e,n,i,s,r,a);null!=o&&("tracks"in o?o.recordedTriggers.forEach(function(e){t.sequencerEngine.tracks[e.trackNumber];t.sequencerEngine.rollingManager.addTrackSlice(e.trackNumber,0,o.transpose),t.store.dispatch(Object(O.he)(e.trackNumber,e.sliceNumber))}):(this.sequencerEngine.rollingManager.addTrackSlice(o.trackNumber,o.sliceNumber),this.store.dispatch(Object(O.he)(o.trackNumber,o.sliceNumber))),this.recordedTriggers[e]=o)}}},{key:"onAlphabetKeyDown",value:function(e){this.onNoteDown(e.key,!1)}},{key:"addNoteOn",value:function(e){this.notesDown=new Set(this.notesDown),this.notesDown.add(e);var t=new Event("CHORD_ON_EVENT");t.notesDown=this.notesDown,window.dispatchEvent(t)}},{key:"addNoteOff",value:function(e){this.notesDown.has(e)&&(this.notesDown=new Set(this.notesDown),this.notesDown.delete(e));var t=new Event("CHORD_OFF_EVENT");t.notesDown=this.notesDown,window.dispatchEvent(t)}},{key:"onNoteOff",value:function(e){var t=this;if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.addNoteOff(e),e in this.recordedTriggers){var n=this.recordedTriggers[e];if(void 0!==n.tracks)n.recordedTriggers.forEach(function(e){return t.store.dispatch(Object(O.ie)(e.trackNumber,e.sliceNumber))}),n.recordedTriggers.filter(function(e){return e.rolling}).forEach(function(e){e.track;t.sequencerEngine.rollingManager.removeTrackSlice(e.trackNumber,0,n.transpose)}),n.tracks.filter(function(e){return e.trackData}).filter(function(e){return!e.rolling}).forEach(function(r){t.releaseAndRecord(r,n,e,!0)});else{var r=this.sequencerEngine.tracks[n.trackNumber];if(void 0===r)return;this.sequencerEngine.rollingManager.removeTrackSlice(n.trackNumber,n.sliceNumber,void 0),this.store.dispatch(Object(O.ie)(n.trackNumber,n.sliceNumber)),r.rolling||this.releaseAndRecord(r,n,e)}delete this.recordedTriggers[e]}}},{key:"onKeyUp",value:function(e){this.onNoteOff(e.key)}},{key:"releaseAndRecord",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=t.transpose;void 0===a&&(a=e.trackData.transpose),e.midiEffects.liveInputRelease(r?a+e.trackData.transpose:a,t.sliceNumber),(this.store.getState().sequencer.isRecording||e.subSequence.isTrack&&this.store.getState().mix.isRecordingMix)&&t.record(this.sequencerEngine)}}]),e}();function QS(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var XS=function(e){Object(u.a)(n,e);var t=QS(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,Bb)).sequencerEngine=e,r}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e>63.5;this.sequencerEngine.trackRolling=t}}]),n}(wk);function YS(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var ZS=function(e){Object(u.a)(n,e);var t=YS(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,Hb)).sequencerEngine=e,r}return Object(c.a)(n,[{key:"execute",value:function(e){var t=e>63.5;console.log("excecuting sequence roll action"),this.sequencerEngine.sequenceRolling=t}}]),n}(wk);function $S(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var eP=new x.a.Time("16n"),tP=new x.a.Time("32n"),nP=function(e){Object(u.a)(n,e);var t=$S(n);function n(e,r,a,i){var s;return Object(o.a)(this,n),(s=t.call(this,e,r,a,i)).currentStepTime=null,s.previousStepTime=null,s.lastTrackStep=void 0,s.tracksToRecord={},s.tracksRecording={},s.rollingManager=new sk,s.nextTimeScheduled=void 0,s.nextStepScheduled=void 0,s.startedTransportExplicitly=!1,s.patternSwitchScheduled=null,s.isRecording=!1,s.playing=!1,s.sequenceRolling=!1,s.resampler=void 0,s.automationStep=0,s.bpmParameter=new Be("BPM",Object(W.a)(s),function(e,t){return s.onNewBpm(t)},{min:1,max:500,unit:"",defaultValue:s.transport.bpm.value}),s.swingParameter=new Be("Swing",Object(W.a)(s),function(e,t){s.onNewSwing(t)},{min:50,max:75,unit:"",defaultValue:50}),s.parameters=[],s.registerParameter(s.bpmParameter),s.registerParameter(s.swingParameter),s.latency=void 0,s.clockSync=new Nb(Object(W.a)(s)),s.masterResampler=new Wi(Object(W.a)(s),s.groups.channelMixer.stereoMerger,!0),s.transpose=0,s.autoResampleMode=!1,s.metronome=new tk(Object(W.a)(s),s.mixSession,1,function(){return[]}),s.deleting=!1,s}return Object(c.a)(n,[{key:"registerParameter",value:function(e){this.parameters.push(e),e.setStore(this.store),e.setContext((new Wr).forSequencerEngine(this))}},{key:"startPlaySequence",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.playSequence.cancel(),this.playSequence.start(t),this.getSamplerPlaySequence&&this.getSamplerPlaySequence().start(t);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"schedulePlay",value:function(){!this.playing&&this.clockSync.connected&&"SLAVE"===this.clockSync.clockType?this.store.dispatch(Object(O.lc)(!0)):this.play()}},{key:"play",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.playTimestamp=(new Date).getTime(),this.playing=!this.playing,this.latency=void 0,this.trackStep=this.isLooping&&this.state.mix.isPlayingMix?this.loopStart:this.startStep,this.currentStep=0,this.previousStep=0,this.previousStepTime=void 0,this.currentStepTime=void 0,this.playing){for(var n in t||this.hasAtleastOneSequencerEnginePlaying()||this.updateBpm(this.bpm),this.startPlaySequence(e,t),!t&&this.hasAtleastOneSequencerEnginePlaying()||(this.startedTransportExplicitly=!0,this.transport.start("+0.00001"),this.midi&&this.midi.onPlay()),this.subSequences)this.subSequences[n].lfosTrack.start(),this.subSequences[n].tracks.forEach(function(e){return e.restart()}),this.subSequences[n].tracks.forEach(function(e){return e.start()});this.store.dispatch(Object(O.Cb)(this.getSequenceId(),!0))}else this.stop();this.store.dispatch(Object(O.lc)(!1))}},{key:"restartAllMixes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.isLooping;for(var t in this.mixes.forEach(function(t){return t.restart(e)}),this.setSequenceRolling(!1,void 0,!0),this.subSequences)for(var n in this.subSequences[t].tracks){this.subSequences[t].tracks[n].patternRollStepNumber=void 0}this.schedulePatternBufferClear=!1}},{key:"stop",value:function(){for(var e in this.restartAllMixes(),this.latency=void 0,this.playing=!1,this.trackStepReal=0,this.playSequence.stop(),this.startedTransportExplicitly=!1,this.hasMultipleSequencerEnginesPlaying()||(this.transport.stop("+0.01"),this.midi&&this.midi.onStop()),this.subSequences)this.subSequences[e].lfosTrack.stop();for(var t in this.tracks.map(function(e){return e.effects.filter(function(e){return e.syncable()}).map(function(e){return e.stop()})}),this.store.dispatch(Object(O.Cb)(this.getSequenceId(),!1)),this.store.dispatch(Object(O.Db)(!1)),this.store.dispatch(Object(O.W)(this.getSequenceId(),0)),this.clockSync&&this.clockSync.onStop(),this.subSequences)this.subSequences[t].tracks.forEach(function(e){e.chokes.chokingDuration=0,e.chokes.liveRelease()});this.playSequence.cancel(),this.loadNewSequence()}},{key:"seekToTrackStep",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.isLooping&&(this.looping=!1),this.trackStep=e,this.mixes.forEach(function(t){return t.seekToTrackStep(e)}),0==e&&n&&this.switchToPatternHelper(0),this.subSequences.forEach(function(e){return e.tracks.forEach(function(e){return e.scheduleTrackPatternChangeIfAny(t.trackStep,!0)})})}},{key:"loadNewSequence",value:function(){this.playSequence=this.getPlaySequence()}},{key:"sleep",value:function(){var e=Object(R.a)(N.a.mark(function e(t){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){setTimeout(function(){return e(t)},t)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPlaySequence",value:function(){var e=this,t=Array(16).fill(1).map(function(e,t){return t}),n=new x.a.Sequence(function(t,n){e.lastTrackStep===e.trackStep&&(e.trackStep+=1);e.automationStep;for(var r in e.automationStep=e.getLoopedStep(e.trackStep),n=e.trackStep,e.scheduleParameterAutomations(n,t),e.subSequences){var a=e.subSequences[r];e.scheduleTracks(a.tracks,n,t)}n%=e.length,e.nextTimeScheduled=t,e.nextStepScheduled=n;var i=e.getLoopedStep(e.trackStep+1),s=e.trackStep;e.lastTrackStep=e.trackStep,e.trackStep=i,e.previousStepTime=e.latestStepTime,e.latestStepTime=t;new x.a.Time(e.latestStepTime);var o=e.currentStep;e.currentStep=n,e.previousStep=o,x.a.Draw.schedule(function(){e.playing&&(e.lastTrackStepReal=s,e.previousStepReal=e.trackStepReal,e.previousStepTimeReal=e.currentStepTime,e.trackStepReal=s,e.currentStepTime=t,e.store.dispatch(Object(O.V)(e.getSequenceId(),n,e.trackStep)))},t)},t,"32n");return n.loop=!0,n}},{key:"getLoopedStep",value:function(e){if(this.isLooping&&this.state.mix.isPlayingMix){var t=(e-this.loopStart)%(this.loopEnd-this.loopStart);return e=this.loopStart+t}return e}},{key:"handleLatency",value:function(e){if(void 0===this.latency&&!this.clockSync.initiator){this.timeToCompare=this.timeToCompare-(new Date).getTime(),this.latency=this.timeToCompare-this.getMilliseconds(e),this.latency+=tP.toMilliseconds();var t=(new Date).getTime()-this.playTimestamp;this.latency-=t/2}return this.latency&&(e+=this.latency/1e3),e+=this.state.sequencer.latency/1e3}},{key:"handleMixSessionStep",value:function(e){var t=this;if(this.state.mix.isPlayingMix){for(var n in this.isLooping&&this.trackStep===this.loopStart&&this.restartAllMixes(!0),this.subSequences){var r=this.subSequences[n],a=this.subSequences[n].mix.getValue(de,this.automationStep);void 0!==a&&a!==this.getCurrentPattern(r)&&this.switchToPattern(a,!0,r)}var i=this.isSequenceRollingAtStep(this.automationStep);void 0!==i&&i!==this.isSequenceRolling&&this.setSequenceRolling(i,void 0,!0);try{this.mixes.forEach(function(n){return n.scheduleNext(t.trackStep,e)})}catch(s){console.log("caught err while scheduling automation = "),console.log(s)}}}},{key:"scheduleParametersToRecord",value:function(e){if(this.isRecording){var t=this.state.tracks.parametersToRecord,n=function(n){var r=t[n];if(t[n].context.track){var a=r.context.track,i=a.pattern,s=e%a.length,o=i.stepBuckets[s];for(var c in o.steps){var u=o.steps[c];if(u.on)u.parameters.filter(function(e){return e.name===r.name}).forEach(function(e){return e.set(r.get())})}}};for(var r in t)n(r)}}},{key:"scheduleTracks",value:function(e,t,n){if(void 0!==e){for(var r={},a=0;a<e.length;a++)try{r[e[a].trackNumber]=this.scheduleTrack(e[a],t,n)}catch(i){console.log("caught error while scheduling track err = "),console.log(i)}nk(0,e,r,t),e.forEach(function(e){return e.onStepEnded(n,t)})}}},{key:"scheduleTrack",value:function(e,t,n){e.subSequence.isTrack&&e.scheduleTrackPatternChangeIfAny(t);var r=void 0===e.pattern.startStep?0:e.pattern.startStep,a=e.subSequence.isTrack?t-r:t%e.pattern.length();e.isEnabled;try{e.pattern.mix.scheduleNext(a,n,this)}catch(o){console.log("caught an error while scheduling pattern events = "),console.log(o)}if(this.deleting&&e.deleteAtStep(a),0==a&&(this.scheduleAnyTrackRecording(e,n),this.scheduleAnyTrackResampling(e,n),this.scheduleAnyAudioTrackPlaying(e,n),this.scheduleAnyFrozenTrackPlaying(e,n)),e.isFrozen)return[];if(this.scheduleSequenceRollingIfNeeded(e,a,n)){var i=e.getFactoredResolution().getNumberOfStepsAtBaseResolution(),s=e.patternRollStepNumber+a%i;return s%=e.pattern.stepBuckets.length,this.getTrackTriggers(e,n,s,e.pattern,a)}return this.getTrackTriggers(e,n,a,e.pattern,a)}},{key:"scheduleAnyTrackRecording",value:function(e,t){this.store.getState();this.tracksToRecord[e.trackNumber]?(e.startRecording(t),this.store.dispatch(Object(O.ke)(e.trackNumber,!0)),this.tracksRecording[e.trackNumber]=!0,delete this.tracksToRecord[e.trackNumber]):this.tracksRecording[e.trackNumber]&&(e.stopRecording(t),this.store.dispatch(Object(O.ke)(e.trackNumber,!1)),delete this.tracksRecording[e.trackNumber])}},{key:"scheduleAnyMasterResampling",value:function(e){var t=this.store.getState();void 0!==this.resampler&&(this.resampler.resamplingDurationElapsed++,this.resampler.resamplingDurationElapsed==t.tracks.resampleDuration&&(this.resampler.stop(e),this.resampler=void 0)),t.sequencer.resampleMaster&&(this.store.dispatch(Object(O.rc)(!1)),this.resampler=this.masterResampler,this.resampler.start(e))}},{key:"scheduleAnyTrackResampling",value:function(e,t){var n=this.store.getState();if(e.subSequence===this.currentSubSequence){void 0!==e.resampler&&(e.resampler.resamplingDurationElapsed++,e.resampler.resamplingDurationElapsed==n.tracks.resampleDuration&&(e.resampler.stop(t),e.resampler=void 0));var r=n.tracks.tracksToResample,a=r.indexOf(e.trackNumber);a>-1&&(r.splice(a,1),this.store.dispatch(Object(O.Yd)(r)),e.resampler=e.masterResampler,e.resampler.start(t)),n.tracks.trackToFreeze&&n.tracks.trackToFreeze.trackNumber===e.trackNumber&&n.tracks.trackToFreeze.subSequenceId===e.subSequence.id&&(e.resampler=e.masterResampler,e.resampler.start(t,e,!0),this.store.dispatch(Object(O.Ud)(void 0)))}}},{key:"scheduleAnyFrozenTrackPlaying",value:function(e,t){if(e.isFrozen&&e.isFrozenPlaying){var n=new Ge;n.loadDefaults(),n.attack=10,n.release=eP.toMilliseconds()/4,e.triggerFrozenSample(n,t)}}},{key:"scheduleAnyAudioTrackPlaying",value:function(e,t){if("MIDI"===e.getTrackType()&&Object.keys(e.samplers).length>0){var n=new Ge;n.loadDefaults(),n.attack=80,n.release=eP.toMilliseconds()/4,e.triggerSamples(n,t)}}},{key:"scheduleSequenceRollingIfNeeded",value:function(e,t,n){this.store.getState();return this.schedulePatternBufferClear?(e.patternRollStepNumber=void 0,this.schedulePatternBufferClear=!1,!1):!(!this.isSequenceRolling||!e.rolling)&&(e.updatePatternRollStepNumber(this.rollingResolution),!0)}},{key:"getTrackTriggers",value:function(e,t,n,r,a){n=this.getStepNumber(n,a);var i=r.getBucket(n);e.onNewStep(n);var s=i?i.steps:[];for(var o in s){var c=s[o],u=new x.a.Time(t)+tP*o;c.triggerAutomations(u,e);var l=c.getPolyphony();for(var p in l){var h=l[p];h.on&&e.midiEffects.input(h,u,a)}}var f=e.midiEffects.output(t,n,a);return this.shouldPlayStep(a)?f:[]}},{key:"shouldPlayStep",value:function(e){return e%=32,e=Math.floor(e/2),this.state.steps.masterStepToggles[e]}},{key:"scheduleTrackRolling",value:function(e,t,n){var r=this;e.subSequence.isTrack||(t%=e.length);var a=this.getMilliseconds(n),i=e.getFactoredResolution();setTimeout(function(){var a=r.rollingManager.getTriggers(t,i,e);a.filter(function(t){return t.trackSlice.trackNumber===e.trackNumber}).length>0&&(e.onNewStep(),a.forEach(function(a){if(void 0!==(e=r.tracks[a.trackSlice.trackNumber])){var s=new Ge;s.slice=a.trackSlice.sliceNumber,s.transpose=void 0===a.trackSlice.transpose?e.trackData.transpose:a.trackSlice.transpose+e.trackData.transpose,s=e.getStepDataForStep(s);var o=new x.a.Time(n)+a.time;e.midiEffects.input(s,o,t),(r.isRecording||e.subSequence.isTrack&&r.isRecordingMix)&&e.recordHit(a.step,i,s.slice,null,s.transpose)}}),a=e.midiEffects.output(n,t),nk(0,[e],{0:a}),e.onStepEnded(n,t))},a-20)}},{key:"scheduleSamplesRolling",value:function(e,t){var n=this;this.tracks.filter(function(e){return e.rolling}).forEach(function(r){return n.scheduleTrackRolling(r,e,t)})}},{key:"missedNextScheduledStep",value:function(){return x.a.Master.context.currentTime<=this.nextTimeScheduled}},{key:"scheduleNext",value:function(e,t,n){var r=this,a=this.tracks[e];if(a.getTrackType()!==zr.b){var i=this.rollingManager.getTriggerTimes(this.nextStepScheduled,this.resolution,a),s=a.getFactoredResolution();i.forEach(function(e){var i=new Ge;i.slice=t,i.transpose=void 0===n?a.trackData.transpose:n+a.trackData.transpose,i=a.getStepDataForStep(i),a.trigger(i,r.nextTimeScheduled+e.time),r.isRecording&&(a.recordHit(e.step,s,t,i.duration,i.transpose),a.updateSteps())})}}},{key:"getCurrentStepTime",value:function(){var e=this.getMilliseconds(this.latestStepTime),t=new x.a.Time(x.a.Master.context.currentTime).toMilliseconds()-new x.a.Time(this.previousStepTime).toMilliseconds();return t<0||e>0&&e>t?this.previousStepTime:this.latestStepTime}},{key:"getCurrentStep",value:function(e,t){Math.abs(new x.a.Time(x.a.Master.context.currentTime)-new x.a.Time(this.latestAbsoluteTime)),Math.abs(new x.a.Time(x.a.Master.context.currentTime)-new x.a.Time(this.previousAbsoluteTime));var n=void 0;n=t?t.subSequence.isTrack?1e6:t.pattern.length():this.length;var r=this.lastTrackStep%n;return e=e||$o.baseResolution,Math.floor(r/($o.baseResolution.numSteps()/e.numSteps()))}},{key:"getMilliseconds",value:function(e){return new x.a.Time(e).toMilliseconds()-new x.a.Time(x.a.Master.context.currentTime).toMilliseconds()}},{key:"recordTrack",value:function(e){this.tracksToRecord[e]=!0}},{key:"isTrackRecording",value:function(e){return this.tracksRecording[e]}},{key:"doubleTrackLength",value:function(e){this.tracks[e].doubleTrackLength(),this.transport.loopStart="0:0:0",this.transport.loopEnd=this.length/32+":0:0"}},{key:"halfTrackLength",value:function(e){this.tracks[e].halfTrackLength(),this.transport.loopStart="0:0:0",this.transport.loopEnd=this.length/32+":0:0"}},{key:"setSequenceRolling",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.rollingResolution,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.state.midi.midiMapMode===cu&&this.store.dispatch(Object(O.n)(new ZS(this))),e?e!=this.isSequenceRolling&&function(){var e=n.getNumberOfStepsAtBaseResolution(),a=t.automationStep;for(var i in a-=a%e,t.subSequences)t.subSequences[i].tracks.forEach(function(e){return e.initPatternBuffer(a)});r&&(t.trackRolling=!0)}():this.schedulePatternBufferClear=!0,this.isSequenceRolling=e,!r)if(this.store.getState().mix.isRecordingMix){var a=this.resolution;this.mix.addEvent(new fe(e,a))}else this.store.getState().mix.isPlayingMix&&this.mix.holdEvent(new fe(e,this.resolution))}},{key:"isSequenceRollingAtStep",value:function(e){if(this.store.getState().mix.isPlayingMix){var t=this.mix.getValue(Se,e);return this.mix.getValue(Se,e-1)&&!t&&(this.trackRolling=!1),t}return this.isSequenceRolling}},{key:"onNewBpm",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t&&t<500&&t>=1){for(n in this.transport.bpm.value=t,this.store.dispatch(Object(O.L)(t)),this.subSequences)this.subSequences[n].lfosTrack.onBPMUpdated();this.tracks.forEach(function(e){return e.onBPMUpdated()}),this.clockSync&&this.clockSync.onBPMChanged(t)}case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateBpm",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r,a=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.length>1&&void 0!==a[1]&&a[1],this.bpm=t,!n){for(r in this.subSequences)this.subSequences[r].lfosTrack.onBPMUpdated();this.tracks.forEach(function(e){return e.onBPMUpdated()})}case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onNewSwing",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=(t-50)/50,this.transport.swing=n;case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateSwing",value:function(e){this.swing=e}},{key:"recording",value:function(e){this.store.dispatch(Object(O.Eb)(e)),this.isRecording=e,this.tracks.filter(function(e){return"MIDI"===e.getTrackType()}).map(function(t){return t.recording(e)})}},{key:"connectToKeyboardEngine",value:function(e){var t=this;this.keyboardEngine=e,this.keyboardHelper=new KS(this,e),this.midi=new Kb(e,this.keyboardHelper,function(e){return t.updateBpm(e)}),this.midi.setStartCallback(function(){return t.play()}),this.midi.setStopCallback(function(){return t.stop()})}},{key:"hasMultipleSequencerEnginesPlaying",value:function(){var e=this.store.getState().sequencer.isPlaying;return Object.keys(e).filter(function(t){return e[t]}).length>1}},{key:"hasAtleastOneSequencerEnginePlaying",value:function(){var e=this.store.getState().sequencer.isPlaying;return Object.keys(e).filter(function(t){return e[t]}).length>0}},{key:"getStepNumber",value:function(e,t){return this.stepNumberScript?this.stepNumberScript(e):e}},{key:"rolling",get:function(){return this.store.getState().sequencer.trackRolling}},{key:"startStep",get:function(){var e=this.state.sequencer.viewMode;return void 0===this.state.arrangement.cursorStep||"SEQUENCER_VIEW"===e&&!this.isLooping?0:this.state.arrangement.cursorStep}},{key:"isLooping",get:function(){return this.state.arrangement.looping}},{key:"looping",set:function(e){this.store.dispatch(Object(O.z)(e))}},{key:"loopStart",get:function(){return this.state.arrangement.selection.start}},{key:"loopEnd",get:function(){return this.state.arrangement.selection.end}},{key:"trackRolling",set:function(e){this.state.midi.midiMapMode===cu&&this.store.dispatch(Object(O.n)(new XS(this))),this.store.dispatch(Object(O.Qd)(e)),this.rollingManager.clear()}},{key:"isRecordingMix",get:function(){return this.store.getState().mix.isRecordingMix}},{key:"sequenceRolling",set:function(e){this.setSequenceRolling(e)}},{key:"lfos",get:function(){return this.lfosTrack.lfos}},{key:"envelopesTrack",get:function(){return this.currentSubSequence.envelopesTrack}},{key:"lfosTrack",get:function(){return this.currentSubSequence.lfosTrack}},{key:"envelopes",get:function(){return this.envelopesTrack.envelopes.map(function(e){return e.envelope})}},{key:"bpm",get:function(){return this.bpmParameter.get()},set:function(e){this.bpmParameter.set(e)}},{key:"swing",get:function(){return this.swingParameter.get()},set:function(e){this.swingParameter.set(e)}},{key:"state",get:function(){return this.store.getState()}},{key:"isLoading",get:function(){var e=this.state.sequencer.loadingSequence;return Object.keys(e).some(function(t){return!0===e[t]})}}]),n}(function(e){return function(e){Object(u.a)(n,e);var t=_S(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"scheduleParameterAutomations",value:function(e,t){this.multiSequencerEngine&&(e=this.multiSequencerEngine.trackStep);var n=this.state.automation.automationSchedulers[this.sequenceId]||[],r={};for(var a in n){var i=n[a],s=i.parameter,o=s.track,c=this.length;if(void 0!==o&&(o.instrumentRack&&(o=o.instrumentRack),c=o.length),e%c===0&&i.schedule(e,t),s.onNewStep(e),s.context.macro){var u=s.context.macro.subMacros;for(var l in u){var p=u[l].parameter;p.onNewStep(e),r[p.id]=p.getAtStep(e)}}this.trackStep%2===0&&(r[s.id]=s.getAtStep(e))}this.trackStep%2===0&&this.store.dispatch(Object(O.hb)(r))}}]),n}(e)}(JS)),rP=n(300),aP=n(172),iP=n(301),sP=(n(530),"PUBLIC"),oP="GUILD";function cP(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var uP=d.a.presets;function lP(e){var t=e.toString().indexOf("t");return t>0?new Xe(parseInt(e.slice(0,t)),!0):new Xe(parseInt(e),!1)}function pP(e){return!isNaN(parseFloat(e))&&isFinite(e)}var hP=function(e){Object(u.a)(n,e);var t=cP(n);function n(e,r,a,i){var s;return Object(o.a)(this,n),(s=t.call(this,e,r,a,i)).recordingsToSave=[],s.loadedSequenceId=void 0,s.samplesToSync=[],s.loadedSamples={},s.editHistory=[],s}return Object(c.a)(n,[{key:"save",value:function(e,t){var n=this,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3?arguments[3]:void 0,i=void 0!==a&&t!=sP?a.guildId:0;return new Promise(function(){var s=Object(R.a)(N.a.mark(function s(o,c){var u,l;return N.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,n.saveAnyNewRecordings(i,r);case 2:u=sr(u={hasPatterns:!0,subSequences:n.getSubSequences(),sendVolumes:n.getSendVolumesToSave(),bpm:n.bpm,swing:n.swing,resolution:$o.baseResolution.toString(),tracksParameters:n.getTracksParametersToSave(),gateMode:n.gateMode,tracksPatterns:n.getTracksPatternsToSave(),scripting:n.scripting.getJson(),parameterLocks:n.parameterLocks.map(function(e){return e.getJson()}),mix:n.mix.getJson(),sends:n.sends.getJson(),patternColors:n.store.getState().toolbar.patternColors,lfos:n.lfos.map(function(e){return e.getJson()}),envelopes:n.envelopes.map(function(e){return e.getJson()}),lfoPatternLocks:n.store.getState().tracks.lfoPatternLocks,envelopePatternLocks:n.store.getState().tracks.envelopePatternLocks,patternLocks:n.store.getState().sequencer.patternLocks,trackPatternLocks:n.store.getState().tracks.trackPatternLocks},"bpmParameter",n.bpmParameter),u=sr(u,"swingParameter",n.swingParameter),l=new rP.a(!0),"PRIVATE"===t?d.a.crypto.encryptAndSave(e,u,n.loadedSequenceId,r).then(function(e){n.update(e),o(e)}):t===oP?d.a.guildSequences.newGuildSequence(u,e,n.loadedSequenceId,a.guildId).then(function(e){n.update(e),o(e)}):t===sP&&l.save(e,u,n.loadedSequenceId,n.getSamples(),r).then(function(e){n.update(e.ipfsHash),n.loadedSequenceId=e.ipfsHash,o(e.ipfsHash)});case 8:case"end":return s.stop()}},s)}));return function(e,t){return s.apply(this,arguments)}}())}},{key:"getTrackMidiEffectsToSave",value:function(){var e=[];for(var t in this.tracks)e.push(this.tracks[t].midiEffects.getJson());return e}},{key:"getTrackLiveEffectsToSave",value:function(){var e=[];for(var t in this.tracks)e.push(this.tracks[t].liveEffects.getJson());return e}},{key:"getTrackEffectsToSave",value:function(){var e=[];for(var t in this.tracks){for(var n=[],r=this.tracks[t].effects,a=0;a<r.length;a++)n.push(r[a].getJson());e.push(n)}return e}},{key:"getTrackEffectsChainsToSave",value:function(){var e=[];for(var t in this.tracks)e.push(this.tracks[t].effectsChains.map(function(e){return e.getJson()}));return e}},{key:"getSubSequences",value:function(){var e=[];for(var t in this.subSequences){this.switchToSubSequence(this.subSequences[t].id);for(var n=[],r=[],a=0;a<this.subSequences[t].tracks.length;a++){var i=[],s=this.subSequences[t].tracks[a];r.push(s.getJson());for(var o=0;o<this.numberOfPatterns();o++){var c=s.patterns[o];if(void 0!==c){for(var u={},l=0;l<c.stepBuckets.length;l++){var p=c.getBucket(l);if(p.anyEffectAutomation()||p.anyOn())for(var h in p.steps)u[l]=p.getJson()}u.size=c.length(),u.buckets=!0,i.push(u)}}n.push(i)}var f=this.subSequences[t].groups.getJson(),d=this.subSequences[t].lfosTrack.lfos.map(function(e){return e.getJson()}),m=this.subSequences[t].envelopesTrack.envelopes.map(function(e){return e.getJson()});e.push(Object(D.a)({},this.subSequences[t].getJson(),{tracks:n,tracksData:r,lfos:d,envelopes:m,groups:f,tracksPatterns:this.getTracksPatternsToSave(),tracksEffectsChains:this.getTrackEffectsChainsToSave(),tracksMidiEffects:this.getTrackMidiEffectsToSave(),tracksLiveEffects:this.getTrackLiveEffectsToSave(),tracksParameters:this.getTracksParametersToSave(),sendVolumes:this.getSendVolumesToSave(),mix:this.subSequences[t].mix.getJson(),id:this.subSequences[t].id}))}return e}},{key:"getSendVolumesToSave",value:function(){return this.tracks.map(function(e){return e.getSendNodes().map(function(e){return e.volume.value})})}},{key:"getTracksPatternsToSave",value:function(){return this.tracks.map(function(e){return e.patterns.map(function(e){return e.getJson()})})}},{key:"getTracksParametersToSave",value:function(){return this.tracks.map(function(e){return e.trackData.getJson()})}},{key:"loadSubSequences",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r,a,i,s,o,c=this;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=[],0===this.tracks.length&&this.subSequences.length<=1&&(this.subSequences.forEach(function(e){return e.dispose()}),this.subSequences=[]),r=N.a.mark(function e(r){var a,u,l,p,h,f,d,m,v,g,y,b,k,E;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=t.subSequences[r],u=a.id,l=c.newSubSequence(u),p=[],h=25,e.t0=N.a.keys(a.tracks);case 6:if((e.t1=e.t0()).done){e.next=23;break}for(f=e.t1.value,c.loadingProgress=h+parseFloat(f)/a.tracks.length*25,d=a.tracks[f],m=-16,v=d.length,i=0;i<d.length;i++)[],s=d[i],(o=s.size)>m&&(m=o);return"type"in a.tracksData[f]&&"MIDI"===a.tracksData[f].type,g=a.tracksData[f].type,y=void 0,g===zr.d?y=new Lk(f,c,c.mixSession,v,function(){return c.update()},c.sends):g===zr.e?y=new Zb(f,c,c.mixSession,v,function(){return c.update()},l):g===zr.a?(y=new JE(f,c,c.mixSession,v,function(){return c.update()},l)).fromJson(a.tracksData[f]):g!==zr.b&&g!==zr.c||(b=a.tracksData[f].instrumentType,y=NE(c,g,b)),y.setSends(c.sends),e.next=20,y.fromJson(a.tracksData[f]);case 20:p.push(y),e.next=6;break;case 23:for(k in a.tracksData)"chokes"in(E=a.tracksData[k])&&p[k].chokes.fromJson(E.chokes,p);p.forEach(function(e){return l.addTrack(e)}),l.fromJson(a),n.push(l);case 27:case"end":return e.stop()}},e)}),e.t0=N.a.keys(t.subSequences);case 4:if((e.t1=e.t0()).done){e.next=9;break}return a=e.t1.value,e.delegateYield(r(a),"t2",7);case 7:e.next=4;break;case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllRecordingsToSave",value:function(){var e=this.recordingsToSave.filter(function(e){return void 0!==e.audioBuffer});for(var t in this.subSequences){var n=this.subSequences[t];for(var r in n.tracks)e=[].concat(Object(M.a)(e),Object(M.a)(n.tracks[r].frozenSamplesToSave))}return[].concat(Object(M.a)(e),Object(M.a)(this.samplesToSync))}},{key:"saveAnyNewRecordings",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r,a,i,s,o,c,u,l,p,h,f,m,v,g,y,b,k,E,O,S,P,w,j,T,x,C,R,D,q=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r in q.length>1&&void 0!==q[1]&&q[1],n=this.recordingsToSave.filter(function(e){return void 0!==e.audioBuffer}),this.subSequences)for(i in(a=this.subSequences[r]).tracks)n=[].concat(Object(M.a)(n),Object(M.a)(a.tracks[i].frozenSamplesToSave));s=new aP.a,o=[],e.t0=N.a.keys(n);case 6:if((e.t1=e.t0()).done){e.next=33;break}for(c=e.t1.value,u=n[c],l=u.name,p=["","","",""],h=u.videoId||"",f=u.getTagsToSave(),m=(new Date).getFullYear(),f.length>4&&(f=f.slice(0,4)),v=f.length;v<4;v++)f.push("");if(g="",y=u.getId(),0===t){e.next=27;break}return e.next=21,Gt.a.getSound(y);case 21:return b=e.sent,e.next=24,this.encryptedIpfs.addSound(b,oP,t,s);case 24:k=e.sent,this.replaceWithEncryptedSample(y,k),y=k;case 27:if(!u.isResampled){e.next=30;break}return d.a.resample.newResample(y,l,f,u.samplesUsed,t),e.abrupt("continue",6);case 30:o.push({ipfsHash:y,title:l,videoId:h,tags:f,styles:p,country:g,year:m,coverArt:void 0,discogsId:void 0}),e.next=6;break;case 33:e.t2=N.a.keys(this.samplesToSync);case 34:if((e.t3=e.t2()).done){e.next=57;break}for(E=e.t3.value,O=this.samplesToSync[E],S=O.name,P=["","","",""],w=O.videoId||"",(j=O.tags).length>4&&(j.reverse(),j=j.slice(0,4)),T=j.length;T<4;T++)j.push("");if(x=O.year||2020,C=O.country||"",R=O.getId(),0===t){e.next=54;break}return e.next=49,Gt.a.getSound(R);case 49:return D=e.sent,e.next=52,this.encryptedIpfs.addSound(D,oP,t,s);case 52:R=e.sent,this.replaceWithEncryptedSample(R);case 54:o.push({ipfsHash:R,title:S,videoId:w,tags:j,styles:P,country:C,year:x,coverArt:O.coverArtHash,discogsId:O.discogsId}),e.next=34;break;case 57:if(0!==o.length){e.next=59;break}return e.abrupt("return");case 59:0!==t?d.a.newEncryptedSamples(o,t,s):d.a.newSamplesWithMetadata(o,0);case 60:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadTrackPatternLocks",value:function(e){var t=Object(D.a)({},e.trackPatternLocks);e.tracks&&((t={})[this.currentSubSequence.id]=e.trackPatternLocks),t=Object(D.a)({},this.state.tracks.trackPatternLocks,t),this.store.dispatch(Object(O.s)(t))}},{key:"loadTrackMidiEffects",value:function(e,t,n){return void 0!==e.tracksMidiEffects?(n[t].midiEffects.fromJson(e.tracksMidiEffects[t]),n[t].midiEffects.effects):[]}},{key:"loadTrackEffects",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n,r){var a,i,s,o,c,u,l,p,h,f,d;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],i=r[n].effectsChains[0],void 0===t.tracksEffects){e.next=16;break}s=0;case 4:if(!(s<t.tracksEffects[n].length)){e.next=13;break}return e.t0=a,e.next=8,Sa(t.tracksEffects[n][s],r,this,n);case 8:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 10:s++,e.next=4;break;case 13:i.updateEffects(a),e.next=46;break;case 16:if(void 0===t.tracksEffectsChains){e.next=44;break}o=r[n],c=t.tracksEffectsChains[n],u=[],e.t2=N.a.keys(c);case 21:if((e.t3=e.t2()).done){e.next=40;break}l=e.t3.value,p=new wa(o.gainNode,o.trackNode,(new Wr).forTrack(o),this),h=c[l],e.t4=N.a.keys(h);case 26:if((e.t5=e.t4()).done){e.next=36;break}return f=e.t5.value,d=h[f],e.t6=p,e.next=32,Sa(d,r,this,n);case 32:e.t7=e.sent,e.t6.addEffect.call(e.t6,e.t7),e.next=26;break;case 36:p.updateEffects(),u.push(p),e.next=21;break;case 40:o.effectsChains.forEach(function(e){return e.dispose()}),o.effectsChains=u,e.next=46;break;case 44:a=[],i.updateEffects(a);case 46:return e.abrupt("return",a);case 47:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"loadSubSequenceMix",value:function(e,t){console.log("load sub sequence mix called with json",e.mix),t.mix.loadFromJson(e.mix,this)}},{key:"sleep",value:function(e){return new Promise(function(){var t=Object(R.a)(N.a.mark(function t(n,r){return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:setTimeout(function(){return n()},e);case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getSleepTime",value:function(){return this.state.mix.isPlayingMix?100:0}},{key:"loadSubSequencePatterns",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n,r){var a,i,s,o,c,u,l,p,h,f,d,m,v,g,y,b,k,E,O,S,P,w,j,T,x,C,R,D,q,M=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:!(M.length>3&&void 0!==M[3])||M[3],(new Date).getTime(),a=n.tracks,i=0;case 4:if(!(i<t.tracks.length)){e.next=75;break}return s=a[i],o=-16,c=[],u=t.tracks[i],l=(new Date).getTime(),e.next=12,this.loadTrackEffects(t,i,a);case 12:return p=e.sent,h=this.loadTrackMidiEffects(t,i,a),f=(new Date).getTime(),f-l,e.next=18,this.sleep(this.getSleepTime());case 18:d=0;case 19:if(!(d<u.length)){e.next=50;break}m=[],v=u[d],(g="size"in v?v.size:r.numSteps())>o&&(o=g),y=(new Date).getTime(),b="buckets"in v,k=new Do(this,s),E=(new Date).getTime(),E-y,k.changeLength(g,!1),O=0;case 31:if(!(O<g)){e.next=43;break}if(O in v){e.next=36;break}return S=k.stepBuckets[O],m.push(S),e.abrupt("continue",40);case 36:if(P=k.stepBuckets[O],w=v[O],b)for(T in w)(x=P.steps[T]||new Ge).track=s,x.stepNumber=O,x.simpleLoad(w[T],p,s,h),P.steps[T]=x;else(j=P.steps[0]).track=s,j.stepNumber=O,j.simpleLoad(v[O],p,s,h),P.steps[0]=j;m.push(P);case 40:O++,e.next=31;break;case 43:k.loadStepBuckets(void 0,!0),c.push(k),C=(new Date).getTime(),C-y;case 47:d++,e.next=19;break;case 50:return R="type"in t.tracksData[i]&&"MIDI"===t.tracksData[i].type,void 0,void 0,R&&(s.setMidiEngine(this.midi),s.setSequencerEngine(this)),s.patterns=c,s.pattern.muted=t.tracksData[i].muted,s.gated=t.tracksData[i].gated,e.next=59,this.sleep(this.getSleepTime());case 59:if(D=(new Date).getTime(),R){e.next=66;break}return e.next=63,this.loadSamplersIntoTrack(s,t.tracksData[i],i,n);case 63:e.sent,e.next=69;break;case 66:return e.next=68,this.loadSamplersIntoTrack(s,t.tracksData[i],i,n);case 68:e.sent;case 69:s.setupEffects(),q=(new Date).getTime(),q-D;case 72:i++,e.next=4;break;case 75:(new Date).getTime();case 76:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"loadSubSequenceTracksParameters",value:function(e,t){for(var n in e.tracksParameters){var r=e.tracksParameters[n];t[n].trackData.loadFromJson(r,void 0,!1,!1,this),t[n].pattern.calculateFills(r)}}},{key:"loadSubSequencePatternParameters",value:function(e,t){for(var n in t)for(var r=t[n],a=0;a<r.patterns.length;a++)r.patterns.length>a&&r.patterns[a].loadFromJson(e.tracksPatterns[n][a])}},{key:"loadSubSequenceEffects",value:function(e,t){for(var n in t){var r=t[n];this.setupNewTrack(r,!0,!0);for(var a=r.getSendNodes(),i=0;i<e.sendVolumes[n].length;i++)a[i].volume.value=e.sendVolumes[n][i];void 0!==e.tracksLiveEffects&&r.liveEffects.fromJson(e.tracksLiveEffects[n])}}},{key:"getMaxSubSequenceId",value:function(){var e=-1;for(var t in this.subSequences){var n=this.subSequences[t].id;n>e&&(e=n)}return e}},{key:"loadSubSequenceLFOs",value:function(e,t){for(var n in e.lfos){var r=e.lfos[n];t.lfos[parseInt(n)].lfo.fromJson(r)}}},{key:"loadSubSequenceEnvelopes",value:function(e,t){for(var n in e.envelopes){var r=e.envelopes[n];t.envelopes[parseInt(n)].fromJson(r)}}},{key:"normalizeSubSequenceIds",value:function(e){var t=this.getMaxSubSequenceId();t++;var n={};for(var r in e.subSequences){var a=e.subSequences[r].id;n[a]=a+t}this.convertSubSequenceIds(e,n)}},{key:"convertSubSequenceIds",value:function(e,t){for(var n in e.subSequences){var r=e.subSequences[n];void 0!==t[r.id]&&(r.id=t[r.id]),e.subSequences[n]=r}var a={},i={},s={},o=new Set(Object.values(t));for(var c in e.trackPatternLocks){if(void 0!==t[c=parseInt(c)])a[t[c]]=e.trackPatternLocks[c];else o.has(c)||(a[c]=e.trackPatternLocks[c])}for(var u in e.envelopePatternLocks){if(void 0!==t[u])s[t[u]]=e.envelopePatternLocks[u];else o.has(u)||(s[u]=e.envelopePatternLocks[u])}for(var l in e.lfoPatternLocks){if(void 0!==t[l])i[t[l]]=e.lfoPatternLocks[l];else o.has(l)||(i[l]=e.lfoPatternLocks[l])}e.trackPatternLocks=a,e.lfoPatternLocks=i,e.envelopePatternLocks=s}},{key:"loadSequence",value:function(e){var t=this;return console.log("loadSequence("+e+")"),new Promise(function(){var n=Object(R.a)(N.a.mark(function n(r,a){var i,s,o,c,u,l;return N.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t.loadingProgress=0,n.next=3,gn.a.getAccount();case 3:if(i=n.sent,s=void 0,n.prev=5,void 0===i){n.next=28;break}return n.next=9,d.a.guildSequences.getGuildSequence(e);case 9:if(void 0!==(o=n.sent)){n.next=15;break}return n.next=13,d.a.encryption.getSequencesSharedWithUser(e);case 13:o=(o=n.sent)[0];case 15:if(void 0===o){n.next=21;break}return n.next=18,d.a.crypto.fetchAndDecrypt(e,o);case 18:s=n.sent,n.next=28;break;case 21:return n.next=23,d.a.encryption.getEncryptedSequenceIfAny(e);case 23:if(void 0===(c=n.sent)){n.next=28;break}return n.next=27,d.a.crypto.fetchAndDecrypt(e,c);case 27:s=n.sent;case 28:n.next=32;break;case 30:n.prev=30,n.t0=n.catch(5);case 32:u=!1,0==t.tracks.length&&(u=!0),(l=new rP.a(!pP(e),pP(e)?e:void 0,pP(e)?void 0:e,s)).loadTitle().then(function(e){t.store.dispatch(Object(O.Pc)(e))}),l.load().then(function(){var n=Object(R.a)(N.a.mark(function n(a){var i,s,o,c,l,p,h,f,d,m,v,g,y,b,k,E,S,P,w,j,T,x,C,R,q,M,A,I,L;return N.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("sequence data"),console.log(Object(D.a)({},a)),i=Object(iP.a)(a),n.next=5,Object(iP.b)(i,t.encryptedIpfs,t.getSleepTime());case 5:if(t.loadedSamples=n.sent,t.loadingProgress=25,t.normalizeSubSequenceIds(a),t.length,s=$o.oldDefaultResolution,a.groups,t.hasAtleastOneSequencerEnginePlaying()||(t.updateBpm(a.bpm),or(a,"bpmParameter",t.bpmParameter)),void 0===a.subSequences){for(c in a.subSequences=[{id:0,tracks:a.tracks,tracksData:a.tracksData,groups:a.groups,envelopes:a.envelopes,lfos:a.lfos,tracksParameters:a.tracksParameters,tracksPatterns:a.tracksPatterns,tracksEffects:a.tracksEffects,tracksMidiEffects:a.tracksMidiEffects,tracksLiveEffects:a.tracksLiveEffects,sendVolumes:a.sendVolumes}],o={},a.tracksData)l=a.tracksData[c],o[c]=l.patternLocks;a.trackPatternLocks=o}return t.normalizeSubSequenceIds(a),"swing"in a&&(t.updateSwing(a.swing),or(a,"swingParameter",t.swingParameter)),s=lP(a.resolution),p=!1,"hasPatterns"in a&&(p=!0),u&&(t.playSequence=t.getPlaySequence()),n.next=21,t.loadSubSequences(a);case 21:if(h=n.sent,t.loadTrackPatternLocks(a),!("sends"in a)){n.next=26;break}return n.next=26,t.sends.loadFromJson(a.sends);case 26:t.loadingProgress=50,n.t0=N.a.keys(h);case 28:if((n.t1=n.t0()).done){n.next=58;break}return f=n.t1.value,d=(new Date).getTime(),t.switchToSubSequence(h[f].id),n.next=34,t.loadSubSequencePatterns(a.subSequences[f],h[f],s,p);case 34:t.loadingProgress=60,t.loadSubSequenceTracksParameters(a.subSequences[f],h[f].tracks),m=(new Date).getTime(),t.loadSubSequencePatternParameters(a.subSequences[f],h[f].tracks),t.loadingProgress=65,v=(new Date).getTime(),t.loadSubSequenceEffects(a.subSequences[f],h[f].tracks),t.loadingProgress=70,g=(new Date).getTime(),t.loadSubSequenceLFOs(a.subSequences[f],h[f]),y=(new Date).getTime(),t.loadSubSequenceEnvelopes(a.subSequences[f],h[f]),b=(new Date).getTime(),t.loadSubSequenceMix(a.subSequences[f],h[f]),k=(new Date).getTime(),E=m-d,S=v-m,P=g-v,w=y-g,j=b-y,T=k-b,console.log("a=%s b=%s c=%s d=%s e=%s f=%s total=%s",E,S,P,w,j,T,T-E),n.next=28;break;case 58:t.switchToSubSequence(h[0].id),"lfoPatternLocks"in a&&(x=Object(D.a)({},a.lfoPatternLocks),a.tracks&&((x={})[t.currentSubSequence.id]=a.lfoPatternLocks),x=Object(D.a)({},t.state.tracks.lfoPatternLocks,x),t.store.dispatch(Object(O.r)(x))),"envelopePatternLocks"in a&&(C=Object(D.a)({},a.envelopePatternLocks),a.tracks&&((C={})[t.currentSubSequence.id]=a.envelopePatternLocks),C=Object(D.a)({},t.state.tracks.envelopePatternLocks,C),t.store.dispatch(Object(O.q)(C))),t.gateMode=!("gateMode"in a)||a.gateMode,n.t2=N.a.keys(h);case 63:if((n.t3=n.t2()).done){n.next=70;break}return R=n.t3.value,t.switchToSubSequence(h[R].id),n.next=68,h[R].groups.fromJson(a.subSequences[R].groups,t);case 68:n.next=63;break;case 70:for(q in t.loadParameterLocks(a),h)for(A in(M=h[q]).tracks)void 0===(I=M.tracks[A]).group&&("MIDI"===I.getTrackType()?M.groups.addMidiTrack(I):void 0!==I.sample&&void 0!==I.sample.ipfsHash&&M.groups.addTrack(I));if("patternColors"in a)for(L in a.patternColors)t.store.dispatch(Object(O.dc)(parseInt(L),a.patternColors[L]));t.play(),t.play(),t.updateTracks(),t.switchToSubSequence(h[0].id),t.store.dispatch(Object(O.Vb)(t.numberOfPatterns())),void 0!==t.update&&t.update(e),t.selectTrack(0),console.log("finished loading!"),r();case 82:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}());case 37:case"end":return n.stop()}},n,null,[[5,30]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"newNumberOfPatterns",value:function(e){for(var t=this.numberOfPatterns();t<e;t++)this.newPattern(!0)}},{key:"combineWithSequencerEngine",value:function(e){for(var t in e.subSequences){var n=e.subSequences[t];if(void 0!==this.getSubSequence(n.id)){var r=-1;for(var a in this.subSequences){var i=this.subSequences[a].id;i>r&&(r=i)}n.id=r+1,this.addSubSequence(n)}}}},{key:"loadParameterLocks",value:function(e){if("parameterLocks"in e){var t=e.parameterLocks;for(var n in this.parameterLocks=[],t){var r=new Dk;r.fromJson(t[n],this),this.parameterLocks.push(r)}for(;this.parameterLocks.length<2;)this.parameterLocks.push(new Dk)}}},{key:"loadSamplersIntoTrack",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n,r,a){var i,s,o,c,u;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=void 0,void 0===n){e.next=19;break}if(t.pattern.volume=n.volume,!("samplers"in n)){e.next=17;break}e.t0=N.a.keys(n.samplers);case 5:if((e.t1=e.t0()).done){e.next=17;break}if(!pP(s=e.t1.value)){e.next=12;break}return e.next=10,t.addSound(parseInt(s),n.samplers[s]);case 10:e.next=14;break;case 12:return e.next=14,t.addSound(s,n.samplers[s]);case 14:void 0===i&&(i=n.samplers[s]),e.next=5;break;case 17:if("envelopes"in n)for(o in n.envelopes)t.connectToEnvelope(a.envelopes[n.envelopes[o]]);if("envelopeConnections"in n)for(c in n.envelopeConnections)u=n.envelopeConnections[c],t.connectToEnvelope(a.envelopes[u.envelope],u.mode);case 19:return e.abrupt("return",i);case 20:case"end":return e.stop()}},e)}));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"loadSlices",value:function(e,t){var n=[];return"samplersParameters"in e&&(Array.isArray(e.samplersParameters[t])?n=e.samplersParameters[t]:n.push({startTime:e.samplersParameters[t].startTime,endTime:e.samplersParameters[t].endTime})),n}},{key:"newRecordingToSaveLater",value:function(e){this.recordingsToSave.push(e)}},{key:"getParameterFromJson",value:function(e){var t=e.context,n=new Wr,r=void 0,a=[];if(void 0!==t.track){var i=0;void 0!==t.chainNumber&&(i=t.effectsChainNumber),a=(r=this.tracks[t.track]).effectsChains[i].effects,n=n.forTrack(r)}else if(void 0!==t.group){var s=this.groups.groups[t.group];a=s.effects,n=n.forGroup(s)}else if(void 0!==t.sends){var o=this.sends.sends[t.sends];a=o.effects,n=n.forSend(o)}var c=void 0;if(t.isInstrument)c=r.instrument.parameters;else if(void 0!==t.effect&&-1!=t.effect){c=a[t.effect].parameters}else void 0!==r&&(c=r.trackData.parameters);if(void 0!==c){var u=e.name,l=c.filter(function(e){return e.name===u});if(l.length>=1)return l[0]}}},{key:"getEffectsPreset",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r,a,i,s,o,c,u;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r={},!t.trackEffectsChains){e.next=23;break}a=[],e.t0=N.a.keys(t.trackEffectsChains);case 4:if((e.t1=e.t0()).done){e.next=22;break}i=e.t1.value,s=new wa(n.gainNode,n.trackNode,(new Wr).forTrack(n),this),o=t.trackEffectsChains[i],e.t2=N.a.keys(o);case 9:if((e.t3=e.t2()).done){e.next=19;break}return c=e.t3.value,u=o[c],e.t4=s,e.next=15,Sa(u,this.tracks,this,i);case 15:e.t5=e.sent,e.t4.addEffect.call(e.t4,e.t5),e.next=9;break;case 19:a.push(s),e.next=4;break;case 22:r.effectsChains=a;case 23:return t.midiEffects&&(r.midiEffects=new Ci(n),r.midiEffects.fromJson(t.midiEffects)),e.abrupt("return",r);case 25:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadEffectsPreset",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r,a,i=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:this.tracks[this.store.getState().cursor.track],n&&this.loadLFOsAndEnvelopes(t),e.next=4,this.getEffectsPreset(t,r);case 4:(a=e.sent).effectsChains&&(r.effectsChains=a.effectsChains),a.midiEffects&&(r.midiEffects=a.midiEffects);case 7:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"auditionPreset",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r,a,i;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("audiitonPreset"),r=t.name,e.next=4,uP.getPresetData(t);case 4:a=e.sent,(i=this.tracks[n]).fromJson(a.trackParameters),i.presetName=r,this.update();case 9:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadPreset",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r,a,i,s,o,c,u,l;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.contentHash,a=t.name,console.log("load preset preset name",t,a),void 0===r&&"string"===typeof t&&(r=t),e.next=6,uP.getPresetData(t);case 6:return i=e.sent,e.next=9,uP.getPresetInstrumentType(r);case 9:if("EFFECTS"!==e.sent){e.next=13;break}return this.loadEffectsPreset(i,n),e.abrupt("return");case 13:if(void 0!==i.tracks){e.next=17;break}return this.loadTrackPreset(i,r,n,void 0,a),console.log("finished loading preset"),e.abrupt("return");case 17:for(o in s={},i.tracks)s[o]=this.tracks.length,this.loadTrackPreset(i.tracks[o],void 0,n);if(i.keyMappings)for(c in i.keyMappings)u=i.keyMappings[c],l=s[u.trackNumber],this.keyboardEngine.map(u.key,l,u.sliceNumber);case 20:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadLFOsAndEnvelopes",value:function(e){if("lfos"in e)for(var t in e.lfos){var n=e.lfos[t];this.lfos[parseInt(t)].lfo.disconnectAllModulators(),this.lfos[parseInt(t)].lfo.fromJson(n)}if("envelopes"in e)for(var r in e.envelopes){var a=e.envelopes[r];this.envelopes[parseInt(r)].fromJson(a)}}},{key:"loadPresetAsSubSequence",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r,a,i;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.contentHash,a=t.name,void 0===r&&"string"===typeof t&&(r=t),void 0!==n){e.next=7;break}return e.next=6,uP.getPresetData(t);case 6:n=e.sent;case 7:return e.next=9,this.loadTrackPreset(n,r,!1,!1,a,1);case 9:i=e.sent,this.newSubSequence(void 0,i),this.loadLFOsAndEnvelopes(n),i.trackNumber=0,i.updateSteps();case 14:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadTrackPreset",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n,r){var a,i,s,o,c,u,l,p,h,f,d,m,v,g,y,b=this,k=arguments;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=!(k.length>3&&void 0!==k[3])||k[3],i=k.length>4?k[4]:void 0,s=k.length>5&&void 0!==k[5]?k[5]:this.numberOfPatterns(),r&&this.loadLFOsAndEnvelopes(t),console.log("loadTrackPreset",t),o=void 0,t.trackParameters.type!==zr.d){e.next=14;break}return o=new Lk(this.tracks.length,this,this.mixSession,s,function(){return b.update()},this.currentSubSequence),e.next=10,this.loadSamplersIntoTrack(o,t.trackParameters,this.tracks.length,this.currentSubSequence);case 10:o.setMidiEngine(this.midi),this.setupRecordableTrack(o),e.next=22;break;case 14:if(t.trackParameters.type!==zr.b&&t.trackParameters.type!==zr.c){e.next=19;break}c=t.trackParameters.instrumentType,o=NE(this,t.trackParameters.type,c,s),e.next=22;break;case 19:return o=new Zb(this.tracks.length,this,this.mixSession,s,function(){return b.update()},this.sends),e.next=22,this.loadSamplersIntoTrack(o,t.trackParameters,this.tracks.length,this.currentSubSequence);case 22:if(o.setSends(this.sends),o.fromJson(t.trackParameters),o.trackData.loadFromJson(t.trackData,void 0,!1,!1,this),console.log("setting preset name = "+i),!t.trackEffects){e.next=41;break}u=[],l=0;case 29:if(!(l<t.trackEffects.length)){e.next=38;break}return e.t0=u,e.next=33,Sa(t.trackEffects[l],this.tracks,this);case 33:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 35:l++,e.next=29;break;case 38:o.effectsChains[0].effects=u,e.next=65;break;case 41:if(!t.trackEffectsChains){e.next=65;break}p=[],e.t2=N.a.keys(t.trackEffectsChains);case 44:if((e.t3=e.t2()).done){e.next=63;break}h=e.t3.value,f=new wa(o.gainNode,o.trackNode,(new Wr).forTrack(o),this),d=t.trackEffectsChains[h],e.t4=N.a.keys(d);case 49:if((e.t5=e.t4()).done){e.next=59;break}return m=e.t5.value,v=d[m],e.t6=f,e.next=55,Sa(v,this.tracks,this,h);case 55:e.t7=e.sent,e.t6.addEffect.call(e.t6,e.t7),e.next=49;break;case 59:f.updateEffects(),p.push(f),e.next=44;break;case 63:o.effectsChains.forEach(function(e){return e.dispose()}),o.effectsChains=p;case 65:if(t.midiEffects&&o.midiEffects.fromJson(t.midiEffects),t.liveEffects&&o.liveEffects.fromJson(t.liveEffects),o.gated=t.trackParameters.gated,a){if(this.setupNewTrack(o,!0,!0),this.groups.addTrack(o),"sendVolumes"in t)for(g=o.getSendNodes(),y=0;y<t.sendVolumes.length;y++)g[y].volume.value=t.sendVolumes[y];this.currentSubSequence.addTrack(o),o.switchToPattern(this.currentPattern),o.updateSteps(),this.update()}return o.presetId=n,o.presetName=i,e.abrupt("return",o);case 72:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"saveProjectAsPreset",value:function(){var e=this,t=[];for(var n in this.tracks){var r=this.getTrackPreset(n);t.push(r)}var a=void 0;t.length>0&&(a=t[0].lfos);var i={lfos:a,tracks:t,keyMappings:this.keyboardEngine.keyMappings,midiMappings:this.keyboardEngine.midiMappings},s=window.prompt("Type name of preset");uP.newPreset(i,s).catch(function(e){console.log(e)}).then(function(t){e.presetId=t})}},{key:"saveTrackPreset",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n,r,a){var i,s,o,c;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.tracks[t],0!=a){e.next=4;break}return e.next=4,i.makePublicIfNeeded();case 4:s=r?this.getEffectPreset(t):this.getTrackPreset(t),o=r?"EFFECTS":i.getInstrumentType(),c=void 0,void 0===i.sample||r||(c=i.sample.getId()),uP.newPreset(s,n,c,o,a).catch(function(e){console.log(e)}).then(function(e){if(i.presetId=e,"EXTERNAL_INSTRUMENT"===o){var t=i.midiEffects.effects.filter(function(e){return"Midi Interface"===e.name})[0];if(void 0!==t){var n=t.midiOutput.name;uP.tagPreset(e,[n])}}});case 9:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"updateTrackPreset",value:function(e){var t=this.getTrackPreset(e),n=this.tracks[e];uP.updatePresetIpfsHash(n.presetId,t)}},{key:"getEffectPreset",value:function(e){var t=this.tracks[e],n=t.effectsChains.map(function(e){return e.getJson()});return{lfo:this.lfos.map(function(e){return e.getJson()}),envelopes:this.envelopes.map(function(e){return e.getJson()}),trackEffectsChains:n,midiEffects:t.midiEffects.getJson(),liveEffects:t.liveEffects.getJson()}}},{key:"getTrackPreset",value:function(e){var t=this.tracks[e],n=t.getSendNodes().map(function(e){return e.volume.value}),r=t.effectsChains.map(function(e){return e.getJson()});return{lfos:this.lfos.map(function(e){return e.getJson()}),envelopes:this.envelopes.map(function(e){return e.getJson()}),trackData:t.trackData.getJson(),trackParameters:t.getJson(),sendVolumes:n,sendVolumees:n,trackEffectsChains:r,midiEffects:t.midiEffects.getJson(),liveEffects:t.liveEffects.getJson()}}},{key:"loadOldMixFromJson",value:function(e){if(void 0!==e){var t={},n={};for(var r in e.deterministicMixesByType)1===parseInt(r)?n[r]=e.deterministicMixesByType[r]:t[r]=e.deterministicMixesByType[r];this.mix.loadFromJson(Object(D.a)({},e,{deterministicMixesByType:t})),this.currentSubSequence.mix.loadFromJson(Object(D.a)({},e,{deterministicMixesByType:n}))}}},{key:"getSamples",value:function(){var e=[];for(var t in this.subSequences){var n=this.subSequences[t];for(var r in n.tracks){var a=n.tracks[r];a.sample&&e.push(a.sample.getId())}}return e}},{key:"addSampleToSync",value:function(e){this.samplesToSync.push(e)}},{key:"replaceWithEncryptedSample",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r,a,i,s,o,c;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r in this.subSequences)for(i in(a=this.subSequences[r]).tracks){for(c in s=a.tracks[i],o={},s.samplers)c===t?o[n]=s.samplers[c]:o[c]=s.samplers[c];s.samplers=o,s.soundIds=Object.keys(s.samplers)}case 1:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadSampleFromSequence",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r,a,i,s,o,c,u;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("loadSampleFromSequence sampleId=%s sequenceId=%s",t,n),e.next=3,Gt.a.getJson(n);case 3:for(s in r=e.sent,console.log(r),a=r.subSequences,i={},a)for(u in o=a[s],c=function(e){e=parseInt(e);var n=o.tracksData[e];if(t in n.samplers){(i=Object(D.a)({},o)).trackParameters=n,i.sendVolumes=o.sendVolumes[e],i.trackPatterns=o.tracksPatterns[e],i.trackEffectsChains=o.tracksEffectsChains[e],i.trackMidiEffects=o.tracksMidiEffects[e],i.trackLiveEffects=o.tracksLiveEffects[e],i.trackData=o.tracksParameters[e],i.mix=o.mix,i.tracks=o.tracks[e];var r=o.groups.find(function(t){return t.tracks.indexOf(e)>-1});r.tracks=[0],i.groups=[r]}u=e},o.tracksData)c(u);this.loadPresetAsSubSequence({},i);case 9:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadingProgress",set:function(e){console.log("loading progress =",e),this.store.dispatch(Object(O.Mb)(e))}}]),n}(nP),fP=new Xe(32,!1),dP=new Xe(16,!1),mP=function(){function e(t){Object(o.a)(this,e),this.store=t,this.step=0,this.track=0,this.group=0,this.show=!1}return Object(c.a)(e,[{key:"getJson",value:function(){return{step:this.step,track:this.track}}},{key:"getStep",value:function(e){return void 0===e?this.step:e.transformStepAtResolution2(this.step,fP)}},{key:"setStep",value:function(e,t){this.step=fP.transformStepAtResolution2(e,t)}},{key:"updateRedux",value:function(){this.store.dispatch(Object(O.Mc)(this.track)),this.store.dispatch(Object(O.Kc)(this.getStep(dP))),this.store.dispatch(Object(O.gc)(this.getStep(dP)))}},{key:"step",set:function(e){this.store.dispatch(Object(O.bb)(e)),this.updateRedux()},get:function(){return this.store.getState().cursor.step}},{key:"track",set:function(e){this.store.dispatch(Object(O.cb)(e))},get:function(){return this.store.getState().cursor.track}},{key:"show",set:function(e){this.store.dispatch(Object(O.ab)(e))},get:function(){return this.store.getState().cursor.show}},{key:"resolution",get:function(){return this.store.getState().sequencer.resolution}}]),e}();function vP(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var gP=new Xe(32,!1),yP=function(e){Object(u.a)(n,e);var t=vP(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;return Object(o.a)(this,n),(r=t.call(this,e,i,s,a)).searcher=new vn(new Cn(e),Object(W.a)(r)),r.searcher.cache.loadIndex(),r.cursor=new mP(e),r.stereoOnly=a,r}return Object(c.a)(n,[{key:"setScripting",value:function(e){this.scripting=e}},{key:"clearSequence",value:function(){this.tracks.map(function(e){return e.pattern.clear()}),this.updateTracks()}},{key:"getSelectedStep",value:function(){return this.cursor.getStep(this.resolution)}},{key:"getSelectedStepData",value:function(){return this.getSelectedTrack().getStepAtResolution(this.cursor.step,gP)}},{key:"getSelectedTrack",value:function(){return void 0===this.cursor.track||void 0===this.tracks?void 0:this.tracks[this.cursor.track]}},{key:"selectTrack",value:function(e){this.cursor.track=e,this.store.getState().mix.selectedTrack!==this.cursor.track&&this.store.dispatch(Object(O.Mc)(e)),this.tracks[e]&&this.tracks[e].updateSteps(),this.tracks[e]&&(this.cursor.step=this.cursor.step%this.tracks[e].pattern.length()),this.store.dispatch(Object(O.Kc)(this.cursor.getStep(this.resolution)))}},{key:"select",value:function(e,t){void 0!==this.tracks[e]&&(this.tracks[e].stepSelected(t),this.cursor.setStep(t,this.resolution),this.cursor.track=e,this.store.dispatch(Object(O.Mc)(e)),this.store.dispatch(Object(O.Kc)(t)))}},{key:"selectGroupStep",value:function(e,t){this.cursor.setStep(t,this.resolution),this.cursor.group=e,this.store.dispatch(Object(O.Kc)(t))}},{key:"left",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(0!=this.tracks.length){var t=this.cursor.getStep(this.resolution);if(--t<0){this.up(e);var n=this.getTrackLength();return this.cursor.setStep(n-1,this.resolution),void(e&&(this.store.dispatch(Object(O.Mc)(this.cursor.track)),this.store.dispatch(Object(O.Kc)(n-1))))}this.cursor.setStep(t,this.resolution),this.tracks[this.cursor.track].stepSelected(this.cursor.step),e&&this.cursor.updateRedux()}}},{key:"getTrackLength",value:function(){return this.getSelectedTrack().getStepsAtResolution(this.resolution).length}},{key:"right",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(0!=this.tracks.length){var t=this.tracks[this.cursor.track].getStepsAtResolution(this.resolution).length,n=this.cursor.getStep(this.resolution);if(++n>=t)return this.cursor.step=0,this.down(e),void(e&&this.cursor.updateRedux());this.cursor.setStep(n,this.resolution),this.tracks[this.cursor.track].stepSelected(this.cursor.step),this.store.getState().mix.selectedTrack!==this.cursor.track&&e&&this.store.dispatch(Object(O.Mc)(this.cursor.track)),e&&this.store.dispatch(Object(O.Kc)(n))}}},{key:"setSelectedTrack",value:function(e){this.store.dispatch(Object(O.Mc)(e))}},{key:"up",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(0!=this.tracks.length){if(0==this.cursor.track)return this.cursor.track=this.tracks.length-1,void(this.store.getState().mix.selectedTrack!==this.cursor.track&&this.selectTrack(this.cursor.track));this.cursor.track--,this.store.getState().mix.selectedTrack!==this.cursor.track&&this.selectTrack(this.cursor.track),this.tracks[this.cursor.track].stepSelected(this.cursor.step)}}},{key:"down",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(0!=this.tracks.length){if(this.cursor.track==this.tracks.length-1)return this.cursor.track=0,void this.selectTrack(this.cursor.track);this.cursor.track++,this.store.getState().mix.selectedTrack!==this.cursor.track&&this.selectTrack(this.cursor.track),this.tracks[this.cursor.track].stepSelected(this.cursor.step)}}},{key:"getSample",value:function(){var e=Object(R.a)(N.a.mark(function e(t){var n,r,a,i,s;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.searcher.selectedTags=t,e.next=3,this.searcher.getSounds();case 3:return n=e.sent,e.next=6,n.getNext();case 6:if(!(n.unsortedResults.length>0)){e.next=16;break}return r=Math.floor(Math.random()*n.unsortedResults.length),a=n.unsortedResults[r],i=new Dn.a(a),e.next=12,i.load();case 12:return(s=new Mn(i,this)).sounds=Qt(Object(M.a)(n.unsortedResults)),setTimeout(function(){s.initBuffers()},250),e.abrupt("return",{sample:i,samplesStream:s});case 16:return e.abrupt("return",{sample:void 0,samplesStream:void 0});case 17:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"searchForSounds",value:function(){var e=Object(R.a)(N.a.mark(function e(t,n){var r,a,i,s,o,c,u,l,p,h,f,d;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.searcher.selectedTags=t,console.log("getting sounds..."),r=(new Date).getTime(),e.next=5,this.searcher.getSounds();case 5:return a=e.sent,e.next=8,a.getNext();case 8:if(i=(new Date).getTime(),i-r,!(a.unsortedResults.length>0)){e.next=36;break}if(s=Math.floor(Math.random()*a.unsortedResults.length),o=a.unsortedResults[s],!n){e.next=24;break}return c=new Dn.a(o),e.next=17,c.load();case 17:u=this.getSelectedTrack(),(l=new Mn(c,this)).sounds=Qt(Object(M.a)(a.unsortedResults)),l.initBuffers(),u.auditionSound(c,!1,l),e.next=36;break;case 24:return p=new Dn.a(o),e.next=27,p.load();case 27:return e.next=29,this.addSound(p);case 29:h=(new Date).getTime(),f=h-i,console.log("took "+f+" ms to add sound"),(d=this.tracks[this.tracks.length-1]).samplesStream.sounds=Qt(Object(M.a)(a.unsortedResults)),this.scrollToSelectedTrack(),setTimeout(function(){d.samplesStream.initBuffers()},250);case 36:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),n}(hP),bP=(n(2304),new wt.a),kP=Object(g.b)(function(e,t){var n=t.sequencerEngine.tracks&&t.sequencerEngine.tracks[e.mix.selectedTrack];return{liveEffects:void 0===n?0:n.liveEffects.effects.length,loadingSequence:e.sequencer.loadingSequence,selectedTrack:e.mix.selectedTrack,currentSubSequence:t.sequencerEngine.currentSubSequence.id,knobsEnabled:e.installation.knobsEnabled,sendsEnabled:e.installation.sendsEnabled,id:void 0===n?0:void 0!==n.sample&&void 0!==n.sample.getId()?n.sample.getId():n.presetName||n.getName()}},function(e){return{setContextualHelp:function(t){return e(Object(O.U)(t))}}})(function(e){var t=e.sequencerEngine,n=(e.loadingSequence,e.knobsEnabled),r=e.sendsEnabled,i=e.setContextualHelp;if(void 0===t.getSelectedTrack())return a.a.createElement("div",null);var s=function(e,t){if(e.context.macro){var n=e.context.macro;if(t.indexOf(n.name)>-1)return!0}return!1},o=function(e,n){var r=[],a=function(a){var i=t.tracks[a],o=bP.getColorForTrack(i);if(i.getParametersToShow().filter(function(t){return s(t,e)}).forEach(function(e){return r.push({parameter:e,color:o})}),-1===n.indexOf(parseInt(a)))return"continue";i.sendNodeVolumeParameters.forEach(function(e,t){return r.push({color:o,parameter:e,name:"Send "+(t+1)})})};for(var i in t.tracks)a(i);return r}(n,r);return a.a.createElement("div",{onMouseOver:function(){return i("INSTALLATION_KNOBS")},onMouseLeave:function(){return i(void 0)},className:"installation-knobs"},o.map(function(e){var n=e.parameter,r=e.color,i=e.name;return a.a.createElement(Kl,{sequencerEngine:t,name:i,key:n.id,step:.01,parameter:n,color:r})}))});function EP(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var OP=new wt.a,SP=function(e){Object(u.a)(n,e);var t=EP(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"getTrack",value:function(e){return this.props.sequencerEngine.tracks[e]}},{key:"getSample",value:function(e){var t=this.getTrack(e);return void 0===t?void 0:t.sample}},{key:"isSample",value:function(e){return void 0!==this.getSample(e)}},{key:"isThumbnail",value:function(e){return this.isSample(e)&&""!==this.getSample(e).videoId&&void 0!==this.getSample(e).videoId}},{key:"getThumbnailURL",value:function(e){return this.getSample(e).getThumbnail()}},{key:"getStyle",value:function(){var e={};if(void 0!==this.props.keyMapping){var t=this.props.keyMapping;e.borderBottomColor=OP.getColor(t.sliceNumber),e.borderBottomStyle="solid",e.borderBottomWidth="3px",this.isThumbnail(t.trackNumber)?(e.backgroundImage='url("'+this.getThumbnailURL(t.trackNumber)+'")',e.backgroundPosition="center",e.backgroundSize="cover"):this.isSample(t.trackNumber)&&(e.backgroundColor=this.getSample(t.trackNumber).color)}return e}},{key:"key",get:function(){return this.props.value.toLowerCase()}}]),n}(r.Component);function PP(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}new wt.a;var wP=function(e){Object(u.a)(n,e);var t=PP(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"onClickKey",value:function(){this.props.mini&&this.key in this.mappings?this.props.sequencerEngine.selectTrack(this.mappings[this.key].trackNumber):this.isSample(this.props.trackNumber)&&(this.props.keyboardEngine.hasKeyMapping(this.key)?this.props.keyboardEngine.deleteKeyMapping(this.key):this.props.keyboardEngine.map(this.key,this.props.trackNumber,this.props.selectedSlice))}},{key:"render",value:function(){var e=this,t=this.props.mini?"key mini":"key";return this.props.triggering&&(t+=" flashit"),a.a.createElement("div",{onClick:function(){return e.onClickKey()},style:this.getStyle(),className:t},this.props.value)}},{key:"mappings",get:function(){return void 0===this.props.keyboardEngine?{}:this.props.keyboardEngine.getMappings()}}]),n}(SP),jP=Object(g.b)(function(e,t){var n=e.keyboard.keyMappings[t.keyboardKey],r=void 0===n?void 0:e.tracks.triggers[n.trackNumber];return{triggering:void 0!==r&&r[n.sliceNumber],keyMapping:n}},function(e,t){return{setContextualHelp:function(t){return e(Object(O.U)(t))}}})(wP);function TP(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var xP=[["Q","W","E","R","T","Y","U","I","O","P"],["A","S","D","F","G","H","J","K","L"],["Z","X","C","V","B","N","M"]];r.Component,n(2305);function CP(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var NP=function(e){Object(u.a)(n,e);var t=CP(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"getContextualHelp",value:function(){return this.props.contextualHelp?k[this.props.contextualHelp]:void 0!==this.props.sequencerEngine?a.a.createElement("div",null):""}},{key:"render",value:function(){var e=void 0===this.props.contextualHelp?"contextual-help empty":"contextual-help";return a.a.createElement("div",{className:e},this.getContextualHelp())}}]),n}(r.Component),RP=Object(g.b)(function(e){return{contextualHelp:e.sequencer.contextualHelp}},null)(NP),DP=function(e){var t=e.onClickDone,n=e.onClickCancel,r=e.show;e.track;return a.a.createElement(lh.a,{dialogClassName:"rack-modal",show:r,onHide:n},a.a.createElement(lh.a.Header,{closeButton:!0},a.a.createElement(lh.a.Title,null,"Convert to Instrument Rack")),a.a.createElement(lh.a.Body,null,"Confirm to convert to instrument rack."),a.a.createElement(lh.a.Footer,null,a.a.createElement(Ac.b,{variant:"secondary",onClick:t},"Confirm"),a.a.createElement(Ac.b,{variant:"primary",onClick:n},"Cancel")))};Object(g.b)(null,function(e,t){return{setAnnotationDragging:function(t){return e(Object(O.u)(t))}}})(function(e){var t=e.annotation,n=e.color,i=e.onDelete,s=e.setAnnotationDragging,o=Object(r.useState)(t.text),c=Object(j.a)(o,2),u=c[0],l=c[1],p=Object(r.useCallback)(function(e){e.stopPropagation(),t.text=e.target.value,l(e.target.value)},[l]),h={left:t.x,top:t.y,backgroundColor:n},f={backgroundColor:n},d=Object(r.useCallback)(function(e){s(t)},[s]);return a.a.createElement("div",{style:h,className:"annotation"},a.a.createElement("div",{onMouseDown:d,className:"draggable-header"},a.a.createElement("div",{className:"delete-button",onClick:i},"x")),a.a.createElement(Ac.g,{style:f,onChange:p,type:"textarea",value:u,placeholder:"Write a note",className:"annotation-text"}))});function qP(e){var t=e.track,n=e.sequencerEngine;return a.a.createElement(Yd,{track:t,rackTrack:{trackNumber:0},width:55,min:-50,onVolumeChange:function(e){return n.operationManager.dispatch(bt(t,e))}})}var MP=Object(r.memo)(function(e){var t=e.resolution,n=e.stepNumber,r=e.length,i=(e.track,e.stepData),s=e.trackColor,o=e.width,c=void 0===o?448:o,u=e.height,l=void 0===u?40:u,p=e.pattern;if(void 0===i){var h=p.getAllOnStepAtResolutionAtAnyPosition(n,t);if(0===h.length)return a.a.createElement("div",null);i=h[0]}var f=l/2,d={left:c*n/r,width:i.duration*c/r,top:f-i.transpose/2};i.on&&(d.backgroundColor=s);var m=i.on?"on":"off";return a.a.createElement("div",{className:m,style:d})});var AP=Object(g.b)(function(e,t){var n=t.sequencerEngine.getSequenceId();return{currentStep:(e.sequencer.currentGlobalStep[n]||0)%t.track.length}},null)(function(e){var t={left:448*e.currentStep/e.track.length};return a.a.createElement("div",{className:"play-tick",style:t})}),IP=128;function LP(e){var t="part";e.i===e.partNumber&&(t+=" current-part");return a.a.createElement("div",{onClick:function(){return function(){e.sequencerEngine.cursor.step=e.i*IP;var t=e.sequencerEngine.trackStep;e.sequencerEngine.seekToTrackStep(t%IP+e.i*IP,!1)}()},className:t})}var FP=Object(g.b)(function(e,t){var n=t.sequencerEngine.getSequenceId(),r=(e.sequencer.currentGlobalStep[n],e.tracks.trackSteps[t.track.trackNumber]);t.track.length;return{resolution:e.sequencer.resolution,steps:r}},null)(function(e){var t=e.track.pattern.length(e.resolution),n=(Array(t).fill(0),e.track.getStepsAtResolution(e.resolution).map(function(e,t){return{step:e,stepNumber:t}}).filter(function(e){return e.step.on})),r=Math.ceil(e.track.length/IP),i=Array(r).fill(0);return a.a.createElement("div",{className:"steps-map"},i.map(function(t,n){return a.a.createElement(LP,{i:n,track:e.track,sequencerEngine:e.sequencerEngine,partNumber:e.partNumber})}),n.map(function(n){return a.a.createElement(MP,{key:n.step.id,trackColor:e.trackColor,pattern:e.track.pattern,length:t,stepNumber:n.stepNumber,resolution:e.resolution,stepData:n.step})}),a.a.createElement(AP,{track:e.track,sequencerEngine:e.sequencerEngine}))});function BP(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var HP=function(e){Object(u.a)(n,e);var t=BP(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=37*this.props.currentStep,t=(Math.floor(this.props.currentStep/4),{marginLeft:e});return a.a.createElement("div",{className:"steps-row-bottom"},void 0!==this.props.currentStep?a.a.createElement("div",{style:t,className:"current-step-box"}):"")}}]),n}(r.Component),VP=Object(g.b)(function(e,t){var n=t.sequencerEngine.getSequenceId(),r=Math.floor((e.sequencer.currentGlobalStep[n]||0)/($o.baseResolution.numSteps()/e.sequencer.resolution.numSteps()));r%=t.stepsLength;var a=t.chunk*t.stepsInRow,i=(t.chunk+1)*t.stepsInRow;return{currentStep:r>=a&&r<i?r%t.stepsInRow:void 0}},null)(HP);function UP(e){return parseInt(e.numSteps())/4}n(2306),n(924);function JP(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var _P=function(e){Object(u.a)(n,e);var t=JP(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={showMoreParameters:!1,refined:!1},r}return Object(c.a)(n,[{key:"hasMidiFX",value:function(){return this.props.track.midiEffects.effects.length>0}},{key:"hasInstrument",value:function(){return void 0!==this.props.track.instrument}},{key:"onClickMore",value:function(){this.setState({showMoreParameters:!this.state.showMoreParameters})}},{key:"shouldBeRefined",value:function(){return this.props.stepData.duration%1!==0||this.props.stepData.transpose%1!==0}},{key:"onChangeRefined",value:function(e){var t="refined"===e;document.activeElement.blur(),this.setState({refined:t})}},{key:"onChangeDuration",value:function(e){this.props.sequencerEngine.operationManager.dispatch(ft(this.props.track,this.props.stepData,this.props.stepData.durationParameter,e)),this.setState(this.state)}},{key:"onChangeChop",value:function(e){this.props.sequencerEngine.operationManager.dispatch(ft(this.props.track,this.props.stepData,this.props.stepData.chopParameter,e)),this.state.chop=e,this.setState(this.state)}},{key:"onChangeParameter",value:function(e,t){this.props.sequencerEngine.operationManager.dispatch(ft(this.props.track,this.props.stepData,e,t))}},{key:"onChangeChopDuration",value:function(e){this.props.stepData.chopDuration=e,this.state.chopDuration=e,this.setState(this.state)}},{key:"onChangeTranspose",value:function(e){this.props.sequencerEngine.operationManager.dispatch(ft(this.props.track,this.props.stepData,this.props.stepData.transposeParameter,e)),this.state.transpose=e,this.setState(this.state)}},{key:"onChangeReversed",value:function(e,t){this.props.stepData.reverse=!t.reverse,document.activeElement.blur(),this.setState(this.state)}},{key:"onChangeVelocity",value:function(e){this.props.sequencerEngine.operationManager.dispatch(ft(this.props.track,this.props.stepData,this.props.stepData.velocityParameter,e)),this.state.velocity=e,this.setState(this.state)}},{key:"onChangeSlice",value:function(e){this.props.sequencerEngine.operationManager.dispatch(ft(this.props.track,this.props.stepData,this.props.stepData.sliceParameter,e)),this.state.slice=e,this.setState(this.state)}},{key:"onClickFX",value:function(){this.effects.length>0&&this.props.setShowStepOptions("AUDIO_FX",0)}},{key:"onClickInstrument",value:function(){return this.props.setShowStepOptions("INSTRUMENT",0)}},{key:"onClickMidiFX",value:function(){this.props.setShowStepOptions("MIDI_FX",0)}},{key:"onClickNextFX",value:function(){var e="MIDI_FX"===this.showOption?this.midiFX:this.effects;if(e.length>0){var t=(this.effectToShow+1)%e.length;this.props.setShowStepOptions(this.showOption,t)}}},{key:"onClickBack",value:function(){this.props.setShowStepOptions(void 0)}},{key:"onChangePanning",value:function(e){this.props.stepData.panning=e,this.props.onUpdateStepData(this.props.stepData),this.state.panning=e,this.setState(this.state)}},{key:"getParametersToShow",value:function(e){var t=this,n=this.state.refined?.01:1,r=this.state.refined?2:64,i=this.props.isMidi?_i.a.middleC.transpose(e.transpose).toString():e.transpose,s=this.state.refined?.01:1;if(this.state.showMoreParameters)return a.a.createElement("div",null,a.a.createElement(GP,{label:"Attack",labelValue:e.attack,value:e.attack,min:0,step:1,max:4e3,onChange:function(e){return t.onChangeParameter(t.props.stepData.attackParameter,e)}}),a.a.createElement(GP,{label:"Release",labelValue:e.release,value:e.release,min:0,step:1,max:6e3,onChange:function(e){return t.onChangeParameter(t.props.stepData.releaseParameter,e)}}),a.a.createElement(GP,{label:"Pitch Attack",labelValue:e.pitchAttack,value:e.pitchAttack,min:0,step:1,max:6e3,onChange:function(e){return t.onChangeParameter(t.props.stepData.pitchAttackParameter,e)}}),a.a.createElement(GP,{label:"Pitch Decay",labelValue:e.pitchDecay,value:e.pitchDecay,min:0,step:1,max:6e3,onChange:function(e){return t.onChangeParameter(t.props.stepData.pitchDecayParameter,e)}}),a.a.createElement(GP,{label:"Pitch Sustain",labelValue:e.pitchSustain,value:e.pitchSustain,min:-10,step:.01,max:10,onChange:function(e){return t.onChangeParameter(t.props.stepData.pitchSustainParameter,e)}}),a.a.createElement(GP,{label:"Pitch Release",labelValue:e.pitchRelease,value:e.pitchRelease,min:0,step:1,max:8e3,onChange:function(e){return t.onChangeParameter(t.props.stepData.pitchReleaseParameter,e)}}));var o=null===e.panning?this.props.track.getPanning():e.panning;return a.a.createElement("div",null,a.a.createElement(GP,{label:"Duration",labelValue:e.duration,value:e.duration,min:n,step:s,max:r,onChange:function(e){return t.onChangeDuration(e)}}," "),a.a.createElement(GP,{label:"Chop",labelValue:e.chop,value:e.chop,min:1,step:1,max:64,onChange:function(e){return t.onChangeChop(e)}}," "),a.a.createElement(GP,{label:"Slice",labelValue:e.slice,value:e.slice,min:0,step:1,max:this.props.slices-1,onChange:function(e){return t.onChangeSlice(e)}}," "),a.a.createElement(GP,{label:"Transpose",labelValue:i,value:e.transpose,min:-23,max:23,step:1,onChange:function(e){return t.onChangeTranspose(e)}}," "),a.a.createElement(GP,{label:"Velocity",labelValue:e.velocity,value:e.velocity,min:0,max:1,step:.1,onChange:function(e){return t.onChangeVelocity(e)}}," "),a.a.createElement(GP,{label:"Panning",labelValue:o,value:o,min:-1,max:1,step:.1,onChange:function(e){return t.onChangePanning(e)}}," "))}},{key:"getCheckboxes",value:function(e){var t=this;return a.a.createElement("div",null,a.a.createElement("div",{className:"reverse-parameter"},a.a.createElement("form",null,a.a.createElement("div",{className:"refined-checkbox"},a.a.createElement("label",null,a.a.createElement("input",{type:"checkbox",value:"reversed",checked:e.reverse,onChange:function(n){return t.onChangeReversed(n.target.value,e)}}),"Reverse")))),a.a.createElement("div",{className:"refined-parameter"},a.a.createElement("form",null,a.a.createElement("div",{className:"refined-checkbox"},a.a.createElement("label",null,a.a.createElement("input",{type:"checkbox",value:"refined",checked:this.state.refined,onChange:function(e){return t.onChangeRefined(e.target.value)}}),"Refine")))))}},{key:"effectExists",value:function(e){return"MIDI_FX"===this.showOption?void 0!==this.midiFX[e]:void 0!==this.effects[e]}},{key:"render",value:function(){var e=this,t=this.props.track.getStepDataForStep(this.props.stepData,!0);return"INSTRUMENT"===this.showOption&&this.hasInstrument()||"MIDI_FX"===this.showOption&&this.hasMidiFX()||"AUDIO_FX"===this.showOption&&this.effects.length>0?a.a.createElement("div",null,this.getEffectOrInstrument(),a.a.createElement("div",{className:"effects-parameters-button-container"},a.a.createElement(Wc,{condition:"AUDIO_FX"===this.showOption||"MIDI_FX"===this.state.showOption},a.a.createElement("div",{onClick:function(){return e.onClickNextFX()},className:"small-button pink-button float-right"},"NEXT")),a.a.createElement("div",{onClick:function(){return e.onClickBack()},className:"small-button pink-button float-right"},"BACK"))):a.a.createElement("div",null,this.getParametersToShow(t),this.getCheckboxes(t),a.a.createElement("div",{className:"effects-parameters-button-container"},this.effects.length>0?a.a.createElement("div",{onClick:function(){return e.onClickFX()},className:"small-button pink-button float-right"},"FX"):"",this.hasMidiFX()?a.a.createElement("div",{onClick:function(){return e.onClickMidiFX()},className:"small-button pink-button float-right"},"MIDI FX"):"",a.a.createElement(Wc,{condition:this.hasInstrument()},a.a.createElement("div",{onClick:function(){return e.onClickInstrument()},className:"small-button pink-button float-right"},"INSTRUMENT")),a.a.createElement("div",{onClick:function(){return e.onClickMore()},className:"small-button pink-button float-right"},this.state.showMoreParameters?"BACK":"MORE")))}},{key:"getEffectOrInstrument",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.effectToShow,n="MIDI_FX"===this.showOption?this.props.track.midiEffects.effects[t]:this.effects[t];if("MIDI_FX"===this.showOption&&this.effectExists(t))return a.a.createElement(El,{onEffectsChange:function(){return e.props.track.updateEffects()},sequencerEngine:this.props.sequencerEngine,effect:n,track:this.props.track,effectNumber:t,automation:this.props.stepData.effectAutomations});if("AUDIO_FX"===this.showOption&&this.effectExists(t))return a.a.createElement(og.EffectComponent,{onEffectsChange:function(){return e.props.track.updateEffects()},sequencerEngine:this.props.sequencerEngine,effect:n,track:this.props.track,effectNumber:t,automation:this.props.stepData.effectAutomations});if("INSTRUMENT"===this.showOption&&this.hasInstrument()){var r=this.props.track.instrument.getInstrumentType();if(r===op)return a.a.createElement(wd,{track:this.props.track,automation:this.props.stepData.effectAutomations,instrument:this.props.track.getInstrument()});if(r===cp)return a.a.createElement(Dh,{sequencerEngine:this.props.sequencerEngine,track:this.props.track,automation:this.props.stepData.effectAutomations,instrument:this.props.track.getInstrument()});if(r===up)return a.a.createElement(bd,{sequencerEngine:this.props.sequencerEngine,track:this.props.track,automation:this.props.stepData.effectAutomations,instrument:this.props.track.getInstrument()});if(r===lp)return a.a.createElement(Ed,{sequencerEngine:this.props.sequencerEngine,automation:this.props.stepData.effectAutomations,track:this.props.track,instrument:this.props.track.getInstrument()})}return""}},{key:"effectToShow",get:function(){return void 0===this.props.showStepOptions?void 0:this.props.showStepOptions.effect}},{key:"showOption",get:function(){return void 0===this.props.showStepOptions?void 0:this.props.showStepOptions.option}},{key:"effects",get:function(){return this.props.track.effectsChains[this.props.effectsChain].effects}},{key:"midiFX",get:function(){return this.props.track.midiEffects.effects}}]),n}(r.Component),GP=function(e){Object(u.a)(n,e);var t=JP(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e){return this.props.value!==e.value||this.props.step!==e.step}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"step-parameter"},a.a.createElement("div",{className:"parameter-label"},this.props.label,": ",this.props.labelValue," "),a.a.createElement(xt.a,{value:this.props.value,change:function(t){return e.props.onChange(t.target.value)},step:this.props.step,max:this.props.max,min:this.props.min,orientation:"horizontal",reversed:!1}))}}]),n}(r.Component),zP=Object(g.b)(function(e,t){var n=t.track.trackNumber;return{effectsChain:e.tracks.trackEffectsChain[n]||0,showStepOptions:e.steps.showStepOptions}},function(e){return{setShowStepOptions:function(t,n){return e(Object(O.hd)(t,n))}}})(_P);function WP(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var KP=new wt.a;window.factorFill=1.2;var QP=function(e){Object(u.a)(n,e);var t=WP(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"brighten",value:function(e,t){var n=Math.min(255,Math.floor(parseInt(e.slice(1,3),16)*t)),r=Math.min(255,Math.floor(parseInt(e.slice(3,5),16)*t)),a=Math.min(255,Math.floor(parseInt(e.slice(5),16)*t));return n=n.toString(16),r=r.toString(16),a=a.toString(16),1===n.length&&(n="0"+n),1===r.length&&(r="0"+r),1===a.length&&(a="0"+a),"#"+n+r+a}},{key:"render",value:function(){var e=this,t={};if(this.props.fill){var n=window.factorFill,r=KP.brighten(KP.getColorForTrack(this.props.track),n);t={backgroundColor:KP.saturate(r,.6)}}var i="fill ";return this.props.isCurrentStep&&(i+=" current-step"),this.props.isCursor&&(i+=" cursor"),this.props.on&&(i+=" on"),a.a.createElement("div",{onMouseDown:function(){return e.props.onMouseDown()},onMouseUp:function(t){return e.props.onMouseUp(t)},style:t,className:i})}}]),n}(r.Component);function XP(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var YP=new wt.a,ZP=new Xe(16,!1),$P=new Ge,ew=function(e){Object(u.a)(n,e);var t=XP(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e){var t=this.props;return e.showParameters!==t.showParameters||e.on!==t.on||e.isCursor!==t.isCursor||e.id!==t.id||e.show!==t.show||e.selectedSteps!==t.selectedSteps||e.stepsSelection!==t.stepsSelection||e.fill!==t.fill}},{key:"getState",value:function(){return this.props.sequencerEngine.store.getState()}},{key:"componentDidUpdate",value:function(e){if(this.props.isCursor&&this.props.isCursor!==e.isCursor){var t=document.getElementsByClassName("cursor")[0],n=this.showingPianoRoll()?document.getElementsByClassName("scroll-area")[0]:void 0;if(!function(e,t){e.getBoundingClientRect();var n=e.offsetTop,r=t?t.clientHeight:window.innerHeight,a=t?t.scrollTop:window.scrollY+40;return n-a>=0&&n-a<=r-200}(t,n)){var r=(t=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=e,r=0;r<t;r++)n=n.parentElement;return n}(t,8)).offsetTop;(n=n||window).scroll(0,r-200)}}}},{key:"getState",value:function(){return this.props.sequencerEngine.store.getState()}},{key:"showingPianoRoll",value:function(){return this.getState().sequencer.showPianoRoll}},{key:"onMouseUp",value:function(e){if(!this.props.isGroup){this.props.setSingleStepToDrag(void 0),this.props.setIsDraggingDuration(!1),this.props.setStepToCopy(void 0);var t=this.props.sequencerEngine.store.getState();(this.isCommandDown||t.steps.stepNumberDraggedTo!==this.props.stepNumber)&&t.steps.stepNumberDraggingFrom===this.props.stepNumber?(this.props.onClick(),this.props.setStepNumberDraggedTo(void 0),this.setState(this.state)):this.props.setStepNumberDraggedTo(void 0)}}},{key:"onMouseDown",value:function(){this.props.showParameters||(this.props.mouseDown(!0),this.props.selectStep&&this.props.selectStep(),this.props.isGroup||(this.isSelected()?this.props.setStepNumberDraggingFrom(this.props.stepNumber):!this.isCommandDown&&this.props.on?(this.props.setSelectedSteps(void 0),this.props.setSingleStepToDrag(this.stepData),this.props.setStepNumberDraggingFrom(this.props.stepNumber)):(this.props.setSelectedSteps(void 0),this.props.setStepsSelection(this.props.trackNumber,this.props.stepNumber,this.props.stepNumber)),this.props.setStepNumberDraggingFrom(this.props.stepNumber)))}},{key:"onMouseOver",value:function(e){if(e.stopPropagation(),this.props.setContextualHelp("STEP"),!this.props.showParameters){var t=this.props.sequencerEngine.store.getState();if(t.keyboard.isDraggingDuration&&t.keyboard.isMouseDown)this.updateDuration();else if(void 0===t.steps.stepNumberDraggingFrom||void 0===t.keyboard.selectedPianoRollSteps&&!t.steps.singleStepToDrag){if(void 0!==this.props.stepsSelection){var n=this.props.stepsSelection;this.props.stepNumber>=n.fromStep?this.props.setStepsSelection(this.props.trackNumber,n.fromStep,this.props.stepNumber):this.props.setStepsSelection(this.props.trackNumber,this.props.stepNumber,n.toStep)}}else{var r=this.getTransformation(t.steps.stepNumberDraggingFrom),a=void 0!==t.keyboard.selectedPianoRollSteps?t.keyboard.selectedPianoRollSteps:[t.steps.singleStepToDrag];this.props.sequencerEngine.operationManager.dispatch(pt(this.props.sequencerEngine.tracks[this.props.trackNumber],a,r,this.props.resolution)),this.props.setStepNumberDraggingFrom(this.props.stepNumber),this.props.setStepNumberDraggedTo(this.props.stepNumber),this.props.selectStep()}}}},{key:"getState",value:function(){return this.props.sequencerEngine.store.getState()}},{key:"updateDuration",value:function(){var e=this,t=1+this.props.stepNumber-this.getState().keyboard.stepDragging,n=ZP.transformStepAtResolution2(t,this.props.resolution),r=this.getState().keyboard.stepToCopy;null===r.duration?this.props.track.trackData.duration:r.duration;this.props.selectedSteps?this.props.selectedSteps.forEach(function(t){return e.updateStepDuration(t,n)}):this.updateStepDuration(r,n)}},{key:"updateStepDuration",value:function(e,t){null===e.duration?this.props.track.trackData.duration:e.duration;this.props.sequencerEngine.operationManager.dispatch(ft(this.props.sequencerEngine.tracks[this.props.trackNumber],e,e.durationParameter,Math.max(.1,t)))}},{key:"getTransformation",value:function(e){return{stepDifference:this.props.stepNumber-e,transposeDifference:0}}},{key:"isSelection",value:function(){var e=this.props.stepsSelection;return void 0!==e&&(this.props.stepNumber>=e.fromStep&&this.props.stepNumber<=e.toStep)}},{key:"isSelected",value:function(){var e=this;return!(void 0===this.props.selectedSteps||!this.props.on||this.props.showParameters)&&this.props.selectedSteps.filter(function(t){return t.id===e.stepData.id}).length>0}},{key:"dragStepDuration",value:function(e){e.stopPropagation(),this.isSelected()||this.props.setSelectedSteps(void 0),this.props.setIsDraggingDuration(!0),this.props.setStepDragging(this.props.stepNumber),this.props.setStepToCopy(this.stepData),this.props.mouseDown(!0)}},{key:"getRGB",value:function(e){return{r:Math.floor(parseInt(e.slice(1,3),16)),g:Math.floor(parseInt(e.slice(3,5),16)),b:Math.floor(parseInt(e.slice(5),16))}}},{key:"getBrightness",value:function(e){var t=this.getRGB(e);return.299*t.r+.587*t.g+.114*t.b}},{key:"brighten",value:function(e,t){var n=Math.min(255,Math.floor(parseInt(e.slice(1,3),16)*t)),r=Math.min(255,Math.floor(parseInt(e.slice(3,5),16)*t)),a=Math.min(255,Math.floor(parseInt(e.slice(5),16)*t));return n=n.toString(16),r=r.toString(16),a=a.toString(16),1===n.length&&(n="0"+n),1===r.length&&(r="0"+r),1===a.length&&(a="0"+a),"#"+n+r+a}},{key:"render",value:function(){var e=this,t=(this.props.isAlternateColor,{});if(!this.props.showParameters&&this.props.on){var n=.7*this.props.velocity+.3;t.opacity=n}this.props.isAlternateColor;var r="step ";this.props.on?(r+="on ",t.backgroundColor=this.color):r+="off ",this.props.isAlternateColor&&(r+=" alternate "),this.isSelected()?(r+=" selected ",t.borderTopColor=this.color,t.borderRightColor=this.color,t.borderLeftColor=this.color,t.backgroundColor=YP.brighten(this.color,.6)):this.props.isCurrentStep&&this.props.isCursor?r+=" cursor ":this.props.isCurrentStep?r+=" current-step ":this.props.isCursor&&(r+=" cursor "),this.props.viMode&&(r+=" vi-mode");this.props.fill&&this.fillColor,this.props.on&&(t.borderBottomColor=YP.compliment(this.color),t.borderBottomWidth="5px"),this.props.showParameters||(r+=" not-expanded"),r+=this.isSelection()?" selection ":"";var i=UP(this.props.resolution);return i>2&&this.props.stepNumber%i===i-1&&(r+=" beat-division"),a.a.createElement("div",{className:"step-container"},a.a.createElement("div",{key:this.props.stepNumber,onMouseDown:function(){return e.onMouseDown()},onMouseUp:function(t){return e.onMouseUp(t)},onMouseOver:function(t){return e.onMouseOver(t)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},style:t,className:r},this.props.showParameters?a.a.createElement(zP,{sequencerEngine:this.props.sequencerEngine,track:this.props.track,isMidi:this.props.isMidi,onUpdateStepData:function(t){e.setState(e.state)},onUpdateStepDuration:this.props.onUpdateStepDuration,slices:this.props.slices,stepData:this.stepData}):"",a.a.createElement(Wc,{condition:this.props.on},a.a.createElement("div",{draggable:!1,onMouseDown:function(t){return e.dragStepDuration(t)},className:"right-edge"}))),a.a.createElement(QP,{onMouseDown:function(){return e.onMouseDown()},onMouseUp:function(t){return e.onMouseUp(t)},sampleId:this.props.id,on:this.props.on,fill:this.props.fill,track:this.props.track,isCurrentStep:this.props.isCurrentStep,isCursor:this.props.isCursor}))}},{key:"color",get:function(){return YP.getColorForTrack(this.props.track)}},{key:"isCommandDown",get:function(){return this.props.sequencerEngine.store.getState().keyboard.isCommandDown}},{key:"stepData",get:function(){var e=this.props.sequencerEngine.store.getState().tracks.trackStepIds[this.props.trackNumber],t=e&&e[this.props.stepNumber];return void 0!==t&&t.on||(t=$P),t}}]),n}(r.Component);var tw=Object(g.b)(null,function(e){return{mouseDown:function(t){return e(Object(O.k)(t))},dragToggle:function(t){return e(Object(O.i)(t))},setContextualHelp:function(t){return e(Object(O.U)(t))},setStepToCopy:function(t){return e(Object(O.ud)(t))},setStepDragging:function(t){return e(Object(O.rd)(t))},setSingleStepToDrag:function(t){return e(Object(O.od)(t))},setStepsSelection:function(t,n,r){return e(Object(O.wd)(t,n,r))},setStepNumberDraggingFrom:function(t){return e(Object(O.td)(t))},setStepNumberDraggedTo:function(t){return e(Object(O.sd)(t))},setIsDraggingDuration:function(t){return e(Object(O.Ab)(t))},setSelectedSteps:function(t){return e(Object(O.Gc)(t))}}})(ew);function nw(e,t){var n=t.transformStepAtResolution2(e.pattern.length(),new Xe(32,!1));n=Math.floor(n);for(var r=new Array(n).fill(0),a=t.isTriplet?12:16,i=r.length/a,s=[],o=0;o<i;o++){var c=o*a,u=c+a;s.push(r.slice(c,u))}return s}function rw(e){return e.isTriplet?12:16}function aw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var iw=new Ge,sw=new wt.a,ow=function(e){Object(u.a)(n,e);var t=aw(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"onMouseLeave",value:function(){}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"onClickStep",value:function(e){this.props.onClick(e)}},{key:"isAlternateColor",value:function(e,t,n){return Math.ceil((e+1)/t)%2!=0}},{key:"onClickLock",value:function(){this.props.trackData.togglePatternLock(),this.setState(this.state)}},{key:"record",value:function(){this.props.trackPreparingToRecord(this.props.trackNumber,!0),this.props.sequencerEngine.recordTrack(this.props.trackNumber),this.setState(this.state)}},{key:"getStepsRowClassName",value:function(e){var t="steps-row";return Math.floor(e/2)%2===1&&(t+=" odd"),t}},{key:"isCursor",value:function(e){return this.props.cursorStep===e}},{key:"isOn",value:function(e){return this.props.steps&&this.props.steps[e]}},{key:"isViMode",value:function(e){return this.props.viMode&&this.isCursor(e)}},{key:"getStepData",value:function(e){var t=this.props.stepDatas&&this.props.stepDatas[e];return void 0!==t&&t.on||(t=iw),t}},{key:"getVelocity",value:function(e){return this.getStepData(e).velocity}},{key:"getSlice",value:function(e){return this.getStepData(e).slice}},{key:"isFilled",value:function(e){return this.props.fills&&this.props.fills[e]}},{key:"getState",value:function(){return this.props.sequencerEngine.store.getState()}},{key:"showParameters",value:function(e){return this.getState().cursor.track===this.props.trackNumber&&this.props.sequencerEngine.getSelectedStep()===e&&this.getState().cursor.show}},{key:"render",value:function(){var e=this,t=((new Date).getTime(),rw(this.props.resolution)),n=nw(this.props.track,this.props.resolution),r=0;if(this.length>128){r=Math.floor(this.props.partNumber*n.length/this.props.numberParts);var i=Math.floor((this.props.partNumber+1)*n.length/this.props.numberParts);n=n.filter(function(e,t){return t>=r&&t<i})}var s=UP(this.props.resolution),o=this.props.track.numberOfSlices(),c=this.props.isTrackRecording,u=this.props.isTrackPreparingToRecord,l=this.props.isCompactMode?"track-footer-container compact":"track-footer-container",p="dot";c?p="recording-dot":u&&(p="preparing-dot");var h="";this.length>128&&(h=a.a.createElement(FP,{partNumber:this.props.partNumber,trackColor:this.props.trackColor,track:this.props.trackData,sequencerEngine:this.props.sequencerEngine}));var f={};this.props.isSelectedTrack&&(f={backgroundColor:sw.getColorForTrack(this.props.trackData),color:"black"});(new Date).getTime();return a.a.createElement("div",{onMouseLeave:function(){return e.onMouseLeave()},className:"steps-container"},h,n.map(function(n,i){return a.a.createElement("div",{key:"steps-row-chunk- "+i},a.a.createElement("div",{className:e.getStepsRowClassName(i)},n.map(function(n,c){var u,l=t*(r+i)+c;return a.a.createElement(tw,(u={id:e.props.id,sample:e.props.sample,key:"key-"+(t*(i+r)+c)+"."+e.props.trackNumber,isCursor:e.isCursor(l),on:e.isOn(l),fill:e.isFilled(l),showParameters:e.showParameters(l),selectedSteps:e.props.selectedSteps,stepsSelection:e.props.stepsSelection,slice:e.getSlice(l),velocity:e.getVelocity(l),sequencerEngine:e.props.sequencerEngine,effectToShow:e.state.effectToShow,isMidi:e.props.isMidiTrack,resolution:e.props.resolution,trackNumber:e.props.trackNumber},Object(An.a)(u,"resolution",e.props.resolution),Object(An.a)(u,"stepNumber",l),Object(An.a)(u,"selectStep",function(){return e.props.selectStep(t*(r+i)+c)}),Object(An.a)(u,"stepsLength",e.props.stepsLength),Object(An.a)(u,"show",e.props.show),Object(An.a)(u,"trackData",e.props.track),Object(An.a)(u,"onUpdateStepDuration",function(n){return e.props.onUpdateStepDuration(t*(r+i)+c,n)}),Object(An.a)(u,"onUpdateStepData",function(n){return e.props.onUpdateStepData(n,t*(r+i)+c)}),Object(An.a)(u,"isAlternateColor",e.isAlternateColor(c,s,e.props.resolution)),Object(An.a)(u,"slices",o),Object(An.a)(u,"track",e.props.track),Object(An.a)(u,"onClick",function(){return e.onClickStep(t*(r+i)+c)}),u))})),a.a.createElement(VP,{sequencerEngine:e.props.sequencerEngine,track:e.props.track,stepsLength:e.props.stepsLength,stepsInRow:t,chunk:r+i}))}),a.a.createElement("div",null,this.props.track.isRecordable()?a.a.createElement("div",{className:"record-audio-button"},a.a.createElement("span",{onClick:function(){return e.record()},className:p})):"",a.a.createElement(Wc,{condition:!this.props.isCompactMode},a.a.createElement("div",null,a.a.createElement("div",{className:l},a.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"TRACK_ADD_STEPS_BUTTON")},onMouseLeave:function(t){return e.props.setContextualHelp(void 0)},style:f,onClick:this.props.onClickAddSteps,className:"add-steps-button"},"+"),a.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"TRACK_REMOVE_STEPS_BUTTON")},style:f,onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:this.props.onClickRemoveSteps,className:"remove-steps-button"},"-")),a.a.createElement(fp,{toggleLock:function(){return e.onClickLock()},patternLocked:this.props.patternLocked})))))}},{key:"length",get:function(){return this.props.trackData.length}}]),n}(r.Component),cw=Object(g.b)(function(e,t){var n=t.sequencerEngine.getSequenceId(),r=(e.sequencer.currentStep[n],e.sequencer.currentGlobalStep[n]||0),a=(e.tracks.trackSteps[t.trackData.subSequence.isTrack?t.trackData.subSequence.id:t.trackNumber],e.tracks.trackPatternLocks[t.trackData.subSequence.id]),i=!1;if(a){var s=a[t.trackNumber];s&&(i=s[t.trackData.currentPattern])}var o=void 0,c=void 0;if(t.track.length>128){o=Math.floor(r%t.trackData.length/128),c=t.track.length/128;var u=e.mix.selectedTrack==t.trackNumber,l=t.sequencerEngine.cursor.getStep();u&&!t.sequencerEngine.playing&&(o=Math.floor(l/128))}var p=e.steps.stepsSelection,h=(e.steps.selectedSteps,t.track);return h&&h.tracks&&h.tracks[0]&&(h=h.tracks[0].track),{id:void 0!==h.sample&&void 0!==h.sample.getId()?h.sample.getId():h.presetName||h.getName(),partNumber:o,numberParts:c,resolution:e.sequencer.resolution,samples:e.samples,isTrackRecording:e.sequencer.tracksRecording[t.trackNumber],isTrackPreparingToRecord:e.sequencer.tracksPreparingToRecord[t.trackNumber],stepsLength:t.track.pattern.length(e.sequencer.resolution),isSelectedTrack:e.mix.selectedTrack===t.trackNumber,selectedSteps:e.keyboard.selectedPianoRollSteps,patternLocked:i,isCompactMode:e.sequencer.isCompactMode,cursorStep:e.mix.selectedTrack!==t.trackNumber||t.show?-1:e.mix.selectedStep,fills:e.tracks.trackFills[t.trackNumber],stepDatas:e.tracks.trackStepIds[t.trackNumber],stepsSelection:void 0!==p&&p.trackNumber===t.trackNumber?p:void 0,viMode:e.commands.viMode,steps:e.tracks.trackSteps[t.trackNumber],cursorShow:e.mix.selectedTrack===t.trackNumber&&t.sequencerEngine.cursor.show}},function(e,t){return{mouseDown:function(t){return e(Object(O.k)(t))},hideAllEffects:function(t){return e(Object(O.j)())},setTrackFocused:function(){return e(Object(O.Id)(t.trackNumber))},setTrackToFreeze:function(){return e(Object(O.Ud)(t.trackData.subSequence.id,t.trackNumber))},setTrackUnfocused:function(){return e(Object(O.Id)(void 0))},setSelectedPianoRollSteps:function(t){return e(Object(O.Gc)(t))},setStepsSelection:function(t){return e(Object(O.wd)(t))},setSelectorMode:function(t){return e(Object(O.Nc)(t))},setSimilarSoundsToFind:function(t){return e(Object(O.nd)(t))},setSidebarCollapsed:function(t){return e(Object(O.kd)(t))},setSelectedSteps:function(t,n,r){return e(Object(O.Lc)(t,n,r))},setStepNumberDraggingFrom:function(t){return e(Object(O.td)(t))},setStepNumberDraggedTo:function(t){return e(Object(O.sd)(t))},setContextualHelp:function(t){return e(Object(O.U)(t))}}})(ow);function uw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var lw=function(e){Object(u.a)(n,e);var t=uw(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"onPlayClicked",value:function(e){e.target.parentNode.blur(),e.target.blur(),e.currentTarget.blur(),this.props.play(),this.setState(this.state)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{onClick:function(t){return e.onPlayClicked(t)},className:"playpause playpause-user"},a.a.createElement("input",{checked:!this.props.isPlaying,type:"checkbox",value:!this.props.isPlaying,id:"playpause",name:"check"}),a.a.createElement("label",{htmlFor:"playpause playpause-user",tabIndex:1}))}}]),n}(r.Component);function pw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var hw=function(e){Object(u.a)(n,e);var t=pw(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"getProgress",value:function(){var e=this.props.currentGlobalStep%this.props.track.pattern.length()/this.props.track.pattern.length(),t=[];if(this.props.isPlaying||this.props.isPreparingToFreeze||this.props.isResampling)for(var n=0;n<16;n++)e>1*n/16&&t.push(n);return a.a.createElement("div",{className:"frozen-progress"},t.map(function(e){return a.a.createElement("div",{className:"progress-part"})}))}},{key:"expandSample",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.track.sample.getCopy();case 2:t=e.sent,this.props.sequencerEngine.addSound(t);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(e){this.props.setPlaying(!this.props.isPlaying)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",null,a.a.createElement("div",{className:"frozen-container"},a.a.createElement(Wc,{condition:this.props.showPlayButton},a.a.createElement(lw,{play:function(t){return e.play(t)},isPlaying:this.props.isPlaying})),a.a.createElement(Wc,{condition:!this.props.showPlayButton},a.a.createElement("div",{className:"freezing-label"},"Freezing")),this.getProgress()),a.a.createElement(Wc,{condition:this.props.showPlayButton},a.a.createElement("div",{onClick:function(){return e.expandSample()},className:"expand-sample"},"Expand")))}}]),n}(r.Component),fw=Object(g.b)(function(e,t){var n=e.sequencer.sequencerEngine.getSequenceId();e.sequencer.currentStep[n];return{currentGlobalStep:e.sequencer.currentGlobalStep[n]||0,isPlaying:(e.tracks.frozenTracksPlaying[t.track.subSequence.id]||{})[t.track.trackNumber],isPreparingToFreeze:e.tracks.trackToFreeze&&e.tracks.trackToFreeze.trackNumber===t.track.trackNumber,isResampling:e.tracks.isResampling}},function(e,t){return{setPlaying:function(n){return e(Object(O.nb)(t.track.subSequence.id,t.track.trackNumber,n))}}})(hw);function dw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var mw=function(e){Object(u.a)(n,e);var t=dw(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this;if(0===this.props.guildOptions.length&&!this.props.showPublic)return a.a.createElement("div",{className:"guild-options-container"},"You are not a part of any guilds yet. To create one, go ",a.a.createElement("a",{href:"/guilds"},"here"),".");return a.a.createElement("div",{className:"guild-options-container"},"Only members of selected guild will have access",a.a.createElement("div",{className:"guild-options"},a.a.createElement(Wc,{condition:this.props.showPublic},a.a.createElement(vw,{guild:{guildId:0,name:"Public"},onClick:function(){return e.props.onSelectGuild(void 0)},isSelected:void 0===this.props.selectedGuild})),this.props.guildOptions.map(function(t){return a.a.createElement(vw,{guild:t,onClick:function(){return e.props.onSelectGuild(t)},isSelected:e.isSelected(t)})})))}},{key:"isSelected",value:function(e){return void 0===this.props.selectedGuild?0===e.id:this.props.selectedGuild.guildId===e.guildId}}]),n}(r.Component),vw=function(e){Object(u.a)(n,e);var t=dw(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e="guild-option";return this.props.isSelected&&(e+=" selected"),a.a.createElement("div",{onClick:this.props.onClick,className:e},this.props.guild.name)}}]),n}(r.Component),gw=mw;function yw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}r.Component;function bw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var kw=function(e){Object(u.a)(n,e);var t=bw(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"ethereum-explanation"},a.a.createElement("div",{className:"basic-explanation"},"It costs 1 token to save a project, publicly. Projects saved publicly can be viewed by anyone."),a.a.createElement(Wc,{condition:this.props.advanced},"Think of them as stake in the platform, which is run as a cooperative."))}}]),n}(r.Component);function Ew(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Ow=function(e){Object(u.a)(n,e);var t=Ew(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"metamask-instructions"},"To post projects for others to find, follow these steps:",a.a.createElement("ul",null,a.a.createElement("li",null,"First install the ",a.a.createElement("a",{href:"https://chrome.google.com/webstore/detail/metamask/nkbihfbeogaeaoehlefnkodbefgpgknn"},"Metamask")," chrome plug-in."),a.a.createElement("li",null," Create a new account on your Metamask wallet."),a.a.createElement("li",null,' Click on the orange Metamask icon (top-right corner) and switch the network from "Main Ethereum Network" to "Ropsten Test Network".'),a.a.createElement("li",null,"Get some free Ether for  your new account by going ",a.a.createElement("a",{href:"https://faucet.metamask.io/"},"here"),', and clicking "request 1 ether from faucet".')))}}]),n}(r.Component);function Sw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Pw=function(e){Object(u.a)(n,e);var t=Sw(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={nameValue:"",isEffects:!1,guildOptions:[],saveOption:sP,selectedGuild:void 0,guildIds:[]},r.input=void 0,r.onClickDone=r.onClickDone.bind(Object(W.a)(r)),r.onClickCancel=r.onClickCancel.bind(Object(W.a)(r)),r}return Object(c.a)(n,[{key:"getPresetGuilds",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getPresetGuilds"),t=this.props.sequencerEngine.tracks[this.props.trackNumber],e.next=4,t.getGuildIds();case 4:n=e.sent,console.log("get preset guilds returned = ",n),this.setState({guildIds:n});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"shouldComponentUpdate",value:function(e){return e.show&&this.props.show!=e.show&&(this.getGuilds(),this.input&&this.input.focus(),this.getPresetGuilds()),!0}},{key:"getGuilds",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.guilds.getGuildsForUser();case 2:t=e.sent,void 0!==this.props.selectedGuild&&this.setState({saveOption:oP}),this.setState({selectedGuild:this.props.selectedGuild,guildOptions:t});case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onSelectGuild",value:function(e){this.setState({selectedGuild:e})}},{key:"onClickDone",value:function(){this.props.sequencerEngine.saveTrackPreset(this.props.trackNumber,this.state.nameValue,this.state.isEffects,void 0===this.state.selectedGuild?0:this.state.selectedGuild.guildId),this.props.onHide()}},{key:"onClickCancel",value:function(){this.props.onHide()}},{key:"onInputType",value:function(e){this.setState({nameValue:e})}},{key:"handleCheckboxChange",value:function(e){this.setState({isEffects:"track"!==e.target.name})}},{key:"render",value:function(){var e=this;return a.a.createElement(lh.a,{dialogClassName:"preset-modal",show:this.props.show,onHide:this.onClickCancel},a.a.createElement(lh.a.Header,{closeButton:!0},a.a.createElement(lh.a.Title,null,"Save Preset")),a.a.createElement(lh.a.Body,null,a.a.createElement("input",{value:this.state.nameValue,onChange:function(t){return e.onInputType(t.target.value)},ref:function(t){e.input=t},placeholder:"Type name of preset",className:"tag-input"}),a.a.createElement("form",null,a.a.createElement("input",{name:"track",type:"checkbox",checked:!this.state.isEffects,onChange:function(t){return e.handleCheckboxChange(t)}}),a.a.createElement("label",null,"Track"),a.a.createElement("input",{name:"effects",type:"checkbox",checked:this.state.isEffects,onChange:function(t){return e.handleCheckboxChange(t)}}),a.a.createElement("label",null,"Effects")),a.a.createElement(gw,{showPublic:!0,onSelectGuild:function(t){return e.onSelectGuild(t)},selectedGuild:this.state.selectedGuild,guildOptions:this.state.guildOptions})),a.a.createElement(lh.a.Footer,null,a.a.createElement(Ac.b,{variant:"secondary",onClick:this.onClickDone},"Save"),a.a.createElement(Ac.b,{variant:"primary",onClick:this.onClickCancel},"Cancel")))}}]),n}(r.Component),ww=Object(g.b)(function(e){return{selectedGuild:e.guilds.selectedGuild}},function(e){return{setContextualHelp:function(t){return e(Object(O.U)(t))}}})(Pw),jw=n(159);n(2307);function Tw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var xw=function(e){Object(u.a)(n,e);var t=Tw(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"getOptions",value:function(){var e=this.props.midiEngine,t=[{label:"All",value:{type:rs}},{label:"Computer Keyboard",value:{type:"COMPUTER_KEYBOARD"}}],n=e.getInputs().map(function(e){return{label:e.name,value:{type:"CUSTOM",input:e}}});return t.concat(n)}},{key:"getSelectedOption",value:function(){var e=this.props.midiInputs;return this.getOptions().filter(function(t){return t.value.type===e.type&&("CUSTOM"!==e.type||e.accepts(!1,t.value.input.name))})[0]}},{key:"onSelect",value:function(e){"CUSTOM"===e.value.type?this.props.midiInputs.addMidiInput(e.value.input):this.props.midiInputs.setType(e.value.type)}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"TRACK_MIDI_DROPDOWN")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"midi-input-dropdown-container"},a.a.createElement(Vc.a,{className:"midi-input-dropdown",controlClassName:"midi-input-control-dropdown",arrowClassName:"audio-input-arrow-dropdown",options:this.getOptions(),onChange:function(t){return e.onSelect(t)},value:this.getSelectedOption(),placeholder:"Input"}))}}]),n}(r.Component),Cw=Object(g.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(O.U)(t))}}})(xw);function Nw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}r.Component,n(2308);function Rw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}new wt.a;var Dw=function(e){Object(u.a)(n,e);var t=Rw(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={editingName:!1,addingTag:!1,nameValue:"",tagValue:""},r.onClickName=r.onClickName.bind(Object(W.a)(r)),r}return Object(c.a)(n,[{key:"onClickAddTag",value:function(){this.setState({tagValue:"",addingTag:!0})}},{key:"getTagClass",value:function(e){return this.props.track.sample.highlightedTags[e]?"track-tag highlighted":"track-tag"}},{key:"onClickTag",value:function(e){this.props.track.sample.highlightedTags[e]=!this.props.track.sample.highlightedTags[e],this.setState(this.state)}},{key:"onClickName",value:function(){void 0!==this.props.track.sample&&this.props.track.sample.isResampled&&!this.state.editing&&this.setState({nameValue:this.props.track.sample.name,editingName:!0})}},{key:"truncateName",value:function(e){return void 0===e||null===e?null:(e.length>40?e.substring(0,40)+"...":e).trim()}},{key:"onNameKeyDown",value:function(e){"Enter"===e.key&&(this.props.track.sample.name=this.state.nameValue,this.setState({editingName:!1}))}},{key:"onTagKeyDown",value:function(e){"Enter"===e.key&&(console.log("tag value = "+this.state.tagValue),this.props.track.sample.tags.push(this.state.tagValue),this.setState({addingTag:!1}))}},{key:"render",value:function(){var e=this,t=this.props.track.sample,n={};this.props.isSelected&&(n.backgroundColor=this.props.borderColor);var r="track-header";return this.props.track.trackNumber%2===1&&(r+=" odd"),a.a.createElement("div",{style:n,className:r},a.a.createElement("div",{onClick:this.onClickName,style:{},className:"track-name-view"},a.a.createElement(Wc,{condition:this.state.editingName},a.a.createElement("input",{className:"resample-name-input",onKeyDown:function(t){return e.onNameKeyDown(t)},type:"text",nameValue:this.state.nameValue,onChange:function(t){return e.setState({nameValue:t.target.value})}})),a.a.createElement(Wc,{condition:!this.state.editingName},this.truncateName(this.props.track.presetName||this.props.track.getName()))),a.a.createElement("div",{className:"track-tags"},a.a.createElement(Wc,{condition:!window.installation},a.a.createElement(Wc,{condition:this.state.addingTag},a.a.createElement("input",{className:"resample-name-input sample-tag-input",onKeyDown:function(t){return e.onTagKeyDown(t)},type:"text",placeholder:"Type tag",nameValue:this.state.tagValue,onChange:function(t){return e.setState({tagValue:t.target.value})}})),a.a.createElement(Wc,{condition:!this.state.addingTag},a.a.createElement("div",{onClick:function(){return e.onClickAddTag()},className:"add-sample-tag-button"},"+"))),void 0===t||void 0===t.tags?"":t.tags.map(function(t){return a.a.createElement("div",{onClick:function(){return e.onClickTag(t)},key:t,className:e.getTagClass(t)},t)})),a.a.createElement("div",{onClick:this.props.onClickDelete,className:"delete-button delete-track-button"},"x"))}}]),n}(r.Component);function qw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Mw=function(e){Object(u.a)(n,e);var t=qw(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={height:0,referenceHeight:r.fromDecibel(0)},r}return Object(c.a)(n,[{key:"fromDecibel",value:function(e){return.8*Math.pow(10,e/20)*58}},{key:"componentDidMount",value:function(){var e=this;this.timer=setInterval(function(){var t=e.props.meter.getLevel();e.setState({isRed:t>0,height:Math.min(60,e.fromDecibel(t))})},100)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"render",value:function(){var e={height:this.state.height},t={height:this.state.referenceHeight},n="track-meter-value";return this.state.isRed&&(n+=" is-red"),a.a.createElement("div",{className:"track-meter"},a.a.createElement("div",{className:n,style:e}),a.a.createElement("div",{className:"track-meter-reference",style:t}))}}]),n}(r.Component);n(925);function Aw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Iw=new wt.a,Lw=function(e){Object(u.a)(n,e);var t=Aw(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"onToggleClicked",value:function(){this.props.trackData.toggleEnabled(),this.setState(this.state)}},{key:"onMuteClicked",value:function(){var e,t;this.props.sequencerEngine.operationManager.dispatch((e=this.props.trackData,t=!this.props.muted,{type:"UPDATE_TRACK_MUTE",payload:{track:e,mute:t}})),this.setState(this.state)}},{key:"onSoloClicked",value:function(){this.props.trackData.solo(!this.props.solo)}},{key:"onChangeVolume",value:function(e){}},{key:"onChangeVolume",value:function(e){void 0!==e&&(e=parseFloat(e),this.props.trackData.setVolume(e),this.setState(this.state))}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(e),this.props.setContextualHelp(t)}},{key:"render",value:function(){var e=this,t=1==this.props.triggering?" flashit ":"",n=this.props.muted?t+"mute-button muted":t+"mute-button";this.props.isCompactMode&&(n+=" compact");var r={backgroundColor:Iw.getColorForTrack(this.props.trackData)};return a.a.createElement("div",{className:"track-controls"},a.a.createElement("div",{className:"volume-container"},a.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"TRACK_MUTE_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:n,style:r,onClick:function(){return e.onMuteClicked()}},this.props.trackNumber+1),a.a.createElement("div",{onClick:function(){return e.onSoloClicked()},onMouseOver:function(t){return e.setContextualHelp(t,"TRACK_SOLO_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:this.props.solo?"track-solo-button on":"track-solo-button off"},"S"),a.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"TRACK_RECORD_ARM_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onToggleClicked()},className:this.props.isEnabled?"midi-recording-button on":"midi-recording-button off"},a.a.createElement("span",{className:"black plain-dot"}))),a.a.createElement(Wc,{condition:!this.props.isCompactMode},this.props.isSelectedTrack?a.a.createElement(Mw,{meter:this.props.trackData.trackMeter}):a.a.createElement("div",{className:"ghost-meter"})))}}]),n}(r.Component),Fw=Object(g.b)(function(e,t){var n=e.tracks.trackVolumes[t.trackNumber],r=e.tracks.trackMutes[t.trackNumber],a=e.tracks.trackSolos[t.trackNumber],i=(e.tracks.trackIsEnabled[t.trackData.subSequence.id]||{})[t.trackNumber],s=e.tracks.triggers[t.trackNumber];return{triggering:void 0!==s&&Object.keys(s).some(function(e){return!0===s[e]}),volume:void 0===n?0:n,muted:void 0!==r&&r,solo:void 0!==a&&a,isEnabled:void 0!==i&&i,isCompactMode:e.sequencer.isCompactMode}},function(e,t){return{setContextualHelp:function(t){return e(Object(O.U)(t))}}})(Lw);function Bw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Hw=function(e){Object(u.a)(n,e);var t=Bw(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"getEventX",value:function(){this.props.event.time;var e=this.props.event.step;return this.props.width*(e/this.props.length)}},{key:"getValue",value:function(){var e=this.props.event.getValue();return console.log("value = "+e),e}},{key:"render",value:function(){return a.a.createElement(Sc.Group,null,a.a.createElement(Sc.Rect,{x:this.getEventX(),y:this.getValue(),height:2,width:2,fill:"white"}))}}]),n}(r.Component);n(2309);function Vw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}r.Component,n(524);function Uw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Jw=function(e){Object(u.a)(n,e);var t=Uw(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"details-banner"},a.a.createElement("div",{className:"banner-back-button",onClick:this.props.onClickBack},"BACK"),a.a.createElement("div",{className:"banner-heading"},this.props.headerText))}}]),n}(r.Component);function _w(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Gw=new wt.a,zw=function(e){Object(u.a)(n,e);var t=_w(n);function n(e){var r;Object(o.a)(this,n);(r=t.call(this,e)).effects.every(function(e){return!e.isEnabled()});return r.state={selectedStep:0,recording:!1,soundId:e.soundId,showSavePresetModal:!1},void 0!==r.props.name&&(r.state.name=r.props.name,r.state.videoId=""),r.sample=new Dn.a(e.soundId),r.props.soundId in r.props.samples&&r.sample.fromJson(r.props.samples[r.props.soundId]),r.ref=a.a.createRef(),r.lastClick=void 0,r.selectStep=r.selectStep.bind(Object(W.a)(r)),r.onEffectsChange=r.onEffectsChange.bind(Object(W.a)(r)),r}return Object(c.a)(n,[{key:"selectStep",value:function(e){this.props.sequencerEngine.select(this.props.trackData,e)}},{key:"onEffectsChange",value:function(){this.props.trackData.updateEffects()}},{key:"onClickShowEffects",value:function(){this.props.setShowEffects(!this.props.showEffects)}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"shouldComponentUpdate",value:function(e){return void 0===this.sample.name&&this.props.soundId in e.samples&&void 0!==e.samples[e.soundId]&&this.sample.fromJson(e.samples[e.soundId]),this.props.soundId!=e.soundId&&void 0!==e.samples[e.soundId]&&this.sample.fromJson(e.samples[e.soundId]),!0}},{key:"onClickStep",value:function(e){this.props.onClick(e)}},{key:"toggleHide",value:function(){this.state.hideTrack=!this.state.hideTrack,this.setState(this.state)}},{key:"record",value:function(){this.props.trackPreparingToRecord(this.props.trackNumber,!0),this.props.sequencerEngine.recordTrack(this.props.trackNumber),this.setState(this.state)}},{key:"onAnnotationsMouseMove",value:function(e){var t=this.props.sequencerEngine.store.getState().tracks.annotationDragging;if(t){var n=this.ref.current.getBoundingClientRect(),r=e.clientX-n.left,a=e.clientY-n.top;t.x=r,t.y=a,this.setState(this.state)}}},{key:"onAnnotationsMouseUp",value:function(e){if(this.props.sequencerEngine.store.getState().keyboard.isCommandDown){var t=e.target.getBoundingClientRect();e.clientX,t.left,e.clientY,t.top;this.setState(this.state)}this.props.setAnnotationDragging(void 0)}},{key:"onMouseUp",value:function(e){this.props.mouseDown(!1),this.updateSelectedSteps(),this.props.setStepsSelection(void 0),this.props.setStepNumberDraggingFrom(void 0)}},{key:"deleteAnnotation",value:function(e){this.props.track.deleteAnnotation(e),this.setState(this.state)}},{key:"makeInstrumentRack",value:function(){this.props.setTrackToConvert(this.props.track)}},{key:"updateSelectedSteps",value:function(){var e=this.props.sequencerEngine.store.getState().steps.stepsSelection;if(void 0!==e&&e.toStep-e.fromStep>0){var t=this.props.trackData.getEasyPattern().getSelectedSteps(e,this.props.resolution);this.props.setSelectedPianoRollSteps(t)}}},{key:"onClickFocus",value:function(){this.props.disablePianoRoll||(this.props.isTrackFocused?(this.props.setTrackUnfocused(),this.props.setSelectedPianoRollSteps(void 0)):this.props.setTrackFocused())}},{key:"doneAudition",value:function(){this.props.trackData.completeAudition(),this.setState(this.state)}},{key:"cancelAudition",value:function(){this.props.trackData.cancelAudition(),this.setState(this.state)}},{key:"onClickTrack",value:function(){void 0!==this.lastClick&&((new Date).getTime(),this.lastClick),this.lastClick=(new Date).getTime(),this.props.setSelectedEffect(void 0),this.props.isSelectedTrack||this.props.sequencerEngine.selectTrack(this.props.trackData.trackNumber)}},{key:"savePreset",value:function(){this.setState({showSavePresetModal:!0})}},{key:"hideSavePresetModal",value:function(){this.setState({showSavePresetModal:!1})}},{key:"onDrop",value:function(){var e=Object(R.a)(N.a.mark(function e(t){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.props.sampleDragging?(t.stopPropagation(),this.props.sequencerEngine.auditionSound(this.props.sampleDragging,this.props.trackNumber),this.props.setSampleDragging(void 0)):this.props.presetDragging&&(t.stopPropagation(),this.props.sequencerEngine.auditionPreset(this.props.presetDragging,this.props.trackNumber),this.props.setPresetDragging(void 0));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"freezeTrack",value:function(){this.props.isTrackFrozen?this.props.trackData.unfreeze():(this.props.hideAllEffects(),this.props.setTrackToFreeze())}},{key:"duplicateTrack",value:function(){this.props.sequencerEngine.duplicateTrack(this.props.trackNumber)}},{key:"similarSounds",value:function(){this.props.setSimilarSoundsToFind(this.props.trackData.sample.getId()),this.props.setSelectorMode(!0),this.props.setSidebarCollapsed(!1),window.dispatchEvent(new Event("SIMILAR_SOUNDS"))}},{key:"getFrozenButton",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return a.a.createElement(fw,{sequencerEngine:this.props.sequencerEngine,showPlayButton:e,track:this.props.track})}},{key:"deleteLocks",value:function(){this.props.trackData.deletePatternLocks()}},{key:"render",value:function(){var e=this;this.state.soundId!=this.props.soundId&&(this.state.soundId=this.props.soundId);var t=this.props.isCompactMode?"effects-section compact":"effects-section",n=this.props.isCompactMode?"track-icons-container compact":"track-icons-container",r=this.props.track,i=void 0!==this.sample&&void 0!==this.sample.getId()?this.sample.getId():this.props.track.getName(),s=Gw.brighten("#082435",.5),o=Gw.brighten(void 0===i?s:Gw.getColorForTrack(r),.64);if(!this.props.isTrackFocused&&this.props.isSelectedTrack&&(s=Gw.saturate(Gw.getColorForTrack(this.props.track),.7)),this.state.hideTrack)return a.a.createElement("div",{className:"track"},a.a.createElement("div",{onClick:function(){return e.toggleHide()},className:"effects-section show-track"},"SHOW TRACK"));if(this.props.isTrackFocused)return a.a.createElement("div",{className:"track"},a.a.createElement(Jw,{headerText:this.props.trackData.getName(),onClickBack:function(){return e.props.setTrackUnfocused()}}),a.a.createElement(Og,{track:r,sequencerEngine:this.props.sequencerEngine}),a.a.createElement(Qy,{color:o,isLooping:!0,sequencerEngine:this.props.sequencerEngine,track:this.props.trackData}));var c,u="track";this.props.trackNumber%2===1&&(u+=" odd"),void 0===i&&(i="");return!this.props.isTrackFocused&&this.props.isSelectedTrack&&(u+=" selected"),this.props.isCompactMode&&(u+=" compact"),a.a.createElement("div",null,a.a.createElement(Wc,{condition:this.props.isConvertingTrack},a.a.createElement(DP,{show:this.props.isConvertingTrack,track:r,onClickDone:function(){e.props.setTrackToConvert(void 0),r.convertToInstrumentRack()},onClickCancel:function(){return e.props.setTrackToConvert(void 0)}})),a.a.createElement(ww,{sequencerEngine:this.props.sequencerEngine,trackNumber:this.props.trackNumber,show:this.state.showSavePresetModal,onHide:function(){return e.hideSavePresetModal()}}),a.a.createElement(jw.a,{id:"track-context-"+this.props.trackNumber},a.a.createElement(jw.c,{data:{foo:"bar"},onClick:function(){return e.savePreset()}},"Save Preset"),a.a.createElement(jw.c,{data:{foo:"bar"},onClick:function(){return e.makeInstrumentRack()}},"Make Instrument Rack"),a.a.createElement(jw.c,{data:{foo:"bar"},onClick:function(){return e.freezeTrack()}},this.props.isTrackFrozen?"Unfreeze":"Freeze"),a.a.createElement(jw.c,{data:{foo:"bar"},onClick:function(){return e.duplicateTrack()}},"Duplicate"),a.a.createElement(jw.c,{data:{foo:"bar"},onClick:function(){return e.deleteLocks()}},"Delete Locks")),a.a.createElement(jw.b,{holdToDisplay:-1,id:"track-context-"+this.props.trackNumber},a.a.createElement("div",{onDrop:function(t){return e.onDrop(t)},key:"track-"+this.props.trackNumber,style:{},onMouseUp:function(t){return e.onMouseUp(t)},onClick:function(){return e.onClickTrack()},className:u},a.a.createElement(Dw,{isSelected:this.props.isSelectedTrack,borderColor:s,trackColor:o,onClickDelete:this.props.onClickDelete,track:this.props.trackData,sequencerEngine:this.props.sequencerEngine}),a.a.createElement("div",{className:"track-inner"},a.a.createElement("a",{name:"track-"+(this.props.trackNumber+1)}),a.a.createElement(Wc,{condition:!0},a.a.createElement("div",{className:"unselected youtube-container"},a.a.createElement(Ok,{track:this.props.track,showTags:!this.props.isCompactMode,hideName:!0,name:this.props.trackData.getName(),sample:this.sample,onClickName:function(){return[]},onClickThumbnail:function(){return e.props.onClickName()},videoId:this.props.trackData.videoId},a.a.createElement(Wc,{condition:!this.props.isCompactMode},a.a.createElement(Cw,{midiInputs:r.midiInputs,midiEngine:this.props.sequencerEngine.midi})),this.props.track.getTrackType()===zr.a||this.props.track.getTrackType()===zr.d?a.a.createElement(Ww,{track:this.props.track}):"",this.props.track.getTrackType()!==zr.e||this.props.isCompactMode?"":a.a.createElement(Ef,{track:this.props.track}),a.a.createElement(qP,{sequencerEngine:this.props.sequencerEngine,track:this.props.track})))),a.a.createElement(Fw,{sequencerEngine:this.props.sequencerEngine,isSelectedTrack:this.props.isSelectedTrack,installation:this.props.installation,trackNumber:this.props.trackNumber,trackData:this.props.trackData}),this.props.showEffects?a.a.createElement(og.EffectsView,(c={sequencerEngine:this.props.sequencerEngine,onEffectsChange:this.onEffectsChange,installation:!0},Object(An.a)(c,"sequencerEngine",this.props.sequencerEngine),Object(An.a)(c,"store",this.props.sequencerEngine.store),Object(An.a)(c,"tracks",this.props.sequencerEngine.tracks),Object(An.a)(c,"onParameterChanged",function(e){return[]}),Object(An.a)(c,"sends",this.props.sends),Object(An.a)(c,"track",this.props.trackData),c)):this.props.isTrackFrozen?this.getFrozenButton():this.props.isPreparingToFreeze||this.props.isResampling?this.getFrozenButton(!1):a.a.createElement(cw,Object.assign({},this.props,{selectStep:this.selectStep,trackColor:o,sample:this.sample,onUpdateStepData:this.props.onUpdateStepData,updateSelectedSteps:function(){return e.updateSelectedSteps()},track:this.props.track})),a.a.createElement("div",{onMouseUp:function(t){return e.onAnnotationsMouseUp(t)},onMouseMove:function(t){return e.onAnnotationsMouseMove(t)},ref:this.ref,className:this.props.isCompactMode?"track-right-buttons compact":"track-right-buttons"},a.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"TRACK_EFFECTS_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onClickShowEffects()},className:t},this.state.showEffects?"BACK":"FX"),a.a.createElement("div",{className:n}))))))}},{key:"isAlternateColor",value:function(e,t,n){return Math.ceil((e+1)/t)%2!=0}},{key:"effects",get:function(){return this.props.trackData.effectsChains[0].effects}}]),n}(r.Component),Ww=function(e){Object(u.a)(n,e);var t=_w(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"getOptions",value:function(){var e=[{value:"none",label:"None"}];return void 0!==this.props.track.audioInputManager&&this.props.track.audioInputManager.getInputChannels().forEach(function(t){return e.push({value:t,label:t})}),e}},{key:"getChannelOption",value:function(e){for(var t=this.getOptions(),n=0;n<t.length;n++)if(t[n].value==e)return t[n];return null}},{key:"getSelectedChannel",value:function(){return this.props.track.audioInputChannel}},{key:"onSelectChannel",value:function(e){var t="none"===e.value?void 0:e.value;this.props.track.setAudioInput(t),this.setState(this.state)}},{key:"render",value:function(){var e=this;this.props.track.audioInputManager;return a.a.createElement("div",{className:"audio-input-dropdown-container"},a.a.createElement(Vc.a,{className:"audio-input-dropdown",controlClassName:"audio-input-control-dropdown",arrowClassName:"audio-input-arrow-dropdown",options:this.getOptions(),onChange:function(t){return e.onSelectChannel(t)},value:this.getChannelOption(this.getSelectedChannel()),placeholder:"Input"}))}}]),n}(r.Component),Kw=(r.Component,Object(g.b)(function(e,t){var n=t.sequencerEngine.getSequenceId(),r=(e.sequencer.currentStep[n],e.sequencer.currentGlobalStep[n],e.tracks.trackSteps[t.trackData.subSequence.isTrack?t.trackData.subSequence.id:t.trackNumber],((e.tracks.trackPatternLocks[t.trackData.subSequence.id]||{})[t.trackNumber]||{})[t.trackData.currentPattern],(e.tracks.tracksFrozen[t.trackData.subSequence.id]||{})[t.trackNumber]),a=t.track,i=a;return a&&a.tracks&&a.tracks[0]&&(i=a.tracks[0].track),{id:void 0!==i.sample&&void 0!==i.sample.getId()?i.sample.getId():i.presetName||i.getName(),resolution:e.sequencer.resolution,isTrackFrozen:r,isPreparingToFreeze:e.tracks.trackToFreeze&&e.tracks.trackToFreeze.trackNumber===t.track.trackNumber,isResampling:e.tracks.isResampling===t.track.trackNumber,samples:e.samples,isSelectedTrack:e.mix.selectedTrack===t.trackNumber,isTrackFocused:e.sequencer.trackFocused===t.trackNumber,isCompactMode:e.sequencer.isCompactMode,showAutomatggions:"RECORD"===e.sequencer.automationMode,sampleDragging:e.selector.sampleDragging,presetDragging:e.presets.presetDragging,showEffects:e.tracks.showTrackEffects[t.trackNumber],isConvertingTrack:e.tracks.trackToConvert===t.track}},function(e,t){return{mouseDown:function(t){return e(Object(O.k)(t))},hideAllEffects:function(t){return e(Object(O.j)())},setTrackFocused:function(){return e(Object(O.Id)(t.trackNumber))},setTrackToFreeze:function(){return e(Object(O.Ud)(t.trackData.subSequence.id,t.trackNumber))},setTrackUnfocused:function(){return e(Object(O.Id)(void 0))},trackPreparingToRecord:function(t,n){return e(Object(O.je)(t,n))},setSelectedPianoRollSteps:function(t){return e(Object(O.Gc)(t))},setStepsSelection:function(t){return e(Object(O.wd)(t))},setSelectedEffect:function(t){return e(Object(O.Ac)(t))},setSelectorMode:function(t){return e(Object(O.Nc)(t))},setSimilarSoundsToFind:function(t){return e(Object(O.nd)(t))},setSidebarCollapsed:function(t){return e(Object(O.kd)(t))},setSelectedSteps:function(t){return e(Object(O.Gc)(t))},setStepNumberDraggingFrom:function(t){return e(Object(O.td)(t))},setShowEffects:function(n){return e(Object(O.jd)(t.trackNumber,n))},setContextualHelp:function(t){return e(Object(O.U)(t))},setStepNumberDraggedTo:function(t){return e(Object(O.sd)(t))},setSampleDragging:function(t){return e(Object(O.wc)(t))},setPresetDragging:function(t){return e(Object(O.mc)(t))},setAnnotationDragging:function(t){return e(Object(O.u)(t))},setTrackToConvert:function(t){return e(Object(O.Td)(t))}}})(zw));function Qw(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Xw=function(e){Object(u.a)(n,e);var t=Qw(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"render",value:function(){var e=this;this.props.trackData.getTrackType(),this.props.trackData;return a.a.createElement(Kw,{sequencerEngine:this.props.sequencerEngine,selectStep:function(t){return e.props.selectStep(t)},cursor:this.props.cursor,soundId:this.props.soundId,selectedParameterStep:this.props.selectedParameterStep,onEffectsChange:this.props.onEffectsChange,onLoadTrackUrl:this.props.onLoadTrackUrl,volume:this.props.volume,trackData:this.props.trackData,track:this.props.trackData,onUpdateStepData:this.props.onUpdateStepData,muted:this.props.muted,onClickTrack:this.props.onClickTrack,sends:this.props.sends,onClickName:this.props.onClickName,onChangeVolume:this.props.onChangeVolume,installation:!0,steps:this.props.steps,disablePianoRoll:this.props.disablePianoRoll,trackNumber:this.props.trackNumber,onClickDelete:this.props.onClickDelete,onUpdateStepDuration:this.props.onUpdateStepDuration,onClickAddSteps:this.props.onClickAddSteps,onClickRemoveSteps:this.props.onClickRemoveSteps,onClick:this.props.onClick})}}]),n}(r.Component);n(525);var Yw=Object(g.b)(function(e,t){return{effectDragging:e.sequencer.effectDragging,isSelected:e.effects.selectedSendEffect===t.effect}},function(e,t){return{dragEffect:function(t){return e(Object(O.e)(t))},setSelectedSendEffect:function(t){return e(Object(O.Jc)(t))}}})(function(e){var t=Object(r.useCallback)(function(t){e.dragEffect({effectNumber:e.effectNumber})},[e.effectNumber]),n=Object(r.useCallback)(function(t){if(void 0!==e.effectDragging){var n=e.effectDragging.effectNumber;e.moveEffectTo(n,e.effectNumber)}},[e.effectNumber,e.effectDragging]),i=Object(r.useCallback)(function(t){e.setSelectedSendEffect(e.isSelected?void 0:e.effect)},[e.isSelected,e.effect]),s="send-effect";return e.isSelected&&(s+=" selected"),a.a.createElement("div",{onClick:i,onDragOver:function(e){e.preventDefault()},onDrop:n,onDragStart:t,draggable:!0,className:s},e.effect.name)}),Zw=Object(g.b)(function(e,t){return{effects:t.send.effects}},null)(function(e){var t=Object(r.useState)(void 0),n=Object(j.a)(t,2),i=(n[0],n[1]),s=e.send.effects,o=Object(r.useCallback)(function(t){var n=jp(t.value,e.sequencerEngine);return n.enable(!0),n.wetParameter&&n.wetParameter.set(1),e.send.addEffect(n),i(t.value),!1},[i,e.sequencerEngine]),c=Object(r.useCallback)(function(t,n){e.send.moveEffectTo(t,n),i({from:t,to:n})},[i,e.send]);return a.a.createElement("div",{className:"send"},a.a.createElement("div",{className:"send-name"},e.send.name),s.map(function(e,t){return a.a.createElement(Yw,{moveEffectTo:c,effectNumber:t,effect:e})}),a.a.createElement(Vc.a,{className:"send-effects-dropdown",options:wp,onChange:o,placeholder:"FX"}))});var $w=Object(g.b)(function(e,t){return{selectedEffect:e.effects.selectedSendEffect}},function(e,t){return{setSelectedSendEffect:function(t){return e(Object(O.Jc)(t))}}})(function(e){var t=Object(r.useState)(e.sequencerEngine.sends.sends),n=Object(j.a)(t,2),i=n[0],s=n[1],o=Object(r.useCallback)(function(){e.setSelectedSendEffect(void 0)},[]),c="";if(e.selectedEffect){var u=i.find(function(t){return t.effects.indexOf(e.selectedEffect)>-1});c=a.a.createElement(og.EffectComponent,{sequencerEngine:e.sequencerEngine,onDeleteEffect:function(){return o()},effect:e.selectedEffect,send:u})}var l=Object(r.useCallback)(function(){e.sequencerEngine.sends.createNewSend(),s(Object(M.a)(e.sequencerEngine.sends.sends))},[s]);return a.a.createElement("div",{className:"track sends"},a.a.createElement("div",{className:"track-header"},a.a.createElement("div",{className:"track-name-view"},"Sends")),a.a.createElement("div",{className:"sends-container"},i.map(function(t){return a.a.createElement(Zw,{sequencerEngine:e.sequencerEngine,send:t})}),c,a.a.createElement("div",{onClick:l,className:"new-send-button"},"New Send")))});function ej(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var tj=new wt.a,nj=function(e){Object(u.a)(n,e);var t=ej(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"getName",value:function(){var e=this.props.selectedTrack.getName();return void 0===e?"":e.length>20?e.slice(0,20)+"...":e}},{key:"render",value:function(){var e=this,t=this.props.group.tracks,n=80/t.length;return a.a.createElement("div",{className:"group-thumbnail-container"},a.a.createElement("div",{className:"group-thumbnail"},t.map(function(t){return a.a.createElement(rj,{isSelected:e.props.group.tracks.length>1&&t==e.props.selectedTrack,onClick:function(){return e.props.onSelectTrack(t)},width:n,track:t})})),void 0!==this.props.selectedTrack?a.a.createElement("div",{className:"youtube-name"},this.getName()):"",a.a.createElement(Wc,{condition:this.tags.length>0},a.a.createElement("div",{className:"tags-container"},this.tags.map(function(e){return a.a.createElement(Ac.a,{color:"dark"},e)}))))}},{key:"tags",get:function(){return this.props.selectedTrack&&void 0!==this.props.selectedTrack.sample?this.props.selectedTrack.sample.tags:this.props.group.tags}}]),n}(r.Component),rj=function(e){Object(u.a)(n,e);var t=ej(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"getColor",value:function(){var e=this.props.track;return e.getTrackType()===zr.e?tj.getColorForHash(e.sample.getId()):tj.getcolorForHash(e.getName())}},{key:"render",value:function(){var e,t=this.props.track,n={width:this.props.width},r=this.props.isSelected?"selected group-part-wrapper":"group-part-wrapper";if(t.getTrackType()===zr.e){var i=t.sample;if(i.videoId){var s=""===(e=i.videoId)||void 0===e?"":"https://img.youtube.com/vi/"+e+"/1.jpg";return a.a.createElement("div",{className:r+" group-part-wrapper"},a.a.createElement("img",{className:"group-part-thumbnail",onClick:this.props.onClick,src:s,style:n}),a.a.createElement("div",{className:"part-footer",style:{backgroundColor:this.getColor()}}))}return n.backgroundColor=tj.getColorForHash(i.getId()),a.a.createElement("div",{className:r,onClick:this.props.onClick,style:n})}return n.backgroundColor=tj.getColorForHash(t.getName()),a.a.createElement("div",{className:r,onClick:this.props.onClick,style:n})}}]),n}(r.Component),aj=nj;function ij(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var sj=function(e){Object(u.a)(n,e);var t=ij(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"onMuteClicked",value:function(){this.props.group.mute(!this.props.muted),this.setState(this.state)}},{key:"onSoloClicked",value:function(){this.props.group.solo=!this.props.group.solo,this.setState(this.state)}},{key:"onChangeVolume",value:function(e){void 0!==e&&(e=parseFloat(e),this.props.group.setVolume(e),this.setState(this.state))}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(e),this.props.setContextualHelp(t)}},{key:"render",value:function(){var e=this,t=1==this.props.triggering?" flashit ":"",n=this.props.muted?t+"mute-button muted":t+"mute-button";return this.props.isCompactMode&&(n+=" compact"),a.a.createElement("div",{className:"track-controls"},a.a.createElement("div",{className:"volume-container"},a.a.createElement(Wc,{condition:!this.props.isCompactMode},a.a.createElement(xt.a,{value:this.props.group.volume,change:function(t){return e.onChangeVolume(t.target.value)},step:.1,max:128,min:0,orientation:"vertical",reversed:!0})),a.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"TRACK_MUTE_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:n,onClick:function(){return e.onMuteClicked()}},this.props.groupNumber+1),a.a.createElement("div",{onClick:function(){return e.onSoloClicked()},onMouseOver:function(t){return e.setContextualHelp(t,"TRACK_SOLO_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:this.props.group.solo?"track-solo-button on":"track-solo-button off"},"S")))}}]),n}(r.Component),oj=Object(g.b)(function(e,t){var n=t.group.volume,r=t.group.muted;return{triggering:!1,volume:void 0===n?0:n,muted:void 0!==r&&r,solo:!1,isCompactMode:e.sequencer.isCompactMode}},function(e,t){return{setContextualHelp:function(t){return e(Object(O.U)(t))}}})(sj);n(2310);function cj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var uj=new wt.a,lj=function(e){Object(u.a)(n,e);var t=cj(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={selectedTrack:void 0},r}return Object(c.a)(n,[{key:"onSelectTrack",value:function(e){this.selectedTrack!==e?this.setState({selectedTrack:e}):this.setState({selectedTrack:void 0})}},{key:"onClickShowEffects",value:function(){this.props.setShowEffects(!this.props.showEffects)}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"onClickStep",value:function(e,t,n){e===this.props.selectedParameterStep&&this.props.cursor.show||(n.on?this.props.onClickStep(e,t):(t=this.selectedTrack||t,this.props.onClickStep(e,t)))}},{key:"onClickLock",value:function(){}},{key:"onClickGroup",value:function(){}},{key:"renderFills",value:function(){this.setState(this.state)}},{key:"savePreset",value:function(){this.props.sequencerEngine.saveTrackPreset(this.props.trackNumber)}},{key:"deleteTrack",value:function(){this.props.onClickDelete()}},{key:"duplicateTrack",value:function(){this.props.sequencerEngine.duplicateTrack(this.props.trackNumber)}},{key:"mergeSteps",value:function(e,t,n){for(var r in t)for(var a in t[r]){var i=t[r][a];i.step.on&&void 0!==e[r]&&void 0!==e[r][a]&&(e[r][a]={track:n,step:i.step,stepNumber:i.stepNumber})}return e}},{key:"getStepsLength",value:function(e){var t=0;for(var n in e)t+=e[n].length;return t}},{key:"printSteps",value:function(e){var t=[];for(var n in e)for(var r in e[n])t.push(e[n][r].stepNumber);console.log(t)}},{key:"normalizeStepsLength",value:function(e){var t=0;for(var n in e)for(var r in e[n])e[n][r]={step:e[n][r],stepNumber:t++};var a=rw(this.props.resolution);for(e[0].length;e[0].length<a&&this.getStepsLength(e)<this.props.stepsLength;)e[0]=e[0].concat(e[0]);for(;this.getStepsLength(e)<this.props.stepsLength;)e=e.concat(e);return e}},{key:"getSteps",value:function(){var e=void 0;for(var t in this.tracks){var n=this.tracks[t],r=nw(n,this.props.resolution);if(r=this.normalizeStepsLength(r),void 0===e){for(var a in r)for(var i in r[a])r[a][i]={track:n,step:r[a][i].step,stepNumber:r[a][i].stepNumber};e=r}else e=this.mergeSteps(e,r,n)}return e}},{key:"getColor",value:function(){var e=this.selectedTrack||this.tracks[0];return e.getTrackType()===zr.e?uj.getColorForHash(e.sample.getId()):uj.getColorForHash(e.getName())}},{key:"onClickAddSteps",value:function(){this.selectedTrack?this.selectedTrack.doubleTrackLength():this.props.group.tracks.forEach(function(e){return e.doubleTrackLength()})}},{key:"onClickRemoveSteps",value:function(){this.selectedTrack?this.selectedTrack.halfTrackLength():this.props.group.tracks.forEach(function(e){return e.halfTrackLength()})}},{key:"render",value:function(){var e,t=this,n=this.props.isCompactMode?"effects-section compact":"effects-section",r=this.props.isCompactMode?"track-footer-container compact":"track-footer-container",i=(this.props.isCompactMode,this.getSteps()),s=rw(this.props.resolution),o=UP(this.props.resolution),c={};return this.props.selectedGroup===this.props.group&&(c.borderColor=uj.brighten(this.getColor(),.7)),a.a.createElement("div",null,a.a.createElement("div",{style:c,onClick:function(){return t.props.setSelectedGroup(t.props.group)},onMouseOver:function(e){return t.setContextualHelp(e,"TRACK")},onMouseLeave:function(){return t.props.setContextualHelp(void 0)},className:"group-component",key:"group-"+this.props.groupNumber},a.a.createElement("a",{name:"group-"+(this.props.groupNumber+1)}),a.a.createElement("div",{className:"unselected youtube-container"},a.a.createElement(aj,{selectedTrack:this.selectedTrack,onSelectTrack:function(e){return t.onSelectTrack(e)},group:this.props.group})),a.a.createElement(Wc,{condition:void 0!==this.selectedTrack},a.a.createElement(Fw,{trackNumber:this.selectedTrack?this.selectedTrack.trackNumber:0,trackData:this.selectedTrack})),a.a.createElement(Wc,{condition:void 0===this.selectedTrack},a.a.createElement(oj,{groupNumber:this.props.groupNumber,group:this.props.group})),a.a.createElement(Wc,{condition:this.props.showEffects},a.a.createElement(og.EffectsView,(e={sequencerEngine:this.props.sequencerEngine,onEffectsChange:this.props.onEffectsChange},Object(An.a)(e,"sequencerEngine",this.props.sequencerEngine),Object(An.a)(e,"store",this.props.sequencerEngine.store),Object(An.a)(e,"tracks",this.props.sequencerEngine.tracks),Object(An.a)(e,"onParameterChanged",function(e){return[]}),Object(An.a)(e,"panning",this.props.panning),Object(An.a)(e,"onChangePanning",this.props.onChangePanning),Object(An.a)(e,"sends",this.props.sends),Object(An.a)(e,"track",this.selectedTrack),Object(An.a)(e,"group",this.selectedTrack?void 0:this.props.group),e))),a.a.createElement(Wc,{condition:!this.props.showEffects},a.a.createElement("div",{className:"steps-container"},i.map(function(e,n){return a.a.createElement("div",{className:"steps-row"},e.map(function(e,r){return a.a.createElement(tw,{sample:e.track.sample,renderFills:function(){return t.renderFills()},sequencerEngine:t.props.sequencerEngine,effectToShow:t.state.effectToShow,onEffectToShowChanged:function(e){return t.onEffectToShowChanged(e)},isMidi:t.props.isMidiTrack,trackNumber:e.track.trackNumber,resolution:t.props.resolution,rawStepNumber:s*n+r,stepNumber:e.stepNumber,isGroup:!0,stepsLength:t.props.stepsLength,show:t.props.show,showParameters:t.props.selectedParameterStep==s*n+r&&t.props.showParameters,trackData:e.track,onUpdateStepDuration:function(a){return t.props.onUpdateStepDuration(e.track,s*n+r,a)},onUpdateStepData:function(a){return t.props.onUpdateStepData(e.track,a,s*n+r)},isAlternateColor:t.isAlternateColor(r,o,t.props.resolution),slices:0,track:e.track,onClick:function(){return t.onClickStep(e.stepNumber,e.track,e.step)}})}))}),a.a.createElement("div",null,a.a.createElement("div",{className:r},a.a.createElement("div",{onMouseOver:function(e){return t.setContextualHelp(e,"TRACK_ADD_STEPS_BUTTON")},onMouseLeave:function(e){return t.props.setContextualHelp(void 0)},onClick:function(){return t.onClickAddSteps()},className:"add-steps-button"},"+"),a.a.createElement("div",{onMouseOver:function(e){return t.setContextualHelp(e,"TRACK_REMOVE_STEPS_BUTTON")},onMouseLeave:function(){return t.props.setContextualHelp(void 0)},onClick:function(){return t.onClickRemoveSteps()},className:"remove-steps-button"},"-"))))),a.a.createElement("div",{className:this.props.isCompactMode?"track-right-buttons compact":"track-right-buttons"},a.a.createElement(Wc,{condition:!this.props.isTrackFocused},a.a.createElement("div",{onMouseOver:function(e){return t.setContextualHelp(e,"TRACK_EFFECTS_BUTTON")},onMouseLeave:function(){return t.props.setContextualHelp(void 0)},onClick:function(){return t.onClickShowEffects()},className:n},this.state.showEffects?"BACK":"FX")))))}},{key:"isAlternateColor",value:function(e,t,n){return Math.ceil((e+1)/t)%2!=0}},{key:"selectedTrack",get:function(){return 1===this.tracks.length?this.tracks[0]:this.state.selectedTrack}},{key:"tracks",get:function(){return this.state.selectedTrack?[this.state.selectedTrack]:this.props.group.tracks}}]),n}(r.Component),pj=(Object(g.b)(function(e,t){var n=-1,r=0;for(var a in t.group.tracks){var i=t.group.tracks[a],s=e.tracks.trackSteps[i.trackNumber];for(var o in s)r+=s[o]*(o+1);var c=s.length;c>n&&(n=c)}e.tracks.trackPatternLocks[t.trackNumber];return{selectedGroup:e.mix.selectedGroup,stepSum:r,resolution:e.sequencer.resolution,stepsLength:n,patternLocked:!1,isCompactMode:e.sequencer.isCompactMode,showEffects:e.tracks.showTrackEffects[t.groupNumber],showParameters:e.cursor.show}},function(e,t){return{mouseDown:function(t){return e(Object(O.k)(t))},setTrackFocused:function(){return e(Object(O.Id)(t.trackNumber))},setTrackUnfocused:function(){return e(Object(O.Id)(void 0))},trackPreparingToRecord:function(t,n){return e(Object(O.je)(t,n))},setSelectedPianoRollSteps:function(t){return e(Object(O.Gc)(t))},setStepsSelection:function(t){return e(Object(O.wd)(t))},setSelectedSteps:function(t,n,r){return e(Object(O.Lc)(t,n,r))},setStepNumberDraggingFrom:function(t){return e(Object(O.td)(t))},setShowEffects:function(n){return e(Object(O.jd)(t.groupNumber,n))},setContextualHelp:function(t){return e(Object(O.U)(t))},setSelectedGroup:function(t){return e(Object(O.Cc)(t))}}})(lj),{2:new Xe(4,!1),3:new Xe(4,!0),4:new Xe(8,!1),5:new Xe(8,!0),6:new Xe(16,!1),7:new Xe(16,!0),8:new Xe(32,!1),9:new Xe(32,!0)}),hj=function(){function e(t,n){Object(o.a)(this,e),this.sequencerEngine=t,this.disableTab=n,this.installation=n,this.store=t.store,this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.effectToCopy=void 0,this.checkMetaKey()}return Object(c.a)(e,[{key:"checkMetaKey",value:function(){var e=this;setInterval(function(){void 0!==e.lastMetaPressedTime&&((new Date).getTime()-e.lastMetaPressedTime>=5e3&&e.dispatch(Object(O.P)(!1)))},1e3)}},{key:"onKeyUp",value:function(e){"Meta"===e.key||"Alt"===e.key?(this.lastMetaPressedTime=void 0,this.dispatch(Object(O.P)(!1))):"`"===e.key?this.sequencerEngine.sequenceRolling=!1:"Space"===e.key||Object(B.a)(e.key)||this.sequencerEngine.keyboardHelper.onKeyUp(e)}},{key:"onKeyDown",value:function(e){if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName){var t=e.target===window.document.body;if("Space"!==e.key){if(!this.viMode&&e.key>="a"&&e.key<="z"&&!e.metaKey&&!e.altKey&&!e.ctrlKey)return this.sequencerEngine.keyboardHelper.onAlphabetKeyDown(e,this.cursor.track),!0;if(this.installation||("/"!==e.key&&":"!==e.key&&"+"!==e.key||(this.cursor.show=!1,this.state.commands.commandInput&&this.state.commands.commandInput.focus()),"x"===e.key&&(e.metaKey||e.altKey)&&this.state.commands.commandInput&&(this.state.commands.commandInput.focus(),this.dispatch(Object(O.Q)("M-x")))),"z"===e.key&&(e.metaKey||e.ctrlKey))return e.preventDefault(),e.shiftKey?this.sequencerEngine.operationManager.redo():this.sequencerEngine.operationManager.undo(),!0;if("k"===e.key&&(e.metaKey||e.altKey))return!0;if("j"===e.key&&(e.metaKey||e.altKey))return!0;if("d"===e.key&&(e.ctrlKey||e.metaKey))return!1;if("a"===e.key&&(e.metaKey||e.ctrlKey))return e.preventDefault(),!1;if("e"===e.key&&(e.metaKey||e.ctrlKey))return e.preventDefault(),!1;if(Object(B.a)(e.key));else if("="===e.key);else if("+"===e.key);else if("-"===e.key);else if("]"===e.key);else if("c"===e.key&&(e.metaKey||e.ctrlKey));else if("v"===e.key&&(e.metaKey||e.ctrlKey));else if("Backspace"==e.key)this.pointsSelected.length>0?this.deleteSelectedPoints():this.deleteSelectedSteps();else if("`"==e.key)this.sequencerEngine.isSequenceRolling||(this.sequencerEngine.sequenceRolling=!0);else{if("\\"==e.key||"h"==e.key&&e.ctrlKey)return e.preventDefault(),!1;if("."==e.key);else if("/"==e.key);else if("Meta"===e.key||"Alt"===e.key);else if("Tab"!==e.key||this.disableTab)if("'"===e.key);else if("Shift"===e.key&&t);else if("ArrowRight"==e.key&&t)this.onArrowRight(e);else if("ArrowLeft"==e.key&&t)this.onArrowLeft(e);else{if("ArrowUp"==e.key&&t)return this.onArrowUp(e);if("ArrowDown"==e.key&&t)return this.onArrowDown(e);"Enter"==e.key&&t&&this.onEnterKeyDown()}else;}}}}},{key:"onNumberKeyDown",value:function(e){var t=parseInt(e.key);if("ARRANGEMENT_VIEW"!==this.viewMode||this.isPlayingMix)if(this.sequencerEngine.rolling){if(t>=2&&t<=9){var n=pj[t];null!==n&&(this.sequencerEngine.resolution=n)}}else if(void 0!==this.cursor.track&&void 0!==this.cursor.step&&this.cursor.show){var r=t,a=32*this.sequencerEngine.getSelectedStep()/this.resolution.resolution;this.sequencerEngine.tracks[this.cursor.track].selectSlice(a,r)}else{var i=t;this.sequencerEngine.switchToPattern(i-1)}}},{key:"onMetaKeyDown",value:function(){this.lastMetaPressedTime=(new Date).getTime()}},{key:"selectAllTrackSteps",value:function(){}},{key:"copy",value:function(){console.log("copy called"),this.selectedEffect?this.effectToCopy=this.selectedEffect:this.copySteps()}},{key:"paste",value:function(){if(void 0!==this.effectToCopy&&void 0!==this.selectedTrack&&this.selectedTrack.isEffectsShowing()){var e=this.effectToCopy.isMidiEffect()?this.effectToCopy.getCopy(this.selectedTrack):this.effectToCopy.getEffectCopy();this.effectToCopy.isMidiEffect()?this.selectedTrack.midiEffects.addEffect(e):this.selectedTrack.effectsChain.addEffect(e),this.sequencerEngine.update()}else this.pasteSteps()}},{key:"copySteps",value:function(){var e=this.getSelectedSteps();if(void 0!==e){this.dispatch(Object(O.xd)(e));var t=this.selectedTrack;this.dispatch(Object(O.eb)(t.getEasyPattern()))}}},{key:"pasteSteps",value:function(){if(void 0!==this.state.keyboard.stepsToCopy){var e=this.cursor.getStep(this.resolution),t=this.sequencerEngine.tracks[this.cursor.track],n=t.getEasyPattern().pasteSteps(this.state.keyboard.stepsToCopy,{stepNumber:e},this.state.keyboard.easyPatternToCopy,this.state.sequencer.resolution);t.updateSteps(),this.dispatch(Object(O.Gc)(n)),this.dispatch(Object(O.sd)(e))}}},{key:"record",value:function(){var e=!this.isRecording;this.dispatch(Object(O.Eb)(e)),this.sequencerEngine.recording(e)}},{key:"getSelectedSteps",value:function(){return this.sequencerEngine.store.getState().keyboard.selectedPianoRollSteps}},{key:"deleteSelectedPoints",value:function(){var e,t,n=this.state.automation.trackParameter[this.selectedTrack.id];void 0!==n&&this.sequencerEngine.operationManager.dispatch((e=n.automation,t=this.pointsSelected,{type:"REMOVE_AUTOMATION_BREAK_POINTS",payload:{automation:e,points:t}}))}},{key:"deleteSelectedSteps",value:function(){this.sequencerEngine.store.getState();var e=this.getSelectedSteps();void 0!==e&&(this.sequencerEngine.operationManager.dispatch(ht(this.selectedTrack,e)),this.store.dispatch(Object(O.Gc)(void 0)))}},{key:"onShiftKeyDown",value:function(){this.cursor.show=!this.cursor.show}},{key:"onArrowRight",value:function(e){e.preventDefault(),this.showSamples2D&&this.isShowingSoundsPane()||("MIX_VIEW"!==this.viewMode?this.cursor.track in this.sequencerEngine.tracks&&this.sequencerEngine.right():this.sequencerEngine.switchToNextSubSequence())}},{key:"onArrowLeft",value:function(e){e.preventDefault(),this.showSamples2D&&this.isShowingSoundsPane()||("MIX_VIEW"!==this.viewMode?this.sequencerEngine.left():this.sequencerEngine.switchToPreviousSubSequence())}},{key:"onArrowUp",value:function(e){if(e.preventDefault(),!this.showSamples2D||!this.isShowingSoundsPane()){if("MIX_VIEW"!==this.viewMode)return this.sampleAuditioning?window.dispatchEvent(new Event("AUDITION_PREVIOUS_SAMPLE")):(this.sequencerEngine.up(),this.onSelectTrack(this.cursor.track)),!0;this.sequencerEngine.switchToPreviousPattern()}}},{key:"onArrowDown",value:function(e){if(e.preventDefault(),!this.showSamples2D||!this.isShowingSoundsPane()){if("MIX_VIEW"!==this.viewMode){if(this.sampleAuditioning)window.dispatchEvent(new Event("AUDITION_NEXT_SAMPLE"));else{this.sequencerEngine.tracks.length;this.sequencerEngine.down(),this.onSelectTrack(this.cursor.track)}return!0}this.sequencerEngine.switchToNextPattern()}}},{key:"onClickRollingMode",value:function(){this.dispatch(Object(O.Qd)(!this.trackRolling)),this.dispatch(Object(O.ce)(!1)),this.sequencerEngine.rollingManager.clear()}},{key:"onEnterKeyDown",value:function(){this.cursor.track>=0&&this.cursor.track<this.sequencerEngine.tracks.length&&this.sequencerEngine.getSelectedStep()>=0&&this.onClickStep(this.cursor.track,this.sequencerEngine.getSelectedStep())}},{key:"onClickStep",value:function(e,t){void 0===this.getSelectedSteps()&&(this.sequencerEngine.operationManager.dispatch(lt(this.sequencerEngine.tracks[e],t,this.resolution)),this.sequencerEngine.select(e,t),this.cursor.track=e)}},{key:"dispatch",value:function(e){this.store.dispatch(e)}},{key:"onSelectTrack",value:function(e){this.sequencerEngine.cursor.track=e}},{key:"isShowingSoundsPane",value:function(){return!this.state.selector.sidebarCollapsed&&(this.state.sequencer.showSelectorMode||"SOUNDS"!==this.state.sequencer.sidebarViewMode)}},{key:"state",get:function(){return this.store.getState()}},{key:"selectedEffect",get:function(){if(void 0!==this.state.effects.selectedEffect)return this.sequencerEngine.selectedEffect}},{key:"midiMapMode",get:function(){return this.state.midi.midiMapMode}},{key:"viewMode",get:function(){return this.state.sequencer.viewMode}},{key:"alternateViewMode",get:function(){return this.state.sequencer.alternateViewMode}},{key:"showGroups",get:function(){return this.state.sequencer.showGroups}},{key:"pointsSelected",get:function(){return this.state.automation.pointsSelected}},{key:"isCompactMode",get:function(){return this.state.sequencer.isCompactMode}},{key:"cursor",get:function(){return this.sequencerEngine.cursor}},{key:"resolution",get:function(){return this.state.sequencer.resolution}},{key:"sampleAuditioning",get:function(){return this.state.audition.sampleAuditioning}},{key:"trackRolling",get:function(){return this.state.sequencer.trackRolling}},{key:"isRecording",get:function(){return this.state.sequencer.isRecording}},{key:"selectedTrack",get:function(){return this.sequencerEngine.tracks[this.cursor.track]}},{key:"scripting",get:function(){return this.sequencerEngine.scripting}},{key:"viMode",get:function(){return"SEQUENCER_VIEW"===this.viewMode&&this.state.commands.viMode}},{key:"trackFocused",get:function(){return this.state.sequencer.trackFocused}},{key:"isPlayingMix",get:function(){return this.state.mix.isPlayingMix}},{key:"showPianoRoll",get:function(){return this.state.sequencer.showPianoRoll}},{key:"showSamples2D",get:function(){return this.state.selector.showSamples2D}}]),e}();function fj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var dj=function(e){Object(u.a)(n,e);var t=fj(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"onClickLFOThumbnail",value:function(){this.props.setShowEnvelopes(!1),this.props.setShowLFOs(!this.props.showLFOs)}},{key:"onClickEnvelopeThumbnail",value:function(){this.props.setShowLFOs(!1),this.props.setShowEnvelopes(!this.props.showEnvelopes)}},{key:"onClickLock",value:function(){this.props.showLFOs?this.props.lfosTrack.togglePatternLocked():this.props.showEnvelopes&&this.props.envelopesTrack.togglePatternLocked()}},{key:"render",value:function(){var e=this,t=this.props.isMixView?"track flex lfos-track mix-view":"track flex lfos-track",n=this.props.showLFOs?"lfo-thumbnail selected":"lfo-thumbnail",r=this.props.showEnvelopes?"lfo-thumbnail selected":"lfo-thumbnail";return a.a.createElement("div",{key:"lfo-tracks",onClick:function(){return[]},className:t},a.a.createElement("a",{name:"lfos"}),a.a.createElement("a",{name:"envelopes"}),a.a.createElement("div",{className:"unselected youtube-container"},a.a.createElement("div",{className:"lfo-envelope-button-container"},a.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("LFOS_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onClickLFOThumbnail()},className:n},"LFO"),a.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("ENVELOPES_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onClickEnvelopeThumbnail()},className:r},"ENV"))),a.a.createElement(Wc,{condition:this.props.showLFOs},a.a.createElement("div",{className:"lfo-effects-view"},this.props.lfosTrack.lfos.map(function(t){return a.a.createElement(mv,{sequencerEngine:e.props.sequencerEngine,lfo:t})}))),a.a.createElement(Wc,{condition:this.props.showEnvelopes},a.a.createElement("div",{className:"lfo-effects-view"},this.props.envelopesTrack.envelopes.map(function(t){return a.a.createElement(Cv,{sequencerEngine:e.props.sequencerEngine,envelopeTrack:t})}))),a.a.createElement(Wc,{condition:this.props.showLFOs||this.props.showEnvelopes},a.a.createElement("div",{className:"lock-button-container"},a.a.createElement("img",{onClick:function(){return e.onClickLock()},className:"lock-button",src:this.patternLocked?"/closed-padlock.png":"/opened-padlock.png"}))))}},{key:"patternLocked",get:function(){return this.props.showLFOs?this.props.lfoPatternLocked:!!this.props.showEnvelopes&&this.props.envelopePatternLocked}}]),n}(r.Component),mj=Object(g.b)(function(e,t){var n=(e.tracks.envelopePatternLocks[t.envelopesTrack.subSequence.id]||{})[t.sequencerEngine.currentPattern],r=(e.tracks.lfoPatternLocks[t.lfosTrack.subSequence.id]||{})[t.sequencerEngine.currentPattern];return{showLFOs:e.sequencer.showLFOs,showEnvelopes:e.sequencer.showEnvelopes,lfoPatternLocked:r,envelopePatternLocked:n}},function(e){return{setShowEnvelopes:function(t){return e(Object(O.Vc)(t))},setShowLFOs:function(t){return e(Object(O.Yc)(t))},setContextualHelp:function(t){return e(Object(O.U)(t))}}})(dj);function vj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var gj=function(e){Object(u.a)(n,e);var t=vj(n);function n(e){var r;Object(o.a)(this,n),r=t.call(this,e);var a=Object(W.a)(r);return r.sequencerEngine=e.sequencerEngine,r.props.sequencerEngine.setUpdateCallback(function(e){return a.update(e)}),r.state={edits:0,cursor:r.sequencerEngine.cursor,mixMode:!1,sequenceId:e.sequenceId},r.keyListener=new hj(r.sequencerEngine,r.props.installation),r.keyListener.disableTab=r.props.disableTab,r}return Object(c.a)(n,[{key:"update",value:function(e){this.setState(this.state)}},{key:"play",value:function(){this.isCommandDown?this.sequencerEngine.recordingMix=!1:this.sequencerEngine.recordingMix=!0,this.sequencerEngine.schedulePlay()}},{key:"record",value:function(){var e=!this.props.isRecording;this.props.setIsRecording(e),this.sequencerEngine.recording(e)}},{key:"toggleQuantize",value:function(){this.props.setQuantized(!this.props.quantized)}},{key:"componentDidMount",value:function(){this.bindKeys()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.keyListener.onKeyDown),window.removeEventListener("keyup",this.keyListener.onKeyUp)}},{key:"bindKeys",value:function(){window.addEventListener("keydown",this.keyListener.onKeyDown),window.addEventListener("keyup",this.keyListener.onKeyUp)}},{key:"onClick",value:function(e,t){this.isCommandDown?this.onShowParametersForTrackAndStep(e,t):(this.state.stepShowing==t&&!this.state.cursor.show||this.state.stepShowing!=t||e!=this.state.trackShowing)&&this.onClickStep(e,t)}},{key:"onClickGroupStep",value:function(e,t,n){this.isCommandDown?this.onShowParametersForGroupAndStep(e,t):(this.props.sequencerEngine.operationManager.dispatch(lt(this.props.sequencerEngine.tracks[n],t,this.resolution)),this.sequencerEngine.selectGroupStep(e,t),this.setState(this.state))}},{key:"onClickStep",value:function(e,t){this.props.sequencerEngine.operationManager.dispatch(lt(this.props.sequencerEngine.tracks[e],t,this.resolution)),this.props.setSelectedSteps(void 0),this.sequencerEngine.select(e,t),this.state.cursor.track=e,this.state.edits++}},{key:"selectStep",value:function(e,t){this.sequencerEngine.select(e,t)}},{key:"onUpdateStepDuration",value:function(e,t,n){Object(B.a)(n)&&(this.sequencerEngine.tracks[e].updateStepDuration(t,n,this.resolution),this.setState(this.state))}},{key:"onClickAddSteps",value:function(e){this.sequencerEngine.doubleTrackLength(e),this.setState(this.state)}},{key:"onClickRemoveSteps",value:function(e){this.sequencerEngine.halfTrackLength(e),this.setState(this.state)}},{key:"onMute",value:function(e){this.sequencerEngine.tracks[e].isMuted=!this.sequencerEngine.tracks[e].isMuted,this.setState(this.state)}},{key:"onClickDeleteTrack",value:function(e){this.props.keyboardEngine.deleteMappingsForTrack(e),this.sequencerEngine.deleteTrack(e),this.props.setTrackUnfocused(),this.setState(this.state)}},{key:"onShowParametersForGroupAndStep",value:function(e,t){this.state.cursor.group==e&&this.state.stepShowing==t?this.state.cursor.show=!this.state.cursor.show:this.state.cursor.show=!0,this.sequencerEngine.selectGroupStep(e,t),this.setState(this.state)}},{key:"onShowParametersForTrackAndStep",value:function(e,t){this.state.cursor.track==e&&this.state.stepShowing==t?(this.state.cursor.show=!this.state.cursor.show,this.sequencerEngine.tracks[e].stepUnselected(t)):this.state.cursor.show=!0,this.sequencerEngine.select(e,t),this.setState(this.state)}},{key:"runScript",value:function(){window.prompt("Type your script");this.setState(this.state),document.activeElement.blur()}},{key:"onClickTrack",value:function(e){}},{key:"onClickRollingMode",value:function(){this.props.setTrackRolling(!this.props.trackRolling),this.sequencerEngine.rollingManager.clear(),this.setState(this.state)}},{key:"onUpdateStepData",value:function(e,t,n){this.sequencerEngine.tracks[t].updateStepData(e,n,this.resolution)}},{key:"goToDetailsView",value:function(e){var t=this.sequencerEngine.tracks[e];if(void 0!==t)if(this.props.setSelectorMode(!1),t.getTrackType()==zr.d||t.getTrackType()==zr.b)this.props.setDetailsView(e),this.props.setViewMode("SOUND_DETAILS_VIEW");else if(this.sequencerEngine.isLoaded(e)){this.props.setDetailsView(e),this.sequencerEngine.tracks[e].getSamplers().length>1?this.props.setViewMode("MULTI_DETAILS_VIEW"):this.props.setViewMode("SOUND_DETAILS_VIEW")}}},{key:"onDrop",value:function(e){if(void 0!==this.props.sampleDragging){var t=this.props.sampleDragging;this.props.sequencerEngine.addSound(t,void 0),this.props.dragSample(void 0)}}},{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"onSelectGroup",value:function(e){this.state.cursor.group=e}},{key:"render",value:function(){var e=this;if(this.state.stepShowing=this.sequencerEngine.getSelectedStep(),this.state.trackShowing=this.state.cursor.track,this.props.hideSequencer)return a.a.createElement("div",null);var t="SEQUENCER_VIEW"!==this.props.viewMode?"full-view":void 0!==this.props.trackFocused?"tracks-container focused":this.props.stretchTracks?"tracks-container showing-selector":"tracks-container";this.isShowingSoundsPane()&&(t+=" showing-selector");return a.a.createElement("div",{dropabble:"true",onDragOver:function(t){return e.onDragOver(t)},onDrop:function(t){return e.onDrop(t)},id:"#start",className:t},a.a.createElement("div",null,a.a.createElement(Wc,{condition:!this.props.hideModulators&&void 0===this.props.trackFocused&&this.props.sequencerEngine.tracks.length>0&&!this.props.hideLFOsTrack},a.a.createElement(mj,{sequencerEngine:this.props.sequencerEngine,envelopesTrack:this.props.sequencerEngine.envelopesTrack,lfosTrack:this.props.sequencerEngine.lfosTrack})),[].filter(function(t){return void 0===e.props.trackFocused||e.props.trackFocused===t.trackNumber}).map(function(t,n){return a.a.createElement(Xw,{key:"t-"+t.id,disablePianoRoll:e.props.disablePianoRoll,installation:e.props.installation,sequencerEngine:e.sequencerEngine,soundId:t.getMainSoundId(),cursor:e.state.cursor,onLoadTrackUrl:function(e){return t.onLoadTrackUrl(e)},trackData:t,onClickTrack:function(){return e.onClickTrack(t.trackNumber)},sends:e.sequencerEngine.sends,onClickName:function(){return e.goToDetailsView(t.trackNumber)},trackNumber:t.trackNumber,onClickDelete:function(){return e.onClickDeleteTrack(t.trackNumber)},onClickAddSteps:function(){return e.onClickAddSteps(t.trackNumber)},onClickRemoveSteps:function(){return e.onClickRemoveSteps(t.trackNumber)},onClick:function(n){return e.onClick(t.trackNumber,n)}})}),a.a.createElement(Wc,{condition:!this.props.hideSends&&!this.props.installation&&void 0===this.props.trackFocused&&this.props.sequencerEngine.tracks.length>0},a.a.createElement($w,{sequencerEngine:this.sequencerEngine})),a.a.createElement("div",{className:"installation-row"},a.a.createElement(kP,{sequencerEngine:this.sequencerEngine}),a.a.createElement(RP,null))))}},{key:"isShowingSoundsPane",value:function(){return!this.props.sidebarCollapsed&&(this.props.showSelectorMode||"SOUNDS"!==this.props.sidebarViewMode)}},{key:"resolution",get:function(){return this.props.sequencerEngine.store.getState().sequencer.resolution}},{key:"isCommandDown",get:function(){return this.sequencerEngine.store.getState().keyboard.isCommandDown}},{key:"midiMapMode",get:function(){return this.sequencerEngine.store.getState().midi.midiMapMode}}]),n}(r.Component),yj=Object(g.b)(function(e,t){var n,r=(n={showGroups:e.sequencer.showGroups,viewMode:e.sequencer.viewMode,decentralized:e.sequencer.decentralized,sampleDragging:e.selector.sampleDragging,quantized:e.sequencer.quantized,isRecording:e.sequencer.isRecording,trackFocused:e.sequencer.trackFocused,sampleAuditioning:e.audition.sampleAuditioning,isCompactMode:e.sequencer.isCompactMode,trackRolling:e.sequencer.trackRolling},Object(An.a)(n,"showGroups",e.sequencer.showGroups),Object(An.a)(n,"currentSubSequence",e.sequencer.currentSubSequence[t.sequencerEngine.engineId]),Object(An.a)(n,"showSelectorMode",e.sequencer.showSelectorMode),Object(An.a)(n,"sidebarCollapsed",e.selector.sidebarCollapsed),Object(An.a)(n,"sidebarViewMode",e.sequencer.sidebarViewMode),n);return t.alreadyLoaded||(r.sequencerEngine=e.sequencer.sequencerEngine),r},function(e){return{setMidiMapMode:function(t){return e(Object(O.Qb)(t))},setResolution:function(t){return e(Object(O.sc)(t))},setViewMode:function(t){return e(Object(O.de)(t))},dragSample:function(t){return e(Object(O.g)(t))},setDetailsView:function(t){return e(Object(O.db)(t))},startTriggerTrack:function(t){return e(Object(O.he)(t))},setIsPlayingMix:function(t){return e(Object(O.Db)(t))},stopTriggerTrack:function(t){return e(Object(O.ie)(t))},setQuantized:function(t){return e(Object(O.oc)(t))},setIsRecording:function(t){return e(Object(O.Eb)(t))},setCommandDown:function(t){return e(Object(O.P)(t))},setErasingAutomation:function(t){return e(Object(O.mb)(t))},setTrackUnfocused:function(){return e(Object(O.Id)(void 0))},setSelectorMode:function(t){return e(Object(O.Nc)(t))},setStepsToCopy:function(t){return e(Object(O.xd)(t))},setCompactMode:function(t){return e(Object(O.R)(t))},setEasyPatternToCopy:function(t){return e(Object(O.eb)(t))},setShowSequenceModal:function(t){return e(Object(O.fd)(t))},setTrackRolling:function(t){return e(Object(O.Qd)(t))},setShowPresets:function(t){return e(Object(O.dd)(t))},setShowInstruments:function(t){return e(Object(O.Xc)(t))},setShowSequences:function(t){return e(Object(O.gd)(t))},hideAllEffects:function(){return e(Object(O.j)())},setShowGroups:function(t){return e(Object(O.Wc)(t))},setSelectedSteps:function(t,n,r){return e(Object(O.Lc)(t,n,r))}}})(gj);function bj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var kj=function(e){Object(u.a)(n,e);var t=bj(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={password:"",incorrectPassword:!1,needsToSetPassword:!1,userName:void 0},r.onClickDone=r.onClickDone.bind(Object(W.a)(r)),r.onClickCancel=r.onClickCancel.bind(Object(W.a)(r)),r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e){return e.show&&e.show!==this.props.show&&(this.getNeedsToSetPassword(),this.getUserName()),!0}},{key:"getUserName",value:function(){var e=Object(R.a)(N.a.mark(function e(){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,gn.a.getUserName();case 3:e.t1=e.sent,e.t2={userName:e.t1},e.t0.setState.call(e.t0,e.t2);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getNeedsToSetPassword",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.encryption.getPublicKey();case 2:t=e.sent,console.log("ethereum.getPublicKey() returned = "),console.log(t),t&&this.setState({needsToSetPassword:!0});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(e){return e.show!==this.props.show&&(console.log("password input = "),console.log(this.input.passwordInput),this.input.passwordInput.focus()),!0}},{key:"onClickDone",value:function(){var e=Object(R.a)(N.a.mark(function e(){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.crypto.isCorrectPassword(this.state.password);case 2:if(e.sent){e.next=7;break}return this.setState({incorrectPassword:!0}),e.abrupt("return");case 7:this.setState({incorrectPassword:!1});case 8:this.props.setShowPasswordModal(!1),console.log("passwordModalCallback("+this.state.password+")"),this.props.passwordModalCallback(this.state.password);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onClickCancel",value:function(){this.props.passwordModalCallback(void 0),this.props.setShowPasswordModal(!1)}},{key:"handleChange",value:function(e){this.setState({password:e.target.value})}},{key:"onKeyDown",value:function(e){"Enter"===e.key&&this.onClickDone()}},{key:"render",value:function(){var e=this;return a.a.createElement(lh.a,{dialogClassName:"preset-modal",show:this.props.show,onHide:function(){return e.props.setShowPasswordModal(!1)}},a.a.createElement(lh.a.Body,null,a.a.createElement(Wc,{condition:this.state.incorrectPassword},a.a.createElement("div",{className:"incorrect-password"},"Incorrect password")),a.a.createElement(Wc,{condition:void 0!==this.state.userName},"Password required to access",a.a.createElement("div",{className:"password-user-name"},this.state.userName)),a.a.createElement(Wc,{condition:this.state.needsToSetPassword},"Create a password to be used to encrypt your projects. Remember the password you choose."),a.a.createElement("div",{className:"password-container"},a.a.createElement(Zy.a,{id:"password",name:"password",placeholder:"Enter password",onKeyDown:function(t){return e.onKeyDown(t)},ref:function(t){return e.input=t},value:this.state.password,onChange:this.handleChange.bind(this)}))),a.a.createElement(lh.a.Footer,null,a.a.createElement(Ac.b,{variant:"secondary",onClick:this.onClickDone},"Done"),a.a.createElement(Ac.b,{variant:"primary",onClick:this.onClickCancel},"Cancel")))}}]),n}(r.Component),Ej=Object(g.b)(function(e){return{show:e.sequencer.showPasswordModal,passwordModalCallback:e.sequencer.passwordModalCallback}},function(e){return{setShowPasswordModal:function(t){return e(Object(O.bd)(t))}}})(kj);function Oj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Sj=function(e){Object(u.a)(n,e);var t=Oj(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e="small_checkmark ";return this.props.className&&(e+=this.props.className),console.log("condition = "+this.props.condition),a.a.createElement(Wc,{condition:this.props.condition},a.a.createElement("span",{className:e},a.a.createElement("div",{className:"small_checkmark_stem"}),a.a.createElement("div",{className:"small_checkmark_kick"})))}}]),n}(r.Component);n(2311);function Pj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var wj=function(e){Object(u.a)(n,e);var t=Pj(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={toggled:!1,guilds:[]},d.a.store=r.props.store,gn.a.setStore(r.props.store),gn.a.setEthereum(d.a),gn.a.checkLogin(),r.getGuilds(),r.getUserName(),r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e){return this.props.userToken!==e.userToken&&(this.getGuilds(),this.getUserName()),!0}},{key:"getUserName",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,gn.a.getUserName();case 2:t=e.sent,this.setState({userName:t});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getGuilds",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.guilds.getGuildsForUser();case 2:t=e.sent,console.log("got guilds for user = "),console.log(t),this.setState({guilds:t});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onClickLogIn",value:function(){this.props.setSigningUp(!1),this.props.setShowLogin(!0)}},{key:"onClickSignUp",value:function(){this.props.setSigningUp(!0),this.props.setShowLogin(!0)}},{key:"onClickLogout",value:function(){gn.a.logout()}},{key:"onClickGuild",value:function(e){void 0!==e&&d.a.crypto.getPassword(),this.props.setSelectedGuild(e)}},{key:"toggle",value:function(){this.setState({toggled:!this.state.toggled})}},{key:"getSelectedGuild",value:function(){return this.props.selectedGuild?this.props.selectedGuild.name:this.state.userName}},{key:"goToGuildsPage",value:function(){window.location.href="/guilds"}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"guilds-menu"},a.a.createElement(Ej,{crypto:d.a.crypto,show:!0}),a.a.createElement(Ac.c,{className:"view-dropdown",show:this.state.toggled?"true":"false",isOpen:this.state.toggled,toggle:function(){return e.toggle()}},gn.a.isLoggedIn()?a.a.createElement(Ac.f,{size:"sm",caret:!0,color:"primary"},a.a.createElement("div",{className:"not-recording-dot"}),a.a.createElement("span",{className:"guild-name"},this.getSelectedGuild())):a.a.createElement(Ac.f,{size:"sm",caret:!0,color:"primary"},a.a.createElement("div",{className:"not-recording-dot logged-out"}),"Log In"),a.a.createElement(Ac.e,null,a.a.createElement(Wc,{condition:!gn.a.isLoggedIn()},a.a.createElement(Ac.d,{key:"",onClick:function(){return e.onClickLogIn()},size:"sm"},"Log In"),a.a.createElement(Ac.d,{key:"public",onClick:function(){return e.onClickSignUp()},size:"sm"},"Sign Up")),a.a.createElement(Wc,{condition:gn.a.isLoggedIn()},a.a.createElement(Ac.d,{key:"public",className:"user-name-item",onClick:function(){return e.goToGuildsPage()},size:"sm"},a.a.createElement("div",{className:"not-recording-dot"})," ",a.a.createElement("span",{className:"guild-user-name"},this.state.userName)),a.a.createElement(Ac.d,{key:"public",onClick:function(){return e.onClickGuild(void 0)},size:"sm"},a.a.createElement("div",{className:"guild-dropdown-option"},a.a.createElement("div",null,"Public"),a.a.createElement(Sj,{className:"guilds-checkmark",condition:void 0===this.props.selectedGuild}))),this.state.guilds.map(function(t){return a.a.createElement(Ac.d,{key:t.name,onClick:function(){return e.onClickGuild(t)},size:"sm"},a.a.createElement("div",{className:"guild-dropdown-option"},a.a.createElement("div",null,t.name),a.a.createElement(Sj,{className:"guilds-checkmark",condition:e.props.selectedGuild===t})))}),a.a.createElement(Ac.d,{key:"logout",className:"logout-item",onClick:function(){return e.onClickLogout()},size:"sm"},"Log out")))))}}]),n}(r.Component),jj=Object(g.b)(function(e){return{selectedGuild:e.guilds.selectedGuild,userToken:e.sequencer.userToken}},function(e){return{setSelectedGuild:function(t){return e(Object(O.Dc)(t))},setShowLogin:function(t){return e(Object(O.Zc)(t))},setSigningUp:function(t){return e(Object(O.md)(t))}}})(wj);function Tj(e){var t=e.sequencerEngine;return a.a.createElement("div",{className:"bpm-component"},"BPM: ",t.bpmParameter.get())}function xj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Cj=function(e){Object(u.a)(n,e);var t=xj(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return 0===this.props.numPending?a.a.createElement("div",null):a.a.createElement("div",{className:"pending-transactions"},"Syncing ",this.props.numPending," items",a.a.createElement(v.a,{sizeUnit:"px",size:8,color:"#6200ff",loading:!0}))}}]),n}(r.Component),Nj=Object(g.b)(function(e,t){return{numPending:e.transactions.pendingTransactions.length}},null)(Cj);function Rj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Dj=function(e){Object(u.a)(n,e);var t=Rj(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={clockDragging:!1,clockStartDragY:void 0,clockDragY:void 0},r}return Object(c.a)(n,[{key:"onClockMouseLeave",value:function(e){void 0!=this.seekTimer&&(clearInterval(this.seekTimer),this.seekTimer=void 0)}},{key:"onClockMouseDown",value:function(e){var t=this;void 0!==this.props.sequencerEngine&&(this.state.clockStartDragY=e.clientY,this.seekTimer=setInterval(function(){if(void 0!==t.state.clockDragY){var e=t.state.clockStartDragY-t.state.clockDragY,n=t.props.sequencerEngine.trackStep+5*e;n<0&&(n=0),t.props.sequencerEngine.seekToTrackStep(n)}},50))}},{key:"onClockMouseUp",value:function(e){clearInterval(this.seekTimer),this.seekTimer=void 0}},{key:"onClockMouseMove",value:function(e){this.state.clockDragY=e.clientY}},{key:"onClickMetronome",value:function(){void 0!==this.props.sequencerEngine&&(this.props.sequencerEngine.metronomeOn=!this.props.sequencerEngine.metronomeOn)}},{key:"render",value:function(){var e=this,t=Math.ceil(this.props.currentGlobalStep/32);t=isNaN(t)?1:t;var n=1+Math.floor(this.props.currentGlobalStep/8)%4,r=1+Math.floor(this.props.currentGlobalStep/2)%4,i="clock ";this.props.clockTick&&(i+="percentage-"+this.props.clockTick);var s="metronome";return this.props.metronomeOn&&(this.props.currentGlobalStep/4%4>=2&&(s+=" off-beat"),s+=" on"),a.a.createElement("div",{className:i,onMouseLeave:function(t){return e.onClockMouseLeave(t)},onMouseDown:function(t){return e.onClockMouseDown(t)},onMouseUp:function(t){return e.onClockMouseUp(t)},onMouseMove:function(t){return e.onClockMouseMove(t)}},a.a.createElement("div",{className:"track-time"},t),a.a.createElement("div",{className:"divider"},"."),a.a.createElement("div",{className:"time"},n),a.a.createElement("div",{className:"divider"},"."),a.a.createElement("div",{className:"time"},r),a.a.createElement("div",{onClick:function(){return e.onClickMetronome()},className:s},a.a.createElement("div",{className:"dot first"}),a.a.createElement("div",{className:"dot second"})))}}]),n}(r.Component),qj=Object(g.b)(function(e,t){if(void 0===t.sequencerEngine)return{currentStep:0,currentGlobalStep:0,clockTick:0,metronomeOn:!1};var n=t.sequencerEngine.getSequenceId();return{currentStep:e.sequencer.currentStep[n]||0,currentGlobalStep:e.sequencer.currentGlobalStep[n]||0,clockTick:e.clock.clockTick,metronomeOn:t.sequencerEngine.metronomeOn}},null)(Dj);function Mj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Aj=function(e){Object(u.a)(n,e);var t=Mj(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).operationManager=r.props.sequencerEngine.operationManager,r}return Object(c.a)(n,[{key:"onDragStart",value:function(e){this.props.dragPattern(e)}},{key:"deletePattern",value:function(){0!==this.props.sequencerEngine.tracks.length&&this.operationManager.dispatch({type:"DELETE_PATTERN",payload:{patternNumber:this.props.sequencerEngine.tracks[0].currentPattern}})}},{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"onDrop",value:function(e){this.props.sequencerEngine.movePatternTo(this.props.patternDragging,e),this.setState(this.state)}},{key:"clickPattern",value:function(e){this.props.sequencerEngine.store.getState();this.props.sequencerEngine.switchToPattern(e),this.setState(this.state)}},{key:"render",value:function(){var e=this;if(this.props.sequencerEngine.currentSubSequence.isTrack)return a.a.createElement("div",null);for(var t=[],n=0;n<this.props.sequencerEngine.numberOfPatterns();n++)t.push(n);return a.a.createElement("div",{className:"patterns-container"},t.map(function(t){return a.a.createElement(Ij,{key:t,setContextualHelp:function(t){return e.props.setContextualHelp(t)},patternNumber:t,currentPattern:e.props.currentPattern,patternColor:e.props.patternColors[t],patternToEditColor:e.props.patternToEditColor,onClickPattern:function(){return e.clickPattern(t)},onDragStart:function(n){return e.onDragStart(t)},onDragOver:function(t){return e.onDragOver(t)},onDrop:function(n){e.onDrop(t)}})}),a.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("NEW_PATTERN_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"new-pattern-btn",onClick:function(){return e.props.sequencerEngine.newPattern(!0)}},"+"),a.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("DELETE_PATTERN_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"delete-pattern-btn",onClick:function(){return e.deletePattern()}},"-"))}}]),n}(r.Component),Ij=function(e){Object(u.a)(n,e);var t=Mj(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this,t="pattern-box";this.props.currentPattern==this.props.patternNumber?void 0!==this.props.patternColor?t+=" background-"+this.props.patternColor:t+=" current-pattern":void 0!==this.props.patternColor&&(t+=" foreground-"+this.props.patternColor),this.props.patternNumber==this.props.patternToEditColor&&(t+=" editing-color");var n=this.props.currentPattern===this.props.patternNumber?"CURRENT_PATTERN_BUTTON":"PATTERN_BUTTON";return a.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp(n)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onDragStart:this.props.onDragStart,onDragOver:this.props.onDragOver,onDrop:this.props.onDrop,draggable:!0,className:t,onClick:this.props.onClickPattern},this.props.patternNumber+1)}}]),n}(r.Component),Lj=Object(g.b)(function(e,t){var n=t.sequencerEngine.engineId,r=e.sequencer.currentSubSequence[n],a=e.sequencer.currentPattern[r]||0,i=e.sequencer.isPlaying[n]||0;return{midiMapMode:e.midi.midiMapMode,isCompactMode:e.sequencer.isCompactMode,resolution:e.sequencer.resolution,detailsView:e.sequencer.detailsView,decentralized:e.sequencer.decentralized,currentPattern:a,viewMode:e.sequencer.viewMode,numberOfPatterns:e.sequencer.numberOfPatterns[r]||1,samplePack:e.sequencer.samplePack,patternDragging:e.sequencer.patternDragging,isRecordingMix:e.mix.isRecordingMix,isPlayingMix:e.mix.isPlayingMix,isPlaying:i,patternToEditColor:e.toolbar.patternToEditColor,patternColors:e.toolbar.patternColors,trackRolling:e.sequencer.trackRolling,sequenceRolling:e.sequencer.sequenceRolling}},function(e){return{dragPattern:function(t){return e(Object(O.f)(t))},setContextualHelp:function(t){return e(Object(O.U)(t))}}})(Aj);function Fj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Bj=["A","B","C","D","E","F","G","H"],Hj=function(e){Object(u.a)(n,e);var t=Fj(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"chooseSubSequence",value:function(e){"SOUND_DETAILS_VIEW"!==this.props.viewMode&&"MULTI_DETAILS_VIEW"!==this.props.viewMode||this.props.setViewMode("SEQUENCER_VIEW"),this.props.sequencerEngine.switchToSubSequence(e)}},{key:"newSubSequence",value:function(){"SOUND_DETAILS_VIEW"!==this.props.viewMode&&"MULTI_DETAILS_VIEW"!==this.props.viewMode||this.props.setViewMode("SEQUENCER_VIEW"),this.props.sequencerEngine.newSubSequence()}},{key:"deleteSubSequence",value:function(){window.confirm("Are you sure you want to delete this SUB SEQUENCE?")&&this.props.sequencerEngine.deleteSubSequence()}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"sub-sequences-container"},this.props.subSequences.filter(function(t){return!e.props.sequencerEngine.getSubSequence(t).isTrack}).map(function(t,n){return a.a.createElement("div",{key:Bj[n],onClick:function(){return e.chooseSubSequence(t)},className:t===e.props.currentSubSequence?"sub-sequence selected":"sub-sequence"},Bj[n])}),a.a.createElement("div",{onClick:function(){return e.newSubSequence()},className:"new-sub-sequence"},"+"),a.a.createElement("div",{onClick:function(){return e.deleteSubSequence()},className:"delete-sub-sequence"},"-"))}}]),n}(r.Component);Object(g.b)(function(e,t){var n=t.sequencerEngine.engineId;return{subSequences:e.sequencer.subSequences[n]||[],currentSubSequence:e.sequencer.currentSubSequence[n],viewMode:e.sequencer.viewMode}},function(e){return{setViewMode:function(t){return e(Object(O.de)(t))}}})(Hj);function Vj(e){var t=e.sequencerEngine,n=t.getAllRecordingsToSave().length;return 0===n?a.a.createElement("div",null):a.a.createElement("div",{className:"save-recordings"},"You have ",n," new sounds to",a.a.createElement("span",{onClick:function(){return t.saveAnyNewRecordings(0)},className:"save-recordings-button"},"save"),".")}function Uj(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Jj=function(e){Object(u.a)(n,e);var t=Uj(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={sequenceHash:void 0,creatingLink:!1},r}return Object(c.a)(n,[{key:"getLink",value:function(){return"https://zequencer.io/create/"+this.state.sequenceHash}},{key:"copyLink",value:function(){var e=this,t=this.linkInput;t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),this.setState({copied:!0}),setTimeout(function(){return e.setState({copied:!1})},1e3)}},{key:"createLink",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({creatingLink:!0}),e.next=3,this.props.sequencerEngine.save(void 0,sP,!1);case 3:t=e.sent,this.setState({sequenceHash:t,creatingLink:!1});case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return a.a.createElement("div",null,a.a.createElement(Wc,{condition:void 0===this.state.sequenceHash},a.a.createElement("div",{onClick:function(){return e.createLink()},className:"link-button"},"Create Public Link")),a.a.createElement(Wc,{condition:void 0!==this.state.sequenceHash},a.a.createElement("div",null,"Link: ",a.a.createElement("input",{type:"text",value:this.getLink(),id:"linkInput",ref:function(t){e.linkInput=t}})),a.a.createElement("div",{onClick:function(){return e.copyLink()},className:"small-button pink-button"},"Copy Link"),a.a.createElement("div",{className:"clear-fix"}),a.a.createElement(Wc,{condition:this.state.copied},a.a.createElement("div",{className:"copied-info"},"Copied to clipboard!"))))}}]),n}(r.Component);function _j(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var Gj=function(e){Object(u.a)(n,e);var t=_j(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={nameValue:"",numTokens:1,saveOption:sP,metamaskInstalled:!1,showBuying:!1,sequenceHash:void 0,copied:!1,selectedGuild:void 0,guildOptions:[]},r.input=void 0,r.onClickDone=r.onClickDone.bind(Object(W.a)(r)),r.onClickCancel=r.onClickCancel.bind(Object(W.a)(r)),r.onClickBuy=r.onClickBuy.bind(Object(W.a)(r)),r.onClickConfirmBuy=r.onClickConfirmBuy.bind(Object(W.a)(r)),d.a.tokenizedSequences.callback=function(){return r.onBalanceUpdated()},r}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e){return e.show&&e.show!==this.props.show&&(d.a.tokenizedSequences.watchBalance(),this.getUser(),this.getBalance(),this.getPrice(),this.getGuilds()),e.show||e.show===this.props.show||(this.state.sequenceHash=void 0,this.state.copied=!1),!0}},{key:"getGuilds",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.guilds.getGuildsForUser();case 2:t=e.sent,void 0!==this.props.selectedGuild&&this.setState({saveOption:oP}),this.setState({selectedGuild:this.props.selectedGuild||t[0],guildOptions:t});case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getPrice",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t,n=this;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.tokenizedSequences.getPrice();case 2:t=(t=e.sent)*Math.pow(10,3)/Math.pow(10,18),this.setState({price:t}),f.a.get("https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=ethereum").then(function(e){e=e.data;var t=parseFloat(e[0].current_price);n.setState({ethPrice:t})}).catch(function(e){console.log("error getting price = "),console.log(e)});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onClickConfirmBuy",value:function(){this.onClickDone()}},{key:"onClickBuy",value:function(){this.setState({showBuying:!0})}},{key:"onBalanceUpdated",value:function(){this.setState({onPurchased:!1}),this.getBalance()}},{key:"getBalance",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.tokenizedSequences.getBalance();case 2:t=e.sent,this.state.balance=t||0,this.state.showBuying=0===t,this.setState({balance:t||0,showBuying:0===t});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUser",value:function(){var e=Object(R.a)(N.a.mark(function e(){var t;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,gn.a.getAccount();case 2:t=e.sent,this.setState({metamaskInstalled:void 0!==t});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(e){return this.props.show!=e.show&&this.input&&this.input.focus(),!0}},{key:"onClickDone",value:function(){this.state.showBuying?(d.a.tokenizedSequences.buyTokens(parseInt(this.state.numTokens)),this.setState({onPurchased:!0,showBuying:!1})):(console.log("on save called with selected guild = "),this.props.onSave(this.state.nameValue,this.state.saveOption,this.state.selectedGuild))}},{key:"onClickCancel",value:function(){this.state.showBuying?this.setState({showBuying:!1}):this.props.onHide()}},{key:"onInputType",value:function(e){this.setState({nameValue:e})}},{key:"handleCheckboxChange",value:function(e){console.log("handleCheckboxChange("+e+")"),console.log(e.target),this.setState({saveOption:e.target.name})}},{key:"onTokenType",value:function(e){""===e&&this.setState({numTokens:0}),Object(B.a)(e)&&this.setState({numTokens:e})}},{key:"onSelectGuild",value:function(e){this.setState({selectedGuild:e})}},{key:"render",value:function(){var e=this;return this.state.metamaskInstalled?this.state.showBuying?a.a.createElement(lh.a,{dialogClassName:"preset-modal",show:this.props.show,onHide:this.onClickCancel},a.a.createElement(lh.a.Header,{closeButton:!0},a.a.createElement(lh.a.Title,null,"Buy Tokens")),a.a.createElement(lh.a.Body,null,a.a.createElement("div",{className:"input-wrapper"},a.a.createElement("input",{value:this.state.numTokens,onChange:function(t){return e.onTokenType(t.target.value)},ref:function(t){e.input=t},placeholder:"Enter how many tokens to buy",className:"tag-input"})),a.a.createElement("div",{className:"price"},"Price:",a.a.createElement("span",{className:"price-eth-wrapper"},a.a.createElement("span",{className:"price-eth"},function(e){if(Math.abs(e)<1){var t=parseInt(e.toString().split("e-")[1]);t&&(e*=Math.pow(10,t-1),e="0."+new Array(t).join("0")+e.toString().substring(2))}else{var t=parseInt(e.toString().split("+")[1]);t>20&&(t-=20,e/=Math.pow(10,t),e+=new Array(t+1).join("0"))}return e}(this.state.numTokens*this.state.price)),"ETH"),a.a.createElement("span",{className:"price-dollars-wrapper"},a.a.createElement("span",{className:"price-dollars"},this.state.numTokens*this.state.price*this.state.ethPrice),"USD$")),a.a.createElement("span",{onClick:this.onClickConfirmBuy,className:"buy-action"},"Buy"),a.a.createElement(kw,{advanced:!0})),a.a.createElement(lh.a.Footer,null,a.a.createElement(Ac.b,{variant:"secondary",onClick:this.onClickDone},"Buy"),a.a.createElement(Ac.b,{variant:"primary",onClick:this.onClickCancel},"Cancel"))):a.a.createElement(lh.a,{dialogClassName:"preset-modal",show:this.props.show,onHide:this.onClickCancel},a.a.createElement(lh.a.Header,{closeButton:!0},a.a.createElement(lh.a.Title,null,"Save Project")),a.a.createElement(lh.a.Body,null,a.a.createElement("input",{value:this.state.nameValue,onChange:function(t){return e.onInputType(t.target.value)},ref:function(t){e.input=t},placeholder:"Type name of project",className:"tag-input"}),a.a.createElement("form",null,a.a.createElement("input",{name:sP,type:"checkbox",checked:this.state.saveOption===sP,onChange:function(t){return e.handleCheckboxChange(t)}}),a.a.createElement("label",{onMouseOver:function(){return e.props.setContextualHelp("PUBLIC_SAVE")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)}},"Public"),a.a.createElement("input",{name:oP,type:"checkbox",checked:this.state.saveOption===oP,onChange:function(t){return e.handleCheckboxChange(t)}}),a.a.createElement("label",{onMouseOver:function(){return e.props.setContextualHelp("PUBLIC_SAVE")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)}},"Guild"),a.a.createElement("input",{name:"PRIVATE",value:"PRIVATE",type:"checkbox",checked:"PRIVATE"===this.state.saveOption,onChange:function(t){return e.handleCheckboxChange(t)}}),a.a.createElement("label",{onMouseOver:function(){return e.props.setContextualHelp("PRIVATE_SAVE")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)}},"Private")),a.a.createElement(Wc,{condition:!this.state.metamaskInstalled},a.a.createElement(Ow,null)),a.a.createElement(Wc,{condition:void 0!==this.state.balance&&this.state.saveOption===sP},a.a.createElement("div",{className:"balance-info"},a.a.createElement("div",{className:"balance"},"Balance: ",this.state.balance," tokens",a.a.createElement("span",{onClick:this.onClickBuy,className:"buy-action go-to-buy"},"Buy")),a.a.createElement("div",null,"Cost: 1 token"),a.a.createElement(Wc,{condition:this.state.onPurchased},a.a.createElement("span",{className:"waiting-for-tokens"},"Waiting for token purchase to go through..."),a.a.createElement(v.a,{sizeUnit:"px",size:10,color:"#62ffa1",loading:this.state.onPurchased}))),a.a.createElement(kw,null)),a.a.createElement(Vj,{sequencerEngine:this.props.sequencerEngine}),a.a.createElement(Wc,{condition:this.state.saveOption===sP},a.a.createElement(Jj,{sequencerEngine:this.props.sequencerEngine})),a.a.createElement(Wc,{condition:this.state.saveOption===oP},a.a.createElement(gw,{onSelectGuild:function(t){return e.onSelectGuild(t)},selectedGuild:this.state.selectedGuild,guildOptions:this.state.guildOptions}))),a.a.createElement(lh.a.Footer,null,a.a.createElement(Ac.b,{variant:"secondary",onClick:this.onClickDone},"Save"),a.a.createElement(Ac.b,{variant:"primary",onClick:this.onClickCancel},"Cancel"))):a.a.createElement(lh.a,{dialogClassName:"preset-modal save-modal",show:this.props.show,onHide:this.onClickCancel},a.a.createElement(lh.a.Header,{closeButton:!0},a.a.createElement(lh.a.Title,null,"Save Sequence")),a.a.createElement(lh.a.Body,null,a.a.createElement("div",{className:"no-metamask"},"Log in to save your song to your account."),a.a.createElement(Jj,{sequencerEngine:this.props.sequencerEngine})),a.a.createElement(lh.a.Footer,null,a.a.createElement(Ac.b,{variant:"secondary",onClick:this.onClickCancel},"Done")))}}]),n}(r.Component);var zj=Object(g.b)(function(e){return{selectedGuild:e.guilds.selectedGuild}},function(e){return{setContextualHelp:function(t){return e(Object(O.U)(t))}}})(Gj),Wj=n(90),Kj=n.n(Wj),Qj=function e(){Object(o.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"}],name:"newSamplePack",outputs:[{name:"",type:"uint32"}],payable:!1,stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"",type:"address"},{indexed:!0,name:"",type:"uint32"}],name:"NewSamplePack",type:"event"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"tags",type:"bytes32[4]"}],name:"newSamplePackWithTags",outputs:[{name:"",type:"uint32"}],payable:!1,stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"",type:"uint32"},{indexed:!0,name:"",type:"bytes32"}],name:"SamplePackTagged",type:"event"},{constant:!1,inputs:[{name:"id",type:"uint32"},{name:"tags",type:"bytes32[4]"}],name:"tagSamplePack",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{constant:!1,inputs:[{name:"id",type:"uint32"},{name:"ipfsHash",type:"bytes32"}],name:"updateSamplePackSamples",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"getNumberOfSamplePacks",outputs:[{name:"",type:"uint32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"id",type:"uint32"}],name:"getSamplePackIpfsHash",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"}],this.contractAddress="0x1f4d647863b75171b40680f269d4c8cbf3ed50b7"},Xj=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object(o.a)(this,e),this.samples=n,this.tags=r,this.name=t,this.sampleToSlices=a,this.timestamp=void 0,this.isArchived=!1,this.id=void 0}return Object(c.a)(e,[{key:"getJson",value:function(){return{samples:this.samples,sampleToSlices:this.sampleToSlices,name:this.name,tags:this.tags,timestamp:void 0===this.timestamp?Math.floor(Date.now()):this.timestamp,isArchived:this.isArchived,id:this.id}}},{key:"fromJson",value:function(e){return"sampleToSlices"in e&&(this.sampleToSlices=e.sampleToSlices),"name"in e&&(this.name=e.name),"samples"in e&&(this.samples=e.samples),"tags"in e&&(this.tags=e.tags),"timestamp"in e&&(this.timestamp=new Date(e.timestamp)),"isArchived"in e&&(this.isArchived=e.isArchived),"id"in e&&(this.id=e.id),this}}]),e}(),Yj=new Qj,Zj="undefined"!==typeof window.web3?new Kj.a(window.web3.currentProvider):new Kj.a(new Kj.a.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),$j=function(){function e(){Object(o.a)(this,e),void 0!==Zj&&Zj.eth.net.isListening()&&(this.contract=new Zj.eth.Contract(Yj.abi,Yj.contractAddress),this.ethAddress=this.contract.options.address)}return Object(c.a)(e,[{key:"updateSamplePack",value:function(e,t){var n=this;return new Promise(function(){var r=Object(R.a)(N.a.mark(function r(a,i){var s,o;return N.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Gt.a.addJson(t.getJson());case 2:return s=r.sent,r.next=5,Zj.eth.getAccounts();case 5:o=r.sent,n.contract.methods.updateSamplePackSamples(e,Object(zt.b)(s)).send({from:o[0]},function(e,t){e?i(e):a()});case 7:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"newSamplePack",value:function(e){var t=this;return new Promise(function(){var n=Object(R.a)(N.a.mark(function n(r,a){var i,s;return N.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Gt.a.addJson(e.getJson());case 2:return i=n.sent,n.next=5,Zj.eth.getAccounts();case 5:s=n.sent,t.contract.methods.newSamplePack(Object(zt.b)(i)).send({from:s[0]},function(e,t){e?a(e):r()});case 7:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getAllSamplePacks",value:function(){var e=this;return new Promise(function(){var t=Object(R.a)(N.a.mark(function t(n,r){var a,i,s,o,c;return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.contract.methods.getNumberOfSamplePacks().call();case 2:for(a=t.sent,i=[],s=function(t){i.push(new Promise(function(){var n=Object(R.a)(N.a.mark(function n(r,a){var i,s,o;return N.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.contract.methods.getSamplePackIpfsHash(t).call();case 2:return i=n.sent,n.next=5,Gt.a.getJson(Object(zt.a)(i));case 5:s=n.sent,(o=new Xj).id=t,r(o.fromJson(s));case 9:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}()))},o=1;o<=a;o++)s(o);return t.next=8,Promise.all(i);case 8:c=t.sent,n(c.filter(function(e){return!e.isArchived}).reverse());case 10:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}}]),e}();function eT(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var tT=function(e){Object(u.a)(n,e);var t=eT(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).onClickColor=r.onClickColor.bind(Object(W.a)(r)),r}return Object(c.a)(n,[{key:"onClickColor",value:function(e){console.log("pattern to edit color = "+this.props.patternToEditColor),this.props.setPatternColor(this.props.patternToEditColor,e)}},{key:"onClickDone",value:function(){this.props.setPatternToEditColor(void 0)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"sub-toolbar"},a.a.createElement("div",{className:"color-picker"},a.a.createElement(nT,{patternColor:this.props.patternColor,color:"white",onClickColor:this.onClickColor}),a.a.createElement(nT,{patternColor:this.props.patternColor,color:"red",onClickColor:this.onClickColor}),a.a.createElement(nT,{patternColor:this.props.patternColor,color:"orange",onClickColor:this.onClickColor}),a.a.createElement(nT,{patternColor:this.props.patternColor,color:"yellow",onClickColor:this.onClickColor}),a.a.createElement(nT,{patternColor:this.props.patternColor,color:"green",onClickColor:this.onClickColor}),a.a.createElement(nT,{patternColor:this.props.patternColor,color:"blue",onClickColor:this.onClickColor}),a.a.createElement(nT,{patternColor:this.props.patternColor,color:"purple",onClickColor:this.onClickColor})),a.a.createElement("div",{className:"done-button",onClick:function(){return e.onClickDone()}},"DONE"))}}]),n}(r.Component),nT=function(e){Object(u.a)(n,e);var t=eT(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this,t="color-option background-"+this.props.color;return this.props.patternColor===this.props.color&&(t+=" selected"),a.a.createElement("div",{onClick:function(){return e.props.onClickColor(e.props.color)},className:t})}}]),n}(r.Component),rT=Object(g.b)(function(e){return{patternToEditColor:e.toolbar.patternToEditColor,patternColor:e.toolbar.patternColors[e.toolbar.patternToEditColor]}},function(e){return{setPatternToEditColor:function(t){return e(Object(O.ec)(t))},setPatternColor:function(t,n){return e(Object(O.dc)(t,n))}}})(tT);var aT=[{value:new Xe(4,!1),label:"1/4"},{value:new Xe(4,!0),label:"1/4t"},{value:new Xe(8,!1),label:"1/8"},{value:new Xe(8,!0),label:"1/8t"},{value:new Xe(16,!1),label:"1/16"},{value:new Xe(16,!0),label:"1/16t"},{value:new Xe(32,!1),label:"1/32"},{value:new Xe(32,!0),label:"1/32t"}];function iT(e){for(var t=0;t<aT.length;t++)if(aT[t].value.resolution==e.resolution&&aT[t].value.isTriplet==e.isTriplet)return aT[t];return null}var sT=Object(g.b)(function(e){return{resolution:e.sequencer.resolution}},function(e){return{setContextualHelp:function(t){return e(Object(O.U)(t))}}})(function(e){return a.a.createElement("div",{onMouseOver:function(){return e.setContextualHelp(b)},onMouseLeave:function(){return e.setContextualHelp(void 0)}},a.a.createElement(Vc.a,{className:"resolution-dropdown",options:aT,onChange:function(t){return n=t.value,e.sequencerEngine.resolution=n,void(e.sequencerEngine.tracks.length>0&&e.sequencerEngine.select(e.sequencerEngine.cursor.track,0));var n},value:iT(e.resolution),placeholder:"Select a resolution"}))});function oT(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var cT=function(e){Object(u.a)(n,e);var t=oT(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"onClick",value:function(){"DISCONNECTED"===this.props.connectionStatus&&this.props.sequencerEngine.clockSync.retry()}},{key:"render",value:function(){var e=this;if("NONE"===this.props.connectionStatus)return a.a.createElement("div",null);var t="";t="WAITING"===this.props.connectionStatus?"Waiting for peer to connect":"DISCONNECTED"===this.props.connectionStatus?"Disconnected (click to retry)":"Synced with "+this.props.connectedUserName;var n="WAITING"===this.props.connectionStatus?" flashit":"";return a.a.createElement("div",{onClick:function(){return e.onClick()},className:"connection-status "+this.props.connectionStatus+n},t," ",a.a.createElement("div",{className:"clock-type"},this.props.clockType))}}]),n}(r.Component),uT=Object(g.b)(function(e){return{connectedUserName:e.clock.connectedUserName,connectionStatus:e.clock.connectionStatus,clockType:e.sequencer.clockType}},null)(cT);n(2312);function lT(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}new $j;var pT=function(e){Object(u.a)(n,e);var t=lT(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={dropdownOpen:!1,showSaveModal:!1},r}return Object(c.a)(n,[{key:"goToMixer",value:function(){this.props.setViewMode("MIX_VIEW")}},{key:"goToArrangement",value:function(){this.props.setViewMode("ARRANGEMENT_VIEW")}},{key:"goToSequencer",value:function(){this.props.setViewMode("SEQUENCER_VIEW")}},{key:"goToPreferences",value:function(){this.props.setViewMode("PREFERENCES_VIEW")}},{key:"goToHome",value:function(){void 0!==this.props.onGoBack?this.props.onGoBack():window.location.href="/user/"}},{key:"toggleViewDropdown",value:function(){this.props.setZIndexHack(!this.state.dropdownOpen),this.setState({dropdownOpen:!this.state.dropdownOpen})}},{key:"duplicateTrack",value:function(){this.sequencerEngine.duplicateTrack(this.props.selectedTrack)}},{key:"onSave",value:function(e,t,n){this.hideSaveModal(),this.props.sequencerEngine.save(e,t,!0,n)}},{key:"hideSaveModal",value:function(){this.setState({showSaveModal:!1})}},{key:"save",value:function(){var e=Object(R.a)(N.a.mark(function e(){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({showSaveModal:!0});case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onSelectResolution",value:function(e){this.props.sequencerEngine.resolution=e,this.props.sequencerEngine.select(this.props.sequencerEngine.cursor.track,0),this.setState(this.state)}},{key:"clickPattern",value:function(e){var t=this.props.sequencerEngine.store.getState();t.keyboard.isCommandDown?this.props.setPatternToEditColor(e):(this.props.sequencerEngine.switchToPattern(e),void 0!==t.toolbar.patternToEditColor&&this.props.setPatternToEditColor(e),this.setState(this.state))}},{key:"onDragStart",value:function(e){this.props.dragPattern(e)}},{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"onDrop",value:function(e){this.props.sequencerEngine.movePatternTo(this.props.patternDragging,e),this.setState(this.state)}},{key:"onPlayMixClicked",value:function(){}},{key:"onClickRecordMixButton",value:function(){}},{key:"onCompactClicked",value:function(){this.props.setCompactMode(!this.props.isCompactMode)}},{key:"onNewClicked",value:function(){window.confirm("Are you sure you want to clear this sequence (and lose any work)?")&&this.props.sequencerEngine.newSequence()}},{key:"getView",value:function(){return"SEQUENCER_VIEW"===this.props.viewMode?"SEQUENCER":"MIX_VIEW"===this.props.viewMode?"MIXER":"PREFERENCES_VIEW"===this.props.viewMode?"PREFERENCES":"ARRANGEMENT_VIEW"===this.props.viewMode?"ARRANGEMENT":"VIEW"}},{key:"onStartSequenceRolling",value:function(){this.props.sequencerEngine.sequenceRolling=!0}},{key:"onStopSequenceRolling",value:function(){this.props.sequencerEngine.sequenceRolling=!1}},{key:"render",value:function(){for(var e=this,t=[],n=0;n<this.props.sequencerEngine.numberOfPatterns();n++)t.push(n);var r=-1;for(var i in this.props.sequencerEngine.tracks){var s=this.props.sequencerEngine.tracks[i].pattern.length();r<s&&(r=s)}return-1==r&&(r=32),a.a.createElement("div",{className:"top-toolbar"},a.a.createElement(zj,{sequencerEngine:this.props.sequencerEngine,onSave:function(t,n,r){return e.onSave(t,n,r)},onHide:function(){return e.hideSaveModal()},show:this.state.showSaveModal}),a.a.createElement("div",{className:"main-toolbar"},a.a.createElement(sT,{sequencerEngine:this.props.sequencerEngine}),a.a.createElement(Lj,{sequencerEngine:this.props.sequencerEngine}),a.a.createElement("div",null,a.a.createElement(Tj,{sequencerEngine:this.props.sequencerEngine}),a.a.createElement(qj,{sequencerEngine:this.props.sequencerEngine})),a.a.createElement(w,{installation:!0,sequencerEngine:this.props.sequencerEngine}),a.a.createElement(uT,{sequencerEngine:this.props.sequencerEngine}),this.props.trackRolling?a.a.createElement("div",{onMouseDown:function(){return e.onStartSequenceRolling()},onMouseUp:function(){return e.onStopSequenceRolling()},className:this.props.sequenceRolling?"roll-button rolling":"roll-button"},"ROLL"):"","OFF"!==this.props.midiMapMode?a.a.createElement("div",{className:"roll-button"},this.props.midiMapMode===cu?"MIDI MAP":"DELETE MIDI MAP"):"",a.a.createElement(Wc,{condition:this.props.viMode},a.a.createElement("div",{className:"roll-button command-button"},"COMMAND")),a.a.createElement("div",{className:"save-container"},a.a.createElement(Wc,{condition:this.props.onGoBack},a.a.createElement("div",{onClick:this.props.onGoBack,className:"go-back-button"},"BACK")),a.a.createElement("span",{onMouseOver:function(){return e.props.setContextualHelp("GUILDS_SELECTOR")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)}},a.a.createElement(Nj,{store:this.props.sequencerEngine.store}),a.a.createElement(jj,{store:this.props.sequencerEngine.store})),a.a.createElement("div",{className:"light-blue-button common-button",onClick:function(){return e.onNewClicked()}},"NEW"),a.a.createElement("div",{className:"pink-button common-button",onClick:function(){return e.save()}},"SAVE"))),a.a.createElement(Wc,{condition:void 0!==this.props.patternToEditColor},a.a.createElement(rT,{sequencerEngine:this.props.sequencerEngine})))}}]),n}(r.Component);new Xe(4,!1),new Xe(4,!0),new Xe(8,!1),new Xe(8,!0),new Xe(16,!1),new Xe(16,!0),new Xe(32,!1),new Xe(32,!0);Object(g.b)(function(e){var t=e.sequencer.sequencerEngine.getSequenceId(),n=e.sequencer.isPlaying[t]||0;return{midiMapMode:e.midi.midiMapMode,isCompactMode:e.sequencer.isCompactMode,resolution:e.sequencer.resolution,sequencerEngine:e.sequencer.sequencerEngine,detailsView:e.sequencer.detailsView,decentralized:e.sequencer.decentralized,viewMode:e.sequencer.viewMode,numberOfPatterns:e.sequencer.numberOfPatterns,samplePack:e.sequencer.samplePack,patternDragging:e.sequencer.patternDragging,isRecordingMix:e.mix.isRecordingMix,isPlayingMix:e.mix.isPlayingMix,isPlaying:n,patternToEditColor:e.toolbar.patternToEditColor,patternColors:e.toolbar.patternColors,trackRolling:e.sequencer.trackRolling,sequenceRolling:e.sequencer.sequenceRolling,viMode:e.commands.viMode}},function(e){return{setResolution:function(t){return e(Object(O.sc)(t))},setViewMode:function(t){return e(Object(O.de)(t))},dragPattern:function(t){return e(Object(O.f)(t))},setIsPlayingMix:function(t){return e(Object(O.Db)(t))},setPatternToEditColor:function(t){return e(Object(O.ec)(t))},setIsRecordingMix:function(t){return e(Object(O.Fb)(t))},setCompactMode:function(t){return e(Object(O.R)(t))},setZIndexHack:function(t){return e(Object(O.ge)(t))},setContextualHelp:function(t){return e(Object(O.U)(t))}}})(pT),n(926),n(927),n(2313),n(928),n(2314),n(2315),n(2316);var hT=28500,fT=(n(526),function(e){var t=a.a.useState(!1),n=Object(j.a)(t,2),r=n[0],i=n[1];return a.a.createElement("div",null,a.a.createElement("div",{onClick:function(){return i(!0)},className:"installation-info"},"Information"),r?a.a.createElement(lh.a,{show:r,onHide:function(){return i(!1)},dialogClassName:"installation-info-modal",centered:!0},a.a.createElement(lh.a.Body,null,"Chronophonics is an interactive installation that lets you contribute to shared musical canvases. Each image below leads to a networked interface where you can take actions to change the music and submit those changes to the shared history of the interface. Mousing over a component in the interface displays information about how to use that component. Each interface has a slider that allows you to traverse the history of the canvas and see other people\u2019s changes. The animations running in the background of each page are reactive to the music being created, and will change along with the music as you traverse the history of a canvas.",a.a.createElement("br",null),a.a.createElement("br",null),"The amount of change you can contribute to the musical canvas is limited to a certain number of actions, with a countdown timer limiting how often you can contribute. In addition, the interface will sometimes block you from performing certain actions - you can think of this as a virtual conductor guiding performers to play a certain score. By scrolling through the history you see the arcs of the conductor\u2019s influence.",a.a.createElement("br",null),a.a.createElement("br",null),"The audio engine is largely repurposed from ",a.a.createElement("a",{href:"http://zequencer.io/",target:"_blank"},"Zequencer"),", a browser-based DAW.")):"")}),dT=function(e){e.setup=function(){var t=e.createCanvas(75,75);t.style("width","100%"),t.style("height","100%"),e.frameRate(30)};var t=function(e,t){return Object(M.a)(Array(t-e).keys()).map(function(t){return t+e})},n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Date.now()/1e3*e+t},r=function(e){return(Math.sin(e)+1)/2};e.draw=function(){var a=e.get(0,0,e.width,e.height);e.set(0,1,a);var i=n(.3);t(0,10).forEach(function(a){var s=255*r(n(.8)+a/10*e.PI);e.stroke(s),e.strokeWeight(.1+r(i+a/10*e.PI));var o=(a+.5)/10*e.height,c=t(0,21).map(function(t){return n=t/20*e.width+i,r=10*a+1,2*(e.noise(n,r)-.5);var n,r});e.beginShape();var u=c.map(function(t,n){return[n/20*e.width,o+t*e.height/10*3]});u[e.floor(u.length/2)]=[e.width/2+e.sin(a/10*2*e.PI)*e.width,e.height/2+e.cos(a/10*2*e.PI)*e.height],u.forEach(function(t){return e.curveVertex.apply(e,Object(M.a)(t))}),e.endShape()})}},mT=Object(r.memo)(function(){return a.a.createElement("div",{className:"landing-visuals"},a.a.createElement(Tc,{sketch:dT}))}),vT=Object(g.b)(null,null)(mT),gT=Object(g.b)(function(e,t){return{rooms:e.installation.rooms,userLoggedIn:e.installation.userLoggedIn}},null)(function(e){return a.a.createElement("div",{className:"installation-landing-page"},a.a.createElement("div",{className:"installation-hero"},a.a.createElement("div",{className:"title"},"Chronophonics"),a.a.createElement("div",{className:"authors"},"Alec Resende, Ryan Rose, Avneesh Sarwate"),e.userLoggedIn?a.a.createElement(fT,null):""),a.a.createElement("div",{className:"break"}),e.userLoggedIn?a.a.createElement("div",{className:"installation-tiles"},Object.keys(e.rooms).map(function(t){return a.a.createElement("div",{key:t},a.a.createElement("div",{className:"installation-tile",style:{backgroundImage:"url(".concat(e.rooms[t].thumbnail,")"),backgroundSize:"cover"}},a.a.createElement("div",{className:"installation-tile-info-name"},t)),a.a.createElement("div",{onClick:function(){return function(t){e.sequencerEngine.operationManager.roomActionsManager.firebaseHandler.enterRoom(t)}(t)},className:"installation-tile-info-enter"},"Enter"))})):a.a.createElement("div",{className:"installation-loading-rooms"},a.a.createElement("div",{className:"installation-loading-rooms-content"},"LOADING",a.a.createElement(v.a,{sizeUnit:"px",size:10,color:"#42f4f1",loading:!e.userLoggedIn}))),a.a.createElement(vT,null))}),yT=function(){return a.a.createElement("div",{className:"installation-multiple-tabs"},a.a.createElement("div",{className:"installation-multiple-tabs-text"},"Ruh roh!"),a.a.createElement("div",{className:"installation-multiple-tabs-text"},"Looks like Chronophonics is open in another window. Only one at a time, please!"),a.a.createElement("div",{className:"installation-multiple-tabs-text"},"Please close the other window and refresh this page."),a.a.createElement("div",{className:"installation-multiple-tabs-error"},"If you think this is an error, try opening Chronophonics in an incognito window."))};function bT(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}new wt.a;var kT=function(e){Object(u.a)(n,e);var t=bT(n);function n(e){var r;Object(o.a)(this,n),r=t.call(this,e),window.installation=!0,r.ethereumCache=new Cn(e.store),r.store=e.store,gn.a.setStore(e.store),gn.a.setEthereum(d.a),gn.a.checkLogin(),d.a.guilds.initGuilds(),d.a.cache=r.ethereumCache,d.a.cache.loadIndex(),x.a.setContext(new AudioContext({sampleRate:hT}));var a,i=void 0!==e.sequencerEngine?e.sequencerEngine.getSequenceId():void 0!=e.match.params.sequenceId?e.match.params.sequenceId:null;return r.state={showPalette:!1,sequenceId:i,resolution:new Xe(16,!1),scriptingFocused:!1,selectedTrack:0,dropdownOpen:!1},d.a.store=r.props.store,d.a.crypto.store=r.props.store,void 0!==r.props.sequencerEngine?(r.sequencerEngine=r.props.sequencerEngine,r.sequencerEngine.tracks.forEach(function(e){return e.updateSteps()})):r.sequencerEngine=new yP(r.props.store),window.sequencerEngine=r.sequencerEngine,r.props.setSequencerEngine(r.sequencerEngine),r.scripting=new bc(r.sequencerEngine),r.sequencerEngine.setScripting(r.scripting),r.keyboardEngine=new lb(r.sequencerEngine),r.sequencerEngine.connectToKeyboardEngine(r.keyboardEngine),r.ethereumSearcher=new vn(r.ethereumCache,r.sequencerEngine),r.sequencerEngine.ethereumCache=r.ethereumCache,a=r.sequencerEngine,window.addEventListener("dragenter",function(e){e.preventDefault(),e.dataTransfer.effectAllowed="none",e.dataTransfer.dropEffect="none"},!1),window.addEventListener("dragover",function(e){return e.preventDefault(),e.dataTransfer.effectAllowed="none",!1}),window.addEventListener("drop",function(){var e=Object(R.a)(N.a.mark(function e(t){var n;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),t.dataTransfer.effectAllowed="none",t.dataTransfer.dropEffect="none",t.dataTransfer.items)for(n=0;n<t.dataTransfer.items.length;n++)"file"===t.dataTransfer.items[n].kind&&nb(a,t.dataTransfer.items[n].getAsFile());else for(n=0;n<t.dataTransfer.files.length;n++);return e.abrupt("return",!1);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("beforeunload",function(e){return e.returnValue="Please dont leave",e}),this.props.setArrangementBottomHeight(Math.min(467,.6*window.innerHeight))}},{key:"onSelectTrack",value:function(e){this.sequencerEngine.cursor.track=e}},{key:"onMouseMoveResize",value:function(e){if(this.store.getState().arrangement.isBottomResizing){var t=window.innerHeight-e.pageY;this.props.setArrangementBottomHeight(Math.max(20,t-5))}}},{key:"onMouseUp",value:function(){this.props.isDragToggled&&this.props.mouseDown(!1),this.store.getState().arrangement.isBottomResizing&&this.props.setArrangementBottomResizing(!1)}},{key:"render",value:function(){var e=this,t=this.sequencerEngine.getSelectedTrack(),n=(void 0!==t&&t.getTrackType(),this.props.loadingSequence);return this.props.multipleTabs?a.a.createElement("div",{className:"sequencer-container installation"},a.a.createElement(yT,null)):this.props.currentRoom?n?a.a.createElement("div",{className:"sequencer-container installation loading-screen"},a.a.createElement(Bt,{roomName:this.props.currentRoom}),a.a.createElement(Mc,{sequencerEngine:this.sequencerEngine})):a.a.createElement("div",{className:"sequencer-container installation"},a.a.createElement("div",{onMouseMove:function(t){return e.onMouseMoveResize(t)},onMouseUp:function(){return e.onMouseUp()},onKeyDown:this.onKeyDown,className:this.props.isTrackFocused?"sequencer-container focused":"sequencer-container installation"},a.a.createElement(tb,{show:this.props.showLogin}),a.a.createElement(db,{sequencerEngine:this.sequencerEngine}),a.a.createElement("div",{className:"scroll-area"},a.a.createElement(Ft,{sequencerEngine:this.sequencerEngine}),a.a.createElement("div",{className:"main-area"},a.a.createElement(yj,{alreadyLoaded:void 0!==this.props.sequencerEngine,hideModulators:!0,installation:!0,oneTrack:!0,sequencerEngine:this.sequencerEngine,scriptingInput:this.scriptingInput,sequenceId:this.state.sequenceId,selectedTrack:this.sequencerEngine.cursor.track,stretchTracks:!1,history:this.props.history,keyboardEngine:this.keyboardEngine,focusScripting:function(){return[]},hideSequencer:!1}),n?"":a.a.createElement(Mc,{sequencerEngine:this.sequencerEngine}))),a.a.createElement(Xy,{sequencerEngine:this.sequencerEngine}))):a.a.createElement("div",{className:"sequencer-container installation"},a.a.createElement(gT,{sequencerEngine:this.sequencerEngine}))}}]),n}(r.Component),ET=Object(g.b)(function(e){return{multipleTabs:e.installation.multipleTabs,currentRoom:e.installation.currentRoom,viewMode:e.sequencer.viewMode,detailsView:e.sequencer.detailsView,showSelectorMode:e.sequencer.showSelectorMode,decentralized:e.sequencer.decentralized,isDragToggled:e.sequencer.isDragToggled,isTrackFocused:void 0!==e.sequencer.trackFocused,loadingSequence:e.sequencer.loadingSequence,showSequences:e.sequencer.showSequences,showInstruments:e.sequencer.showInstruments,showPresets:e.sequencer.showPresets,zIndexHack:e.sequencer.zIndexHack,showLogin:e.sequencer.showLogin,selectedTrack:e.mix.selectedTrack}},function(e){return{setArrangementBottomHeight:function(t){return e(Object(O.w)(t))},setArrangementBottomResizing:function(t){return e(Object(O.x)(t))},setSequencerEngine:function(t){return e(Object(O.Sc)(t))},mouseDown:function(t){return e(Object(O.k)(t))},setSelectorMode:function(t){return e(Object(O.Nc)(t))},setShowPresets:function(t){return e(Object(O.dd)(t))},setShowInstruments:function(t){return e(Object(O.Xc)(t))},setShowSequences:function(t){return e(Object(O.gd)(t))}}})(kT),OT=(n(2317),n(2332)),ST=n(2333),PT=n(2331);function wT(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var jT=function(e){Object(u.a)(n,e);var t=wT(n);function n(e){var r;return Object(o.a)(this,n),r=t.call(this,e),console.log("store = "),console.log(e.store),r}return Object(c.a)(n,[{key:"render",value:function(){var e=this;return a.a.createElement(PT.a,null,a.a.createElement(OT.a,null,a.a.createElement(ST.a,{path:"/",render:function(t){return a.a.createElement(ET,Object.assign({},t,{store:e.props.store}))}})))}}]),n}(r.Component);var TT=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function xT(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}var CT=n(247),NT=n(2),RT={viewMode:"SEQUENCER_VIEW",showPianoRoll:!1,alternateViewMode:"ARRANGEMENT_VIEW",decentralized:!0,masterVolumes:{},showSelectorMode:!1,resolution:new Xe(16,!1),numberOfPatterns:{},currentPattern:{},currentStep:{},currentGlobalStep:{},isPlaying:{},samplePack:void 0,sampleDragging:void 0,effectDragging:void 0,patternDragging:void 0,tracksRecording:{},tracksPreparingToRecord:{},trackSteps:{},quantized:!0,isRecording:!1,isRecordingExpanded:!1,sequenceName:void 0,trackFocused:void 0,loadingSequence:!0,isCompactMode:!1,showEnvelopes:!1,showLFOs:!1,selectedLFO:1,selectedEnvelope:1,automationMode:"PLAY",showSequenceModal:!1,showModsModal:!1,sequenceRolling:!1,trackRolling:!1,showInstruments:!1,showSequences:!1,showPresets:!1,zIndexHack:!1,resampleMaster:!1,audioInputSource:void 0,latency:0,patternLocks:{},clockType:"NONE",showConvolverModal:!1,convolverSample:void 0,showLogin:!1,signingUp:!1,userToken:void 0,showPasswordModal:!1,passwordModalCallback:void 0,contextualHelp:void 0,showGroups:!1,currentSubSequence:{},subSequences:{},sidebarViewMode:"SOUNDS"},DT=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:RT,t=arguments.length>1?arguments[1]:void 0,n={},r={};switch(t.type){case NT.n:return Object(D.a)({},e,{isPlaying:{}});case NT.id:return Object(D.a)({},e,{resolution:t.payload});case NT.Rd:return Object(D.a)({},e,{sequencerEngine:t.payload});case NT.zf:return"SEQUENCER_VIEW"===t.payload?n=Object(D.a)({},e,{viewMode:t.payload,showSelectorMode:!1,sidebarViewMode:"SOUNDS"}):(n=Object(D.a)({},e,{viewMode:t.payload}),"MIX_VIEW"!==t.payload&&"ARRANGEMENT_VIEW"!==t.payload||(n.alternateViewMode=t.payload)),n;case NT.yb:return Object(D.a)({},e,{viewMode:t.payload});case NT.fe:return Object(D.a)({},e,{showLogin:t.payload});case NT.wf:return void 0===t.payload.userName?Object(D.a)({},e,{userToken:void 0}):Object(D.a)({},e,{userToken:t.payload});case NT.ye:return Object(D.a)({},e,{signingUp:t.payload});case NT.xb:return Object(D.a)({},e,{decentralized:t.payload});case NT.Od:return Object(D.a)({},e,{showSelectorMode:t.payload});case NT.ob:return(n=Object(D.a)({},e)).currentPattern[t.payload.sequenceId]=t.payload.currentPattern,n;case NT.Ic:var a=e.numberOfPatterns;return a[t.payload.id]=t.payload.numberOfPatterns,Object(D.a)({},e,{numberOfPatterns:a});case NT.lb:return(n=Object(D.a)({},e)).currentStep[t.payload.sequenceId]=t.payload.currentStep,n.currentGlobalStep[t.payload.sequenceId]=t.payload.currentGlobalStep,n;case NT.qb:return(n=Object(D.a)({},e)).currentStep[t.payload.sequenceId]=t.payload.currentStep,n;case NT.mb:return(n=Object(D.a)({},e)).currentGlobalStep[t.payload.sequenceId]=t.payload.currentGlobalStep,n;case NT.nd:return Object(D.a)({},e,{samplePack:t.payload});case NT.i:return Object(D.a)({},e,{sampleDragging:t.payload});case NT.g:return Object(D.a)({},e,{effectDragging:t.payload});case NT.h:return Object(D.a)({},e,{patternDragging:t.payload});case NT.Mf:return(n=Object(D.a)({},e)).tracksRecording[t.payload.trackNumber]=t.payload.recording,n.tracksPreparingToRecord[t.payload.trackNumber]=!1,n;case NT.Lf:return(n=Object(D.a)({},e)).tracksRecording[t.payload.trackNumber]=!1,n.tracksPreparingToRecord[t.payload.trackNumber]=t.payload.preparing,n;case NT.dd:return Object(D.a)({},e,{quantized:t.payload});case NT.lc:return Object(D.a)({},e,{isRecording:t.payload});case NT.mc:return Object(D.a)({},e,{isRecordingExpanded:t.payload});case NT.jc:var i=Object(D.a)({},e.isPlaying);return i[t.payload.sequenceId]=t.payload.isPlaying,n=Object(D.a)({},e,{isPlaying:i});case NT.zc:return(n=Object(D.a)({},e)).masterVolumes[t.payload.sequenceId]=t.payload.volume,n;case NT.Sd:return Object(D.a)({},e,{sequenceName:t.payload});case NT.tc:return Object(D.a)({},e,{latency:t.payload});case NT.cf:return Object(D.a)({},e,{trackFocused:t.payload});case NT.gb:return Object(D.a)({},e,{isCompactMode:t.payload});case NT.ee:return Object(D.a)({},e,{showLFOs:t.payload,showEnvelopes:!1});case NT.Ad:return Object(D.a)({},e,{selectedLFO:t.payload});case NT.wd:return Object(D.a)({},e,{selectedEnvelope:t.payload});case NT.be:return Object(D.a)({},e,{showEnvelopes:t.payload,showLFOs:!1});case NT.db:return Object(D.a)({},e,{clockType:t.payload});case NT.ne:return Object(D.a)({},e,{showSequenceModal:t.payload});case NT.jb:return Object(D.a)({},e,{contextualHelp:t.payload});case NT.ge:return Object(D.a)({},e,{showModsModal:t.payload});case NT.xc:return Object(D.a)({},e,{loadingSequence:t.payload});case NT.cd:return Object(D.a)({},e,{automationMode:t.payload});case NT.Vd:return Object(D.a)({},e,{sequenceRolling:t.payload});case NT.lf:return Object(D.a)({},e,{trackRolling:t.payload});case NT.me:return Object(D.a)({},e,{showSequences:t.payload});case NT.de:return Object(D.a)({},e,{showInstruments:t.payload});case NT.ke:return Object(D.a)({},e,{showPresets:t.payload});case NT.If:return Object(D.a)({},e,{zIndexHack:t.payload});case NT.hd:return Object(D.a)({},e,{resampleMaster:t.payload});case NT.R:return Object(D.a)({},e,{audioInputSource:t.payload});case NT.Td:return r=Object(D.a)({},e.patternLocks),!t.payload.subSequence in r&&(r[t.payload.subSequence]={}),r[t.payload.subSequence][t.payload.patternNumber]=t.payload.locked,Object(D.a)({},e,{patternLocks:r});case NT.Ud:return r=Object(D.a)({},e.patternLocks),!t.payload.subSequence in t.payload.patternLocks&&(r[t.payload.subSequence]={}),r[t.payload.subSequence]=t.payload.patternLocks,Object(D.a)({},e,{patternLocks:r});case NT.ie:return Object(D.a)({},e,{showPasswordModal:t.payload});case NT.Rc:return Object(D.a)({},e,{passwordModalCallback:t.payload});case NT.Yd:return Object(D.a)({},e,{showConvolverModal:t.payload.show,convolverSample:t.payload.convolverSample});case NT.ce:return Object(D.a)({},e,{showGroups:t.payload});case NT.je:return Object(D.a)({},e,{showPianoRoll:t.payload});case NT.Me:var s=e.subSequences;return s[t.payload.sequenceId]=t.payload.ids,Object(D.a)({},e,{subSequences:s});case NT.rb:var o=e.currentSubSequence;return o[t.payload.sequenceId]=t.payload.subSequenceId,Object(D.a)({},e,{currentSubSequence:o});case NT.xe:return Object(D.a)({},e,{sidebarViewMode:t.payload});default:return e}},qT={multipleTabs:!1,userLoggedIn:!1,browseHistory:!1,historyLength:0,historyTimestamp:0,historyPosition:0,actionsRemaining:0,timeRemaining:0,numMembers:0,currentRoom:void 0,rooms:{},roomType:jg,queuedContentIds:[],knobsEnabled:[],sendsEnabled:[],notesEnabled:new Set,stepsEnabled:{},tracksEnabled:[],loadingProgress:0,muted:!1,showToast:!1,toastMessage:"",hideInterface:!1,undoLength:0,redoLength:0},MT=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qT,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case NT.r:return Object(D.a)({},e,{actionsRemaining:t.payload});case NT.Re:return Object(D.a)({},e,{timeRemaining:t.payload});case NT.Jc:return Object(D.a)({},e,{numMembers:t.payload});case NT.pb:return Object(D.a)({},e,{currentRoom:t.payload});case NT.jd:var n=Object(D.a)({},e.rooms);return n[t.payload.roomName]=t.payload,Object(D.a)({},e,{rooms:n});case NT.o:var r=Object(D.a)({},e.rooms);return delete r[t.payload],Object(D.a)({},e,{rooms:r});case NT.fc:return Object(D.a)({},e,{userLoggedIn:t.payload});case NT.ab:return Object(D.a)({},e,{browseHistory:t.payload});case NT.ac:return Object(D.a)({},e,{historyLength:t.payload});case NT.cc:return Object(D.a)({},e,{historyTimestamp:t.payload});case NT.bc:return Object(D.a)({},e,{historyPosition:t.payload});case NT.ed:return Object(D.a)({},e,{queuedContentIds:t.payload});case NT.se:return Object(D.a)({},e,{showToast:t.payload});case NT.Se:return Object(D.a)({},e,{toastMessage:t.payload});case NT.Xb:return Object(D.a)({},e,{hideInterface:t.payload});case NT.Hc:return Object(D.a)({},e,{notesEnabled:t.payload});case NT.qc:return Object(D.a)({},e,{knobsEnabled:t.payload});case NT.Pd:return Object(D.a)({},e,{sendsEnabled:t.payload});case NT.Ue:return Object(D.a)({},e,{tracksEnabled:t.payload});case NT.Ce:return Object(D.a)({},e,{stepsEnabled:t.payload});case NT.wc:return Object(D.a)({},e,{loadingProgress:t.payload});case NT.ec:return Object(D.a)({},e,{muted:t.payload});case NT.Fc:return Object(D.a)({},e,{multipleTabs:t.payload});case NT.uf:return Object(D.a)({},e,{undoLength:t.payload.undo,redoLength:t.payload.redo});default:return e}},AT={triggers:{},trackSteps:{},trackTConvert:void 0,trackStepIds:{},selectedRackSubTrack:{},trackFills:{},tracksFrozen:{},frozenTracksPlaying:{},trackPatternSteps:{},trackPianoRollSteps:{},trackPianoRollDurations:{},trackVolumes:{},trackPannings:{},trackMutes:{},trackSolos:{},groupVolumes:{},groupPannings:{},groupMutes:{},trackWarps:{},trackPianoRollPositions:{},sendMutes:{},trackSendVolumes:{},trackIsEnabled:{},selectedSampleTags:{},tracksToResample:[],trackToFreeze:void 0,trackPatternLocks:{},trackEffectsChain:{},showTrackEffects:{},lfoPatternLocks:{},envelopePatternLocks:{},isResampling:!1,resampleDuration:1,sampleSlices:{},trackIsLoading:{},annotationDragging:void 0,allSteps:{},allDurations:{},allPositions:{}},IT=function(e){var t={},n={},r={},a=e.trackPianoRollSteps,i=e.trackPianoRollDurations,s=e.trackPianoRollPositions;for(var o in a){var c=a[o];for(var u in c){var l=c[u],p=i[o][u],h=s[o][u];for(var f in void 0===t[u]&&(t[u]={},n[u]={},r[u]={}),l)l[f]&&(t[u][f]=parseInt(o)),r[u][f]=h[f],n[u][f]=p[f]}}return{allSteps:t,allPositions:r,allDurations:n}},LT=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:AT,n=arguments.length>1?arguments[1]:void 0,r=void 0,a=void 0;switch(n.type){case NT.n:return AT;case NT.Jf:return void 0===(e=Object(D.a)({},t)).triggers[n.payload.trackNumber]&&(e.triggers[n.payload.trackNumber]={}),e.triggers[n.payload.trackNumber][n.payload.sliceNumber]=!0,e;case NT.Kf:return void 0===(e=Object(D.a)({},t)).triggers[n.payload.trackNumber]&&(e.triggers[n.payload.trackNumber]={}),e.triggers[n.payload.trackNumber][n.payload.sliceNumber]=!1,e;case NT.x:return(e=Object(D.a)({},t)).trackSteps[n.payload.trackNumber]=n.payload.steps,e.trackPatternSteps[n.payload.trackNumber]=n.payload.patternSteps,e.trackFills[n.payload.trackNumber]=n.payload.fills,e.trackStepIds[n.payload.trackNumber]=n.payload.stepToId,n.payload.pianoRollSteps&&(e.trackPianoRollSteps[n.payload.trackNumber]=n.payload.pianoRollSteps),e.trackPianoRollPositions[n.payload.trackNumber]=n.payload.stepToPosition,e.trackPianoRollDurations[n.payload.trackNumber]=n.payload.pianoRollDurations,n.payload.combineAllSteps?Object(D.a)({},e,IT(e)):Object(D.a)({},e);case NT.Nf:for(var i in(e=Object(D.a)({},t)).trackSteps={},e.trackFills={},e.trackPianoRollSteps={},e.trackStepIds={},e.trackPatternSteps={},e.trackPianoRollPositions={},e.trackPianoRollDurations={},e.trackMutes={},n.payload){var s=n.payload[i];e.trackSteps[s.trackNumber]=s.steps,e.trackFills[s.trackNumber]=s.trackFills,e.trackStepIds[s.trackNumber]=s.stepToId,e.trackPatternSteps[s.trackNumber]=s.trackPatternSteps,void 0!==s.pianoRollSteps&&(e.trackPianoRollSteps[s.trackNumber]=s.pianoRollSteps),e.trackPianoRollPositions[s.trackNumber]=s.pianoRollPositions,e.trackPianoRollDurations[s.trackNumber]=s.pianoRollDurations,e.trackMutes[s.trackNumber]=s.muted}return Object(D.a)({},e,IT(e));case NT.of:return(e=Object(D.a)({},t)).trackSteps[n.payload.trackNumber]=n.payload.steps,e;case NT.bf:return(e=Object(D.a)({},t)).trackFills[n.payload.trackNumber]=n.payload.fills,e;case NT.kf:return(e=Object(D.a)({},t)).trackPianoRollSteps[n.payload.trackNumber]=n.payload.steps,Object(D.a)({},e,IT(e));case NT.gf:return(e=Object(D.a)({},t)).trackMutes[n.payload.trackNumber]=n.payload.muted,e;case NT.nf:return(e=Object(D.a)({},t)).trackSolos[n.payload.trackNumber]=n.payload.solo,e;case NT.rf:return(e=Object(D.a)({},t)).trackVolumes[n.payload.trackNumber]=n.payload.volume,e;case NT.hf:return(e=Object(D.a)({},t)).trackPannings[n.payload.trackNumber]=n.payload.pan,e;case NT.Vb:return(e=Object(D.a)({},t)).groupVolumes[n.payload.groupNumber]=n.payload.volume,e;case NT.Ub:return(e=Object(D.a)({},t)).groupPannings[n.payload.groupNumber]=n.payload.pan,e;case NT.Tb:return(e=Object(D.a)({},t)).groupMutes[n.payload.groupNumber]=n.payload.muted,e;case NT.Qd:return(e=Object(D.a)({},t)).sendMutes[n.payload.sendNumber]=n.payload.muted,e;case NT.mf:return void 0===(r=(e=Object(D.a)({},t)).trackSendVolumes[n.payload.trackVolume])&&(r={}),r[n.payload.sendNumber]=n.payload.volume,e.trackSendVolumes[n.payload.trackVolume]=r,e;case NT.ef:var o=(e=Object(D.a)({},t)).trackIsEnabled[n.payload.subSequenceId]||{};return o[n.payload.trackNumber]=n.payload.isEnabled,e.trackIsEnabled[n.payload.subSequenceId]=o,e;case NT.sf:var c=(e=Object(D.a)({},t)).trackWarps[n.payload.subSequenceId]||{};return c[n.payload.trackNumber]=n.payload.warp,e.trackWarps[n.payload.subSequenceId]=c,e;case NT.Pe:return(e=Object(D.a)({},t)).trackWarps[n.payload.subSequenceId]=n.payload.warps,e;case NT.Id:return(e=Object(D.a)({},t)).selectedSampleTags[n.payload.sampleId]=n.payload.tag,e;case NT.w:return Object(D.a)({},t,{trackPatternLocks:n.payload});case NT.v:return Object(D.a)({},t,{lfoPatternLocks:n.payload});case NT.u:return Object(D.a)({},t,{envelopePatternLocks:n.payload});case NT.qf:return Object(D.a)({},t,{trackToFreeze:n.payload});case NT.if:return void 0===(e=Object(D.a)({},t)).trackPatternLocks[n.payload.subSequence]&&(e.trackPatternLocks[n.payload.subSequence]={}),(r=e.trackPatternLocks[n.payload.subSequence][n.payload.trackNumber]||{})[n.payload.patternNumber]=n.payload.locked,e.trackPatternLocks[n.payload.subSequence][n.payload.trackNumber]=r,e;case NT.jf:return void 0===(e=Object(D.a)({},t)).trackPatternLocks[n.payload.subSequence]&&(e.trackPatternLocks[n.payload.subSequence]={}),e.trackPatternLocks[n.payload.subSequence][n.payload.trackNumber]=n.payload.patternLocks,e;case NT.Ve:return Object(D.a)({},t,{tracksToResample:n.payload});case NT.Ib:return(e=Object(D.a)({},t)).envelopePatternLocks[n.payload.subSequence]=n.payload.patternLocks,e;case NT.uc:return(e=Object(D.a)({},t)).lfoPatternLocks[n.payload.subSequence]=n.payload.patternLocks,e;case NT.oc:return Object(D.a)({},t,{isResampling:n.payload});case NT.gd:return Object(D.a)({},t,{resampleDuration:n.payload});case NT.af:return(e=Object(D.a)({},t)).trackEffectsChain[n.payload.trackNumber]=n.payload.effectsChain,e;case NT.od:return(e=Object(D.a)({},t)).sampleSlices[n.payload.id]=n.payload.slices,e;case NT.te:return(e=Object(D.a)({},t)).showTrackEffects[n.payload.trackNumber]=n.payload.show,e;case NT.l:for(var u in(e=Object(D.a)({},t)).showTrackEffects)e.showTrackEffects[u]=!1;return e;case NT.df:return(a=(e=Object(D.a)({},t)).tracksFrozen[n.payload.subSequenceId]||{})[n.payload.trackNumber]=n.payload.frozen,e.tracksFrozen[n.payload.subSequenceId]=a,e;case NT.ff:return(a=(e=Object(D.a)({},t)).trackIsLoading[n.payload.subSequenceId]||{})[n.payload.trackNumber]=n.payload.isLoading,e.trackIsLoading[n.payload.subSequenceId]=a,e;case NT.Sb:return(a=(e=Object(D.a)({},t)).frozenTracksPlaying[n.payload.subSequenceId]||{})[n.payload.trackNumber]=n.payload.playing,e.frozenTracksPlaying[n.payload.subSequenceId]=a,e;case NT.Qb:return(e=Object(D.a)({},t)).tracksFrozen[n.payload.subSequenceId]=n.payload.frozenTracks,e;case NT.Rb:return(e=Object(D.a)({},t)).frozenTracksPlaying[n.payload.subSequenceId]=n.payload.frozenTracksPlaying,e;case NT.Mc:return(e=Object(D.a)({},t)).parametersToRecord=n.payload,e;case NT.z:return Object(D.a)({},t,{annotationDragging:n.payload});case NT.pf:return Object(D.a)({},t,{trackToConvert:n.payload});case NT.Gd:var l=Object(D.a)({},t.selectedRackSubTrack);return l[n.payload.trackId]=n.payload.track,Object(D.a)({},t,{selectedRackSubTrack:l});default:return t}},FT=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case NT.n:return{};case NT.kd:var n=Object.assign({},e);return n[t.payload.sampleId]=t.payload.sample,n;default:return e}},BT={guidePoint:void 0,pointHovered:void 0,pointHasMoved:!1,pointsSelected:[],selection:void 0,parameterAutomations:{},automationSchedulers:{},trackDevice:{},trackSubDevice:{},trackRackDevice:{},trackParameter:{},show:!1},HT=function(){var e,t,n,r,a,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:BT,s=arguments.length>1?arguments[1]:void 0;switch(s.type){case NT.We:var o=Object(D.a)({},i.trackDevice);return o[s.payload.trackId]=s.payload.device,(t=Object(D.a)({},i.trackParameter))[s.payload.trackId]=void 0,Object(D.a)({},i,{trackDevice:o,trackParameter:t});case NT.Ye:var c=Object(D.a)({},i.trackRackDevice);return c[s.payload.trackId]=s.payload.device,Object(D.a)({},i,{trackRackDevice:c});case NT.c:return n=Object(D.a)({},i.parameterAutomations),a=Object(D.a)({},i.automationSchedulers),delete n[s.payload],delete a[s.payload],Object(D.a)({},i,{parameterAutomations:n,automationSchedulers:a});case NT.d:return 0===s.payload.length?i:(r=s.payload[0].sequencerEngine.sequenceId,n=i.parameterAutomations[r]||{},a=i.automationSchedulers[r]||{},s.payload.forEach(function(e){delete n[e.id],delete a[e.id]}),(e=Object(D.a)({},i)).parameterAutomations[r]=n,e.automationSchedulers[r]=n,e);case NT.Ze:var u=Object(D.a)({},i.trackSubDevice);return u[s.payload.trackId]=s.payload.subDevice,(t=Object(D.a)({},i.trackParameter))[s.payload.trackId]=void 0,Object(D.a)({},i,{trackSubDevice:u,trackParameter:t});case NT.Xe:return(t=Object(D.a)({},i.trackParameter))[s.payload.trackId]=s.payload.parameter,Object(D.a)({},i,{trackParameter:t});case NT.Wd:return Object(D.a)({},i,{show:s.payload.show});case NT.Nc:return r=s.payload.parameter.sequencerEngine.sequenceId,n=i.parameterAutomations[r]||{},a=i.automationSchedulers[r]||{},n[s.payload.parameter.id]=s.payload.automations,a[s.payload.parameter.id]=s.payload.scheduler,(e=Object(D.a)({},i)).parameterAutomations[r]=n,e.automationSchedulers[r]=a,e;case NT.S:return Object(D.a)({},i,{guidePoint:s.payload});case NT.U:return Object(D.a)({},i,{pointDragging:s.payload});case NT.V:return Object(D.a)({},i,{pointHasMoved:s.payload});case NT.W:return Object(D.a)({},i,{pointHovered:s.payload});case NT.T:return Object(D.a)({},i,{pointsSelected:s.payload});case NT.X:return Object(D.a)({},i,{selection:s.payload});default:return i}},VT={track:0,step:0,show:!1},UT=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:VT,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case NT.vb:return Object(D.a)({},e,{track:t.payload});case NT.ub:return Object(D.a)({},e,{step:t.payload});case NT.tb:return Object(D.a)({},e,{show:t.payload});default:return e}},JT=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case NT.gc:return{instrumentTypeDragging:t.payload};default:return e}},_T={selectedGuild:void 0},GT=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_T,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case NT.zd:return Object(D.a)({},e,{selectedGuild:t.payload});default:return e}},zT=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;switch(n.type){case NT.a:return(e=Object.assign({},t))[n.payload.id]=n.payload,e;case NT.p:return delete(e=Object.assign({},t))[n.payload.id],e;default:return t}},WT={selectedGroup:void 0,selectedTrack:void 0,selectedStep:void 0,hoveredStep:void 0,selectedParameter:void 0,selectedParameterFlashing:void 0,effectsPaneOption:"EFFECTS",isPlayingMix:!1,isRecordingMix:!1,erasingAutomation:!1,mixes:[],currentMix:void 0,multiParameterSliderValues:{},mixViewMode:"MIXES",subSequenceFades:{},subSequenceMuted:{},selectedSequence:void 0},KT=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:WT,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case NT.yd:return Object(D.a)({},e,{selectedGroup:t.payload});case NT.Nd:return Object(D.a)({},e,{selectedTrack:t.payload});case NT.Ld:return Object(D.a)({},e,{selectedStep:t.payload});case NT.dc:return Object(D.a)({},e,{hoveredStep:t.payload});case NT.Cd:return Object(D.a)({},e,{selectedParameter:t.payload});case NT.Dd:return Object(D.a)({},e,{selectedParameterFlashing:t.payload});case NT.Db:return Object(D.a)({},e,{effectsPaneOption:t.payload});case NT.nc:return Object(D.a)({},e,{isRecordingMix:t.payload});case NT.kc:return Object(D.a)({},e,{isPlayingMix:t.payload});case NT.Cc:return Object(D.a)({},e,{mixes:t.payload});case NT.nb:return Object(D.a)({},e,{currentMix:t.payload});case NT.Jb:return Object(D.a)({},e,{erasingAutomation:t.payload});case NT.Ec:return Object(D.a)({},e,{mixViewMode:t.payload});case NT.Ne:var n=Object(D.a)({},e.subSequenceFades);return n[t.payload.subSequenceId]=t.payload.value,Object(D.a)({},e,{subSequenceFades:n});case NT.Gc:var r=e.multiParameterSliderValues;return r[t.payload.id]=t.payload.value,Object(D.a)({},e,{multiParameterSliderValues:r});case NT.Oe:var a=Object(D.a)({},e);return a.subSequenceMuted[t.payload.id]=t.payload.muted,a;case NT.Kd:return Object(D.a)({},e,{selectedSequence:t.payload});default:return e}},QT={selectedFolder:void 0,folderDragging:void 0,presetDragging:void 0,selectedPreset:void 0,hasChangesToFolders:!1},XT=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:QT,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case NT.xd:return Object(D.a)({},e,{selectedPreset:void 0,selectedFolder:t.payload});case NT.Fd:return Object(D.a)({},e,{selectedFolder:void 0,selectedPreset:t.payload});case NT.Wb:return Object(D.a)({},e,{hasChangesToFolders:t.payload});case NT.Pb:return Object(D.a)({},e,{folderDragging:t.payload});case NT.bd:return Object(D.a)({},e,{presetDragging:t.payload});default:return e}},YT={notes:[],isDragToggled:!1,dragStepTranspose:void 0,stepDragging:void 0,stepDataDragging:void 0,isDraggingDuration:!1,stepToCopy:void 0,transposeDragging:void 0,isMouseDown:!1,isCommandDown:!1,pianoRollSelection:void 0,selectedPianoRollSteps:void 0,stepsToCopy:void 0,easyPatternToCopy:void 0,lastMidiKeyMapped:void 0,pianoRollPagination:void 0,keyMappings:{},padMappings:{},lastNotePlayed:void 0,dragOffset:void 0,cursor:void 0},ZT=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:YT,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case NT.k:return Object(D.a)({},e,{isDragToggled:t.payload});case NT.j:return Object(D.a)({},e,{dragStepTranspose:t.payload});case NT.m:var n=t.payload;return Object(D.a)({},e,{isMouseDown:n});case NT.b:return Object(D.a)({},e,{isCommandDown:t.payload});case NT.He:return Object(D.a)({},e,{stepDragging:t.payload});case NT.Ke:return Object(D.a)({},e,{stepToCopy:t.payload});case NT.hc:return Object(D.a)({},e,{isDraggingDuration:t.payload});case NT.Xc:return Object(D.a)({},e,{notes:t.payload});case NT.Fe:return Object(D.a)({},e,{stepDataDragging:t.payload.stepData,stepDragging:t.payload.stepNumber});case NT.Ge:return Object(D.a)({},e,{stepDataDragging:t.payload});case NT.Zc:return void 0===t.payload.stepNumber?Object(D.a)({},e,{pianoRollSelection:void 0}):Object(D.a)({},e,{pianoRollSelection:t.payload});case NT.Ed:return Object(D.a)({},e,{selectedPianoRollSteps:t.payload});case NT.Ee:return Object(D.a)({},e,{stepsToCopy:t.payload});case NT.Ab:return Object(D.a)({},e,{easyPatternToCopy:t.payload});case NT.rc:return Object(D.a)({},e,{lastMidiKeyMapped:t.payload});case NT.tf:return Object(D.a)({},e,{transposeDragging:t.payload.transpose});case NT.Yc:return Object(D.a)({},e,{pianoRollPagination:t.payload});case NT.pc:return Object(D.a)({},e,{keyMappings:t.payload});case NT.Lc:return Object(D.a)({},e,{padMappings:t.payload});case NT.sc:return Object(D.a)({},e,{lastNotePlayed:t.payload});case NT.Wc:return Object(D.a)({},e,{dragOffset:t.payload});case NT.Vc:return Object(D.a)({},e,{cursor:t.payload});default:return e}},$T={selectedEffect:void 0,parameterToMap:void 0,selectedSendEffect:void 0,effectParameters:{},midiEffectDragging:void 0,effectCollapsed:{},effectsChainToShow:{},effectRackNodePositions:{},isMacroMapping:!1},ex=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$T,t=arguments.length>1?arguments[1]:void 0,n=Object(D.a)({},e);switch(t.type){case NT.n:return $T;case NT.vd:return Object(D.a)({},e,{selectedEffect:t.payload});case NT.ic:return Object(D.a)({},e,{isMacroMapping:t.payload});case NT.Qc:return Object(D.a)({},e,{parameterToMap:t.payload});case NT.Jd:return Object(D.a)({},e,{selectedSendEffect:t.payload});case NT.Ac:return Object(D.a)({},e,{midiEffectDragging:t.payload});case NT.Fb:return(n=Object(D.a)({},e)).effectParameters[t.payload.id]=t.payload.value,n;case NT.Gb:var r=Object(D.a)({},e.effectParameters,t.payload);return Object(D.a)({},e,{effectParameters:r});case NT.Cb:var a=Object(D.a)({},e.effectsChainToShow),i=a[t.payload.subSequenceId]||{};return i[t.payload.trackNumber]=t.payload.chainNumber,a[t.payload.subSequenceId]=i,Object(D.a)({},e,{effectsChainToShow:a});case NT.Eb:return(n=Object(D.a)({},e)).effectCollapsed[t.payload.id]=t.payload.isCollapsed,n;case NT.Bb:return(n=Object(D.a)({},e)).effectsChainToShow[t.payload.subSequenceId]=t.payload.effectsChains,n;case NT.Hb:var s=e.effectRackNodePositions[t.payload.rackId]||{};s[t.payload.effectId]={x:t.payload.x,y:t.payload.y};var o=Object(D.a)({},e.effectRackNodePositions);return o[t.payload.rackId]=s,Object(D.a)({},e,{effectRackNodePositions:o});default:return e}},tx={yearSelected:void 0,countriesSelected:{},sampleToExplore:void 0,stylesSelected:{},tagsSelected:{},videosSelected:{},discogsSelected:{},sampleDragging:void 0,chordSelected:void 0,hierarchyRoot:void 0,hierarchyTreeTags:void 0,showYearSlider:!1,showCountries:!1,showStyles:!1,showVideos:!1,showTags:!1,showChordFilter:!1,showDateSampled:!1,searchResultsSamples:[],selectedChordSample:void 0,waveformSelection:void 0,sortBy:"RANDOM",sidebarCollapsed:!1,dateSampled:void 0,startX:0,startY:0,endX:0,endY:0,similarSoundsToFind:void 0,showSamples2D:!1,searchResultsStart:0},nx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:tx,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case NT.Gf:return Object(D.a)({},e,{yearSelected:t.payload});case NT.Qe:return Object(D.a)({},e,{tagsSelected:t.payload});case NT.rd:return Object(D.a)({},e,{searchResultsStart:t.payload});case NT.kb:return Object(D.a)({},e,{countriesSelected:t.payload});case NT.yf:return Object(D.a)({},e,{videosSelected:t.payload});case NT.zb:return Object(D.a)({},e,{discogsSelected:t.payload});case NT.Le:return Object(D.a)({},e,{stylesSelected:t.payload});case NT.Yb:return Object(D.a)({},e,{hierarchyRoot:t.payload});case NT.Zb:return Object(D.a)({},e,{hierarchyTreeTags:t.payload});case NT.re:return Object(D.a)({},e,{showTags:t.payload});case NT.ve:return Object(D.a)({},e,{showYearSlider:t.payload});case NT.Zd:return Object(D.a)({},e,{showCountries:t.payload});case NT.qe:return Object(D.a)({},e,{showStyles:t.payload});case NT.Xd:return Object(D.a)({},e,{showChordFilter:t.payload});case NT.bb:return Object(D.a)({},e,{chordSelected:t.payload});case NT.qd:return Object(D.a)({},e,{searchResultsSamples:t.payload});case NT.ud:return Object(D.a)({},e,{selectedChordSample:t.payload});case NT.ue:return Object(D.a)({},e,{showVideos:t.payload});case NT.Bf:return Object(D.a)({},e,{waveformSelection:t.payload});case NT.Cf:var n=Object(D.a)({},e.waveformSelection,{end:t.payload});return Object(D.a)({},e,{waveformSelection:n});case NT.sd:return Object(D.a)({},e,{sortBy:t.payload});case NT.we:return Object(D.a)({},e,{sidebarCollapsed:t.payload});case NT.ae:return Object(D.a)({},e,{showDateSampled:t.payload});case NT.wb:return Object(D.a)({},e,{dateSampled:t.payload});case NT.ze:return Object(D.a)({},e,{similarSoundsToFind:t.payload});case NT.le:return Object(D.a)({},e,{showSamples2D:t.payload});case NT.q:return Object(D.a)({},e,{startX:t.payload.startX,startY:t.payload.startY,endX:t.payload.endX,endY:t.payload.endY});case NT.md:return Object(D.a)({},e,{sampleDragging:t.payload});case NT.pd:return Object(D.a)({},e,{showSamples2D:void 0!==t.payload,sampleToExplore:t.payload});default:return e}},rx={sampleAuditioning:void 0},ax=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:rx,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case NT.ld:return Object(D.a)({},e,{sampleAuditioning:t.payload});default:return e}},ix={viewMode:"SPOTLIGHT",currentMix:void 0,hasEditsToSave:!1,loadedTracks:[],bpm:120,spotlightTracks:[]},sx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ix,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case NT.xf:return Object(D.a)({},e,{viewMode:t.payload});case NT.sb:return Object(D.a)({},e,{currentMix:t.payload});case NT.vf:return Object(D.a)({},e,{hasEditsToSave:t.payload});case NT.vc:return Object(D.a)({},e,{loadedTracks:t.payload});case NT.Z:return Object(D.a)({},e,{bpm:t.payload});case NT.Be:return Object(D.a)({},e,{spotlightTracks:t.payload});default:return e}},ox={patternToEditColor:void 0,patternColors:{}},cx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ox,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case NT.Tc:return Object(D.a)({},e,{patternToEditColor:t.payload});case NT.Sc:var n=Object(D.a)({},e.patternColors);return n[t.payload.pattern]=t.payload.color,Object(D.a)({},e,{patternColors:n});default:return e}},ux={stepsSelection:void 0,selectedSteps:void 0,stepNumberDraggingFrom:void 0,stepNumberDraggedTo:void 0,singleStepToDrag:void 0,showStepOptions:void 0,masterStepToggles:Array(16).fill(!0)},lx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ux,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case NT.De:return void 0===t.payload.fromStep?Object(D.a)({},e,{stepsSelection:void 0}):Object(D.a)({},e,{stepsSelection:t.payload});case NT.Md:return void 0===t.payload.trackNumber?Object(D.a)({},e,{selectedSteps:void 0}):Object(D.a)({},e,{selectedSteps:t.payload});case NT.Je:return Object(D.a)({},e,{stepNumberDraggingFrom:t.payload});case NT.yc:return Object(D.a)({},e,{masterStepToggles:t.payload});case NT.Ae:return Object(D.a)({},e,{singleStepToDrag:t.payload});case NT.Ie:return Object(D.a)({},e,{stepNumberDraggedTo:t.payload});case NT.pe:return void 0===t.payload.option?Object(D.a)({},e,{showStepOptions:void 0}):Object(D.a)({},e,{showStepOptions:{option:t.payload.option,effect:t.payload.effect}});default:return e}},px={youtubeSearchTerms:"",selectedRecord:void 0},hx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:px,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case NT.Hf:return Object(D.a)({},e,{youtubeSearchTerms:t.payload});case NT.Hd:return Object(D.a)({},e,{selectedRecord:t.payload});default:return e}},fx={midiMapMode:"OFF",parameterSelected:void 0,mappings:{},actionSelected:void 0,actionMappings:{}},dx=function(){var e,t,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fx,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case NT.Bc:return Object(D.a)({},r,{midiMapMode:a.payload,parameterSelected:void 0,actionSelected:void 0});case NT.Pc:return Object(D.a)({},r,{actionSelected:void 0,parameterSelected:a.payload});case NT.t:return Object(D.a)({},r,{parameterSelected:void 0,actionSelected:a.payload});case NT.Oc:return void 0===(t=Object(D.a)({},r.mappings))[e=a.payload.midiControl]&&(t[e]=[]),t[e].push(a.payload.parameter),Object(D.a)({},r,{mappings:t});case NT.s:return void 0===(n=Object(D.a)({},r.actionMappings))[e=a.payload.midiControl]&&(n[e]=[]),n[e].push(a.payload.action),Object(D.a)({},r,{actionMappings:n});case NT.f:var i={},s=a.payload;for(var o in r.mappings){var c=r.mappings[o],u=c.indexOf(s);u>-1&&c.splice(u,1),c.length>0&&(i[o]=c)}return Object(D.a)({},r,{mappings:i,parameterSelected:void 0,midiMapMode:"OFF"});case NT.e:return n=Object(D.a)({},r.actionMappings),t=Object(D.a)({},r.mapping),delete n[a.payload],delete t[a.payload],Object(D.a)({},r,{mappings:t,actionMappings:n});default:return r}},mx={connectionStatus:"NONE",connectedUserName:void 0,clockTick:void 0,playScheduled:!1,availableUsers:[]},vx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mx,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case NT.ib:return Object(D.a)({},e,{connectionStatus:t.payload});case NT.hb:return Object(D.a)({},e,{connectedUserName:t.payload});case NT.cb:return Object(D.a)({},e,{clockTick:t.payload});case NT.ad:return Object(D.a)({},e,{playScheduled:t.payload});case NT.Y:return console.log("setting available users = "),console.log(t.payload),Object(D.a)({},e,{availableUsers:t.payload});default:return e}},gx={showShareSequenceModal:!1},yx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gx,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case NT.oe:return console.log("setting share sequence modal = "+t.payload),Object(D.a)({},e,{showShareSequenceModal:t.payload});default:return e}},bx={totalLength:300,browserMode:1,bottomHeight:400,bottomMode:2,patternDragging:void 0,patternResizing:void 0,isBottomResizing:!1,patternStartSteps:{},loopSelected:!1,mixEvents:{},xScale:.25,selectedEvents:void 0,selection:{start:0,end:64},looping:!1,mouseX:void 0,automationTypeToShow:{},selectedRows:[],rowSelections:{},cursorStep:void 0},kx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bx,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case NT.Dc:var n=Object(D.a)({},e.mixEvents),r=n[t.payload.subSequenceId]||{};return r[t.payload.type]=t.payload.events,n[t.payload.subSequenceId]=r,Object(D.a)({},e,{mixEvents:n});case NT.A:var a=Object(D.a)({},e.automationTypeToShow);return a[t.payload.subSequenceId]=t.payload.type,Object(D.a)({},e,{automationTypeToShow:a});case NT.td:return Object(D.a)({},e,{rowSelections:void 0===t.payload?e.rowSelections:{},selectedEvents:t.payload});case NT.O:return void 0===t.payload.start?Object(D.a)({},e,{selection:void 0}):Object(D.a)({},e,{selection:{start:t.payload.start,end:t.payload.end}});case NT.M:return Object(D.a)({},e,{selectedEvents:void 0===t.payload?e.selectedEvents:void 0,rowSelections:Object(D.a)({},t.payload)});case NT.I:return Object(D.a)({},e,{mouseX:t.payload});case NT.G:return Object(D.a)({},e,{looping:t.payload});case NT.H:return Object(D.a)({},e,{loopSelected:t.payload});case NT.N:return Object(D.a)({},e,{selectedRows:t.payload});case NT.P:return Object(D.a)({},e,{xScale:t.payload});case NT.B:return Object(D.a)({},e,{bottomHeight:t.payload});case NT.C:var i=hg[t.payload];return Object(D.a)({},e,{bottomMode:t.payload,bottomHeight:void 0!==i?i:0});case NT.D:return Object(D.a)({},e,{isBottomResizing:t.payload});case NT.J:return Object(D.a)({},e,{patternDragging:t.payload});case NT.K:return Object(D.a)({},e,{patternResizing:t.payload});case NT.L:var s=e.patternStartSteps[t.payload.subSequenceId]||{};s[t.payload.patternId]=t.payload.startStep;var o=e.patternStartSteps;return o[t.payload.subSequenceId]=s,Object(D.a)({},e,{patternStartSteps:o});case NT.F:return Object(D.a)({},e,{cursorStep:t.payload});case NT.E:return Object(D.a)({},e,{browserMode:t.payload});default:return e}},Ex={selectedOnsets:{},onsetThreshold:.5,showingOnsets:!1},Ox=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ex,t=arguments.length>1?arguments[1]:void 0,n=Object(D.a)({},e);switch(t.type){case NT.Bd:return n.selectedOnsets[t.payload.id]=t.payload.selectedOnsets,n;case NT.Kc:return Object(D.a)({},e,{onsetThreshold:t.payload});case NT.he:return Object(D.a)({},e,{showingOnsets:t.payload});default:return e}},Sx={pendingTransactions:[]},Px=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Sx,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case NT.Uc:return Object(D.a)({},e,{pendingTransactions:t.payload});default:return e}},wx={commandInput:void 0,commandPrefix:void 0,viMode:!1},jx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wx,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case NT.eb:return Object(D.a)({},e,{commandInput:t.payload});case NT.fb:return Object(D.a)({},e,{commandPrefix:t.payload});case NT.Af:return Object(D.a)({},e,{viMode:t.payload});default:return e}},Tx={personSelected:void 0,recordingMix:!1,allSequences:[],workTransposes:{},workVolumes:{},mixLoaded:void 0,mixerEffects:{REVERB:!0,PHASER:!1,DELAY:!1},eqEffects:{LOW:!0,MID:!0,HIGH:!0},worksLoaded:[]},xx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Tx,t=arguments.length>1?arguments[1]:void 0,n=Object(D.a)({},e);switch(t.type){case NT.Mb:return n.mixerEffects=Object(D.a)({},n.mixerEffects),n.mixerEffects[t.payload.effect]=t.payload.toggle,n;case NT.Lb:return n.eqEffects=Object(D.a)({},n.eqEffects),n.eqEffects[t.payload.type]=t.payload.toggle,n;case NT.Ob:return Object(D.a)({},e,{personSelected:t.payload});case NT.Kb:return Object(D.a)({},e,{allSequences:t.payload});case NT.fd:return Object(D.a)({},e,{isRecordingMix:t.payload});case NT.Nb:return Object(D.a)({},e,{mixLoaded:t.payload});case NT.Df:return Object(D.a)({},e,{worksLoaded:t.payload});case NT.Ef:var r=Object(D.a)({},e.workTransposes);return r[t.payload.sequenceId]=t.payload.transpose,Object(D.a)({},e,{workTransposes:r});case NT.Ff:var a=Object(D.a)({},e.workVolumes);return a[t.payload.sequenceId]=t.payload.volume,Object(D.a)({},e,{workVolumes:a});default:return e}},Cx=Object(CT.b)({sequencer:DT,tracks:LT,cursor:UT,samples:FT,guilds:GT,palette:zT,presets:XT,mix:KT,keyboard:ZT,effects:ex,selector:nx,audition:ax,user:sx,toolbar:cx,steps:lx,discover:hx,midi:dx,clock:vx,modals:yx,arrangement:kx,waveform:Ox,transactions:Px,commands:jx,explore:xx,instruments:JT,automation:HT,installation:MT}),Nx=Object(CT.c)(Cx);s.a.render(a.a.createElement(g.a,{store:Nx},a.a.createElement(jT,{store:Nx})),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("","/service-worker.js");TT?function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):xT(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e):xT(e)})}}()},246:function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e)}return Object(a.a)(e,[{key:"getName",value:function(){}},{key:"getId",value:function(){}}]),e}();t.a=i},248:function(e,t,n){"use strict";var r=n(3),a=n.n(r),i=n(12),s=n(4),o=n(5),c=n(39),u=n(188),l=(n(13),n(334),function(){function e(t,n,r,a){Object(s.a)(this,e),this.store=t,this.guilds=n,this.encryption=r,this.crypto=a}return Object(o.a)(e,[{key:"addJson",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,u,l,p=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=p.length>1&&void 0!==p[1]?p[1]:110,r=p.length>2?p[2]:void 0,i=p.length>3&&void 0!==p[3]?p[3]:1,p.length>4?p[4]:void 0,3!==i){e.next=8;break}return e.next=7,c.a.addJson(t);case 7:return e.abrupt("return",e.sent);case 8:return e.next=10,this.guilds.getGuildKey();case 10:return s=e.sent,o=s.rawPublicKey,e.next=14,this.crypto.encryptRawContent(JSON.stringify(t),r,o);case 14:return u=e.sent,e.next=17,c.a.addJson(u.encryptedContent);case 17:return l=e.sent,this.encryption.newEncryptedContent(l,u.encryptedName,u.encryptedContentKey,n,s.publicKey),e.abrupt("return",l);case 20:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,u=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u.length>1&&void 0!==u[1]?u[1]:1,u.length>2?u[2]:void 0,r=u.length>3?u[3]:void 0,3!==n){e.next=7;break}return e.next=6,c.a.addBlob(t);case 6:return e.abrupt("return",e.sent);case 7:return e.next=9,this.guilds.getGuildKey();case 9:return i=e.sent,s=i.rawPublicKey,r.encryptKey(s),e.next=14,this.crypto.encryptRawContent(t,"",s,!0,r);case 14:return o=e.sent,e.next=17,c.a.addBytesArray(o.encryptedContent);case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addBlob",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,l=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:1,l.length>2?l[2]:void 0,3!==n){e.next=6;break}return e.next=5,c.a.addBlob(t);case 5:return e.abrupt("return",e.sent);case 6:return e.next=8,this.guilds.getGuildKey();case 8:return r=e.sent,i=r.rawPublicKey,e.next=12,this.crypto.encryptRawContent(t,"",i,!0);case 12:return s=e.sent,e.next=15,c.a.addJson(s.encryptedContent);case 15:return o=e.sent,this.encryption.newEncryptedContent(o,s.encryptedName,s.encryptedContentKey,u.b,r.publicKey),e.abrupt("return",o);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getEncryptedContentMetadata",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i,s,o,c,u,l;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(new Date).getTime(),void 0!==r){e.next=5;break}return e.next=4,this.guilds.getContentGuildId(t,n);case 4:r=e.sent;case 5:if(0!==r){e.next=7;break}return e.abrupt("return",1);case 7:return e.next=9,this.guilds.hasAccessTo(r);case 9:if(e.sent){e.next=12;break}return e.abrupt("return",2);case 12:return s=(new Date).getTime(),s-i,e.next=16,this.guilds.getGuildKey(r);case 16:if(o=e.sent,console.log("guild key=",o),c=(new Date).getTime(),c-s,u=void 0,!o){e.next=25;break}return e.next=24,this.encryption.getEncryptedContent(t,o.privateKey);case 24:u=e.sent;case 25:if(void 0!==u){e.next=29;break}return e.next=28,this.encryption.getEncryptedContent(t);case 28:u=e.sent;case 29:return l=(new Date).getTime(),l-c,e.abrupt("return",u);case 32:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getJson",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,s=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:"QmcfgECwvezrtmVGMywi6epaRMa8NE748V6UiGaBRALeQW",n=s.length>1?s[1]:void 0,e.next=4,this.getEncryptedContentMetadata(t,n);case 4:if(1!==(r=e.sent)&&void 0!==r){e.next=11;break}return e.next=8,c.a.getJson(t);case 8:return e.abrupt("return",e.sent);case 11:if(2!==r){e.next=13;break}return e.abrupt("return",{});case 13:return e.next=15,this.crypto.fetchAndDecrypt(t,r);case 15:return i=e.sent,e.abrupt("return",JSON.parse(i));case 17:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getSound",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,s,o,l,p=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:"QmYPK9KSRnm5LRvZZkrhLD9HJNVoQpbPBkokF1gt8FwZv8",n=p.length>1?p[1]:void 0,r=new Date,e.next=5,this.getEncryptedContentMetadata(t,u.b,n);case 5:if(i=e.sent,s=new Date,s.getTime()-r.getTime(),1!==i&&void 0!==i){e.next=14;break}return e.next=11,c.a.getSound(t);case 11:return e.abrupt("return",e.sent);case 14:if(2!==i){e.next=16;break}return e.abrupt("return",void 0);case 16:return e.next=18,this.crypto.fetchAndDecrypt(t,i,!0);case 18:return o=e.sent,l=new Date,l.getTime()-r.getTime(),e.abrupt("return",o);case 22:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"guildId",get:function(){var e=this.store.getState().guilds.selectedGuild;return e?e.guildId:0}}]),e}());t.a=l},26:function(e,t,n){"use strict";(function(e){var r=n(11),a=n(15),i=n(3),s=n.n(i),o=n(12),c=n(4),u=n(5),l=n(27),p=n(957),h=n(49),f=n(960),d=n(955),m=(n(1628),n(70)),v=n(40),g=n(932),y=n(168),b=n(933),k=n(934),E=n(531),O=n(935),S=n(958),P=n(936),w=n(937),j=n(938),T=n(388),x=n(939),C=n(940),N=n(941),R=n(41),D=(n(97),n(31)),q=n(530),M=n(959),A=n(942),I=new y.a;console.log("initialized contract wiht address = "+I.contractAddress);var L=new k.a,F=new P.a,B=new w.a,H=new j.a,V=new g.a,U=n(114),J="undefined"!==typeof window.web3;function _(e){for(var t=e.map(function(e){return z(e.ipfsHash)}),n=l.a.utils.padLeft("0x0",64),r=t.length;r<16;r++)t.push(n);for(var a=[],i=[],s=[],o=0;o<16;o++)if(void 0!==e[o]){var c=e[o].videoId;void 0===c?s.push(n):s.push(l.a.utils.fromAscii(c));var u=e[o].coverArt;void 0===u?a.push(n):a.push(z(u)),void 0===e[o].discogsId?i.push(0):i.push(e[o].discogsId)}else a.push(n),i.push(0),s.push(n);for(var p=e.map(function(e){return l.a.utils.fromAscii(e.title).slice(0,66)}),h=p.length;h<16;h++)p.push(n);for(var f=e.map(function(e){return e.tags.map(function(e){return l.a.utils.fromAscii(e)})}),d=f.length;d<16;d++)f.push([n,n,n,n]);for(var m=e.map(function(e){return e.styles.map(function(e){return null===e?n:l.a.utils.fromAscii(e)})}),v=m.length;v<16;v++)m.push([n,n,n,n]);for(var g=e.map(function(e){return null===e.country?n:l.a.utils.fromAscii(e.country)}),y=g.length;y<16;y++)g.push(n);for(var b=e.map(function(e){return null===e.year||void 0===e.year?0:e.year}),k=b.length;k<16;k++)b.push(0);return{sampleHashes:t,tags:f,titles:p,styles:m,years:b,countries:g,discogsIds:i,coverArts:a,videoIds:s}}function G(e){for(var t=l.a.utils.fromAscii(e),n=t.length;n<=65;n++)t+="0";return t}function z(e){var t=U.decode(e).toString("hex").replace(/^1220/,"");return 64!=t.length?null:"0x"+t}var W=new(function(){function e(){Object(c.a)(this,e),void 0!==l.a&&(this.web3=l.a,J&&window.web3.currentProvider.enable(),l.a.eth.net.isListening()&&(this.contract=new l.a.eth.Contract(I.abi,I.contractAddress),this.slicesContract=new l.a.eth.Contract(L.abi,L.contractAddress),this.favoritesContract=new l.a.eth.Contract(F.abi,F.contractAddress),this.slicesContractAddress=this.slicesContract.options.address,this.ethAddress=this.contract.options.address,this.favoritesContractAddress=this.favoritesContract.options.address,this.sequencesContract=new l.a.eth.Contract(H.abi,H.contractAddress),this.sequencesContractAddress=this.sequencesContract.options.address,this.indexContract=new l.a.eth.Contract(B.abi,B.contractAddress),this.indexContractAddress=this.indexContract.options.address,this.multiSamplesContract=V.getContract(l.a)),this.cachedTags=void 0,this.users=new T.a(l.a),this.crypto=new E.a(this),this.encryption=new O.a(l.a,this.crypto),this.guilds=new x.a(l.a,this.crypto,this.encryption),this.tokenizedSequences=new b.a(l.a),this.guildSequences=new N.a(l.a,this.guilds,this.encryption,this.crypto),this.samples2D=new p.a(l.a),this.messaging=new S.a(l.a),this.dmca=new M.a(l.a),this.folders=new f.a(l.a),this.resample=new A.a(l.a),this.presets=new q.a(l.a,this.crypto,this.guilds),this.xanadu=new d.a(l.a),this.guildSamples=new C.a(l.a))}return Object(u.a)(e,[{key:"postUserId",value:function(){var e=Object(o.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"isMetamaskInstalled",value:function(){return J}},{key:"getUser",value:function(){return new Promise(function(){var e=Object(o.a)(s.a.mark(function e(t,n){var r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!J){e.next=7;break}return e.next=3,l.a.eth.getAccounts();case 3:r=e.sent,t(r[0]),e.next=8;break;case 7:t(void 0);case 8:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}())}},{key:"getSoundsWithDiscogs",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new R.a(this.ethAddress).from(D.f).select("sampleHash").where("discogsId",t).where("guildId",this.guildId),e.next=3,n.executeQuery(!0);case 3:return r=e.sent,e.abrupt("return",r.map(function(e){return e.sampleHash}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCoverArtForDiscogs",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new R.a(this.ethAddress).from(D.f).select("coverArtHash").where("discogsId",t),e.next=3,n.executeQuery(!0);case 3:return r=e.sent,e.abrupt("return",r[0]);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCachedTags",value:function(e,t){return e>this.cachedTags.length?[]:e+t>this.cachedTags.length?this.cachedTags.slice(e):this.cachedTags.slice(e,e+t)}},{key:"searchTags",value:function(e){var t=this;return new Promise(function(n,r){void 0!==t.cachedTags?(e=e.toLowerCase(),n(t.cachedTags.filter(function(t){return t.toLowerCase().includes(e)}))):n([])})}},{key:"getTagsForSound",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new R.a(this.ethAddress).from(D.E).select("tag").where("ipfsHash",t).executeQuery(!0);case 2:return n=e.sent,e.abrupt("return",n.map(function(e){return e.tag}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getYearsForSound",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new R.a(this.ethAddress).from(D.H).select("year").where("ipfsHash",t).executeQuery(!0);case 2:return n=e.sent,e.abrupt("return",n.map(function(e){return e.year}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getVideoIdForSound",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new R.a(this.ethAddress).from(D.I).select("videoId").where("ipfsHash",t).executeQuery(!0);case 2:return n=e.sent,e.abrupt("return",n.map(function(e){return e.videoId})[0]);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getTitleForSound",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new R.a(this.ethAddress).from(D.B).select("title").where("ipfsHash",t).executeQuery(!0);case 2:return n=(n=e.sent).filter(function(e){return""!==e.title})[0],e.abrupt("return",void 0!==n?n.title:void 0);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUserNameForSound",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new R.a(this.ethAddress).from(D.B).select("user").where("ipfsHash",t).executeQuery(!0);case 2:if(void 0===(n=(n=e.sent).map(function(e){return e.user})[0])){e.next=9;break}return console.log("user = "+n),e.next=8,this.users.getUserName(n);case 8:return e.abrupt("return",e.sent);case 9:return e.abrupt("return",void 0);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCoverArtForSound",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new R.a(this.ethAddress).from(D.f).select("coverArtHash").where("sampleHash",t).executeQuery(!0);case 2:return n=(n=e.sent).filter(function(e){return""!==e.coverArtHash})[0],e.abrupt("return",void 0!==n?n.coverArtHash:void 0);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getFavoritesForSound",value:function(e){var t=this;return new Promise(function(){var n=Object(o.a)(s.a.mark(function n(r,a){var i,o,c,u,p,h,f,d;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,l.a.eth.getAccounts();case 2:if(i=n.sent,J&&0!==i.length){n.next=6;break}return r({userFavorited:[],othersFavorited:[]}),n.abrupt("return");case 6:return n.next=8,new R.a(t.favoritesContractAddress).from(D.C).select("user").where("sampleHash",e).executeQuery();case 8:return o=n.sent,n.next=11,new R.a(t.favoritesContractAddress).from(D.G).select("user").where("sampleHash",e).executeQuery();case 11:c=n.sent,u=i[0].toLowerCase(),p=o.filter(function(e){return e.user===u}),h=o.filter(function(e){return e.user!==u}),f=c.filter(function(e){return e.user===u}),d=c.filter(function(e){return e.user!==u}),r({userFavorited:p.length-f.length,othersFavorited:h.length-d.length});case 18:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getOverallVotedRankings",value:function(){var e=this;return new Promise(function(){var t=Object(o.a)(s.a.mark(function t(n,r){var a,i,o;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(J){t.next=3;break}return n([]),t.abrupt("return");case 3:return t.next=5,new R.a(e.favoritesContractAddress).from(D.C).select("sampleHash").executeQuery();case 5:return a=t.sent,t.next=8,new R.a(e.favoritesContractAddress).from(D.G).select("sampleHash").executeQuery();case 8:i=t.sent,o={},a.forEach(function(e){var t=e.sampleHash;t in o?o[t]++:o[t]=1}),i.forEach(function(e){var t=e.sampleHash;t in o?o[t]--:o[t]=-1}),n(o);case 13:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getFavoritesForUser",value:function(){var e=this;return new Promise(function(){var t=Object(o.a)(s.a.mark(function t(n,r){var a,i,o,c,u,p,h,f,d,m,v,g,y;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(J){t.next=3;break}return n([]),t.abrupt("return");case 3:return t.next=5,l.a.eth.getAccounts();case 5:if(void 0!==(a=t.sent)){t.next=9;break}return n([]),t.abrupt("return");case 9:return i=a[0].toLowerCase(),t.next=12,new R.a(e.favoritesContractAddress).from(D.C).select("sampleHash").where("user",i).executeQuery();case 12:return o=t.sent,t.next=15,new R.a(e.favoritesContractAddress).from(D.G).select("sampleHash").where("user",i).executeQuery();case 15:for(d in c=t.sent,u=o.map(function(e){return e.sampleHash}),p=c.map(function(e){return e.sampleHash}),h={},f={},u)u[d]in h?h[u[d]]++:h[u[d]]=1;for(m in p)p[m]in f?f[p[m]]++:f[p[m]]=1;for(g in v=[],h)y=h[g],g in f&&(y-=f[g]),y>0&&v.push(g);n(v);case 25:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getSoundsWithVideo",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new R.a(this.ethAddress).from(D.I).select("ipfsHash").where("videoId",t).where("guildId",this.guildId).executeQuery();case 2:return n=e.sent,e.abrupt("return",n.map(function(e){return e.ipfsHash}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithTag",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,r=void 0,this.cache.useMonth&&(n=this.cache.toBlock,r=this.cache.fromBlock),e.abrupt("return",this.getSoundsWithField("tag",t,D.E,!1,r,n));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithStyle",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,r=void 0,this.cache.useMonth&&(n=this.cache.toBlock,r=this.cache.fromBlock),e.abrupt("return",this.getSoundsWithField("style",t,D.D,!1,r,n));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithCountry",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,r=void 0,this.cache.useMonth&&(n=this.cache.toBlock,r=this.cache.fromBlock),e.abrupt("return",this.getSoundsWithField("country",t,D.A,!1,r,n));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithYear",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,r=void 0,this.cache.useMonth&&(n=this.cache.toBlock,r=this.cache.fromBlock),e.abrupt("return",this.getSoundsWithField("year",t,D.H,!1,r,n));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithFieldParallel",value:function(){var e=Object(o.a)(s.a.mark(function e(t,n,r){var a,i,o,c,u,l,p,h,f,d,m,v=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=v.length>3&&void 0!==v[3]&&v[3],i=v.length>4?v[4]:void 0,o=v.length>5?v[5]:void 0,!(i+1>=o)){e.next=5;break}return e.abrupt("return",[]);case 5:for(8,c=o-i,u=[],l=1;l<=8;l++)p=i+Math.floor((l-1)*c/8),h=i+Math.floor(l*c/8),u.push(this.getSoundsWithField(t,n,r,a,p,h));return e.next=11,Promise.all(u);case 11:for(m in f=e.sent,d=[],f)d=d.concat(f[m]);return e.abrupt("return",d);case 15:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getSoundsWithField",value:function(){var e=Object(o.a)(s.a.mark(function e(t,n,r){var a,i,o,c=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=c.length>3&&void 0!==c[3]&&c[3],i=c.length>4&&void 0!==c[4]?c[4]:37e5,o=c.length>5?c[5]:void 0,e.prev=3,e.next=6,this.getSoundsWithFieldHelper(t,n,r,a,i,o);case 6:return e.abrupt("return",e.sent);case 9:return e.prev=9,e.t0=e.catch(3),e.next=13,this.getSoundsWithFieldParallel(t,n,r,a,i,o);case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}},e,this,[[3,9]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getGuildsWithAccess",value:function(){var e=Object(o.a)(s.a.mark(function e(){var t,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((new Date).getTime(),0===this.guildId){e.next=3;break}return e.abrupt("return",[this.guildId]);case 3:return e.next=5,this.guilds.getGuildsWithAccess();case 5:t=e.sent,e.t0=s.a.keys(t);case 7:if((e.t1=e.t0()).done){e.next=13;break}return n=e.t1.value,e.next=11,this.guilds.getGuildKey(t[n]);case 11:e.next=7;break;case 13:return(new Date).getTime(),e.abrupt("return",[].concat(Object(a.a)(t),[0]));case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getSoundsWithFieldHelper",value:function(e,t,n){var r=this,a=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]?arguments[4]:37e5),i=arguments.length>5?arguments[5]:void 0;a&&l.a.utils.toHex(a);return i&&l.a.utils.toHex(i),new Promise(function(){var c=Object(o.a)(s.a.mark(function o(c,u){var l,p,h;return s.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,r.getGuildsWithAccess();case 2:return l=s.sent,p=new R.a(r.ethAddress).from(n).select("ipfsHash").where(e,t).whereIn("guildId",l),i&&p.toBlock(i),a&&p.fromBlock(a),s.next=8,p.executeQuery(!0);case 8:h=s.sent,c(h.map(function(e){return e.ipfsHash}));case 10:case"end":return s.stop()}},o)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"getSoundsFromBlock",value:function(e,t){var n=this;return new Promise(function(){var r=Object(o.a)(s.a.mark(function r(a,i){var o,c,u;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.getGuildsWithAccess();case 2:return o=r.sent,c=new R.a(n.ethAddress).from(D.B).select("ipfsHash").select("guildId").fromBlock(e).toBlock(t).limit(400).whereIn("guildId",window.installation?[0]:o),r.next=6,c.executeQuery(!0);case 6:u=r.sent,a(u.map(function(e){return e.ipfsHash}));case 8:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"getBlockDate",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.eth.getBlock(t);case 2:if(null!==(n=e.sent)){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",new Date(1e3*n.timestamp));case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getBlockNumberAtDate",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n,r,a,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.eth.getBlockNumber();case 2:return n=e.sent,r=500,e.next=6,l.a.eth.getBlock(n);case 6:a=e.sent,i=new Date(1e3*a.timestamp);case 8:if(!(t.getTime()<i.getTime())){e.next=16;break}return n-=r,e.next=12,l.a.eth.getBlock(n);case 12:a=e.sent,i=new Date(1e3*a.timestamp),e.next=8;break;case 16:return e.abrupt("return",n);case 17:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllSounds",value:function(){var e=Object(o.a)(s.a.mark(function e(t,n){var r,a,i,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return 5e4,r=void 0,a=void 0,this.cache.useMonthly&&(r=this.cache.toBlock,a=this.cache.fromBlock),i=[],o=new Date,e.next=8,this.getSoundsFromBlock(a,r);case 8:return i=e.sent,c=new Date,c.getTime()-o.getTime(),e.abrupt("return",i);case 12:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getOldSequence",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark(function e(r,a){var i,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new R.a(n.ethAddress).select("user").select("ipfsHash").select("title").where("ipfsHash",t).from(D.J),e.next=3,i.executeQuery();case 3:o=e.sent,r(o.map(function(e){return{user:e.user,previousSequence:"0x0",newSequence:e.ipfsHash,diff:"0x0",title:e.title,blockNumber:e.blockNumber,edits:0}}));case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPrivateSequences",value:function(){var e=Object(o.a)(s.a.mark(function e(t,n){var r,a,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.getAccount();case 2:if(void 0!==(r=e.sent)){e.next=5;break}return e.abrupt("return",[]);case 5:return e.next=7,this.encryption.getEncryptedSequenceIfAny(void 0,r,t,n);case 7:return a=e.sent,e.next=10,this.encryption.getSequencesSharedWithUser(void 0,t,n);case 10:return i=e.sent,e.abrupt("return",void 0===a?[]:a.concat(i));case 12:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNewSequence",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark(function e(a,i){var o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=new R.a(n.sequencesContractAddress).select("user").select("previousSequence").select("newSequence").select("diff").select("title").where("newSequence",t).from(D.K),e.next=3,o.executeQuery();case 3:c=e.sent,a(c.map(function(e){return Object(r.a)({},e,{edits:0})}));case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getTokenizedSequence",value:function(){var e=Object(o.a)(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.tokenizedSequences.getSequence(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSequence",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark(function e(r,a){var i,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getTokenizedSequence(t);case 2:if(!((i=e.sent).length>0)){e.next=6;break}return r(i[0]),e.abrupt("return");case 6:return e.next=8,n.getOldSequence(t);case 8:if(!((o=e.sent).length>0)){e.next=12;break}return r(o[0]),e.abrupt("return");case 12:return e.next=14,n.getNewSequence(t);case 14:if(!((c=e.sent).length>0)){e.next=18;break}return r(c[0]),e.abrupt("return");case 18:r("");case 19:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"favoriteSound",value:function(e){var t=this;return new Promise(function(){var n=Object(o.a)(s.a.mark(function n(r,a){var i;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(J){n.next=3;break}return r(),n.abrupt("return");case 3:return n.next=5,l.a.eth.getAccounts();case 5:i=n.sent,e=z(e),t.favoritesContract.methods.favoriteSample(e).send({from:i[0]},function(e,t){e?a(e):r(t)});case 8:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"unfavoriteSound",value:function(e){var t=this;return new Promise(function(){var n=Object(o.a)(s.a.mark(function n(r,a){var i;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return J||r(),n.next=3,l.a.eth.getAccounts();case 3:i=n.sent,e=z(e),t.favoritesContract.methods.unfavoriteSample(e).send({from:i[0]},function(e,t){e?a(e):r(t)});case 6:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"saveNewSequence",value:function(e,t,n,r){var a=this;return new Promise(function(){var i=Object(o.a)(s.a.mark(function i(o,c){return s.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:J||o(),a.tokenizedSequences.saveNewSequence(e,t,n,r);case 2:case"end":return i.stop()}},i)}));return function(e,t){return i.apply(this,arguments)}}())}},{key:"getNewSequences",value:function(e,t,n){var a=this;!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new Promise(function(){var i=Object(o.a)(s.a.mark(function i(o,c){var u,l;return s.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return u=new R.a(a.sequencesContractAddress).select("user").select("previousSequence").select("newSequence").select("diff").select("title").fromBlock(t).toBlock(n).from(D.K),void 0!==e&&u.where("user",e),i.prev=2,i.next=5,u.executeQuery();case 5:(l=i.sent).reverse(),l.sort(function(e,t){return t.blockNumber-e.blockNumber}),o(l.map(function(e){return Object(r.a)({},e,{edits:0})})),i.next=14;break;case 11:i.prev=11,i.t0=i.catch(2),o([]);case 14:case"end":return i.stop()}},i,null,[[2,11]])}));return function(e,t){return i.apply(this,arguments)}}())}},{key:"getOldSequences",value:function(e,t,n){var r=this;return new Promise(function(){var a=Object(o.a)(s.a.mark(function a(i,o){var c,u;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=new R.a(r.ethAddress).select("user").select("ipfsHash").fromBlock(t).toBlock(n).select("title").from(D.J),void 0!==e&&c.where("user",e),a.prev=2,a.next=5,c.executeQuery();case 5:(u=a.sent).reverse(),u=u.map(function(e){return{user:e.user,previousSequence:"0x0",newSequence:e.ipfsHash,diff:"0x0",title:e.title,blockNumber:e.blockNumber,edits:0}}),i(u),a.next=14;break;case 11:a.prev=11,a.t0=a.catch(2),i([]);case 14:case"end":return a.stop()}},a,null,[[2,11]])}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"getUser",value:function(){var e=Object(o.a)(s.a.mark(function e(){var t;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.eth.getAccounts();case 2:if(void 0!==(t=e.sent)&&0!=t.length){e.next=7;break}return e.abrupt("return",void 0);case 7:return e.abrupt("return",t[0]);case 8:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"getSequences",value:function(e,t,n){var r=this;return new Promise(function(){var t=Object(o.a)(s.a.mark(function t(n,a){var i,o;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.tokenizedSequences.getSequences(e);case 2:return t.sent,t.next=5,r.getNewSequences(e);case 5:return i=t.sent,t.next=8,r.getOldSequences(e);case 8:o=t.sent,n(i.concat(o));case 10:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getHeadSequence",value:function(e,t){return t in e?this.getHeadSequence(e,e[t]):t}},{key:"collapseAllSequences",value:function(e){var t=this,n=new Set,a=[],i={};return e.forEach(function(s){if("0x0"!==s.previousSequence&&s.previousSequence!==s.newSequence&&(n.add(s.previousSequence),i[s.previousSequence]=s.newSequence),!n.has(s.newSequence)){var o=t.getEditsForSequence(s.newSequence,e);a.push(Object(r.a)({},s,{edits:o.length-1}))}}),a}},{key:"getEditsForSequence",value:function(e,t){for(var n=[],r=this.getPreviousSequence(e,t);void 0!==r;){n.push(r);var a=this.getPreviousSequence(r.previousSequence,t);if(void 0===a||a.newSequence===r.newSequence)break;r=a}return n}},{key:"getPreviousSequence",value:function(e,t){var n=void 0;for(var r in t)t[r].newSequence===e&&(n=t[r]);return n}},{key:"tagSample",value:function(){var e=Object(o.a)(s.a.mark(function e(t,n){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark(function e(r,a){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=z(t),n=G(n),new m.a(v.e,"setSampleTag",[t,n]).execute().then(function(){return r()});case 3:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"newSampleWithMetadata",value:function(){var e=Object(o.a)(s.a.mark(function e(t,n,r,a,i,c,u){var p,h=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return p=h.length>7&&void 0!==h[7]?h[7]:this.guildId,e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark(function e(o,h){var f,d;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(f=l.a.utils.padLeft("0x0",64),void 0===a&&(a=[]),a.length<4)for(d=a.length;d<4;d++)a.push(null);a=a.map(function(e){return null===e?f:l.a.utils.fromAscii(e)}),i=i.map(function(e){return null===e?f:l.a.utils.fromAscii(e)}),c=null===c?f:l.a.utils.fromAscii(c),r=null===r?f:l.a.utils.fromAscii(r),J||o(),t=z(t),new m.a(v.e,"newSampleWithMetadata",[t,n,r,a,i,c,null===u?0:u,0,f,p]).execute().then(function(){return o()});case 10:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e,this)}));return function(t,n,r,a,i,s,o){return e.apply(this,arguments)}}()},{key:"splitArray",value:function(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n}},{key:"newEncryptedSamples",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n,r,a=this,i=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:this.guildId,r=i.length>2?i[2]:void 0,e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark(function e(i,o){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.splitArray(t,16).forEach(function(e){return a.newEncryptedSamples16(e,n,r)});case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"newEncryptedSamples16",value:function(e,t,n){return new Promise(function(){var r=Object(o.a)(s.a.mark(function r(a,i){var o;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:o=_(e),new m.a(v.e,"newEncryptedSamples",[o.sampleHashes,o.titles,o.videoIds,o.coverArts,o.discogsIds,o.tags,o.styles,o.countries,o.years,t,n.convertForEthereum(),n.getPublicKeyAsBytes32()]).execute().then(function(){return a()});case 2:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"newSamplesWithMetadata",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n,r=this,a=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:this.guildId,e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark(function e(a,i){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r.splitArray(t,16).forEach(function(e){return r.newSamplesWithMetadata16(e,n)});case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"newSamplesWithMetadata16",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n,r=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:this.guildId,e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark(function e(r,a){var i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=_(t),new m.a(v.e,"newSamplesWithMetadata",[i.sampleHashes,i.titles,i.videoIds,i.coverArts,i.discogsIds,i.tags,i.styles,i.countries,i.years,n]).execute().then(function(){return r()});case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"guildId",get:function(){if(void 0===this.store)return 0;var e=this.store.getState().guilds.selectedGuild;return e?e.guildId:0}}]),e}());console.log("initialized ethereum"),t.a=W}).call(this,n(14).Buffer)},27:function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return s});var r=n(90),a=n.n(r),i="undefined"!==typeof window.web3?new a.a(window.web3.currentProvider):new a.a(new a.a.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),s=new a.a(new a.a.providers.WebsocketProvider("wss://ropsten.infura.io/ws/v3/2f3dce2af1044e88b4851c3d73c3d00c"))},282:function(e,t,n){},298:function(e,t,n){"use strict";var r=n(3),a=n.n(r),i=n(12),s=n(11),o=n(15),c=n(4),u=n(5),l=function e(){Object(c.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"sampleIpfs",type:"bytes32"},{name:"notes",type:"bytes32[32]"},{name:"startTime",type:"uint32"},{name:"endTime",type:"uint32"},{name:"noteSequenceIpfs",type:"bytes32"}],name:"newNoteSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"sampleIpfs",type:"bytes32"},{name:"notes",type:"bytes32[256]"},{name:"startTimes",type:"uint32[8]"},{name:"endTimes",type:"uint32[8]"},{name:"noteSequenceIpfs",type:"bytes32"}],name:"newNoteSequenceLarge",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"noteSequenceIpfs",type:"bytes32"}],name:"NewNoteSequence",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"noteA",type:"bytes32"},{indexed:!0,name:"noteB",type:"bytes32"},{indexed:!1,name:"startTime",type:"uint32"},{indexed:!1,name:"endTime",type:"uint32"},{indexed:!1,name:"remainingNotes",type:"bytes32"}],name:"NewNotesAggregation",type:"event"}],this.contractAddress="0x3edab21966363a5c9d69ba0ed78abc5b9c6007c5"},p=n(97),h=n(144),f=n(39),d=n(31),m=n(42),v=new l,g=function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,[{key:"convertToNotes",value:function(e){return e=e.filter(function(e){return void 0!==e}).filter(function(e){return void 0!==e.pitch}).map(function(e){return{note:m.a.fromTranspose(e.pitch-60).note,startTime:e.startTime,endTime:e.endTime}})}},{key:"getChordsFromSequence",value:function(e,t){var n=this;e.sort(function(e,t){return e.startTime-t.startTime}),e=this.convertToNotes(e);for(var r=[],a=0;a<e.length;a++){var i=e[a],c=Object(o.a)(t),u=[];if(i.note===c[0]){for(var l=a;l<e.length&&0!=c.length;l++){var p=c[0];if(p===e[l].note){c=c.slice(1),u.push(e[l]);for(var h=l,f=l+1;f<e.length&&p==e[f].note;f++)u.push(e[f]),h=f;l=h}else u.push(null)}0==c.length&&r.push(u)}}var d=(r=r.map(function(e){return n.pruneTrailingNulls(e)})).filter(function(e){return e.filter(function(e){return null===e}).length<=.5*e.length}).filter(function(e){return e.length>0}).map(function(e){return{startTime:e[0].startTime,endTime:e[e.length-1].endTime}}).map(function(t){return Object(s.a)({},t,{density:n.calculateDensityForSlice(t,e)})}),m=[],v=function(e){var t=d[e];d.filter(function(e){return t.startTime>e.startTime&&t.endTime<=e.endTime}).length>0||m.push(t)};for(var g in d)v(g);return m}},{key:"calculateDensityForSlice",value:function(e,t){var n=t.filter(function(t){return t.startTime>=e.startTime&&t.startTime<=e.endTime||t.endTime>=e.startTime&&t.endTime<=e.endTime}),r=e.endTime-e.startTime;return n.length/r}},{key:"pruneTrailingNulls",value:function(e){var t=[];for(var n in e){if(e.slice(n).every(function(e){return null===e}))break;t.push(e[n])}return t}},{key:"getNoteSequence",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(new p.a).from(d.r).select("noteSequenceHash").where("sampleHash",t).executeQuery();case 2:if(0!=(n=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return r=n[0].noteSequenceHash,e.next=8,f.a.getJson(r);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"searchRankedNotes",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c,u,l,p,h,f,d,m,v,g,y,b,k,E,O,S,P;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.searchNotes(t);case 2:n=e.sent,r=[],e.t0=a.a.keys(n);case 5:if((e.t1=e.t0()).done){e.next=20;break}for(u in i=e.t1.value,s=n[i],o=s.remainingNotes,c=100,t)l=t[u],p=o.slice(u),-1==(h=p.indexOf(l))?c-=1/t.length*200:h>0&&(c-=5*h);if(f=o.length,d=s.startTime/1e3,m=s.endTime/1e3,v=f/(m-d),!(c<80)){e.next=17;break}return e.abrupt("continue",5);case 17:r.push({score:c,density:v,result:s}),e.next=5;break;case 20:r.sort(function(e,t){return e.density-t.density}),g={},e.t2=a.a.keys(r);case 23:if((e.t3=e.t2()).done){e.next=36;break}if(y=e.t3.value,!(r[y].score<=80)){e.next=27;break}return e.abrupt("continue",23);case 27:b=r[y].result,k=b.sampleHash,E=b.remainingNotes,O=b.startTime,S=b.endTime,P={startTime:O,endTime:S,remainingNotes:E},k in g?g[k].push(P):g[k]=[P],e.next=23;break;case 36:return e.abrupt("return",g);case 37:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getStartTimesForSample",value:function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){new p.a(v.contractAddress).from(d.s).select("startTime").where("sampleHash",t).executeQuery().then(function(t){return e(t)})}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"searchNotes",value:function(e){return new Promise(function(t,n){if(0!=e.length){var r=e.map(function(e){return h.b[e]}),a=new p.a(v.contractAddress).from(d.s).select("sampleHash").select("noteA").select("noteB").select("remainingNotes").select("startTime").select("endTime").where("noteA",r[0]);e.length>1&&(a=a.where("noteB",r[1])),a.executeQuery().then(function(e){return t(e)})}else t()})}}]),e}();t.a=g},299:function(e,t,n){"use strict";var r=n(3),a=n.n(r),i=n(12),s=n(4),o=n(5),c=function(){function e(t,n){Object(s.a)(this,e),this.currentPromise=t,this.nextPromise=n}return Object(o.a)(e,[{key:"getCurrent",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.currentPromise();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getNext",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.nextPromise;case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=c},300:function(e,t,n){"use strict";var r=n(15),a=n(4),i=n(5),s=n(9),o=n(10),c=n(1),u=n(88),l=n.n(u),p=n(39),h=n(26);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var d=function(e){Object(s.a)(n,e);var t=f(n);function n(e,r,i,s,o){var c;return Object(a.a)(this,n),(c=t.call(this)).decentralized=e,c.ipfsHash=i,c.sequenceId=r,c.data=s,c.title=o,c}return Object(i.a)(n,[{key:"getName",value:function(){return this.title}},{key:"getId",value:function(){return this.ipfsHash}},{key:"save",value:function(e,t,n,r,a){var i=this;return new Promise(function(s,o){p.a.addJson(t).then(function(t){s({ipfsHash:t}),i.saveToLocalStorage(e,t),a&&h.a.saveNewSequence(n,t,e,r)})})}},{key:"saveToLocalStorage",value:function(e,t){var n=window.localStorage,a=n.getItem("sequences");a?(a=JSON.parse(a),a=[{title:e,hash:t}].concat(Object(r.a)(a))):a=[{title:e,hash:t}],n.setItem("sequences",JSON.stringify(a))}},{key:"loadTitle",value:function(){var e=this;return new Promise(function(t,n){console.log("loading title for ipfshash = "+e.ipfsHash),h.a.getSequence(e.ipfsHash).then(function(e){return t(e.title)})})}},{key:"load",value:function(){var e=this;return new Promise(function(t,n){e.data?t(JSON.parse(e.data)):e.decentralized&&void 0!==e.ipfsHash?p.a.getJson(e.ipfsHash).then(function(e){return t(e)}):l.a.get("/sequence/"+e.sequenceId).then(function(e){return t(e.data.data)})})}}]),n}(n(246).a);t.a=d},301:function(e,t,n){"use strict";n.d(t,"a",function(){return c}),n.d(t,"b",function(){return u});var r=n(3),a=n.n(r),i=n(12),s=n(56),o=2e3;function c(e){var t=[];if("subSequences"in e)for(var n in e.subSequences){var r=e.subSequences[n];for(var a in r.tracksData){var i=r.tracksData[a];t=t.concat(Object.keys(i.samplers))}}else for(var s in e.tracksData){var o=e.tracksData[s];t=t.concat(Object.keys(o.samplers))}return Array.from(new Set(t))}function u(e,t,n){return l.apply(this,arguments)}function l(){return(l=Object(i.a)(a.a.mark(function e(t,n,r){var i,s,o,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i={},e.t0=a.a.keys(t);case 2:if((e.t1=e.t0()).done){e.next=19;break}return s=e.t1.value,o=t[s],e.prev=5,e.next=8,f(n,o);case 8:return c=e.sent,i[o]=c,e.next=12,p(r/2);case 12:e.next=17;break;case 14:e.prev=14,e.t2=e.catch(5),console.log("couldnt get sampleId = "+o);case 17:e.next=2;break;case 19:return console.log("finished getting samples"),e.abrupt("return",i);case 21:case"end":return e.stop()}},e,null,[[5,14]])}))).apply(this,arguments)}function p(e){return h.apply(this,arguments)}function h(){return(h=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(i.a)(a.a.mark(function e(n,r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:setTimeout(function(){n()},t);case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function f(e,t){return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var c;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return setTimeout(function(){i()},o),c=new s.a(t,e),n.prev=2,n.next=5,c.load();case 5:r(c),n.next=12;break;case 8:n.prev=8,n.t0=n.catch(2),console.log("rejection from lod"),i();case 12:case"end":return n.stop()}},n,null,[[2,8]])}));return function(e,t){return n.apply(this,arguments)}}())}},31:function(e,t,n){"use strict";var r=n(20),a=n(4),i=function e(t,n){Object(a.a)(this,e),this.event=t,this.topics=n;for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];this.data=i},s=n(5),o=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Object(a.a)(this,e),this.name=t,this.type=n,this.size=64*r}return Object(s.a)(e,[{key:"convertTo",value:function(e){if(void 0!==e&&null!==e)return this.type.convertTo(e)}},{key:"convertFrom",value:function(e){if(void 0!==e&&null!==e)return this.type.convertFrom(e)}}]),e}();n.d(t,"E",function(){return c}),n.d(t,"D",function(){return u}),n.d(t,"H",function(){return l}),n.d(t,"A",function(){return p}),n.d(t,"I",function(){return h}),n.d(t,"J",function(){return f}),n.d(t,"B",function(){return d}),n.d(t,"r",function(){return m}),n.d(t,"f",function(){return v}),n.d(t,"s",function(){return g}),n.d(t,"C",function(){return y}),n.d(t,"G",function(){return b}),n.d(t,"K",function(){return k}),n.d(t,"L",function(){return E}),n.d(t,"x",function(){return O}),n.d(t,"h",function(){return S}),n.d(t,"j",function(){return P}),n.d(t,"k",function(){return w}),n.d(t,"l",function(){return j}),n.d(t,"c",function(){return T}),n.d(t,"g",function(){return x}),n.d(t,"a",function(){return C}),n.d(t,"u",function(){return N}),n.d(t,"t",function(){return R}),n.d(t,"w",function(){return D}),n.d(t,"v",function(){return q}),n.d(t,"q",function(){return M}),n.d(t,"d",function(){return A}),n.d(t,"y",function(){return I}),n.d(t,"z",function(){return L}),n.d(t,"F",function(){return F}),n.d(t,"b",function(){return B}),n.d(t,"n",function(){return H}),n.d(t,"m",function(){return V}),n.d(t,"i",function(){return U}),n.d(t,"M",function(){return J}),n.d(t,"e",function(){return _}),n.d(t,"p",function(){return G}),n.d(t,"o",function(){return z});var c=new i("SampleTagged(bytes32,bytes32,uint32)",[new o("ipfsHash",r.i),new o("tag",r.b),new o("guildId",r.g)]),u=new i("SampleStyle(bytes32,bytes32,uint32)",[new o("ipfsHash",r.i),new o("style",r.b),new o("guildId",r.g)]),l=new i("SampleYear(bytes32,int16,uint32)",[new o("ipfsHash",r.i),new o("year",r.f),new o("guildId",r.g)]),p=new i("SampleCountry(bytes32,bytes32,uint32)",[new o("ipfsHash",r.i),new o("country",r.b),new o("guildId",r.g)]),h=new i("SampledYoutube(bytes32,bytes32,uint32)",[new o("ipfsHash",r.i),new o("videoId",r.l),new o("guildId",r.g)]),f=new i("SequenceCreated(address,bytes32,string)",[new o("user",r.a),new o("ipfsHash",r.i)],new o("title",r.m)),d=new i("SampleCreated(address,bytes32,string,uint32)",[new o("user",r.a),new o("ipfsHash",r.i),new o("guildId",r.g)],new o("title",r.m)),m=new i("NewNoteSequence(bytes32,bytes32)",[new o("sampleHash",r.i),new o("noteSequenceHash",r.i)]),v=new i("NewDiscogsSample(bytes32,uint256,bytes32,uint32)",[new o("sampleHash",r.i),new o("coverArtHash",r.i),new o("guildId",r.g)],new o("discogsId",r.n)),g=new i("NewNotesAggregation(bytes32,bytes32,bytes32,uint32,uint32,bytes32)",[new o("sampleHash",r.i),new o("noteA",r.k),new o("noteB",r.k)],new o("startTime",r.g),new o("endTime",r.g),new o("remainingNotes",r.j)),y=new i("SampleFavorited(address,bytes32)",[new o("user",r.a),new o("sampleHash",r.i)]),b=new i("SampleUnfavorited(address,bytes32)",[new o("user",r.a),new o("sampleHash",r.i)]),k=new i("SequenceEdited(address,bytes32,bytes32,bytes32,string)",[new o("user",r.a),new o("previousSequence",r.i),new o("newSequence",r.i)],new o("diff",r.i),new o("title",r.m)),E=new i("SequenceEdited(address,bytes32,bytes32,string)",[new o("user",r.a),new o("previousSequence",r.i),new o("newSequence",r.i)],new o("title",r.m)),O=new i("PresetTagged(address,bytes32,bytes32,uint32)",[new o("contentHash",r.i),new o("tag",r.b),new o("guildId",r.g)],new o("user",r.a)),S=new i("NewGuild(address,uint32,string)",[new o("user",r.a),new o("guildId",r.g)],new o("name",r.m)),P=new i("NewGuildMemberRequest(address,address,uint32)",[new o("requester",r.a),new o("newMember",r.a),new o("guildId",r.g)]),w=new i("NewGuildMemberRequestAccepted(address,uint32)",[new o("newMember",r.a),new o("guildId",r.g)]),j=new i("NewGuildMemberRequestRejected(address,uint32)",[new o("newMember",r.a),new o("guildId",r.g)]),T=new i("GuildKeyEncrypted(address,uint32,bytes32)",[new o("user",r.a),new o("guildId",r.g),new o("ipfsHash",r.i)]),x=new i("NewEncryptedContent(address,bytes32,bytes32,int8,bytes32,bytes32[9],bytes32[6])",[new o("user",r.a),new o("newContent",r.i),new o("contentType",r.h)],new o("previousContent",r.i),new o("encryptedName",r.d),new o("encryptedContentKey",Object(r.c)(9),9),new o("publicKey",Object(r.c)(6),6)),C=new i("EncryptedContentShared(address,address,bytes32,bytes32[9],bytes32[6])",[new o("sharedWith",r.a),new o("creator",r.a),new o("contentHash",r.i)],new o("encryptedContentKey",Object(r.c)(9),9),new o("publicKey",Object(r.c)(6),6)),N=new i("NewPublicKey(address,bytes32[6])",[new o("user",r.a)],new o("publicKey",Object(r.c)(6),6)),R=new i("NewPreset(address,bytes32,uint32,bytes32,bytes32[9],bytes32[6])",[new o("user",r.a),new o("contentHash",r.i),new o("guildId",r.g)],new o("encryptedName",r.d),new o("encryptedContentKey",Object(r.c)(9),9),new o("publicKey",Object(r.c)(6),6)),D=new i("PresetSample(bytes32,bytes32,uint32)",[new o("contentHash",r.i),new o("sampleHash",r.i),new o("guildId",r.g)]),q=new i("PresetInstrumentType(bytes32,bytes32,uint32)",[new o("contentHash",r.i),new o("instrumentType",r.e),new o("guildId",r.g)]),M=new i("NewMonthlyIndex(bytes32,uint32,uint64)",[new o("month",r.n),new o("year",r.n)],new o("hash",r.i)),A=new i("New2DMapping(bytes32)",[new o("ipfsHash",r.i)]),I=new i("PublicMessageSent(address,address,bytes32,bytes32)",[new o("fromUser",r.a),new o("toUser",r.a),new o("referenceHash",r.i)],new o("messageHash",r.i)),L=new i("SampleCopyStrike(address,bytes32,bytes32)",[new o("user",r.a),new o("sampleHash",r.i),new o("referenceHash",r.i)]),F=new i("SampleTakenDown(bytes32)",[new o("sampleHash",r.i)]),B=new i("FoldersUpdated(address,bytes32)",[new o("user",r.a),new o("foldersHash",r.i)]),H=new i("NewIndex(uint32,bytes32)",[new o("guildId",r.g)],new o("indexHash",r.i)),V=new i("NewGuildSequence(address,bytes32,uint32,bytes32,bytes32,bytes32[9],bytes32[6])",[new o("user",r.a),new o("contentHash",r.i),new o("guildId",r.g)],new o("previousHash",r.i),new o("encryptedName",r.d),new o("encryptedContentKey",Object(r.c)(9),9),new o("publicKey",Object(r.c)(6),6)),U=new i("NewGuildClassification(uint32,bytes32)",[new o("guildId",r.g),new o("contentHash",r.i)]),J=new i("Transfer(address,address,uint256)",[new o("fromUser",r.a),new o("toUser",r.a)],new o("amount",r.g)),_=(new i("SequenceTagged(bytes32,bytes32,uint32)",[new o("ipfsHash",r.i),new o("tag",r.b),new o("guildId",r.g)]),new i("SequenceFavorited(bytes32,address,uint32)",[new o("ipfsHash",r.i),new o("user",r.a),new o("guildId",r.g)]),new i("SequenceStarred(bytes32,address,uint32)",[new o("ipfsHash",r.i),new o("user",r.a),new o("guildId",r.g)]),new i("SequenceUnfavorited(bytes32,address,uint32)",[new o("ipfsHash",r.i),new o("user",r.a),new o("guildId",r.g)]),new i("SequenceUnstarred(bytes32,address,uint32)",[new o("ipfsHash",r.i),new o("user",r.a),new o("guildId",r.g)]),new i("NewDataType(bytes32,string)",[new o("dataType",r.b)],new o("description",r.m))),G=new i("NewLinkType(bytes32,string)",[new o("linkType",r.b)],new o("description",r.m)),z=(new i("NewAnnotationType(bytes32,string)",[new o("annotationType",r.b)],new o("description",r.m)),new i("NewLink(bytes32,bytes32,bytes32,address)",[new o("linkType",r.b),new o("fromData",r.i),new o("toData",r.i)],new o("address",r.a)));new i("NewMix(address,bytes32,string,uint32)",[new o("user",r.a),new o("mixHash",r.i)],new o("title",r.m),new o("guildId",r.g))},335:function(e,t){!function(e){var t=function(e,t){var n=t||{},r=n.bufferLen||256,a=n.numChannels||2;this.context=e.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,r,a,a);var i=new Worker(n.workerPath||"../recorderWorker.js");i.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:a}});var s,o,c=!1,u=null;this.node.onaudioprocess=function(e){if(c){var t=0;if(null!=o){var n=((new Date).getTime()-o)/1e3;if(n+=e.playbackTime-this.context.currentTime,(t=Math.floor(n*this.context.sampleRate))<0)return;o=null}if(null!==u){var r=((new Date).getTime()-u)/1e3;(r+=r+(e.playbackTime-this.context.currentTime))>=0&&(u=null,c=!1)}for(var s=[],l=0;l<a;l++){var p=e.inputBuffer.getChannelData(l);t>0&&(p=p.subarray(t)),s.push(p)}i.postMessage({command:"record",buffer:s})}},this.terminate=function(){i.terminate()},this.configure=function(e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])},this.record=function(e){o=void 0!==e?e:(new Date).getTime(),c=!0},this.stop=function(e){o=null,u=void 0!==e?e:(new Date).getTime()},this.clear=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(new Date).getTime();o=e,i.postMessage({command:"clear"})},this.getBuffer=function(e){s=e||n.callback,i.postMessage({command:"getBuffer"})},this.exportWAV=function(e,t){if(s=e||n.callback,t=t||n.type||"audio/wav",!s)throw new Error("Callback not set");i.postMessage({command:"exportWAV",type:t})},i.onmessage=function(e){var t=e.data;s(t)},e.connect(this.node);var l=this.context.createGain();l.gain.value=0,this.node.connect(l),l.connect(this.context.destination)};t.forceDownload=function(t,n){var r=(e.URL||e.webkitURL).createObjectURL(t),a=e.document.createElement("a");a.href=r,a.download=n||"output.wav";var i=document.createEvent("Event");i.initEvent("click",!0,!0),a.dispatchEvent(i)},e.Recorder=t}(window)},36:function(e,t,n){"use strict";var r=n(25),a=n(4),i=n(5),s=n(45),o=["#00e1f5","#ff1797","#d7003a","#ff4040","#ff853c","#ff6022","#6c2efc","#52ff89","#b7ffb3","#91ffd7","#40adff","#4440ff","#5e09ff"],c={},u=function(){function e(){Object(a.a)(this,e)}return Object(i.a)(e,[{key:"getColorForTrack",value:function(e){e.getTrackType()===s.c&&(e=e.tracks[0]&&e.tracks[0].track||e);var t=void 0!==e.sample&&void 0!==e.sample.getId()?e.sample.getId():e.presetName||e.instrument&&e.instrument.defaultSampler&&e.instrument.defaultSampler.sample.getId()||e.getName(),n=this.getColorForHash(t);return this.saturate(n,3)}},{key:"getColor",value:function(e){return o[e%o.length]}},{key:"getColorForHash",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,n=this.intToRGB(this.hashCode(e)),r=this.getBrightness(n);return r>t?this.brighten(n,200/r):n}},{key:"hashCode",value:function(e){for(var t=0,n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);return t}},{key:"intToRGB",value:function(e){var t=(16777215&e).toString(16).toUpperCase();return"#"+"00000".substring(0,6-t.length)+t}},{key:"compliment",value:function(e){var t=p(e),n=t.h,r=t.s,a=t.l;return n<150?n*=2:n/=2,l({h:n,s:r,l:a*=1.1})}},{key:"saturate",value:function(e,t){if(e.startsWith("hsl")){var n=p(e),r=n.h,a=n.s,i=n.l;return e=l({h:r,s:a=Math.min(a*t,100),l:i})}var s=function(e){var t=e.r,n=e.g,r=e.b;t/=255,n/=255,r/=255;var a=Math.min(t,n,r),i=Math.max(t,n,r),s=i-a,o=0,c=0,u=0;o=0==s?0:i==t?(n-r)/s%6:i==n?(r-t)/s+2:(t-n)/s+4;(o=Math.round(60*o))<0&&(o+=360);return u=(i+a)/2,c=+(100*(c=0==s?0:s/(1-Math.abs(2*u-1)))).toFixed(1),u=+(100*u).toFixed(1),{h:o,s:c,l:u}}(this.getRGB(e)),o=s.h,c=s.s,u=s.l;return e=l({h:o,s:c=Math.min(c*t,100),l:u})}},{key:"brighten",value:function(e,t){if(e.startsWith("hsl")){var n=p(e);return l(n=function(e,t){var n=e.h,r=e.s,a=e.l;return{h:n,s:r,l:a*t}}(n,t))}var r=c[e+"."+t];if(r)return r;var a=Math.min(255,Math.floor(parseInt(e.slice(1,3),16)*t)),i=Math.min(255,Math.floor(parseInt(e.slice(3,5),16)*t)),s=Math.min(255,Math.floor(parseInt(e.slice(5),16)*t));a=a.toString(16),i=i.toString(16),s=s.toString(16),1===a.length&&(a="0"+a),1===i.length&&(i="0"+i),1===s.length&&(s="0"+s);var o="#"+a+i+s;return c[e+"."+t]=o,o}},{key:"getBrightness",value:function(e){var t=this.getRGB(e);return.299*t.r+.587*t.g+.114*t.b}},{key:"getRGB",value:function(e){return{r:Math.floor(parseInt(e.slice(1,3),16)),g:Math.floor(parseInt(e.slice(3,5),16)),b:Math.floor(parseInt(e.slice(5),16))}}}]),e}();function l(e){return"hsl("+e.h+","+e.s+"%,"+e.l+"%)"}function p(e){var t=(e=e.substring(4)).split(","),n=Object(r.a)(t,3),a=n[0],i=n[1],s=n[2],o=i.indexOf("%");return i=i.substring(0,o),o=s.indexOf("%"),s=s.substring(0,o),{h:parseFloat(a),s:parseFloat(i),l:parseFloat(s)}}t.a=u},373:function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r=n(3),a=n.n(r),i=n(12),s=n(931),o=(n(56),n(90)),c=n.n(o),u=(n(144),n(114),n(42),n(39),"undefined"!==typeof window.web3?new c.a(window.web3.currentProvider):new c.a(new c.a.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),null);function l(e){return new Promise(function(){var t=Object(i.a)(a.a.mark(function t(n,r){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null!==u){t.next=4;break}return u=new s.OnsetsAndFrames("https://storage.googleapis.com/magentadata/js/checkpoints/transcription/onsets_frames_uni"),t.next=4,u.initialize();case 4:u.transcribeFromAudioBuffer(e,16).then(function(e){n(e)});case 5:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},376:function(e,t,n){"use strict";var r=n(15),a=n(4),i=n(5),s=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(a.a)(this,e),this.name=t,this.parent=n,this.subFolders=[],this.items=[],this.depth=r}return Object(i.a)(e,[{key:"isDynamic",value:function(){return!1}},{key:"isRoot",value:function(){return void 0===this.parent}},{key:"addItem",value:function(e){e.parent=this,this.items.push(e)}},{key:"deleteItem",value:function(e){var t=this.items.indexOf(e);if(t>-1)return e.parent=void 0,this.items.splice(t,1),e}},{key:"deleteFolder",value:function(e){var t=this.subFolders.indexOf(e);if(t>-1)return this.subFolders.splice(t,1),e}},{key:"delete",value:function(){void 0!==this.parent&&this.parent.deleteFolder(this)}},{key:"newFolder",value:function(t){var n=new e(t,this,this.depth+1);return this.subFolders.push(n),n}},{key:"addFolder",value:function(e){e.depth=this.depth+1,this.subFolders.push(e)}},{key:"getJson",value:function(){return{name:this.name,subFolders:this.subFolders.map(function(e){return e.getJson()}),items:this.items.map(function(e){return e.getJson()})}}},{key:"fromJson",value:function(t,n){var r=this;return this.name=t.name,this.items=t.items.map(function(e){return n(e)}),this.items.forEach(function(e){return e.parent=r}),this.subFolders=t.subFolders.map(function(t){return new e(void 0,r,r.depth+1).fromJson(t,n)}),this}},{key:"getAllItems",value:function(){var e=Object(r.a)(this.items);for(var t in this.subFolders)e=e.concat(this.subFolders[t].getAllItems());return e}}]),e}();t.a=s},377:function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!0,inputs:[{name:"user",type:"address"}],name:"getNumberOfFollowers",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"userB",type:"address"}],name:"unfollow",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"name",type:"string"}],name:"isUserNameAvailable",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"user",type:"address"}],name:"getUserProfilePicture",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"profile",type:"bytes32"}],name:"setProfileHash",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"userB",type:"address"}],name:"follow",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"user",type:"address"},{name:"index",type:"uint256"}],name:"getFollower",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"profilePicture",type:"bytes32"}],name:"setProfilePicture",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"name",type:"string"}],name:"getUserAddressFromName",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"user",type:"address"}],name:"getUserProfile",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"name",type:"string"}],name:"setName",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"user",type:"address"}],name:"getUserName",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"userAddress",type:"address"},{indexed:!0,name:"ipfsAddress",type:"bytes32"}],name:"ProfileIpfsHashUpdated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"userAddress",type:"address"},{indexed:!0,name:"ipfsAddress",type:"bytes32"}],name:"ProfilePictureIpfsHashUpdated",type:"event"}],this.contractAddress="0xd0fb239ceb867bdcf68ae8331e911a9d4ec80632"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},378:function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"delegate",type:"address"},{name:"numTokens",type:"uint256"}],name:"approve",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"contentHash",type:"bytes32"},{name:"user",type:"address"}],name:"approveContentOwner",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"numTokens",type:"uint256"}],name:"buyTokens",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{name:"contentHash",type:"bytes32"}],name:"claimContentBalance",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"previousSequence",type:"bytes32"},{name:"newSequence",type:"bytes32"},{name:"title",type:"string"},{name:"samples",type:"bytes32[]"}],name:"editSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"newPrice",type:"uint256"}],name:"setPrice",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"receiver",type:"address"},{name:"numTokens",type:"uint256"}],name:"transfer",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"user",type:"address"},{name:"buyer",type:"address"},{name:"numTokens",type:"uint256"}],name:"transferFrom",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{name:"total",type:"uint256"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"tokenOwner",type:"address"},{indexed:!0,name:"spender",type:"address"},{indexed:!1,name:"tokens",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"tokens",type:"uint256"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!0,name:"previousSequence",type:"bytes32"},{indexed:!0,name:"newSequence",type:"bytes32"},{indexed:!1,name:"title",type:"string"}],name:"SequenceEdited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"sequenceHash",type:"bytes32"},{indexed:!0,name:"sampleHash",type:"bytes32"}],name:"SampleInSequence",type:"event"},{constant:!0,inputs:[{name:"user",type:"address"},{name:"delegate",type:"address"}],name:"allowance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"tokenOwner",type:"address"}],name:"balanceOf",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"contentHash",type:"bytes32"}],name:"getContentBalance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"getPrice",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"}],this.contractAddress="0x606f760c228cd5f11c6f79de64d3b299b11f1ed1"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},379:function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"bytes32",name:"previousHash",type:"bytes32"},{internalType:"bytes32",name:"newHash",type:"bytes32"},{internalType:"bytes32",name:"encryptedTitle",type:"bytes32"},{internalType:"bytes32[9]",name:"encryptedContentKey",type:"bytes32[9]"},{internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"editSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"guildsAddress",type:"address"},{internalType:"address",name:"encryptionAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"sequenceHash",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"},{indexed:!1,internalType:"bytes32",name:"previousHash",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"encryptedTitle",type:"bytes32"},{indexed:!1,internalType:"bytes32[9]",name:"encryptedContentKey",type:"bytes32[9]"},{indexed:!1,internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"NewGuildSequence",type:"event"}],this.contractAddress="0x15Da2ef01D9F881f694Be962Db28b76110fa195C"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},380:function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"}],name:"favoritePreset",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"},{internalType:"bytes32",name:"title",type:"bytes32"},{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"instrumentType",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"bytes32[9]",name:"encryptedContentKey",type:"bytes32[9]"},{internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"newPreset",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"},{internalType:"bytes32[4]",name:"tags",type:"bytes32[4]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"tagPreset",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"guildsContractAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"},{indexed:!1,internalType:"bytes32",name:"title",type:"bytes32"},{indexed:!1,internalType:"bytes32[9]",name:"encryptedContentKey",type:"bytes32[9]"},{indexed:!1,internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"NewPreset",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"PresetSample",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"tag",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"PresetTagged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"}],name:"PresetFavorited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"instrumentType",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"PresetInstrumentType",type:"event"}],this.contractAddress="0x45aC8aCbEba84071D4e549d4dCd273E01E5a8daF"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},381:function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!0,inputs:[{internalType:"uint32",name:"i",type:"uint32"}],name:"getGuildForSelf",outputs:[{internalType:"uint32",name:"",type:"uint32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"user",type:"address"}],name:"getTotalGuildsForUser",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"bytes32[6]",name:"guildPublicKey",type:"bytes32[6]"},{internalType:"string",name:"name",type:"string"},{internalType:"bytes32",name:"encryptedKeyIpfsHash",type:"bytes32"},{internalType:"bytes32[9]",name:"contentKey",type:"bytes32[9]"},{internalType:"bytes32[6]",name:"userPublicKey",type:"bytes32[6]"}],name:"newGuild",outputs:[{internalType:"uint32",name:"",type:"uint32"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"}],name:"rejectRequestToAddToGuild",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"setPublicKeyForGuild",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"address",name:"member",type:"address"}],name:"isGuildMember",outputs:[{internalType:"bool",name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"address",name:"potentialMember",type:"address"},{internalType:"bytes32",name:"encryptedKeyIpfsHash",type:"bytes32"},{internalType:"bytes32[9]",name:"contentKey",type:"bytes32[9]"},{internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"requestToAddMember",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"getTotalGuildsForSelf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"}],name:"acceptRequestToAddToGuild",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"user",type:"address"},{internalType:"uint32",name:"i",type:"uint32"}],name:"getGuildForUser",outputs:[{internalType:"uint32",name:"",type:"uint32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"}],name:"getTotalGuildUsers",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"}],name:"getGuildName",outputs:[{internalType:"string",name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"string",name:"name",type:"string"}],name:"setNameForGuild",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"uint32",name:"guild",type:"uint32"},{internalType:"uint32",name:"i",type:"uint32"}],name:"getUserFromGuild",outputs:[{internalType:"address",name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"encryptionContractAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"},{indexed:!1,internalType:"string",name:"name",type:"string"}],name:"NewGuild",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"}],name:"NewGuildMember",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"}],name:"NewGuildMemberRequest",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"}],name:"NewGuildMemberRequestAccepted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"}],name:"NewGuildMemberRequestRejected",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"}],name:"GuildMemberLeft",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint32",name:"",type:"uint32"},{indexed:!0,internalType:"bytes32[6]",name:"",type:"bytes32[6]"}],name:"GuildPublicKeyChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"},{indexed:!0,internalType:"bytes32",name:"",type:"bytes32"}],name:"GuildKeyEncrypted",type:"event"}],this.contractAddress="0x70548646c2A475ebfE46F19637651e76a38324d4"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},382:function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"sharedWith",type:"address"},{name:"contentHash",type:"bytes32"},{name:"encryptedContentKey",type:"bytes32[9]"},{name:"publicKey",type:"bytes32[6]"}],name:"shareEncryptedContentWith",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"publicKey",type:"bytes32[6]"}],name:"setPublicKey",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"previousContentHash",type:"bytes32"},{name:"newContentHash",type:"bytes32"},{name:"encryptedName",type:"bytes32"},{name:"contentType",type:"int8"},{name:"encryptedContentKey",type:"bytes32[9]"},{name:"publicKey",type:"bytes32[6]"}],name:"newEncryptedContent",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"hasPublicKey",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!1,name:"publicKey",type:"bytes32[6]"}],name:"NewPublicKey",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!1,name:"previousContent",type:"bytes32"},{indexed:!0,name:"newContent",type:"bytes32"},{indexed:!0,name:"contentType",type:"int8"},{indexed:!1,name:"encryptedName",type:"bytes32"},{indexed:!1,name:"contentKey",type:"bytes32[9]"},{indexed:!1,name:"publicKey",type:"bytes32[6]"}],name:"NewEncryptedContent",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"sharedWith",type:"address"},{indexed:!0,name:"creator",type:"address"},{indexed:!0,name:"contentHash",type:"bytes32"},{indexed:!1,name:"contentKey",type:"bytes32[9]"},{indexed:!1,name:"publicKey",type:"bytes32[6]"}],name:"EncryptedContentShared",type:"event"}],this.contractAddress="0xbe559f9f38c5f36186b364972cb8b4ebd7174043"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},383:function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"bytes32",name:"foldersHash",type:"bytes32"}],name:"foldersUpdated",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"foldersHash",type:"bytes32"}],name:"FoldersUpdated",type:"event"}],this.contractAddress="0x20039b89449aC0bAB5B4114Bf66aCff1b3043988"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},384:function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"address",name:"toUser",type:"address"},{internalType:"bytes32",name:"referenceHash",type:"bytes32"},{internalType:"bytes32",name:"messageContentHash",type:"bytes32"}],name:"sendPublicMessage",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"messageContentHash",type:"bytes32"}],name:"deleteMessage",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"fromUser",type:"address"},{indexed:!0,internalType:"address",name:"toUser",type:"address"},{indexed:!0,internalType:"bytes32",name:"referencedHash",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"messageContentHash",type:"bytes32"}],name:"PublicMessageSent",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"messageContentHash",type:"bytes32"}],name:"PublicMessageDeleted",type:"event"}],this.contractAddress="0xb407EFd2254583C8BF99c578c7b891313AC1933E"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},385:function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{inputs:[{internalType:"address",name:"samplesAddress",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"resampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"sampleUsed",type:"bytes32"}],name:"NewResample",type:"event"},{inputs:[{internalType:"bytes32",name:"resampleHash",type:"bytes32"},{internalType:"string",name:"title",type:"string"},{internalType:"bytes32[4]",name:"tags",type:"bytes32[4]"},{internalType:"bytes32[]",name:"samplesUsedHashes",type:"bytes32[]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"newResample",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0xD914528749Fcfc2945148551d0F61AfDFe429962"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},386:function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{inputs:[{internalType:"bytes32",name:"annotationType",type:"bytes32"},{internalType:"bytes32",name:"data",type:"bytes32"},{internalType:"bytes32",name:"annotationData",type:"bytes32"}],name:"newAnnotation",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"annotationType",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"data",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"annotationData",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"}],name:"NewAnnotation",type:"event"},{inputs:[{internalType:"bytes32",name:"annotationType",type:"bytes32"},{internalType:"bytes32",name:"data",type:"bytes32"},{internalType:"bytes32[]",name:"annotationData",type:"bytes32[]"}],name:"newAnnotations",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"annotationType",type:"bytes32"},{internalType:"string",name:"description",type:"string"}],name:"newAnnotationType",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"annotationType",type:"bytes32"},{indexed:!1,internalType:"string",name:"description",type:"string"}],name:"NewAnnotationType",type:"event"},{inputs:[{internalType:"bytes32",name:"dataType",type:"bytes32"},{internalType:"string",name:"description",type:"string"}],name:"newDataType",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"dataType",type:"bytes32"},{indexed:!1,internalType:"string",name:"description",type:"string"}],name:"NewDataType",type:"event"},{inputs:[{internalType:"bytes32",name:"linkType",type:"bytes32"},{internalType:"bytes32",name:"fromData",type:"bytes32"},{internalType:"bytes32",name:"toData",type:"bytes32"}],name:"newLink",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"linkType",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"fromData",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"toData",type:"bytes32"},{indexed:!1,internalType:"address",name:"user",type:"address"}],name:"NewLink",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"linkType",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"fromData",type:"bytes32"},{indexed:!1,internalType:"address",name:"user",type:"address"}],name:"NewLinkRoot",type:"event"},{inputs:[{internalType:"bytes32",name:"linkType",type:"bytes32"},{internalType:"bytes32",name:"fromData",type:"bytes32"},{internalType:"bytes32[]",name:"toData",type:"bytes32[]"}],name:"newLinks",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"linkType",type:"bytes32"},{internalType:"string",name:"description",type:"string"}],name:"newLinkType",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"linkType",type:"bytes32"},{indexed:!1,internalType:"string",name:"description",type:"string"}],name:"NewLinkType",type:"event"}],this.contractAddress="0x305306F68D9C230B59d5B6869AEd1723365C9290"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},387:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(13),a=n.n(r),i=n(527),s=.75;function o(e,t,n){var r=(new Date).getTime(),o=e.getChannelData(0),u=o.length,l=1e3*u/a.a.context.sampleRate;if(u/a.a.context.sampleRate<s)return{onsets:[],tempo:0};for(var p=t.asm._initTempo(1024,256,a.a.context.sampleRate,n,-45),h=t._newBuffer(256),f=[],d=new Set,m=o.length/256-1,v=u/256-1,g=0;g<m;g++){var y=o.subarray(256*g,256*(g+1));t.HEAPF32.set(y,h>>2);var b=t.asm._processTempo(p,h),k=t.asm._getOnset(p);0===g&&(b=c(y)?1:0);var E=t.asm._getTempo(p);f.push(E),0!=b&&g<v&&k<.8*l&&d.add(k)}d=Array.from(d),t._destroyBuffer(h),t.asm._dispose(p);var O=Object(i.a)(f.filter(function(e){return 0!=e}))||0;O>180&&(O/=2);(new Date).getTime();return{tempo:O,onsets:d,onsetToPitch:{}}}function c(e){return Math.sqrt(e.reduce(function(e,t){return e+Math.pow(t,2)})/e.length)>.1}},388:function(e,t,n){"use strict";(function(e){var r=n(3),a=n.n(r),i=n(12),s=n(4),o=n(5),c=n(377),u=n(49),l=n(39),p=new c.a,h=n(114),f=function(){function e(t){Object(s.a)(this,e),this.web3=t,this.cachedUserNames={}}return Object(o.a)(e,[{key:"isUserNameAvailable",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var s,o,c;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.web3.eth.getAccounts();case 2:return s=n.sent,s[0],o=p.getContract(t.web3),n.prev=5,n.next=8,o.methods.isUserNameAvailable(e).call();case 8:c=n.sent,r(c),n.next=16;break;case 12:n.prev=12,n.t0=n.catch(5),console.log(n.t0),i(n.t0);case 16:case"end":return n.stop()}},n,null,[[5,12]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getUserId",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var s,o,c;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.web3.eth.getAccounts();case 2:return s=n.sent,s[0],o=p.getContract(t.web3),n.prev=5,n.next=8,o.methods.getUserAddressFromName(e).call();case 8:c=n.sent,r(c),n.next=16;break;case 12:n.prev=12,n.t0=n.catch(5),console.log(n.t0),i(n.t0);case 16:case"end":return n.stop()}},n,null,[[5,12]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"setUserName",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var s;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.web3.eth.getAccounts();case 2:s=n.sent,p.getContract(t.web3).methods.setName(e).send({from:s[0]},function(e,t){e?i(e):r()});case 5:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"setProfile",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var s,o;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.web3.eth.getAccounts();case 2:return s=n.sent,n.next=5,l.a.addJson(e);case 5:o=d(o=n.sent),p.getContract(t.web3).methods.setProfileHash(o).send({from:s[0]},function(e,t){e?i(e):r()});case 9:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getUserName",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var s,o,c;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(s=window.localStorage,!t.cachedUserNames[e]){n.next=4;break}return r(t.cachedUserNames[e]),n.abrupt("return");case 4:if(!s.getItem("username:"+e)){n.next=7;break}return r(s.getItem("username:"+e)),n.abrupt("return");case 7:if(void 0!==e){n.next=11;break}return n.next=10,u.a.getAccount();case 10:e=n.sent;case 11:if(void 0!==e){n.next=14;break}return r(void 0),n.abrupt("return");case 14:if(!(e in t.cachedUserNames)){n.next=17;break}return r(t.cachedUserNames[e]),n.abrupt("return");case 17:return o=p.getContract(t.web3),n.prev=18,n.next=21,o.methods.getUserName(e).call();case 21:if(c=n.sent,s.setItem("username:"+e,c),""!==c){n.next=26;break}return r(void 0),n.abrupt("return");case 26:t.cachedUserNames[e]=c,r(c),n.next=33;break;case 30:n.prev=30,n.t0=n.catch(18),i(n.t0);case 33:case"end":return n.stop()}},n,null,[[18,30]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getProfile",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var s,o,c,u;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0!==e){n.next=8;break}return n.next=3,t.web3.eth.getAccounts();case 3:if(void 0!==(s=n.sent)&&0!==s.length){n.next=7;break}return i("no ethereum"),n.abrupt("return");case 7:e=s[0];case 8:return o=p.getContract(t.web3),n.next=11,o.methods.getUserProfile(e).call();case 11:if(c=n.sent,n.prev=12,0!==t.web3.utils.hexToNumber(c)){n.next=16;break}return r("no profile"),n.abrupt("return");case 16:n.next=21;break;case 18:n.prev=18,n.t0=n.catch(12),console.log("had error while trying to get profile");case 21:return c=m(c),n.next=24,l.a.getJson(c);case 24:u=n.sent,r(u);case 26:case"end":return n.stop()}},n,null,[[12,18]])}));return function(e,t){return n.apply(this,arguments)}}())}}]),e}();function d(e){var t=h.decode(e).toString("hex").replace(/^1220/,"");return 64!=t.length?null:"0x"+t}function m(t){var n=new e(t.replace(/^0x/,"1220"),"hex");return h.encode(n)}t.a=f}).call(this,n(14).Buffer)},39:function(e,t,n){"use strict";(function(e){var r=n(3),a=n.n(r),i=n(12),s=n(4),o=n(5),c=n(303),u=n.n(c),l=n(334),p=new XMLHttpRequest,h="/ip4/3.17.26.249/tcp/4001/ipfs/QmeQRpfSrYcAaqkhNoArDyTUwyYiru2gJp4WY1WegQGjtR",f=[85,110,105,118,101,114,115,97,108,32,83,101,113,101,117,110,99,101,115],d=new(function(){function t(){Object(s.a)(this,t),this.controllers=new Set,"http:"===window.location.protocol?(this.backupIpfs=new u.a("ipfs.infura.io","5001",{protocol:"https"}),this.centralIpfs=u()("www.universalsequences.com","5001",{protocol:"http"})):this.centralIpfs=u()("www.universalsequences.com","5002",{protocol:"https"}),this.ipfs=this.centralIpfs;var e=this;this.connectedLocally=!1,this.finishedTestingLocalConnection=!1,p.onreadystatechange=function(){4==p.readyState&&200==p.status&&(e.ipfs=u()("localhost","5001",{protocol:"http"}),e.connectToCentral(),e.connectedLocally=!0,e.finishedTestingLocalConnection=!0)},p.open("POST","http://localhost:5001/api/v0/swarm/peers",!0),p.timeout=4e3,p.ontimeout=function(){console.log("timed out connecting to local ipfs daemon")},p.send("")}return Object(o.a)(t,[{key:"restart",value:function(){}},{key:"getIPFSPrefix",value:function(){return this.connectedLocally?"http://localhost:5001":"http:"===window.location.protocol?"http://www.universalsequences.com:5001":"https:"===window.location.protocol?"https://www.universalsequences.com:5002":void 0}},{key:"getHashUrl",value:function(e){return this.connectedLocally?"http://localhost:8080/ipfs/"+e:"http://zequencer.io:8080/ipfs/"+e}},{key:"getPinnedHashes",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ipfs.refs.local();case 2:e.sent;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),Object(o.a)(t,[{key:"findProvs",value:function(e){var t=this;return new Promise(function(n,r){t.ipfs.dht.findprovs(e,{maxNumProviders:1},function(e,t){n(t)})})}},{key:"connectToCentral",value:function(){try{this.ipfs.swarm.connect(h,function(e,t){}).catch(function(e){return console.log("error")})}catch(e){console.log("error connecting to ipfs")}}},{key:"keepSwarmConnectionAlive",value:function(){var e=this;try{this.ipfs.swarm.connect(h,function(e,t){}).catch(function(e){return console.log("error")})}catch(t){console.log("error connecting to ipfs")}setInterval(function(){if(window.sequencerEngine&&window.sequencerEngine.getSequenceId){var n=window.sequencerEngine.getSequenceId();if(window.sequencerEngine.store.getState().sequencer.isPlaying[n])return}try{e.ipfs.swarm.connect(h,function(e,t){}).catch(function(e){return console.log("error")})}catch(t){console.log("error connecting to ipfs")}},6e4)}},{key:"isConnectedLocally",value:function(){return this.connectedLocally}},{key:"addArrayBuffer",value:function(e,t){return this.addHelper(e,t)}},{key:"addArrayBufferAndSaveToDB",value:function(e,t){return this.addBlobAndSaveToDB(new Blob([new Uint8Array(e)]),t)}},{key:"addHelper",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var n=this;return new Promise(function(r,a){n.ipfs.add({path:"hello",content:new e(t)},function(e,t){var n=t[0].hash;e?a(e):r(n)})})}},{key:"addJson",value:function(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"LOCAL";return new Promise(function(a,i){var s="UNIVERSAL"===r?n.centralIpfs:"LOCAL"===r?n.ipfs:n.backupIpfs;s.add({path:"sequence",content:e.from(JSON.stringify(t),"utf8")},function(e,t){if(e)i(e);else{var n=t[0].hash;s.pin.add(n),a(n)}}),"LOCAL"===r&&(s!==n.centralIpfs&&n.addJson(t,"UNIVERSAL").then(function(e){return a(e)}),n.addJson(t,"INFURA").then(function(e){return a(e)}))})}},{key:"getJson",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.restart();var r=this.finishedTestingLocalConnection?0:1e3;return new Promise(function(a,i){setTimeout(function(){(n?t.centralIpfs:t.ipfs).cat(e,function(e,t){if(e)throw e;a(JSON.parse(t.toString("utf8")))})},r)})}},{key:"addBytesArray",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new Uint8Array(t.length+f.length)).set(t,0),n.set(f,t.length),e.next=5,this.addHelper(n.buffer);case 5:return r=e.sent,this.ipfs.pin.add(r),e.abrupt("return",r);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addBlob",value:function(e){var t=this;return this.restart(),new Promise(function(n,r){var a,i=new FileReader,s=t;i.onload=function(){var e=this;a=this.result,s.addHelper(a).then(function(t){e.connectedLocally&&s.ipfs.pin.add(t),s.centralIpfs.pin.add(t),n(t)}).catch(function(e){return r(e)})},i.readAsArrayBuffer(e)})}},{key:"addBlobAndSaveToDB",value:function(e,t){}},{key:"converttoarraybuffer",value:function(e){return new Promise(function(t,n){var r=new r;r.onload=function(){t(this.result)},r.readasarraybuffer(e)})}},{key:"readAllChunks",value:function(e){var t=e.getReader(),n=[];return function e(){return t.read().then(function(t){var r=t.value;return t.done?n:(n.push(r),e())})}()}},{key:"getSound",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e4;return new Promise(function(r,s){var o=new AbortController;t.controllers.add(o);var c=o.signal;setTimeout(function(){o.abort(),t.controllers.delete(o),s()},n),fetch(t.getIPFSPrefix()+"/api/v0/get?arg="+e+"&stream-channels=true",{signal:c,method:"POST"}).then(function(){var e=Object(i.a)(a.a.mark(function e(n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.readAllChunks(n.body).then(function(e){var n=t.mergeArrays(e);r(n)}).catch(function(e){return console.log("error reading chunks")});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){console.log("aborted")})})}},{key:"arrayToBuffer",value:function(e){var t=new ArrayBuffer(e.length);return e.map(function(e,n){t[n]=e}),t}},{key:"cancel",value:function(){console.log("cancelling = ",this.controllers),Array.from(this.controllers).forEach(function(e){return e.abort()})}},{key:"mergeArrays",value:function(e){var t=0;for(var n in e)t+=e[n].length;var r=new Uint8Array(t-512),a=0;for(var i in e)0===a?(r.set(e[i].subarray(512),a),a+=e[i].length-512):(r.set(e[i],a),a+=e[i].length);var s=r,o=this.findEnd(s,f);return-1!==o?s.slice(0,o):r.slice(0,r.length-1024)}},{key:"findEnd",value:function(e,t){for(var n=e.length-1600,r=e.slice(n).values(),a=0,i=n;i<e.length;i++){if(r.next().value===t[a]){if(0==a&&(n=i),++a===t.length-1)return n}else a=0,n=i}return-1}},{key:"getAudioBuffer",value:function(e,t){var n=this;return this.restart(),new Promise(function(r,a){n.getSound(e).then(function(e){return t.decodeAudioData(l(e),function(e){r(e)},function(e,t,n){n&&a(n)})}).catch(function(e){a(e)})})}}]),t}());t.a=d}).call(this,n(14).Buffer)},40:function(e,t,n){"use strict";n(90);var r=n(377),a=n(168),i=n(378),s=n(379),o=n(380),c=n(381),u=n(382),l=n(383),p=n(384),h=n(4),f=n(5),d=function(){function e(){Object(h.a)(this,e),this.abi=[{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SequenceFavorited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SequenceStarred",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"tag",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SequenceTagged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SequenceUnfavorited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SequenceUnstarred",type:"event"},{constant:!1,inputs:[{internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"favoriteSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"starSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{internalType:"bytes32",name:"tag",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"tagSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"unfavoriteSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"unstarSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"}],this.contractAddress="0x03172e863dbF7EEb3994AF5a6608c470eB6E79fC"}return Object(f.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),m=n(385),v=n(386),g=function(){function e(){Object(h.a)(this,e),this.abi=[{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"mixHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"sequenceHash",type:"bytes32"}],name:"MixUsedSequence",type:"event"},{inputs:[{internalType:"bytes32",name:"mixHash",type:"bytes32"},{internalType:"string",name:"title",type:"string"},{internalType:"bytes32[]",name:"sequencesUsed",type:"bytes32[]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"newMix",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"mixHash",type:"bytes32"},{indexed:!1,internalType:"string",name:"title",type:"string"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"NewMix",type:"event"}],this.contractAddress="0x92435DDd3CD432259903322a2E41257CbEF439A5"}return Object(f.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),y=n(27);n.d(t,"e",function(){return b}),n.d(t,"i",function(){return k}),n.d(t,"f",function(){return E}),n.d(t,"d",function(){return O}),n.d(t,"c",function(){return S}),n.d(t,"a",function(){return P}),n.d(t,"b",function(){return w}),n.d(t,"g",function(){return j}),n.d(t,"h",function(){return T}),n.d(t,"j",function(){return x});var b="GUILD_SAMPLES",k="TOKENIZED_SEQUENCES",E="GUILD_SEQUENCES",O="GUILD_PRESETS",S="GUILDS",P="ENCRYPTION",w="FOLDERS",j="MESSAGING",T="RESAMPLE",x={USERS:(new r.a).getContract(y.a),GUILDS:(new c.a).getContract(y.a),GUILD_SAMPLES:(new a.a).getContract(y.a),TOKENIZED_SEQUENCES:(new i.a).getContract(y.a),GUILD_SEQUENCES:(new s.a).getContract(y.a),GUILD_PRESETS:(new o.a).getContract(y.a),ENCRYPTION:(new u.a).getContract(y.a),FOLDERS:(new l.a).getContract(y.a),MESSAGING:(new p.a).getContract(y.a),SEQUENCE_METADATA:(new d).getContract(y.a),RESAMPLE:(new m.a).getContract(y.a),XANADU:(new v.a).getContract(y.a),MIX:(new g).getContract(y.a)}},41:function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(17),s=n(9),o=n(10),c=n(1),u=n(97);n(31);function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var p=function(e){Object(s.a)(n,e);var t=l(n);function n(e){return Object(r.a)(this,n),t.call(this,e)}return Object(a.a)(n,[{key:"executeQuery",value:function(){var e=this;if(!(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])||window.installation)return Object(i.a)(Object(c.a)(n.prototype),"executeQuery",this).call(this);this.getJson(),(new Date).getTime();return new Promise(function(t,n){fetch("/search/",{method:"POST",body:JSON.stringify(e.getJson()),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){(new Date).getTime();t(e||[])}).catch(function(e){console.log(e)})})}}]),n}(u.a);t.a=p},42:function(e,t,n){"use strict";var r=n(4),a=n(5),i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],s={C:0,"C#":1,D:2,"D#":3,E:4,F:5,"F#":6,G:7,"G#":8,A:9,"A#":10,B:11},o={"C#":!0,"D#":!0,"F#":!0,"G#":!0,"A#":!0},c={},u=function(){function e(t,n){Object(r.a)(this,e),void 0===t&&(t="C"),this.note=t.toUpperCase(),this.octave=n}return Object(a.a)(e,[{key:"isBlackNote",value:function(){return o[this.note]}},{key:"transpose",value:function(t){this.note;var n=Math.floor(p(t,12)),r=Math.floor(t/12);return new e(i[n],this.octave+r)}},{key:"addTranspose",value:function(t){var n=s[this.note],r=Math.floor(p(t+n,12)),a=Math.floor((t+n)/12);return new e(i[r],this.octave+a)}},{key:"toString",value:function(){return this.note+this.octave}},{key:"getTranspose",value:function(){this.noteIndex();return 12*(this.octave-l.octave)+(this.noteIndex()-l.noteIndex())}},{key:"noteIndex",value:function(){return s[this.note]}},{key:"getCopy",value:function(){return new e(this.note,this.octave)}},{key:"equal",value:function(e){return this.note===e.note&&this.octave===e.octave}}]),e}(),l=new u("C",3);function p(e,t){return(e%t+t)%t}function h(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t&&c[e])return c[e];var n=void 0;return n="#"===e.substring(1,2)?new u(e.substring(0,2),parseInt(e.substring(2))):new u(e.substring(0,1),parseInt(e.substring(1))),t&&(c[e]=n),n}for(var f=i.map(function(e){return new u(e,3)}),d=0;d<16;d++)for(var m in i){h(i[m]+d)}t.a={Note:u,middleC:l,fromString:h,fromTranspose:function(e){return l.getCopy().transpose(e)},NOTES:f,baseNotes:i}},425:function(e,t){},45:function(e,t,n){"use strict";n.d(t,"e",function(){return r}),n.d(t,"d",function(){return a}),n.d(t,"a",function(){return i}),n.d(t,"b",function(){return s}),n.d(t,"c",function(){return o});var r="SAMPLER",a="MIDI",i="AUDIO",s="INSTRUMENT",o="INSTRUMENT_RACK"},49:function(e,t,n){"use strict";var r=n(3),a=n.n(r),i=n(12),s=n(4),o=n(5),c=n(251),u=n.n(c),l=n(8),p=new(function(){function e(){Object(s.a)(this,e)}return Object(o.a)(e,[{key:"setEthereum",value:function(e){this.ethereum=e}},{key:"setStore",value:function(e){this.store=e}},{key:"isMetamaskInstalled",value:function(){return"undefined"!==typeof window.web3}},{key:"isLoggedIn",value:function(){return this.isMetamaskInstalled()||void 0!==this.store.getState().sequencer.userToken}},{key:"getToken",value:function(){var e=this.store.getState().sequencer.userToken;return e?e.token:void 0}},{key:"checkLogin",value:function(){var e=this,t=u.a.load("token");""!==t&&void 0!==t&&fetch("/checkToken/"+t,{method:"POST",headers:{Accept:"text/html","Content-Type":"text/html"}}).then(function(){var t=Object(i.a)(a.a.mark(function t(n){var r,i;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(401!==n.status){t.next=3;break}t.next=8;break;case 3:return t.next=5,n.text();case 5:r=t.sent,i=u.a.load("token"),e.store.dispatch(Object(l.be)(r,i));case 8:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}},{key:"logout",value:function(){this.store.dispatch(Object(l.be)(void 0)),u.a.remove("token",{path:"/"})}},{key:"signUp",value:function(e,t){var n=this;fetch("/signUp/"+e+"/"+t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(r){var a=u.a.load("token");n.store.dispatch(Object(l.be)(e,a)),n.ethereum.crypto.password=t})}},{key:"login",value:function(e,t){var n=this;return new Promise(function(r,a){fetch("/login/"+e+"/"+t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(a){if(401===a.status)r(!1);else{var i=u.a.load("token");n.store.dispatch(Object(l.be)(e,i)),n.ethereum.crypto.password=t,n.ethereum.guilds.onUserChanged(),n.account=void 0,r(!0)}})})}},{key:"getAccount",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.installation){e.next=2;break}return e.abrupt("return",void 0);case 2:if(!this.isMetamaskInstalled()){e.next=6;break}return e.abrupt("return",this.ethereum.getUser());case 6:return e.abrupt("return",new Promise(function(){var e=Object(i.a)(a.a.mark(function e(n,r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.account){e.next=3;break}return n(t.account),e.abrupt("return");case 3:fetch("/getAccount/",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include"}).then(function(){var e=Object(i.a)(a.a.mark(function e(r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(401!==r.status&&404!==r.status){e.next=4;break}n(void 0),e.next=8;break;case 4:return e.next=6,r.text();case 6:t.account=e.sent,n(t.account);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUserName",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isMetamaskInstalled()){e.next=10;break}return e.next=3,this.ethereum.getUser();case 3:return t=e.sent,e.next=6,this.ethereum.users.getUserName(t);case 6:return n=e.sent,e.abrupt("return",n);case 10:if(!this.isLoggedIn()){e.next=14;break}return e.abrupt("return",this.store.getState().sequencer.userToken.userName);case 14:return console.log("is not logged in..."),e.abrupt("return","Not Logged In");case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}());t.a=p},524:function(e,t,n){},525:function(e,t,n){},526:function(e,t,n){},527:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(15);function a(e){return(e=Object(r.a)(e)).sort(),e[Math.floor(e.length/2)]}},530:function(e,t,n){"use strict";var r=n(11),a=n(3),i=n.n(a),s=n(12),o=n(4),c=n(5),u=n(380),l=n(153),p=function(){function e(t){Object(o.a)(this,e),this.crypto=t}return Object(c.a)(e,[{key:"decryptQueryResult",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var a,s,o,c,u;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("query decryptor"),a=Object(l.b)(t.encryptedContentKey),e.next=4,this.crypto.decryptName(t.encryptedName,a,n);case 4:return s=e.sent,o=t.user,e.next=8,this.crypto.decryptContentKey(a,n);case 8:return c=e.sent,u=Object(r.a)({},t,{title:Object(l.b)(s),encryptedTitle:t.encryptedName,user:"0x"+Object(l.a)(o.slice(2)),contentKey:c?c.contentKey:void 0,publicKey:Object(l.b)(t.publicKey)}),e.abrupt("return",u);case 11:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),h=(n(90),n(70)),f=n(40),d=n(39),m=n(63);function v(e,t){var n=new Set,r=Array.from(e);for(var a in r)t.has(r[a])&&n.add(r[a]);return n}var g=n(41),y=n(31),b=n(27),k=(window.web3,new u.a),E=b.a.utils.padLeft("0x0",64),O=function(){function e(t,n,r){Object(o.a)(this,e),this.web3=t,this.contract=new t.eth.Contract(k.abi,k.contractAddress),this.crypto=n,this.guilds=r,this.queryDecryptor=new p(this.crypto)}return Object(c.a)(e,[{key:"getPresetData",value:function(){var e=Object(s.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=4;break}return e.next=3,d.a.getJson(t);case 3:return e.abrupt("return",e.sent);case 4:if(0!==t.guildId&&null!==t.guildId&&void 0!==t.guildId){e.next=8;break}return e.next=7,d.a.getJson(t.contentHash);case 7:return e.abrupt("return",e.sent);case 8:return e.t0=JSON,e.next=11,this.crypto.fetchAndDecrypt(t.contentHash,t);case 11:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPresetTitle",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new g.a(this.contract.options.address).from(y.t).select("encryptedName").where("contentHash",t),e.next=3,n.executeQuery();case 3:if(0!==(r=e.sent).length){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",r[0].title);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"newPreset",value:function(e,t,n,r,a){var o=this;k.getContract(b.a);return new Promise(function(){var c=Object(s.a)(i.a.mark(function s(c,u){var l,p,v,g,y;return i.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(l=void 0,p=new Array(9).fill(E),v=new Array(6).fill(E),0===a){i.next=18;break}return i.next=6,o.guilds.getGuildKey(a);case 6:return g=i.sent,i.next=9,o.crypto.encryptRawContent(JSON.stringify(e),t,g.rawPublicKey);case 9:return y=i.sent,i.next=12,d.a.addJson(y.encryptedContent);case 12:l=i.sent,t=o.web3.utils.padLeft("0x"+y.encryptedName,64),p=y.encryptedContentKey,v=g.publicKey,i.next=22;break;case 18:return t=o.web3.utils.fromAscii(t),i.next=21,d.a.addJson(e);case 21:l=i.sent;case 22:n=void 0===n?E:Object(m.a)(n),r=void 0===r?E:b.a.utils.fromAscii(r),new h.a(f.d,"newPreset",[Object(m.a)(l),t,n,r,a,p,v]).execute(),c(l);case 26:case"end":return i.stop()}},s)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"tagPreset",value:function(e,t,n){null!==n&&void 0!==n||(n=0);k.getContract(b.a);return new Promise(function(){var r=Object(s.a)(i.a.mark(function r(a,s){var o;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:for(o=t.map(function(e){return b.a.utils.fromAscii(e)});o.length<4;)o.push(E);o.length>4&&(o=o.slice(0,4)),new h.a(f.d,"tagPreset",[Object(m.a)(e),o,n]).execute().then(function(){return a()});case 4:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"getTotalPresets",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new g.a(this.contract.options.address).from(y.t).select("user").select("title").select("contentHash"),e.next=3,t.executeQuery();case 3:return n=e.sent,e.abrupt("return",n.length);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getPresets",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPaginatedPresets(0,t,1e3,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getPaginatedPresets",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var a,s,o,c,u,l,p,h=this,f=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=f.length>2&&void 0!==f[2]?f[2]:10,s=f.length>3&&void 0!==f[3]?f[3]:0,console.log("get paginted presets called with guildId = "+s),console.log("filter = "),console.log(n),o=new g.a(this.contract.options.address).from(y.t).select("user").select("encryptedName").select("contentHash").select("encryptedContentKey").select("publicKey").select("guildId").where("guildId",s),e.next=8,o.executeQuery();case 8:if(c=e.sent,this.isFilterEmpty(n)){e.next=13;break}return e.next=12,this.filterPresets(c,n);case 12:c=e.sent;case 13:if(0===s){e.next=31;break}return e.next=16,this.guilds.getGuildKey(s);case 16:u=e.sent,l=[],e.t0=i.a.keys(c);case 19:if((e.t1=e.t0()).done){e.next=28;break}return p=e.t1.value,e.t2=l,e.next=24,this.queryDecryptor.decryptQueryResult(c[p],u.privateKey);case 24:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=19;break;case 28:c=l,e.next=32;break;case 31:c=c.map(function(e){return Object(r.a)({},e,{title:h.web3.utils.toAscii("0x"+e.encryptedName)})});case 32:if(!(c.length<=t+a)){e.next=34;break}return e.abrupt("return",c.slice(t));case 34:return e.abrupt("return",c.slice(t,t+a));case 35:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"isFilterEmpty",value:function(e){for(var t in e.instrumentTypes)if(e.instrumentTypes[t])return!1;for(var n in e.tags)if(e.tags[n])return!1;return!0}},{key:"getPresetSampleHash",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new g.a(this.contract.options.address).from(y.w).select("sampleHash").where("contentHash",t),e.next=3,n.executeQuery();case 3:if(0!==(r=e.sent).length){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",r[0].sampleHash);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPresetInstrumentType",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new g.a(this.contract.options.address).from(y.v).select("instrumentType").where("contentHash",t),e.next=3,n.executeQuery();case 3:if(0!==(r=e.sent).length){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",r[0].instrumentType);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllTags",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r,a,s,o,c=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:0,!this.isFilterEmpty(t)){e.next=5;break}return e.next=4,this.getFilteredTags(void 0,void 0,n);case 4:return e.abrupt("return",e.sent);case 5:return e.next=7,this.getPresets(t,n);case 7:r=e.sent,a=[],e.t0=i.a.keys(r);case 10:if((e.t1=e.t0()).done){e.next=18;break}return s=e.t1.value,e.next=14,this.getTags(r[s].contentHash);case 14:(o=e.sent)&&(a=a.concat(o)),e.next=10;break;case 18:return e.abrupt("return",Array.from(new Set(a)));case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getFilteredTags",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r,a,s,o=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:0,a=new g.a(this.contract.address).from(y.x).where("guildId",r).select("tag"),void 0!==n&&a.where(t,n),e.next=5,a.executeQuery();case 5:return s=(s=e.sent).map(function(e){return e.tag}).filter(function(e){return""!==e}),e.abrupt("return",Array.from(new Set(s)));case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTags",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new g.a(this.contract.address).from(y.x).select("tag").where("contentHash",t),e.next=3,n.executeQuery();case 3:return(r=(r=e.sent).map(function(e){return e.tag}).filter(function(e){return""!==e})).sort(),e.abrupt("return",Array.from(new Set(r)));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"filterPresets",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r,a,s,o,c,u,l,p,h,f,d,m,b,k,E;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new Set,a=new Set,!n.instrumentTypes){e.next=15;break}e.t0=i.a.keys(n.instrumentTypes);case 4:if((e.t1=e.t0()).done){e.next=15;break}if(s=e.t1.value,n.instrumentTypes[s]){e.next=8;break}return e.abrupt("continue",4);case 8:return o=new g.a(this.contract.address).from(y.v).select("contentHash").where("instrumentType",s),e.next=11,o.executeQuery();case 11:for(u in c=e.sent)for(p in l=c[u].contentHash,t)t[p].contentHash===l&&r.add(t[p].contentHash);e.next=4;break;case 15:if(!n.tags){e.next=28;break}e.t2=i.a.keys(n.tags);case 17:if((e.t3=e.t2()).done){e.next=28;break}if(h=e.t3.value,n.tags[h]){e.next=21;break}return e.abrupt("continue",17);case 21:return f=new g.a(this.contract.address).from(y.x).select("contentHash").where("tag",h),e.next=24,f.executeQuery();case 24:for(m in d=e.sent)for(k in b=d[m].contentHash,t)t[k].contentHash===b&&a.add(t[k].contentHash);e.next=17;break;case 28:if(0!==r.size){e.next=32;break}return e.abrupt("return",this.convertToPresets(Array.from(a),t));case 32:if(0!==a.size){e.next=34;break}return e.abrupt("return",this.convertToPresets(Array.from(r),t));case 34:return E=Array.from(v(r,a)),e.abrupt("return",this.convertToPresets(E,t));case 36:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"convertToPresets",value:function(e,t){var n=[];for(var r in e)for(var a in t)t[a].contentHash===e[r]&&n.push(t[a]);return n}},{key:"getAllUserAddresses",value:function(){var e=Object(s.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=O},531:function(e,t,n){"use strict";var r=n(3),a=n.n(r),i=n(12),s=n(4),o=n(5),c=n(132),u=n.n(c),l=n(49),p=n(8),h=n(169),f=n(26),d=function(){function e(t){Object(s.a)(this,e),this.store=t,this.masterKey=void 0,this.masterPublicKey=void 0,this.promptingPassword=!1}return Object(o.a)(e,[{key:"needsPassword",value:function(){return void 0===this.masterPublicKey}},{key:"isCorrectPassword",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.encryption.getPublicKey();case 2:if(n=e.sent,console.log("public key = "+n),void 0!==n){e.next=6;break}return e.abrupt("return",!0);case 6:return r=u.a.generateRSAKey(t,1024),i=u.a.publicKeyString(r),s=n===i,e.abrupt("return",s);case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"syncPassword",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.masterPublicKey){e.next=4;break}return e.next=3,this.getPassword();case 3:this.password=e.sent;case 4:t=this.getPublicKeyAsBytes32(),f.a.encryption.newPublicKey(t);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getPublicKeyAsBytes32",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.masterPublicKey,t=f.a.web3.utils.toHex(e);return Object(h.a)(t)}},{key:"sleep",value:function(e){return new Promise(function(e,t){e()},e)}},{key:"getPassword",value:function(){var e=this;return this.passwordPromise?this.passwordPromise:(this.passwordPromise=new Promise(function(){var t=Object(i.a)(a.a.mark(function t(n,r){var i,s;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===e.masterPublicKey){t.next=3;break}return n(void 0),t.abrupt("return");case 3:return t.next=5,l.a.getAccount();case 5:if(i=t.sent,null===sessionStorage.getItem("user_password."+i)){t.next=14;break}if(s=sessionStorage.getItem("user_password."+i),console.log("password we got from cache = "+s),!e.isCorrectPassword(s)){t.next=13;break}return e.password=s,n(s),t.abrupt("return");case 13:console.log("was incorrect password...");case 14:e.store.dispatch(Object(p.cc)(function(t){void 0!==t?(e.password=t,n(t)):e.passwordPromise=void 0})),e.store.dispatch(Object(p.bd)(!0));case 16:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()),this.passwordPromise)}},{key:"getPublicKeyIfNeeded",value:function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=6;break}if(void 0!==this.masterPublicKey){e.next=5;break}return e.next=4,this.getPassword();case 4:this.password=e.sent;case 5:t=this.masterPublicKey;case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPrivateKeyIfNeeded",value:function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=6;break}if(void 0!==this.masterKey){e.next=5;break}return e.next=4,this.getPassword();case 4:this.password=e.sent;case 5:t=this.masterKey;case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"password",set:function(e){void 0!==e&&(this.masterKey=u.a.generateRSAKey(e,1024),this.masterPublicKey=u.a.publicKeyString(this.masterKey),l.a.getAccount().then(function(t){console.log('setItem("user_password"'+t+","+e+")"),sessionStorage.setItem("user_password."+t,e)}))}}]),e}(),m=n(172),v=(n(1629),n(133)),g=n.n(v),y=n(39),b=function(){function e(t,n){Object(s.a)(this,e),this.ethereum=t,this.web3=this.ethereum.web3,this.passwordManager=new d(n),this.store=n}return Object(o.a)(e,[{key:"needsPassword",value:function(){return this.passwordManager.needsPassword()}},{key:"syncPassword",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.passwordManager.syncPassword();case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"isCorrectPassword",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.passwordManager.isCorrectPassword(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPassword",value:function(){var e=Object(i.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.passwordManager.getPassword();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"generateGuildKey",value:function(e){var t=u.a.generateRSAKey(e,1024),n=u.a.publicKeyString(t),r=this.ethereum.web3.utils.toHex(n);return{publicKey:Object(h.a)(r),rawPublicKey:n,privateKey:t,passphrase:e}}},{key:"encryptAndSave",value:function(e,t,n){var r=this;!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new Promise(function(){var s=Object(i.a)(a.a.mark(function s(o,c){var u,l,p;return a.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,r.passwordManager.getPublicKeyIfNeeded(r.masterPublicKey);case 2:if(s.sent,(u=new m.a).encryptKey(r.masterPublicKey),!n){s.next=10;break}return s.next=8,r.ethereum.encryption.getEncryptedSequenceIfAny(n);case 8:void 0!==(l=s.sent)&&(u=l[0].contentKey,u=new m.a(g.a.utils.hex.toBytes(u)));case 10:return s.next=12,u.encryptContent(JSON.stringify(t));case 12:p=s.sent,y.a.addJson(p).then(function(){var t=Object(i.a)(a.a.mark(function t(i){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=r.ethereum.encryption,t.t1=n,t.t2=i,t.next=5,u.encryptContent(e);case 5:t.t3=t.sent,t.t4=u.convertForEthereum(),t.t5=r.passwordManager.getPublicKeyAsBytes32(),t.t0.newEncryptedSequence.call(t.t0,t.t1,t.t2,t.t3,t.t4,t.t5),o(i);case 10:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}());case 14:case"end":return s.stop()}},s)}));return function(e,t){return s.apply(this,arguments)}}())}},{key:"encryptRawContent",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,s,o=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:this.masterPublicKey,i=o.length>3&&void 0!==o[3]&&o[3],s=o.length>4?o[4]:void 0,e.next=5,this.passwordManager.getPublicKeyIfNeeded(r);case 5:return r=e.sent,void 0===s&&(s=new m.a),s.encryptKey(r),e.t0=this.passwordManager.getPublicKeyAsBytes32(r),e.t1=s.convertForEthereum(),e.t2=s,e.next=13,s.encryptContent(t,i);case 13:return e.t3=e.sent,e.next=16,s.encryptContent(n);case 16:return e.t4=e.sent,e.t5=s.encryptedContentKey,e.abrupt("return",{publicKey:e.t0,encryptedContentKey:e.t1,contentKey:e.t2,encryptedContent:e.t3,encryptedName:e.t4,eCk:e.t5});case 19:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"encryptAndUploadJSON",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.masterPublicKey;return new Promise(function(){var r=Object(i.a)(a.a.mark(function r(i,s){var o;return a.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.encryptRawContent(JSON.stringify(e),"",n);case 2:o=r.sent,y.a.addJson(o.encryptedContent).then(function(e){return i({publicKey:o.publicKey,encryptedContentKey:o.encryptedContentKey,encryptedContentIpfsHash:e,contentKey:o.contentKey})});case 4:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"decryptName",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t&&void 0!==t){e.next=2;break}return e.abrupt("return","");case 2:return e.next=4,this.passwordManager.getPrivateKeyIfNeeded(r);case 4:return r=e.sent,g.a.utils.hex.toBytes(t),e.next=8,this.decryptContentKey(n,r);case 8:if(void 0!==(i=e.sent)){e.next=11;break}return e.abrupt("return","");case 11:return e.next=13,i.decryptContent(t);case 13:return t=e.sent,e.abrupt("return",t);case 15:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"decryptContentKey",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.passwordManager.getPrivateKeyIfNeeded(n);case 2:if(n=e.sent,r=this.web3.utils.toAscii("0x"+t),"failure"!==(i=u.a.decrypt(r,n)).status){e.next=7;break}return e.abrupt("return",void 0);case 7:return e.abrupt("return",new m.a(i.plaintext));case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"fetchAndDecrypt",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,s,o,c,u=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>2&&void 0!==u[2]&&u[2],new Date,void 0!==n.length&&(n=n[0]),i=n.contentKey,!r){e.next=10;break}return e.next=7,y.a.getSound(t);case 7:e.t0=e.sent,e.next=13;break;case 10:return e.next=12,y.a.getJson(t);case 12:e.t0=e.sent;case 13:return s=e.t0,e.next=16,this.passwordManager.getPrivateKeyIfNeeded();case 16:return o=new m.a(i),e.next=19,o.decryptContent(s,r);case 19:return c=e.sent,e.abrupt("return",c);case 21:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"stripHexPrefix",value:function(e){return 0===e.indexOf("0x")?e.slice(2):e}},{key:"strip",value:function(e,t){return e.slice(0,e.length-t)}},{key:"getPublicKeyFromBytes32",value:function(e){var t="0x";for(var n in e)t+=this.stripHexPrefix(e[n]);return t=this.strip(t,38),this.ethereum.web3.utils.toAscii(t)}},{key:"shareSequence",value:function(e,t){var n=this;return new Promise(function(){var r=Object(i.a)(a.a.mark(function r(i,s){var o,c;return a.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.ethereum.encryption.getPublicKey(t);case 2:if(void 0!==(o=r.sent)){r.next=6;break}return s("User has no public key"),r.abrupt("return");case 6:c=u.a.encrypt(e.contentKey,o).cipher,c=n.web3.utils.toHex(c),n.ethereum.encryption.shareEncryptedContent(t,e.id,Object(h.a)(c),n.passwordManager.getPublicKeyAsBytes32()),i();case 10:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"store",set:function(e){this.passwordManager.store=e}},{key:"password",set:function(e){this.passwordManager.password=e}},{key:"masterPublicKey",get:function(){return this.passwordManager.masterPublicKey},set:function(e){this.passwordManager.masterPublicKey=e}},{key:"masterKey",get:function(){return this.passwordManager.masterKey}}]),e}();t.a=b},56:function(e,t,n){"use strict";var r=n(15),a=n(3),i=n.n(a),s=n(12),o=n(4),c=n(5),u=n(9),l=n(10),p=n(1),h=(n(88),n(246)),f=n(13),d=n.n(f),m=n(387),v=n(26),g=n(39),y=(n(298),n(248)),b=n(61),k=(n(373),n(36));function E(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var O=n(334),S=new k.a,P=function(e){Object(u.a)(n,e);var t=E(n);function n(e,r,a){var i;return Object(o.a)(this,n),i=t.call(this),"number"==typeof e||Object(b.a)(e)?i.soundId=e:i.ipfsHash=e,i.guildId=a,i.downloadUrl=void 0,i.videoId=void 0,i.name=void 0,i.tags=void 0,i.slices=void 0,i.noteSequence=void 0,i.isStems=!1,i.guildId=void 0,i.encryptedIpfs=r||new y.a(window.sequencerEngine.store,window.sequencerEngine.ethereum.guilds,window.sequencerEngine.ethereum.encryption,window.sequencerEngine.ethereum.crypto),i.audioBuffer=void 0,i.addedToProject=!1,i.highlightedTags={},i.samplesUsed=[],i}return Object(c.a)(n,[{key:"getName",value:function(){return this.name}},{key:"getTagsToSave",value:function(){var e=this;return Object.keys(this.highlightedTags).length>0?Object.keys(this.highlightedTags).filter(function(t){return e.highlightedTags[t]}):this.tags}},{key:"getId",value:function(){return void 0!==this.soundId?this.soundId:this.ipfsHash}},{key:"fromJson",value:function(e){this.ipfsHash=e.id,this.name=e.name,this.videoId=e.videoId,this.tags=e.tags,this.slices=e.slices,this.coverArtHash=e.coverArtHash,this.discogsId=e.discogsId}},{key:"dispose",value:function(){!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this.addedToProject||(this.audioBuffer=void 0,this.discogsId=void 0,this.name=void 0,this.videoId=void 0,this.coverArtHash=void 0,this.slices=void 0)}},{key:"isLoaded",value:function(){return void 0!==this.audioBuffer}},{key:"getId",value:function(){return void 0!==this.ipfsHash?this.ipfsHash:this.soundId}},{key:"getJson",value:function(){return{id:this.getId(),slices:this.slices,name:this.name,videoId:this.videoId,tags:this.tags,thumbnail:this.getThumbnail(),discogsId:this.discogsId,coverArtHash:this.coverArtHash}}},{key:"fetchMetadata",value:function(){var e=this;if(void 0!==this.ipfsHash)return new Promise(function(){var t=Object(s.a)(i.a.mark(function t(n,r){var a,s,o;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.a.getTitleForSound(e.ipfsHash);case 2:return a=t.sent,t.next=5,v.a.getVideoIdForSound(e.ipfsHash);case 5:return s=t.sent,t.next=8,v.a.getCoverArtForSound(e.ipfsHash);case 8:o=t.sent,void 0!==a&&(e.name=a),void 0!==s&&(e.videoId=s),void 0!==o&&(e.coverArtHash=o),n(e);case 13:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"fetchTags",value:function(){var e=this;return new Promise(function(){var t=Object(s.a)(i.a.mark(function t(n,r){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e.soundId||void 0===e.ipfsHash){t.next=11;break}return t.t0=Set,t.next=4,v.a.getTagsForSound(e.ipfsHash);case 4:return t.t1=t.sent,a=new t.t0(t.t1),e.tags=Array.from(a),n(e.tags),t.abrupt("return");case 11:n([]);case 12:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"fetchSlices",value:function(){var e=this;return new Promise(function(){var t=Object(s.a)(i.a.mark(function t(n,r){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:v.a.getSlicesForSound(e.ipfsHash).then(function(t){e.slices=t,n(t)});case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"fetchAudio",value:function(){var e=this;return new Promise(function(t,n){void 0!==e.ipfsHash&&e.fetchAudioFromIPFS().then(function(e){return t(e)}).catch(function(e){n("timed out")})})}},{key:"fetchAudioFromIPFS",value:function(){var e=this;return new Promise(function(t,n){var r=(new Date).getTime();e.encryptedIpfs.getSound(e.ipfsHash).then(function(){var a=Object(s.a)(i.a.mark(function a(s){var o;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(void 0!==s){a.next=3;break}return n(),a.abrupt("return");case 3:return o=(new Date).getTime(),o-r,a.prev=5,a.next=8,d.a.Master.context.decodeAudioData(O(s));case 8:e.audioBuffer=a.sent,t(e),a.next=15;break;case 12:a.prev=12,a.t0=a.catch(5),n(a.t0);case 15:case"end":return a.stop()}},a,null,[[5,12]])}));return function(e){return a.apply(this,arguments)}}()).catch(function(e){n(e)})})}},{key:"fetchGuild",value:function(){var e=Object(s.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.a.guildSamples.getGuildIdForSound(this.getId());case 2:this.guildId=e.sent;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"analyze",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;if(void 0===this.tempo){var n=Object(m.a)(this.audioBuffer,e,t),r=n.tempo,a=n.onsets;this.tempo=r,this.onsets=a}}},{key:"fetchNoteSequence",value:function(){var e=this;return new Promise(function(){var t=Object(s.a)(i.a.mark(function t(n,r){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n(e.noteSequence);case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getThumbnail",value:function(){return void 0!==this.coverArtHash?g.a.getHashUrl(this.coverArtHash):void 0===this.videoId?void 0:"https://img.youtube.com/vi/"+this.videoId+"/1.jpg"}},{key:"load",value:function(){var e=this;return new Promise(function(){var t=Object(s.a)(i.a.mark(function t(n,r){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a=[e.fetchTags(),e.fetchAudio(),e.fetchMetadata(),e.fetchGuild()],t.next=4,Promise.all(a);case 4:n(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),r();case 10:case"end":return t.stop()}},t,null,[[0,7]])}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getCopyWith",value:function(e,t){var a=new n(e);return a.videoId=this.videoId,a.discogsId=this.discogsId,a.coverArtHash=this.coverArtHash,a.name=this.name+"("+t+")",a.year=this.year,a.country=this.country,a.styles=this.styles,a.tags=[].concat(Object(r.a)(this.tags),[t]),a.isStems=!0,a}},{key:"getCopy",value:function(){var e=new n(this.getId());if(e.videoId=this.videoId,e.discogsId=this.discogsId,e.coverArtHash=this.coverArtHash,e.name=this.name,e.year=this.year,e.country=this.country,e.styles=this.styles,e.tags=this.tags?Object(r.a)(this.tags):[],void 0!==this.audioBuffer){var t=new AudioBuffer({length:this.audioBuffer.length,numberOfChannels:this.audioBuffer.numberOfChannels,sampleRate:this.audioBuffer.sampleRate}),a=this.audioBuffer.getChannelData(0);t.copyToChannel(a,0),this.audioBuffer.numberOfChannels>1&&(a=this.audioBuffer.getChannelData(1),t.copyToChannel(a,1)),e.audioBuffer=t}return e}},{key:"color",get:function(){return S.getColorForHash(this.getId())}}]),n}(h.a);t.a=P},61:function(e,t,n){"use strict";function r(e){return!isNaN(parseFloat(e))&&isFinite(e)}n.d(t,"a",function(){return r})},63:function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return s});var r=n(90),a=n.n(r),i=("undefined"!==typeof window.web3?new a.a(window.web3.currentProvider):new a.a(new a.a.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),n(114));function s(e){var t=i.decode(e).toString("hex").replace(/^1220/,"");return 64!=t.length?null:"0x"+t}}).call(this,n(14).Buffer)},70:function(e,t,n){"use strict";var r=n(3),a=n.n(r),i=n(15),s=n(12),o=n(4),c=n(5),u=n(49);function l(e,t){return p.apply(this,arguments)}function p(){return(p=Object(s.a)(a.a.mark(function e(t,n){var r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.eth.getTransaction(t);case 3:return r=e.sent,e.next=6,n.eth.getBlockNumber();case 6:return i=e.sent,e.abrupt("return",null===r.blockNumber?0:i-r.blockNumber);case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:case"end":return e.stop()}},e,null,[[0,10]])}))).apply(this,arguments)}var h=n(8),f=n(40),d={USERS:{setName:f.j.USERS.methods.setName,setProfileHash:f.j.USERS.methods.setProfileHash},TOKENIZED_SEQUENCES:{editSequence:f.j.TOKENIZED_SEQUENCES.methods.editSequence,buyTokens:f.j.TOKENIZED_SEQUENCES.methods.buyTokens},GUILD_SEQUENCES:{editSequence:f.j.GUILD_SEQUENCES.methods.editSequence},GUILD_PRESETS:{newPreset:f.j.GUILD_PRESETS.methods.newPreset,tagPreset:f.j.GUILD_PRESETS.methods.tagPreset},GUILDS:{newGuild:f.j.GUILDS.methods.newGuild,requestToAddMember:f.j.GUILDS.methods.requestToAddMember,leaveGuild:f.j.GUILDS.methods.leaveGuild,acceptRequestToAddToGuild:f.j.GUILDS.methods.acceptRequestToAddToGuild,rejectRequestToAddToGuild:f.j.GUILDS.methods.requestRequestToAddToGuild},GUILD_SAMPLES:{newSamplesWithMetadata:f.j.GUILD_SAMPLES.methods.newSamplesWithMetadata,newSampleWithMetadata:f.j.GUILD_SAMPLES.methods.newSampleWithMetadata,newEncryptedSamples:f.j.GUILD_SAMPLES.methods.newEncryptedSamples},ENCRYPTION:{setPublicKey:f.j.ENCRYPTION.methods.setPublicKey,newEncryptedContent:f.j.ENCRYPTION.methods.newEncryptedContent,shareEncryptedContentWith:f.j.ENCRYPTION.methods.newEncryptedContent},FOLDERS:{foldersUpdated:f.j.FOLDERS.methods.foldersUpdated},MESSAGING:{sendPublicMessage:f.j.MESSAGING.methods.sendPublicMessage},SEQUENCE_METADATA:{tagSequence:f.j.SEQUENCE_METADATA.methods.tagSequence,starSequence:f.j.SEQUENCE_METADATA.methods.starSequence,favoriteSequence:f.j.SEQUENCE_METADATA.methods.favoriteSequence,unfavoriteSequence:f.j.SEQUENCE_METADATA.methods.unfavoriteSequence,unstarSequence:f.j.SEQUENCE_METADATA.methods.unstarSequence},RESAMPLE:{newResample:f.j.RESAMPLE.methods.newResample},XANADU:{newDataType:f.j.XANADU.methods.newDataType,newLinkType:f.j.XANADU.methods.newLinkType,newAnnotationType:f.j.XANADU.methods.newAnnotationType,newLink:f.j.XANADU.methods.newLink,newLinks:f.j.XANADU.methods.newLinks,newAnnotation:f.j.XANADU.methods.newAnnotation},MIX:{newMix:f.j.MIX.methods.newMix}},m=n(26),v=function(){function e(t,n,r,a){Object(o.a)(this,e),this.contract=t,this.method=n,this.arguments=r,this.value=a}return Object(c.a)(e,[{key:"execute",value:function(){var e=this;return new Promise(function(){var t=Object(s.a)(a.a.mark(function t(n,r){var o,c,l;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.a.getAccount();case 2:if(void 0!==(o=t.sent)){t.next=6;break}return r(),t.abrupt("return");case 6:m.a.isMetamaskInstalled()?(l={from:o},e.value&&(l.value=e.value),(c=d[e.contract])[e.method].apply(c,Object(i.a)(e.arguments)).send(l,function(e,t){e?r(e):n()})):(console.log("runnign transaction"),fetch("/transaction/",{method:"POST",body:JSON.stringify(e.getJson()),headers:{Accept:"application/json","Content-Type":"application/json"},withCredentials:!0}).then(function(){var t=Object(s.a)(a.a.mark(function t(r){var i,s;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("returned ="),t.next=3,r.json();case 3:i=t.sent,s=i.transactionHash,console.log("transaction hash = "+s),e.newPendingTransaction(s),e.waitForConfirmation(s),n();case 9:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()));case 7:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"newPendingTransaction",value:function(e){this.transactions=[].concat(Object(i.a)(this.transactions),[e])}},{key:"waitForConfirmation",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;setTimeout(Object(s.a)(a.a.mark(function r(){return a.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,l(e,m.a.web3);case 2:if(!(r.sent>=n)){r.next=6;break}return t.onConfirm(e),r.abrupt("return");case 6:return r.abrupt("return",t.waitForConfirmation(e,n));case 7:case"end":return r.stop()}},r)})),5e3)}},{key:"onConfirm",value:function(e){var t=Object(i.a)(this.transactions),n=t.indexOf(e);n>-1&&(t.splice(n,1),this.transactions=t)}},{key:"getJson",value:function(){return{contract:this.contract,method:this.method,arguments:this.arguments,token:u.a.getToken(),value:this.value}}},{key:"transactions",get:function(){return m.a.store.getState().transactions.pendingTransactions},set:function(e){m.a.store.dispatch(Object(h.fc)(e))}}]),e}();t.a=v},754:function(e,t,n){},755:function(e,t,n){},8:function(e,t,n){"use strict";n.d(t,"sc",function(){return a}),n.d(t,"Sc",function(){return i}),n.d(t,"de",function(){return s}),n.d(t,"db",function(){return o}),n.d(t,"Nc",function(){return c}),n.d(t,"Vb",function(){return u}),n.d(t,"X",function(){return l}),n.d(t,"W",function(){return p}),n.d(t,"V",function(){return h}),n.d(t,"uc",function(){return f}),n.d(t,"he",function(){return d}),n.d(t,"ie",function(){return m}),n.d(t,"g",function(){return v}),n.d(t,"e",function(){return g}),n.d(t,"f",function(){return y}),n.d(t,"k",function(){return b}),n.d(t,"i",function(){return k}),n.d(t,"h",function(){return E}),n.d(t,"P",function(){return O}),n.d(t,"ke",function(){return S}),n.d(t,"je",function(){return P}),n.d(t,"t",function(){return w}),n.d(t,"Mc",function(){return j}),n.d(t,"Kc",function(){return T}),n.d(t,"Cc",function(){return x}),n.d(t,"Vd",function(){return C}),n.d(t,"Md",function(){return N}),n.d(t,"Sd",function(){return R}),n.d(t,"sb",function(){return D}),n.d(t,"qb",function(){return q}),n.d(t,"oc",function(){return M}),n.d(t,"Eb",function(){return A}),n.d(t,"Fb",function(){return I}),n.d(t,"Cb",function(){return L}),n.d(t,"Db",function(){return F}),n.d(t,"rd",function(){return B}),n.d(t,"ud",function(){return H}),n.d(t,"Pc",function(){return V}),n.d(t,"Ac",function(){return U}),n.d(t,"gb",function(){return J}),n.d(t,"mb",function(){return _}),n.d(t,"Rd",function(){return G}),n.d(t,"Id",function(){return z}),n.d(t,"Ab",function(){return W}),n.d(t,"qd",function(){return K}),n.d(t,"kc",function(){return Q}),n.d(t,"Gc",function(){return X}),n.d(t,"xd",function(){return Y}),n.d(t,"Nb",function(){return Z}),n.d(t,"eb",function(){return $}),n.d(t,"vc",function(){return ee}),n.d(t,"Kb",function(){return te}),n.d(t,"Kd",function(){return ne}),n.d(t,"Ic",function(){return re}),n.d(t,"Zd",function(){return ae}),n.d(t,"Ob",function(){return ie}),n.d(t,"ec",function(){return se}),n.d(t,"dc",function(){return oe}),n.d(t,"R",function(){return ce}),n.d(t,"Yc",function(){return ue}),n.d(t,"Vc",function(){return le}),n.d(t,"Yd",function(){return pe}),n.d(t,"nc",function(){return he}),n.d(t,"l",function(){return fe}),n.d(t,"wd",function(){return de}),n.d(t,"Lc",function(){return me}),n.d(t,"td",function(){return ve}),n.d(t,"Rc",function(){return ge}),n.d(t,"Qc",function(){return ye}),n.d(t,"Od",function(){return be}),n.d(t,"Pd",function(){return ke}),n.d(t,"le",function(){return Ee}),n.d(t,"Jb",function(){return Oe}),n.d(t,"lb",function(){return Se}),n.d(t,"jc",function(){return Pe}),n.d(t,"Gb",function(){return we}),n.d(t,"qc",function(){return je}),n.d(t,"Hb",function(){return Te}),n.d(t,"Xb",function(){return xe}),n.d(t,"fd",function(){return Ce}),n.d(t,"gd",function(){return Ne}),n.d(t,"dd",function(){return Re}),n.d(t,"Xc",function(){return De}),n.d(t,"Qd",function(){return qe}),n.d(t,"ge",function(){return Me}),n.d(t,"L",function(){return Ae}),n.d(t,"rc",function(){return Ie}),n.d(t,"D",function(){return Le}),n.d(t,"ee",function(){return Fe}),n.d(t,"fe",function(){return Be}),n.d(t,"Qb",function(){return He}),n.d(t,"Zb",function(){return Ve}),n.d(t,"ac",function(){return Ue}),n.d(t,"d",function(){return Je}),n.d(t,"n",function(){return _e}),n.d(t,"o",function(){return Ge}),n.d(t,"c",function(){return ze}),n.d(t,"O",function(){return We}),n.d(t,"T",function(){return Ke}),n.d(t,"S",function(){return Qe}),n.d(t,"N",function(){return Xe}),n.d(t,"lc",function(){return Ye}),n.d(t,"K",function(){return Ze}),n.d(t,"Pb",function(){return $e}),n.d(t,"jd",function(){return et}),n.d(t,"Uc",function(){return tt}),n.d(t,"bd",function(){return nt}),n.d(t,"cc",function(){return rt}),n.d(t,"j",function(){return at}),n.d(t,"fb",function(){return it}),n.d(t,"U",function(){return st}),n.d(t,"Ec",function(){return ot}),n.d(t,"Bc",function(){return ct}),n.d(t,"kd",function(){return ut}),n.d(t,"Rb",function(){return lt}),n.d(t,"Wc",function(){return pt}),n.d(t,"Z",function(){return ht}),n.d(t,"Bd",function(){return ft}),n.d(t,"s",function(){return dt}),n.d(t,"r",function(){return mt}),n.d(t,"q",function(){return vt}),n.d(t,"yd",function(){return gt}),n.d(t,"xc",function(){return yt}),n.d(t,"zc",function(){return bt}),n.d(t,"hb",function(){return kt}),n.d(t,"Nd",function(){return Et}),n.d(t,"rb",function(){return Ot}),n.d(t,"nd",function(){return St}),n.d(t,"ed",function(){return Pt}),n.d(t,"Lb",function(){return wt}),n.d(t,"ld",function(){return jt}),n.d(t,"cb",function(){return Tt}),n.d(t,"bb",function(){return xt}),n.d(t,"ab",function(){return Ct}),n.d(t,"mc",function(){return Nt}),n.d(t,"wc",function(){return Rt}),n.d(t,"jb",function(){return Dt}),n.d(t,"zd",function(){return qt}),n.d(t,"Jd",function(){return Mt}),n.d(t,"Ud",function(){return At}),n.d(t,"nb",function(){return It}),n.d(t,"pb",function(){return Lt}),n.d(t,"ob",function(){return Ft}),n.d(t,"kb",function(){return Bt}),n.d(t,"Fc",function(){return Ht}),n.d(t,"od",function(){return Vt}),n.d(t,"sd",function(){return Ut}),n.d(t,"hd",function(){return Jt}),n.d(t,"Wb",function(){return _t}),n.d(t,"ad",function(){return Gt}),n.d(t,"Dc",function(){return zt}),n.d(t,"hc",function(){return Wt}),n.d(t,"ic",function(){return Kt}),n.d(t,"pd",function(){return Qt}),n.d(t,"Zc",function(){return Xt}),n.d(t,"md",function(){return Yt}),n.d(t,"be",function(){return Zt}),n.d(t,"fc",function(){return $t}),n.d(t,"Q",function(){return en}),n.d(t,"ce",function(){return tn}),n.d(t,"Wd",function(){return nn}),n.d(t,"Ad",function(){return rn}),n.d(t,"A",function(){return an}),n.d(t,"v",function(){return sn}),n.d(t,"z",function(){return on}),n.d(t,"Jc",function(){return cn}),n.d(t,"zb",function(){return un}),n.d(t,"Ld",function(){return ln}),n.d(t,"gc",function(){return pn}),n.d(t,"w",function(){return hn}),n.d(t,"x",function(){return fn}),n.d(t,"B",function(){return dn}),n.d(t,"C",function(){return mn}),n.d(t,"y",function(){return vn}),n.d(t,"yc",function(){return gn}),n.d(t,"ib",function(){return yn}),n.d(t,"u",function(){return bn}),n.d(t,"Ed",function(){return kn}),n.d(t,"Gd",function(){return En}),n.d(t,"Hd",function(){return On}),n.d(t,"Fd",function(){return Sn}),n.d(t,"Tc",function(){return Pn}),n.d(t,"Yb",function(){return wn}),n.d(t,"p",function(){return jn}),n.d(t,"Cd",function(){return Tn}),n.d(t,"Ub",function(){return xn}),n.d(t,"Y",function(){return Cn}),n.d(t,"tc",function(){return Nn}),n.d(t,"m",function(){return Rn}),n.d(t,"yb",function(){return Dn}),n.d(t,"M",function(){return qn}),n.d(t,"ub",function(){return Mn}),n.d(t,"wb",function(){return An}),n.d(t,"vb",function(){return In}),n.d(t,"id",function(){return Ln}),n.d(t,"Dd",function(){return Fn}),n.d(t,"tb",function(){return Bn}),n.d(t,"cd",function(){return Hn}),n.d(t,"Hc",function(){return Vn}),n.d(t,"b",function(){return Un}),n.d(t,"a",function(){return Jn}),n.d(t,"E",function(){return _n}),n.d(t,"F",function(){return Gn}),n.d(t,"G",function(){return zn}),n.d(t,"H",function(){return Wn}),n.d(t,"Td",function(){return Kn}),n.d(t,"J",function(){return Qn}),n.d(t,"I",function(){return Xn}),n.d(t,"Bb",function(){return Yn}),n.d(t,"bc",function(){return Zn}),n.d(t,"pc",function(){return $n}),n.d(t,"Tb",function(){return er}),n.d(t,"Xd",function(){return tr}),n.d(t,"Ib",function(){return nr}),n.d(t,"Oc",function(){return rr}),n.d(t,"vd",function(){return ar}),n.d(t,"Mb",function(){return ir}),n.d(t,"xb",function(){return sr}),n.d(t,"Sb",function(){return or}),n.d(t,"ae",function(){return cr});var r=n(2),a=function(e){return{type:r.id,payload:e}},i=function(e){return{type:r.Rd,payload:e}},s=function(e){return{type:r.zf,payload:e}},o=function(e){return{type:r.yb,payload:e}},c=function(e){return{type:r.Od,payload:e}},u=function(e,t){return{type:r.Ic,payload:{id:e,numberOfPatterns:t}}},l=function(e,t){return{type:r.ob,payload:{sequenceId:e,currentPattern:t}}},p=function(e,t){return{type:r.mb,payload:{sequenceId:e,currentGlobalStep:t}}},h=function(e,t,n){return{type:r.lb,payload:{sequenceId:e,currentStep:t,currentGlobalStep:n}}},f=function(e,t){return{type:r.kd,payload:{sampleId:e,sample:t}}},d=function(e,t){return{type:r.Jf,payload:{trackNumber:e,sliceNumber:t}}},m=function(e,t){return{type:r.Kf,payload:{trackNumber:e,sliceNumber:t}}},v=function(e){return{type:r.i,payload:e}},g=function(e){return{type:r.g,payload:e}},y=function(e){return{type:r.h,payload:e}},b=function(e){return{type:r.m,payload:e}},k=function(e){return{type:r.k,payload:e}},E=function(e){return{type:r.j,payload:e}},O=function(e){return{type:r.b,payload:e}},S=function(e,t){return{type:r.Mf,payload:{trackNumber:e,recording:t}}},P=function(e,t){return{type:r.Lf,payload:{trackNumber:e,preparing:t}}},w=function(e,t,n,a,i,s,o,c){var u=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return{type:r.x,payload:{trackNumber:e,steps:t,pianoRollSteps:n,fills:a,stepToId:i,stepToPosition:s,pianoRollDurations:o,patternSteps:c,combineAllSteps:u}}},j=function(e){return{type:r.Nd,payload:e}},T=function(e){return{type:r.Ld,payload:e}},x=function(e){return{type:r.yd,payload:e}},C=function(e,t){return{type:r.rf,payload:{trackNumber:e,volume:t}}},N=function(e,t){return{type:r.gf,payload:{trackNumber:e,muted:t}}},R=function(e,t){return{type:r.nf,payload:{trackNumber:e,solo:t}}},D=function(e,t){return{type:r.Vb,payload:{groupNumber:e,volume:t}}},q=function(e,t){return{type:r.Tb,payload:{groupNumber:e,muted:t}}},M=function(e){return{type:r.dd,payload:e}},A=function(e){return{type:r.lc,payload:e}},I=function(e){return{type:r.nc,payload:e}},L=function(e,t){return{type:r.jc,payload:{sequenceId:e,isPlaying:t}}},F=function(e){return{type:r.kc,payload:e}},B=function(e){return{type:r.He,payload:e}},H=function(e){return{type:r.Ke,payload:e}},V=function(e){return{type:r.Sd,payload:e}},U=function(e){return{type:r.vd,payload:e}},J=function(e,t){return{type:r.Fb,payload:{id:e,value:t}}},_=function(e){return{type:r.Jb,payload:e}},G=function(e,t,n,a){return{type:r.mf,payload:{subSequenceId:e,trackNumber:t,sendNumber:n,volume:a}}},z=function(e){return{type:r.cf,payload:e}},W=function(e){return{type:r.hc,payload:e}},K=function(e){return{type:r.Ge,payload:e}},Q=function(e,t,n,a){return{type:r.Zc,payload:{stepNumber:e,transpose:t,numSteps:n,numNotes:a}}},X=function(e){return{type:r.Ed,payload:e}},Y=function(e){return{type:r.Ee,payload:e}},Z=function(e){return{type:r.xc,payload:e}},$=function(e){return{type:r.Ab,payload:e}},ee=function(e){return{type:r.ld,payload:e}},te=function(e){return{type:r.rc,payload:e}},ne=function(e,t,n){return{type:r.ef,payload:{subSequenceId:e,trackNumber:t,isEnabled:n}}},re=function(e,t){return{type:r.Id,payload:{sampleId:e,tag:t}}},ae=function(e){return{type:r.tf,payload:{transpose:e}}},ie=function(e,t){return{type:r.zc,payload:{sequenceId:e,volume:t}}},se=function(e){return{type:r.Tc,payload:e}},oe=function(e,t){return{type:r.Sc,payload:{pattern:e,color:t}}},ce=function(e){return{type:r.gb,payload:e}},ue=function(e){return{type:r.ee,payload:e}},le=function(e){return{type:r.be,payload:e}},pe=function(e){return{type:r.Ve,payload:e}},he=function(e){return{type:r.cd,payload:e}},fe=function(){return{type:r.n,payload:{}}},de=function(e,t,n){return{type:r.De,payload:{trackNumber:e,fromStep:t,toStep:n}}},me=function(e,t,n){return{type:r.Md,payload:{trackNumber:e,patternNumber:t,steps:n}}},ve=function(e){return{type:r.Je,payload:e}},ge=function(e){return{type:r.Ud,payload:{patternLocks:e}}},ye=function(e,t){return{type:r.Td,payload:{patternNumber:e,locked:t}}},be=function(e,t,n,a){return{type:r.if,payload:{subSequence:e,trackNumber:t,patternNumber:n,locked:a}}},ke=function(e,t,n){return{type:r.jf,payload:{subSequence:e,trackNumber:t,patternLocks:n}}},Ee=function(e){return{type:r.Nf,payload:e}},Oe=function(e,t){return{type:r.uc,payload:{patternLocks:t,subSequence:e}}},Se=function(e,t){return{type:r.Ib,payload:{patternLocks:t,subSequence:e}}},Pe=function(e,t){return{type:r.Yc,payload:{start:e,end:t}}},we=function(e){return{type:r.oc,payload:e}},je=function(e){return{type:r.gd,payload:e}},Te=function(e){return{type:r.pc,payload:e}},xe=function(e){return{type:r.Lc,payload:e}},Ce=function(e){return{type:r.ne,payload:e}},Ne=function(e){return{type:r.me,payload:e}},Re=function(e){return{type:r.ke,payload:e}},De=function(e){return{type:r.de,payload:e}},qe=function(e){return{type:r.lf,payload:e}},Me=function(e){return{type:r.If,payload:e}},Ae=function(e){return{type:r.Z,payload:e}},Ie=function(e){return{type:r.hd,payload:e}},Le=function(e){return{type:r.R,payload:e}},Fe=function(e){return{type:r.Bf,payload:e}},Be=function(e){return{type:r.Cf,payload:e}},He=function(e){return{type:r.Bc,payload:e}},Ve=function(e){return{type:r.Pc,payload:e}},Ue=function(e,t){return{type:r.Oc,payload:{parameter:e,midiControl:t}}},Je=function(e){return{type:r.f,payload:e}},_e=function(e){return{type:r.t,payload:e}},Ge=function(e,t){return{type:r.s,payload:{action:e,midiControl:t}}},ze=function(e){return{type:r.e,payload:e}},We=function(e){return{type:r.db,payload:e}},Ke=function(e){return{type:r.ib,payload:e}},Qe=function(e){return{type:r.hb,payload:e}},Xe=function(e){return{type:r.cb,payload:e}},Ye=function(e){return{type:r.ad,payload:e}},Ze=function(e){return{type:r.Y,payload:e}},$e=function(e){return{type:r.Ac,payload:e}},et=function(e,t){return{type:r.te,payload:{trackNumber:e,show:t}}},tt=function(e,t){return{type:r.Yd,payload:{show:e,convolverSample:t}}},nt=function(e){return{type:r.ie,payload:e}},rt=function(e){return{type:r.Rc,payload:e}},at=function(){return{type:r.l,payload:{}}},it=function(e,t){return{type:r.Eb,payload:{id:e,isCollapsed:t}}},st=function(e){return{type:r.jb,payload:e}},ot=function(e){return{type:r.Ad,payload:e}},ct=function(e){return{type:r.wd,payload:e}},ut=function(e){return{type:r.we,payload:e}},lt=function(e,t,n){return{type:r.Dc,payload:{subSequenceId:e,type:t,events:n}}},pt=function(e){return{type:r.ce,payload:e}},ht=function(e,t){return{type:r.rb,payload:{sequenceId:e,subSequenceId:t}}},ft=function(e,t){return{type:r.Me,payload:{sequenceId:e,ids:t}}},dt=function(e){return{type:r.w,payload:e}},mt=function(e){return{type:r.v,payload:e}},vt=function(e){return{type:r.u,payload:e}},gt=function(e,t){return{type:r.Ne,payload:{subSequenceId:e,value:t}}},yt=function(e,t){return{type:r.od,payload:{id:e,slices:t}}},bt=function(e){return{type:r.td,payload:e}},kt=function(e){return{type:r.Gb,payload:e}},Et=function(e,t){return{type:r.hf,payload:{trackNumber:e,pan:t}}},Ot=function(e,t){return{type:r.Ub,payload:{groupNumber:e,pan:t}}},St=function(e){return{type:r.ze,payload:e}},Pt=function(e){return{type:r.le,payload:e}},wt=function(e){return{type:r.sc,payload:e}},jt=function(e){return{type:r.xe,payload:e}},Tt=function(e){return{type:r.vb,payload:e}},xt=function(e){return{type:r.ub,payload:e}},Ct=function(e){return{type:r.tb,payload:e}},Nt=function(e){return{type:r.bd,payload:e}},Rt=function(e){return{type:r.md,payload:e}},Dt=function(e,t,n){return{type:r.Cb,payload:{subSequenceId:e,trackNumber:t,chainNumber:n}}},qt=function(e,t){return{type:r.Oe,payload:{id:e,muted:t}}},Mt=function(e,t,n){return{type:r.df,payload:{subSequenceId:e,trackNumber:t,frozen:n}}},At=function(e,t){return{type:r.qf,payload:{subSequenceId:e,trackNumber:t}}},It=function(e,t,n){return{type:r.Sb,payload:{subSequenceId:e,trackNumber:t,playing:n}}},Lt=function(e,t){return{type:r.Rb,payload:{subSequenceId:e,frozenTracksPlaying:t}}},Ft=function(e,t){return{type:r.Qb,payload:{subSequenceId:e,frozenTracks:t}}},Bt=function(e,t){return{type:r.Bb,payload:{subSequenceId:e,effectsChains:t}}},Ht=function(e,t){return{type:r.Bd,payload:{id:e,selectedOnsets:t}}},Vt=function(e){return{type:r.Ae,payload:e}},Ut=function(e){return{type:r.Ie,payload:e}},Jt=function(e,t){return{type:r.pe,payload:{option:e,effect:t}}},_t=function(e){return{type:r.Kc,payload:e}},Gt=function(e){return{type:r.he,payload:e}},zt=function(e){return{type:r.zd,payload:e}},Wt=function(e){return{type:r.Wc,payload:e}},Kt=function(e){return{type:r.Xc,payload:e}},Qt=function(e,t){return{type:r.Fe,payload:{stepNumber:e,stepData:t}}},Xt=function(e){return{type:r.fe,payload:e}},Yt=function(e){return{type:r.ye,payload:e}},Zt=function(e,t){return{type:r.wf,payload:{userName:e,token:t}}},$t=function(e){return{type:r.Uc,payload:e}},en=function(e){return{type:r.fb,payload:e}},tn=function(e){return{type:r.Af,payload:e}},nn=function(e,t,n){return{type:r.sf,payload:{subSequenceId:e,trackNumber:t,warp:n}}},rn=function(e,t){return{type:r.Pe,payload:{subSequenceId:e,warps:t}}},an=function(e){return{type:r.I,payload:e}},sn=function(e,t){return{type:r.A,payload:{subSequenceId:e,type:t}}},on=function(e){return{type:r.G,payload:e}},cn=function(e){return{type:r.Jd,payload:e}},un=function(e){return{type:r.gc,payload:e}},ln=function(e,t,n){return{type:r.ff,payload:{subSequenceId:e,trackNumber:t,isLoading:n}}},pn=function(e){return{type:r.Vc,payload:e}},hn=function(e){return{type:r.B,payload:e}},fn=function(e){return{type:r.D,payload:e}},dn=function(e,t){return{type:r.J,payload:void 0===e?void 0:{patternDragging:e,offsetX:t}}},mn=function(e,t,n){return{type:r.L,payload:{subSequenceId:e,patternId:t,startStep:n}}},vn=function(e){return{type:r.F,payload:e}},gn=function(e){return{type:r.pd,payload:e}},yn=function(e,t,n,a){return{type:r.Hb,payload:{rackId:e,effectId:t,x:n,y:a}}},bn=function(e){return{type:r.z,payload:e}},kn=function(e,t){return{type:r.We,payload:{trackId:e,device:t}}},En=function(e,t){return{type:r.Ye,payload:{trackId:e,device:t}}},On=function(e,t){return{type:r.Ze,payload:{trackId:e,subDevice:t}}},Sn=function(e,t){return{type:r.Xe,payload:{trackId:e,parameter:t}}},Pn=function(e){return{type:r.Wd,payload:{show:e}}},wn=function(e,t,n){return{type:r.Nc,payload:{parameter:e,automations:t,scheduler:n}}},jn=function(e){return{type:r.r,payload:e}},Tn=function(e){return{type:r.Re,payload:e}},xn=function(e){return{type:r.Jc,payload:e}},Cn=function(e){return{type:r.pb,payload:e}},Nn=function(e,t,n,a,i,s,o,c,u,l){return{type:r.jd,payload:{roomName:e,active:t,type:n,hash:a,thumbnail:i,description:s,actionsAllowed:o,actionWaitTime:c,rules:u,lastOperation:l}}},Rn=function(e){return{type:r.o,payload:e}},Dn=function(e){return{type:r.fc,payload:e}},qn=function(e){return{type:r.ab,payload:e}},Mn=function(e){return{type:r.ac,payload:e}},An=function(e){return{type:r.cc,payload:e}},In=function(e){return{type:r.bc,payload:e}},Ln=function(e){return{type:r.se,payload:e}},Fn=function(e){return{type:r.Se,payload:e}},Bn=function(e){return{type:r.Xb,payload:e}},Hn=function(e){return{type:r.je,payload:e}},Vn=function(e,t){return{type:r.Gd,payload:{trackId:e,track:t}}},Un=function(e){return{type:r.d,payload:e}},Jn=function(e){return{type:r.c,payload:e}},_n=function(e){return{type:r.S,payload:e}},Gn=function(e){return{type:r.U,payload:e}},zn=function(e){return{type:r.V,payload:e}},Wn=function(e){return{type:r.W,payload:e}},Kn=function(e){return{type:r.pf,payload:e}},Qn=function(e){return{type:r.X,payload:e}},Xn=function(e){return{type:r.T,payload:e}},Yn=function(e){return{type:r.ic,payload:e}},Zn=function(e){return{type:r.Qc,payload:e}},$n=function(e){return{type:r.ed,payload:e}},er=function(e){return{type:r.Hc,payload:e}},tr=function(e){return{type:r.Ue,payload:e}},nr=function(e){return{type:r.qc,payload:e}},rr=function(e){return{type:r.Pd,payload:e}},ar=function(e){return{type:r.Ce,payload:e}},ir=function(e){return{type:r.wc,payload:e}},sr=function(e){return{type:r.ec,payload:e}},or=function(e){return{type:r.Fc,payload:e}},cr=function(e,t){return{type:r.uf,payload:{undo:e,redo:t}}}},808:function(e,t){},924:function(e,t,n){},925:function(e,t,n){},927:function(e,t,n){e.exports=n.p+"static/media/logo.5d5d9eef.svg"},928:function(e,t,n){},932:function(e,t,n){"use strict";var r=n(4),a=n(5),i=function(){function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"sampleHashes",type:"bytes32[16]"},{name:"titles",type:"bytes32[16]"},{name:"youtubeVideoIds",type:"bytes32[16]"},{name:"coverArtHashes",type:"bytes32[16]"},{name:"discogIds",type:"uint256[16]"},{name:"tagsToAdd",type:"bytes32[4][16]"},{name:"stylesToAdd",type:"bytes32[4][16]"},{name:"countries",type:"bytes32[16]"},{name:"sampleYears",type:"int16[16]"}],name:"newSampleWithMetadata",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"sampleHashes",type:"bytes32[16]"}],name:"test2",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{name:"c",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"discogsId",type:"uint256"},{indexed:!0,name:"coverArtHash",type:"bytes32"}],name:"NewDiscogsSample",type:"event"}],this.contractAddress="0x18d2c1f1f70ecbeb6366c65cef684e229ff6d6b9"}return Object(a.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=i},933:function(e,t,n){"use strict";var r=n(15),a=n(11),i=n(3),s=n.n(i),o=n(12),c=n(4),u=n(5),l=n(378),p=n(31),h=n(41),f=n(49),d=n(70),m=n(26),v=n(40),g=n(157),y=n(63),b=new l.a,k=function(){function e(t){Object(c.a)(this,e),this.web3=t,this.contract=new t.eth.Contract(b.abi,b.contractAddress),this.contractAddress=this.contract.options.address,this.zero=this.web3.utils.padRight("0x00",64)}return Object(u.a)(e,[{key:"getPrice",value:function(){var e=Object(o.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.methods.getPrice().call();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"buyTokens",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Math.pow(10,3)*t,e.next=3,this.getPrice();case 3:n=e.sent,r=n*t,new d.a(v.i,"buyTokens",[t],r).execute();case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getBalance",value:function(){var e=Object(o.a)(s.a.mark(function e(){var t,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("get balance called"),e.next=3,f.a.getAccount();case 3:if(void 0!==(t=e.sent)){e.next=6;break}return e.abrupt("return",0);case 6:return e.next=8,this.contract.methods.balanceOf(t).call();case 8:return n=e.sent,e.abrupt("return",parseFloat(n)/1e3);case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"saveNewSequence",value:function(e,t,n,r){var a=this;return new Promise(function(){var i=Object(o.a)(s.a.mark(function i(o,c){var u,l;return s.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,f.a.getAccount();case 2:for(l in void 0===i.sent&&o(),u=[],r)u.push(Object(y.a)(r[l]));return e=void 0===e?a.zero:Object(y.a)(e),t=Object(y.a)(t),i.next=10,m.a.xanadu.newLinks(g.a,t,u);case 10:u.push(e),new d.a(v.i,"editSequence",[e,t,n,u]).execute().then(function(e){return o}).catch(function(e){return c});case 12:case"end":return i.stop()}},i)}));return function(e,t){return i.apply(this,arguments)}}())}},{key:"getSequences",value:function(e,t,n){var r=this;return new Promise(function(){var i=Object(o.a)(s.a.mark(function i(o,c){var u,l;return s.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return u=new h.a(r.contractAddress).select("user").select("previousSequence").select("newSequence").select("title").fromBlock(t).toBlock(n).from(p.L),void 0!==e&&u.where("user",e.toLowerCase()),i.next=4,u.executeQuery(!1);case 4:(l=i.sent).sort(function(e,t){return t.blockNumber-e.blockNumber}),o(l.map(function(e){return Object(a.a)({},e,{edits:0})}));case 7:case"end":return i.stop()}},i)}));return function(e,t){return i.apply(this,arguments)}}())}},{key:"getNextSequences",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark(function e(r,i){var o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=new h.a(n.contractAddress).select("user").select("previousSequence").select("newSequence").select("title").where("previousSequence",t).from(p.L),e.next=3,o.executeQuery();case 3:c=e.sent,r(c.map(function(e){return Object(a.a)({},e,{edits:0})}));case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPreviousSequences",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark(function e(i,o){var c,u,l;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getPreviousSequence("+t+")"),c=new h.a(n.contractAddress).select("user").select("previousSequence").select("newSequence").select("title").where("newSequence",t).from(p.L),e.next=4,c.executeQuery();case 4:if(0!==(u=(u=e.sent).map(function(e){return Object(a.a)({},e,{edits:0,isPrevious:!0})})).length&&u[0].previousSequence!==t){e.next=10;break}i(u),e.next=21;break;case 10:return l=u[0].previousSequence,e.t0=i,e.t1=[],e.t2=Object(r.a)(u),e.t3=r.a,e.next=17,n.getPreviousSequences(l);case 17:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t6=e.t1.concat.call(e.t1,e.t2,e.t5),(0,e.t0)(e.t6);case 21:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSequence",value:function(){var e=Object(o.a)(s.a.mark(function e(t){var n=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark(function e(r,i){var o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getSequence("+t+")"),o=new h.a(n.contractAddress).select("user").select("previousSequence").select("newSequence").select("title").where("newSequence",t).from(p.L),e.next=4,o.executeQuery();case 4:c=e.sent,r(c.map(function(e){return Object(a.a)({},e,{edits:0})}));case 6:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"watchBalance",value:function(){var e=Object(o.a)(s.a.mark(function e(){var t,n=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.getAccount();case 2:if(void 0!==(t=e.sent)){e.next=5;break}return e.abrupt("return");case 5:console.log("watch balance toUser = "+t),new h.a(this.contract.options.address).from(p.M).select("amount").where("toUser",t.toLowerCase()).watchQuery(function(e){n.callback&&n.callback()});case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=k},934:function(e,t,n){"use strict";var r=n(4);t.a=function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"startMilliseconds",type:"int32"},{name:"endMilliseconds",type:"int32"}],name:"newSlice",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"startMilliseconds",type:"int32[16]"},{name:"endMilliseconds",type:"int32[16]"}],name:"newSlices16",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"startMilliseconds",type:"int32[4]"},{name:"endMilliseconds",type:"int32[4]"}],name:"newSlices4",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"startMilliseconds",type:"int32[8]"},{name:"endMilliseconds",type:"int32[8]"}],name:"newSlices8",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"tag",type:"bytes32"},{name:"startMilliseconds",type:"int32"},{name:"endMilliseconds",type:"int32"}],name:"newTaggedSlice",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!0,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"tag",type:"bytes32"},{indexed:!1,name:"startMilliseconds",type:"int32"},{indexed:!1,name:"endMillisconds",type:"int32"}],name:"SliceCreated",type:"event"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"}],this.contractAddress="0xf68a5fccacd945904dbcc675752987c72f7d5bed"}},935:function(e,t,n){"use strict";var r=n(11),a=n(3),i=n.n(a),s=n(12),o=n(4),c=n(5),u=n(382),l=n(70),p=n(40),h=n(63),f=n(49),d=n(188),m=n(41),v=n(31),g=function(){function e(t,n){Object(o.a)(this,e),this.contract=(new u.a).getContract(t),this.web3=t,this.crypto=n,this.NULL_BYTES32=this.web3.utils.padLeft("0x0",64),this.cachedResults={}}return Object(c.a)(e,[{key:"getPublicKey",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(i.a.mark(function e(r,a){var s,o,c;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=7;break}return e.next=3,f.a.getAccount();case 3:if(void 0!==(t=e.sent)){e.next=7;break}return r(void 0),e.abrupt("return");case 7:return s=new m.a(n.contract.options.address).from(v.u).select("publicKey").where("user",t.toLowerCase()),e.next=10,s.executeQuery(!1);case 10:if(0!==(o=e.sent).length){e.next=14;break}return r(void 0),e.abrupt("return");case 14:c="0x"+n.stripTrailingZeroes(o[0].publicKey),r(n.web3.utils.toAscii(c));case 16:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getEncryptedContent",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n,r){var a,o,c=this,u=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=u.length>3&&void 0!==u[3]?u[3]:2,o=u.length>4?u[4]:void 0,e.abrupt("return",new Promise(function(){var e=Object(s.a)(i.a.mark(function e(s,u){var l,p,h,f;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in c.cachedResults)){e.next=3;break}return s(c.cachedResults[t]),e.abrupt("return");case 3:return e.next=5,new m.a(c.contract.options.address).from(v.g).select("newContent").select("user").select("previousContent").select("contentType").select("encryptedName").select("publicKey").select("encryptedContentKey").select("publicKey").fromBlock(a).toBlock(o);case 5:return l=e.sent,void 0!==r&&l.where("user",r.toLowerCase()),void 0!==t&&l.where("newContent",t),e.next=10,l.executeQuery(!1);case 10:if(0!==(p=e.sent).length){e.next=14;break}return s(void 0),e.abrupt("return");case 14:h=[],e.t0=i.a.keys(p);case 16:if((e.t1=e.t0()).done){e.next=25;break}return f=e.t1.value,e.t2=h,e.next=21,c.convertLogResult(p[f],n);case 21:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=16;break;case 25:c.cachedResults[t]=h,s(h);case 27:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getEncryptedContentSharedWithMe",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r,a,s,o,c;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.cachedResults)){e.next=2;break}return e.abrupt("return",this.cachedResults[t]);case 2:return e.next=4,f.a.getAccount();case 4:return r=e.sent,a=new m.a(this.contract.options.address).from(v.a).select("encryptedContentKey").select("publicKey").select("contentHash").select("creator").where("sharedWith",r.toLowerCase()),void 0!==t&&a.where("contentHash",t),e.next=9,a.executeQuery(!1);case 9:if(0!==(s=e.sent).length){e.next=12;break}return e.abrupt("return",void 0);case 12:o=[],e.t0=i.a.keys(s);case 14:if((e.t1=e.t0()).done){e.next=23;break}return c=e.t1.value,e.t2=o,e.next=19,this.convertSharedLogResult(s[c],!1,n);case 19:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=14;break;case 23:return this.cachedResults[t]=o,e.abrupt("return",o);case 25:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getEncryptedSequenceIfAny",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r,a,s=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:2,a=s.length>3?s[3]:void 0,e.next=4,this.getEncryptedContent(t,void 0,n,r,a);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSequencesSharedWithUser",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n,r){var a,s,o,c,u;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.getAccount();case 2:return a=e.sent,s=new m.a(this.contract.options.address).from(v.a).select("encryptedContentKey").select("publicKey").select("contentHash").select("creator").where("sharedWith",a.toLowerCase()),void 0!==t&&s.where("contentHash",t),n&&s.fromBlock(n),r&&s.toBlock(r),e.next=9,s.executeQuery(!1);case 9:o=e.sent,c=[],e.t0=i.a.keys(o);case 12:if((e.t1=e.t0()).done){e.next=21;break}return u=e.t1.value,e.t2=c,e.next=17,this.convertSharedLogResult(o[u]);case 17:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=12;break;case 21:return e.abrupt("return",c);case 22:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"convertSharedLogResult",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,a,s,o,c,u=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(u.length>1&&void 0!==u[1])||u[1],e.next=3,this.crypto.decryptContentKey(t.encryptedContentKey);case 3:if(a=e.sent,s=this.stripTrailingZeroes(t.publicKey),{user:t.creator,contentHash:t.contentHash,publicKey:s,contentKey:a?a.contentKey:void 0},o={},c="",!n){e.next=15;break}return e.next=11,this.getEncryptedSequenceIfAny(t.contentHash);case 11:return o=e.sent,e.next=14,this.crypto.decryptName(o[0].encryptedTitle,this.stripTrailingZeroes(t.encryptedContentKey));case 14:c=e.sent;case 15:return e.abrupt("return",Object(r.a)({},o[0],{title:c,publicKey:s,contentKey:a?a.contentKey:void 0}));case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"convertLogResult",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r,a,s,o,c;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.stripTrailingZeroes(t.encryptedContentKey),e.next=3,this.crypto.decryptName(t.encryptedName,r,n);case 3:return a=e.sent,s=t.user,e.next=7,this.crypto.decryptContentKey(r,n);case 7:return o=e.sent,c={title:this.stripTrailingZeroes(a),encryptedTitle:t.encryptedName,user:"0x"+this.stripLeadingZeroes(s.slice(2)),previousSequence:t.previousContent,newSequence:t.newContent,contentType:t.contentType,contentKey:o?o.contentKey:void 0,blockNumber:t.blockNumber,publicKey:this.stripTrailingZeroes(t.publicKey)},e.abrupt("return",c);case 10:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"newPublicKey",value:function(e){return new Promise(function(){var t=Object(s.a)(i.a.mark(function t(n,r){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:new l.a(p.a,"setPublicKey",[e]).execute().then(function(){return n()});case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"newEncryptedSequence",value:function(e,t,n,r,a){var o=this;return new Promise(function(){var c=Object(s.a)(i.a.mark(function s(c,u){return i.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:e=void 0===e?o.web3.utils.padLeft("0x0",64):Object(h.a)(e),t=Object(h.a)(t),n=o.web3.utils.padLeft("0x"+n,64),new l.a(p.a,"newEncryptedContent",[e,t,n,d.a,r,a]).execute().then(function(){return c()});case 4:case"end":return i.stop()}},s)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"newEncryptedContent",value:function(e,t,n,r,a){var o=this;return new Promise(function(){var c=Object(s.a)(i.a.mark(function s(c,u){return i.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:e=Object(h.a)(e),t=o.web3.utils.padLeft("0x"+t,64),new l.a(p.a,"newEncryptedContent",[o.NULL_BYTES32,e,t,r,n,a]).execute().then(function(){return c()});case 3:case"end":return i.stop()}},s)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"shareEncryptedContent",value:function(e,t,n,r){var a=this;return new Promise(function(){var o=Object(s.a)(i.a.mark(function s(o,c){return i.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return t=Object(h.a)(t),i.next=3,a.web3.eth.getAccounts();case 3:i.sent,new l.a(p.a,"shareEncryptedContentWith",[e,t,n,r]).execute().then(function(){return o()});case 5:case"end":return i.stop()}},s)}));return function(e,t){return o.apply(this,arguments)}}())}},{key:"stripTrailingZeroes",value:function(e){for(var t=e.length-1;t>=0;t--)if("0"!==e.slice(t,t+1))return e.slice(0,t+1)}},{key:"stripLeadingZeroes",value:function(e){for(var t=0;t<e.length;t++)if("0"!==e.slice(t,t+1))return e.slice(t)}}]),e}();t.a=g},936:function(e,t,n){"use strict";var r=n(4);t.a=function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"sampleHash",type:"bytes32"}],name:"favoriteSample",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"sampleHash",type:"bytes32"}],name:"unfavoriteSample",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!0,name:"sampleHash",type:"bytes32"}],name:"SampleFavorited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!0,name:"sampleHash",type:"bytes32"}],name:"SampleUnfavorited",type:"event"}],this.contractAddress="0xcddbc9238e5ba4f6f4c0c8e0ef4231e1be4943fc"}},937:function(e,t,n){"use strict";var r=n(4);t.a=function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"}],name:"newIndex",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!1,name:"sampleHash",type:"bytes32"}],name:"NewIndex",type:"event"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{constant:!0,inputs:[],name:"getIndex",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"}],this.contractAddress="0xb05e78e48dc17fff1b52307e240cab6b241fe288"}},938:function(e,t,n){"use strict";var r=n(4);t.a=function e(){Object(r.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"previousSequences",type:"bytes32[4]"},{name:"newSequence",type:"bytes32"},{name:"diff",type:"bytes32"},{name:"title",type:"string"}],name:"editCompoundSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"previousSequence",type:"bytes32"},{name:"newSequence",type:"bytes32"},{name:"diff",type:"bytes32"},{name:"title",type:"string"}],name:"editSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"userEditing",type:"address"},{indexed:!0,name:"previousSequence",type:"bytes32"},{indexed:!0,name:"newSequence",type:"bytes32"},{indexed:!1,name:"diffHash",type:"bytes32"},{indexed:!1,name:"title",type:"string"}],name:"SequenceEdited",type:"event"}],this.contractAddress="0x16687b7db5994ac1aa22594be04af8396f5085dd"}},939:function(e,t,n){"use strict";var r=n(11),a=n(3),i=n.n(a),s=n(12),o=n(4),c=n(5),u=n(381),l=n(388),p=n(49),h=n(41),f=n(70),d=n(40),m=n(31),v=n(63),g=n(188),y=new(n(168).a),b={},k=function(){function e(t,n,r){Object(o.a)(this,e),this.web3=t,this.contract=(new u.a).getContract(t),this.users=new l.a(t),this.crypto=n,this.encryption=r,this.guildKeyCache={},this.guildIdCache={},this.guildsWithAccess=void 0}return Object(c.a)(e,[{key:"initGuilds",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getGuildsForUser();case 2:return this.guilds=e.sent,e.next=5,p.a.getAccount();case 5:if(void 0!==(t=e.sent)){e.next=8;break}return e.abrupt("return");case 8:if(navigator.onLine){e.next=10;break}return e.abrupt("return");case 10:new h.a(this.contract.options.address).from(m.h).select("guildId").where("user",t.toLowerCase()).watchQuery(function(){n.newGuildCallback&&n.newGuildCallback()});case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getGuildKey",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r,a=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.guildKeyCache)){e.next=5;break}return n=this.guildKeyCache[t],e.next=4,n;case 4:return e.abrupt("return",e.sent);case 5:return r=new Promise(function(){var e=Object(s.a)(i.a.mark(function e(n,r){var s,o,c,u,l,f,d;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=8;break}return e.next=3,a.getGuildsForUser();case 3:if(0!==(s=e.sent).length){e.next=7;break}return n(void 0),e.abrupt("return");case 7:t=s[0].guildId;case 8:return e.next=10,p.a.getAccount();case 10:if(void 0!==(o=e.sent)){e.next=14;break}return n(void 0),e.abrupt("return");case 14:return e.next=16,new h.a(a.contractAddress).from(m.c).select("ipfsHash").where("user",o.toLowerCase()).where("guildId",t).executeQuery(!1);case 16:if(0!==(c=e.sent).length){e.next=20;break}return n(void 0),e.abrupt("return");case 20:return u=c[0].ipfsHash,e.next=23,a.encryption.getEncryptedContent(u);case 23:if(void 0!==(l=e.sent)){e.next=28;break}return e.next=27,a.encryption.getEncryptedContentSharedWithMe(u);case 27:l=e.sent;case 28:return e.t0=JSON,e.next=31,a.crypto.fetchAndDecrypt(u,l);case 31:e.t1=e.sent,f=e.t0.parse.call(e.t0,e.t1),d=a.crypto.generateGuildKey(f.passphrase),n(d);case 35:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),this.guildKeyCache[t]=r,e.next=9,r;case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"newGuild",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r=this,a=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:"fuck me fuck you",e.abrupt("return",new Promise(function(){var e=Object(s.a)(i.a.mark(function e(a,s){var o,c,u,l,p,h;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.crypto.generateGuildKey(n);case 2:return o=e.sent,o.privateKey,c=o.publicKey,e.next=7,r.crypto.encryptAndUploadJSON(o);case 7:u=e.sent,l=u.encryptedContentKey,p=u.encryptedContentIpfsHash,h=u.publicKey,new f.a(d.c,"newGuild",[c,t,Object(v.a)(p),l,h]).execute().then(function(e){a()});case 12:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"requestToAddMember",value:function(e,t){var n=this;return new Promise(function(){var r=Object(s.a)(i.a.mark(function r(a,s){var o,c,u,l;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.getGuildKey(e);case 2:return o=r.sent,r.next=5,n.encryption.getPublicKey(t);case 5:return c=r.sent,r.next=8,n.crypto.encryptAndUploadJSON(o,c);case 8:u=r.sent,l=u.contentKey,new f.a(d.c,"requestToAddMember",[e,t,Object(v.a)(u.encryptedContentIpfsHash),l.convertForEthereum(),l.getPublicKeyAsBytes32()]).execute().then(function(e){a()});case 11:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"leaveGuild",value:function(e){return new Promise(function(){var t=Object(s.a)(i.a.mark(function t(n,r){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:new f.a(d.c,"leaveGuild",[e]).execute().then(function(e){n()});case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"voteForProposal",value:function(e,t,n){var r=this;return new Promise(function(){var a=Object(s.a)(i.a.mark(function a(s,o){var c;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,r.web3.eth.getAccounts();case 2:c=a.sent,r.contract.methods.voteOnNewGuildMemberProposal(e,t,n).send({from:c[0]},function(e,t){e?o(e):s()});case 4:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"getAllGuildMemberProposals",value:function(){var e=this;return new Promise(function(){var t=Object(s.a)(i.a.mark(function t(n,r){var a,s,o,c,u,l;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getGuildsForUser();case 2:a=t.sent,s=[],t.t0=i.a.keys(a);case 5:if((t.t1=t.t0()).done){t.next=14;break}return o=t.t1.value,c=a[o].guildId,t.next=10,e.getGuildMemberProposals(c);case 10:for(l in u=t.sent)s.push({guildId:c,proposalIndex:l,potentialMember:u[l]});t.next=5;break;case 14:n(s);case 15:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getGuildMemberProposals",value:function(e){var t=this;return new Promise(function(){var n=Object(s.a)(i.a.mark(function n(r,a){var s,o,c,u,l;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.web3.eth.getAccounts();case 2:return s=n.sent,n.next=5,t.contract.methods.getTotalGuildMemberProposals(e).call({from:s[0]});case 5:o=n.sent,c=[],u=0;case 8:if(!(u<o)){n.next=16;break}return n.next=11,t.contract.methods.getNewGuildMemberProposal(e,u).call({from:s[0]});case 11:l=n.sent,c.push(l);case 13:u++,n.next=8;break;case 16:r(c);case 17:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getNewMemberRequests",value:function(){var e=this;return new Promise(function(){var t=Object(s.a)(i.a.mark(function t(n,r){var a,s,o,c,u,l,f,d,v,g;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.a.getAccount();case 2:if(void 0!==(a=t.sent)){t.next=6;break}return n([]),t.abrupt("return");case 6:return t.next=8,new h.a(e.contractAddress).from(m.j).select("guildId").select("requester").where("newMember",a.toLowerCase()).executeQuery(!1);case 8:for(c in s=t.sent,o={},s)o[s[c].guildId]={requester:s[c].requester,blockNumber:s[c].blockNumber};return o=e.reduceMap(o),t.next=14,new h.a(e.contractAddress).from(m.k).select("guildId").where("newMember",a.toLowerCase()).executeQuery(!1);case 14:return u=(u=t.sent).map(function(e){return e.guildId}),t.next=18,new h.a(e.contractAddress).from(m.l).select("guildId").where("newMember",a.toLowerCase()).executeQuery(!1);case 18:for(d in l=(l=t.sent).map(function(e){return e.guildId}),f=[],o)v=e.countOccurences(u,parseInt(d)),g=e.countOccurences(l,parseInt(d)),o[d].count>v+g&&f.push({guildId:parseInt(d),requester:o[d].requester,blockNumber:o[d].blockNumber});n(f);case 23:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"reduceMap",value:function(e){var t={};for(var n in e){for(var r in t)r!==n||t[r].count++;t[n]=e[n],t[n].count=1}return t}},{key:"countOccurences",value:function(e,t){var n=0;for(var r in e)e[r]===t&&n++;return n}},{key:"rejectRequestToAddToGuild",value:function(e){return new Promise(function(){var t=Object(s.a)(i.a.mark(function t(n,r){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:new f.a(d.c,"rejectRequestToAddToGuild",[e]).execute().then(function(e){n()});case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"acceptRequestToAddToGuild",value:function(e){return new Promise(function(){var t=Object(s.a)(i.a.mark(function t(n,r){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:new f.a(d.c,"acceptRequestToAddToGuild",[e]).execute().then(function(e){n()});case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getAllMembersInUsersGuilds",value:function(e){var t=this;return new Promise(function(){var n=Object(s.a)(i.a.mark(function n(a,s){var o,c,u,l,p;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.web3.eth.getAccounts();case 2:return o=n.sent,n.next=5,t.getGuildsForUser(e);case 5:c=n.sent,u=[],l=i.a.mark(function e(n){var a,s,l;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=c[n],s=a.guildId,e.next=4,t.getUsersInGuild(s);case 4:l=(l=(l=e.sent).filter(function(e){return e.userId!==o[0]})).map(function(e){return Object(r.a)({},e,{guildId:s,guildName:a.name})}),u=u.concat(l);case 8:case"end":return e.stop()}},e)}),n.t0=i.a.keys(c);case 9:if((n.t1=n.t0()).done){n.next=14;break}return p=n.t1.value,n.delegateYield(l(p),"t2",12);case 12:n.next=9;break;case 14:a(u);case 15:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getGuildsForUser",value:function(e){var t=this;return new Promise(function(){var n=Object(s.a)(i.a.mark(function n(r,a){var s,o,c,u,l,f,d;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,p.a.getAccount();case 2:if(s=n.sent,void 0===e&&(e=s),void 0!==e){n.next=7;break}return r([]),n.abrupt("return");case 7:return[],o=new h.a(t.contract.options.address).from(m.c).select("guildId").where("user",e.toLowerCase()),n.next=11,o.executeQuery(!1);case 11:c=n.sent,u={},n.t0=i.a.keys(c);case 14:if((n.t1=n.t0()).done){n.next=23;break}return l=n.t1.value,f=c[l].guildId,n.next=19,t.getGuildName(f);case 19:d=n.sent,u[f]=d,n.next=14;break;case 23:r(Object.keys(u).map(function(e){return{guildId:parseInt(e),name:u[e]}}));case 24:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"hasAccessTo",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t){e.next=2;break}return e.abrupt("return",!0);case 2:return e.next=4,this.getGuildsWithAccess();case 4:return n=e.sent,e.abrupt("return",n.indexOf(t)>-1);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getGuildsWithAccess",value:function(e){var t=this;return new Promise(function(){var n=Object(s.a)(i.a.mark(function n(r,a){var s,o,c;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0===t.guildsWithAccess){n.next=3;break}return r(t.guildsWithAccess),n.abrupt("return");case 3:return n.next=5,p.a.getAccount();case 5:if(s=n.sent,void 0===e&&(e=s),void 0!==e){n.next=11;break}return t.guildsWithAccess=[],r([]),n.abrupt("return");case 11:return[],o=new h.a(t.contract.options.address).from(m.c).select("guildId").where("user",e.toLowerCase()),n.next=15,o.executeQuery(!1);case 15:c=n.sent,t.guildsWithAccess=Array.from(new Set(c.map(function(e){return e.guildId}))),r(t.guildsWithAccess);case 18:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getGuildName",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return","");case 2:if(!(t in b)){e.next=6;break}return e.next=5,b[t];case 5:return e.abrupt("return",e.sent);case 6:return n=new Promise(function(){var e=Object(s.a)(i.a.mark(function e(n,a){var s,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=new h.a(r.contract.options.address).from(m.h).select("name").where("guildId",t),e.next=3,s.executeQuery(!1);case 3:if(0!==(o=e.sent).length){e.next=6;break}return e.abrupt("return","");case 6:n(o[0].name);case 7:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),b[t]=n,e.next=10,n;case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUsersInGuild",value:function(e){var t=this;return new Promise(function(){var n=Object(s.a)(i.a.mark(function n(r,a){var s,o,c,u,l;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(navigator.onLine){n.next=3;break}return r([]),n.abrupt("return");case 3:return n.next=5,p.a.getAccount();case 5:return n.sent,s=[],n.prev=7,n.next=10,t.contract.methods.getTotalGuildUsers(e).call();case 10:o=n.sent,c=0;case 12:if(!(c<o)){n.next=23;break}return n.next=15,t.contract.methods.getUserFromGuild(e,c).call();case 15:return u=n.sent,n.next=18,t.users.getUserName(u);case 18:l=n.sent,s.push({userId:u,userName:l});case 20:c++,n.next=12;break;case 23:n.next=28;break;case 25:n.prev=25,n.t0=n.catch(7),console.log("error getting users in guild");case 28:r(s);case 29:case"end":return n.stop()}},n,null,[[7,25]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"setGuildName",value:function(e,t){var n=this;return new Promise(function(){var r=Object(s.a)(i.a.mark(function r(a,s){var o;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.web3.eth.getAccounts();case 2:o=r.sent,n.contract.methods.setNameForGuild(e,t).send({from:o[0]},function(e,t){e?s(e):a()});case 4:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"getContentGuildId",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n){var r,a,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.guildIdCache)){e.next=2;break}return e.abrupt("return",this.guildIdCache[t]);case 2:if(n!==g.b){e.next=14;break}return r=new h.a(y.contractAddress).from(m.B).select("guildId").where("ipfsHash",t),e.next=6,r.executeQuery(!1);case 6:if(0!==(a=e.sent).length){e.next=10;break}return this.guildIdCache[t]=0,e.abrupt("return",0);case 10:return s=null===(s=a[0].guildId)||void 0===s?0:s,this.guildIdCache[t]=s,e.abrupt("return",s);case 14:return e.abrupt("return",0);case 15:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"onUserChanged",value:function(){this.guildsWithAccess=void 0,this.getGuildsWithAccess()}},{key:"getPeople",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n,r,a,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new h.a(this.contractAddress).from(m.c).select("user").executeQuery();case 2:t=e.sent,n=[],e.t0=i.a.keys(t);case 5:if((e.t1=e.t0()).done){e.next=14;break}return r=e.t1.value,a=t[r].user,e.next=10,this.users.getUserName(a);case 10:s=e.sent,n.push({id:a,userName:s}),e.next=5;break;case 14:return e.abrupt("return",n);case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"contractAddress",get:function(){return this.contract.options.address}}]),e}();t.a=k},940:function(e,t,n){"use strict";var r=n(3),a=n.n(r),i=n(12),s=n(4),o=n(5),c=n(41),u=n(139),l=n(63),p=n(31),h=n(70),f=n(40),d=new(n(168).a),m=function(){function e(t){Object(s.a)(this,e),this.web3=t,this.contract=new t.eth.Contract(d.abi,d.contractAddress)}return Object(o.a)(e,[{key:"getGuildIdForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new c.a(this.address).from(p.B).select("guildId").where("ipfsHash",t).executeQuery();case 2:return n=e.sent,e.abrupt("return",n.map(function(e){return e.guildId})[0]);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getMetadataForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n,r){var i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new c.a(this.address).from(n).where("ipfsHash",t);case 2:return i=e.sent,r.forEach(function(e){return i.select(e)}),e.next=6,i.executeQuery();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getTagsForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,p.E,["tag"]);case 2:return n=e.sent,e.abrupt("return",Array.from(new Set(n.map(function(e){return e.tag}))));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getTitleForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,p.B,["title"]);case 2:if(0!==(n=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",n[0].title);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getStylesForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,p.D,["style"]);case 2:return n=e.sent,e.abrupt("return",Array.from(new Set(n.map(function(e){return e.style}))));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCountryForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,p.A,["country"]);case 2:if(0!==(n=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",n[0].country);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getYearForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,p.H,["year"]);case 2:if(0!==(n=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",n[0].year);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getYoutubeIdForSound",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,p.I,["videoId"]);case 2:if(0!==(n=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",n[0].videoId);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getDiscogsData",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,p.f,["covertArtHash, discogsId"]);case 2:return n=e.sent,e.abrupt("return",n[0]||{coverArtHash:void 0,discogsId:void 0});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"saveSample",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c,l,p,h,f,d,m;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getId(),r=new u.a(t.audioBuffer.numberOfChannels,function(){return[]}),e.next=4,r.uploadBufferToIpfs(t.audioBuffer);case 4:return i=e.sent,e.next=7,this.getTagsForSound(n);case 7:return s=e.sent,e.next=10,this.getTitleForSound(n);case 10:return o=e.sent,e.next=13,this.getStylesForSound(n);case 13:return c=e.sent,e.next=16,this.getCountryForSound(n);case 16:return l=e.sent,e.next=19,this.getYearForSound(n);case 19:return p=e.sent,e.next=22,this.getDiscogsData(n);case 22:return h=e.sent,f=h.coverArtHash,d=h.discogsId,e.next=27,this.getYoutubeIdForSound(n);case 27:return m=e.sent,this.newSampleWithMetadata(i,{title:o,youtubeId:m,tags:s,styles:c,country:l,year:p,guildId:0,discogsId:d,coverArtHash:f}),e.abrupt("return",i);case 30:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"newSampleWithMetadata",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(i.a)(a.a.mark(function e(i,s){var o,c,u,p,d,m,v,g,y,b,k,E,O,S;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(o=n.title,c=n.youtubeId,u=n.tags,p=n.styles,d=n.country,m=n.year,v=n.guildId,g=n.discogsId,y=n.coverArtHash,b=r.web3,k=b.utils.padLeft("0x0",64),void 0===u&&(u=[]),u.length>4&&(u=u.slice(0,4)),p.length>4&&(p=p.slice(0,4)),E=u.length;E<4;E++)u.push(null);for(O=p.length;O<4;O++)p.push(null);u=u.map(function(e){return e?b.utils.fromAscii(e):k}),p=p.map(function(e){return e?b.utils.fromAscii(e):k}),d=d?b.utils.fromAscii(d):k,c=c?b.utils.fromAscii(c):k,y=y?Object(l.a)(y):k,t=Object(l.a)(t),S=[t,o,c,u,p,d,void 0===m?0:m,void 0===g?0:g,y,v],new h.a(f.e,"newSampleWithMetadata",S).execute().then(function(){return i()});case 16:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"address",get:function(){return this.contract.options.address}}]),e}();t.a=m},941:function(e,t,n){"use strict";var r=n(3),a=n.n(r),i=n(12),s=n(4),o=n(5),c=n(379),u=n(49),l=n(63),p=n(70),h=n(40),f=n(41),d=n(31),m=n(153),v=n(39),g=new c.a,y=function(){function e(t,n,r,a){Object(s.a)(this,e),this.web3=t,this.encryption=r,this.crypto=a,this.guilds=n,this.contract=g.getContract(t),this.contractAddress=g.contractAddress,this.NULL_BYTES_32=t.utils.padLeft("0x0",64)}return Object(o.a)(e,[{key:"newGuildSequence",value:function(e,t,n,r){var s=this;return new Promise(function(){var o=Object(i.a)(a.a.mark(function i(o,c){var u,f,d,m,g;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,s.guilds.getGuildKey(r);case 2:return u=a.sent,f=u.rawPublicKey,a.next=6,s.crypto.encryptRawContent(JSON.stringify(e),t,f);case 6:return d=a.sent,a.next=9,v.a.addJson(d.encryptedContent);case 9:return m=a.sent,a.next=12,s.web3.eth.getAccounts();case 12:0===a.sent.length&&c("No accounts"),g=s.web3.utils.padLeft("0x"+d.encryptedName,64),new p.a(h.f,"editSequence",[n?Object(l.a)(n):s.NULL_BYTES_32,Object(l.a)(m),g,d.encryptedContentKey,u.publicKey,r]).execute(),o(m);case 17:case"end":return a.stop()}},i)}));return function(e,t){return o.apply(this,arguments)}}())}},{key:"getGuildSequence",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new f.a(this.contractAddress).select("contentHash").select("previousHash").select("user").select("encryptedName").select("guildId").select("encryptedContentKey").select("publicKey").from(d.m).where("contentHash",t),e.next=3,n.executeQuery();case 3:if(0!==(r=e.sent).length){e.next=6;break}return e.abrupt("return",void 0);case 6:return i=r[0],s=i.guildId,e.next=10,this.guilds.getGuildKey(s);case 10:return o=e.sent,e.abrupt("return",this._decryptQueryResult(i,o.privateKey));case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getGuildSequences",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r,i,s,o,c,l,p=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(p.length>1&&void 0!==p[1])||p[1],r=new f.a(this.contractAddress).select("contentHash").select("previousHash").select("user").select("encryptedName").select("encryptedContentKey").select("publicKey").select("guildId").from(d.m).where("guildId",t),n){e.next=7;break}return e.next=5,u.a.getAccount();case 5:void 0!==(i=e.sent)&&r.where("address",i.toLowerCase());case 7:return e.next=9,r.executeQuery();case 9:return s=e.sent,e.next=12,this.guilds.getGuildKey(t);case 12:o=e.sent,c=[],e.t0=a.a.keys(s);case 15:if((e.t1=e.t0()).done){e.next=24;break}return l=e.t1.value,e.t2=c,e.next=20,this._decryptQueryResult(s[l],o.privateKey);case 20:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=15;break;case 24:return e.abrupt("return",c);case 25:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_decryptQueryResult",value:function(){var e=Object(i.a)(a.a.mark(function e(t,n){var r,i,s,o,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(m.b)(t.encryptedContentKey),e.next=3,this.crypto.decryptName(t.encryptedName,r,n);case 3:return i=e.sent,s=t.user,e.next=7,this.crypto.decryptContentKey(r,n);case 7:return o=e.sent,c={title:Object(m.b)(i),encryptedTitle:t.encryptedName,user:"0x"+Object(m.a)(s.slice(2)),newSequence:t.contentHash,previousSequence:t.previousHash,guildId:t.guildId,contentKey:o?o.contentKey:void 0,blockNumber:t.blockNumber,publicKey:Object(m.b)(t.publicKey)},e.abrupt("return",c);case 10:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}();t.a=y},942:function(e,t,n){"use strict";var r=n(4),a=n(5),i=n(385),s=n(63),o=n(40),c=n(70),u=function(){function e(t){Object(r.a)(this,e),this.web3=t,this.contract=(new i.a).getContract(t)}return Object(a.a)(e,[{key:"newResample",value:function(e,t,n,r,a){var i=this;n=n.map(function(e){return i.web3.utils.fromAscii(e)}),r=r.map(function(e){return Object(s.a)(e)}),e=Object(s.a)(e),new c.a(o.h,"newResample",[e,t,n,r,a]).execute().then(function(e){})}}]),e}();t.a=u},947:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAMAAADDpiTIAAAAA3NCSVQICAjb4U/gAAAAJ1BMVEVHcEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB+jSoGAAAADHRSTlMAC2ScHM/044C4SjGldxniAAASK0lEQVR4nO2d2XbjOAxEo339/+9ty07HTiTZArcqSnUf5pzueWiZBIECSIJfX0IIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEOJy1NM0jmN5o+/76sZQPej729+N41QX6E8UwSmm25T31dB08xG6Zhiqvhwn2ULm3Ca+r5quPTTtW7TNUN0MAf07hJliKvvh2Ho/5BNudiB/kAe3qa8a9zX/3gz6skb/PvGGOtrcP2mHfpQV8FGMIV3+J26+QBGBh2XhJ5v7HxZXICOAc1v5gMl/MQKlCEDqcogd8o8YgZQhgmJE+P0dGjmCtFAs/d+0lRRBIopyQM/2NrdgIBuIDe3sP5ANRKUY6Tz/mnYY0eN0UsaKf/YftJU0YWjqPl2dLwRdr9wwICN14N9BoSAQuS3+J3IDAchy8T+RG/CiyHbxP+mUGLoyZSP739NWigQOTHn7/t8MyguNZB761zQSAwZKno2+cDQlelgzoSjzV37bSA8e4AzCfx+ZwAeK/hzCfx+ZwDtO6/xf6aQFdrjE9C/IBLYYz6j891BS+JdTlX2OoNLQK5eb/oVBBeJv6go9FyAqJQQL5dkzv32kBm/e/0rab83V1eBlvf+TS0uB09f9jtD26GlAcanM/x3XjAP1FVO/PS54ZujC2n+L9mL5gJb/ikuJQYm/Da4jBi+e+u/TXGN/QMt/lys4AS3/t5zdCRQ9eoTZObcT0PI/QHPedEC5/yHOWhNQ7n+Y4YwHBcarHPkMQXe63QGpPyMn04JSf2ZOpQWl/hxoTxMGCh37ceMkh0bl/p05RRgY5f7dOUEYkPv3I/NsQMUfb7IuCk0q/vjT5btBWKLH7hzkujeg7C8YWQqBWtlfODIUAgr/QcmuIkBd/H28D9+XC+P9v/3yuHz0Z2d9yKwiQLr31wx9Ob559LWYxqCvjockJylIKP/apj/+APz9BXL0F6+pok5aQNjkX1sdn/sny3PUZDEhEynIJf+8Xvelep50zkQKEm3+BHnFr2bqXJ1BVZCm+tcOwd5yJbIB+mSARf43gVvyTiw9rMktgEP+x3m4keUNC+J0sKAYoq6PJZZJHjGi3RmgmP+473JwvGZAWhBgSP/jt1uiMAHKggBB+p+m2xaDCRBawAQPj+n6rhK8a0JXEoKXf9po0m8LfIdTMguAz3/yRnvw2w4dkwWg5x9ymRYdB4gsYMSOxJzU+z9Bn3mn2RgAl/+BfZXA555ILAA8/9AblODaB4UFYOcf3koDu/tFYAHYASBosIstgLVoC8Cuf4qiOFYLgi0AOv8052ShVSFoFIDOP0H8+w80GwCOA3T+qWqh0EoYrCIEnX+y/TCoFARZALT+RyH/XoFWBCAWoPn/TYG0gCa9P4TOP+WpOOiJuOQWAFU9lPMPtoDEmgh6/od0/tEWkPKX1kjNSzv/YB2QUBdB559Q/z2BWkCylXEVO3cBmg0msgDo/JPVf9ZAvWOazRGk0iE6B7cHMj9KcnMUufUF3/0+ArJCnmCAkAdAyK9G/wc5RNFdJHQDiDgB/MWJS4LQAnDSUocPBVIIRpXJ0AJgx54APIGOU8REGZriZCEA/3POSAktAIT9WfVYVsPQNN1tqbZt1wyVoY/kEaAHRSOVA7ANQIIJgLqs9poCN1UZys3UyCAQyVlCz762QdKbYqw+RbGuCtNdDiqXoySD2BsgAbxacbTNV5D+ktj1EiEZxN4A9g8Atg5fARrNQRVz+JQZ2wHGOwCMdv06+JYdsZemAqcC0NKG969x7PTq23EO2z4gaNkc3AHQL6J5NPr1azsG9pohUwFwSySfafDs5TP4DCP46ng4IQhuAeEhaAK8XeLRgAIcOIMJQXQLIPdFWIaYAY8eFOCVE0gIYvMZj82NYMrF3QmAhy6IEMTuAHikgAHvazr3oQI7zyBCEN0T09WPBXW/zr0owKsnQEUQ/QSMowMInrg6BiK0fvIWgvAe0G4DH+F4vuNJG3RHWc9iFloAOjqAKJ/t1pIE7UE9cqgF+BsgTg4gUrsOt01W9BLy2hrGvwHmYr/RwpbTWMJdgIcMQCsYt4+PKFtcLKBAqyj3ehBcADhVMqLKVhcLQOfR7tUAuACYO/tHR7Zah8S6jvpBR3DcFsILAAfnFb1u6RCU8AvJSQbgBcA8mx1ugrq1PS+By0CnagCBAHAw3BTx1jyYeBnoIgPwfsthqJN4LftgwmWgg3YhcFtza/3oRLcxzJpqSvJZ7zFGLvgWwII12ibbuDbLAIJwasuo0WcAHliLAOk8Le+X7WMqYTB8sDkCJHS01k9jyKgskprie805QEqvZQ0CDBH1uKaG3mx9YswB0spWYxDgcKlHgwBDBnjD5mYTW21jM4CsfCpDBjibhzj1GrP5pyLx1+1w6KNJAoBxHyB5qm0sBlCkVcdqWCQBwBhl0wdZm4ES7KwtHHCrJF9qzLQAW642F8AhAg6YLUUJcMGWBCJUtkkFkIiAz0GAI1bNRg8LOXNhO63CMrAfggBLADBKAEyancEnbvDWcdEEANtZENCGuylKkSTXH8pBLH7K6F9RCstipAxbwg/e2C1PALCtLlTmatIpPM51NwiwlIAWLGMLO3ZrclNE3nXPc7GUgBYsORYuvFoOh9GowN29TBqZsmAZWtzasvgpovi6nb8wBQDTViCwxmLZsGKpBS5sVjGJXJQtuiJH1pAH4C8IvbDhupgM1JYEIC3XIlWAn7liXQwAt7T7i+XIVS7vmFKN8GqFMUmU2aSuoK7VEqqYkqyVDuRSgCbXio1dBhFAJbL+6kAu6zTts2B9VzYfuuKXk+VSgLOpDIBdWIZYRVVn+a0DyRTgbPKs2BKrQQWSGcCrDiRzTrOpDoRVL9ldt3nhJ3yxKcCbezo+rOD6iiEN4NkQ/uanjsmmAE3Dil5Xx30VnQH8z7XQQ7iBocaOjqzH1QpVLfjOdyrIs1H9Q0YGcDxfYTkY/ELPMIJbZGQAxwsBhAawpIJ8KeBs0tboDMZQCQJ/6RYVfgA3kQGkoiY6q/iCwQDQFXbDrgXjUFeUXyUDSAd8ADfJyAAyDwENYXlilgGkY6QsA1jSwHxEIGEaeF9p6ER6i4zqAFkXgh5fT1gIyMgAci4Ff29mo4dwA20GJeH7TAhBN/O/aDs4Cf+PM6F11AbH1xU4suZ8IOTnXCjfgRDLkTCshMn4SNhLDQudS68xHArFHmcxFALZDOBFafO5gGxOW2fzoWteP53OBWSzsLK9GPI7eNG5gDNeDeMquf65HkpmndlcuszlO9f8WWJsLkDXwyOzekWMTKFYXCtSBOTaIGItXtlcgOFqEHBkc20RsxW6yFyAmkTFZKtbKNnpYEtwxQ1tpm3itkeXyUIzaRRpetWGKAvc+W4qF2BqFYsa20xbxe45LqpatakLK+rL82wWvW+3RE5K7eLjsf+QOFWiksFrDBl84hZvlCtTowA9GROJd9VrpmqQ7d1IhOlm+WjUh8fOiFJB27NxAImV57NxH+IWUzXI9nBkehdgezuWZWl92r7k0ap6OjYGn7+a5ENnPR4dhc9ulaheYakE6Pn4Qxw5v8KTr9rWWOIoa9kGohnVQ2GL556Q7fXgryJl9LIcBVvgGNRjVkujA22JYNLoZVSAJBHgqKym0YG2RDCln+X9sjccli00OtDqZ5MFAeuHUey0v30z+DcsRQtrDEj19vX+dtoOFBHAoKlp6oHGPCCRfmmNGQBHBDBJagqLnc15QKKhtgoAisTKKFsZTHbBVgv6SiIDbCXqBYa8ymi1NUkQsA929PBl90oMxyzMA0kSBGxnLu5EFoJmAUiRVeVptQvmeBvZAhzmnyCeGjLAH0iCgIPpfo3xLKBzGEkCCeiwjGiCgDnl+opoAY3D/BNIQHPd6gFHEHD6+EhRwGn+8VVAl7C1wBEEXMLXzQJifPvgNJBwB+A2ggscQcDNf9Xh6wGV20KCb605CYAHePk6OxtwETqC2UsSd+AOwPG7H4NIEQQcJUzYLa3WdR2hHYBLGvWEoIThEcPGcPbrJv++8GHUenLlLxQbw64u4KsOFQac3Sjah9o3Lv+C9mB33H9FGSIfbNz/ffQCMu+nr6C4LegRx2pvIdv27l4UXQR09p0vwFXsgkcm8zX6ObHBOYv+gjsA1wrQbxhyQT8pU7oH4sbH9NAa2mXjYoOkx+338Elmbz/B0QT8ph8toPwF4DeJTlrG/TGlfTIGz+lHR09/AUjyQ+741TMWxspiyF3v7T/B+tnPaf6GQQYEsOeiPFgXaCvfxb+AHTX/FfMCgwxw39N6pS4/+oGuGoOIZ6zfDJMA/MBQDTDex95nKqsdg26bqgyjnNFDFigBeIIuaS+EDGrFVPbV0HRd285t2zXDUJVjKNV8B3ucJuhPuYOuac4B05oUZPOS1VGCb6874LuzlRBsCSikr/yB4YBYUGUbE+xghdgB2IChHhTFtCMAdZfRlglDPShCcIsAVAAETgBpfteDLIQgdKUETwBfYRCCMX9fGKApc9wVwlARjOjhwgCtADmfXT3645QKfAI7RNE1EkMqECnLCQPWSYbbAd6FIRUgtgDs/CfJkglSAd5yALZemmhhMBwOILWAS8w/RTLIGQWw/j+dOGZIBhktADz/CdNjhmTQ9bJ2PCJcSDeQtjxCYQEpTf4AUVpSHCZ1eYyhHOB+YzcGERtTHRmK5IsB+3u/6Xh2hsAnQAFLgeGQ4NwmqHwdocCmxhhXyFASJJGCWPkH2yBlKAlSCIGAjUhcwG2Qc1gAPAyAhwF5QILDArBhYAJXxbAekGFbYIZmA0Fa0HiAjoAkFoByAhN6WwR/PIrFAjrAceGiRxdD8PPPYwF+vXxc8Ow9FOInE8w/kQX4dPOyE6wFoTsc809kAXOXLCMsCBIglvlnsoC5SWIC+OA/cx2IIFgOP8Q3AYrpJzsUx2QBNxOI6RtriulPcf7bBJUFhOjwtcNk6jQWDXj5ew3H3uAPbRWhOFiMeOV/J/b9LycoToi80gR2AySLf6Y6B/MKnQXcEqVgaqDu4VWfH2jvR2NPRe4wBGj7NhHNPn775w0UZ4XXNL1HyCzGiutX8ZR/NqC4MbJFO/QO3T/rkWrp3+FK/1cw9JLbpanK6agV1GNJtvLvEKZ/fyEqC2/SDX05vrGDehr7auDTs3fUICkYS3PYqur78pu+76ulcyzpzD8gln+vEKaD54Ba/r1CmQ7mD9Pu3wfA9yROSQby7xV2KZgdpNXfffKQgtmQ/LyjP5KCASGv/mwjIRAKys3fA4CvTJ+GTLL/LdDXpk4Bxf13V1QR8Cav7G8F9eZQBjS5ZX9rFAY8yNr9/wd9fz5fclX/f1E24EaGxZ89VBSy02ZZ/NmD4CZtZmRX+/8Ex32qbDiF+vuNtOBxEN1OEsB1fZCYEy7/B3ICRzjp8n8gJ/CR0y7/B3IC7zmd+F+j0vAbkna5QqGawB4n2Pk5Bri5NinnKv29h6HHGhvVeSr/R4D32CWjOXPut43iwJPMLn0EgqPbHgMX8/5Pah0UmC+k/beQFEjX3ZgUfMt1JGn7m5NSXlYNavofFBc1gctqvzVFfz0T0PT/4mo54XBl6b/NlUxA07/JVbTAcL2y72HK8yeFMdrYn4lz1wVaSb/PnLc62EZ7x+RkkLzKE5gu6ktGJ6M4nRhI85zdmRhpHmjxJ8oDRuenPkl9UL7fnfzdQFsp6/cibzUQ+uGya5JtKNDiD8bE+HzLe8K9WCfusD3e9ZYQb9WJFZnYQKPZjwfXE44baPajU5esb3rNg0R/GgrCBx27yuFlSuFOTfSwYyvRh4HCCBqXR2lFMG5GgAsHTaWlz8BNEwypXUFneIhYpKAe+0S+YHmKXAufk2Iqq5jOoBtuCx/9I8UnbmbQD03QakHbVP27R8cFIcX9JfjGzyEsr4yX8vh5U09jaXodvr2/LV+Okyb+dNTTNI5jWfY3qh+WP5Vlefs/0zTV8vRCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBDX4x+DhVcXDT48YQAAAABJRU5ErkJggg=="},948:function(e,t,n){e.exports=n.p+"static/media/eye-slash.c54ea9af.png"},955:function(e,t,n){"use strict";var r=n(15),a=n(3),i=n.n(a),s=n(12),o=n(4),c=n(5),u=n(386),l=(n(49),n(26)),p=(n(70),n(97)),h=n(157),f=n(299),d=(new Date(2018,7,3),function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.a,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(o.a)(this,e),this.ethereum=t,this.linkedPromiseList=void 0,this.results=[],this.includePrivate=n}return Object(c.a)(e,[{key:"executeQuery",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=7e6,!navigator.onLine){e.next=5;break}return e.next=4,this.getCurrentBlock();case 4:n=e.sent;case 5:return e.next=7,this.start(t,n-3e6,n);case 7:return this.linkedPromiseList=e.sent,e.abrupt("return",this);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getNext",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.linkedPromiseList&&!this.canceled){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.next=4,this.linkedPromiseList.getCurrent();case 4:if(t=e.sent,t=Array.from(new Set(t)),this.results=this.results.concat(t),this.results=this.sort(this.results),void 0!==this.linkedPromiseList){e.next=10;break}return e.abrupt("return",void 0);case 10:return e.next=12,this.linkedPromiseList.getNext();case 12:return this.linkedPromiseList=e.sent,e.abrupt("return",this.linkedPromiseList);case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"start",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n,r){var a,o=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n<=3e6)){e.next=2;break}return e.abrupt("return",new Promise(function(e,t){return e(void 0)}));case 2:return console.log("Get Sequences start fromBlock=%s toBlock=%s",n,r),a=this.ethereum.tokenizedSequences,e.abrupt("return",new f.a(Object(s.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getSequences(t,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),new f.a(Object(s.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.ethereum.getNewSequences(t,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),this.start(t,n-3e6,r-3e6))));case 5:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sort",value:function(e){return e.sort(function(e,t){return t.blockNumber-e.blockNumber}),e}},{key:"getCurrentBlock",value:function(){var e=Object(s.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ethereum.web3.eth.getBlockNumber();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}()),m=n(300);function v(e){return g.apply(this,arguments)}function g(){return(g=Object(s.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===h.a?3:14;break;case 3:return console.log("link type was correct"),n=new d,e.next=7,n.executeQuery();case 7:return e.next=9,n.getNext();case 9:if(!e.sent){e.next=13;break}console.log("getting next"),e.next=7;break;case 13:return e.abrupt("return",l.a.collapseAllSequences(n.results).map(function(e){return new m.a(void 0,void 0,e.newSequence,void 0,e.title)}));case 14:case"end":return e.stop()}},e)}))).apply(this,arguments)}n(63);var y=n(40),b=n(9),k=n(10),E=n(1),O=n(376),S=n(39),P=n(56),w=n(301);function j(e,t){return T.apply(this,arguments)}function T(){return(T=Object(s.a)(i.a.mark(function e(t,n){var r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===h.a?3:7;break;case 3:return e.next=5,N(n);case 5:return r=e.sent,e.abrupt("return",r.map(function(e){return{linkType:t,fromData:n,toData:e}}));case 7:return e.next=9,l.a.xanadu.getLinks(t,n);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function x(e,t,n){return C.apply(this,arguments)}function C(){return(C=Object(s.a)(i.a.mark(function e(t,n,r){var a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===h.a?3:8;break;case 3:return(a=new P.a(r)).fromData=n,e.next=7,a.fetchMetadata();case 7:return e.abrupt("return",a);case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function N(e){return R.apply(this,arguments)}function R(){return(R=Object(s.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.a.getJson(t);case 2:return n=e.sent,e.abrupt("return",Object(w.a)(n));case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function D(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(E.a)(e);if(t){var a=Object(E.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(k.a)(this,n)}}var q=function(e){Object(b.a)(n,e);var t=D(n);function n(e,r,a,i){var s,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return Object(o.a)(this,n),(s=t.call(this,a,i,c)).linkType=e,s.fromData=r,s.isLoaded=!1,s}return Object(c.a)(n,[{key:"isDynamic",value:function(){return!0}},{key:"load",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t,n,r,a,s=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:l.a.xanadu,!this.isRoot()){e.next=5;break}return e.next=4,this.loadRoot(t);case 4:return e.abrupt("return");case 5:return e.next=7,j(this.linkType,this.fromData);case 7:n=e.sent,e.t0=i.a.keys(n);case 9:if((e.t1=e.t0()).done){e.next=19;break}return r=e.t1.value,a=n[r],e.t2=this,e.next=15,x(this.linkType,this.fromData,a.toData);case 15:e.t3=e.sent,e.t2.addItem.call(e.t2,e.t3),e.next=9;break;case 19:this.isLoaded=!0;case 20:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loadRoot",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t=this,r=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.length>0&&void 0!==r[0]?r[0]:l.a.xanadu,e.next=3,v(this.linkType);case 3:return e.sent.map(function(e){return new n(t.linkType,e.getId(),e.getName(),t)}).forEach(function(e){return t.addFolder(e)}),this.isLoaded=!0,e.abrupt("return",this);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),n}(O.a),M=n(31),A=y.j.XANADU,I=function(){function e(t){Object(o.a)(this,e),this.web3=t,this.contract=(new u.a).getContract(t),this.linkFolder=new q(h.a),this.sequencesCache=void 0}return Object(c.a)(e,[{key:"load",value:function(){return this.linkFolder.loadRoot(this)}},{key:"newLinks",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n,r){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getDataTypes",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new p.a(A.options.address).from(M.e).select("dataType").select("description"),e.next=3,t.executeQuery();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"getLinkTypes",value:function(){var e=Object(s.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new p.a(A.options.address).from(M.p).select("linkType").select("description"),e.next=3,t.executeQuery();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"getLinks",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n,r){var a,s,o,c,u,l;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.web3.eth.getBlockNumber();case 2:return a=e.sent,console.log("getLinks linkType=%s fromData=%s toData=%s",t,n,r),s=new p.a(A.options.address).from(M.o).select("fromData").select("toData").fromBlock(7636e3).toBlock(a).where("linkType",t),n&&s.where("fromData",n),r&&s.where("toData",r),e.next=9,s.executeQuery(7636e3,a);case 9:o=e.sent,c=[],u=function(e){var t=o[e].fromData;if(c.some(function(e){return e.fromData===t}))return"continue";c.push(o[e])},e.t0=i.a.keys(o);case 13:if((e.t1=e.t0()).done){e.next=20;break}if(l=e.t1.value,"continue"!==u(l)){e.next=18;break}return e.abrupt("continue",13);case 18:e.next=13;break;case 20:return console.log("query returned",c),e.abrupt("return",c);case 22:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"loadGraph2",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:A.options.address;return new Promise(function(){var t=Object(s.a)(i.a.mark(function t(a,s){var o;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("address to use = "+r),t.t0=n,t.t1=r,t.next=5,l.a.getGuildsWithAccess();case 5:t.t2=t.sent,o={toData:t.t0,address:t.t1,guildIds:t.t2},console.log("load graph2",o),fetch("/graphQuery/",{method:"POST",body:JSON.stringify(o),headers:{Accept:"text/html","Content-Type":"text/html"}}).then(function(e){return e.json()}).then(function(t){var n=[];for(var r in t){var i={};i.toData=t[r].vertex.toData,i.fromData=t[r].vertex.fromData,i.adjacent=t[r].adjacentVertices.map(function(e){return e.fromData||e.toData}),i.linkType=e,n.push(i)}a(n)});case 9:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"loadGraph",value:function(){var e=Object(s.a)(i.a.mark(function e(t,n,a){var s,o,c,u,l,p,h,f,d,m,v,g,y,b=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=b.length>3&&void 0!==b[3]?b[3]:new Set,0!==(o=b.length>4&&void 0!==b[4]?b[4]:4)){e.next=4;break}return e.abrupt("return",[]);case 4:if(void 0===n){e.next=7;break}if(!s.has(n)){e.next=7;break}return e.abrupt("return",[]);case 7:if(void 0===a){e.next=10;break}if(!s.has(a)){e.next=10;break}return e.abrupt("return",[]);case 10:return e.next=12,this.getLinks(t,n,a);case 12:if(c=e.sent,u=[],void 0!==n&&(s.add(n),l=c.map(function(e){return e.toData}),u.push({fromData:n,adjacent:l})),void 0===a){e.next=21;break}if(!s.has(a)){e.next=18;break}return e.abrupt("return",[]);case 18:s.add(a),p=c.map(function(e){return e.fromData}),u.push({toData:a,adjacent:p});case 21:for(f in h=[],c)d=c[f],m=void 0===n?d.fromData:void 0,v=void 0===a?d.toData:void 0,h.push(this.loadGraph(t,m,v,s,o-1));return e.next=25,Promise.all(h);case 25:for(y in g=e.sent)u=[].concat(Object(r.a)(u),Object(r.a)(g[y]));return e.abrupt("return",u);case 28:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()}]),e}();t.a=I},957:function(e,t,n){"use strict";var r=n(3),a=n.n(r),i=n(12),s=n(4),o=n(5),c=function(){function e(){Object(s.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"}],name:"new2DMapping",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"ipfsHash",type:"bytes32"}],name:"New2DMapping",type:"event"}],this.contractAddress="0x50ff08f58ba3d2cbeaa07326267332e41dc946aa"}return Object(o.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),u=n(31),l=n(97),p=n(39),h="X",f=function(){function e(t){if(Object(s.a)(this,e),t.length<=1)this.pivot=t[0];else{var n=this.getPivotAndDimension(t);this.pivot=n.pivot,this.dimension=n.dimension,this.range=n.range;var r=t.indexOf(this.pivot);t.splice(r,1);var a=this.getSubTreePoints(this.pivot,this.dimension,t);this.leftSubTree=new e(a.left),this.rightSubTree=new e(a.right)}}return Object(o.a)(e,[{key:"getSubTreePoints",value:function(e,t,n){var r=[],a=[],i=this.getValueForDimension(e,t);for(var s in n){var o=n[s],c=this.getValueForDimension(o,t);c<i?r.push(o):c>=i&&a.push(o)}return{left:r,right:a}}},{key:"getValueForDimension",value:function(e,t){return t===h?e.point[0]:e.point[1]}},{key:"getPivotAndDimension",value:function(e){var t=this.chooseDimension(e),n=t.dimension,r=(t.max+t.min)/2,a=void 0,i=1e4;for(var s in e){var o=e[s],c=n===h?Math.abs(o.point[0]-r):Math.abs(o.point[1]-r);c<i&&(a=o,i=c)}return{pivot:a,dimension:n,range:{min:t.min,max:t.max}}}},{key:"chooseDimension",value:function(e){var t=1e4,n=1e4,r=-1e4,a=-1e4;for(var i in e){var s=e[i].point[0],o=e[i].point[1];s<t&&(t=s),s>r&&(r=s),o<n&&(n=o),o>a&&(a=o)}return r-t>a-n?{dimension:h,min:t,max:r}:{dimension:"Y",min:n,max:a}}},{key:"getPointsInRange",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(void 0===this.pivot)return[];var i=this.pivot.point[0],s=this.pivot.point[1],o=[];return i>=e&&i<=n&&s>=t&&s<=r&&o.push(this.pivot),this.dimension==h?(i<=n&&e<=this.range.max&&void 0!==this.rightSubTree&&(o=o.concat(this.rightSubTree.getPointsInRange(e,t,n,r,a+1))),i>=e&&n>=this.range.min&&void 0!==this.leftSubTree&&(o=o.concat(this.leftSubTree.getPointsInRange(e,t,n,r,a+1)))):"Y"===this.dimension&&(s<=r&&t<=this.range.max&&void 0!==this.rightSubTree&&(o=o.concat(this.rightSubTree.getPointsInRange(e,t,n,r,a+1))),s>=t&&r>=this.range.min&&void 0!==this.leftSubTree&&(o=o.concat(this.leftSubTree.getPointsInRange(e,t,n,r,a+1)))),o}},{key:"size",value:function(){var e=1;return void 0!==this.leftSubTree&&(e+=this.leftSubTree.size()),void 0!==this.rightSubTree&&(e+=this.rightSubTree.size()),e}},{key:"inRange",value:function(e,t,n,r){return void 0!==this.range&&(this.dimension===h?e>=this.range.min&&e<=this.range.max:t>=this.range.min&&t<=this.range.max)}}]),e}(),d=new c,m=function(){function e(t){Object(s.a)(this,e),this.contract=d.getContract(t),this.loaded=!1}return Object(o.a)(e,[{key:"load",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new l.a(this.contract.contractAddress).from(u.d).select("ipfsHash").executeQuery();case 2:if(0!==(t=e.sent).length){e.next=5;break}return e.abrupt("return");case 5:return n=t[t.length-1].ipfsHash,e.next=8,p.a.getJson(n);case 8:r=e.sent,this.points=r,this.pointsMap=this.getMap(r),console.log("constructing KD tree"),this.kdTree=new f(this.points),console.log("finished constructing KD tree size="),console.log(this.kdTree.size()),this.loaded=!0;case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getPointsInRange",value:function(e,t,n,r){var a=(new Date).getTime(),i=this.kdTree.getPointsInRange(e,t,n,r),s=(new Date).getTime();return console.log("finished getting points in "+(s-a)+" ms"),i}},{key:"getMap",value:function(e){var t={};for(var n in e){var r=e[n];t[r.path]=r}return t}},{key:"findSimilarSounds",value:function(e){var t=void 0;for(var n in this.points)this.points[n].path===e&&(t=this.points[n]);if(void 0===t)return console.log("no point"),[];var r=[];for(var a in this.points){var i=this.distance(t,this.points[a]);r.push({point:this.points[a],distance:i})}return r.sort(function(e,t){return e.distance-t.distance}),r.slice(0,100).map(function(e){return e.point.path})}},{key:"distance",value:function(e,t){var n=e.point[0],r=e.point[1],a=t.point[0],i=t.point[1];return Math.sqrt(Math.pow(a-n,2)+Math.pow(i-r,2))}}]),e}();t.a=m},958:function(e,t,n){"use strict";var r=n(3),a=n.n(r),i=n(12),s=n(4),o=n(5),c=n(384),u=n(70),l=n(40),p=n(41),h=n(31),f=n(39),d=n(49);var m=n(63),v=new c.a,g=function(){function e(t){Object(s.a)(this,e),this.web3=t,this.contract=v.getContract(t),this.contractAddress=v.contractAddress}return Object(o.a)(e,[{key:"sendMessage",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3?arguments[3]:void 0;return new Promise(function(){var o=Object(i.a)(a.a.mark(function i(o,c){var p,h,v;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(void 0!==e){a.next=4;break}return a.next=3,d.a.getAccount();case 3:e=a.sent;case 4:return p={type:r,referenceHash:n,content:s},a.next=7,f.a.addJson(p,!0);case 7:h=a.sent,v=Object(m.a)(h),n=null!==n?Object(m.a)(n):t.web3.utils.padLeft("0x0",64),new u.a(l.g,"sendPublicMessage",[e,n,v]).execute().then(function(){o(h)});case 11:case"end":return a.stop()}},i)}));return function(e,t){return o.apply(this,arguments)}}())}},{key:"getMessages",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i,s=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:null,n=s.length>1?s[1]:void 0,e.next=4,this.getQuery(t,n);case 4:return r=e.sent,e.next=7,r.executeQuery();case 7:return i=e.sent,e.abrupt("return",i);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"watchForNewMessages",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:null,n=i.length>1?i[1]:void 0,r=i.length>2?i[2]:void 0,e.next=5,this.getQuery(t,n);case 5:e.sent.watchQuery(r);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getQuery",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:null,n=i.length>1?i[1]:void 0,r=new p.a(this.contractAddress).from(h.y).select("fromUser").select("referenceHash").select("messageHash").where("referenceHash",t),n&&r.where("toUser",n),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=g},959:function(e,t,n){"use strict";var r=n(3),a=n.n(r),i=n(12),s=n(4),o=n(5),c=function(){function e(){Object(s.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"reasoningHash",type:"bytes32"}],name:"copyStrikeSample",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"newDesignatedAgent",type:"address"}],name:"switchDesignatedAgent",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"}],name:"takedownSample",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"reasoningHash",type:"bytes32"}],name:"SampleCopyStrike",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"}],name:"SampleTakenDown",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"agent",type:"address"}],name:"NewDesignatedAgent",type:"event"}],this.contractAddress="0xAd4752a6C01C2B25b6248bEB33B1B03f2BE9F9E7"}return Object(o.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),u=n(63),l=n(97),p=n(31),h=n(39),f=new c,d=function(){function e(t){Object(s.a)(this,e),this.web3=t,this.contract=f.getContract(t),this.contractAddress=f.contractAddress}return Object(o.a)(e,[{key:"getCopyStrikedSamples",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new l.a(this.contractAddress).from(p.z).select("sampleHash").select("reasoningHash"),e.next=3,t.executeQuery();case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getTakenDownSamples",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new l.a(this.contractAddress).from(p.F).select("sampleHash"),e.next=3,t.executeQuery();case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"copyStrikeSample",value:function(e,t,n){var r=this;return new Promise(function(){var s=Object(i.a)(a.a.mark(function i(s,o){var c,l,p;return a.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,r.web3.eth.getAccounts();case 2:return c=a.sent,l={reasoning:n,emailAddress:t},a.next=6,h.a.addJson(l,!0);case 6:p=a.sent,p=Object(u.a)(p),e=Object(u.a)(e),r.contract.methods.copyStrikeSample(e,p).send({from:c[0]},function(e,t){e?o():s()});case 10:case"end":return a.stop()}},i)}));return function(e,t){return s.apply(this,arguments)}}())}},{key:"takeDownSample",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(a.a.mark(function n(r,i){var s;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.web3.eth.getAccounts();case 2:s=n.sent,e=Object(u.a)(e),t.contract.methods.takedownSample(e).send({from:s[0]},function(e,t){e?i():r()});case 5:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}}]),e}();t.a=d},960:function(e,t,n){"use strict";var r=n(3),a=n.n(r),i=n(12),s=n(4),o=n(5),c=n(376),u=n(63),l=n(70),p=n(40),h=n(383),f=n(31),d=n(9),m=n(10),v=n(1);n(26);function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var a=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var y=function(e){Object(d.a)(n,e);var t=g(n);function n(e,r){var a;return Object(s.a)(this,n),(a=t.call(this)).name=e,a.contentHash=r,a}return Object(o.a)(n,[{key:"getName",value:function(){return this.name}},{key:"getId",value:function(){return this.contentHash}},{key:"getJson",value:function(){return{name:this.name,contentHash:this.contentHash}}},{key:"fromJson",value:function(e){return this.name=e.name,this.contentHash=e.contentHash,this}}]),n}(n(246).a),b=n(41),k=n(39),E=new h.a,O=function(){function e(t){Object(s.a)(this,e),this.web3=t,this.root=new c.a,this.contract=E.getContract(t),this.contractAddress=E.contractAddress,this.isLoaded=!1}return Object(o.a)(e,[{key:"syncFolders",value:function(){var e=this;return new Promise(function(){var t=Object(i.a)(a.a.mark(function t(n,r){var i,s;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.web3.eth.getAccounts();case 2:return t.sent,i=e.root.getJson(),t.next=6,k.a.addJson(i);case 6:s=t.sent,new l.a(p.b,"foldersUpdated",[Object(u.a)(s)]).execute().then(function(e){return n()});case 8:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"loadFolders",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new b.a(this.contractAddress).from(f.b).select("foldersHash"),e.next=3,t.executeQuery();case 3:if(0!==(n=e.sent).length){e.next=6;break}return e.abrupt("return");case 6:return r=n[0].foldersHash,e.next=9,k.a.getJson(r);case 9:i=e.sent,this.root.fromJson(i,function(e){return(new y).fromJson(e)}),this.isLoaded=!0;case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=O},962:function(e,t,n){e.exports=n(2319)},966:function(e,t,n){},97:function(e,t,n){"use strict";var r=n(15),a=n(3),i=n.n(a),s=n(12),o=n(4),c=n(5),u=(n(31),n(27)),l=n(20),p="undefined"!==typeof window.web3,h=function(){function e(t){Object(o.a)(this,e),this.address=t,this.distinct=!1,this.selectStatements=[],this.whereClauses=[],this.groupBy=[],this.joinClauses=[],this.limitSize=void 0,this.fromBlockNumber="0x2",this.toBlockNumber=void 0}return Object(c.a)(e,[{key:"from",value:function(e){return this.eventLog=e,this}},{key:"select",value:function(e){return this.selectStatements.push(e),this}},{key:"distinct",value:function(){return this.distinct=!0,this}},{key:"groupBy",value:function(e){return this.groupBy.push(e),this}},{key:"where",value:function(e,t){return this.whereClauses.push(new f(e,t)),this}},{key:"whereIn",value:function(e,t){return this.whereClauses.push(new f(e,void 0,t)),this}},{key:"join",value:function(e,t){this.joinClauses.push(new d(e,t))}},{key:"fromBlock",value:function(e){return this.fromBlockNumber=u.a.utils.toHex(e),this}},{key:"toBlock",value:function(e){return this.toBlockNumber=u.a.utils.toHex(e),this}},{key:"limit",value:function(e){return this.limitSize=e,this}},{key:"getTopics",value:function(){var e=[u.a.utils.sha3(this.eventLog.event)];for(var t in this.eventLog.topics){var n=this.eventLog.topics[parseInt(t)],r=null;for(var a in this.whereClauses){var i=this.whereClauses[parseInt(a)];if(i.name===n.name){var s=void 0!==i.value?i.value:i.valueList[0];r=n.convertTo(s)}}e.push(r)}return e}},{key:"executeQuery",value:function(){var e=this;return new Promise(function(t,n){u.a.eth.getPastLogs({address:e.address,topics:e.getTopics(),toBlock:e.toBlockNumber,fromBlock:e.fromBlockNumber},function(r,a){if(r)n(r);else{var i=[];a.reverse();for(var s=Math.min(a.length,e.limitSize||a.length),o=0;o<s;o++)i.push(e.parseResult(a[o]));t(i)}})})}},{key:"watchQuery",value:function(){var e=Object(s.a)(i.a.mark(function e(t){var n,r=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.eth.getBlockNumber();case 2:n=e.sent,(p?u.a:u.b).eth.subscribe("logs",{address:this.address,topics:this.getTopics(),fromBlock:u.a.utils.toHex(n)},function(e,n){e&&(console.log("error watching "),console.log(e));var a=r.parseResult(n);console.log("watch query got "),console.log(a),t(a)});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"parseResult",value:function(e){if(void 0!==e&&null!==e){var t={};for(var n in this.selectStatements){var r=this.selectStatements[parseInt(n)];for(var a in this.eventLog.topics){var i=e.topics[1+parseInt(a)],s=this.eventLog.topics[parseInt(a)];s.name===r&&(t[r]=s.type.convertFrom(i))}var o=0;for(var c in this.eventLog.data){c=parseInt(c);var u=this.eventLog.data[c];if(void 0!==u&&r==u.name){var p=e.data.slice(2+o,2+o+u.size);p="0x"+p,u.type==l.m&&(p="0x"+e.data.slice(130+64*c)),t[r]=u.convertFrom(p)}o+=u.size}}return t.blockNumber=e.blockNumber,t}}},{key:"getCopy",value:function(){var t=new e(this.address);return t.eventLog=this.eventLog,t.selectStatements=Object(r.a)(this.selectStatements),t.joinClauses=Object(r.a)(this.joinClauses),t.groupBy=Object(r.a)(this.groupBy),t.fromBlockNumber=this.fromBlockNumber,t.toBlockNumber=this.toBlockNumber,t.limitSize=this.limitSize,t}},{key:"getJson",value:function(){return{address:this.address,eventLog:this.eventLog.event,selectStatements:Object(r.a)(this.selectStatements),whereClauses:Object(r.a)(this.whereClauses),joinClauses:Object(r.a)(this.joinClauses),groupBy:Object(r.a)(this.groupBy),fromBlockNumber:u.a.utils.hexToNumber(this.fromBlockNumber),toBlockNumber:void 0===this.toBlockNumber?void 0:u.a.utils.hexToNumber(this.toBlockNumber),limitSize:this.limitSize,distinct:this.distinct}}}]),e}(),f=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];Object(o.a)(this,e),this.name=t,this.value=n,this.valueList=r},d=function e(t,n){Object(o.a)(this,e),this.event=t,this.field=n};t.a=h},995:function(e,t){}},[[962,1,2]]]);
//# sourceMappingURL=main.392d995c.chunk.js.map
(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1037:function(e,t,n){},1038:function(e,t){var n,a,r=0,s=[];function i(){for(var e=0;e<a;e++)s[e]=[]}function o(e,t){for(var n=new Float32Array(t),a=0,r=0;r<e.length;r++)n.set(e[r],a),a+=e[r].length;return n}function c(e,t,n){for(var a=0;a<n.length;a++)e.setUint8(t+a,n.charCodeAt(a))}this.onmessage=function(e){switch(e.data.command){case"init":t=e.data.config,n=t.sampleRate,a=t.numChannels,i();break;case"record":!function(e){for(var t=0;t<a;t++)s[t].push(e[t]);r+=e[0].length}(e.data.buffer);break;case"exportWAV":!function(e){for(var t=[],i=0;i<a;i++)t.push(o(s[i],r));if(2===a)var u=function(e,t){var n=e.length+t.length,a=new Float32Array(n),r=0,s=0;for(;r<n;)a[r++]=e[s],a[r++]=t[s],s++;return a}(t[0],t[1]);else var u=t[0];var l=function(e){var t=new ArrayBuffer(44+2*e.length),r=new DataView(t);return c(r,0,"RIFF"),r.setUint32(4,36+2*e.length,!0),c(r,8,"WAVE"),c(r,12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,a,!0),r.setUint32(24,n,!0),r.setUint32(28,4*n,!0),r.setUint16(32,2*a,!0),r.setUint16(34,16,!0),c(r,36,"data"),r.setUint32(40,2*e.length,!0),function(e,t,n){for(var a=0;a<n.length;a++,t+=2){var r=Math.max(-1,Math.min(1,n[a]));e.setInt16(t,r<0?32768*r:32767*r,!0)}}(r,44,e),r}(u),p=new Blob([l],{type:e});this.postMessage(p)}(e.data.type);break;case"getBuffer":!function(){for(var e=[],t=0;t<a;t++)e.push(o(s[t],r));this.postMessage(e)}();break;case"clear":r=0,s=[],i()}var t}},104:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var a="SEQUENCE_USED_SOUND"},1041:function(e,t,n){"use strict";var a=n(3),r=n.n(a),s=n(11),i=n(1),o=n(2),c=n(424),u=n(59),l=n(62),p=n(40),h=n(431),d=n(31),f=n(435),m=n(41),v=n(35),g=new h.a,b=function(){function e(t){Object(i.a)(this,e),this.web3=t,this.root=new c.a,this.contract=g.getContract(t),this.contractAddress=g.contractAddress,this.isLoaded=!1}return Object(o.a)(e,[{key:"syncFolders",value:function(){var e=this;return new Promise(function(){var t=Object(s.a)(r.a.mark(function t(n,a){var s,i;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.web3.eth.getAccounts();case 2:return t.sent,s=e.root.getJson(),t.next=6,v.a.addJson(s);case 6:i=t.sent,new l.a(p.b,"foldersUpdated",[Object(u.b)(i)]).execute().then(function(e){return n()});case 8:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"loadFolders",value:function(){var e=Object(s.a)(r.a.mark(function e(){var t,n,a,s;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new m.a(this.contractAddress).from(d.b).select("foldersHash"),e.next=3,t.executeQuery();case 3:if(0!==(n=e.sent).length){e.next=6;break}return e.abrupt("return");case 6:return a=n[0].foldersHash,e.next=9,v.a.getJson(a);case 9:s=e.sent,this.root.fromJson(s,function(e){return(new f.a).fromJson(e)}),this.isLoaded=!0;case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=b},1045:function(e,t,n){"use strict";var a=n(1),r=n(2),s=function(){function e(){Object(a.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"sampleHashes",type:"bytes32[16]"},{name:"titles",type:"bytes32[16]"},{name:"youtubeVideoIds",type:"bytes32[16]"},{name:"coverArtHashes",type:"bytes32[16]"},{name:"discogIds",type:"uint256[16]"},{name:"tagsToAdd",type:"bytes32[4][16]"},{name:"stylesToAdd",type:"bytes32[4][16]"},{name:"countries",type:"bytes32[16]"},{name:"sampleYears",type:"int16[16]"}],name:"newSampleWithMetadata",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"sampleHashes",type:"bytes32[16]"}],name:"test2",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{name:"c",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"discogsId",type:"uint256"},{indexed:!0,name:"coverArtHash",type:"bytes32"}],name:"NewDiscogsSample",type:"event"}],this.contractAddress="0x18d2c1f1f70ecbeb6366c65cef684e229ff6d6b9"}return Object(r.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=s},1046:function(e,t,n){"use strict";var a=n(17),r=n(12),s=n(3),i=n.n(s),o=n(11),c=n(1),u=n(2),l=n(426),p=n(31),h=n(41),d=n(37),f=n(62),m=n(16),v=n(40),g=n(104),b=n(59),y=new l.a,k=function(){function e(t){Object(c.a)(this,e),this.web3=t,this.contract=new t.eth.Contract(y.abi,y.contractAddress),this.contractAddress=this.contract.options.address,this.zero=this.web3.utils.padRight("0x00",64)}return Object(u.a)(e,[{key:"getPrice",value:function(){var e=Object(o.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.methods.getPrice().call();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"buyTokens",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Math.pow(10,3)*t,e.next=3,this.getPrice();case 3:n=e.sent,a=n*t,new f.a(v.j,"buyTokens",[t],a).execute();case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getBalance",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.getAccount();case 2:if(void 0!==(t=e.sent)){e.next=5;break}return e.abrupt("return",0);case 5:return e.next=7,this.contract.methods.balanceOf(t).call();case 7:return n=e.sent,e.abrupt("return",this.web3.utils.hexToNumber(n)/1e3);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"saveNewSequence",value:function(e,t,n,a){var r=this;return new Promise(function(){var s=Object(o.a)(i.a.mark(function s(o,c){var u,l;return i.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,d.a.getAccount();case 2:for(l in void 0===s.sent&&o(),u=[],a)u.push(Object(b.b)(a[l]));return e=void 0===e?r.zero:Object(b.b)(e),t=Object(b.b)(t),s.next=10,m.a.xanadu.newLinks(g.a,t,u);case 10:u.push(e),new f.a(v.j,"editSequence",[e,t,n,u]).execute().then(function(e){return o}).catch(function(e){return c});case 12:case"end":return s.stop()}},s)}));return function(e,t){return s.apply(this,arguments)}}())}},{key:"getSequences",value:function(e,t,n){var a=this;return new Promise(function(){var s=Object(o.a)(i.a.mark(function s(o,c){var u,l;return i.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return u=new h.a(a.contractAddress).select("user").select("previousSequence").select("newSequence").select("title").fromBlock(t).toBlock(n).from(p.Q),void 0!==e&&u.where("user",e.toLowerCase()),s.next=4,u.executeQuery(!1);case 4:(l=s.sent).sort(function(e,t){return t.blockNumber-e.blockNumber}),o(l.map(function(e){return Object(r.a)({},e,{edits:0})}));case 7:case"end":return s.stop()}},s)}));return function(e,t){return s.apply(this,arguments)}}())}},{key:"getNextSequences",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(o.a)(i.a.mark(function e(a,s){var o,c;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=new h.a(n.contractAddress).select("user").select("previousSequence").select("newSequence").select("title").where("previousSequence",t).from(p.Q),e.next=3,o.executeQuery();case 3:c=e.sent,a(c.map(function(e){return Object(r.a)({},e,{edits:0})}));case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPreviousSequences",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(o.a)(i.a.mark(function e(s,o){var c,u,l;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getPreviousSequence("+t+")"),c=new h.a(n.contractAddress).select("user").select("previousSequence").select("newSequence").select("title").where("newSequence",t).from(p.Q),e.next=4,c.executeQuery();case 4:if(0!==(u=(u=e.sent).map(function(e){return Object(r.a)({},e,{edits:0,isPrevious:!0})})).length&&u[0].previousSequence!==t){e.next=10;break}s(u),e.next=21;break;case 10:return l=u[0].previousSequence,e.t0=s,e.t1=[],e.t2=Object(a.a)(u),e.t3=a.a,e.next=17,n.getPreviousSequences(l);case 17:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t6=e.t1.concat.call(e.t1,e.t2,e.t5),(0,e.t0)(e.t6);case 21:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSequence",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(o.a)(i.a.mark(function e(a,s){var o,c;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getSequence("+t+")"),o=new h.a(n.contractAddress).select("user").select("previousSequence").select("newSequence").select("title").where("newSequence",t).from(p.Q),e.next=4,o.executeQuery();case 4:c=e.sent,a(c.map(function(e){return Object(r.a)({},e,{edits:0})}));case 6:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"watchBalance",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.getAccount();case 2:if(void 0!==(t=e.sent)){e.next=5;break}return e.abrupt("return");case 5:console.log("watch balance toUser = "+t),new h.a(this.contract.options.address).from(p.R).select("amount").where("toUser",t.toLowerCase()).watchQuery(function(e){n.callback&&n.callback()});case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=k},1047:function(e,t,n){"use strict";var a=n(1);t.a=function e(){Object(a.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"startMilliseconds",type:"int32"},{name:"endMilliseconds",type:"int32"}],name:"newSlice",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"startMilliseconds",type:"int32[16]"},{name:"endMilliseconds",type:"int32[16]"}],name:"newSlices16",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"startMilliseconds",type:"int32[4]"},{name:"endMilliseconds",type:"int32[4]"}],name:"newSlices4",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"startMilliseconds",type:"int32[8]"},{name:"endMilliseconds",type:"int32[8]"}],name:"newSlices8",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"tag",type:"bytes32"},{name:"startMilliseconds",type:"int32"},{name:"endMilliseconds",type:"int32"}],name:"newTaggedSlice",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!0,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"tag",type:"bytes32"},{indexed:!1,name:"startMilliseconds",type:"int32"},{indexed:!1,name:"endMillisconds",type:"int32"}],name:"SliceCreated",type:"event"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"}],this.contractAddress="0xf68a5fccacd945904dbcc675752987c72f7d5bed"}},1048:function(e,t,n){"use strict";var a=n(12),r=n(3),s=n.n(r),i=n(11),o=n(1),c=n(2),u=n(430),l=n(62),p=n(40),h=n(59),d=n(37),f=n(217),m=n(41),v=n(31),g=function(){function e(t,n){Object(o.a)(this,e),this.contract=(new u.a).getContract(t),this.web3=t,this.crypto=n,this.NULL_BYTES32=this.web3.utils.padLeft("0x0",64),this.cachedResults={}}return Object(c.a)(e,[{key:"getPublicKey",value:function(){var e=Object(i.a)(s.a.mark(function e(t){var n=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(i.a)(s.a.mark(function e(a,r){var i,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=7;break}return e.next=3,d.a.getAccount();case 3:if(void 0!==(t=e.sent)){e.next=7;break}return a(void 0),e.abrupt("return");case 7:return i=new m.a(n.contract.options.address).from(v.u).select("publicKey").where("user",t.toLowerCase()),e.next=10,i.executeQuery();case 10:if(0!==(o=e.sent).length){e.next=14;break}return a(void 0),e.abrupt("return");case 14:c="0x"+n.stripTrailingZeroes(o[0].publicKey),a(n.web3.utils.toAscii(c));case 16:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getEncryptedContent",value:function(){var e=Object(i.a)(s.a.mark(function e(t,n,a){var r,o,c=this,u=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>3&&void 0!==u[3]?u[3]:2,o=u.length>4?u[4]:void 0,e.abrupt("return",new Promise(function(){var e=Object(i.a)(s.a.mark(function e(i,u){var l,p,h,d;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in c.cachedResults)){e.next=3;break}return i(c.cachedResults[t]),e.abrupt("return");case 3:return e.next=5,new m.a(c.contract.options.address).from(v.g).select("newContent").select("user").select("previousContent").select("contentType").select("encryptedName").select("publicKey").select("encryptedContentKey").select("publicKey").fromBlock(r).toBlock(o);case 5:return l=e.sent,void 0!==a&&l.where("user",a.toLowerCase()),void 0!==t&&l.where("newContent",t),e.next=10,l.executeQuery();case 10:if(0!==(p=e.sent).length){e.next=14;break}return i(void 0),e.abrupt("return");case 14:h=[],e.t0=s.a.keys(p);case 16:if((e.t1=e.t0()).done){e.next=25;break}return d=e.t1.value,e.t2=h,e.next=21,c.convertLogResult(p[d],n);case 21:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=16;break;case 25:c.cachedResults[t]=h,i(h);case 27:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}},e)}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"getEncryptedContentSharedWithMe",value:function(){var e=Object(i.a)(s.a.mark(function e(t,n){var a,r,i,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.cachedResults)){e.next=2;break}return e.abrupt("return",this.cachedResults[t]);case 2:return e.next=4,d.a.getAccount();case 4:return a=e.sent,r=new m.a(this.contract.options.address).from(v.a).select("encryptedContentKey").select("publicKey").select("contentHash").select("creator").where("sharedWith",a.toLowerCase()),void 0!==t&&r.where("contentHash",t),e.next=9,r.executeQuery();case 9:if(0!==(i=e.sent).length){e.next=12;break}return e.abrupt("return",void 0);case 12:o=[],e.t0=s.a.keys(i);case 14:if((e.t1=e.t0()).done){e.next=23;break}return c=e.t1.value,e.t2=o,e.next=19,this.convertSharedLogResult(i[c],!1,n);case 19:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=14;break;case 23:return this.cachedResults[t]=o,e.abrupt("return",o);case 25:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getEncryptedSequenceIfAny",value:function(){var e=Object(i.a)(s.a.mark(function e(t,n){var a,r,i=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.length>2&&void 0!==i[2]?i[2]:2,r=i.length>3?i[3]:void 0,e.next=4,this.getEncryptedContent(t,void 0,n,a,r);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSequencesSharedWithUser",value:function(){var e=Object(i.a)(s.a.mark(function e(t,n,a){var r,i,o,c,u;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.getAccount();case 2:return r=e.sent,i=new m.a(this.contract.options.address).from(v.a).select("encryptedContentKey").select("publicKey").select("contentHash").select("creator").where("sharedWith",r.toLowerCase()),void 0!==t&&i.where("contentHash",t),n&&i.fromBlock(n),a&&i.toBlock(a),e.next=9,i.executeQuery();case 9:o=e.sent,c=[],e.t0=s.a.keys(o);case 12:if((e.t1=e.t0()).done){e.next=21;break}return u=e.t1.value,e.t2=c,e.next=17,this.convertSharedLogResult(o[u]);case 17:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=12;break;case 21:return e.abrupt("return",c);case 22:case"end":return e.stop()}},e,this)}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"convertSharedLogResult",value:function(){var e=Object(i.a)(s.a.mark(function e(t){var n,r,i,o,c,u=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(u.length>1&&void 0!==u[1])||u[1],e.next=3,this.crypto.decryptContentKey(t.encryptedContentKey);case 3:if(r=e.sent,i=this.stripTrailingZeroes(t.publicKey),{user:t.creator,contentHash:t.contentHash,publicKey:i,contentKey:r?r.contentKey:void 0},o={},c="",!n){e.next=15;break}return e.next=11,this.getEncryptedSequenceIfAny(t.contentHash);case 11:return o=e.sent,e.next=14,this.crypto.decryptName(o[0].encryptedTitle,this.stripTrailingZeroes(t.encryptedContentKey));case 14:c=e.sent;case 15:return e.abrupt("return",Object(a.a)({},o[0],{title:c,publicKey:i,contentKey:r?r.contentKey:void 0}));case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"convertLogResult",value:function(){var e=Object(i.a)(s.a.mark(function e(t,n){var a,r,i,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.stripTrailingZeroes(t.encryptedContentKey),e.next=3,this.crypto.decryptName(t.encryptedName,a,n);case 3:return r=e.sent,i=t.user,e.next=7,this.crypto.decryptContentKey(a,n);case 7:return o=e.sent,c={title:this.stripTrailingZeroes(r),encryptedTitle:t.encryptedName,user:"0x"+this.stripLeadingZeroes(i.slice(2)),previousSequence:t.previousContent,newSequence:t.newContent,contentType:t.contentType,contentKey:o?o.contentKey:void 0,blockNumber:t.blockNumber,publicKey:this.stripTrailingZeroes(t.publicKey)},e.abrupt("return",c);case 10:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"newPublicKey",value:function(e){return new Promise(function(){var t=Object(i.a)(s.a.mark(function t(n,a){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:new l.a(p.a,"setPublicKey",[e]).execute().then(function(){return n()});case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"newEncryptedSequence",value:function(e,t,n,a,r){var o=this;return new Promise(function(){var c=Object(i.a)(s.a.mark(function i(c,u){return s.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:e=void 0===e?o.web3.utils.padLeft("0x0",64):Object(h.b)(e),t=Object(h.b)(t),n=o.web3.utils.padLeft("0x"+n,64),new l.a(p.a,"newEncryptedContent",[e,t,n,f.a,a,r]).execute().then(function(){return c()});case 4:case"end":return s.stop()}},i)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"newEncryptedContent",value:function(e,t,n,a,r){var o=this;return new Promise(function(){var c=Object(i.a)(s.a.mark(function i(c,u){return s.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:e=Object(h.b)(e),t=o.web3.utils.padLeft("0x"+t,64),new l.a(p.a,"newEncryptedContent",[o.NULL_BYTES32,e,t,a,n,r]).execute().then(function(){return c()});case 3:case"end":return s.stop()}},i)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"shareEncryptedContent",value:function(e,t,n,a){var r=this;return new Promise(function(){var o=Object(i.a)(s.a.mark(function i(o,c){return s.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return t=Object(h.b)(t),s.next=3,r.web3.eth.getAccounts();case 3:s.sent,new l.a(p.a,"shareEncryptedContentWith",[e,t,n,a]).execute().then(function(){return o()});case 5:case"end":return s.stop()}},i)}));return function(e,t){return o.apply(this,arguments)}}())}},{key:"stripTrailingZeroes",value:function(e){for(var t=e.length-1;t>=0;t--)if("0"!==e.slice(t,t+1))return e.slice(0,t+1)}},{key:"stripLeadingZeroes",value:function(e){for(var t=0;t<e.length;t++)if("0"!==e.slice(t,t+1))return e.slice(t)}}]),e}();t.a=g},1049:function(e,t,n){"use strict";var a=n(1);t.a=function e(){Object(a.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"sampleHash",type:"bytes32"}],name:"favoriteSample",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"sampleHash",type:"bytes32"}],name:"unfavoriteSample",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!0,name:"sampleHash",type:"bytes32"}],name:"SampleFavorited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!0,name:"sampleHash",type:"bytes32"}],name:"SampleUnfavorited",type:"event"}],this.contractAddress="0xcddbc9238e5ba4f6f4c0c8e0ef4231e1be4943fc"}},1050:function(e,t,n){"use strict";var a=n(1);t.a=function e(){Object(a.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"}],name:"newIndex",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!1,name:"sampleHash",type:"bytes32"}],name:"NewIndex",type:"event"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{constant:!0,inputs:[],name:"getIndex",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"}],this.contractAddress="0xb05e78e48dc17fff1b52307e240cab6b241fe288"}},1051:function(e,t,n){"use strict";var a=n(1);t.a=function e(){Object(a.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"previousSequences",type:"bytes32[4]"},{name:"newSequence",type:"bytes32"},{name:"diff",type:"bytes32"},{name:"title",type:"string"}],name:"editCompoundSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"previousSequence",type:"bytes32"},{name:"newSequence",type:"bytes32"},{name:"diff",type:"bytes32"},{name:"title",type:"string"}],name:"editSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"userEditing",type:"address"},{indexed:!0,name:"previousSequence",type:"bytes32"},{indexed:!0,name:"newSequence",type:"bytes32"},{indexed:!1,name:"diffHash",type:"bytes32"},{indexed:!1,name:"title",type:"string"}],name:"SequenceEdited",type:"event"}],this.contractAddress="0x16687b7db5994ac1aa22594be04af8396f5085dd"}},1052:function(e,t,n){"use strict";var a=n(12),r=n(3),s=n.n(r),i=n(11),o=n(1),c=n(2),u=n(429),l=n(438),p=n(37),h=n(41),d=n(62),f=n(40),m=n(31),v=n(59),g=n(217),b=new(n(195).a),y={},k=function(){function e(t,n,a){Object(o.a)(this,e),this.web3=t,this.contract=(new u.a).getContract(t),this.users=new l.a(t),this.crypto=n,this.encryption=a,this.guildKeyCache={},this.guildIdCache={},this.guildsWithAccess=void 0}return Object(c.a)(e,[{key:"initGuilds",value:function(){var e=Object(i.a)(s.a.mark(function e(){var t,n=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getGuildsForUser();case 2:return this.guilds=e.sent,e.next=5,p.a.getAccount();case 5:if(void 0!==(t=e.sent)){e.next=8;break}return e.abrupt("return");case 8:if(navigator.onLine){e.next=10;break}return e.abrupt("return");case 10:new h.a(this.contract.options.address).from(m.h).select("guildId").where("user",t.toLowerCase()).watchQuery(function(){n.newGuildCallback&&n.newGuildCallback()});case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getGuildKey",value:function(){var e=Object(i.a)(s.a.mark(function e(t){var n,a,r=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("getGuildKey("+t+")"),!(t in this.guildKeyCache)){e.next=6;break}return n=this.guildKeyCache[t],e.next=5,n;case 5:return e.abrupt("return",e.sent);case 6:return a=new Promise(function(){var e=Object(i.a)(s.a.mark(function e(n,a){var i,o,c,u,l,d,f;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=8;break}return e.next=3,r.getGuildsForUser();case 3:if(0!==(i=e.sent).length){e.next=7;break}return n(void 0),e.abrupt("return");case 7:t=i[0].guildId;case 8:return e.next=10,p.a.getAccount();case 10:if(void 0!==(o=e.sent)){e.next=14;break}return n(void 0),e.abrupt("return");case 14:return e.next=16,new h.a(r.contractAddress).from(m.c).select("ipfsHash").where("user",o.toLowerCase()).where("guildId",t).executeQuery();case 16:if(0!==(c=e.sent).length){e.next=20;break}return n(void 0),e.abrupt("return");case 20:return u=c[0].ipfsHash,e.next=23,r.encryption.getEncryptedContent(u);case 23:if(void 0!==(l=e.sent)){e.next=28;break}return e.next=27,r.encryption.getEncryptedContentSharedWithMe(u);case 27:l=e.sent;case 28:return e.t0=JSON,e.next=31,r.crypto.fetchAndDecrypt(u,l);case 31:e.t1=e.sent,d=e.t0.parse.call(e.t0,e.t1),f=r.crypto.generateGuildKey(d.passphrase),n(f);case 35:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),this.guildKeyCache[t]=a,e.next=10,a;case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"newGuild",value:function(){var e=Object(i.a)(s.a.mark(function e(t){var n,a=this,r=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:"fuck me fuck you",e.abrupt("return",new Promise(function(){var e=Object(i.a)(s.a.mark(function e(r,i){var o,c,u,l,p,h;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.crypto.generateGuildKey(n);case 2:return o=e.sent,o.privateKey,c=o.publicKey,e.next=7,a.crypto.encryptAndUploadJSON(o);case 7:u=e.sent,l=u.encryptedContentKey,p=u.encryptedContentIpfsHash,h=u.publicKey,new d.a(f.c,"newGuild",[c,t,Object(v.b)(p),l,h]).execute().then(function(e){r()});case 12:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"requestToAddMember",value:function(e,t){var n=this;return new Promise(function(){var a=Object(i.a)(s.a.mark(function a(r,i){var o,c,u,l;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n.getGuildKey(e);case 2:return o=a.sent,a.next=5,n.encryption.getPublicKey(t);case 5:return c=a.sent,a.next=8,n.crypto.encryptAndUploadJSON(o,c);case 8:u=a.sent,l=u.contentKey,new d.a(f.c,"requestToAddMember",[e,t,Object(v.b)(u.encryptedContentIpfsHash),l.convertForEthereum(),l.getPublicKeyAsBytes32()]).execute().then(function(e){r()});case 11:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"leaveGuild",value:function(e){return new Promise(function(){var t=Object(i.a)(s.a.mark(function t(n,a){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:new d.a(f.c,"leaveGuild",[e]).execute().then(function(e){n()});case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"voteForProposal",value:function(e,t,n){var a=this;return new Promise(function(){var r=Object(i.a)(s.a.mark(function r(i,o){var c;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,a.web3.eth.getAccounts();case 2:c=r.sent,a.contract.methods.voteOnNewGuildMemberProposal(e,t,n).send({from:c[0]},function(e,t){e?o(e):i()});case 4:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"getAllGuildMemberProposals",value:function(){var e=this;return new Promise(function(){var t=Object(i.a)(s.a.mark(function t(n,a){var r,i,o,c,u,l;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getGuildsForUser();case 2:r=t.sent,i=[],t.t0=s.a.keys(r);case 5:if((t.t1=t.t0()).done){t.next=14;break}return o=t.t1.value,c=r[o].guildId,t.next=10,e.getGuildMemberProposals(c);case 10:for(l in u=t.sent)i.push({guildId:c,proposalIndex:l,potentialMember:u[l]});t.next=5;break;case 14:n(i);case 15:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getGuildMemberProposals",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(s.a.mark(function n(a,r){var i,o,c,u,l;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.web3.eth.getAccounts();case 2:return i=n.sent,n.next=5,t.contract.methods.getTotalGuildMemberProposals(e).call({from:i[0]});case 5:o=n.sent,c=[],u=0;case 8:if(!(u<o)){n.next=16;break}return n.next=11,t.contract.methods.getNewGuildMemberProposal(e,u).call({from:i[0]});case 11:l=n.sent,c.push(l);case 13:u++,n.next=8;break;case 16:a(c);case 17:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getNewMemberRequests",value:function(){var e=this;return new Promise(function(){var t=Object(i.a)(s.a.mark(function t(n,a){var r,i,o,c,u,l,d,f,v,g;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.a.getAccount();case 2:if(void 0!==(r=t.sent)){t.next=6;break}return n([]),t.abrupt("return");case 6:return t.next=8,new h.a(e.contractAddress).from(m.j).select("guildId").select("requester").where("newMember",r.toLowerCase()).executeQuery();case 8:for(c in i=t.sent,o={},i)o[i[c].guildId]={requester:i[c].requester,blockNumber:i[c].blockNumber};return o=e.reduceMap(o),t.next=14,new h.a(e.contractAddress).from(m.k).select("guildId").where("newMember",r.toLowerCase()).executeQuery();case 14:return u=(u=t.sent).map(function(e){return e.guildId}),t.next=18,new h.a(e.contractAddress).from(m.l).select("guildId").where("newMember",r.toLowerCase()).executeQuery();case 18:for(f in l=(l=t.sent).map(function(e){return e.guildId}),d=[],o)v=e.countOccurences(u,parseInt(f)),g=e.countOccurences(l,parseInt(f)),o[f].count>v+g&&d.push({guildId:parseInt(f),requester:o[f].requester,blockNumber:o[f].blockNumber});n(d);case 23:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"reduceMap",value:function(e){var t={};for(var n in e){for(var a in t)a!==n||t[a].count++;t[n]=e[n],t[n].count=1}return t}},{key:"countOccurences",value:function(e,t){var n=0;for(var a in e)e[a]===t&&n++;return n}},{key:"rejectRequestToAddToGuild",value:function(e){return new Promise(function(){var t=Object(i.a)(s.a.mark(function t(n,a){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:new d.a(f.c,"rejectRequestToAddToGuild",[e]).execute().then(function(e){n()});case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"acceptRequestToAddToGuild",value:function(e){return new Promise(function(){var t=Object(i.a)(s.a.mark(function t(n,a){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:new d.a(f.c,"acceptRequestToAddToGuild",[e]).execute().then(function(e){n()});case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getAllMembersInUsersGuilds",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(s.a.mark(function n(r,i){var o,c,u,l,p;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.web3.eth.getAccounts();case 2:return o=n.sent,n.next=5,t.getGuildsForUser(e);case 5:c=n.sent,u=[],l=s.a.mark(function e(n){var r,i,l;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=c[n],i=r.guildId,e.next=4,t.getUsersInGuild(i);case 4:l=(l=(l=e.sent).filter(function(e){return e.userId!==o[0]})).map(function(e){return Object(a.a)({},e,{guildId:i,guildName:r.name})}),u=u.concat(l);case 8:case"end":return e.stop()}},e)}),n.t0=s.a.keys(c);case 9:if((n.t1=n.t0()).done){n.next=14;break}return p=n.t1.value,n.delegateYield(l(p),"t2",12);case 12:n.next=9;break;case 14:r(u);case 15:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getGuildsForUser",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(s.a.mark(function n(a,r){var i,o,c,u,l,d,f;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,p.a.getAccount();case 2:if(i=n.sent,void 0===e&&(e=i),void 0!==e){n.next=7;break}return a([]),n.abrupt("return");case 7:return[],o=new h.a(t.contract.options.address).from(m.c).select("guildId").where("user",e.toLowerCase()),n.next=11,o.executeQuery();case 11:c=n.sent,u={},n.t0=s.a.keys(c);case 14:if((n.t1=n.t0()).done){n.next=23;break}return l=n.t1.value,d=c[l].guildId,n.next=19,t.getGuildName(d);case 19:f=n.sent,u[d]=f,n.next=14;break;case 23:a(Object.keys(u).map(function(e){return{guildId:parseInt(e),name:u[e]}}));case 24:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getGuildsWithAccess",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(s.a.mark(function n(a,r){var i,o,c;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0===t.guildsWithAccess){n.next=4;break}return console.log("resolving cached guildsWithAccess"),a(t.guildsWithAccess),n.abrupt("return");case 4:return n.next=6,p.a.getAccount();case 6:if(i=n.sent,void 0===e&&(e=i),void 0!==e){n.next=12;break}return t.guildsWithAccess=[],a([]),n.abrupt("return");case 12:return[],o=new h.a(t.contract.options.address).from(m.c).select("guildId").where("user",e.toLowerCase()),n.next=16,o.executeQuery();case 16:c=n.sent,t.guildsWithAccess=Array.from(new Set(c.map(function(e){return e.guildId}))),a(t.guildsWithAccess);case 19:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getGuildName",value:function(){var e=Object(i.a)(s.a.mark(function e(t){var n,a=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in y)){e.next=4;break}return e.next=3,y[t];case 3:return e.abrupt("return",e.sent);case 4:return n=new Promise(function(){var e=Object(i.a)(s.a.mark(function e(n,r){var i,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new h.a(a.contract.options.address).from(m.h).select("name").where("guildId",t),e.next=3,i.executeQuery();case 3:if(0!==(o=e.sent).length){e.next=6;break}return e.abrupt("return","");case 6:n(o[0].name);case 7:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),y[t]=n,e.next=8,n;case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUsersInGuild",value:function(e){var t=this;return new Promise(function(){var n=Object(i.a)(s.a.mark(function n(a,r){var i,o,c,u,l;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(navigator.onLine){n.next=3;break}return a([]),n.abrupt("return");case 3:return n.next=5,p.a.getAccount();case 5:return n.sent,i=[],n.prev=7,n.next=10,t.contract.methods.getTotalGuildUsers(e).call();case 10:o=n.sent,c=0;case 12:if(!(c<o)){n.next=23;break}return n.next=15,t.contract.methods.getUserFromGuild(e,c).call();case 15:return u=n.sent,n.next=18,t.users.getUserName(u);case 18:l=n.sent,i.push({userId:u,userName:l});case 20:c++,n.next=12;break;case 23:n.next=28;break;case 25:n.prev=25,n.t0=n.catch(7),console.log("error getting users in guild");case 28:a(i);case 29:case"end":return n.stop()}},n,null,[[7,25]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"setGuildName",value:function(e,t){var n=this;return new Promise(function(){var a=Object(i.a)(s.a.mark(function a(r,i){var o;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n.web3.eth.getAccounts();case 2:o=a.sent,n.contract.methods.setNameForGuild(e,t).send({from:o[0]},function(e,t){e?i(e):r()});case 4:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"getContentGuildId",value:function(){var e=Object(i.a)(s.a.mark(function e(t,n){var a,r,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.guildIdCache)){e.next=2;break}return e.abrupt("return",this.guildIdCache[t]);case 2:if(n!==g.b){e.next=14;break}return a=new h.a(b.contractAddress).from(m.B).select("guildId").where("ipfsHash",t),e.next=6,a.executeQuery();case 6:if(0!==(r=e.sent).length){e.next=10;break}return this.guildIdCache[t]=0,e.abrupt("return",0);case 10:return i=null===(i=r[0].guildId)||void 0===i?0:i,this.guildIdCache[t]=i,e.abrupt("return",i);case 14:return e.abrupt("return",0);case 15:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"onUserChanged",value:function(){this.guildsWithAccess=void 0,this.getGuildsWithAccess()}},{key:"contractAddress",get:function(){return this.contract.options.address}}]),e}();t.a=k},1053:function(e,t,n){"use strict";var a=n(3),r=n.n(a),s=n(11),i=n(1),o=n(2),c=n(41),u=n(111),l=n(59),p=n(31),h=n(62),d=n(40),f=new(n(195).a),m=function(){function e(t){Object(i.a)(this,e),this.web3=t,this.contract=new t.eth.Contract(f.abi,f.contractAddress)}return Object(o.a)(e,[{key:"getGuildIdForSound",value:function(){var e=Object(s.a)(r.a.mark(function e(t){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new c.a(this.address).from(p.B).select("guildId").where("ipfsHash",t).executeQuery();case 2:return n=e.sent,e.abrupt("return",n.map(function(e){return e.guildId})[0]);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getMetadataForSound",value:function(){var e=Object(s.a)(r.a.mark(function e(t,n,a){var s;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new c.a(this.address).from(n).where("ipfsHash",t);case 2:return s=e.sent,a.forEach(function(e){return s.select(e)}),e.next=6,s.executeQuery();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"getTagsForSound",value:function(){var e=Object(s.a)(r.a.mark(function e(t){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,p.E,["tag"]);case 2:return n=e.sent,e.abrupt("return",Array.from(new Set(n.map(function(e){return e.tag}))));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getTitleForSound",value:function(){var e=Object(s.a)(r.a.mark(function e(t){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,p.B,["title"]);case 2:if(0!==(n=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",n[0].title);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getStylesForSound",value:function(){var e=Object(s.a)(r.a.mark(function e(t){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,p.D,["style"]);case 2:return n=e.sent,e.abrupt("return",Array.from(new Set(n.map(function(e){return e.style}))));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCountryForSound",value:function(){var e=Object(s.a)(r.a.mark(function e(t){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,p.A,["country"]);case 2:if(0!==(n=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",n[0].country);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getYearForSound",value:function(){var e=Object(s.a)(r.a.mark(function e(t){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,p.H,["year"]);case 2:if(0!==(n=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",n[0].year);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getYoutubeIdForSound",value:function(){var e=Object(s.a)(r.a.mark(function e(t){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,p.I,["videoId"]);case 2:if(0!==(n=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",n[0].videoId);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getDiscogsData",value:function(){var e=Object(s.a)(r.a.mark(function e(t){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadataForSound(t,p.f,["covertArtHash, discogsId"]);case 2:return n=e.sent,e.abrupt("return",n[0]||{coverArtHash:void 0,discogsId:void 0});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"saveSample",value:function(){var e=Object(s.a)(r.a.mark(function e(t){var n,a,s,i,o,c,l,p,h,d,f,m;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getId(),a=new u.a(t.audioBuffer.numberOfChannels,function(){return[]}),e.next=4,a.uploadBufferToIpfs(t.audioBuffer);case 4:return s=e.sent,e.next=7,this.getTagsForSound(n);case 7:return i=e.sent,e.next=10,this.getTitleForSound(n);case 10:return o=e.sent,e.next=13,this.getStylesForSound(n);case 13:return c=e.sent,e.next=16,this.getCountryForSound(n);case 16:return l=e.sent,e.next=19,this.getYearForSound(n);case 19:return p=e.sent,e.next=22,this.getDiscogsData(n);case 22:return h=e.sent,d=h.coverArtHash,f=h.discogsId,e.next=27,this.getYoutubeIdForSound(n);case 27:return m=e.sent,this.newSampleWithMetadata(s,{title:o,youtubeId:m,tags:i,styles:c,country:l,year:p,guildId:0,discogsId:f,coverArtHash:d}),e.abrupt("return",s);case 30:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"newSampleWithMetadata",value:function(){var e=Object(s.a)(r.a.mark(function e(t,n){var a=this;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(r.a.mark(function e(s,i){var o,c,u,p,f,m,v,g,b,y,k,E,S,O;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(o=n.title,c=n.youtubeId,u=n.tags,p=n.styles,f=n.country,m=n.year,v=n.guildId,g=n.discogsId,b=n.coverArtHash,y=a.web3,k=y.utils.padLeft("0x0",64),void 0===u&&(u=[]),u.length>4&&(u=u.slice(0,4)),p.length>4&&(p=p.slice(0,4)),E=u.length;E<4;E++)u.push(null);for(S=p.length;S<4;S++)p.push(null);u=u.map(function(e){return e?y.utils.fromAscii(e):k}),p=p.map(function(e){return e?y.utils.fromAscii(e):k}),f=f?y.utils.fromAscii(f):k,c=c?y.utils.fromAscii(c):k,b=b?Object(l.b)(b):k,t=Object(l.b)(t),O=[t,o,c,u,p,f,void 0===m?0:m,void 0===g?0:g,b,v],new h.a(d.e,"newSampleWithMetadata",O).execute().then(function(){return s()});case 16:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"address",get:function(){return this.contract.options.address}}]),e}();t.a=m},1054:function(e,t,n){"use strict";var a=n(3),r=n.n(a),s=n(11),i=n(1),o=n(2),c=n(427),u=n(37),l=n(59),p=n(62),h=n(40),d=n(41),f=n(31),m=n(166),v=n(35),g=new c.a,b=function(){function e(t,n,a,r){Object(i.a)(this,e),this.web3=t,this.encryption=a,this.crypto=r,this.guilds=n,this.contract=g.getContract(t),this.contractAddress=g.contractAddress,this.NULL_BYTES_32=t.utils.padLeft("0x0",64)}return Object(o.a)(e,[{key:"newGuildSequence",value:function(e,t,n,a){var i=this;return new Promise(function(){var o=Object(s.a)(r.a.mark(function s(o,c){var u,d,f,m,g;return r.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,i.guilds.getGuildKey(a);case 2:return u=r.sent,d=u.rawPublicKey,r.next=6,i.crypto.encryptRawContent(JSON.stringify(e),t,d);case 6:return f=r.sent,r.next=9,v.a.addJson(f.encryptedContent);case 9:return m=r.sent,r.next=12,i.web3.eth.getAccounts();case 12:0===r.sent.length&&c("No accounts"),g=i.web3.utils.padLeft("0x"+f.encryptedName,64),new p.a(h.f,"editSequence",[n?Object(l.b)(n):i.NULL_BYTES_32,Object(l.b)(m),g,f.encryptedContentKey,u.publicKey,a]).execute(),o(m);case 17:case"end":return r.stop()}},s)}));return function(e,t){return o.apply(this,arguments)}}())}},{key:"getGuildSequence",value:function(){var e=Object(s.a)(r.a.mark(function e(t){var n,a,s,i,o;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new d.a(this.contractAddress).select("contentHash").select("previousHash").select("user").select("encryptedName").select("guildId").select("encryptedContentKey").select("publicKey").from(f.m).where("contentHash",t),e.next=3,n.executeQuery();case 3:if(0!==(a=e.sent).length){e.next=6;break}return e.abrupt("return",void 0);case 6:return s=a[0],i=s.guildId,e.next=10,this.guilds.getGuildKey(i);case 10:return o=e.sent,e.abrupt("return",this._decryptQueryResult(s,o.privateKey));case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getGuildSequences",value:function(){var e=Object(s.a)(r.a.mark(function e(t){var n,a,s,i,o,c,l,p=arguments;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(p.length>1&&void 0!==p[1])||p[1],a=new d.a(this.contractAddress).select("contentHash").select("previousHash").select("user").select("encryptedName").select("encryptedContentKey").select("publicKey").select("guildId").from(f.m).where("guildId",t),n){e.next=7;break}return e.next=5,u.a.getAccount();case 5:void 0!==(s=e.sent)&&a.where("address",s.toLowerCase());case 7:return e.next=9,a.executeQuery();case 9:return i=e.sent,e.next=12,this.guilds.getGuildKey(t);case 12:o=e.sent,c=[],e.t0=r.a.keys(i);case 15:if((e.t1=e.t0()).done){e.next=24;break}return l=e.t1.value,e.t2=c,e.next=20,this._decryptQueryResult(i[l],o.privateKey);case 20:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=15;break;case 24:return e.abrupt("return",c);case 25:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_decryptQueryResult",value:function(){var e=Object(s.a)(r.a.mark(function e(t,n){var a,s,i,o,c;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(m.b)(t.encryptedContentKey),e.next=3,this.crypto.decryptName(t.encryptedName,a,n);case 3:return s=e.sent,i=t.user,e.next=7,this.crypto.decryptContentKey(a,n);case 7:return o=e.sent,c={title:Object(m.b)(s),encryptedTitle:t.encryptedName,user:"0x"+Object(m.a)(i.slice(2)),newSequence:t.contentHash,previousSequence:t.previousHash,guildId:t.guildId,contentKey:o?o.contentKey:void 0,blockNumber:t.blockNumber,publicKey:Object(m.b)(t.publicKey)},e.abrupt("return",c);case 10:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}();t.a=b},1055:function(e,t,n){"use strict";var a=n(1),r=n(2),s=n(433),i=n(59),o=n(40),c=n(62),u=function(){function e(t){Object(a.a)(this,e),this.web3=t,this.contract=(new s.a).getContract(t)}return Object(r.a)(e,[{key:"newResample",value:function(e,t,n,a,r){var s=this;n=n.map(function(e){return s.web3.utils.fromAscii(e)}),a=a.map(function(e){return Object(i.b)(e)}),e=Object(i.b)(e),new c.a(o.h,"newResample",[e,t,n,a,r]).execute().then(function(e){})}}]),e}();t.a=u},1059:function(e,t,n){"use strict";(function(e){var a=n(3),r=n.n(a),s=n(11),i=n(1),o=n(2),c=n(16),u=n(35),l=n(43),p=n(2357),h=n(66),d=new l("undefined"!==typeof window.web3?window.web3.currentProvider:new l.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),f=p("localhost","5001",{protocol:"http"});Date.prototype.formatMMDDYYYY=function(){return this.getMonth()+1+"/"+this.getDate()+"/"+this.getFullYear()};var m=function(){function e(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];Object(i.a)(this,e),this.contract=new d.eth.Contract(t.abi,t.contractAddress),this.topics=n,this.ipfsIndex=a,this.pinningSounds=new Set,this.pinnedSounds=new Set,this.failedSounds=new Set,this.queuedSounds=new Set,this.providedSounds=0,this.provide=r,this.byChunks=s,this.badBlockRanges=[],this.localRefs=new Set,this.currentBlockDate=new Date,this.yo()}return Object(o.a)(e,[{key:"getStats",value:function(){return{date:this.currentBlockDate,pinned:this.pinnedSounds,pinning:this.pinningSounds,local:this.localRefs,queued:this.queuedSounds,failed:this.failedSounds}}},{key:"yo",value:function(){var e=Object(s.a)(r.a.mark(function e(){var t=this;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("getting ipfs refs"),f.refs.local(function(e,n){e||(console.log(e),console.log("ipfs local returned"),console.log(n),t.localRefs=new Set(n.map(function(e){return e.Ref})))});case 2:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"watchAndPin",value:function(){var e=this;d.eth.subscribe("logs",{address:this.contract.options.address,topics:this.topics,fromBlock:"0x1"},function(t,n){t?console.log(t):void 0!==n&&null!=n?(console.log("got a log to pin!"),e.robustPin(v(n.topics[e.ipfsIndex]))):console.log("there was nothing...")})}},{key:"pinAll",value:function(){var e=Object(s.a)(r.a.mark(function e(){var t;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.eth.getBlockNumber();case 2:t=e.sent,console.log("BLOCK NUMBER RETURNED ="+t),this.pinAllHelper(3e6,t,7e4);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"pinAllHelper",value:function(){var e=Object(s.a)(r.a.mark(function e(t,n,a){var s,i,o,c,u,l=arguments;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(l.length>3&&void 0!==l[3])||l[3],s=[],console.log("pin all called"),this.byChunks){e.next=7;break}this.pinFromBlockToBlock(1,void 0),e.next=37;break;case 7:i=n,console.log("block number = "+i);case 9:if(!(i>=t)){e.next=27;break}return e.prev=10,e.next=13,this.pinFromBlockToBlock(i-a,i);case 13:return e.next=15,this.sleep(550);case 15:e.next=24;break;case 17:e.prev=17,e.t0=e.catch(10),console.log("encountered error while pinning blockNumber = "+i),console.log(e.t0),s.push(i),console.log("bad block ranges = "),console.log(s);case 24:i-=a,e.next=9;break;case 27:console.log("completed"),e.t1=r.a.keys(s);case 29:if((e.t2=e.t1()).done){e.next=37;break}return o=e.t2.value,c=s[o]-a,u=s[o],e.next=35,this.pinAllHelper(c,u,Math.ceil(a/2),!1);case 35:e.next=29;break;case 37:case"end":return e.stop()}},e,this,[[10,17]])}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"pinFromBlockToBlock",value:function(){var e=Object(s.a)(r.a.mark(function e(t,n){var a=this;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Date,e.next=3,d.eth.getBlock(t);case 3:return e.t1=e.sent.timestamp,e.t2=1e3*e.t1,this.currentBlockDate=new e.t0(e.t2),e.abrupt("return",new Promise(function(e,i){try{d.eth.getPastLogs({address:a.contract.options.address,topics:a.topics,toBlock:d.utils.toHex(n),fromBlock:d.utils.toHex(t)},function(){var t=Object(s.a)(r.a.mark(function t(n,s){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=4;break}return console.log("GOT ERROR WHILE GETTING PAST LOGS!"),i(),t.abrupt("return");case 4:return s.reverse(),s.length>0&&console.log("got "+s.length+" many files to pin in this range"),t.next=8,a.pinHashes(s.map(function(e){return e.topics[a.ipfsIndex]}).map(function(e){return v(e)}));case 8:e();case 9:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}catch(o){console.log(o),i(o)}}));case 7:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"sleep",value:function(e){return new Promise(function(t,n){setTimeout(function(){t()},e)})}},{key:"pinHashes",value:function(){var e=Object(s.a)(r.a.mark(function e(t){var n,a,s,i,o,c,u,l=this;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:void 0!==this.localRefs.has?t=t.filter(function(e){return!l.localRefs.has(e)}):console.log("didnt have local ref"),(t=Array.from(new Set(t))).forEach(function(e){return l.queuedSounds.add(e)}),n=[],a=8,s=0;case 6:if(!(s<t.length)){e.next=26;break}for(i=[],e.prev=8,o=[],c=s;c<s+a&&c<t.length;c++)i.push(t[c]),o.push(this.pin(t[c]));return e.next=13,Promise.all(o);case 13:return e.next=15,this.sleep(100);case 15:e.sent,e.next=23;break;case 18:for(u in e.prev=18,e.t0=e.catch(8),console.log("IMPORTANT ERROR had err = "+e.t0),n=n.concat(i))this.failedSounds.add(n[u]),this.pinningSounds.has(n[u])&&this.pinningSounds.delete(n[u]);case 23:s+=a,e.next=6;break;case 26:case"end":return e.stop()}},e,this,[[8,18]])}));return function(t){return e.apply(this,arguments)}}()},{key:"robustPin",value:function(){var e=Object(s.a)(r.a.mark(function e(t){var n=arguments;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.length>1&&void 0!==n[1]?n[1]:0,e.prev=1,console.log("pinning "+t),e.next=5,this.pin(t);case 5:e.sent,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.log("had error pinning = "),console.log(e.t0);case 12:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"pin",value:function(e){var t=this;return new Promise(function(){var n=Object(s.a)(r.a.mark(function n(a,i){var o,l;return r.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(o="",t.pinningSounds.add(e),t.queuedSounds.delete(e),t.pinningSounds.size%20!==0){n.next=7;break}return n.next=6,c.a.getTitleForSound(e);case 6:o=n.sent;case 7:return l=!1,setTimeout(function(){l?a():i("timed out so failing")},6e4),""!==o&&console.log("pinning i = "+t.pinningSounds.size+" "+o),n.prev=10,n.next=13,u.a.getSound(e,3e4);case 13:n.sent,n.next=21;break;case 16:return n.prev=16,n.t0=n.catch(10),console.log("rejected the sound!"),i(n.t0),n.abrupt("return");case 21:f.pin.add(e,function(){var n=Object(s.a)(r.a.mark(function n(s,c){return r.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:s?i(s):(t.pinnedSounds.add(e),t.pinningSounds.delete(e),t.failedSounds.has(e)&&t.failedSounds.delete(e),console.log("pinned i = "+t.pinnedSounds.size+" "+o+" (failures = "+t.failedSounds.size+")"),t.provide?f.dht.provide(e,function(n,r){n?(console.log("error providing "),console.log(n),i(n)):(t.providedSounds++,console.log("provided i ="+t.providedSounds+" "+e),l=!0,a(e))}):(l=!0,a(e)));case 1:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}());case 22:case"end":return n.stop()}},n,null,[[10,16]])}));return function(e,t){return n.apply(this,arguments)}}())}}]),e}();function v(t){var n=new e(t.replace(/^0x/,"1220"),"hex");return h.encode(n)}t.a=m}).call(this,n(15).Buffer)},1060:function(e,t,n){"use strict";(function(e){var a=n(3),r=n.n(a),s=n(11),i=n(1),o=n(2),c=n(43),u=new c(new c.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),l=n(698),p=function(){function t(){Object(i.a)(this,t)}return Object(o.a)(t,[{key:"getNonce",value:function(){return u.eth.getTransactionCount("0xdc94060e37dcb8816188508536595019c8F0C98a")}},{key:"runFunction",value:function(){var t=Object(s.a)(r.a.mark(function t(n,a){var s,i;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==this.nonce){t.next=4;break}return t.next=3,this.getNonce();case 3:this.nonce=t.sent;case 4:console.log("contract address = "+a),s={nonce:u.utils.toHex(this.nonce),gasPrice:u.utils.toHex(u.utils.toWei("10","gwei")),gasLimit:u.utils.toHex(28e5),value:"0x0",data:n,to:a},(i=new l(s)).sign(e.from("85b3dcadf2e50cd9536d09805d97010b217f43f64fd4c161796b222647849f4d","hex")),u.eth.sendSignedTransaction("0x"+i.serialize().toString("hex")).on("transactionHash",console.log).on("receipt",function(e){console.log(e)}).on("confirmation",function(e,t){console.log("Confirmation no. ".concat(e," and receipt for contract deployment: "),t)}).catch(function(e){console.log(e)}),this.nonce++;case 10:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}()}]),t}();t.a=p}).call(this,n(15).Buffer)},1068:function(e,t,n){"use strict";var a=n(17),r=n(3),s=n.n(r),i=n(11),o=n(1),c=n(2),u=n(434),l=(n(37),n(16)),p=(n(62),n(93)),h=n(104),d=n(175),f=n(340);function m(e){return v.apply(this,arguments)}function v(){return(v=Object(i.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===h.a?3:14;break;case 3:return console.log("link type was correct"),n=new d.a,e.next=7,n.executeQuery();case 7:return e.next=9,n.getNext();case 9:if(!e.sent){e.next=13;break}console.log("getting next"),e.next=7;break;case 13:return e.abrupt("return",l.a.collapseAllSequences(n.results).map(function(e){return new f.a(void 0,void 0,e.newSequence,void 0,e.title)}));case 14:case"end":return e.stop()}},e)}))).apply(this,arguments)}n(59);var g=n(6),b=n(4),y=n(20),k=n(7),E=function(e){function t(){return Object(o.a)(this,t),Object(g.a)(this,Object(b.a)(t).apply(this,arguments))}return Object(k.a)(t,e),Object(c.a)(t,[{key:"getCopy",value:function(){var e=new t(this.address);return e.eventLog=this.eventLog,e.selectStatements=Object(a.a)(this.selectStatements),e.joinClauses=Object(a.a)(this.joinClauses),e.groupBy=Object(a.a)(this.groupBy),e.fromBlockNumber=this.fromBlockNumber,e.toBlockNumber=this.toBlockNumber,e.limitSize=this.limitSize,e.whereClauses=Object(a.a)(this.whereClauses),e}},{key:"executeQuery",value:function(){var e=Object(i.a)(s.a.mark(function e(n,r){var i,o,c,u;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(y.a)(Object(b.a)(t.prototype),"executeQuery",this).call(this);case 3:return i=e.sent,e.abrupt("return",i);case 7:return e.prev=7,e.t0=e.catch(0),o=this.getCopy(),c=this.getCopy(),u=Math.floor((n+r)/2),o.fromBlock(n),o.toBlock(u-1),c.fromBlock(u),c.toBlock(r),e.t1=[],e.t2=a.a,e.next=20,o.executeQuery(n,u-1);case 20:return e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t5=a.a,e.next=25,c.executeQuery(u,r);case 25:return e.t6=e.sent,e.t7=(0,e.t5)(e.t6),e.abrupt("return",e.t1.concat.call(e.t1,e.t4,e.t7));case 28:case"end":return e.stop()}},e,this,[[0,7]])}));return function(t,n){return e.apply(this,arguments)}}()}]),t}(n(41).a),S=n(40),O=n(424),w=n(35),C=n(47),P=n(341);function T(e,t){return j.apply(this,arguments)}function j(){return(j=Object(i.a)(s.a.mark(function e(t,n){var a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===h.a?3:7;break;case 3:return e.next=5,q(n);case 5:return a=e.sent,e.abrupt("return",a.map(function(e){return{linkType:t,fromData:n,toData:e}}));case 7:return e.next=9,l.a.xanadu.getLinks(t,n);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function x(e,t,n){return N.apply(this,arguments)}function N(){return(N=Object(i.a)(s.a.mark(function e(t,n,a){var r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===h.a?3:8;break;case 3:return(r=new C.a(a)).fromData=n,e.next=7,r.fetchMetadata();case 7:return e.abrupt("return",r);case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function q(e){return M.apply(this,arguments)}function M(){return(M=Object(i.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.a.getJson(t);case 2:return n=e.sent,e.abrupt("return",Object(P.a)(n));case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}var D=function(e){function t(e,n,a,r){var s,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return Object(o.a)(this,t),(s=Object(g.a)(this,Object(b.a)(t).call(this,a,r,i))).linkType=e,s.fromData=n,s.isLoaded=!1,s}return Object(k.a)(t,e),Object(c.a)(t,[{key:"isDynamic",value:function(){return!0}},{key:"load",value:function(){var e=Object(i.a)(s.a.mark(function e(){var t,n,a,r,i=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:l.a.xanadu,!this.isRoot()){e.next=5;break}return e.next=4,this.loadRoot(t);case 4:return e.abrupt("return");case 5:return e.next=7,T(this.linkType,this.fromData);case 7:n=e.sent,e.t0=s.a.keys(n);case 9:if((e.t1=e.t0()).done){e.next=19;break}return a=e.t1.value,r=n[a],e.t2=this,e.next=15,x(this.linkType,this.fromData,r.toData);case 15:e.t3=e.sent,e.t2.addItem.call(e.t2,e.t3),e.next=9;break;case 19:this.isLoaded=!0;case 20:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loadRoot",value:function(){var e=Object(i.a)(s.a.mark(function e(){var n=this,a=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.length>0&&void 0!==a[0]?a[0]:l.a.xanadu,e.next=3,m(this.linkType);case 3:return e.sent.map(function(e){return new t(n.linkType,e.getId(),e.getName(),n)}).forEach(function(e){return n.addFolder(e)}),this.isLoaded=!0,e.abrupt("return",this);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),t}(O.a),A=n(31),R=S.k.XANADU,I=function(){function e(t){Object(o.a)(this,e),this.web3=t,this.contract=(new u.a).getContract(t),this.linkFolder=new D(h.a),this.sequencesCache=void 0}return Object(c.a)(e,[{key:"load",value:function(){return this.linkFolder.loadRoot(this)}},{key:"newLinks",value:function(){var e=Object(i.a)(s.a.mark(function e(t,n,a){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"getDataTypes",value:function(){var e=Object(i.a)(s.a.mark(function e(){var t;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new p.a(R.options.address).from(A.e).select("dataType").select("description"),e.next=3,t.executeQuery();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"getLinkTypes",value:function(){var e=Object(i.a)(s.a.mark(function e(){var t;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new p.a(R.options.address).from(A.p).select("linkType").select("description"),e.next=3,t.executeQuery();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"getLinks",value:function(){var e=Object(i.a)(s.a.mark(function e(t,n,a){var r,i,o,c,u,l;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.web3.eth.getBlockNumber();case 2:return r=e.sent,console.log("getLinks linkType=%s fromData=%s toData=%s",t,n,a),i=new E(R.options.address).from(A.o).select("fromData").select("toData").fromBlock(7636e3).toBlock(r).where("linkType",t),n&&i.where("fromData",n),a&&i.where("toData",a),e.next=9,i.executeQuery(7636e3,r);case 9:o=e.sent,c=[],u=function(e){var t=o[e].fromData;if(c.some(function(e){return e.fromData===t}))return"continue";c.push(o[e])},e.t0=s.a.keys(o);case 13:if((e.t1=e.t0()).done){e.next=20;break}if(l=e.t1.value,"continue"!==u(l)){e.next=18;break}return e.abrupt("continue",13);case 18:e.next=13;break;case 20:return console.log("query returned",c),e.abrupt("return",c);case 22:case"end":return e.stop()}},e,this)}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"loadGraph2",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:R.options.address;return new Promise(function(){var t=Object(i.a)(s.a.mark(function t(r,i){var o;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("address to use = "+a),t.t0=n,t.t1=a,t.next=5,l.a.getGuildsWithAccess();case 5:t.t2=t.sent,o={toData:t.t0,address:t.t1,guildIds:t.t2},console.log("load graph2",o),fetch("/graphQuery/",{method:"POST",body:JSON.stringify(o),headers:{Accept:"text/html","Content-Type":"text/html"}}).then(function(e){return e.json()}).then(function(t){var n=[];for(var a in t){var s={};s.toData=t[a].vertex.toData,s.fromData=t[a].vertex.fromData,s.adjacent=t[a].adjacentVertices.map(function(e){return e.fromData||e.toData}),s.linkType=e,n.push(s)}r(n)});case 9:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"loadGraph",value:function(){var e=Object(i.a)(s.a.mark(function e(t,n,r){var i,o,c,u,l,p,h,d,f,m,v,g,b,y=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=y.length>3&&void 0!==y[3]?y[3]:new Set,0!==(o=y.length>4&&void 0!==y[4]?y[4]:4)){e.next=4;break}return e.abrupt("return",[]);case 4:if(void 0===n){e.next=7;break}if(!i.has(n)){e.next=7;break}return e.abrupt("return",[]);case 7:if(void 0===r){e.next=10;break}if(!i.has(r)){e.next=10;break}return e.abrupt("return",[]);case 10:return e.next=12,this.getLinks(t,n,r);case 12:if(c=e.sent,u=[],void 0!==n&&(i.add(n),l=c.map(function(e){return e.toData}),u.push({fromData:n,adjacent:l})),void 0===r){e.next=21;break}if(!i.has(r)){e.next=18;break}return e.abrupt("return",[]);case 18:i.add(r),p=c.map(function(e){return e.fromData}),u.push({toData:r,adjacent:p});case 21:for(d in h=[],c)f=c[d],m=void 0===n?f.fromData:void 0,v=void 0===r?f.toData:void 0,h.push(this.loadGraph(t,m,v,i,o-1));return e.next=25,Promise.all(h);case 25:for(b in g=e.sent)u=[].concat(Object(a.a)(u),Object(a.a)(g[b]));return e.abrupt("return",u);case 28:case"end":return e.stop()}},e,this)}));return function(t,n,a){return e.apply(this,arguments)}}()}]),e}();t.a=I},1070:function(e,t,n){"use strict";var a=n(3),r=n.n(a),s=n(11),i=n(1),o=n(2),c=function(){function e(){Object(i.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"}],name:"new2DMapping",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"ipfsHash",type:"bytes32"}],name:"New2DMapping",type:"event"}],this.contractAddress="0x50ff08f58ba3d2cbeaa07326267332e41dc946aa"}return Object(o.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),u=n(31),l=n(93),p=n(35),h="X",d=function(){function e(t){if(Object(i.a)(this,e),t.length<=1)this.pivot=t[0];else{var n=this.getPivotAndDimension(t);this.pivot=n.pivot,this.dimension=n.dimension,this.range=n.range;var a=t.indexOf(this.pivot);t.splice(a,1);var r=this.getSubTreePoints(this.pivot,this.dimension,t);this.leftSubTree=new e(r.left),this.rightSubTree=new e(r.right)}}return Object(o.a)(e,[{key:"getSubTreePoints",value:function(e,t,n){var a=[],r=[],s=this.getValueForDimension(e,t);for(var i in n){var o=n[i],c=this.getValueForDimension(o,t);c<s?a.push(o):c>=s&&r.push(o)}return{left:a,right:r}}},{key:"getValueForDimension",value:function(e,t){return t===h?e.point[0]:e.point[1]}},{key:"getPivotAndDimension",value:function(e){var t=this.chooseDimension(e),n=t.dimension,a=(t.max+t.min)/2,r=void 0,s=1e4;for(var i in e){var o=e[i],c=n===h?Math.abs(o.point[0]-a):Math.abs(o.point[1]-a);c<s&&(r=o,s=c)}return{pivot:r,dimension:n,range:{min:t.min,max:t.max}}}},{key:"chooseDimension",value:function(e){var t=1e4,n=1e4,a=-1e4,r=-1e4;for(var s in e){var i=e[s].point[0],o=e[s].point[1];i<t&&(t=i),i>a&&(a=i),o<n&&(n=o),o>r&&(r=o)}return a-t>r-n?{dimension:h,min:t,max:a}:{dimension:"Y",min:n,max:r}}},{key:"getPointsInRange",value:function(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(void 0===this.pivot)return[];var s=this.pivot.point[0],i=this.pivot.point[1],o=[];return s>=e&&s<=n&&i>=t&&i<=a&&o.push(this.pivot),this.dimension==h?(s<=n&&e<=this.range.max&&void 0!==this.rightSubTree&&(o=o.concat(this.rightSubTree.getPointsInRange(e,t,n,a,r+1))),s>=e&&n>=this.range.min&&void 0!==this.leftSubTree&&(o=o.concat(this.leftSubTree.getPointsInRange(e,t,n,a,r+1)))):"Y"===this.dimension&&(i<=a&&t<=this.range.max&&void 0!==this.rightSubTree&&(o=o.concat(this.rightSubTree.getPointsInRange(e,t,n,a,r+1))),i>=t&&a>=this.range.min&&void 0!==this.leftSubTree&&(o=o.concat(this.leftSubTree.getPointsInRange(e,t,n,a,r+1)))),o}},{key:"size",value:function(){var e=1;return void 0!==this.leftSubTree&&(e+=this.leftSubTree.size()),void 0!==this.rightSubTree&&(e+=this.rightSubTree.size()),e}},{key:"inRange",value:function(e,t,n,a){return void 0!==this.range&&(this.dimension===h?e>=this.range.min&&e<=this.range.max:t>=this.range.min&&t<=this.range.max)}}]),e}(),f=new c,m=function(){function e(t){Object(i.a)(this,e),this.contract=f.getContract(t),this.loaded=!1}return Object(o.a)(e,[{key:"load",value:function(){var e=Object(s.a)(r.a.mark(function e(){var t,n,a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new l.a(this.contract.contractAddress).from(u.d).select("ipfsHash").executeQuery();case 2:if(0!==(t=e.sent).length){e.next=5;break}return e.abrupt("return");case 5:return n=t[t.length-1].ipfsHash,e.next=8,p.a.getJson(n);case 8:a=e.sent,this.points=a,this.pointsMap=this.getMap(a),console.log("constructing KD tree"),this.kdTree=new d(this.points),console.log("finished constructing KD tree size="),console.log(this.kdTree.size()),this.loaded=!0;case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getPointsInRange",value:function(e,t,n,a){var r=(new Date).getTime(),s=this.kdTree.getPointsInRange(e,t,n,a),i=(new Date).getTime();return console.log("finished getting points in "+(i-r)+" ms"),s}},{key:"getMap",value:function(e){var t={};for(var n in e){var a=e[n];t[a.path]=a}return t}},{key:"findSimilarSounds",value:function(e){var t=void 0;for(var n in this.points)this.points[n].path===e&&(t=this.points[n]);if(void 0===t)return console.log("no point"),[];var a=[];for(var r in this.points){var s=this.distance(t,this.points[r]);a.push({point:this.points[r],distance:s})}return a.sort(function(e,t){return e.distance-t.distance}),a.slice(0,100).map(function(e){return e.point.path})}},{key:"distance",value:function(e,t){var n=e.point[0],a=e.point[1],r=t.point[0],s=t.point[1];return Math.sqrt(Math.pow(r-n,2)+Math.pow(s-a,2))}}]),e}();t.a=m},1071:function(e,t,n){"use strict";var a=n(3),r=n.n(a),s=n(11),i=n(1),o=n(2),c=function(){function e(){Object(i.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"reasoningHash",type:"bytes32"}],name:"copyStrikeSample",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"newDesignatedAgent",type:"address"}],name:"switchDesignatedAgent",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"}],name:"takedownSample",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"reasoningHash",type:"bytes32"}],name:"SampleCopyStrike",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"}],name:"SampleTakenDown",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"agent",type:"address"}],name:"NewDesignatedAgent",type:"event"}],this.contractAddress="0xAd4752a6C01C2B25b6248bEB33B1B03f2BE9F9E7"}return Object(o.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),u=n(59),l=n(93),p=n(31),h=n(35),d=new c,f=function(){function e(t){Object(i.a)(this,e),this.web3=t,this.contract=d.getContract(t),this.contractAddress=d.contractAddress}return Object(o.a)(e,[{key:"getCopyStrikedSamples",value:function(){var e=Object(s.a)(r.a.mark(function e(){var t,n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new l.a(this.contractAddress).from(p.z).select("sampleHash").select("reasoningHash"),e.next=3,t.executeQuery();case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getTakenDownSamples",value:function(){var e=Object(s.a)(r.a.mark(function e(){var t,n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new l.a(this.contractAddress).from(p.F).select("sampleHash"),e.next=3,t.executeQuery();case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"copyStrikeSample",value:function(e,t,n){var a=this;return new Promise(function(){var i=Object(s.a)(r.a.mark(function s(i,o){var c,l,p;return r.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,a.web3.eth.getAccounts();case 2:return c=r.sent,l={reasoning:n,emailAddress:t},r.next=6,h.a.addJson(l,!0);case 6:p=r.sent,p=Object(u.b)(p),e=Object(u.b)(e),a.contract.methods.copyStrikeSample(e,p).send({from:c[0]},function(e,t){e?o():i()});case 10:case"end":return r.stop()}},s)}));return function(e,t){return i.apply(this,arguments)}}())}},{key:"takeDownSample",value:function(e){var t=this;return new Promise(function(){var n=Object(s.a)(r.a.mark(function n(a,s){var i;return r.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.web3.eth.getAccounts();case 2:i=n.sent,e=Object(u.b)(e),t.contract.methods.takedownSample(e).send({from:i[0]},function(e,t){e?s():a()});case 5:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}}]),e}();t.a=f},1072:function(e,t,n){"use strict";var a=n(3),r=n.n(a),s=n(11),i=n(1),o=n(2),c=n(432),u=n(62),l=n(40),p=n(41),h=n(31),d=n(35),f=n(37);var m=n(59),v=n(437),g=new c.a,b=function(){function e(t){Object(i.a)(this,e),this.web3=t,this.contract=g.getContract(t),this.contractAddress=g.contractAddress}return Object(o.a)(e,[{key:"sendMessage",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v.a,i=arguments.length>3?arguments[3]:void 0;return new Promise(function(){var o=Object(s.a)(r.a.mark(function s(o,c){var p,h,v;return r.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(void 0!==e){r.next=4;break}return r.next=3,f.a.getAccount();case 3:e=r.sent;case 4:return p={type:a,referenceHash:n,content:i},r.next=7,d.a.addJson(p,!0);case 7:h=r.sent,v=Object(m.b)(h),n=null!==n?Object(m.b)(n):t.web3.utils.padLeft("0x0",64),new u.a(l.g,"sendPublicMessage",[e,n,v]).execute().then(function(){o(h)});case 11:case"end":return r.stop()}},s)}));return function(e,t){return o.apply(this,arguments)}}())}},{key:"getMessages",value:function(){var e=Object(s.a)(r.a.mark(function e(){var t,n,a,s,i=arguments;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:null,n=i.length>1?i[1]:void 0,e.next=4,this.getQuery(t,n);case 4:return a=e.sent,e.next=7,a.executeQuery();case 7:return s=e.sent,e.abrupt("return",s);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"watchForNewMessages",value:function(){var e=Object(s.a)(r.a.mark(function e(){var t,n,a,s=arguments;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:null,n=s.length>1?s[1]:void 0,a=s.length>2?s[2]:void 0,e.next=5,this.getQuery(t,n);case 5:e.sent.watchQuery(a);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getQuery",value:function(){var e=Object(s.a)(r.a.mark(function e(){var t,n,a,s=arguments;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:null,n=s.length>1?s[1]:void 0,a=new p.a(this.contractAddress).from(h.y).select("fromUser").select("referenceHash").select("messageHash").where("referenceHash",t),n&&a.where("toUser",n),e.abrupt("return",a);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=b},1074:function(e,t,n){e.exports=n(2574)},1078:function(e,t,n){},111:function(e,t,n){"use strict";(function(e){var a=n(1),r=n(2),s=(n(51),n(13)),i=n.n(s),o=n(35),c=(n(16),function(){function t(e,n){Object(a.a)(this,t),this.onSoundUploaded=n,this.numChannels=e,this.soundIdCounter=0}return Object(r.a)(t,[{key:"exportToWAV",value:function(t,n){new FormData;var a=new Worker("/recorderWorker.js");a.postMessage({command:"init",config:{sampleRate:i.a.context.sampleRate,numChannels:this.numChannels}}),a.onmessage=function(t){var a,r=t.data,s=new FileReader;s.onload=function(){a=this.result,n(new e(a))},s.readAsArrayBuffer(r)},a.postMessage({command:"record",buffer:t}),a.postMessage({command:"exportWAV",type:"audio/wav"})}},{key:"uploadBufferToIpfs",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2?arguments[2]:void 0;return new Promise(function(r,s){new FormData;var c=t,u=new Worker("/recorderWorker.js");console.log("buffer = "),console.log(e),u.postMessage({command:"init",config:{sampleRate:i.a.context.sampleRate,numChannels:t.numChannels}});new Date;if(u.onmessage=function(e){var t=this,s=e.data;console.log("adding blob to ipfs!"),o.a.addBlob(s).then(function(e){n&&c.onSoundUploaded(t.soundIdCounter++,e,a),r(e)})},n)u.postMessage({command:"record",buffer:e});else{for(var l=[],p=0;p<e.numberOfChannels;p++)l.push(e.getChannelData(p));u.postMessage({command:"record",buffer:l})}u.postMessage({command:"exportWAV",type:"audio/wav"})})}},{key:"uploadVideoBlob",value:function(e,t,n,a,r){var s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];console.log("buffer = "),console.log(e);new FormData;var c=this,u=new Worker("/recorderWorker.js");u.postMessage({command:"init",config:{sampleRate:i.a.context.sampleRate,numChannels:this.numChannels}});new Date;u.onmessage=function(e){var t=e.data;o.a.addBlob(t).then(function(e){s?c.onSoundUploaded(void 0,e,r):c.onSoundUploaded(r,e,r)})},u.postMessage({command:"record",buffer:e}),u.postMessage({command:"exportWAV",type:"audio/wav"})}}]),t}());t.a=c}).call(this,n(15).Buffer)},1124:function(e,t){},1126:function(e,t){},1215:function(e,t){},1280:function(e,t){},1416:function(e,t){},1432:function(e,t){},1434:function(e,t){},1446:function(e,t){},1448:function(e,t){},1455:function(e,t){},1457:function(e,t){},1462:function(e,t){},1463:function(e,t){},1476:function(e,t){},1478:function(e,t){},1485:function(e,t){},1487:function(e,t){},1493:function(e,t){},1499:function(e,t){},150:function(e,t,n){"use strict";n.d(t,"b",function(){return o}),n.d(t,"a",function(){return p});var a=n(43),r=n.n(a),s="undefined"!==typeof window.web3?new r.a(window.web3.currentProvider):new r.a(new r.a.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),i={A:"a","A#":"A",B:"b",C:"c","C#":"C",D:"d","D#":"D",E:"e",F:"f","F#":"F",G:"g","G#":"G"},o={A:s.utils.asciiToHex("a"),"A#":s.utils.asciiToHex("A"),B:s.utils.asciiToHex("b"),C:s.utils.asciiToHex("c"),"C#":s.utils.asciiToHex("C"),D:s.utils.asciiToHex("d"),"D#":s.utils.asciiToHex("D"),E:s.utils.asciiToHex("e"),F:s.utils.asciiToHex("f"),"F#":s.utils.asciiToHex("F"),G:s.utils.asciiToHex("g"),"G#":s.utils.asciiToHex("G")},c={};for(var u in o)c[o[u]]=u;for(var l in c={},i)c[i[l]]=l;var p=c},1501:function(e,t){},1509:function(e,t){},1511:function(e,t){},1524:function(e,t){},1526:function(e,t){},16:function(e,t,n){"use strict";(function(e){var a=n(12),r=n(17),s=n(3),i=n.n(s),o=n(11),c=n(1),u=n(2),l=n(43),p=n.n(l),h=n(1070),d=n(37),f=n(1041),m=n(1068),v=(n(599),n(62)),g=n(40),b=n(1045),y=n(195),k=n(1046),E=n(1047),S=n(601),O=n(1048),w=n(1072),C=n(1049),P=n(1050),T=n(1051),j=n(438),x=n(1052),N=n(1053),q=n(1054),M=n(93),D=n(41),A=n(31),R=n(600),I=n(1071),L=n(1055),F=new y.a;console.log("initialized contract wiht address = "+F.contractAddress);var V=new E.a,B=new C.a,U=new P.a,H=new T.a,J=new b.a,G=n(66),z="undefined"!==typeof window.web3,_=z?new p.a(window.web3.currentProvider):new p.a(new p.a.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c"));function W(e){for(var t=e.map(function(e){return Y(e.ipfsHash)}),n=_.utils.padLeft("0x0",64),a=t.length;a<16;a++)t.push(n);for(var r=[],s=[],i=[],o=0;o<16;o++)if(void 0!==e[o]){var c=e[o].videoId;void 0===c?i.push(n):i.push(_.utils.fromAscii(c));var u=e[o].coverArt;void 0===u?r.push(n):r.push(Y(u)),void 0===e[o].discogsId?s.push(0):s.push(e[o].discogsId)}else r.push(n),s.push(0),i.push(n);for(var l=e.map(function(e){return _.utils.fromAscii(e.title).slice(0,66)}),p=l.length;p<16;p++)l.push(n);for(var h=e.map(function(e){return e.tags.map(function(e){return _.utils.fromAscii(e)})}),d=h.length;d<16;d++)h.push([n,n,n,n]);for(var f=e.map(function(e){return e.styles.map(function(e){return null===e?n:_.utils.fromAscii(e)})}),m=f.length;m<16;m++)f.push([n,n,n,n]);for(var v=e.map(function(e){return null===e.country?n:_.utils.fromAscii(e.country)}),g=v.length;g<16;g++)v.push(n);for(var b=e.map(function(e){return null===e.year||void 0===e.year?0:e.year}),y=b.length;y<16;y++)b.push(0);return{sampleHashes:t,tags:h,titles:l,styles:f,years:b,countries:v,discogsIds:s,coverArts:r,videoIds:i}}function K(e){for(var t=_.utils.fromAscii(e),n=t.length;n<=65;n++)t+="0";return t}function Y(e){var t=G.decode(e).toString("hex").replace(/^1220/,"");return 64!=t.length?null:"0x"+t}var Q=new(function(){function e(){Object(c.a)(this,e),void 0!==_&&(this.web3=_,z&&window.web3.currentProvider.enable(),_.eth.net.isListening()&&(this.contract=new _.eth.Contract(F.abi,F.contractAddress),this.slicesContract=new _.eth.Contract(V.abi,V.contractAddress),this.favoritesContract=new _.eth.Contract(B.abi,B.contractAddress),this.slicesContractAddress=this.slicesContract.options.address,this.ethAddress=this.contract.options.address,this.favoritesContractAddress=this.favoritesContract.options.address,this.sequencesContract=new _.eth.Contract(H.abi,H.contractAddress),this.sequencesContractAddress=this.sequencesContract.options.address,this.indexContract=new _.eth.Contract(U.abi,U.contractAddress),this.indexContractAddress=this.indexContract.options.address,this.multiSamplesContract=J.getContract(_)),this.cachedTags=void 0,this.users=new j.a(_),this.crypto=new S.a(this),this.encryption=new O.a(_,this.crypto),this.guilds=new x.a(_,this.crypto,this.encryption),this.tokenizedSequences=new k.a(_),this.guildSequences=new q.a(_,this.guilds,this.encryption,this.crypto),this.samples2D=new h.a(_),this.messaging=new w.a(_),this.dmca=new I.a(_),this.folders=new f.a(_),this.resample=new L.a(_),this.presets=new R.a(_,this.crypto,this.guilds),this.xanadu=new m.a(_),this.guildSamples=new N.a(_))}return Object(u.a)(e,[{key:"postUserId",value:function(){var e=Object(o.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"isMetamaskInstalled",value:function(){return z}},{key:"getUser",value:function(){return new Promise(function(){var e=Object(o.a)(i.a.mark(function e(t,n){var a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!z){e.next=7;break}return e.next=3,_.eth.getAccounts();case 3:a=e.sent,t(a[0]),e.next=8;break;case 7:t(void 0);case 8:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}())}},{key:"getSoundsWithDiscogs",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new D.a(this.ethAddress).from(A.f).select("sampleHash").where("discogsId",t).where("guildId",this.guildId),e.next=3,n.executeQuery();case 3:return a=e.sent,e.abrupt("return",a.map(function(e){return e.sampleHash}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCoverArtForDiscogs",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new D.a(this.ethAddress).from(A.f).select("coverArtHash").where("discogsId",t),e.next=3,n.executeQuery();case 3:return a=e.sent,e.abrupt("return",a[0]);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCachedTags",value:function(e,t){return e>this.cachedTags.length?[]:e+t>this.cachedTags.length?this.cachedTags.slice(e):this.cachedTags.slice(e,e+t)}},{key:"searchTags",value:function(e){var t=this;return new Promise(function(n,a){void 0!==t.cachedTags?(e=e.toLowerCase(),n(t.cachedTags.filter(function(t){return t.toLowerCase().includes(e)}))):n([])})}},{key:"getTagsForSound",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new D.a(this.ethAddress).from(A.E).select("tag").where("ipfsHash",t).executeQuery();case 2:return n=e.sent,e.abrupt("return",n.map(function(e){return e.tag}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getYearsForSound",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new D.a(this.ethAddress).from(A.H).select("year").where("ipfsHash",t).executeQuery();case 2:return n=e.sent,e.abrupt("return",n.map(function(e){return e.year}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getVideoIdForSound",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new D.a(this.ethAddress).from(A.I).select("videoId").where("ipfsHash",t).executeQuery();case 2:return n=e.sent,e.abrupt("return",n.map(function(e){return e.videoId})[0]);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getTitleForSound",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new D.a(this.ethAddress).from(A.B).select("title").where("ipfsHash",t).executeQuery();case 2:return n=(n=e.sent).filter(function(e){return""!==e.title})[0],e.abrupt("return",void 0!==n?n.title:void 0);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUserNameForSound",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new D.a(this.ethAddress).from(A.B).select("user").where("ipfsHash",t).executeQuery();case 2:if(void 0===(n=(n=e.sent).map(function(e){return e.user})[0])){e.next=9;break}return console.log("user = "+n),e.next=8,this.users.getUserName(n);case 8:return e.abrupt("return",e.sent);case 9:return e.abrupt("return",void 0);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCoverArtForSound",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new D.a(this.ethAddress).from(A.f).select("coverArtHash").where("sampleHash",t).executeQuery();case 2:return n=(n=e.sent).filter(function(e){return""!==e.coverArtHash})[0],e.abrupt("return",void 0!==n?n.coverArtHash:void 0);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getFavoritesForSound",value:function(e){var t=this;return console.log("getFavorites for sound = "+e),new Promise(function(){var n=Object(o.a)(i.a.mark(function n(a,r){var s,o,c,u,l,p,h,d;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,_.eth.getAccounts();case 2:if(s=n.sent,z&&0!==s.length){n.next=6;break}return a({userFavorited:[],othersFavorited:[]}),n.abrupt("return");case 6:return n.next=8,new D.a(t.favoritesContractAddress).from(A.C).select("user").where("sampleHash",e).executeQuery();case 8:return o=n.sent,n.next=11,new D.a(t.favoritesContractAddress).from(A.G).select("user").where("sampleHash",e).executeQuery();case 11:c=n.sent,u=s[0].toLowerCase(),l=o.filter(function(e){return e.user===u}),p=o.filter(function(e){return e.user!==u}),h=c.filter(function(e){return e.user===u}),d=c.filter(function(e){return e.user!==u}),a({userFavorited:l.length-h.length,othersFavorited:p.length-d.length});case 18:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getOverallVotedRankings",value:function(){var e=this;return new Promise(function(){var t=Object(o.a)(i.a.mark(function t(n,a){var r,s,o;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(z){t.next=3;break}return n([]),t.abrupt("return");case 3:return t.next=5,new D.a(e.favoritesContractAddress).from(A.C).select("sampleHash").executeQuery();case 5:return r=t.sent,t.next=8,new D.a(e.favoritesContractAddress).from(A.G).select("sampleHash").executeQuery();case 8:s=t.sent,o={},r.forEach(function(e){var t=e.sampleHash;t in o?o[t]++:o[t]=1}),s.forEach(function(e){var t=e.sampleHash;t in o?o[t]--:o[t]=-1}),n(o);case 13:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getFavoritesForUser",value:function(){var e=this;return new Promise(function(){var t=Object(o.a)(i.a.mark(function t(n,a){var r,s,o,c,u,l,p,h,d,f,m,v,g;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(z){t.next=3;break}return n([]),t.abrupt("return");case 3:return t.next=5,_.eth.getAccounts();case 5:if(void 0!==(r=t.sent)){t.next=9;break}return n([]),t.abrupt("return");case 9:return s=r[0].toLowerCase(),t.next=12,new D.a(e.favoritesContractAddress).from(A.C).select("sampleHash").where("user",s).executeQuery();case 12:return o=t.sent,t.next=15,new D.a(e.favoritesContractAddress).from(A.G).select("sampleHash").where("user",s).executeQuery();case 15:for(d in c=t.sent,u=o.map(function(e){return e.sampleHash}),l=c.map(function(e){return e.sampleHash}),p={},h={},u)u[d]in p?p[u[d]]++:p[u[d]]=1;for(f in l)l[f]in h?h[l[f]]++:h[l[f]]=1;for(v in m=[],p)g=p[v],v in h&&(g-=h[v]),g>0&&m.push(v);n(m);case 25:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getSoundsWithVideo",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new D.a(this.ethAddress).from(A.I).select("ipfsHash").where("videoId",t).where("guildId",this.guildId).executeQuery();case 2:return n=e.sent,e.abrupt("return",n.map(function(e){return e.ipfsHash}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithTag",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,a=void 0,this.cache.useMonth&&(n=this.cache.toBlock,a=this.cache.fromBlock),e.abrupt("return",this.getSoundsWithField("tag",t,A.E,!1,a,n));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithStyle",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,a=void 0,this.cache.useMonth&&(n=this.cache.toBlock,a=this.cache.fromBlock),e.abrupt("return",this.getSoundsWithField("style",t,A.D,!1,a,n));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithCountry",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,a=void 0,this.cache.useMonth&&(n=this.cache.toBlock,a=this.cache.fromBlock),e.abrupt("return",this.getSoundsWithField("country",t,A.A,!1,a,n));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithYear",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,a=void 0,this.cache.useMonth&&(n=this.cache.toBlock,a=this.cache.fromBlock),e.abrupt("return",this.getSoundsWithField("year",t,A.H,!1,a,n));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithFieldParallel",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n,a){var r,s,o,c,u,l,p,h,d,f,m,v=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=v.length>3&&void 0!==v[3]&&v[3],s=v.length>4?v[4]:void 0,o=v.length>5?v[5]:void 0,!(s+1>=o)){e.next=5;break}return e.abrupt("return",[]);case 5:for(8,c=o-s,u=[],l=1;l<=8;l++)p=s+Math.floor((l-1)*c/8),h=s+Math.floor(l*c/8),u.push(this.getSoundsWithField(t,n,a,r,p,h));return e.next=11,Promise.all(u);case 11:for(m in d=e.sent,f=[],d)f=f.concat(d[m]);return e.abrupt("return",f);case 15:case"end":return e.stop()}},e,this)}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"getSoundsWithField",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n,a){var r,s,o,c=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>3&&void 0!==c[3]&&c[3],s=c.length>4&&void 0!==c[4]?c[4]:37e5,o=c.length>5?c[5]:void 0,e.prev=3,e.next=6,this.getSoundsWithFieldHelper(t,n,a,r,s,o);case 6:return e.abrupt("return",e.sent);case 9:return e.prev=9,e.t0=e.catch(3),e.next=13,this.getSoundsWithFieldParallel(t,n,a,r,s,o);case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}},e,this,[[3,9]])}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"getGuildsWithAccess",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t,n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((new Date).getTime(),0===this.guildId){e.next=3;break}return e.abrupt("return",[this.guildId]);case 3:return e.next=5,this.guilds.getGuildsWithAccess();case 5:t=e.sent,e.t0=i.a.keys(t);case 7:if((e.t1=e.t0()).done){e.next=13;break}return n=e.t1.value,e.next=11,this.guilds.getGuildKey(t[n]);case 11:e.next=7;break;case 13:return(new Date).getTime(),e.abrupt("return",[].concat(Object(r.a)(t),[0]));case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getSoundsWithFieldHelper",value:function(e,t,n){var a=this,r=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]?arguments[4]:37e5),s=arguments.length>5?arguments[5]:void 0;r&&_.utils.toHex(r);return s&&_.utils.toHex(s),new Promise(function(){var c=Object(o.a)(i.a.mark(function o(c,u){var l,p,h;return i.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,a.getGuildsWithAccess();case 2:return l=i.sent,p=new D.a(a.ethAddress).from(n).select("ipfsHash").where(e,t).whereIn("guildId",l),s&&p.toBlock(s),r&&p.fromBlock(r),i.next=8,p.executeQuery();case 8:h=i.sent,c(h.map(function(e){return e.ipfsHash}));case 10:case"end":return i.stop()}},o)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"getSoundsFromBlock",value:function(e,t){var n=this;return new Promise(function(){var a=Object(o.a)(i.a.mark(function a(r,s){var o,c;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(a.t0=new D.a(n.ethAddress).from(A.B).select("ipfsHash").select("guildId").fromBlock(e).toBlock(t).limit(400),!window.installation){a.next=5;break}a.t1=[0],a.next=8;break;case 5:return a.next=7,n.getGuildsWithAccess();case 7:a.t1=a.sent;case 8:return a.t2=a.t1,o=a.t0.whereIn.call(a.t0,"guildId",a.t2),a.next=12,o.executeQuery(!0);case 12:c=a.sent,r(c.map(function(e){return e.ipfsHash}));case 14:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"getBlockDate",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.eth.getBlock(t);case 2:if(null!==(n=e.sent)){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",new Date(1e3*n.timestamp));case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getBlockNumberAtDate",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,a,r,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.eth.getBlockNumber();case 2:return n=e.sent,a=500,e.next=6,_.eth.getBlock(n);case 6:r=e.sent,s=new Date(1e3*r.timestamp);case 8:if(!(t.getTime()<s.getTime())){e.next=16;break}return n-=a,e.next=12,_.eth.getBlock(n);case 12:r=e.sent,s=new Date(1e3*r.timestamp),e.next=8;break;case 16:return e.abrupt("return",n);case 17:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllSounds",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){var a,r,s,o,c;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return 5e4,a=void 0,r=void 0,this.cache.useMonthly&&(a=this.cache.toBlock,r=this.cache.fromBlock),s=[],o=new Date,e.next=8,this.getSoundsFromBlock(r,a);case 8:return s=e.sent,c=new Date,c.getTime()-o.getTime(),e.abrupt("return",s);case 12:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getOldSequence",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(o.a)(i.a.mark(function e(a,r){var s,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=new M.a(n.ethAddress).select("user").select("ipfsHash").select("title").where("ipfsHash",t).from(A.J),e.next=3,s.executeQuery();case 3:o=e.sent,a(o.map(function(e){return{user:e.user,previousSequence:"0x0",newSequence:e.ipfsHash,diff:"0x0",title:e.title,blockNumber:e.blockNumber,edits:0}}));case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPrivateSequences",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){var a,r,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.getAccount();case 2:if(void 0!==(a=e.sent)){e.next=5;break}return e.abrupt("return",[]);case 5:return e.next=7,this.encryption.getEncryptedSequenceIfAny(void 0,a,t,n);case 7:return r=e.sent,e.next=10,this.encryption.getSequencesSharedWithUser(void 0,t,n);case 10:return s=e.sent,e.abrupt("return",void 0===r?[]:r.concat(s));case 12:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNewSequence",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(o.a)(i.a.mark(function e(r,s){var o,c;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=new M.a(n.sequencesContractAddress).select("user").select("previousSequence").select("newSequence").select("diff").select("title").where("newSequence",t).from(A.K),e.next=3,o.executeQuery();case 3:c=e.sent,r(c.map(function(e){return Object(a.a)({},e,{edits:0})}));case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getTokenizedSequence",value:function(){var e=Object(o.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.tokenizedSequences.getSequence(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSequence",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(o.a)(i.a.mark(function e(a,r){var s,o,c;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getTokenizedSequence(t);case 2:if(!((s=e.sent).length>0)){e.next=6;break}return a(s[0]),e.abrupt("return");case 6:return e.next=8,n.getOldSequence(t);case 8:if(!((o=e.sent).length>0)){e.next=12;break}return a(o[0]),e.abrupt("return");case 12:return e.next=14,n.getNewSequence(t);case 14:if(!((c=e.sent).length>0)){e.next=18;break}return a(c[0]),e.abrupt("return");case 18:a("");case 19:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"favoriteSound",value:function(e){var t=this;return new Promise(function(){var n=Object(o.a)(i.a.mark(function n(a,r){var s;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(z){n.next=3;break}return a(),n.abrupt("return");case 3:return n.next=5,_.eth.getAccounts();case 5:s=n.sent,e=Y(e),t.favoritesContract.methods.favoriteSample(e).send({from:s[0]},function(e,t){e?r(e):a(t)});case 8:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"unfavoriteSound",value:function(e){var t=this;return new Promise(function(){var n=Object(o.a)(i.a.mark(function n(a,r){var s;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return z||a(),n.next=3,_.eth.getAccounts();case 3:s=n.sent,e=Y(e),t.favoritesContract.methods.unfavoriteSample(e).send({from:s[0]},function(e,t){e?r(e):a(t)});case 6:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"saveNewSequence",value:function(e,t,n,a){var r=this;return new Promise(function(){var s=Object(o.a)(i.a.mark(function s(o,c){return i.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:z||o(),r.tokenizedSequences.saveNewSequence(e,t,n,a);case 2:case"end":return s.stop()}},s)}));return function(e,t){return s.apply(this,arguments)}}())}},{key:"getNewSequences",value:function(e,t,n){var r=this;!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new Promise(function(){var s=Object(o.a)(i.a.mark(function s(o,c){var u,l;return i.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return u=new M.a(r.sequencesContractAddress).select("user").select("previousSequence").select("newSequence").select("diff").select("title").fromBlock(t).toBlock(n).from(A.K),void 0!==e&&u.where("user",e),s.prev=2,s.next=5,u.executeQuery();case 5:(l=s.sent).reverse(),l.sort(function(e,t){return t.blockNumber-e.blockNumber}),o(l.map(function(e){return Object(a.a)({},e,{edits:0})})),s.next=14;break;case 11:s.prev=11,s.t0=s.catch(2),o([]);case 14:case"end":return s.stop()}},s,null,[[2,11]])}));return function(e,t){return s.apply(this,arguments)}}())}},{key:"getOldSequences",value:function(e,t,n){var a=this;return new Promise(function(){var r=Object(o.a)(i.a.mark(function r(s,o){var c,u;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return c=new M.a(a.ethAddress).select("user").select("ipfsHash").fromBlock(t).toBlock(n).select("title").from(A.J),void 0!==e&&c.where("user",e),r.prev=2,r.next=5,c.executeQuery();case 5:(u=r.sent).reverse(),u=u.map(function(e){return{user:e.user,previousSequence:"0x0",newSequence:e.ipfsHash,diff:"0x0",title:e.title,blockNumber:e.blockNumber,edits:0}}),s(u),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(2),s([]);case 14:case"end":return r.stop()}},r,null,[[2,11]])}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"getUser",value:function(){var e=Object(o.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.eth.getAccounts();case 2:if(void 0!==(t=e.sent)&&0!=t.length){e.next=7;break}return e.abrupt("return",void 0);case 7:return e.abrupt("return",t[0]);case 8:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"getSequences",value:function(e,t,n){var a=this;return new Promise(function(){var t=Object(o.a)(i.a.mark(function t(n,r){var s,o;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.tokenizedSequences.getSequences(e);case 2:return t.sent,t.next=5,a.getNewSequences(e);case 5:return s=t.sent,t.next=8,a.getOldSequences(e);case 8:o=t.sent,n(s.concat(o));case 10:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getHeadSequence",value:function(e,t){return t in e?this.getHeadSequence(e,e[t]):t}},{key:"collapseAllSequences",value:function(e){var t=this,n=new Set,r=[],s={};return e.forEach(function(i){if("0x0"!==i.previousSequence&&i.previousSequence!==i.newSequence&&(n.add(i.previousSequence),s[i.previousSequence]=i.newSequence),!n.has(i.newSequence)){var o=t.getEditsForSequence(i.newSequence,e);r.push(Object(a.a)({},i,{edits:o.length-1}))}}),r}},{key:"getEditsForSequence",value:function(e,t){for(var n=[],a=this.getPreviousSequence(e,t);void 0!==a;){n.push(a);var r=this.getPreviousSequence(a.previousSequence,t);if(void 0===r||r.newSequence===a.newSequence)break;a=r}return n}},{key:"getPreviousSequence",value:function(e,t){var n=void 0;for(var a in t)t[a].newSequence===e&&(n=t[a]);return n}},{key:"tagSample",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(o.a)(i.a.mark(function e(a,r){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=Y(t),n=K(n),new v.a(g.e,"setSampleTag",[t,n]).execute().then(function(){return a()});case 3:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"newSampleWithMetadata",value:function(){var e=Object(o.a)(i.a.mark(function e(t,n,a,r,s,c,u){var l,p=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=p.length>7&&void 0!==p[7]?p[7]:this.guildId,e.abrupt("return",new Promise(function(){var e=Object(o.a)(i.a.mark(function e(o,p){var h,d;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(h=_.utils.padLeft("0x0",64),void 0===r&&(r=[]),r.length<4)for(d=r.length;d<4;d++)r.push(null);r=r.map(function(e){return null===e?h:_.utils.fromAscii(e)}),s=s.map(function(e){return null===e?h:_.utils.fromAscii(e)}),c=null===c?h:_.utils.fromAscii(c),a=null===a?h:_.utils.fromAscii(a),z||o(),t=Y(t),new v.a(g.e,"newSampleWithMetadata",[t,n,a,r,s,c,null===u?0:u,0,h,l]).execute().then(function(){return o()});case 10:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e,this)}));return function(t,n,a,r,s,i,o){return e.apply(this,arguments)}}()},{key:"splitArray",value:function(e,t){for(var n=[],a=0;a<e.length;a+=t)n.push(e.slice(a,a+t));return n}},{key:"newEncryptedSamples",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,a,r=this,s=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:this.guildId,a=s.length>2?s[2]:void 0,e.abrupt("return",new Promise(function(){var e=Object(o.a)(i.a.mark(function e(s,o){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r.splitArray(t,16).forEach(function(e){return r.newEncryptedSamples16(e,n,a)});case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"newEncryptedSamples16",value:function(e,t,n){return new Promise(function(){var a=Object(o.a)(i.a.mark(function a(r,s){var o;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:o=W(e),new v.a(g.e,"newEncryptedSamples",[o.sampleHashes,o.titles,o.videoIds,o.coverArts,o.discogsIds,o.tags,o.styles,o.countries,o.years,t,n.convertForEthereum(),n.getPublicKeyAsBytes32()]).execute().then(function(){return r()});case 2:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"newSamplesWithMetadata",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,a=this,r=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:this.guildId,e.abrupt("return",new Promise(function(){var e=Object(o.a)(i.a.mark(function e(r,s){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.splitArray(t,16).forEach(function(e){return a.newSamplesWithMetadata16(e,n)});case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"newSamplesWithMetadata16",value:function(){var e=Object(o.a)(i.a.mark(function e(t){var n,a=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:this.guildId,e.abrupt("return",new Promise(function(){var e=Object(o.a)(i.a.mark(function e(a,r){var s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s=W(t),new v.a(g.e,"newSamplesWithMetadata",[s.sampleHashes,s.titles,s.videoIds,s.coverArts,s.discogsIds,s.tags,s.styles,s.countries,s.years,n]).execute().then(function(){return a()});case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"guildId",get:function(){if(void 0===this.store)return 0;var e=this.store.getState().guilds.selectedGuild;return e?e.guildId:0}}]),e}());console.log("initialized ethereum"),t.a=Q}).call(this,n(15).Buffer)},165:function(e,t,n){"use strict";var a=n(3),r=n.n(a),s=n(17),i=n(11),o=n(1),c=n(2),u=n(134),l=n.n(u),p=n(135),h=n.n(p),d=16384,f=256,m={name:"AES-CTR",counter:new h.a.Counter(5)._counter,length:64};function v(e,t){return g.apply(this,arguments)}function g(){return(g=Object(i.a)(r.a.mark(function e(t,n){var a,s,i;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.length<d)){e.next=4;break}return e.next=3,k(t,n);case 3:return e.abrupt("return",e.sent);case 4:return a=y(t),e.next=7,k(a,n);case 7:return s=e.sent,i=b(t,new Uint8Array(s)),e.abrupt("return",i);case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function b(e,t){for(var n=Math.ceil(d/f),a=Math.floor(e.length/f),r=0;r<f;r++){var s=r*a,i=r*n;e.set(t.subarray(i,i+n),s)}return e}function y(e){for(var t=Math.ceil(d/f),n=Math.floor(e.length/f),a=new Uint8Array(d),r=0;r<f;r++){var s=r*n;a.set(e.subarray(s,s+t),r*t)}return a}function k(e,t){return E.apply(this,arguments)}function E(){return(E=Object(i.a)(r.a.mark(function e(t,n){var a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.importKey("raw",new Uint8Array(n).buffer,{name:"AES-CTR"},!1,["encrypt","decrypt"]);case 2:return a=e.sent,e.next=5,window.crypto.subtle.encrypt(m,a,new Uint8Array(t));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function S(e,t){return O.apply(this,arguments)}function O(){return(O=Object(i.a)(r.a.mark(function e(t,n){var a,s,i,o;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.length<d)){e.next=5;break}return e.next=3,w(t,n);case 3:return a=e.sent,e.abrupt("return",new Uint8Array(a));case 5:return s=y(t),e.t0=Uint8Array,e.next=9,w(s,n);case 9:return e.t1=e.sent,i=new e.t0(e.t1),o=b(t,i),e.abrupt("return",o);case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}function w(e,t){return C.apply(this,arguments)}function C(){return(C=Object(i.a)(r.a.mark(function e(t,n){var a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.importKey("raw",new Uint8Array(n).buffer,{name:"AES-CTR"},!1,["decrypt"]);case 2:return a=e.sent,e.next=5,window.crypto.subtle.decrypt(m,a,t);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}var P=n(16);function T(e,t){for(var n=Math.ceil(e.length/256),a=Object(s.a)(t),r=void 0,i=0;i<256;i++){var o=i*n,c=(i+a[i%a.length])%256*n,u=e.subarray(o,o+n);r=Object(s.a)(e.subarray(c,c+n)),c+n>e.length||o+n>e.length||(e.set(u,c),e.set(r,o))}return e}function j(e,t){for(var n=Math.ceil(e.length/256),a=Object(s.a)(t),r=void 0,i=255;i>=0;i--){var o=i*n,c=(i+a[i%a.length])%256*n;if(!(o+n>e.length||c+n>e.length)){var u=e.subarray(o,o+n);r=new Uint8Array(e.subarray(c,c+n)),e.set(u,c),e.set(r,o)}}return e}var x=n(197),N=(new h.a.Counter(5)._counter,function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.a.generateAESKey();Object(o.a)(this,e),this.contentKey="string"===typeof t?h.a.utils.hex.toBytes(t):t,this.publicKey=void 0}return Object(c.a)(e,[{key:"encryptKey",value:function(e){this.publicKey=e;var t=h.a.utils.hex.fromBytes(this.contentKey),n=l.a.encrypt(t,e).cipher,a=P.a.web3.utils.toHex(n);this.encryptedContentKey=a,this.eck=n}},{key:"convertForEthereum",value:function(){return Object(x.a)(this.encryptedContentKey)}},{key:"encryptContent",value:function(){var e=Object(i.a)(r.a.mark(function e(t){var n,a,i,o,c,u,l,p=arguments;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=p.length>1&&void 0!==p[1]&&p[1],void 0!==t){e.next=3;break}return e.abrupt("return","");case 3:if(a=new Uint8Array(this.contentKey).buffer,i=n?t:h.a.utils.utf8.toBytes(t),o=n?T(i,new Uint8Array(this.contentKey)):i,!n){e.next=13;break}return e.next=9,v(o,a);case 9:return c=e.sent,e.abrupt("return",c);case 13:return e.next=15,k(i,this.contentKey);case 15:return u=e.sent,l=h.a.utils.hex.fromBytes(Object(s.a)(new Uint8Array(u))),e.abrupt("return",l);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"decryptContent",value:function(e){var t=this;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?new Promise(function(){var n=Object(i.a)(r.a.mark(function n(a,s){var i;return r.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,S(e,t.contentKey);case 2:i=j(i=n.sent,new Uint8Array(t.contentKey)),a(i);case 5:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}()):new Promise(function(){var n=Object(i.a)(r.a.mark(function n(a,i){var o,c,u;return r.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o=h.a.utils.hex.toBytes(e),n.next=3,w(new Uint8Array(o),t.contentKey);case 3:c=n.sent,u=h.a.utils.utf8.fromBytes(Object(s.a)(new Uint8Array(c))),a(u);case 6:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getPublicKeyAsBytes32",value:function(){var e=P.a.web3.utils.toHex(this.publicKey);return Object(x.a)(e)}}]),e}());t.a=N},166:function(e,t,n){"use strict";function a(e){for(var t=e.length-1;t>=0;t--)if("0"!==e.slice(t,t+1))return e.slice(0,t+1)}function r(e){for(var t=0;t<e.length;t++)if("0"!==e.slice(t,t+1))return e.slice(t)}n.d(t,"b",function(){return a}),n.d(t,"a",function(){return r})},167:function(e,t,n){},1687:function(e,t){},1688:function(e,t){},1689:function(e,t){},1690:function(e,t){},175:function(e,t,n){"use strict";var a=n(3),r=n.n(a),s=n(11),i=n(1),o=n(2),c=n(339),u=n(16),l=(new Date(2018,7,3),function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.a,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(i.a)(this,e),this.ethereum=t,this.linkedPromiseList=void 0,this.results=[],this.includePrivate=n}return Object(o.a)(e,[{key:"executeQuery",value:function(){var e=Object(s.a)(r.a.mark(function e(t){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=7e6,!navigator.onLine){e.next=5;break}return e.next=4,this.getCurrentBlock();case 4:n=e.sent;case 5:return e.next=7,this.start(t,n-2e6,n);case 7:return this.linkedPromiseList=e.sent,e.abrupt("return",this);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getNext",value:function(){var e=Object(s.a)(r.a.mark(function e(){var t;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.linkedPromiseList&&!this.canceled){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.next=4,this.linkedPromiseList.getCurrent();case 4:if(t=e.sent,t=Array.from(new Set(t)),this.results=this.results.concat(t),this.results=this.sort(this.results),void 0!==this.linkedPromiseList){e.next=10;break}return e.abrupt("return",void 0);case 10:return e.next=12,this.linkedPromiseList.getNext();case 12:return this.linkedPromiseList=e.sent,e.abrupt("return",this.linkedPromiseList);case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"start",value:function(){var e=Object(s.a)(r.a.mark(function e(t,n,a){var i,o=this;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a<=3e6)){e.next=2;break}return e.abrupt("return",new Promise(function(e,t){return e(void 0)}));case 2:return i=this.ethereum.tokenizedSequences,e.abrupt("return",new c.a(Object(s.a)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.getSequences(t,n,a);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),new c.a(Object(s.a)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.ethereum.getNewSequences(t,n,a);case 2:return e.t0=e.sent,e.next=5,o.ethereum.getOldSequences(t,n,a);case 5:return e.t1=e.sent,e.abrupt("return",e.t0.concat.call(e.t0,e.t1));case 7:case"end":return e.stop()}},e)})),this.start(t,n-2e6,a-2e6))));case 4:case"end":return e.stop()}},e,this)}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"sort",value:function(e){return e.sort(function(e,t){return t.blockNumber-e.blockNumber}),e}},{key:"getCurrentBlock",value:function(){var e=Object(s.a)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ethereum.web3.eth.getBlockNumber();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}());t.a=l},176:function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return r});var a=1,r=3},1855:function(e,t){},1857:function(e,t){},192:function(e,t,n){"use strict";var a=n(3),r=n.n(a),s=n(11),i=n(12),o=n(17),c=n(1),u=n(2),l=n(283),p=n(93),h=n(150),d=n(35),f=n(31),m=n(45),v=new l.a,g=function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,[{key:"convertToNotes",value:function(e){return e=e.filter(function(e){return void 0!==e}).filter(function(e){return void 0!==e.pitch}).map(function(e){return{note:m.a.fromTranspose(e.pitch-60).note,startTime:e.startTime,endTime:e.endTime}})}},{key:"getChordsFromSequence",value:function(e,t){var n=this;e.sort(function(e,t){return e.startTime-t.startTime}),e=this.convertToNotes(e);for(var a=[],r=0;r<e.length;r++){var s=e[r],c=Object(o.a)(t),u=[];if(s.note===c[0]){for(var l=r;l<e.length&&0!=c.length;l++){var p=c[0];if(p===e[l].note){c=c.slice(1),u.push(e[l]);for(var h=l,d=l+1;d<e.length&&p==e[d].note;d++)u.push(e[d]),h=d;l=h}else u.push(null)}0==c.length&&a.push(u)}}var f=(a=a.map(function(e){return n.pruneTrailingNulls(e)})).filter(function(e){return e.filter(function(e){return null===e}).length<=.5*e.length}).filter(function(e){return e.length>0}).map(function(e){return{startTime:e[0].startTime,endTime:e[e.length-1].endTime}}).map(function(t){return Object(i.a)({},t,{density:n.calculateDensityForSlice(t,e)})}),m=[],v=function(e){var t=f[e];f.filter(function(e){return t.startTime>e.startTime&&t.endTime<=e.endTime}).length>0||m.push(t)};for(var g in f)v(g);return m}},{key:"calculateDensityForSlice",value:function(e,t){var n=t.filter(function(t){return t.startTime>=e.startTime&&t.startTime<=e.endTime||t.endTime>=e.startTime&&t.endTime<=e.endTime}),a=e.endTime-e.startTime;return n.length/a}},{key:"pruneTrailingNulls",value:function(e){var t=[];for(var n in e){if(e.slice(n).every(function(e){return null===e}))break;t.push(e[n])}return t}},{key:"getNoteSequence",value:function(){var e=Object(s.a)(r.a.mark(function e(t){var n,a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(new p.a).from(f.r).select("noteSequenceHash").where("sampleHash",t).executeQuery();case 2:if(0!=(n=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return a=n[0].noteSequenceHash,e.next=8,d.a.getJson(a);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"searchRankedNotes",value:function(){var e=Object(s.a)(r.a.mark(function e(t){var n,a,s,i,o,c,u,l,p,h,d,f,m,v,g,b,y,k,E,S,O,w;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.searchNotes(t);case 2:n=e.sent,a=[],e.t0=r.a.keys(n);case 5:if((e.t1=e.t0()).done){e.next=20;break}for(u in s=e.t1.value,i=n[s],o=i.remainingNotes,c=100,t)l=t[u],p=o.slice(u),-1==(h=p.indexOf(l))?c-=1/t.length*200:h>0&&(c-=5*h);if(d=o.length,f=i.startTime/1e3,m=i.endTime/1e3,v=d/(m-f),!(c<80)){e.next=17;break}return e.abrupt("continue",5);case 17:a.push({score:c,density:v,result:i}),e.next=5;break;case 20:a.sort(function(e,t){return e.density-t.density}),g={},e.t2=r.a.keys(a);case 23:if((e.t3=e.t2()).done){e.next=36;break}if(b=e.t3.value,!(a[b].score<=80)){e.next=27;break}return e.abrupt("continue",23);case 27:y=a[b].result,k=y.sampleHash,E=y.remainingNotes,S=y.startTime,O=y.endTime,w={startTime:S,endTime:O,remainingNotes:E},k in g?g[k].push(w):g[k]=[w],e.next=23;break;case 36:return e.abrupt("return",g);case 37:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getStartTimesForSample",value:function(){var e=Object(s.a)(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){new p.a(v.contractAddress).from(f.s).select("startTime").where("sampleHash",t).executeQuery().then(function(t){return e(t)})}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"searchNotes",value:function(e){return new Promise(function(t,n){if(0!=e.length){var a=e.map(function(e){return h.b[e]}),r=new p.a(v.contractAddress).from(f.s).select("sampleHash").select("noteA").select("noteB").select("remainingNotes").select("startTime").select("endTime").where("noteA",a[0]);e.length>1&&(r=r.where("noteB",a[1])),r.executeQuery().then(function(e){return t(e)})}else t()})}}]),e}();t.a=g},1937:function(e,t){},195:function(e,t,n){"use strict";var a=n(1),r=n(2),s=function(){function e(){Object(a.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"bytes32[16]",name:"sampleHashes",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"titles",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"youtubeVideoIds",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"coverArtHashes",type:"bytes32[16]"},{internalType:"uint256[16]",name:"discogIds",type:"uint256[16]"},{internalType:"bytes32[4][16]",name:"tagsToAdd",type:"bytes32[4][16]"},{internalType:"bytes32[4][16]",name:"stylesToAdd",type:"bytes32[4][16]"},{internalType:"bytes32[16]",name:"countries",type:"bytes32[16]"},{internalType:"int16[16]",name:"sampleYears",type:"int16[16]"},{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"bytes32[9]",name:"encryptedContentKey",type:"bytes32[9]"},{internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"newEncryptedSamples",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32[16]",name:"sampleHashes",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"titles",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"youtubeVideoIds",type:"bytes32[16]"},{internalType:"bytes32[16]",name:"coverArtHashes",type:"bytes32[16]"},{internalType:"uint256[16]",name:"discogIds",type:"uint256[16]"},{internalType:"bytes32[4][16]",name:"tagsToAdd",type:"bytes32[4][16]"},{internalType:"bytes32[4][16]",name:"stylesToAdd",type:"bytes32[4][16]"},{internalType:"bytes32[16]",name:"countries",type:"bytes32[16]"},{internalType:"int16[16]",name:"sampleYears",type:"int16[16]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"newSamplesWithMetadata",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"string",name:"title",type:"string"},{internalType:"bytes32",name:"youtubeVideoId",type:"bytes32"},{internalType:"bytes32[4]",name:"tagsToAdd",type:"bytes32[4]"},{internalType:"bytes32[4]",name:"stylesToAdd",type:"bytes32[4]"},{internalType:"bytes32",name:"country",type:"bytes32"},{internalType:"int16",name:"year",type:"int16"},{internalType:"uint256",name:"discogsId",type:"uint256"},{internalType:"bytes32",name:"coverArtHash",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"newSampleWithMetadata",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"country",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleCountry",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32[4]",name:"stylesToAdd",type:"bytes32[4]"},{internalType:"bytes32",name:"country",type:"bytes32"},{internalType:"int16",name:"year",type:"int16"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleDiscogsMetadata",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"style",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleStyle",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"tag",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleTag",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32[4]",name:"tagsToAdd",type:"bytes32[4]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleTags",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"int16",name:"year",type:"int16"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleYear",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"youtubeVideoId",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"setSampleYoutubeVideoId",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"guildsAddress",type:"address"},{internalType:"address",name:"encryptionAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!1,internalType:"string",name:"title",type:"string"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampleCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"youtubeVideoId",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampledYoutube",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"tag",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampleTagged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"style",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampleStyle",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"int16",name:"year",type:"int16"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampleYear",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"country",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SampleCountry",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"discogsId",type:"uint256"},{indexed:!0,internalType:"bytes32",name:"coverArtHash",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"NewDiscogsSample",type:"event"}],this.contractAddress="0xc77d4e72dF7D0Bf96488eF543253af537fEb8737"}return Object(r.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=s},196:function(e,t,n){"use strict";var a=n(3),r=n.n(a),s=n(11),i=n(1),o=n(2),c=n(35),u=n(176),l=n(217),p=(n(13),n(378),function(){function e(t,n,a,r){Object(i.a)(this,e),this.store=t,this.guilds=n,this.encryption=a,this.crypto=r}return Object(o.a)(e,[{key:"addJson",value:function(){var e=Object(s.a)(r.a.mark(function e(t){var n,a,s,i,o,l,p,h=arguments;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=h.length>1&&void 0!==h[1]?h[1]:110,a=h.length>2?h[2]:void 0,s=h.length>3&&void 0!==h[3]?h[3]:u.a,h.length>4?h[4]:void 0,s!==u.b){e.next=8;break}return e.next=7,c.a.addJson(t);case 7:return e.abrupt("return",e.sent);case 8:return e.next=10,this.guilds.getGuildKey();case 10:return i=e.sent,o=i.rawPublicKey,e.next=14,this.crypto.encryptRawContent(JSON.stringify(t),a,o);case 14:return l=e.sent,e.next=17,c.a.addJson(l.encryptedContent);case 17:return p=e.sent,this.encryption.newEncryptedContent(p,l.encryptedName,l.encryptedContentKey,n,i.publicKey),e.abrupt("return",p);case 20:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addSound",value:function(){var e=Object(s.a)(r.a.mark(function e(t){var n,a,s,i,o,l=arguments;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:u.a,l.length>2?l[2]:void 0,a=l.length>3?l[3]:void 0,n!==u.b){e.next=7;break}return e.next=6,c.a.addBlob(t);case 6:return e.abrupt("return",e.sent);case 7:return e.next=9,this.guilds.getGuildKey();case 9:return s=e.sent,i=s.rawPublicKey,a.encryptKey(i),e.next=14,this.crypto.encryptRawContent(t,"",i,!0,a);case 14:return o=e.sent,e.next=17,c.a.addBytesArray(o.encryptedContent);case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addBlob",value:function(){var e=Object(s.a)(r.a.mark(function e(t){var n,a,s,i,o,p=arguments;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=p.length>1&&void 0!==p[1]?p[1]:u.a,p.length>2?p[2]:void 0,n!==u.b){e.next=6;break}return e.next=5,c.a.addBlob(t);case 5:return e.abrupt("return",e.sent);case 6:return e.next=8,this.guilds.getGuildKey();case 8:return a=e.sent,s=a.rawPublicKey,e.next=12,this.crypto.encryptRawContent(t,"",s,!0);case 12:return i=e.sent,e.next=15,c.a.addJson(i.encryptedContent);case 15:return o=e.sent,this.encryption.newEncryptedContent(o,i.encryptedName,i.encryptedContentKey,l.b,a.publicKey),e.abrupt("return",o);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getEncryptedContentMetadata",value:function(){var e=Object(s.a)(r.a.mark(function e(t,n,a){var s,i,o,c,u,l;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("getEncryptedContentMetadata("+t+")"),s=(new Date).getTime(),void 0!==a){e.next=6;break}return e.next=5,this.guilds.getContentGuildId(t,n);case 5:a=e.sent;case 6:if(0!==a){e.next=8;break}return e.abrupt("return",void 0);case 8:return i=(new Date).getTime(),i-s,e.next=12,this.guilds.getGuildKey(a);case 12:if(o=e.sent,c=(new Date).getTime(),c-i,u=void 0,!o){e.next=20;break}return e.next=19,this.encryption.getEncryptedContent(t,o.privateKey);case 19:u=e.sent;case 20:if(void 0!==u){e.next=24;break}return e.next=23,this.encryption.getEncryptedContent(t);case 23:u=e.sent;case 24:return l=(new Date).getTime(),l-c,e.abrupt("return",u);case 27:case"end":return e.stop()}},e,this)}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"getJson",value:function(){var e=Object(s.a)(r.a.mark(function e(){var t,n,a,s,i=arguments;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:"QmcfgECwvezrtmVGMywi6epaRMa8NE748V6UiGaBRALeQW",n=i.length>1?i[1]:void 0,e.next=4,this.getEncryptedContentMetadata(t,n);case 4:if(void 0!==(a=e.sent)){e.next=9;break}return e.next=8,c.a.getJson(t);case 8:return e.abrupt("return",e.sent);case 9:return e.next=11,this.crypto.fetchAndDecrypt(t,a);case 11:return s=e.sent,e.abrupt("return",JSON.parse(s));case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getSound",value:function(){var e=Object(s.a)(r.a.mark(function e(){var t,n,a,s,i,o,u,p=arguments;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:"QmYPK9KSRnm5LRvZZkrhLD9HJNVoQpbPBkokF1gt8FwZv8",n=p.length>1?p[1]:void 0,a=new Date,e.next=5,this.getEncryptedContentMetadata(t,l.b,n);case 5:if(s=e.sent,i=new Date,i.getTime()-a.getTime(),void 0!==s){e.next=12;break}return e.next=11,c.a.getSound(t);case 11:return e.abrupt("return",e.sent);case 12:return e.next=14,this.crypto.fetchAndDecrypt(t,s,!0);case 14:return o=e.sent,u=new Date,u.getTime()-a.getTime(),e.abrupt("return",o);case 18:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"guildId",get:function(){var e=this.store.getState().guilds.selectedGuild;return e?e.guildId:0}}]),e}());t.a=p},1967:function(e,t){},197:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var a=n(16);function r(e){e=function(e){return 0===e.indexOf("0x")?e.slice(2):e}(e);for(var t=[],n=0;n<e.length;n+=64)e.length<n+64?t.push(s("0x"+e.slice(n))):t.push(s("0x"+e.slice(n,n+64)));return t}function s(e){return a.a.web3.utils.padRight(e,64)}},1981:function(e,t){},1983:function(e,t){},2091:function(e,t){},213:function(e,t){!function(e){var t=function(e,t){var n=t||{},a=n.bufferLen||256,r=n.numChannels||2;this.context=e.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,a,r,r);var s=new Worker(n.workerPath||"../recorderWorker.js");s.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:r}});var i,o,c=!1,u=null;this.node.onaudioprocess=function(e){if(c){var t=0;if(null!=o){var n=((new Date).getTime()-o)/1e3;if(n+=e.playbackTime-this.context.currentTime,(t=Math.floor(n*this.context.sampleRate))<0)return;o=null}if(null!==u){var a=((new Date).getTime()-u)/1e3;(a+=a+(e.playbackTime-this.context.currentTime))>=0&&(u=null,c=!1)}for(var i=[],l=0;l<r;l++){var p=e.inputBuffer.getChannelData(l);t>0&&(p=p.subarray(t)),i.push(p)}s.postMessage({command:"record",buffer:i})}},this.terminate=function(){s.terminate()},this.configure=function(e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])},this.record=function(e){o=void 0!==e?e:(new Date).getTime(),c=!0},this.stop=function(e){o=null,u=void 0!==e?e:(new Date).getTime()},this.clear=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(new Date).getTime();o=e,s.postMessage({command:"clear"})},this.getBuffer=function(e){i=e||n.callback,s.postMessage({command:"getBuffer"})},this.exportWAV=function(e,t){if(i=e||n.callback,t=t||n.type||"audio/wav",!i)throw new Error("Callback not set");s.postMessage({command:"exportWAV",type:t})},s.onmessage=function(e){var t=e.data;i(t)},e.connect(this.node);var l=this.context.createGain();l.gain.value=0,this.node.connect(l),l.connect(this.context.destination)};t.forceDownload=function(t,n){var a=(e.URL||e.webkitURL).createObjectURL(t),r=e.document.createElement("a");r.href=a,r.download=n||"output.wav";var s=document.createEvent("Event");s.initEvent("click",!0,!0),r.dispatchEvent(s)},e.Recorder=t}(window)},2150:function(e,t){},2153:function(e,t){},2155:function(e,t){},217:function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return r});var a=1,r=4},218:function(e,t,n){"use strict";(function(e){n.d(t,"b",function(){return r}),n.d(t,"a",function(){return s});var a=n(66);function r(e){var t=a.decode(e).toString("hex").replace(/^1220/,"");return 64!=t.length?null:"0x"+t}function s(t){var n=new e(t.replace(/^0x/,"1220"),"hex");return a.encode(n)}}).call(this,n(15).Buffer)},2190:function(e,t){},2204:function(e,t){},2239:function(e,t,n){"use strict";(function(e){n(1),n(6),n(4),n(7),n(1057),n(79),n(893),n(534),n(908),n(910),n(2240),n(2260),n(920),n(921),n(922),n(2305),n(926)}).call(this,n(15).Buffer)},2265:function(e,t){},2267:function(e,t){},2325:function(e,t,n){},2326:function(e,t,n){},2327:function(e,t,n){},2328:function(e,t,n){},2329:function(e,t,n){},2330:function(e,t,n){},2331:function(e,t,n){},2332:function(e,t,n){},2333:function(e,t,n){},2334:function(e,t,n){},2335:function(e,t,n){},2336:function(e,t,n){},2337:function(e,t,n){},2338:function(e,t,n){},2344:function(e,t,n){},2345:function(e,t,n){},2346:function(e,t,n){},2347:function(e,t,n){},2348:function(e,t,n){},2349:function(e,t,n){},2350:function(e,t,n){},2351:function(e,t,n){},2352:function(e,t,n){},2353:function(e,t,n){},2354:function(e,t,n){},2355:function(e,t,n){},2356:function(e,t,n){},2364:function(e,t){},2365:function(e,t){},2557:function(e,t,n){},2558:function(e,t,n){},2559:function(e,t,n){},2560:function(e,t,n){},2572:function(e,t,n){},2574:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(89),i=n.n(s),o=(n(1078),n(1)),c=n(2),u=n(6),l=n(4),p=n(19),h=n(7),d=n(51),f=n.n(d),m=n(3),v=n.n(m),g=n(11),b=n(22),y=n(14),k=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement(b.Rect,{x:this.props.start,y:0,width:this.props.end-this.props.start,height:this.props.height,fill:"yellow"})}}]),t}(a.Component),E=Object(y.b)(function(e,t){return void 0===e.selector.waveformSelection?{}:e.selector.waveformSelection.id!==t.sampleId?{}:{start:e.selector.waveformSelection.start,end:e.selector.waveformSelection.end}},null)(k),S=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={isPlaying:!1,x:0},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){return e.isPlaying!==this.state.isPlaying&&(this.state.isPlaying=e.isPlaying,e.isPlaying?this.startTicker():clearInterval(this.timer)),!0}},{key:"startTicker",value:function(){var e=this;this.timer=setInterval(function(){var t=new Date,n=(1e3*e.props.startOffsetTime+(t-e.props.startTime))%(1e3*e.props.duration);e.setState({x:e.props.width*n/(1e3*e.props.duration)/2})},50)}},{key:"render",value:function(){return this.props.isPlaying?r.a.createElement(b.Line,{x:this.state.x,y:0,points:[this.state.x,0,this.state.x,this.props.height],strokeWidth:1,stroke:"red",fill:"red"}):r.a.createElement(b.Line,null)}}]),t}(a.Component),O=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return this.props.condition?this.props.children:r.a.createElement("div",null)}}]),t}(a.Component),w=n(5),C="RESOLUTION_DROPDOWN",P={STEP:"Click to toggle the step on/off. CMD+click or Alt+click to edit this step's parameters. Drag the right edge to change it's duration. Type shift to view/hide the parameters.",TRACK:"An audio track. Click to select the track. And press a key to map the key to the selected track.",TRACK_THUMBNAIL:"Click to go to this track's details page.",TRACK_EFFECTS_BUTTON:"Click to show the effects for this track.",TRACK_PIANO_ROLL_BUTTON:"Click to show a piano roll for this track, for finer control over melody.",TRACK_ADD_STEPS_BUTTON:"Click to double the length of steps in this track.",TRACK_REMOVE_STEPS_BUTTON:"Click to half the length of steps in this track.",TRACK_MUTE_BUTTON:"Click to mute/unmute the track.",TRACK_SOLO_BUTTON:"Click to solo/un-solo the track. When soloed, you will only hear this track's output",TRACK_RECORD_ARM_BUTTON:"Click to arm this track. When armed (i.e. red), you can play this track like a keyboard, using your computer keyboard, or a midi controller.",TRACK_MIDI_DROPDOWN:"Specify what inputs can control this track when the record arm button is enabled. By default, the computer keyboard and MIDI controllers are enabled.",ADD_EFFECTS_BUTTON:"Click to add effects to this track.",TRACK_SEND_A_SLIDER:'Controls the level of output from this track that goes to "Send A". "Send A" by default is a reverb.',TRACK_SEND_B_SLIDER:'Controls the level of output from this track that goes to "Send B". "Send B" by default is a delay.',TRACK_LOCK_BUTTON:"Click to lock/unlock this track's parameters to this pattern. A track can be locked with respect to specific pattern. Any parameter changes made to a locked track are specific to that pattern.",LFOS_BUTTON:"Click to edit the project-wide LFOs",ENVELOPES_BUTTON:"Click to edit the project-wide envelopes",LFO_TOGGLE_BUTTON:"Click to control this parameter with one of the project-wide LFOs",ENVELOPE_TOGGLE_BUTTON:"Click to control this parameter with one of the project-wide envelopes",EFFECT_PARAMETER:"Click the parameter name to display the LFOs/Envelopes that can control this parameter.",EFFECT_TOGGLE_BUTTON:"Click the toggle the effect on/off.",EFFECT_COLLAPSE_BUTTON:"Click to collapse/uncollapse the effect.",EFFECT_DELETE_BUTTON:"Click to delete this effect from the effects chain.",ADD_SOUND_BUTTON:"Click to add sound to track.",PARAMETER_MODS_BUTTON:"Click to fine-tune the LFO/Envelope modulations (if any) for this effect.",CURRENT_PATTERN_BUTTON:"The current pattern of this project.",PATTERN_BUTTON:"Click to switch to another pattern",NEW_PATTERN_BUTTON:"Click to create a new pattern, copied from the current pattern.",DELETE_PATTERN_BUTTON:"Click to delete the current pattern.",RESOLUTION_DROPDOWN:"Specify the step resolution of the step sequencer. For example, you can view the steps in triplets.",PLAY_BUTTON:"Click to play the project in pattern mode.",RECORD_BUTTON:"Click to enable recording. When recording, any tracks triggered via computer-keyboard/midi controller will be recorded into the sequence",ROLL_BUTTON:'Click to enable "roll". When enabled, you can trigger tracks in time with the selected resolution of the project.',QUANTIZE_BUTTON:"When quantized, any triggers you record will be snapped to the grid, as defined by the selected resolution of the project. When unquantized, it does not snap to the grid.",AND_TAG_BUTTON:"Sounds must contain this tag, along with any other red colored tags. Click to unselect this tag.",OR_TAG_BUTTON:"Sounds may contain this tag. Click to unselect this tag.",SELECTOR_TAG_BUTTON:"Click to filter by this tag.",SELECTOR_CATEGORY_BUTTON:"Click to filter by this category of tags.",TRACK_PARAMETERS:"All steps on this track are by default set to these parameters. Changing the parameter for a specific step overrides that default for that step.",TRACK_WAVEFORM:'Drag the markers to set the start/end of the slice. You can also select a new region and click "Add Slice" to create additional slices from this sample.',SELECTOR_WAVEFORM:"Click to hear the sample. Drag to make a selection",DETAIL_VIEW_HAS_SELECTED_SLICE:"Press a key to map the selected slice to a key. You can also click on the graphical keyboard on this page to map this.",GRAPHICAL_KEYBOARD:"Shows what keys are mapped to what sounds and slices. Click on a mapped key to unmap it. Click on an unmapped key to map it to the selected slice for this track",ENVELOPE_TRACK_DROPDOWN:"Specify which track will trigger this envelope.",LFO_MIN_SLIDER:"Controls the minimum value that LFO oscillators from at the given rate",LFO_MAX_SLIDER:"Controls the maximum value that LFO oscillators to at the given rate",PARAMETERIZER_FACTOR:"Multiplies the chosen parameter`s value by this factor, everytime the track triggers",PARAMETERIZER_OFFSET:"Sums the chosen parameter`s value with this offset, everytime the track triggers.",PROBABILITY:"Controls the probability rate which this MIDI effect will apply. I.E. 100% means it always applies ",PARAMETERIZER_DROPDOWN:"Specifiy the parameter which this effect will apply to.",RESAMPLE:"Resamples this track's pattern (including effects), creating a new track with the recorded sample",TRANSCRIBE:"Transcribes the midi notes for this sample, creating a new External Instrument track with the transcribed midi notes (takes a few seconds to run).",PLAY_MIX_BUTTON:"Plays a recorded mix (if there is one)",RECORD_MIX_BUTTON:"Record a mix, so that all pattern switches, parameter changes are recorded and can be played back.",AUTOMATION_BUTTON:"When clicked, and the RECORD button at the bottom is turned on, any automation changes made within a pattern are recorded to that pattern. To delete the automations, hold down the / key",AUDITION_BUTTON:"Audition this sample, replacing the current sample in the selected track with it.",CONVOLVER_BUTTON:"Replace a convolver reverb's impulse sample with this sample",LAYER_BUTTON:"Add this sample to the selected track, so that multiple samples can be triggered by one track.",ADD_SYNTH_BUTTON:"Click to add a simple synth to the project",ADD_MULTI_SYNTH_BUTTON:"Click to add a multi-oscillator synth to the project",ADD_FM_SYNTH_BUTTON:"Click to add an FM synth to the project",ADD_EXTERNAL_INSTRUMENT_BUTTON:"Click to add an external instrument to the project. This can control midi devices connected to your computer, including hardware synths",ADD_PRESET_BUTTON:"Click to add this preset to your project",LFO_COMPONENT:"An LFO oscillates between minimum and maximum values, at a constant rate. You can connect parameters to an LFO to modulate its value",ENVELOPE_COMPONENT:"An envelope is triggered any time its connected track has triggered. When triggered, it can control parameter values according to the ASDR (attack, sustain, decay, release) of the envelope.",ADD_ALL_SOUNDS_BUTTON:"Click to select sounds, instruments, presets, and/or sequences to load into the project.",ADD_SOUNDS_BUTTON:"Click to search for and load sounds into your project.",ADD_INSTRUMENTS_BUTTON:"Click to add instruments (e.g. synths) into your project.",ADD_PRESETS_BUTTON:"Click to add saved presets into your project.",ADD_SEQUENCES_BUTTON:"Click to search for and load saved projects.",VIEW_DROPDOWN:"Go to other views, like the mix view",BPM_SLIDER:"Set the BPM (i.e. the tempo) of the project",SWING_SLIDER:"Set the swing of the project.",BPM_LOCK:"Lock/unlock the pattern BPM. This allows different patterns to have different BPMs",PUBLIC_SAVE:"Saves the sequence publicly-- without encryption-- so anyone can see",PRIVATE_SAVE:"Saves the sequence encrypted, so that only you can see (with a password)",PARAMETER_VALUE:"Click to edit the parameter value",PRESET_FOLDERS:"Choose ready-to-go presets to add to your track (by double-clicking the item).",GUILDS_SELECTOR:"Chooses the selected Guild. When selected, only show samples, presets, sequences from that Guild."};function T(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=a.createBuffer(e.numberOfChannels,r+n-t+1,a.sampleRate),i=s.getChannelData(0),o=e.getChannelData(0).subarray(t,n);if(i.set(o,r),e.numberOfChannels>1){var c=s.getChannelData(1),u=e.getChannelData(1).subarray(t,n);c.set(u,r)}return s}var j=function(e){function t(e){var n;Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={audioUnit:e.audioUnit,buffer:e.audioUnit.buffer,x:0,isPlaying:!1},n.dragging=!1,n.width=e.width||325,n.height=e.height||50,n.state.pts=[];var a=Object(p.a)(n);return n.computeWaveformInChunks(0,[],function(e){a.state.pts=e,a.setState(a.state)}),n.convertSpaceToSeconds.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){if(this.state.buffer!==e.buffer){this.state.buffer=e.buffer;var n=this;return this.computeWaveformInChunks(0,[],function(e){n.state.pts=e}),!0}return this.dragging||this.state.isPlaying||this.state.pts!==t.pts||this.props.slices!==e.slices}},{key:"computeWaveformInChunks",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n,a){var r,s,i,o,c,u,l,p,h,d;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.width,!((t+1)*r>this.width)){e.next=4;break}return a([]),e.abrupt("return");case 4:if(void 0!==this.state.audioUnit.buffer){e.next=6;break}return e.abrupt("return");case 6:for(s=Math.floor(this.state.audioUnit.buffer.length/this.width),i=(i=this.state.audioUnit.buffer.getChannelData(0)).subarray(r*t*s,r*(t+1)*s),o=window.api.create_buffer(i.length),window.Module.HEAPF32.set(i,o>>2),window.api.getColoredWaveform(o,r,this.height,i.length,s,r*t),c=window.api.get_result_pointer(),u=new Uint16Array(window.Module.HEAP16.buffer,c,7*r),l=[],p=0;p<7*r;p+=7)h=[u[p+4],u[p+5],u[p+6]],l.push({x:u[p],y:u[p+1],width:u[p+2],height:u[p+3],rgb:h});(d=this).state.pts=n.concat(l),d.setState(d.state),window.api.destroy_buffer(o),setTimeout(function(){d.computeWaveformInChunks(t+1,n.concat(l),function(e){a(l.concat(e))})},100);case 21:case"end":return e.stop()}},e,this)}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"computeWaveformPoints",value:function(){}},{key:"stopSound",value:function(){this.state.audioUnit.stopSound(),this.setState({isPlaying:!1})}},{key:"playSound",value:function(e,t){var n=e.state.audioUnit;if(e.state.isPlaying)e.stopSound();else{e.setState(e.state),e.state.isPlaying=!0;var a=e.convertSpaceToSeconds(t);n.playSound(a);var r=new Date;this.setState({startOffsetTime:a,startTime:r})}}},{key:"convertSpaceToSeconds",value:function(e){return this.state.audioUnit.buffer.duration*e/this.width}},{key:"convertSecondsToSpace",value:function(e){return e/this.state.audioUnit.buffer.duration*this.width}},{key:"startDrag",value:function(e,t){if(document.activeElement.blur(),t=t.evt,e.draggin?e.dragging=!1:(e.playSound(e,t.offsetX),void 0!==e.props.sample&&e.props.setWaveformSelection({start:t.offsetX,end:t.offsetX,id:e.props.sample.getId()}),e.dragging=!0),void 0!==this.props.slices){var n=this.getSliceFromCoordinate(t.offsetX);this.props.onSelectSlice(n)}}},{key:"getSliceFromCoordinate",value:function(e){var t=this.convertSpaceToSeconds(e),n=this.props.slices.filter(function(e){return e.startTime<=t&&e.endTime>=t});return 0==n.length?void 0:n[0]}},{key:"moveDrag",value:function(e,t){if(e.dragging){if(e.props.setWaveformSelectionEnd(t.evt.layerX),void 0===this.props.sequencerEngine)return;var n=this.props.sequencerEngine.store.getState(),a=this.convertSpaceToSeconds(n.selector.waveformSelection.start),r=this.convertSpaceToSeconds(t.evt.layerX);void 0!==this.props.onChooseSlice&&a<r&&this.props.onChooseSlice({startTime:a,endTime:r})}}},{key:"endDrag",value:function(e){this.dragging=!1,this.stopSound()}},{key:"isCurrentChord",value:function(e){var t=this.props.selectedChordSample;return void 0!==this.props.sample&&void 0!==t&&(this.props.sample.ipfsHash===t.sampleHash&&e.startTime===t.startTime&&e.endTime===t.endTime)}},{key:"render",value:function(){var e=this,t=this.state.pts,n=void 0===this.props.slices?[]:this.props.slices;return void 0===t||0==t.length?r.a.createElement("div",null):void 0===this.props.audioUnit?r.a.createElement("div",null,"Fetching sample..."):r.a.createElement("div",null,r.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("SELECTOR_WAVEFORM")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"sound-waveform details-view"},r.a.createElement(b.Stage,{onMouseDown:function(t){return e.startDrag(e,t)},onMouseUp:function(t){return e.endDrag(e,t)},onMouseMove:function(t){return e.moveDrag(e,t)},width:this.width,height:this.height},r.a.createElement(b.Layer,null,r.a.createElement(b.Rect,{x:0,y:0,width:this.width,height:this.height,fill:"black"}),r.a.createElement(E,{height:this.height,sampleId:void 0!==this.props.sample?this.props.sample.getId():0}),n.map(function(t,n){return r.a.createElement(b.Rect,{x:e.convertSecondsToSpace(t.startTime),onMouseOver:function(){return e.props.onHoverSlice(t)},y:0,width:e.convertSecondsToSpace(t.endTime-t.startTime),height:e.height,fill:e.isCurrentChord(t)?"green":"yellow"})})),r.a.createElement(b.Layer,null,t.map(function(e,t){return r.a.createElement(b.Rect,{key:"point-"+t,x:e.x,y:e.y,width:e.width,height:e.height,fill:"rgb("+e.rgb[0]+","+e.rgb[1]+","+e.rgb[2]+")"})})),r.a.createElement(b.Layer,null,r.a.createElement(S,{startTime:this.state.startTime,isPlaying:this.state.isPlaying,duration:this.state.audioUnit.buffer.duration,startOffsetTime:this.state.startOffsetTime,width:this.width,height:this.height})))))}}]),t}(a.Component),x=Object(y.b)(function(e,t){return{selectedChordSample:e.selector.selectedChordSample}},function(e){return{dragSample:function(t){return e(Object(w.f)(t))},setWaveformSelection:function(t){return e(Object(w.ze)(t))},setWaveformSelectionEnd:function(t){return e(Object(w.Ae)(t))},setContextualHelp:function(t){return e(Object(w.V)(t))}}})(j),N=n(13),q=n.n(N),M=n(34),D=n.n(M),A=n(18),R=(n(167),n(16)),I=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={emailAddress:"",reasoning:""},n.onClickDone=n.onClickDone.bind(Object(p.a)(n)),n.onClickCancel=n.onClickCancel.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickDone",value:function(){R.a.dmca.copyStrikeSample(this.props.sampleHash,this.state.emailAddress,this.state.reasoning),this.props.hide()}},{key:"onClickCancel",value:function(){this.props.hide()}},{key:"render",value:function(){var e=this;return r.a.createElement(D.a,{dialogClassName:"preset-modal",show:this.props.show,onHide:this.onClickCancel},r.a.createElement(D.a.Header,{closeButton:!0},r.a.createElement(D.a.Title,null,"DMCA Takedown Form")),r.a.createElement(D.a.Body,null,"Provide proof that you own the rights to this sample here, or email us at universalsequences@gmail.com with the sound identifier:",r.a.createElement("div",{className:"sample-identifier"},this.props.sampleHash),r.a.createElement(A.h,null,r.a.createElement("label",null,"Email Address: "),r.a.createElement(A.g,{onChange:function(t){return e.setState({emailAddress:t.target.value})},value:this.state.emailAddress,placeholder:"Enter your email address",className:"email-address-input"})),r.a.createElement(A.h,null,r.a.createElement(A.g,{onChange:function(t){return e.setState({reasoning:t.target.value})},value:this.state.reasoning,type:"textarea",placeholder:"Include proof here of your rights to this sound and other shit",className:"dmca-reasoning-input"}))),r.a.createElement(D.a.Footer,null,r.a.createElement(A.b,{variant:"secondary",onClick:this.onClickDone},"Done"),r.a.createElement(A.b,{variant:"primary",onClick:this.onClickCancel},"Cancel")))}}]),t}(a.Component),L=Object(y.b)(function(e){return{}},function(e){return{}})(I),F=(n(1777),n(71)),V=n.n(F),B=n(35),U=n(38),H=new U.a,J=function(e){function t(e){var n;Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={thumbnail:"",name:e.name,videoId:e.sample.videoId},n.apiKey="AIzaSyCf2k8RM7tFFlVGo4CVPvCsOhx86vWwTT0",n.getYoutubeTitle.bind(Object(p.a)(n)),n.getYoutubeThumbnail.bind(Object(p.a)(n));var a=n.props.sample.videoId;return void 0!==a&&""!==a&&n.getYoutubeThumbnail(a),n.props.coverArt&&n.getDiscogsThumbnail(n.props.coverArt),n.props.sample.coverArtHash&&(console.log("getting sample cover art hash = "+n.props.sample.coverArtHash),n.getDiscogsThumbnail(n.props.sample.coverArtHash)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){var n=!1;return e.selectedSampleTag!==this.props.selectedSampleTag&&(n=!0),e.sample.soundId===this.props.sample.soundId&&e.sample.ipfsHash===this.props.sample.ipfsHash||(n=!0),e.name!=this.state.name&&(this.state.name=e.name,n=!0),e.isCompactMode!==this.props.isCompactMode&&(n=!0),e.sample.videoId!==this.state.videoId&&(this.state.videoId=e.sample.videoId,this.getYoutubeThumbnail(this.state.videoId),n=!0),e.coverArt!==this.props.coverArt&&(this.getDiscogsThumbnail(e.coverArt),n=!0),e.sample.coverArtHash!==this.props.sample.coverArtHash&&(this.getDiscogsThumbnail(e.sample.coverArtHash),n=!0),void 0!==e.sample&&void 0!==e.name&&(this.state.name=e.name),t.thumbnail!==this.state.thumbnail&&(n=!0),e.isLoading!==this.props.isLoading&&(n=!0),n}},{key:"getYoutubeTitle",value:function(e){var t=this;if(void 0!==e&&null!==e&&""!==e){var n=e.split("="),a=this;if(n.length>1){var r=n[n.length-1];if(""===r)return this.state.name=this.props.name,void this.setState(this.state);f.a.get("https://www.googleapis.com/youtube/v3/videos?id="+r+"&key="+this.apiKey+"&fields=items(snippet(title))&part=snippet").then(function(e){return a.setState({name:void 0!==e.data.items[0]?t.truncateName(e.data.items[0].snippet.title):"Video deleted"})})}}else this.setState(this.state)}},{key:"getDiscogsThumbnail",value:function(e){console.log("got the thumbnail = "+B.a.getHashUrl(e)),this.state.thumbnail=B.a.getHashUrl(e),this.setState(this.state)}},{key:"getYoutubeThumbnail",value:function(e){if(""===e||void 0===e)return this.state.thumbnail="",void this.setState(this.state);var t="https://img.youtube.com/vi/"+e+"/1.jpg",n=this.state;n.thumbnail=t,this.setState(n)}},{key:"onClickTag",value:function(e){e===this.props.selectedSampleTag?this.props.setSelectedSampleTag(this.props.sample.getId(),void 0):this.props.setSelectedSampleTag(this.props.sample.getId(),e)}},{key:"onImgError",value:function(){this.setState({thumbnail:""})}},{key:"getTags",value:function(){return void 0!==this.props.selectedSampleTag?[this.props.selectedSampleTag]:this.props.isCompactMode&&this.props.sample.tags.length>0?[this.props.sample.tags[0]]:this.props.sample.tags}},{key:"truncateName",value:function(e){if(void 0===e||null===e)return null;var t=this.props.isCompactMode?14:G;return(e.length>t?e.substring(0,t)+"...":e).trim()}},{key:"onDragOver",value:function(e){e.stopPropagation()}},{key:"onDragStart",value:function(e){this.props.setSampleDragging(this.props.sample)}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(e),this.props.setContextualHelp(t)}},{key:"render",value:function(){var e=this,t=this.props.isBig?"big ":"";this.props.isCompactMode&&(t+=" compact ");var n={};if(""===this.state.thumbnail){var a=void 0!==this.props.sample.getId()?this.props.sample.getId():void 0!==this.props.name?this.props.name:"other instrument";n={backgroundColor:H.getColorForHash(a)}}var s=this.props.contextualHelp||"TRACK_THUMBNAIL";return r.a.createElement("div",{className:"youtube-info"},r.a.createElement("div",null,this.props.showDelete?r.a.createElement("div",{className:"delete-button delete-track-button",onClick:this.props.onClickDelete},"x"):"",""===this.state.thumbnail?r.a.createElement("div",{draggable:!0,onDragStart:function(t){return e.onDragStart(t)},onDragOver:function(t){return e.onDragOver(t)},onMouseOver:function(t){return e.setContextualHelp(t,s)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:t+"sound-thumbnail",style:n,onClick:this.props.onClickThumbnail},r.a.createElement(V.a,{className:"track-loading-spinner",sizeUnit:"px",size:10,color:"#123abc",loading:this.props.isLoading})):r.a.createElement("img",{draggable:!0,onDragStart:function(t){return e.onDragStart(t)},onDragOver:function(t){return e.onDragOver(t)},onMouseOver:function(t){return e.setContextualHelp(t,s)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onError:function(){return e.onImgError()},className:this.props.isMuted?t+"muted youtube-thumbnail":t+"youtube-thumbnail",onClick:this.props.onClickThumbnail,src:this.state.thumbnail})),r.a.createElement(O,{condition:!this.props.hideName},r.a.createElement("div",{className:"youtube-name"},r.a.createElement("span",{onClick:this.props.onClickName},this.truncateName(this.state.name)))),this.props.children)}}]),t}(a.Component);var G=36,z=Object(y.b)(function(e,t){return{selectedSampleTag:e.tracks.selectedSampleTags[t.sample.getId()],isCompactMode:e.sequencer.isCompactMode&&!t.isBig,isLoading:void 0!==t.track&&!!e.tracks.trackIsLoading[t.track.subSequence.id]&&!0===e.tracks.trackIsLoading[t.track.subSequence.id][t.track.trackNumber]}},function(e,t){return{setSelectedSampleTag:function(t,n){return e(Object(w.Vc)(t,n))},setContextualHelp:function(t){return e(Object(w.V)(t))},setSampleDragging:function(t){return e(Object(w.Ac)(t))}}})(J),_=(n(378),function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q.a.Master.context;Object(o.a)(this,e),console.log("constructing audio unit"),this.duration=0,this.source=void 0,this.buffer=void 0,this.playbackRate=1,this.looping=!1,this.playSound.bind(this),this.context=t,this.seek.bind(this),this.stopSound.bind(this)}return Object(c.a)(e,[{key:"dispose",value:function(){console.log("disposing audio unit"),void 0!==this.source&&this.source.disconnect(),void 0!==this.gainNode&&this.gainNode.disconnect(),this.buffer=void 0,this.source=void 0,this.gainNode=void 0}},{key:"getContext",value:function(){return this.context}},{key:"playSound",value:function(e,t){void 0==e&&(e=0),void 0!=this.source&&void 0!==this.source||(this.gainNode=this.context.createGain(),this.gainNode.connect(this.context.destination)),void 0!=this.source&&this.source.stop(),this.source=this.context.createBufferSource(),this.source.connect(this.gainNode),this.source.buffer=this.buffer,this.source.playbackRate.value=this.playbackRate,this.source.loop=!1,this.source.start(0,e,t)}},{key:"seek",value:function(e){this.stopSound(),this.playSound(e)}},{key:"stopSound",value:function(){void 0!=this.source&&this.source.stop()}},{key:"loadRawBuffer",value:function(e){this.buffer=e,this.duration=e.duration}},{key:"setBuffer",value:function(e){this.buffer=e,this.duration=e.duration}}]),e}()),W=n(192),K=n(47),Y=(n(833),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={name:void 0,soundId:e.soundId,selections:[],favorited:!1,density:void 0,tags:[],videoId:"",slices:[],waveforms:0,dropdownOpen:!1,showDMCAModal:!1,guildName:void 0},n.selectedSlices=[],n.slices={},n.originalSoundId=n.state.soundId,n.handleLoadBuffer.bind(Object(p.a)(n)),n.undoCropStack=[],n.undoCropIdStack=[],void 0!==n.props.sample?(n.audioUnit=n.props.audioUnit,n.loadSample(n.props.sample),n.state.slices=n.props.chordSlices):(n.sample=new K.a(void 0!==e.soundId?e.soundId:e.soundHash),n.state.videoId=n.props.videoId,n.state.name=n.props.name,n.audioUnit.loadRawBuffer(n.props.buffer),n.state.buffer=n.props.buffer,n.state.waveforms++,n.setState(n.state)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"exploreSample",value:function(){this.props.setSampleToExplore(this.sample)}},{key:"toggleDropdown",value:function(){this.setState({dropdownOpen:!this.state.dropdownOpen})}},{key:"loadFavorites",value:function(){var e=Object(g.a)(v.a.mark(function e(t){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.a.getFavoritesForSound(t);case 2:e.sent.userFavorited>0?this.setState({favorited:!0}):this.setState({favorited:!1});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadChords",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(t=this.props.sequencerEngine.store.getState().selector.chordSelected)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.sample.fetchNoteSequence();case 5:if(void 0!==(n=e.sent)){e.next=8;break}return e.abrupt("return");case 8:a=(new W.a).getChordsFromSequence(n,t),this.state.slices=a,this.setState(this.state.slices);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onConvolver",value:function(){this.props.setShowConvolverModal(!0,this.sample.ipfsHash)}},{key:"onClickFavorite",value:function(){this.state.favorited?(R.a.unfavoriteSound(this.sample.ipfsHash),this.setState({favorited:!1})):(R.a.favoriteSound(this.sample.ipfsHash),this.setState({favorited:!0}))}},{key:"shouldComponentUpdate",value:function(e){return e.audioUnit!==this.audioUnit&&(e.sample.getId()!==this.sample.getId()&&this.audioUnit&&this.audioUnit.dispose(),this.audioUnit=e.audioUnit,this.loadSample(e.sample)),(e.soundId!=this.state.soundId&&e.soundId!=this.originalSoundId||e.sample.ipfsHash!==this.state.ipfsHash)&&(this.state.soundId=e.soundId,this.state.slices=this.props.chordSlices),!0}},{key:"onChooseSlice",value:function(e){this.selectedSlices=[e]}},{key:"onSelectSlice",value:function(e){if(void 0!==e){var t=this.selectedSlices.indexOf(e);t>-1?this.selectedSlices.splice(t,1):this.selectedSlices.push(e)}else this.selectedSlices=[]}},{key:"loadSample",value:function(){var e=Object(g.a)(v.a.mark(function e(t){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t.ipfsHash){e.next=2;break}return e.abrupt("return");case 2:if(this.sample&&this.sample!==t&&this.sample.dispose(),this.sample=t,this.state.ipfsHash=t.ipfsHash,void 0!==t.tags&&(this.state.tags=t.tags),this.state.videoId=t.videoId,this.setState(this.state),void 0===this.state.videoId&&(this.state.name=t.name,this.setState({name:t.name})),this.handleLoadBuffer(this,t.audioBuffer),this.loadFavorites(t.ipfsHash),this.loadChords(),0!==this.sample.guildId){e.next=16;break}this.setState({guildName:void 0}),e.next=22;break;case 16:return e.t0=this,e.next=19,R.a.guilds.getGuildName(this.sample.guildId);case 19:e.t1=e.sent,e.t2={guildName:e.t1},e.t0.setState.call(e.t0,e.t2);case 22:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"handleLoadBuffer",value:function(e,t){var n=e.state;n.buffer=t,e.setState(n)}},{key:"onClickSelection",value:function(e,t){this.undoCropStack.push(t),this.undoCropIdStack.push(this.state.soundId),this.state.soundId=e,this.state.waveforms+=2,this.setState(this.state)}},{key:"sequence",value:function(){this.props.history.push("/create/"+this.state.soundId)}},{key:"onHoverSlice",value:function(e){this.setState({density:e.density})}},{key:"addSample",value:function(){void 0!==this.sample.audioBuffer&&(document.activeElement.blur(),this.props.onAddSample(this.sample,this.selectedSlices))}},{key:"onLayer",value:function(){void 0!==this.sample.audioBuffer&&this.props.onLayerSample(this.sample)}},{key:"onAudition",value:function(){void 0!==this.sample.audioBuffer&&this.props.onAudition(this.sample)}},{key:"onDownvote",value:function(){R.a.unfavoriteSound(this.sample.ipfsHash)}},{key:"similarSounds",value:function(){var e=this.sample.getId();this.props.setSimilarSoundsToFind(e),window.dispatchEvent(new Event("SIMILAR_SOUNDS"))}},{key:"formatTag",value:function(e){return e.length>20&&(e=e.slice(0,20)),e}},{key:"componentWillUnmount",value:function(){this.audioUnit&&this.audioUnit.dispose(),this.sample&&this.sample.dispose()}},{key:"dmcaTakeDown",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.setState({showDMCAModal:e})}},{key:"render",value:function(){var e=this,t="sound-row";return this.props.auditioning&&(t+=" auditioning"),this.props.i%2===0&&(t+=" odd"),r.a.createElement("div",{className:t},r.a.createElement(L,{hide:function(){return e.dmcaTakeDown(!1)},show:this.state.showDMCAModal,sampleHash:this.sample.getId()}),r.a.createElement("a",{name:"sample-"+this.sample.ipfsHash}),r.a.createElement("div",{className:this.props.i%2==0?"playlist-row":"playlist-row odd"},r.a.createElement("div",{className:"sound-and-tags"},r.a.createElement(O,{condition:void 0!==this.audioUnit},r.a.createElement(x,{selections:this.state.selections,buffer:void 0===this.audioUnit?void 0:this.audioUnit.buffer,audioUnit:this.audioUnit,sample:this.props.sample,slices:this.state.slices,onChooseSlice:function(t){return e.onChooseSlice(t)},onHoverSlice:function(t){return e.onHoverSlice(t)},sequencerEngine:this.props.sequencerEngine,onSelectSlice:function(t){return e.onSelectSlice(t)},waveformId:this.state.waveforms})),r.a.createElement(O,{condition:void 0===this.audioUnit},r.a.createElement("div",{className:"downloading-sample"},"Downloading sample...")),r.a.createElement("div",{className:"sample-tags"},r.a.createElement("div",{className:"tags-sound-wrapper"},r.a.createElement("div",{className:"sample-name"},r.a.createElement("span",{className:"name-text"},function(e){if(void 0===e||null===e)return null;return(e.length>36?e.substring(0,36)+"...":e).trim()}(this.props.sample.name)),r.a.createElement(O,{condition:this.state.guildName},r.a.createElement("span",{className:"name-text guild-name-text"},this.state.guildName))),void 0!==this.props.sample.tags?this.props.sample.tags.map(function(t){return r.a.createElement(A.a,{color:"light"},e.formatTag(t))}):"",r.a.createElement("img",{onClick:function(){return e.exploreSample()},className:"link-icon",src:"/link-icon.png"}))),r.a.createElement("div",{className:"clear-fix"})),r.a.createElement("div",{className:"youtube-info"},r.a.createElement(z,{contextualHelp:"ADD_SOUND_BUTTON",hideName:this.props.hideName,onClickThumbnail:function(){return e.addSample()},isBig:!0,isSelector:!0,name:this.sample.name,isMuted:!1,sample:this.sample,onNewSound:this.props.onNewSound}),r.a.createElement("div",{className:"sound-buttons"},r.a.createElement("div",{className:"preset-dropdown"},r.a.createElement(A.c,{size:"sm",show:this.state.dropdownOpen,isOpen:this.state.dropdownOpen,toggle:function(){return e.toggleDropdown()}},r.a.createElement(A.b,{onClick:function(){return e.addSample()},id:"caret",color:"secondary"},r.a.createElement("span",{className:"medium"},"+")),r.a.createElement(A.f,{size:"sm",caret:!0,color:"secondary"}),r.a.createElement(A.e,null,r.a.createElement(A.d,{onMouseOver:function(){return e.props.setContextualHelp("ADD_SOUND_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){e.addSample()},size:"sm"},"ADD SOUND"),r.a.createElement(A.d,{onMouseOver:function(){return e.props.setContextualHelp("AUDITION_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onAudition()},size:"sm"},"AUDITION"),r.a.createElement(A.d,{onMouseOver:function(){return e.props.setContextualHelp("CONVOLVER_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onConvolver()},size:"sm"},"CONVOLVER")))),r.a.createElement("div",{onClick:function(){return e.onClickFavorite()},className:this.state.favorited?"result-heart heart favorited":"result-heart heart"})))))}},{key:"save",value:function(){var e=new FormData,t=this,n=new Worker("/recorderWorker.js");n.postMessage({command:"init",config:{sampleRate:q.a.context.sampleRate,numChannels:t.audioUnit.buffer.numberOfChannels}});var a="/saveCropped/"+("cropped at "+new Date)+"/"+t.state.soundId+"/"+t.state.selection.start+"/"+t.state.selection.end;n.onmessage=function(n){var r=n.data;e.append("body",r),f()({method:"POST",url:a,data:r,headers:{"Content-Type":"application/octet-stream"}}).then(function(e){t.undoCropIdStack.push(t.state.soundId),t.state.soundId=e.data.soundId,t.props.onSoundIdChange(e.data.soundId)})};var r=[t.audioUnit.buffer.getChannelData(0)];2==t.audioUnit.buffer.numberOfChannels&&r.push(t.audioUnit.buffer.getChannelData(1)),n.postMessage({command:"record",buffer:r}),n.postMessage({command:"exportWAV",type:"audio/wav"})}}]),t}(a.Component));a.Component;var Q={Sound:Object(y.b)(null,function(e){return{setShowConvolverModal:function(t,n){return e(Object(w.jd)(t,n))},setContextualHelp:function(t){return e(Object(w.V)(t))},setShowSamples2D:function(t){return e(Object(w.vd)(t))},setSimilarSoundsToFind:function(t){return e(Object(w.Id)(t))},setSampleToExplore:function(t){return e(Object(w.Dc)(t))}}})(Y),exportAsWAV:function(e,t,n){var a=new FormData,r=new Worker("/recorderWorker.js");r.postMessage({command:"init",config:{sampleRate:q.a.context.sampleRate,numChannels:2}}),r.onmessage=function(t){var r=t.data;a.append("body",r),f()({method:"POST",url:e,data:r,headers:{"Content-Type":"application/octet-stream"}}).then(function(e){n(e)})};var s=[t.getChannelData(0)];s.push(t.getChannelData(1)),r.postMessage({command:"record",buffer:s}),r.postMessage({command:"exportWAV",type:"audio/wav"})}},X=n(12),Z=n(24),$=26050,ee=32500,te=n(86);function ne(e){var t=Object(a.useState)(0),n=Object(Z.a)(t,2),s=n[0],i=n[1],o=Object(a.useCallback)(function(t){e.sequencerEngine.transpose=t,i(t)},[i]);return r.a.createElement("div",{className:"transpose-container"},r.a.createElement(te.Knob,{size:50,angleOffset:220,angleRange:280,value:s,step:1,min:-24,max:24,onChange:o},r.a.createElement(te.Arc,{arcWidth:5,color:"white",background:"#6c757a"}),r.a.createElement(te.Pointer,{width:3,height:15,radius:10,type:"rect",color:"white"}),r.a.createElement(te.Value,{className:"transpose-value"})))}var ae=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onPlayClicked",value:function(e){document.activeElement.blur(),this.props.play(),this.setState(this.state)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{onMouseDown:function(t){return e.onPlayClicked(t)},className:"playpause playpause-user"},r.a.createElement("input",{checked:!this.props.isPlaying,type:"checkbox",value:!this.props.isPlaying,id:"playpause",name:"check"}),r.a.createElement("label",{htmlFor:"playpause playpause-user",tabIndex:1}))}}]),t}(a.Component);function re(e){var t=Object(a.useState)(0),n=Object(Z.a)(t,2),s=n[0],i=n[1],o=Object(a.useCallback)(function(t){e.mixEffects.color=t,i(t)},[i]);return r.a.createElement("div",{className:"color-container"},r.a.createElement(te.Knob,{size:70,angleOffset:220,angleRange:280,value:s,min:0,max:1,onChange:function(e){return o(e)}},r.a.createElement(te.Arc,{arcWidth:5,color:"white",background:"#6c757a"}),r.a.createElement(te.Pointer,{width:3,height:25,radius:10,type:"rect",color:"white"})))}var se=["A","B","C","D","E","F","G","H","I","J"];var ie=Object(y.b)(function(e,t){t.sequencerEngine.engineId;var n=t.subSequence.id,a=e.sequencer.currentPattern[n]||0,r=t.subSequence.tracks;return{currentPattern:a,subSequenceId:n,numberOfPatterns:r.length>0&&r[0].patterns?r[0].patterns.length:0}},null)(function(e){return 0===e.subSequence.tracks.length?r.a.createElement("div",null):r.a.createElement("div",{className:"sub-sequence-patterns"},r.a.createElement("div",{className:"sub-sequence-name"},se[e.i]),e.subSequence.tracks[0].patterns.map(function(t,n){return r.a.createElement("div",{key:"pattern-"+n,onClick:function(){return function(t){e.sequencerEngine.switchToPattern(t,void 0,e.subSequence)}(n)},className:e.currentPattern===n?"current pattern-button":"pattern-button"},n+1)}))}),oe=new U.a;var ce=Object(y.b)(function(e,t){return{subSequences:e.sequencer.subSequences[t.sequencerEngine.getSequenceId()]||[]}},null)(function(e){return oe.getColorForHash(e.track.id),r.a.createElement("div",{className:"track-patterns-container"},r.a.createElement("div",{className:"track-patterns"},e.sequencerEngine.subSequences.map(function(t,n){return r.a.createElement(ie,{i:n,sequencerEngine:e.sequencerEngine,subSequence:t})})))}),ue=12;function le(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ue,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-200,s=e/n;if(s>=.75){var i=a*(1-Math.log(.75)/Math.log(.6));return i+=(a-i)*(s-.75)/.25}var o=a*(1-Math.log(s)/Math.log(.6));return isNaN(o)?r:o}function pe(e){var t=Object(a.useState)(.5),n=Object(Z.a)(t,2),s=n[0],i=n[1],o=Object(a.useCallback)(function(t){var n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.maxVolume;if(.5===e)return 0;var n=t*(1-Math.log(e)/Math.log(window.q));return n===-1/0||isNaN(n)?-70:n}(t);e.eq.gainParameter.set(n),i(t)},[i]);return r.a.createElement("div",{className:e.type},r.a.createElement(te.Knob,{size:50,angleOffset:220,angleRange:280,value:s,min:0,max:1,onChange:o},r.a.createElement(te.Arc,{arcWidth:5,color:"white",background:"#6c757a"}),r.a.createElement(te.Pointer,{width:3,height:15,radius:10,type:"rect",color:"white"})))}function he(e){var t=e.sequencerEngine.channelMixer.mixEffects.getLowEQ(),n=e.sequencerEngine.channelMixer.mixEffects.getMidEQ(),a=e.sequencerEngine.channelMixer.mixEffects.getHighEQ();return r.a.createElement("div",{className:"eq-container"},r.a.createElement(pe,{eq:a,type:"high"}),r.a.createElement(pe,{eq:n,type:"mid"}),r.a.createElement(pe,{eq:t,type:"low"}))}window.q=.5,window.maxVolume=6;var de=n(44),fe=n.n(de),me=new U.a;var ve=Object(y.b)(function(e,t){return{masterVolume:e.sequencer.masterVolumes[t.track.id],isSelected:e.mix.selectedSequence===t.track.id,isPlaying:e.sequencer.isPlaying[t.track.id]}},function(e){return{setSelectedSequence:function(t){return e(Object(w.Xc)(t))}}})(function(e){var t=Object(a.useCallback)(function(){e.setSelectedSequence(e.track.id)},[e.track]),n=Object(a.useCallback)(function(t){e.sequencerEngine.setMasterVolume(t.target.value)},[e.sequencerEngine]),s=me.getColorForHash(e.track.id),i={backgroundColor:s},o={};return e.isSelected&&(o.border="1px solid "+s,o.backgroundColor=me.brighten(s,.1)),r.a.createElement("div",{style:o,onMouseDown:t,className:"channel-strip"},r.a.createElement(ne,{sequencerEngine:e.sequencerEngine}),r.a.createElement(he,{track:e.track,sequencerEngine:e.sequencerEngine}),r.a.createElement(re,{mixEffects:e.sequencerEngine.channelMixer.mixEffects}),r.a.createElement("div",{className:"fader-container"},r.a.createElement(fe.a,{value:e.masterVolume,change:n,step:.1,className:"spotlight-fader",max:6,min:-40,orientation:"vertical",reversed:!0})),r.a.createElement("div",{style:i,className:"channel-name"},r.a.createElement(ae,{play:function(){e.multiSequencerEngine.play(e.track)},isPlaying:e.isPlaying,sequencerEngine:e.sequencerEngine}),e.track.title),r.a.createElement(ce,{sequencerEngine:e.sequencerEngine,track:e.track}))}),ge=n(17),be=new U.a;var ye=Object(y.b)(function(e,t){return{muted:t.track.muted}},void 0)(function(e){var t=Object(a.useState)({}),n=Object(Z.a)(t,2),s=n[0],i=n[1],o=e.track.sample,c=void 0===o?void 0:o.getThumbnail(),u=Object(a.useCallback)(function(){e.track.mute(!e.muted)},[e.muted,e.track]);return Object(a.useEffect)(function(){var t={},n=void 0;if(void 0===c){var a=o&&void 0!==o.getId()?o.getId():e.track.getName();n=be.getColorForHash(a),t.backgroundColor=n}e.muted?t.opacity=.2:t.opacity=1,i(t)},[e.track,e.muted]),r.a.createElement("div",{onClick:u,style:s,className:"track-mute"},r.a.createElement(O,{condition:void 0!==c},r.a.createElement("img",{src:c})))});function ke(e){var t=[];for(var n in e.sequencerEngine.subSequences)t=[].concat(Object(ge.a)(t),Object(ge.a)(e.sequencerEngine.subSequences[n].tracks));return r.a.createElement("div",{className:"track-mutes"},t.map(function(e){return r.a.createElement(ye,{key:"mute-"+e.subSequence.id+"- "+e.trackNumber,track:e})}))}var Ee=new U.a;function Se(e,t){return void 0!==t?Ee.brighten(Ee.getColorForHash(e),t):Ee.getColorForHash(e)}var Oe=["A","B","C","D","E","F","G","H","I","J","K","L"];function we(e){var t=Object(a.useState)(1),n=Object(Z.a)(t,2),s=n[0],i=n[1],o=Object(a.useCallback)(function(t){e.subSequence.fade=t,i(t)},[i]);return r.a.createElement("div",{className:"sub-sequence-knob"},r.a.createElement(te.Knob,{size:50,angleOffset:220,angleRange:280,value:s,min:0,max:1,onChange:function(e){return o(e)}},r.a.createElement(te.Arc,{arcWidth:5,color:"white",background:"#6c757a"}),r.a.createElement(te.Pointer,{width:3,height:15,radius:10,type:"rect",color:"white"})),r.a.createElement("div",{className:"sub-sequence-name"},Oe[e.i]))}function Ce(e){var t=e.sequencerEngine.subSequences;return r.a.createElement("div",{className:"sub-sequence-knobs"},t.map(function(e,t){return r.a.createElement(we,{i:t,subSequence:e})}))}var Pe=Object(y.b)(function(e,t){return{selectedSequence:e.mix.selectedSequence,loadingSequence:e.sequencer.loadingSequence}},void 0)(function(e){var t=e.tracks.find(function(t){return t.id===e.selectedSequence});if(void 0===e.selectedSequence||void 0===t)return r.a.createElement("div",null);var n={backgroundColor:Se(e.selectedSequence)},a={backgroundColor:Se(e.selectedSequence,.1)},s=e.multiSequencerEngine.getSequencerEngine(e.selectedSequence);return r.a.createElement("div",{style:a,className:"sequence-module"},r.a.createElement("div",{style:n,className:"sequence-name"},t.title),r.a.createElement(ke,{sequencerEngine:s}),r.a.createElement(Ce,{sequencerEngine:s}))}),Te="REVERB",je="DELAY",xe="PHASER",Ne="LOW",qe="MID",Me="HIGH";function De(e){var t="frequency-option";return e.toggled&&(t+=" toggled"),r.a.createElement("div",{onClick:e.onClick,className:t},e.name)}function Ae(e){var t="effects-option";return e.toggled&&(t+=" toggled"),r.a.createElement("div",{onClick:e.onClick,className:t},e.name)}var Re=Object(y.b)(function(e){return{mixerEffects:e.explore.mixerEffects,eqEffects:e.explore.eqEffects}},function(e){return{setExploreMixerEffect:function(t,n){return e(Object(w.ub)(t,n))},setExploreEQEffect:function(t,n){return e(Object(w.tb)(t,n))}}})(function(e){var t=Object(a.useCallback)(function(t){e.setExploreMixerEffect(t,!e.mixerEffects[t]),e.multiSequencerEngine.auxEffects.toggleEffect(t)},[e.mixerEffects]),n=Object(a.useCallback)(function(t){e.setExploreEQEffect(t,!e.eqEffects[t]),e.multiSequencerEngine.auxEffects.toggleEQ(t)},[e.eqEffects]);return r.a.createElement("div",{className:"channel-strip side"},r.a.createElement("div",{className:"transpose-container"},"Transpose"),r.a.createElement("div",{className:"eq-container"},r.a.createElement("div",{className:"high"},"High"),r.a.createElement("div",{className:"high"},"Mid"),r.a.createElement("div",{className:"high"},"Low")),r.a.createElement("div",{className:"effects-container"},"FX",r.a.createElement("div",{className:"effects-frequencies"},r.a.createElement(De,{toggled:e.eqEffects[Ne],name:"Low",onClick:function(){return n(Ne)}}),r.a.createElement(De,{toggled:e.eqEffects[qe],name:"Mid",onClick:function(){return n(qe)}}),r.a.createElement(De,{toggled:e.eqEffects[Me],name:"High",onClick:function(){return n(Me)}})),r.a.createElement(Ae,{toggled:e.mixerEffects[je],name:"Delay",onClick:function(){return t(je)}}),r.a.createElement(Ae,{toggled:e.mixerEffects[Te],name:"Reverb",onClick:function(){return t(Te)}}),r.a.createElement(Ae,{toggled:e.mixerEffects[xe],name:"Phaser",onClick:function(){return t(xe)}})))});var Ie=Object(y.b)(function(e){return{loadingSequence:e.sequencer.loadingSequence}},null)(function(e){return r.a.createElement("div",{className:"mixer"},r.a.createElement("div",{className:"channel-strips-container"},r.a.createElement(Re,{multiSequencerEngine:e.multiSequencerEngine}),e.tracks.filter(function(t){return n=t,!(void 0!==e.loadingSequence&&e.loadingSequence[n.id]);var n}).map(function(t){return r.a.createElement(ve,{key:t.id,multiSequencerEngine:e.multiSequencerEngine,sequencerEngine:(n=t.id,e.multiSequencerEngine.getSequencerEngine(n)),track:t});var n}),r.a.createElement(Pe,{tracks:e.tracks,multiSequencerEngine:e.multiSequencerEngine})))}),Le=n(175);function Fe(e){var t=[],n=function(e){var t=new Set(e.map(function(e){return e.newSequence}));return e.filter(function(e){return null===e.previousSequence||!t.has(e.previousSequence)||e.previousSequence===e.newSequence})}(e);for(var a in n){var r=Be(Ve(n[a],e,!0));t=[].concat(Object(ge.a)(t),Object(ge.a)(r))}return t.sort(function(e,t){return t.blockNumber-e.blockNumber}),t}function Ve(e,t){if(!(arguments.length>2&&void 0!==arguments[2]&&arguments[2])&&e.newSequence===e.previousSequence)return{sequence:e};var n=t.filter(function(t){return t.previousSequence===e.newSequence});return 0===n.length?{sequence:e}:{sequence:e,children:n.map(function(e){return Ve(e,t)})}}function Be(e){var t=function e(t){if(void 0===t)return[];var n=t.sequence,a=t.children||[],r=[n.user];for(var s in a)r=[].concat(Object(ge.a)(r),Object(ge.a)(e(a[s])));return Array.from(new Set(r))}(e),n=function e(t){if(void 0===t)return[];var n=[t.sequence];var a=t.children||[];for(var r in a)n=[].concat(Object(ge.a)(n),Object(ge.a)(e(a[r])));return n}(e);return t.map(function(e){return function(e,t){var n=0,a=void 0;for(var r in e){var s=e[r];s.user===t&&s.blockNumber>n&&(a=e[r],n=e[r].blockNumber)}return a}(n,e)}).map(function(t){return Object(X.a)({},t,{collaborators:Ue(t,e).reverse()})})}function Ue(e,t){if(void 0===t)return[];if(t.sequence.newSequence===e.newSequence)return[e.user];var n=[t.sequence.user],a=t.children||[];for(var r in a)n=[].concat(Object(ge.a)(n),Object(ge.a)(Ue(e,a[r])));return Array.from(new Set(n))}var He="/public/convolver/PrimeXtraLong.wav",Je=new(function(){function e(){Object(o.a)(this,e),this.DEFAULT_BUFFER=new q.a.Buffer(window.installation?"/public/"+He:He)}return Object(c.a)(e,[{key:"setSampleRate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"interactive";q.a.setContext(new AudioContext({sampleRate:e,latencyHint:t})),window.context=q.a.Master.context,console.log("setting context = "),console.log(q.a.Master.context),this.DEFAULT_BUFFER=new q.a.Buffer(window.installation?"/public/"+He:He)}}]),e}()),Ge=n(37),ze=n(20),_e=n(32),We=n(84),Ke=function(){function e(t,n){Object(o.a)(this,e),this.step=t,this.value=n,this.id=Object(We.uuid)()}return Object(c.a)(e,[{key:"getJson",value:function(){return{step:this.step,value:this.value,id:this.id}}}]),e}(),Ye="a-rate",Qe={};function Xe(e){if(e in Qe)return Qe[e];var t="0:0:"+e/2;return Qe[e]=t,t}var Ze=function(){function e(t){Object(o.a)(this,e),this.id=Object(We.uuid)(),this.parameter=t,this.automations=[],this.nextCache={},this.previousCache={}}return Object(c.a)(e,[{key:"getPoint",value:function(e){return this.automations.find(function(t){return t.id===e.id})}},{key:"movePoint",value:function(e,t,n){e=this.getPoint(e);var a=this.getNextEvent(e),r=this.getPreviousEvent(e);(void 0===a||t<a.step)&&(void 0===r||t>r.step)?(e.step=t,e.value=n):e.value=n,this.schedule(),this.updateRedux()}},{key:"updateRedux",value:function(){this.store&&this.store.dispatch(Object(w.ec)(this.parameter,Object(ge.a)(this.automations)))}},{key:"getNextEvent",value:function(e){if(e.step in this.nextCache)return this.nextCache[e.step];for(var t=0;t<this.automations.length;t++)if(this.automations[t].step>e.step)return this.nextCache[e.step]=this.automations[t],this.automations[t];this.nextCache[e.step]=void 0}},{key:"getPreviousEvent",value:function(e){var t=void 0;if(e.step in this.previousCache)return this.previousCache[e.step];for(var n=0;n<this.automations.length-1;n++){if(this.automations[n+1].step>e.step)return this.previousCache[e.step]=t,t;t=this.automations[n]}this.previousCache[e.step]=void 0}},{key:"getValueAtStep",value:function(e){var t,n=this.automations[0],a=this.parameter.get();if("string"===typeof a&&(a=new q.a.Time(a).toSeconds()),0===this.automations.length)return a;for(var r in this.automations){r=parseInt(r);var s=this.automations[r];if(t=s,s.step<=e&&this.automations[r+1]&&e<this.automations[r+1].step){var i=this.automations[r+1],o=i.step-s.step,c=e-s.step;return s.value+(i.value-s.value)*(c/o)}}return t&&e>=t.step?t.value:n?n.value:a}},{key:"removeBreakPoint",value:function(e){e=this.getPoint(e);var t=this.automations.indexOf(e);t>-1&&this.automations.splice(t,1),this.updateRedux()}},{key:"addBreakPoint",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(We.uuid)();this.cache={},this.parameter.automationRate!==Ye&&(this.parameter.automationRate=Ye);var a=new Ke(e,t);return a.id=n,this.automations.push(a),this.automations.sort(function(e,t){return e.step-t.step}),this.schedule(),this.updateRedux(),a}},{key:"clear",value:function(){this.eventIds&&this.eventIds.forEach(function(e){return q.a.Transport.clear(e)})}},{key:"schedule",value:function(){var e=this;this.clear(),this.nextCache={},this.previousCache={},this.eventIds=this.automations.map(function(t){return q.a.Transport.schedule(function(n){if(e.parameter.audioParam||e.parameter.audioParams){var a=Xe(t.step),r=(q.a.Master.context.currentTime,e.getNextEvent(t));if(r){var s=new q.a.Time(Xe(r.step))-new q.a.Time(a);e.parameter.audioParams?e.parameter.audioParams.forEach(function(e){return e.rampTo(r.value,s,n+.003)}):e.parameter.audioParam&&e.parameter.audioParam.rampTo(r.value,s,n+.003)}}else e.parameter.set(t.value,!1,!1,Xe(t.step))},Xe(t.step))})}},{key:"getJson",value:function(){return{id:this.id,automations:this.automations.map(function(e){return e.getJson()})}}},{key:"fromJson",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.id,a=e.automations;if(this.id=n,void 0===a||0===a.length)return this;for(var r in a){var s=a[r],i=s.step,o=s.value,c=s.id,u=new Ke(i,o);void 0!==c&&(u.id=c),this.automations.push(u)}return t&&this.schedule(),this.updateRedux(),this}},{key:"getCopy",value:function(){var t=new e(this.parameter);return t.fromJson(this.getJson(),!1),t}},{key:"dispose",value:function(){this.clear(),this.automations=void 0,this.eventIds=void 0}}]),e}(),$e=n(58),et=0,tt=function(){function e(){Object(o.a)(this,e),this.canceled=!1,this.id=et++}return Object(c.a)(e,[{key:"setValue",value:function(e){}},{key:"cancel",value:function(){this.canceled=!0}},{key:"isDeterministic",value:function(){return!1}},{key:"isSkippable",value:function(){return!0}},{key:"isPrunable",value:function(){return!1}},{key:"setTime",value:function(e,t){this.step=t,this.time=e}},{key:"scheduleEvent",value:function(e,t,n){var a=this;e+=this.time,setTimeout(function(){if(!a.canceled)try{a.executeEvent(t,n)}catch(e){console.log("got an error executing event = "),console.log(a),console.log(e)}},e-0)}},{key:"getValue",value:function(){}},{key:"executeEvent",value:function(e){}},{key:"getType",value:function(){}},{key:"getJson",value:function(){return{type:this.getType(),time:this.time,step:this.step}}},{key:"fromJson",value:function(e){return this.time=e.time,this.step=e.step,this}},{key:"isEquivalent",value:function(){return!1}},{key:"restart",value:function(){}},{key:"getCopy",value:function(){}},{key:"loadSubSequence",value:function(e,t){void 0!==e.subSequence?this.subSequence=t.getSubSequence(e.subSequence):this.subSequence=t.currentSubSequence}},{key:"value",get:function(){return this.getValue()},set:function(e){this.setValue(e)}}]),e}(),nt=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this))).patternNumber=e,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getValue",value:function(){return this.patternNumber}},{key:"isSkippable",value:function(){return!1}},{key:"isDeterministic",value:function(){return!0}},{key:"executeEvent",value:function(e){e.switchToPatternHelper(this.patternNumber)}},{key:"getJson",value:function(){return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{patternNumber:this.patternNumber})}},{key:"getCopy",value:function(e){var n=new t;return n.fromJson(this.getJson(),e),n}},{key:"getType",value:function(){return Ot}},{key:"fromJson",value:function(e,n){return Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e),this.loadSubSequence(e,n),this.patternNumber=e.patternNumber,this}}]),t}(tt),at=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this))).subSequence=e,a.volume=n,a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"setValue",value:function(e){this.volume=e}},{key:"getValue",value:function(){return this.volume}},{key:"isSkippable",value:function(){return!1}},{key:"executeEvent",value:function(e,t){if(void 0!==t&&void 0!==this.subSequence&&void 0!==this.subSequence.linearRampFade){var n=(t.step-this.step)*new q.a.Time("32n").toMilliseconds()/1e3;this.subSequence.linearRampFade(Math.max(0,this.value),Math.max(0,t.volume),n)}}},{key:"getType",value:function(){return At}},{key:"getCopy",value:function(e){return(new t).fromJson(this.getJson(),e)}},{key:"getJson",value:function(){return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{subSequence:this.subSequence.id,volume:this.volume})}},{key:"fromJson",value:function(e,n){return Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e),this.subSequence=n.getSubSequence(e.subSequence),this.volume=e.volume,this}}]),t}(tt),rt=function(){function e(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object(o.a)(this,e),this.effectNumber=t,this.parameter=n,this.value=a,this.automationContext=r}return Object(c.a)(e,[{key:"setAtTime",value:function(e,t){this.parameter.set(this.value,void 0,void 0,e)}},{key:"getJson",value:function(){return Object(X.a)({},this.automationContext,{effectNumber:this.effectNumber,parameterName:this.parameter.name,value:this.value})}},{key:"getCopy",value:function(){return new e(this.effectNumber,this.parameter,this.value,this.automationContext)}}]),e}(),st=function(){function e(t,n,a,r){Object(o.a)(this,e);var s=void 0!==t?t.store:void 0;this.track=r,this.context=a,this.mixSession=n,this.sequencerEngine=t,this.stepNumber=void 0,this.position=0,this.id=Object(We.uuid)(),this.parameters=[],this.on=!1,this.durationParameter=new Wt("Duration",this,function(e,t){return t},{min:0,max:256,unit:"1/16th",defaultValue:null}),this.registerParameter(this.durationParameter,s,n,a),this.transposeParameter=new Wt("Tranpose",this,function(e,t){return t},{min:-32,max:32,unit:"",defaultValue:null}),this.registerParameter(this.transposeParameter,s,n,a),this.chopParameter=new Kt("Chop",this,function(e,t){return t},{min:1,max:32,unit:"",defaultValue:null}),this.registerParameter(this.chopParameter,s,n,a),this.chopDurationParameter=new Kt("Chop Duration",this,function(e,t){return t},{min:1,max:32,unit:"",defaultValue:null}),this.registerParameter(this.chopDurationParameter,s,n,a),this.panningParameter=new Wt("Panning",this,function(e,t){return t},{min:-1,max:1,unit:"",defaultValue:null}),this.registerParameter(this.panningParameter,s,n,a),this.velocityParameter=new Wt("Velocity",this,function(e,t){return t},{min:0,max:1,unit:"",defaultValue:null}),this.registerParameter(this.velocityParameter,s,n,a),this.startParameter=new Wt("Start",this,function(e,t){return t},{min:0,max:100,unit:"%",defaultValue:null}),this.registerParameter(this.startParameter,s,n,a),this.attackParameter=new Wt("Attack",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:null}),this.registerParameter(this.attackParameter,s,n,a),this.releaseParameter=new Wt("Release",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:null}),this.registerParameter(this.releaseParameter,s,n,a),this.sliceParameter=new Kt("Slice",this,function(e,t){return t},{min:0,max:64,unit:"",defaultValue:null,automatable:!1}),this.registerParameter(this.sliceParameter,s,n,a),this.pitchAttackParameter=new Wt("Pitch Attack",this,function(e,t){return t},{min:.01,max:1e4,unit:"",defaultValue:null}),this.registerParameter(this.pitchAttackParameter,s,n,a),this.pitchDecayParameter=new Wt("Pitch Decay",this,function(e,t){return t},{min:.01,max:1e4,unit:"",defaultValue:null}),this.registerParameter(this.pitchDecayParameter,s,n,a),this.pitchSustainParameter=new Wt("Pitch Sustain",this,function(e,t){return t},{min:-10,max:10,unit:"",defaultValue:null}),this.registerParameter(this.pitchSustainParameter,s,n,a),this.pitchReleaseParameter=new Wt("Pitch Release",this,function(e,t){return t},{min:.01,max:1e4,unit:"",defaultValue:null}),this.registerParameter(this.pitchReleaseParameter,s,n,a),this.selectedRecordingParameter=new Wt("Selected Recording",this,function(e,t){return t},{min:1,max:100,unit:"",defaultValue:null}),this.registerParameter(this.selectedRecordingParameter,s,n,a),this.monophonicParameter=new Wt("Monophonic",this,function(e,t){return t},{min:!1,max:!0,unit:"",defaultValue:null}),this.registerParameter(this.monophonicParameter,s,n,a),this.reverseParameter=new Wt("reverse",this,function(e,t){return t},{min:0,max:1,unit:"",defaultValue:null}),this.registerParameter(this.reverseParameter,s,n,a),this.transposeMatchParameter=new Wt("Transpose Match",this,function(e,t){return t},{min:0,max:20,unit:"",defaultValue:null}),this.registerParameter(this.transposeMatchParameter,s,n,a),this.effectAutomations=new it,this.polyphonicSteps=[],this.nextStepData=void 0}return Object(c.a)(e,[{key:"registerParameter",value:function(e,t,n,a){e.setStore(t),void 0!==n&&e.setMixSession(n),void 0!==a&&e.setContext(a),this.parameters.push(e)}},{key:"triggerAutomations",value:function(e,t){e=new q.a.Time(e)-q.a.Master.context.currentTime,this.effectAutomations.forMidiEffects().forEach(function(e){return e.setAtTime()}),null!==this.panningParameter.get()&&t.setPanning(this.panning,e),this.effectAutomations.forAudioEffects().forEach(function(t){return t.setAtTime(e)}),this.effectAutomations.forInstruments().forEach(function(t){return t.setAtTime(e)})}},{key:"addEffectAutomation",value:function(e){this.effectAutomations.push(e)}},{key:"addStep",value:function(e){if(!window.dontAdd){if(this===e||this.id===e.id||this.transpose===e.transpose)return e;if(void 0===this.nextStepData){if(!this.on)return e;this.nextStepData=e}else this.nextStepData=this.nextStepData.addStep(e);return this}}},{key:"hasStep",value:function(e){return this===e||this.id===e.id||void 0!==this.nextStepData&&this.nextStepData.hasStep(e)}},{key:"deleteStep",value:function(t){if(this===t||this.id===t.id){if(void 0===this.nextStepData)return new e;var n=this.nextStepData;return this.nextStepData=void 0,n}if(void 0!==this.nextStepData){var a=this.nextStepData.deleteStep(t);if(void 0!==a)return this.nextStepData=a,this}}},{key:"containsStep",value:function(e){return e.id===this.id||void 0!==this.nextStepData&&this.containsStep(this.nextStepData)}},{key:"getStepDataForTranspose",value:function(e,t){if(Math.round(this.transpose)==e||t&&null===this.transpose)return this;var n=this.getPolyphony(),a=-1;for(var r in n){var s=n[r];if(Math.round(s.transpose)==e||t&&null===s.transpose){a=r;break}}return-1!=a?n[a]:void 0}},{key:"deleteTranspose",value:function(e,t){if(this.transpose===e||t&&null===this.transpose){var n=this.polyphonicSteps;this.clear(),n.length>0&&(this.copyFrom(n[0]),this.polyphonicSteps=n.slice(1))}else{var a=this.polyphonicSteps.filter(function(n){return n.transpose==e||t&&null==n.transpose});if(a.length>0){var r=this.polyphonicSteps.indexOf(a[0]);this.polyphonicSteps.splice(r,1)}}}},{key:"getPolyphony",value:function(){for(var e=this,t=[];void 0!==e;)e.track=this.track,t.push(e),e=e.nextStepData;return t}},{key:"equals",value:function(e){return!(this.on!=e.on||this.duration!=e.duration||this.transpose!=e.transpose||this.chop!=e.chop||this.chopDuration!=e.chopDuration||this.velocity!=e.velocity||this.start!=e.start||this.panning!=e.panning||this.attack!=e.attack||this.reverse!=e.reverse||this.release!=e.release||this.slice!=e.slice||this.pitchAttack!==e.pitchAttack||this.pitchDecay!==e.pitchDecay||this.pitchSustain!==e.pitchSutain||this.selectedRecording!==e.selectedRecording||this.pitchRelease!==e.pitchRelease)}},{key:"loadFromJson",value:function(t,n){var a=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,c=arguments.length>6?arguments[6]:void 0;return this.on=t.on,void 0!==t.id&&(this.id=t.id),this.duration=void 0===t.duration?null:t.duration,void 0!==t.durationParameter&&this.durationParameter.fromJson(t.durationParameter,i),this.panning=void 0===t.panning?null:t.panning,void 0!==t.transpose&&(this.transpose=t.transpose),this.transposeParameter.fromJson(t.transposeParameter,i),void 0!==t.velocity&&(this.velocity=t.velocity),this.velocityParameter.fromJson(t.velocityParameter,i),void 0!==t.start&&(this.start=t.start),this.startParameter.fromJson(t.startParameter,i),void 0!==t.chop&&(this.chop=t.chop),this.chopParameter.fromJson(t.chopParameter,i),this.chopDuration=void 0===t.chopDuration?null:t.chopDuration,void 0!==t.attack&&(this.attack=t.attack),this.attackParameter.fromJson(t.attackParameter,i),void 0!==t.release&&(this.release=t.release),this.releaseParameter.fromJson(t.releaseParameter,i),this.slice="slice"in t?t.slice:0,void 0!==t.pitchAttack&&(this.pitchAttack=t.pitchAttack),this.pitchAttackParameter.fromJson(t.pitchAttackParameter,i),void 0!==t.pitchDecay&&(this.pitchDecay=t.pitchDecay),this.pitchDecayParameter.fromJson(t.pitchDecayParameter,i),void 0!==t.pitchSustain&&(this.pitchSustain=t.pitchSustain),this.pitchSustainParameter.fromJson(t.pitchSustainParameter,i),void 0!==t.pitchRelease&&(this.pitchRelease=t.pitchRelease),this.pitchReleaseParameter.fromJson(t.pitchReleaseParameter,i),void 0!==t.selectedRecording&&(this.selectedRecording=t.selectedRecording),this.monophonicParameter.fromJson(t.monophonicParameter,i),void 0!==t.monophonic&&(this.monophonic=t.monophonic),this.selectedRecordingParameter.fromJson(t.selectedRecordingParameter,i),this.reverse=void 0===t.reverse?r:t.reverse,void 0!==t.effectAutomations&&this.loadAutomations(t.effectAutomations,o,n,c),"polyphonicSteps"in t&&!s&&(t.polyphonicSteps.map(function(t){var n=new e;return n.stepNumber=a.stepNumber,n.loadFromJson(t,void 0,null,!0),n}).forEach(function(e){return a.addStep(e)}),this.nextStepData),this}},{key:"clearAutomations",value:function(){this.automations.clear()}},{key:"loadAutomations",value:function(e,t,n,a){for(var r=0;r<e.length;r++){var s=e[r],i=s.effectNumber,o=s.parameterName,c=s.value,u=n[i],l=a[i];void 0!==u&&this.findAutomationParameter(u,o,i,c),void 0!==l&&this.findAutomationParameter(l,o,i,c),void 0===i&&this.findAutomationInstrumentParameter(t.instrument,s,o,c)}}},{key:"findAutomationParameter",value:function(e,t,n,a){var r=e.parameters.filter(function(e){return t===e.name});if(r.length>0){var s=r[0];this.effectAutomations.set(s,new rt(n,s,a))}}},{key:"findAutomationInstrumentParameter",value:function(e,t,n,a){var r=e.findParameter(t,n),s=Object(X.a)({},t);delete s.name,delete s.value,delete s.effectNumber,void 0!==r&&this.effectAutomations.set(r,new rt(void 0,r,a,s))}},{key:"loadDefaults",value:function(){this.on=!1,this.reverse=!1,this.transpose=0,this.duration=1,this.velocity=1,this.start=0,this.chop=1,this.chopDuration=1,this.attack=0,this.release=15,this.slice=0,this.pitchAttack=.01,this.pitchDecay=.01,this.pitchSustain=0,this.pitchRelease=.01,this.monophonic=!1,this.selectedRecording=0}},{key:"clear",value:function(){this.on=!1,this.reverse=null,this.transpose=null,this.panning=null,this.duration=null,this.velocity=null,this.start=null,this.chop=null,this.chopDuration=null,this.attack=null,this.release=null,this.pitchAttack=null,this.pitchDecay=null,this.pitchRelease=null,this.pitchSustain=null,this.selectedRecording=null,this.transposeMatch=null,this.slice=null,this.polyphonicSteps=[],this.nextStepData=void 0,this.monophonic=null}},{key:"getCopy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=void 0;return o=void 0!==this.stepDataCopy&&s?this.stepDataCopy:r?new e:new e(this.sequencerEngine,this.mixSession),i&&(this.stepDataCopy=o),o.stepNumber=this.stepNumber,n&&(o.id=this.id),o.track=this.track,o.position=this.position,o.on=this.on,o.effectAutomations=this.effectAutomations.getCopy(),o.durationParameter.copyFrom(this.durationParameter,this.sequencerEngine,a),o.chopParameter.copyFrom(this.chopParameter,this.sequencerEngine,a),o.panningParameter.copyFrom(this.panningParameter,this.sequencerEngine,a),o.transposeParameter.copyFrom(this.transposeParameter,this.sequencerEngine,a),o.velocityParameter.copyFrom(this.velocityParameter,this.sequencerEngine,a),o.startParameter.copyFrom(this.startParameter,this.sequencerEngine,a),o.attackParameter.copyFrom(this.attackParameter,this.sequencerEngine,a),o.releaseParameter.copyFrom(this.releaseParameter,this.sequencerEngine,a),o.sliceParameter.copyFrom(this.sliceParameter,this.sequencerEngine,a),o.transposeMatchParameter.copyFrom(this.transposeMatchParameter,this.sequencerEngine,a),t||this.getPolyphony().map(function(e){return e.getCopy(!0,n,a,r,s)}).slice(1).forEach(function(e){return o.addStep(e)}),o.pitchAttackParameter.copyFrom(this.pitchAttackParameter,this.sequencerEngine,a),o.pitchDecayParameter.copyFrom(this.pitchDecayParameter,this.sequencerEngine,a),o.pitchSustainParameter.copyFrom(this.pitchSustainParameter,this.sequencerEngine,a),o.pitchReleaseParameter.copyFrom(this.pitchReleaseParameter,this.sequencerEngine,a),o.selectedRecordingParameter.copyFrom(this.selectedRecordingParameter,this.sequencerEngine,a),o.monophonicParameter.copyFrom(this.monophonicParameter,this.sequencerEngine,a),o.reverse=this.reverse,o}},{key:"copyFrom",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.on=e.on,this.stepNumber=e.stepNumber,this.duration=e.durationParameter.get(),this.panning=e.panningParameter.get(),this.chop=e.chopParameter.get(),this.chopDuration=e.chopDurationParameter.get(),this.transpose=e.transposeParameter.get(),this.velocity=e.velocityParameter.get(),this.start=e.startParameter.get(),this.attack=e.attackParameter.get(),this.release=e.releaseParameter.get(),this.slice=e.sliceParameter.get(),this.pitchAttack=e.pitchAttackParameter.get(),this.pitchDecay=e.pitchDecayParameter.get(),this.pitchSustain=e.pitchSustainParameter.get(),this.pitchRelease=e.pitchReleaseParameter.get(),this.selectedRecording=e.selectedRecordingParameter.get(),this.transposeMatch=e.transposeMatchParameter.get(),this.monophonic=e.monophonicParameter.get(),this.reverse=e.reverse,n||e.getPolyphony().slice(1).map(function(e){return e.getCopy()}).forEach(function(e){return t.addStep(e)})}},{key:"getJson",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t={on:this.on,newPitchSustain:!0,id:this.id};return null!==this.reverse&&(t.reverse=this.reverse),(this.durationParameter.lfos.length>0||Object.keys(this.durationParameter.patternToValue).length>0||null!==this.durationParameter.get())&&(t.durationParameter=this.durationParameter.getJson()),null!==this.durationParameter.get()&&(t.duration=this.duration),null!==this.panningParameter.get()&&(t.panning=this.panning),(this.chopParameter.lfos.length>0||Object.keys(this.chopParameter.patternToValue).length>0||null!==this.chopParameter.get())&&(t.chopParameter=this.chopParameter.getJson()),(this.transposeParameter.lfos.length>0||Object.keys(this.transposeParameter.patternToValue).length>0||null!==this.transposeParameter.get())&&(t.transposeParameter=this.transposeParameter.getJson()),(this.velocityParameter.lfos.length>0||Object.keys(this.velocityParameter.patternToValue).length>0||null!==this.velocityParameter.get())&&(t.velocityParameter=this.velocityParameter.getJson()),(this.startParameter.lfos.length>0||Object.keys(this.startParameter.patternToValue).length>0||null!==this.startParameter.get())&&(t.startParameter=this.startParameter.getJson()),(this.attackParameter.lfos.length>0||Object.keys(this.attackParameter.patternToValue).length>0||null!==this.attackParameter.get())&&(t.attackParameter=this.attackParameter.getJson()),null!==this.attackParameter.get()&&(t.attack=this.attack),(this.releaseParameter.lfos.length>0||Object.keys(this.releaseParameter.patternToValue).length>0||null!=this.releaseParameter.get())&&(t.releaseParameter=this.releaseParameter.getJson()),null!==this.slice&&(t.slice=this.slice),(this.pitchAttackParameter.lfos.length>0||Object.keys(this.pitchAttackParameter.patternToValue).length>0||null!=this.pitchAttackParameter.get())&&(t.pitchAttackParameter=this.pitchAttackParameter.getJson()),(this.pitchDecayParameter.lfos.length>0||Object.keys(this.pitchDecayParameter.patternToValue).length>0||null!=this.pitchDecayParameter.get())&&(t.pitchDecayParameter=this.pitchDecayParameter.getJson()),(this.pitchSustainParameter.lfos.length>0||Object.keys(this.pitchSustainParameter.patternToValue).length>0||null!=this.pitchSustainParameter.get())&&(t.pitchSustainParameter=this.pitchSustainParameter.getJson()),(this.pitchReleaseParameter.lfos.length>0||Object.keys(this.pitchReleaseParameter.patternToValue).length>0||null!=this.pitchReleaseParameter.get())&&(t.pitchReleaseParameter=this.pitchReleaseParameter.getJson()),(this.selectedRecordingParameter.lfos.length>0||Object.keys(this.selectedRecordingParameter.patternToValue).length>0||null!=this.selectedRecordingParameter.get())&&(t.selectedRecordingParameter=this.selectedRecordingParameter.getJson()),(Object.keys(this.monophonicParameter.patternToValue).length>0||null!=this.monophonicParameter.get())&&(t.monophonicParameter=this.monophonicParameter.getJson()),e||(t.polyphonicSteps=this.getPolyphony().slice(1).map(function(e){return e.getJson(!0)})),t.effectAutomations=this.effectAutomations.automations.map(function(e){return e.getJson()}),t}},{key:"trackData",get:function(){return void 0!==this.track?this.track.trackData:this}},{key:"duration",get:function(){return null===this.durationParameter.get()?this.trackData.durationParameter.get():this.durationParameter.get()},set:function(e){this.durationParameter.set(e)}},{key:"panning",get:function(){return null===this.panningParameter.get()?this.trackData.panningParameter.get():this.panningParameter.get()},set:function(e){this.panningParameter.set(e)}},{key:"transpose",get:function(){return null===this.transposeParameter.get()?this.trackData.transposeParameter.get():this.transposeParameter.get()},set:function(e){this.transposeParameter.set(e)}},{key:"velocity",get:function(){return null===this.velocityParameter.get()?this.trackData.velocityParameter.get():this.velocityParameter.get()},set:function(e){this.velocityParameter.set(e)}},{key:"start",get:function(){return null===this.startParameter.get()?this.trackData.startParameter.get():this.startParameter.get()},set:function(e){this.startParameter.set(e)}},{key:"chop",get:function(){return null===this.chopParameter.get()?this.trackData.chopParameter.get():this.chopParameter.get()},set:function(e){this.chopParameter.set(e)}},{key:"chopDuration",get:function(){return null===this.chopDurationParameter.get()?this.trackData.chopDurationParameter.get():this.chopDurationParameter.get()},set:function(e){this.chopDurationParameter.set(e)}},{key:"slice",get:function(){return null===this.sliceParameter.get()?this.trackData.sliceParameter.get():this.sliceParameter.get()},set:function(e){this.sliceParameter.set(e)}},{key:"attack",get:function(){return null===this.attackParameter.get()?this.trackData.attackParameter.get():this.attackParameter.get()},set:function(e){this.attackParameter.set(e)}},{key:"release",get:function(){return null===this.releaseParameter.get()?this.trackData.releaseParameter.get():this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e)}},{key:"pitchAttack",get:function(){return null===this.pitchAttackParameter.get()?this.trackData.pitchAttackParameter.get():this.pitchAttackParameter.get()},set:function(e){this.pitchAttackParameter.set(e)}},{key:"pitchDecay",get:function(){return null===this.pitchDecayParameter.get()?this.trackData.pitchDecayParameter.get():this.pitchDecayParameter.get()},set:function(e){this.pitchDecayParameter.set(e)}},{key:"pitchSustain",set:function(e){this.pitchSustainParameter.set(e)},get:function(){return null===this.pitchSustainParameter.get()?this.trackData.pitchSustainParameter.get():this.pitchSustainParameter.get()}},{key:"pitchRelease",get:function(){return null===this.pitchReleaseParameter.get()?this.trackData.pitchReleaseParameter.get():this.pitchReleaseParameter.get()},set:function(e){this.pitchReleaseParameter.set(e)}},{key:"reverse",set:function(e){this.reverseParameter.set(e)},get:function(){return null===this.reverseParameter.get()?this.trackData.reverseParameter.get():this.reverseParameter.get()}},{key:"transposeMatch",set:function(e){this.transposeMatchParameter.set(e)},get:function(){return this.transposeMatchParameter.get()}},{key:"selectedRecording",get:function(){return null===this.selectedRecordingParameter.get()?this.trackData.selectedRecordingParameter.get():this.selectedRecordingParameter.get()},set:function(e){this.selectedRecordingParameter.set(e)}},{key:"monophonic",set:function(e){this.monophonicParameter.set(e)},get:function(){return null===this.monophonicParameter.get()?this.trackData.monophonicParameter.get():this.monophonicParameter.get()}}]),e}(),it=function(){function e(){Object(o.a)(this,e),this.automations=[]}return Object(c.a)(e,[{key:"clear",value:function(){this.automations=[]}},{key:"get",value:function(e){var t=this.automations.filter(function(t){return t.parameter===e});if(t.length>0)return t[0]}},{key:"delete",value:function(e){var t=-1;for(var n in this.automations)this.automations[n].parameter===e&&(t=n);-1!==t&&this.automations.splice(t,1)}},{key:"set",value:function(e,t){this.automations.push(t)}},{key:"trigger",value:function(e,t){this.automations.forEach(function(n){return n.setAtTime(e,t)})}},{key:"isEmpty",value:function(){return 0==this.automations.length}},{key:"forAudioEffects",value:function(){return this.automations.filter(function(e){return e.parameter.context.effect}).filter(function(e){return!e.parameter.context.effect.isMidiEffect()})}},{key:"forMidiEffects",value:function(){return this.automations.filter(function(e){return e.parameter.context.effect}).filter(function(e){return e.parameter.context.effect.isMidiEffect()})}},{key:"forInstruments",value:function(){return this.automations.filter(function(e){return e.parameter.context.track}).filter(function(e){return void 0!==e.parameter.context.track.instrument})}},{key:"getCopy",value:function(){var t=new e;return t.automations=this.automations.map(function(e){return e.getCopy()}),t}}]),e}(),ot=st,ct=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(o.a)(this,e),this.track=t,this.isTriplet=n,this.steps={0:new ot(void 0,void 0,void 0,t)}}return Object(c.a)(e,[{key:"getAllOnSteps",value:function(){var e=[];for(var t in this.steps)e=e.concat(this.steps[t].getPolyphony().filter(function(e){return e.on}));return e}},{key:"getStep",value:function(e){return void 0===this.steps[e]?new ot(void 0,void 0,void 0,this.track):this.steps[e]}},{key:"setStep",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t.track=this.track,this.isTriplet||(t.position=parseFloat(e)),n&&void 0!==this.steps[e]&&this.steps[e].on&&this.steps[e].getPolyphony().length>=1?this.steps[e].addStep(t):this.steps[e]=t}},{key:"setStepAtPosition",value:function(e,t){e.track=this.track,this.isTriplet||(e.position=parseFloat(t)),this.steps[t]=e}},{key:"clear",value:function(){this.steps={0:new ot(void 0,void 0,void 0,this.track)}}},{key:"getCopy",value:function(){var t=new e(this.track);for(var n in t.isTriplet=t.isTriplet,this.steps)t.setStep(n,this.steps[n].getCopy(!1,!1,!1,!0,!1));return t}},{key:"getJson",value:function(){var e={};for(var t in this.steps)e[t]=this.steps[t].getJson();return e}},{key:"anyOn",value:function(){for(var e in this.steps)if(this.steps[e].getPolyphony().some(function(e){return e.on}))return!0;return!1}},{key:"anyEffectAutomation",value:function(){for(var e in this.steps)if(this.steps[e].getPolyphony().some(function(e){return!e.effectAutomations.isEmpty()}))return!0;return!1}},{key:"anyOnAfter",value:function(e,t,n){for(var a in e=parseFloat(e),this.steps){if(parseFloat(a)+1e-5>=e&&this.steps[a].getPolyphony().some(function(e){return e.on&&(void 0===t||n&&null==e.transpose||e.transpose===t)}))return!0}return!1}},{key:"clearAfterIfOn",value:function(e,t,n){var a=!1;for(var r in this.steps)r>=e&&this.steps[r].getPolyphony().some(function(e){return e.on&&(void 0==t||n&&null==e.transpose||e.transpose==t)})&&(void 0!==t?this.steps[r].deleteTranspose(t,n):this.steps[r]=new ot,a=!0);return a}},{key:"clearBeforeIfOn",value:function(e,t,n){var a=!1;for(var r in this.steps)r<e&&this.getStep(r).getPolyphony().some(function(e){return e.on&&(void 0===t||n&&null==e.transpose||e.transpose==t)})&&(void 0!==t?this.steps[r].deleteTranspose(t,n):this.steps[r]=new ot,a=!0);return a}}]),e}(),ut=new q.a.Time("16n"),lt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(o.a)(this,e),this.resolution=t,this.isTriplet=n,this.baseResolution=n?48:32}return Object(c.a)(e,[{key:"getTripletOrNonTriplet",value:function(){return this.isTriplet?new e(this.resolution,!1):new e(this.resolution,!0)}},{key:"equals",value:function(e){return this.resolution===e.resolution&&this.isTriplet===e.isTriplet}},{key:"getOffset",value:function(){return this.baseResolution/this.numSteps()}},{key:"getLengthAtResolution",value:function(e){return e*(this.numSteps()/this.baseResolution)}},{key:"getNumberOfStepsAtBaseResolution",value:function(){return this.baseResolution/this.numSteps()}},{key:"getTimeInStep",value:function(){return this.isTriplet?new q.a.Time(this.resolution+"t"):new q.a.Time(this.resolution+"n")}},{key:"getDurationOfStep",value:function(){return this.getTimeInStep().toMilliseconds()/new ut.toMilliseconds}},{key:"numSteps",value:function(){return this.isTriplet?this.resolution/32*48:this.resolution}},{key:"toString",value:function(){return this.isTriplet?this.resolution+"t":this.resolution}},{key:"transformList",value:function(e,t){for(var n=(t=t||this.baseResolution)/this.numSteps(),a=[],r=0;r<e.length;r+=n)a.push(e[r]);return a}},{key:"transformBucketsIntoSteps",value:function(e){for(var t=this.baseResolution/this.numSteps(),n=[],a=0;a<e.length;a+=t){for(var r=16,s=null,i=0;i<t;i++){var o=e[a+i];if(void 0===o)break;var c=o.steps;for(var u in c)u<r&&c[u].on&&(r=u,s=i)}null==s&&(s=0,r=0),n.push(e[a+s].getStep(r))}return n}},{key:"transformBucketsAtResolution",value:function(e,t){if(this.isTriplet==t.isTriplet)return this.transformList(e,t);for(var n=e.length*this.numSteps()/t.numSteps(),a=e[0].track,r=[],s=0;s<n;s++){var i=new ct(a,this.isTriplet);r.push(i)}for(var o=0;o<e.length;o++)for(var c in e[o].steps){var u=(o+parseFloat(c))*this.numSteps()/t.numSteps(),l=Math.floor(u),p=u-l,h=r[l];void 0!==h&&(h.setStep(p,e[o].getStep(c)),r[l]=h)}return r}},{key:"transformStepAtResolution",value:function(e,t){return e*(this.baseResolution/this.numSteps())*this.numSteps()/t.numSteps()}},{key:"transformStepAtResolution2",value:function(e,t){return e*this.numSteps()/t.numSteps()}},{key:"transformStepAtBaseResolution",value:function(t){return t*new e(32,!1).numSteps()/this.numSteps()}},{key:"transformStepFromBaseResolution",value:function(e){return this.transformStepAtResolution2(e,pt)}},{key:"getJson",value:function(){return{resolution:this.resolution,baseResolution:this.baseResolution,isTriplet:this.isTriplet}}},{key:"fromJson",value:function(e){return this.resolution=e.resolution,this.baseResolution=e.baseResolution,this.isTriplet=e.isTriplet,this}},{key:"getCopy",value:function(){return new e(this.resolution,this.isTriplet)}}]),e}(),pt=new lt(32,!1),ht=lt,dt=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this))).track=e,a.volume=n,a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getCopy",value:function(){return(new t).fromJson(this.getJson())}},{key:"getValue",value:function(){return this.volume}},{key:"executeEvent",value:function(e){this.subSequence.tracks[this.track.trackNumber].setVolume(this.volume,!0)}},{key:"getType",value:function(){return wt}},{key:"getJson",value:function(){return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{trackNumber:this.track.trackNumber,volume:this.volume})}},{key:"fromJson",value:function(e,n){return Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e),void 0!==e.subSequence?this.track=n.getSubSequence(e.subSequence).tracks[e.trackNumber]:this.track=n.tracks[e.trackNumber],this.volume=e.volume,this}}]),t}(tt),ft=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this))).groupNumber=e,a.volume=n,a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"executeEvent",value:function(e){this.subSequence.groups.groups[this.groupNumber].setVolume(this.volume)}},{key:"getType",value:function(){return Ct}},{key:"getCopy",value:function(){return(new t).fromJson(this.getJson())}},{key:"getJson",value:function(){return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{groupNumber:this.groupNumber,volume:this.volume})}},{key:"fromJson",value:function(e){return Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e),this.groupNumber=e.groupNumber,this.volume=e.volume,this}}]),t}(tt),mt=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this))).track=e,a.mute=n,a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getValue",value:function(){return this.mute?0:1}},{key:"isSkippable",value:function(){return!1}},{key:"executeEvent",value:function(e){this.subSequence.tracks[this.track.trackNumber].mute(this.mute,!0)}},{key:"getType",value:function(){return Pt}},{key:"getJson",value:function(){return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{trackNumber:this.track.trackNumber,mute:this.mute})}},{key:"fromJson",value:function(e,n){return Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e),this.track=n.tracks[e.trackNumber],this.mute=e.mute,this}}]),t}(tt),vt=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this))).groupNumber=e,a.mute=n,a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getValue",value:function(){return this.mute?0:1}},{key:"isSkippable",value:function(){return!1}},{key:"executeEvent",value:function(e){this.subSequence.groups.groups[this.groupNumber].mute(this.mute)}},{key:"getType",value:function(){return Tt}},{key:"getJson",value:function(){return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{groupNumber:this.groupNumber,mute:this.mute})}},{key:"fromJson",value:function(e){return Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e),this.groupNumber=e.groupNumber,this.mute=e.mute,this}}]),t}(tt),gt=function(e){function t(e,n,a){var r;return Object(o.a)(this,t),(r=Object(u.a)(this,Object(l.a)(t).call(this))).track=e,r.sendNumber=n,r.volume=a,r}return Object(h.a)(t,e),Object(c.a)(t,[{key:"executeEvent",value:function(e){this.subSequence.tracks[this.track.trackNumber].setSendVolume(this.sendNumber,this.volume,!0)}},{key:"getType",value:function(){return xt}},{key:"getJson",value:function(){return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{trackNumber:this.track.trackNumber,sendNumber:this.sendNumber,volume:this.volume})}},{key:"fromJson",value:function(e,n){return Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e),this.track=n.tracks[e.trackNumber],this.sendNumber=e.sendNumber,this.volume=e.volume,this}}]),t}(tt),bt=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this))).track=e,a.solo=n,a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isSkippable",value:function(){return!1}},{key:"executeEvent",value:function(e){this.subSequence.tracks[this.track.trackNumber].solo(this.solo,!0)}},{key:"getType",value:function(){return Nt}},{key:"getJson",value:function(){return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{trackNumber:this.track.trackNumber,solo:this.solo})}},{key:"fromJson",value:function(e,n){return Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e),this.track=n.tracks[e.trackNumber],this.solo=e.solo,this}}]),t}(tt),yt=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this))).track=e,a.reverse=n,a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isSkippable",value:function(){return!1}},{key:"executeEvent",value:function(e){this.subSequence.tracks[this.track.trackNumber].reverse(this.reverse,!0)}},{key:"getType",value:function(){return qt}},{key:"getJson",value:function(){return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{trackNumber:this.track.trackNumber,reverse:this.reverse})}},{key:"fromJson",value:function(e,n){return Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e),this.track=n.tracks[e.trackNumber],this.reverse=e.reverse,this}}]),t}(tt),kt=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this))).resolution=e,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getValue",value:function(){return this.resolution}},{key:"isDeterministic",value:function(){return!0}},{key:"isSkippable",value:function(){return!0}},{key:"executeEvent",value:function(e){}},{key:"getType",value:function(){return Dt}},{key:"getCopy",value:function(){var e=new t;return e.fromJson(this.getJson()),e}},{key:"getJson",value:function(){return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{resolution:this.resolution.getJson()})}},{key:"fromJson",value:function(e,n){return Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e),this.resolution=new ht,this.resolution.fromJson(e.resolution),this}},{key:"isEquivalent",value:function(e){return e.resolution.equals(this.resolution)}}]),t}(tt);function Et(e,t,n,a){var r=void 0;switch(t){case Ot:r=new nt;break;case wt:r=new dt;break;case Ct:r=new ft;break;case Pt:r=new mt;break;case Nt:r=new bt;break;case Tt:r=new vt;break;case jt:r=new Vt;break;case xt:r=new gt;break;case qt:r=new yt;break;case Dt:r=new kt;break;case Mt:r=new St(!1,new ht);break;case At:r=new at}return void 0!==r&&(r.fromJson(e,n),void 0!==r&&(r.subSequence=a)),r}var St=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,new kt(n)))).rolling=e,a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getValue",value:function(){return this.rolling?1:0}},{key:"isDeterministic",value:function(){return!0}},{key:"isSkippable",value:function(){return!0}},{key:"isPrunable",value:function(){return!this.rolling}},{key:"executeEvent",value:function(e){e.sequenceRolling=this.rolling}},{key:"getCopy",value:function(){var e=new t(this.rolling,this.initialSubEvent.resolution);return e.fromJson(this.getJson()),e}},{key:"getType",value:function(){return Mt}},{key:"getSubType",value:function(){return Dt}},{key:"getJson",value:function(){return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{rolling:this.rolling})}},{key:"fromJson",value:function(e,n){return Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e),this.rolling=e.rolling,this.initialSubEvent.step=this.step,this}}]),t}(function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this))).initialSubEvent=e,n.initialSubEvent.parentEvent=Object(p.a)(n),n.subEvents=[],n.cache={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"setTime",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"setTime",this).call(this,e,n),this.initialSubEvent.setTime(e,n)}},{key:"getNextSubEvent",value:function(e){for(var t in this.subEvents)if(e.step<this.subEvents[t].step)return this.subEvents[t]}},{key:"getPreviousSubEvent",value:function(e){var t;for(var n in this.subEvents){if(e===this.subEvents[n])return t;t=this.subEvents[n]}}},{key:"isLastSubEvent",value:function(e){return this.subEvents.indexOf(e)===this.subEvents.length-1}},{key:"deleteSubEvent",value:function(e){if(this.initialSubEvent===e)return 0===this.subEvents.length?(this.initialSubEvent=void 0,0):(this.initialSubEvent=this.subEvents[0],this.subEvents=this.subEvents.slice(1),this.initialSubEvent.step=this.step,void 0===this.initialSubEvent&&(this.subEvents=[]),0);var t=this.subEvents.indexOf(e);return t<0?t:(this.subEvents.splice(t,1),t)}},{key:"isEmpty",value:function(){return void 0===this.initialSubEvent&&0===this.subEvents.length}},{key:"restart",value:function(){this.cache={}}},{key:"getSubEvents",value:function(){var e=[this.initialSubEvent].concat(Object(ge.a)(this.subEvents)),t=e[e.length-1];return void 0!==t&&(t.duration=this.step+this.duration-t.step),e}},{key:"addSubEvent",value:function(e){e.parentEvent=this,this.subEvents.push(e),this.subEvents.sort(function(e,t){return e.step-t.step});var t=this.initialSubEvent;for(var n in this.subEvents)void 0!==t&&(t.duration=this.subEvents[n].step-t.step),t=this.subEvents[n];var a=this.subEvents[this.subEvents.length-1];a.duration=this.step+this.duration-a.step}},{key:"getSubEvent",value:function(e){if(e in this.cache)return this.cache[e];for(var t=this.initialSubEvent,n=0;n<this.subEvents.length&&!(this.subEvents[n].step>e);n++)t=this.subEvents[n];return this.cache[e]=t,t}},{key:"getSubType",value:function(){}},{key:"fromJson",value:function(e,n){for(var a in Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),this.initialSubEvent=Et(e.initialSubEvent,this.getSubType(),n),void 0===this.initialSubEvent.step&&(this.initialSubEvent.step=this.step),this.initialSubEvent.parentEvent=this,e.subEvents)this.addSubEvent(Et(e.subEvents[a],this.getSubType(),n))}},{key:"getJson",value:function(){return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{subType:this.getSubType(),initialSubEvent:this.initialSubEvent.getJson(),subEvents:this.subEvents.map(function(e){return e.getJson()})})}},{key:"calculateDurations",value:function(){if(this.isEmpty())this.duration=0;else{var e=this.getSubEvents(),t=void 0;for(var n in e)t&&(t.duration=e[n].step-t.step),t=e[n];t.duration=this.step+this.duration-t.step}}},{key:"events",get:function(){return this.getSubEvents()},set:function(e){this.restart(),this.initialSubEvent=e[0],this.subEvents=e.slice(1),this.calculateDurations()}}]),t}(tt)),Ot=1,wt=2,Ct=3,Pt=5,Tt=6,jt=7,xt=8,Nt=9,qt=10,Mt=11,Dt=12,At=14,Rt=15,It={id:1e6};function Lt(e){switch(e){case Ot:return new nt;case Mt:return new St;case At:return new at;default:return}}function Ft(e){switch(e){case Mt:case Dt:case Ot:return!0;default:return!1}}var Vt=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this))).parameter=e,a.parameterValue=n,a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getCopy",value:function(){return(new t).fromJson(this.getJson())}},{key:"isSkippable",value:function(){return!0}},{key:"executeEvent",value:function(e){this.parameter.set(this.parameterValue,!0)}},{key:"getJson",value:function(){if(void 0!==this.parameter)return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{parameter:this.parameter.getJson(),value:this.parameterValue})}},{key:"getType",value:function(){return jt}},{key:"fromJson",value:function(e,n){if(Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e),this.parameter=n.getParameterFromJson(e.parameter),this.parameterValue=e.value,void 0!==this.parameter)return this}}]),t}(tt);function Bt(e){var t={};for(var n in e){var a=e[n];t[n]=Ut(a)}return t}function Ut(e){return null===e?e:("object"===typeof e&&e.resolution&&(e=new ht(16,!1).fromJson(e)),e)}var Ht="LFO",Jt="ENV",Gt=function(){function e(t,n,a,r){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ht;Object(o.a)(this,e),this.parameter=t,this.modulator=n,this.scale=a,this.scales=r,this.type=s,void 0===this.scale&&void 0!==this.scales&&(this.scale=this.scales[0])}return Object(c.a)(e,[{key:"getJson",value:function(){return{modulator:this.modulator.number,min:this.scale.min,max:this.scale.max,type:this.type}}},{key:"min",get:function(){return this.scale.min},set:function(e){void 0!==this.scales?this.scales.forEach(function(t){return t.min=e}):this.scale.min=e}},{key:"max",get:function(){return this.scale.max},set:function(e){void 0!==this.scales?this.scales.forEach(function(t){return t.max=e}):this.scale.max=e}}]),e}();function zt(e,t,n){var a={};if(e<t)for(var r in n)(r=parseInt(r))>t?a[r]=n[r]:r>e?a[r-1]=n[r]:r===e?a[t]=n[e]:a[r]=n[r];else for(var s in n)(s=parseInt(s))<t?a[s]=n[s]:s===e?a[t]=n[e]:s>=t?a[s+1]=n[s]:a[s]=n[s];return a}function _t(e,t){var n={};for(var a in t)(a=parseInt(a))!==e&&(a>e?n[a-1]=t[a]:n[a]=t[a]);return n}q.a.Master.context;var Wt=function(){function e(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object(o.a)(this,e),r=e.getDefaultConfig(r),this.config=r,this.context=void 0,this.name=t,this.effectName=void 0,this.builder=r.builder,this.object=n,this.setter=a,this.min=r.min,this.useMeter=!1,this.max=r.max,this.constantAutomationRate=r.constantAutomationRate,this.units=r.units,this.unlockedValue=null,this.automatable=r.automatable,this.patternToValue={},this.id=Object(We.uuid)(),null!==r.defaultValue&&this.set(r.defaultValue,!0),this.originalMin=this.min,this.originalMax=this.max,this.store=void 0,this.context=void 0,this.mixSession=void 0,this.lfos=[],this.envelopes=[],this.patternToAutomation={},this.unlockedAutomation=new Ze(this),this.previousAutomation=this.unlockedAutomation}return Object(c.a)(e,null,[{key:"getDefaultConfig",value:function(e){return void 0===e.min&&(e.min=0),void 0===e.max&&(e.max=1),void 0===e.max&&(e.units=""),void 0===e.defaultValue&&(e.defaultValue=0),void 0===e.automatable&&(e.automatable=!0),void 0===e.constantAutomationRate&&(e.constantAutomationRate=!1),e}}]),Object(c.a)(e,[{key:"dispose",value:function(){for(var e in this.unlockedAutomation.dispose(),this.patternToAutomation)this.patternToAutomation[e].dispose();this.audioParam&&this.audioParam._param&&this.audioParam.dispose(),this.audioParams&&this.audioParams.filter(function(e){return e._param}).forEach(function(e){return e.dispose()}),this.audioParam=void 0,this.audioParams=void 0,this.object=void 0}},{key:"isPatternLocked",value:function(){return void 0!==this.context&&(this.context.track?(this.context.track.instrumentRack,this.context.track.patternLocked):this.context.lfosTrack?this.context.lfosTrack.patternLocked:this.context.envelopesTrack?this.context.envelopesTrack.patternLocked:this.context.sequencerEngine?this.context.sequencerEngine.patternLocked:void 0)}},{key:"deleteLocks",value:function(){this.currentPattern in this.patternToValue&&(this.unlockedValue=this.patternToValue[this.currentPattern]),this.patternToValue={},this.updateRedux()}},{key:"enableAudioParam",value:function(){this.useMeter=!0}},{key:"setAudioParam",value:function(e){this.audioParam=e,this.automationRate="k-rate"}},{key:"setAudioParams",value:function(e){this.audioParams=e}},{key:"isAudioParamEnabled",value:function(){return void 0!==this.audioParam||void 0!==this.audioParams}},{key:"isConnectedToAnyModulator",value:function(){return this.isConnectedToAnyLFO()||this.isConnectedToAnyEnvelope()}},{key:"isConnectedToAnyLFO",value:function(){return this.lfos.length>0}},{key:"isConnectedToLFO",value:function(e){return this.lfos.indexOf(e)>-1}},{key:"isConnectedToAnyEnvelope",value:function(){return this.envelopes.length>0}},{key:"isConnectedToEnvelope",value:function(e){return this.envelopes.indexOf(e)>-1}},{key:"refresh",value:function(){this.set(this.get())}},{key:"hasPatternLockedValues",value:function(){return Object.keys(this.patternToValue).length>0||Object.keys(this.patternToAutomation).length>0}},{key:"connectToEnvelope",value:function(e){var t=this;this.isConnectedToEnvelope(e)||(this.envelopes.push(e),this.audioParams?this.audioParams.forEach(function(n,a){return e.connect(n,t,a)}):(this.automationRate=Ye,e.connect(this.audioParam,this,0)))}},{key:"disconnectFromAllModulators",value:function(){var e=Object(ge.a)(this.lfos);for(var t in e)this.disconnectFromLFO(e[t]);var n=[].concat(n);for(var a in n)this.disconnectFromEnvelope(n[a]);this.lfos=[],this.envelopes=[]}},{key:"disconnectFromEnvelope",value:function(e){var t=this,n=(!(arguments.length>1&&void 0!==arguments[1])||arguments[1],this.envelopes.indexOf(e));n<0||(this.useMeter?this.useMeter=!1:this.audioParams?this.audioParams.forEach(function(n,a){return e.disconnect(n,t,a)}):(this.automationRate="k-rate",e.disconnect(this.audioParam,this,0)),this.envelopes.splice(n,1))}},{key:"connectToLFO",value:function(e){var t=this;this.isConnectedToLFO(e)||(this.lfos.push(e),this.audioParams?this.audioParams.forEach(function(n,a){return e.connect(n,t,a)}):(this.automationRate=Ye,e.connect(this.audioParam,this,0)))}},{key:"disconnectFromLFO",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this.lfos.indexOf(e);if(!(a<0)&&(this.useMeter?this.useMeter=!1:this.audioParams?this.audioParams.forEach(function(n,a){return e.disconnect(n,t,a)}):this.audioParam&&(e.disconnect(this.audioParam,this,0),this.automationRate="k-rate"),this.lfos.splice(a,1),0===this.lfos.length&&n)){this.audioParam,this.meter;this.audioParam=void 0,this.meter=void 0}}},{key:"getConnectableParam",value:function(){return this.audioParam}},{key:"setContext",value:function(e){this.context=e,void 0!==this.context.track?(this.track=this.context.track,this.track.sequencerEngine&&(this.track.sequencerEngine.idToParameter[this.id]=this)):this.context.lfoTrack?this.context.lfoTrack.sequencerEngine&&(this.context.lfoTrack.sequencerEngine.idToParameter[this.id]=this):this.context.envelopeTrack&&this.context.envelopeTrack.sequencerEngine&&(this.context.envelopeTrack.sequencerEngine.idToParameter[this.id]=this)}},{key:"setStore",value:function(e){this.store=e,void 0!==e&&(e.dispatch(Object(w.lb)(this.id,this.get())),this.unlockedAutomation.store=e)}},{key:"setMixSession",value:function(e){this.mixSession=e}},{key:"setTrack",value:function(e){this.track=e}},{key:"copyFrom",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this.value=e.value:(this.disconnectFromAllModulators(),this.fromJson(e.getJson(),t),this.set(e.value))}},{key:"loadModsFromJson",value:function(e){if(void 0!==e.mods)for(var t in e.mods){var n=e.mods[t],a=n.modulator||n.lfo,r=n.type||Ht;for(var s in this.parameterMods){var i=this.parameterMods[s];if(i.modulator.number===a&&i.type===r){i.min=n.min,i.max=n.max;break}}}}},{key:"fromJson",value:function(e,t){var n=this;if(void 0!==e){this.id&&(e.id=this.id);var a=void 0!==t?t.currentSubSequence:void 0;if(void 0!==e.lfo)this.enableAudioParam(),this.connectToLFO(t.lfos[0].lfo);else if(void 0!==e.lfos&&e.lfos.length>0)for(var r in this.enableAudioParam(),e.lfos){var s=e.lfos[r];this.connectToLFO(a.lfos[s].lfo)}if(void 0!==e.envelopes&&e.envelopes.length>0&&(this.enableAudioParam(),e.envelopes.forEach(function(e){return n.connectToEnvelope(a.envelopes[e])})),void 0!==e.value&&this.set(e.value),void 0!==e.patternToValue&&(this.unlockedValue=Ut(e.unlockedValue),this.patternToValue=Bt(e.patternToValue),this.isPatternLocked()&&void 0!==this.patternToValue[0]?this.set(this.patternToValue[0]):this.set(this.unlockedValue)),e.patternToAutomation){for(var i in e.patternToAutomation)this.patternToAutomation[i]=new Ze(this),this.patternToAutomation[i].fromJson(e.patternToAutomation[i],!1);this.unlockedAutomation.fromJson(e.unlockedAutomation,!1),this.isPatternLocked()&&this.patternToAutomation[0]?this.patternToAutomation[0].schedule():this.automation.schedule()}this.loadModsFromJson(e)}}},{key:"getJson",value:function(){var e=this.parameterMods,t=void 0===this.context?void 0:this.context.subSequence,n={};for(var a in this.patternToAutomation)n[a]=this.patternToAutomation[a].getJson();return{id:this.id,unlockedAutomation:this.unlockedAutomation.getJson(),patternToAutomation:n,context:void 0===this.context?void 0:this.context.getJson(),subSequence:void 0===t?void 0:t.id,name:this.name,min:this.min,max:this.max,unlockedValue:this.unlockedValue,patternToValue:this.patternToValue,originalMin:this.originalMin,originalMax:this.originalMax,mods:e.map(function(e){return e.getJson()}),lfos:this.lfos.map(function(e){return e.number-1}),envelopes:this.envelopes.map(function(e){return e.number-1})}}},{key:"normalizedSet",value:function(e){this.set(this.normalize(e),void 0,void 0,.2)}},{key:"normalizeOriginal",value:function(e){return this.originalMin+(this.originalMax-this.originalMin)*e}},{key:"normalize",value:function(e){return this.min+(this.max-this.min)*e}},{key:"updateRedux",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var t in this.patternToAutomation)this.patternToAutomation[t].clear();if(this.unlockedAutomation.clear(),this.automation.clear(),null!==this.value&&void 0!==this.value)return this.set(this.value,!0,e)}},{key:"deletePattern",value:function(e){this.patternToValue=_t(e,this.patternToValue)}},{key:"movePatternTo",value:function(e,t){this.patternToValue=zt(e,t,this.patternToValue)}},{key:"newPattern",value:function(e,t){this.patternToValue[t]=this.patternToValue[e],this.patternToAutomation[e]&&(this.patternToAutomation[t]=this.patternToAutomation[e].getCopy())}},{key:"callSetter",value:function(){var e=this.get();this.setter(this.object,e)}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;this.builder&&(e=this.builder(e));this.value;if(this.value=e,void 0===this.audioParam||null===e||void 0===e||isNaN(e)||this.hasAudioParamSetter||(void 0!==a&&a>=0?this.audioParam.exponentialRampToValueAtTime(e,a):this.audioParam.value=e),this.setter(this.object,e),void 0!==this.store){var r={id:this.id,value:this.value};if(n||this.store.dispatch(Object(w.lb)(this.id,this.value)),t)return r;var s=this.store.getState();return void 0!==this.mix&&s.mix.isRecordingMix||void 0!==this.track&&s.sequencer.automationMode,r}}},{key:"get",value:function(){if(this.useMeter){var e=this.getMeterValue();return(e=parseFloat(this.value)+parseFloat(e))>=this.max?this.max:e}return void 0===this.audioParam||void 0===this.meter?null===this.value?null:this.value:null===this.value||void 0===this.value||isNaN(this.value)?this.value:void 0}},{key:"getMeterValue",value:function(){var e=0;for(var t in this.lfos){var n=this.lfos[t].getScaleForParameter(this),a=this.lfos[t].getValue(this.trackStep),r=n.max,s=n.min,i=(r-s)*(a+100)/200+s;n.max,n.min,n.min;e+=i}for(var o in this.envelopes){var c=this.envelopes[o].getScaleForParameter(this),u=this.envelopes[o].getValue(this.trackStep),l=c.max,p=c.min;e+=(l-p)*u/1+p}return e}},{key:"automation",get:function(){return this.isPatternLocked()?(void 0===this.patternToAutomation[this.currentPattern]&&(this.patternToAutomation[this.currentPattern]=this.previousAutomation.getCopy()),this.previousAutomation=this.patternToAutomation[this.currentPattern],this.previousAutomation):(this.previousAutomation=this.unlockedAutomation,this.unlockedAutomation)}},{key:"automations",get:function(){return this.automation.automations}},{key:"value",set:function(e){this.isPatternLocked()?this.patternToValue[this.currentPattern]=e:this.unlockedValue=e},get:function(){if(this.isPatternLocked()){var e=this.currentPattern;if(void 0===e)return;var t=this.patternToValue[e];return void 0===t?this.unlockedValue:t}return this.unlockedValue}},{key:"currentPattern",get:function(){return this.context.track?this.context.track.currentPattern:this.context.lfosTrack?this.context.lfosTrack.currentPattern:this.context.envelopesTrack?this.context.envelopesTrack.currentPattern:this.context.sequencerEngine?this.context.sequencerEngine.currentPattern:void 0}},{key:"automationRate",set:function(e){e=this.config.automationRate||e,void 0!==this.audioParam&&void 0!==this.audioParam.input&&(this.constantAutomationRate||(this.audioParam.input.automationRate=e))}},{key:"parameterMods",get:function(){var e=this;if(void 0!==this.audioParams){var t=this.lfos.map(function(t){return new Gt(e,t,void 0,e.audioParams.map(function(n,a){return t.getScaleForParameter(e,a)}))}),n=this.envelopes.map(function(t){return new Gt(e,t,void 0,e.audioParams.map(function(n,a){return t.getScaleForParameter(e,a)}),Jt)});return t.concat(n).filter(function(e){return void 0!==e.scale})}var a=this.lfos.map(function(t){return new Gt(e,t,t.getScaleForParameter(e),void 0,Ht)}),r=this.envelopes.map(function(t){return new Gt(e,t,t.getScaleForParameter(e),void 0,Jt)});return a.concat(r).filter(function(e){return void 0!==e.scale})}},{key:"mix",get:function(){return this.context&&this.context.subSequence?this.context.subSequence.mix:void 0}},{key:"trackStep",get:function(){return void 0===this.context?0:this.context.track.sequencerEngine.trackStep}}]),e}(),Kt=function(e){function t(e,n,a,r,s,i,c){var p=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],h=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e,n,a,r,s,i,c,p,h))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"normalize",value:function(e){return Math.round(this.min+(this.max-this.min)*e)}},{key:"set",value:function(e,n){Object($e.a)(e)&&(null===e?Object(ze.a)(Object(l.a)(t.prototype),"set",this).call(this,null,n):Object(ze.a)(Object(l.a)(t.prototype),"set",this).call(this,Math.round(e),n))}}]),t}(Wt),Yt=function(e){function t(e,n,a,r,s,i){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e,n,function(e,t){return e.value=t},a,r,s,i,!0))}return Object(h.a)(t,e),t}(Wt),Qt=function(e){function t(e,n,a){var r,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object(o.a)(this,t),(r=Object(u.a)(this,Object(l.a)(t).call(this,e,n,a,s))).hasAudioParamSetter=!0,r.setAudioParam(n),r}return Object(h.a)(t,e),Object(c.a)(t,[{key:"fromJson",value:function(e,t){var n=this,a=void 0!==t?t.currentSubSequence:void 0;if(void 0!==e.id&&(this.id=e.id),void 0!==e.lfos&&e.lfos.length>0&&void 0!==a&&e.lfos.forEach(function(e){return n.connectToLFO(a.lfos[e].lfo)}),void 0!==e.envelopes&&e.envelopes.length>0&&void 0!==a&&e.envelopes.forEach(function(e){return n.connectToEnvelope(a.envelopes[e])}),void 0!==e.value&&this.set(e.value),void 0!==e.patternToValue&&(this.unlockedValue=Ut(e.unlockedValue),this.patternToValue=Bt(e.patternToValue),this.isPatternLocked()&&void 0!==this.patternToValue[0]?this.set(this.patternToValue[0]):this.set(this.unlockedValue)),e.patternToAutomation){for(var r in e.patternToAutomation)this.patternToAutomation[r]=new Ze(this),this.patternToAutomation[r].fromJson(e.patternToAutomation[r]);this.unlockedAutomation.fromJson(e.unlockedAutomation)}this.loadModsFromJson(e)}},{key:"disconnectFromLFO",value:function(e){Object(ze.a)(Object(l.a)(t.prototype),"disconnectFromLFO",this).call(this,e,!1),this.set(this.value)}}]),t}(Wt),Xt=function(e){function t(e,n){var a,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.01;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,e,n,function(e,t){e.linearRampToValueAtTime(t,q.a.Master.context.currentTime+s)},r))).hasAudioParamSetter=!1,a}return Object(h.a)(t,e),t}(Qt),Zt=function(e){function t(e,n){var a,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Object(o.a)(this,t),r.unit="%",(a=Object(u.a)(this,Object(l.a)(t).call(this,e,n,r))).hasAudioParamSetter=!1,a}return Object(h.a)(t,e),t}(Xt),$t=function(){function e(t,n,a){var r=this;Object(o.a)(this,e),this.sequencerEngine=a,this.store=a.store,this.name=t,this.id=Object(We.uuid)(),this.effectFn=n,this.enabledParameter=new Wt("Enabled",this,function(e,t){r.toggle(t)},{min:0,max:1,unit:"boolean",defaultValue:!1}),this.effectNode=n(),this.enabled=!1,this.toggledValue=0,this.value=0,this.connected=0,this.wetParameter=void 0!==this.effectNode.wet?new Zt("Wet",this.effectNode.wet,{defaultValue:0}):void 0,this.parameters=[],this.registerParameter(this.wetParameter),this.track=void 0,this.group=void 0,this.setWet(0)}return Object(c.a)(e,[{key:"getParameters",value:function(){return this.parameters}},{key:"isMidiEffect",value:function(){return!1}},{key:"registerContext",value:function(e){this.context=e,e=e.getCopy().forEffect(this),this.parameters.forEach(function(t){return t.setContext(e)})}},{key:"registerMixSession",value:function(e){this.parameters.forEach(function(t){return t.setMixSession(e)})}},{key:"registerParameter",value:function(e){void 0!==e&&(e.name=e.name,e.effectName=this.name,e.setStore(this.store),this.parameters.push(e))}},{key:"connect",value:function(e){this.effectNode.connect(e)}},{key:"syncable",value:function(){return!1}},{key:"disconnect",value:function(e){this.effectNode.disconnect(e)}},{key:"isEnabled",value:function(){return this.enabledParameter.get()}},{key:"enable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.enabledParameter.set(e)}},{key:"toggleEnabled",value:function(){this.enabledParameter.set(!this.enabledParameter.get())}},{key:"toggle",value:function(e){e=void 0===e?!this.enabled:e,void 0!==this.effectNode&&(e?this.setValue(this.toggledValue):"wet"in this.effectNode&&(this.toggledValue=this.effectNode.wet.value,this.setValue(0)))}},{key:"setValue",value:function(e){this.value=e,"wet"in this.effectNode&&this.wetParameter.set(e)}},{key:"setWet",value:function(e){"wet"in this.effectNode&&this.wetParameter.set(e)}},{key:"getWet",value:function(){return this.wetParameter.value}},{key:"getName",value:function(){return this.name}},{key:"getEffect",value:function(){return this.effectNode}},{key:"getEffectCopy",value:function(){var t=new e(this.name,this.effectFn,this.sequencerEngine);return this.wetParameter&&t.setWet(this.wetParameter.get()),t.enable(this.enabledParameter.get()),t}},{key:"fromJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return void 0===e.id||t&&"boolean"===typeof t||(this.id=e.id),void 0!==e.enabled&&this.enable(e.enabled),void 0!==this.wetParameter&&(void 0!==e.wet&&this.setWet(e.wet),void 0!==e.wetParameter&&this.wetParameter.fromJson(e.wetParameter,this.sequencerEngine)),this}},{key:"saveParameterToJson",value:function(e,t,n){if(n.isConnectedToAnyModulator()||Object.keys(n.patternToValue).length>0||n.automations.length>=0){var a=Object(X.a)({},e);return a[t]=n.getJson(),a}return e}},{key:"loadParameterFromJson",value:function(e,t,n){t in e&&n.fromJson(e[t],this.sequencerEngine)}},{key:"getJson",value:function(){var e={name:this.name,enabled:this.enabledParameter.get(),id:this.id};return void 0!==this.wetParameter&&(e.wet=this.wetParameter.get(),e.value=this.wetParameter.get(),e=this.saveParameterToJson(e,"wetParameter",this.wetParameter)),e}},{key:"dispose",value:function(){this.effectNode.dispose(),this.effectNode=void 0,this.parameters.forEach(function(e){return e.dispose()}),this.parameters=void 0}},{key:"wet",set:function(e){this.wetParameter&&this.wetParameter.set(e)}}]),e}(),en=function(e){function t(e,n){var a;Object(o.a)(this,t),a=Object(u.a)(this,Object(l.a)(t).call(this,"Filter",function(){return new q.a.Filter(80,"lowpass",-24)},e));var r={min:0,max:1e4,unit:"HZ",defaultValue:80};return n&&(r.automationRate=n),a.cutoffParameter=new Xt("Cutoff",a.effectNode.frequency,r),a.qParameter=new Xt("Q",a.effectNode.Q,{min:0,max:20,unit:"",defaultValue:1}),a.typeParameter=new Wt("type",Object(p.a)(a),function(e,t){return a.effectNode.type=t},{min:"lowpass",max:"highpass",unit:"",defaultValue:"lowpass"}),a.registerParameter(a.cutoffParameter),a.registerParameter(a.typeParameter),a.registerParameter(a.qParameter),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"connect",value:function(e){Object(ze.a)(Object(l.a)(t.prototype),"connect",this).call(this,e)}},{key:"syncable",value:function(){return!1}},{key:"toggle",value:function(e){}},{key:"setValue",value:function(e){this.value=e,e=5e3*e+50,this.effectNode.frequency.value=e}},{key:"setFrequency",value:function(e){try{this.cutoffParameter.set(e)}catch(t){}}},{key:"setQ",value:function(e){this.qParameter.set(e)}},{key:"lowpass",value:function(){this.type="lowpass"}},{key:"hipass",value:function(){this.type="highpass"}},{key:"getFrequency",value:function(){return this.effectNode.frequency.value}},{key:"getQ",value:function(){return this.effectNode.Q.value}},{key:"getJson",value:function(){var e=Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),frequency:this.effectNode.frequency.value,q:this.effectNode.Q.value,type:this.effectNode.type});return(this.cutoffParameter.isConnectedToAnyModulator()||Object.keys(this.cutoffParameter.patternToValue).length>0)&&(e.cutoffParameter=this.cutoffParameter.getJson()),(this.qParameter.isConnectedToAnyModulator()||Object.keys(this.qParameter.patternToValue).length>0)&&(e.qParameter=this.qParameter.getJson()),e=this.saveParameterToJson(e,"typeParameter",this.typeParameter)}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),void 0!==e.id&&(this.id=e.id),this.enable(e.enabled),this.qParameter.set(e.q),this.cutoffParameter.set(e.frequency),this.typeParameter.set(e.type),this.loadParameterFromJson(e,"qParameter",this.qParameter),this.loadParameterFromJson(e,"cutoffParameter",this.cutoffParameter),this.loadParameterFromJson(e,"typeParameter",this.typeParameter)}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}},{key:"cutoffFrequency",get:function(){return this.cutoffParameter.get()},set:function(e){this.cutoffParameter.set(e)}},{key:"Q",set:function(e){this.qParameter.set(e)}},{key:"type",set:function(e){this.typeParameter.set(e)},get:function(){return this.typeParameter.get()}}]),t}($t),tn=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Auto Filter",function(){return new q.a.AutoFilter(4*new q.a.Time("1m"))},e))).qParameter=new Xt("Q",n.effectNode.filter.Q,{min:0,max:20,unit:"",defaultValue:1}),n.registerParameter(n.qParameter),n.effectNode.start(),n.effectNode.wet.value=1,n.storedLFOTime=4*new q.a.Time("1m"),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"syncable",value:function(){return!0}},{key:"start",value:function(){this.effectNode.start()}},{key:"stop",value:function(){this.effectNode.stop()}},{key:"toggle",value:function(e){}},{key:"getLFOTime",value:function(){return new q.a.Time(this.effectNode.frequency.value).toNotation()}},{key:"getStoredLFOTime",value:function(){return this.storedLFOTime}},{key:"setLFOTime",value:function(e){this.storedLFOTime=e,this.effectNode.frequency.value=e}},{key:"lowpass",value:function(){this.effectNode.filter.type="lowpass"}},{key:"hipass",value:function(){this.effectNode.filter.type="highpass"}},{key:"getFilterType",value:function(){return this.effectNode.filter.type}},{key:"getJson",value:function(){return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),frequency:this.effectNode.frequency.value,storedLFOTime:this.storedLFOTime,baseFrequency:this.effectNode.baseFrequency,octaves:this.effectNode.octaves,q:this.effectNode.filter.Q.value,filterType:this.effectNode.filter.type})}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),this.enable(e.enabled),this.effectNode.filter.Q.value=e.q,this.effectNode.frequency.value=e.frequency,this.effectNode.baseFrequency=e.baseFrequency,this.effectNode.octaves=e.octaves,this.storedLFOTime="storedLFOTime"in e?e.storedLFOTime:e.frequency,this.effectNode.filter.type=e.filterType}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),t}($t),nn=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Pan",function(){return new q.a.Panner},e))).panParameter=new Wt("Panning",n.effectNode.pan,function(e,t){return e.value=t},{min:-1,max:1,unit:"",defaultValue:0}),n.registerParameter(n.panParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"toggle",value:function(e){}},{key:"setValue",value:function(e){this.value=e,this.panParameter.normalizedSet(e)}},{key:"getJson",value:function(){return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),value:this.value})}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n);var a=new t;return a.setValue(this.value),a}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),t}($t),an=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Reverb",function(){return new q.a.Freeverb},e))).roomSizeParameter=new Zt("Room Size",n.effectNode.roomSize),n.registerParameter(n.roomSizeParameter),n.dampeningParameter=new Qt("Dampening",n.effectNode.dampening,function(e,t){return e.value=t},{min:0,max:1e4}),n.registerParameter(n.dampeningParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"setRoomSize",value:function(e){this.roomSizeParameter.set(e)}},{key:"setDampening",value:function(e){this.dampening.set(e)}},{key:"getDampening",value:function(){return this.effectNode.dampening.value}},{key:"getRoomSize",value:function(){return this.effectNode.roomSize.value}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}},{key:"getJson",value:function(){var e=Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),roomSize:this.roomSizeParameter.get(),wet:this.wetParameter.get(),dampening:this.dampeningParameter.get()});return(this.roomSizeParameter.isConnectedToAnyModulator()||Object.keys(this.roomSizeParameter.patternToValue).length>0)&&(e.roomSizeParameter=this.roomSizeParameter.getJson()),(this.dampeningParameter.isConnectedToAnyModulator()||Object.keys(this.dampeningParameter.patternToValue).length>0)&&(e.dampeningParameter=this.dampeningParameter.getJson()),e}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),this.name=e.name,this.enable(e.enabled),"roomSize"in e&&this.roomSizeParameter.set(e.roomSize),"wet"in e&&this.wetParameter.set(e.wet),"dampening"in e&&this.dampeningParameter.set(e.dampening),this.loadParameterFromJson(e,"roomSizeParameter",this.roomSizeParameter),this.loadParameterFromJson(e,"dampeningParameter",this.dampeningParameter)}}]),t}($t),rn=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Tremolo",function(){return new q.a.Tremolo},e))).effectNode.start(),n.rateParameter=new Qt("Rate",n.effectNode.frequency,function(e,t){return e.value=t},{min:0,max:32,defaultValue:0}),n.spreadParameter=new Qt("Spread",n.effectNode,function(e,t){return e.spread=t},{min:0,max:360,defaultValue:180}),n.depthParameter=new Zt("Depth",n.effectNode.depth),n.registerParameter(n.depthParameter),n.registerParameter(n.rateParameter),n.registerParameter(n.spreadParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"setRate",value:function(e){this.effectNode.frequency.value=e}},{key:"setDepth",value:function(e){this.effectNode.depth.value=e}},{key:"getRate",value:function(){return this.effectNode.frequency.value}},{key:"getDepth",value:function(){return this.effectNode.depth.value}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}},{key:"getJson",value:function(){var e=Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),depth:this.depthParameter.get(),spread:this.spreadParameter.get(),rate:this.rateParameter.get()});return(this.depthParameter.isConnectedToAnyModulator()||Object.keys(this.depthParameter.patternToValue).length>0)&&(e.depthParameter=this.depthParameter.getJson()),(this.spreadParameter.isConnectedToAnyModulator()||Object.keys(this.spreadParameter.patternToValue).length>0)&&(e.spreadParameter=this.spreadParameter.getJson()),(this.rateParameter.isConnectedToAnyModulator()||Object.keys(this.rateParameter.patternToValue).length>0)&&(e.rateParameter=this.rateParameter.getJson()),e}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),this.name=e.name,this.enable(e.enabled),this.depthParameter.set(void 0!==e.depth?e.depth:1),this.spreadParameter.set(void 0!==e.spread?e.spread:180),this.wetParameter.set(void 0!==e.wet?e.wet:1),this.rateParameter.set(void 0!==e.rate?e.rate:1),this.loadParameterFromJson(e,"depthParameter",this.depthParameter),this.loadParameterFromJson(e,"spreadParameter",this.spreadParameter),this.loadParameterFromJson(e,"rateParameter",this.rateParameter)}}]),t}($t),sn=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Chorus",function(){return new q.a.Chorus},e))).rateParameter=new Qt("Rate",n.effectNode.frequency,function(e,t){return e.value=t},{min:0,max:32,defaultValue:4}),n.registerParameter(n.rateParameter),n.depthParameter=new Qt("Depth",n.effectNode,function(e,t){return e.depth=t},{min:0,max:100,unit:"%",defaultValue:.5}),n.registerParameter(n.depthParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"setRate",value:function(e){this.effectNode.frequency.value=e}},{key:"setDepth",value:function(e){this.effectNode.depth=e}},{key:"getRate",value:function(){return this.effectNode.frequency.value}},{key:"getDepth",value:function(){return this.effectNode.depth}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}},{key:"getJson",value:function(){var e=Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),depth:this.depthParameter.get(),rate:this.rateParameter.get()});return(this.depthParameter.isConnectedToAnyModulator()||Object.keys(this.depthParameter.patternToValue).length>0)&&(e.depthParameter=this.depthParameter.getJson()),(this.rateParameter.isConnectedToAnyModulator()||Object.keys(this.rateParameter.patternToValue).length>0)&&(e.rateParameter=this.rateParameter.getJson()),e}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),this.name=e.name,this.enable(e.enabled),this.wetParameter.set(e.wet),this.depthParameter.set(e.depth),this.rateParameter.set(e.rate),this.loadParameterFromJson(e,"rateParameter",this.rateParameter),this.loadParameterFromJson(e,"depthParameter",this.depthParameter)}}]),t}($t),on=function(e){function t(e){var n;Object(o.a)(this,t),n=Object(u.a)(this,Object(l.a)(t).call(this,e));for(var a=[],r=0;r<e.effects.length;r++)a.push(e.effects[r].value);return n.state={effectsValues:a},n.setState(n.state),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onChangeValue",value:function(e,t){this.state.effectsValues[e]=t;var n=parseFloat(t)/30;this.props.effects[e].setValue(n),this.setState(this.state)}},{key:"toggleEffect",value:function(e){e.toggle(),this.props.onEffectsChange(),this.setState(this.state)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,this.props.effects.map(function(t,n){return r.a.createElement(cn,{key:n,name:t.getName(),disabled:!t.isEnabled(),onClickToggle:function(){return e.toggleEffect(t)},value:30*t.value,onChangeValue:function(t){return e.onChangeValue(n,t)}})}))}}]),t}(a.Component),cn=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"effect-knob-container"},r.a.createElement(fe.a,{value:this.props.value,change:function(t){return e.props.onChangeValue(t.target.value)},step:this.state.step,max:30,min:0,orientation:"vertical",disabled:this.props.disabled?"disabled":"",reversed:!0}),r.a.createElement("div",Object(_e.a)({className:this.props.disabled?"disabled":"",onClick:this.props.onClickToggle},"className","effect-label"),this.props.name))}}]),t}(a.Component),un={ReverbEffect:an,FilterEffect:en,TremoloEffect:rn,AutoFilterEffect:tn,ChorusEffect:sn,TrackEffects:on,PanEffect:nn,Effect:$t};function ln(e,t,n){if(n.isConnectedToAnyModulator()||Object.keys(n.patternToValue).length>0||n.automations.length>0){var a=Object(X.a)({},e);return a[t]=n.getJson(),a}return e}function pn(e,t,n,a){t in e&&n.fromJson(e[t],a)}var hn=180,dn="peaking",fn=function(e){function t(e){var n,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(var r in Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"EQ8",function(){return new q.a.Gain(1)},e))).store=e.store,n.equalizerPoints=[new mn(e,80,0,1,1,!0,"lowshelf"),new mn(e,300,0,1,2,!1),new mn(e,500,0,1,3,!1),new mn(e,800,0,1,4,!1),new mn(e,1e3,0,1,5),new mn(e,2e3,0,1,6,!1),new mn(e,4e3,0,1,7),new mn(e,8e3,0,1,8,!0,"highshelf")],n.updateRate=hn,a&&(n.analyser=new q.a.Analyser("fft",256)),n.outputNode=new q.a.Gain(1),n.setupEqualizer(),n.equalizerPoints)n.parameters=n.parameters.concat(n.equalizerPoints[r].parameters);return n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"dispose",value:function(){Object(ze.a)(Object(l.a)(t.prototype),"dispose",this).call(this),this.analyser&&this.analyser.dispose(),this.equalizerPoints.forEach(function(e){return e.dispose()}),this.equalizerPoints=void 0}},{key:"disconnectAllFilters",value:function(){this.effectNode.disconnect(),this.equalizerPoints.filter(function(e){return e.enabled}).forEach(function(e){return e.filter.disconnect()})}},{key:"setupEqualizer",value:function(){var e,t=this.equalizerPoints.filter(function(e){return e.enabled}).map(function(e){return e.filter});t.push(this.outputNode),(e=this.effectNode).chain.apply(e,Object(ge.a)(t))}},{key:"getSpectrum",value:function(){return this.analyser.getValue()}},{key:"connect",value:function(e){this.outputNode.connect(e),this.analyser&&this.outputNode.connect(this.analyser)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e),this.analyser&&this.analyser.disconnect()}},{key:"getJson",value:function(){var e=Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this);return e.updateRate=this.updateRate,e.equalizerPoints=this.equalizerPoints.map(function(e){return e.getJson()}),e}},{key:"fromJson",value:function(e,n){for(var a in Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),"updateRate"in e&&(this.updateRate=e.updateRate),this.equalizerPoints)this.equalizerPoints[a].fromJson(e.equalizerPoints[a]);return this}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),t}(un.Effect),mn=function(){function e(t,n,a,r,s){var i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:dn;Object(o.a)(this,e),this.name="EQ Frequency "+s,this.number=s,this.type=c,this.sequencerEngine=t,this.store=t.store,this.filter=new q.a.Filter(n,c),this.filter.Q.value=r,this.filter.gain.value=a,this.frequencyParameter=new Xt(this.name+" frequency",this.filter.frequency,{min:0,max:1e4,unit:"hz",defaultValue:n}),this.gainParameter=new Xt(this.name+" gain",this.filter.gain,{min:-16,max:16,unit:"db",defaultValue:a}),this.qParameter=new Xt(this.name+" q",this.filter.Q,{min:0,max:16,unit:"Q",defaultValue:r}),this.enabledParameter=new Wt(this.name+" enabled",this,function(e,t){},{min:0,max:1,unit:"boolean",defaultValue:i}),this.parameters=[],this.registerParameter(this.enabledParameter),this.registerParameter(this.frequencyParameter),this.registerParameter(this.gainParameter),this.registerParameter(this.qParameter)}return Object(c.a)(e,[{key:"dispose",value:function(){this.filter._param&&this.filter.dispose(),this.filter=void 0,this.parameters.forEach(function(e){return e.dispose()}),this.gainParameter=void 0,this.qParameter=void 0}},{key:"getJson",value:function(){var e={number:this.number,frequency:this.frequency,gain:this.gain,q:this.q,enabled:this.enabled};return e=ln(e,"frequencyParameter",this.frequencyParameter),e=ln(e,"qParameter",this.qParameter),e=ln(e,"gainParameter",this.gainParameter),e=ln(e,"enabledParameter",this.enabledParameter)}},{key:"fromJson",value:function(e){this.enabled=e.enabled,this.frequency=e.frequency,this.frequencyParameter.unlockedValue=e.frequency,this.q=e.q,this.qParameter.unlockedValue=e.q,this.gain=e.gain,this.gainParameter.unlockedValue=e.gain,pn(e,"frequencyParameter",this.frequencyParameter,this.sequencerEngine),pn(e,"qParameter",this.qParameter,this.sequencerEngine),pn(e,"gainParameter",this.gainParameter,this.sequencerEngine),pn(e,"enabledParameter",this.enabledParameter)}},{key:"registerParameter",value:function(e){void 0!==e&&(e.name=e.name,e.effectName=this.name,e.setStore(this.store),this.parameters.push(e))}},{key:"frequencyToGain",value:function(e){return"peaking"===this.type?this.frequencyToGainPeaking(e):"highshelf"===this.type?this.frequencyToGainHighShelf(e):this.frequencyToGainLowShelf(e)}},{key:"frequencyToGainPeaking",value:function(e){var t=200/this.q,n=e-t/2,a=e+t/2;return e<=n||e>=a?0:e<this.frequency?this.gain*((e-n)/(this.frequency-n)):this.gain*((a-e)/(a-this.frequency))}},{key:"frequencyToGainHighShelf",value:function(e){var t=e-100;return(e+=100)<=t?0:e>=this.frequency?this.gain:this.gain*((e-t)/(this.frequency-t))}},{key:"frequencyToGainLowShelf",value:function(e){var t=e+100;return e>=t?0:e<=this.frequency?this.gain:this.gain*((e-t)/(this.frequency-t))}},{key:"enabled",get:function(){return this.enabledParameter.get()},set:function(e){return this.enabledParameter.set(e)}},{key:"frequency",get:function(){return this.frequencyParameter.get()},set:function(e){this.frequencyParameter.set(e)}},{key:"gain",get:function(){return this.gainParameter.get()},set:function(e){this.gainParameter.set(e)}},{key:"q",get:function(){return this.qParameter.get()},set:function(e){this.qParameter.set(e)}}]),e}(),vn=fn,gn=n(196),bn=q.a.Frequency("C3"),yn={Hangar:"/convolverHangar.wav","Giant Cave":"/convolver/GiantCave.wav","Airport Terminal":"/convolver/AirportTerminal.wav","Outdoor Blastoff":"/convolver/OutdoorBlastOff.wav","Outdoor Stadium":"/convolver/OutdoorStadium.wav","Plate Large":"/convolver/PlateLarge.wav","Plate Medium":"/convolver/PlateMedium.wav","Plate Small":"/convolver/PlateSmall.wav","Plate Super Dry":"/convolver/PlateSuperDry.wav","Prime Long":"/convolver/PrimeLong.wav","Prime Medium":"/convolver/PrimeMed.wav","Prime Short":"/convolver/PrimeShort.wav","Prime Extra Long":"/convolver/PrimeXtraLong.wav","Room Concert Hall":"/convolver/RoomConcertHall.wav","Room Huge":"/convolver/RoomHuge.wav","Room Large":"/convolver/RoomLarge.wav","Room Medium":"/convolver/RoomMedium.wav","Room Pool":"/convolver/RoomPool.wav"},kn=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Convolver Reverb",function(){return new q.a.Convolver(Je.DEFAULT_BUFFER)},e))).rawBuffer=new q.a.Buffer(Je.DEFAULT_BUFFER),n.convolverType="Prime Extra Long",n.convolverSample=void 0,n.pitchParameter=new Wt("Pitch",Object(p.a)(n),function(e,t){return e.pitch=t},{automatable:!1}),n.durationParameter=new Wt("duration",Object(p.a)(n),function(e,t){return e.release=t},{defaultValue:100,automatable:!1}),n.attackParameter=new Wt("attack",Object(p.a)(n),function(e,t){return e.attack=t},{defaultValue:0,automatable:!1}),n.registerParameter(n.attackParameter),n.registerParameter(n.pitchParameter),n.registerParameter(n.durationParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"renderBuffer",value:function(){var e=this;if(void 0!==this.rawBuffer&&null!==this.rawBuffer){var t=new q.a.Buffer(this.rawBuffer),n=t.duration*this.duration/100,a=t.duration*this.attack/100;q.a.Offline(function(){var t=new q.a.Sampler({C3:e.rawBuffer},{curve:"linear"});t.toMaster();var r=++n;t.attack=a,t.release=r/2,t.triggerAttackRelease(bn.transpose(e.pitch),n)},2*n).then(function(){var t=Object(g.a)(v.a.mark(function t(n){var a;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a=0;case 1:if(null!==e.effectNode._buffer){t.next=8;break}return t.next=4,e.sleep(100);case 4:if(!(a>20)){t.next=6;break}return t.abrupt("return");case 6:t.next=1;break;case 8:e.effectNode.buffer=n;case 9:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}}},{key:"sleep",value:function(e){return new Promise(function(t,n){setTimeout(function(){return t()},e)})}},{key:"setConvolverSample",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.convolverType=void 0,this.convolverSample=t,void 0===this.encryptedIpfs&&(this.encryptedIpfs=new gn.a(this.sequencerEngine.store,this.sequencerEngine.ethereum.guilds,this.sequencerEngine.ethereum.encryption,this.sequencerEngine.ethereum.crypto)),e.next=5,this.encryptedIpfs.getSound(t);case 5:return n=e.sent,e.next=8,q.a.Master.context.decodeAudioData(n.buffer);case 8:a=e.sent,this.rawBuffer=a,this.renderBuffer();case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setConvolverType",value:function(e){var t=this;if(e in yn){var n=window.installation?"/public"+yn[e]:yn[e];this.effectNode.load(n,function(){t.rawBuffer=new q.a.Buffer(t.effectNode.buffer),t.renderBuffer()}),this.samplePitch=0,this.convolverType=e,this.convolverSample=void 0}}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}},{key:"getJson",value:function(){return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),convolverType:this.convolverType,convolverSample:this.convolverSample,pitch:this.pitch,attack:this.attack,duration:this.duration})}},{key:"fromJson",value:function(e,n){var a=this;Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),void 0!==e.convolverType?"Prime Extra Long"!==e.convolverType&&this.setConvolverType(e.convolverType):void 0!==e.convolverSample&&setTimeout(function(){a.setConvolverSample(e.convolverSample,e)},1e3),"pitch"in e&&this.pitchParameter.set(e.pitch),"attack"in e&&this.attackParameter.set(e.attack),"duration"in e&&this.durationParameter.set(e.duration)}},{key:"release",set:function(e){100!==e&&this.renderBuffer()}},{key:"attack",set:function(e){0!==e&&this.renderBuffer()},get:function(){return this.attackParameter.get()}},{key:"pitch",set:function(e){0!==e?this.renderBuffer():this.effectNode.buffer=this.rawBuffer},get:function(){return this.pitchParameter.get()}},{key:"duration",get:function(){return this.durationParameter.get()}}]),t}(un.Effect),En=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Delay",function(){return new q.a.FeedbackDelay(new q.a.Time("16n"),.5)},e))).delayTime="16n",n.rateParameter=new Qt("Delay Rate",n.effectNode.delayTime,function(e,t){n.rawDelayRate=t,"number"===typeof t&&(t/=1e3),t._val&&(t="object"==typeof t._val?new q.a.Time(t._val._val):new q.a.Time(t._val)),n.effectNode.delayTime.linearRampToValueAtTime(new q.a.Time(t),.001)},{min:1e-4,max:1,unit:"",defaultValue:new q.a.Time("8n")}),n.rawDelayRate="8n",n.isSynced=!0,n.registerParameter(n.rateParameter),n.feedbackParameter=new Zt("Feedback",n.effectNode.feedback),n.registerParameter(n.feedbackParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"setFeedback",value:function(e){this.feedbackParameter.set(e)}},{key:"getFeedback",value:function(){return this.effectNode.feedback.value}},{key:"onBPMUpdated",value:function(){this.isSynced&&this.rateParameter.set(this.rawDelayRate,!0)}},{key:"getDelayTime",value:function(){return this.delayTime}},{key:"getJson",value:function(){var e=this.rate;"object"===typeof e&&e.toSeconds&&(e=this.rate.toSeconds());var n=Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{name:this.name,enabled:this.enabledParameter.get(),wet:this.effectNode.wet.value,feedback:this.effectNode.feedback.value,isSynced:this.isSynced,rate:e,rawDelayRate:this.rawDelayRate});return n=this.saveParameterToJson(n,"feedbackParameter",this.feedbackParameter),n=this.saveParameterToJson(n,"rateParameter",this.rateParameter)}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),"wet"in e&&"feedback"in e&&(this.enable(e.enabled),this.setWet(e.wet),this.feedbackParameter.set(e.feedback)),"delayTime"in e&&(this.rate=e.delayTime),"rate"in e&&(this.rate=e.rate),"rawDelayRate"in e&&(this.rawDelayRate=e.rawDelayRate),"isSynced"in e&&(this.isSynced=e.isSynced),this.loadParameterFromJson(e,"feedbackParameter",this.feedbackParameter),this.loadParameterFromJson(e,"rateParameter",this.rateParameter)}},{key:"rate",set:function(e){this.rateParameter.set(e)},get:function(){return this.rateParameter.get()}}]),t}(un.Effect),Sn=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Ultra Phaser",function(){return new q.a.Gain(1)},e))).poles=8,n.generateAllPassFilters(),n.rateParameter=new Xt("Rate",n.lfo.frequency,{defaultValue:"1n",min:0,max:1}),n.registerParameter(n.rateParameter),n.feedbackParameter=new Xt("Feedback",n.feedbackNode.gain,{defaultValue:.1,min:0,max:1}),n.registerParameter(n.feedbackParameter),n.wetParameter=new Xt("Wet",n.crossFade.fade,{defaultValue:.5,min:0,max:1}),n.registerParameter(n.wetParameter),n.depthParameter=new Qt("Depth",n.lfo._scaler._scale,function(e,t){n.lfo.max=t},{min:0,max:1,unit:"",defaultValue:.5,automatable:!1}),n.registerParameter(n.depthParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"generateAllPassFilters",value:function(){var e=this;this.filters=[],this.scalers=[];for(var t=100,n=0;n<this.poles;n++){var a=new q.a.Filter(t,"allpass");this.filters.push(a);var r=new q.a.Scale(t,t+4e3);r.connect(a.frequency),this.scalers.push(r),t+=1e3}this.outputNode=new q.a.Gain(1),this.lfo=new q.a.LFO("1n",0,1),this.filters.forEach(function(t,n){return e.lfo.connect(e.scalers[n])});var s=this.effectNode;for(var i in this.filters)s.connect(this.filters[i]),s=this.filters[i];this.lfo.start(),this.crossFade=new q.a.CrossFade(0),this.crossFade.connect(this.outputNode),this.effectNode.connect(this.crossFade,0,0),s.connect(this.crossFade,0,1),this.feedbackNode=new q.a.Gain(.2),s.connect(this.feedbackNode),this.feedbackNode.connect(this.filters[0])}},{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}},{key:"getJson",value:function(){var e=Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{rate:this.rateParameter.get(),feedback:this.feedbackParameter.get(),wet:this.wetParameter.get(),depth:this.depthParameter.get()});return e=this.saveParameterToJson(e,"rateParameter",this.rateParameter),e=this.saveParameterToJson(e,"feedbackParameter",this.feedbackParameter),e=this.saveParameterToJson(e,"wetParameter",this.wetParameter),e=this.saveParameterToJson(e,"depthParameter",this.depthParameter)}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),this.rateParameter.set(e.rate),this.feedbackParameter.set(e.feedback),this.wetParameter.set(e.wet),this.depthParameter.set(e.depth),this.loadParameterFromJson(e,"rateParameter",this.rateParameter),this.loadParameterFromJson(e,"feedbackParameter",this.feedbackParameter),this.loadParameterFromJson(e,"wetParameter",this.wetParameter),this.loadParameterFromJson(e,"depthParameter",this.depthParameter)}}]),t}(un.Effect),On=function(){function e(t,n){Object(o.a)(this,e),this.output=t,this.sequencerEngine=n,this.input=new q.a.Gain(1),this.eq=new vn(n,!1),this.getLowEQ().frequencyParameter.set(250),this.getMidEQ().frequencyParameter.set(1e3),this.getMidEQ().qParameter.set(.9),this.getHighEQ().frequencyParameter.set(3400),this.convolverReverb=new kn(n),this.convolverReverb.wet=1,this.delay=new En(n),this.delay.wet=0,this.phaser=new Sn(n),this.phaser.rateParameter.set(.2),this.phaser.feedbackParameter.set(.4),this.phaser.wet=0,this.input.connect(this.eq.effectNode),this.eq.connect(this.convolverReverb.effectNode),this.convolverReverb.connect(this.delay.effectNode),this.delay.connect(this.phaser.effectNode),this.phaser.connect(this.output)}return Object(c.a)(e,[{key:"getEQ",value:function(e){switch(e){case Ne:return this.getLowEQ();case qe:return this.getMidEQ();case Me:return this.getHighEQ()}}},{key:"toggleEQ",value:function(e){var t=this.getEQ(e);-24===t.gainParameter.get()?t.gainParameter.set(0):t.gainParameter.set(-24)}},{key:"toggleEffect",value:function(e){switch(e){case Te:this.toggleReverb();break;case je:this.toggleDelay();break;case xe:this.togglePhaser()}}},{key:"toggleDelay",value:function(){1===this.delay.wetParameter.get()?this.delay.wet=0:this.delay.wet=1}},{key:"toggleReverb",value:function(){1===this.convolverReverb.wetParameter.get()?this.convolverReverb.wet=0:this.convolverReverb.wet=1}},{key:"togglePhaser",value:function(){1===this.phaser.wetParameter.get()?this.phaser.wet=0:this.phaser.wet=1}},{key:"getLowEQ",value:function(){return this.eq.equalizerPoints[0]}},{key:"getMidEQ",value:function(){return this.eq.equalizerPoints[4]}},{key:"getHighEQ",value:function(){return this.eq.equalizerPoints[7]}},{key:"color",set:function(e){this.delay.feedbackParameter.set(.75*e),this.phaser.depthParameter.set(e)}}]),e}();function wn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;return Math.random()<e}function Cn(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;if(void 0!==n&&wn(r)){var s=t+"Parameter";s in n?(a.disconnectFromAllModulators(),a.fromJson(n[s],e),a.set(n[t])):t in n&&a.set(n[t])}}var Pn=function(){function e(t,n){Object(o.a)(this,e),this.minValue=t,this.maxValue=t,this.min=t,this.max=n}return Object(c.a)(e,[{key:"min",set:function(e){this.minValue="-"===e?-0:parseFloat(e)},get:function(){return this.minValue}},{key:"max",set:function(e){this.maxValue="-"===e?-0:parseFloat(e)},get:function(){return this.maxValue}}]),e}(),Tn=function(){function e(t,n,a,r){Object(o.a)(this,e),this.sequencerEngine=t,this.store=t.store,this.context=a,this.number=r,this.idToParameter={},this.parameterToScaler={},this.parameterIdToVoiceToNode={},this.parameters=[]}return Object(c.a)(e,[{key:"getType",value:function(){}},{key:"connect",value:function(e,t,n){var a=this;if(void 0!==e){this.idToParameter[t.id]=t;var r,s=this.getChain(t,e);if(this.sequencerEngine.hasAtleastOneSequencerEnginePlaying())setTimeout(function(){var e;(e=a.getModulator()).chain.apply(e,Object(ge.a)(s))},300);else(r=this.getModulator()).chain.apply(r,Object(ge.a)(s));return void 0===this.parameterIdToVoiceToNode[t.id]&&(this.parameterIdToVoiceToNode[t.id]={}),this.parameterIdToVoiceToNode[t.id][n]=s,s}var i=new Pn(t.min,t.max);this.parameterToScaler[t.id]=i}},{key:"disconnect",value:function(e,t,n){if(void 0!==this.parameterIdToVoiceToNode[t.id]){delete this.idToParameter[t.id];var a=this.parameterIdToVoiceToNode[t.id][n];if(delete this.parameterIdToVoiceToNode[t.id][n],0===Object.keys(this.parameterIdToVoiceToNode[t.id]).length&&delete this.parameterIdToVoiceToNode[t.id],void 0!==this.parameterToScaler[t.id]&&delete this.parameterToScaler[t.id],void 0!==a){this.getModulator().disconnect(a[0]);for(var r=0;r<a.length-1;r++)a[r].disconnect(a[r+1])}}}},{key:"disconnectAllModulators",value:function(){this.parameters.forEach(function(e){return e.disconnectFromAllModulators()})}},{key:"getScaleForParameter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.parameterToScaler[e.id])return this.parameterToScaler[e.id];var n=this.parameterIdToVoiceToNode[e.id];if(void 0!==n){var a=n[t];return this.getScaleFromChain(a)}}}]),e}();var jn=function(e){function t(e,n,a,r){var s;return Object(o.a)(this,t),(s=Object(u.a)(this,Object(l.a)(t).call(this,e,n,a,r))).lastValue=void 0,s.lastStep=void 0,s.number=r,s.rawLFORate=void 0,s.mixSession=n,s.lfo=new q.a.LFO(.5,-100,100),s.setupLFOParameters(),s.meter=new q.a.Analyser({type:"waveform",size:32,smoothing:.7}),s.lfo.connect(s.meter),s.isSynced=!0,s}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getType",value:function(){return"LFO"}},{key:"dispose",value:function(){for(var e in console.log("disposing lfo"),this.lfo.dispose(),this.meter.dispose(),this.parameters.forEach(function(e){return e.dispose()}),this.parameterIdToVoiceToNode){var t=this.parameterIdToVoiceToNode[e];for(var n in t){t[n].filter(function(e){return e.disconnect&&e._param}).forEach(function(e){return e.disconnect()})}}this.parameterIdToVoiceToNode=void 0,this.lfo=void 0,this.meter=void 0,this.lfoRateParameter=void 0,this.lfoMinParameter=void 0,this.lfoMaxParameter=void 0,this.lfoPhaseParameter=void 0}},{key:"getScaleFromChain",value:function(e){return e[2]}},{key:"getValue",value:function(e){if(e===this.lastStep)return this.lastValue;var t=this.meter.getValue()[0];return this.lastStep=e,this.lastValue=t,t}},{key:"start",value:function(){this.lfo.start(),this.lfo.lfoType=this.lfoType}},{key:"stop",value:function(){this.lfo.stop()}},{key:"getModulator",value:function(){return this.lfo}},{key:"getChain",value:function(e,t){return[new q.a.Gain(1),new q.a.Normalize(-100,100),new q.a.Scale(e.min,e.max),t]}},{key:"connect",value:function(e,n,a){if(void 0!==e){var r=e;e.input&&!Array.isArray(e.input)&&(r=e.input);Object(ze.a)(Object(l.a)(t.prototype),"connect",this).call(this,r,n,a)}else{var s=new Pn(n.min,n.max);this.parameterToScaler[n.id]=s}}},{key:"setupLFOParameters",value:function(){var e=this;this.lfoTypeParameter=new Wt("LFO Type",this,function(t,n){e.stop(),e.lfo.type=n,e.start()},{min:0,max:1,defaultValue:"sine",automatable:!1}),this.registerParameter(this.lfoTypeParameter),this.lfoRateParameter=new Qt("LFO Rate",this.lfo.frequency,function(t,n){e.lfo.frequency.value=n},{min:0,max:20,unit:"",defaultValue:"4n"}),this.registerParameter(this.lfoRateParameter),this.lfoMinParameter=new Qt("LFO Min",this.lfo._scaler._add,function(t,n){e.lfo.min=n},{min:-100,max:100,unit:"",defaultValue:0}),this.registerParameter(this.lfoMinParameter),this.lfoMaxParameter=new Qt("LFO Max",this.lfo._scaler._scale,function(t,n){e.lfo.max=n},{min:-100,max:100,unit:"",defaultValue:0}),this.registerParameter(this.lfoMaxParameter),this.lfoPhaseParameter=new Wt("LFO Phase",this,function(t,n){e.lfo.phase=n},{min:0,max:360,unit:"",defaultValue:0}),this.registerParameter(this.lfoPhaseParameter)}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),this.parameters.push(e)}},{key:"onBPMUpdated",value:function(){this.lfoRate=this.lfoRate}},{key:"getJson",value:function(){var e=this.lfoRate;return"number"!==typeof e&&void 0!==this.rawLFORate&&(e=this.rawLFORate),{lfoRateParameter:this.lfoRateParameter.getJson(),lfoRate:e,lfoMinParameter:this.lfoMinParameter.getJson(),lfoMaxParameter:this.lfoMaxParameter.getJson(),lfoTypeParameter:this.lfoTypeParameter.getJson(),lfoPhaseParameter:this.lfoPhaseParameter.getJson(),isSynced:this.isSynced}}},{key:"fromJson",value:function(e){"lfoRateParameter"in e&&this.lfoRateParameter.fromJson(e.lfoRateParameter,this.sequencerEngine),"isSynced"in e&&(this.isSynced=e.isSynced),"lfoRate"in e&&(Object($e.a)(e.lfoRate)&&this.isSynced?this.lfoRate=new q.a.Time(1/e.lfoRate).toNotation():this.lfoRate=e.lfoRate),"lfoMinParameter"in e&&this.lfoMinParameter.fromJson(e.lfoMinParameter,this.sequencerEngine),"lfoMin"in e&&(this.lfoMin=e.lfoMin),"lfoMaxParameter"in e&&this.lfoMaxParameter.fromJson(e.lfoMaxParameter,this.sequencerEngine),"lfoMax"in e&&(this.lfoMax=e.lfoMax),"lfoTypeParameter"in e&&this.lfoTypeParameter.fromJson(e.lfoTypeParameter,this.sequencerEngine),"lfoType"in e&&(this.lfoType=e.lfoType),"lfoPhaseParameter"in e&&this.lfoPhaseParameter.fromJson(e.lfoPhaseParameter,this.sequencerEngine),"lfoPhase"in e&&(this.lfoPhase=e.lfoPhase)}},{key:"copyFrom",value:function(e){this.lfoType=e.lfoType,this.lfoRate=e.lfoRate,this.lfoMin=e.lfoMin,this.lfoMax=e.lfoMax,this.lfoPhase=e.lfoPhase,this.isSynced=e.isSynced}},{key:"mateJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;wn(t)&&(this.lfoTypeParameter.disconnectFromAllModulators(),this.lfoTypeParameter.fromJson(e.lfoTypeParameter,this.sequencerEngine)),wn(t)&&(this.lfoRateParameter.disconnectFromAllModulators(),this.lfoRate=e.lfoRate,this.lfoRateParameter.fromJson(e.lfoRateParameter,this.sequencerEngine)),wn(t)&&(this.lfoMinParameter.disconnectFromAllModulators(),this.lfoMinParameter.fromJson(e.lfoMinParameter,this.sequencerEngine)),wn(t)&&(this.lfoMaxParameter.disconnectFromAllModulators(),this.lfoMaxParameter.fromJson(e.lfoMaxParameter,this.sequencerEngine)),wn(t)&&(this.lfoPhaseParameter.disconnectFromAllModulators(),this.lfoPhaseParameter.fromJson(e.lfoPhaseParameter,this.sequencerEngine))}},{key:"getCopy",value:function(){var e=new t(this.sequencerEngine,this.mixSession,this.context,this.number);return e.fromJson(this.getJson()),e}},{key:"name",get:function(){return"LFO "+this.number}},{key:"lfoType",get:function(){return void 0===this.lfoTypeParameter?"sine":this.lfoTypeParameter.get()},set:function(e){this.lfoTypeParameter.set(e)}},{key:"lfoRate",get:function(){return this.lfoRateParameter.get()},set:function(e){this.lfoRateParameter.set(e),this.rawLFORate=e}},{key:"lfoMin",get:function(){return this.lfoMinParameter.get()},set:function(e){this.lfoMinParameter.set(e)}},{key:"lfoMax",get:function(){return this.lfoMaxParameter.get()},set:function(e){this.lfoMaxParameter.set(e)}},{key:"lfoPhase",get:function(){return this.lfoPhaseParameter.get()},set:function(e){this.lfoPhaseParameter.set(e)}}]),t}(Tn),xn=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Auto Wah",function(){return new q.a.AutoWah(50,6,-30)},e))).effectNode.gain.value=6,n.baseFrequencyParameter=new Wt("Base Frequency",n.effectNode,function(e,t){return e.baseFrequency=t},{min:0,max:1e4,unit:"hz",defaultValue:400}),n.registerParameter(n.baseFrequencyParameter),n.octaveParameter=new Wt("Octaves",n.effectNode,function(e,t){return e.octaves=t},{min:0,max:10,unit:"",defaultValue:1}),n.registerParameter(n.octaveParameter),n.qParameter=new Yt("Q",n.effectNode.Q,{min:0,max:10,unit:"",defaultValue:0}),n.registerParameter(n.qParameter),n.sensitivityParameter=new Wt("Sensitivity",n.effectNode,function(e,t){return e.sensitivity=t},{min:-12,max:6,unit:"db",defaultValue:0}),n.registerParameter(n.sensitivityParameter),n.attackParameter=new Wt("Attack",n.effectNode,function(e,t){return e.follower.attack=t},{min:0,max:2,unit:"",defaultValue:0}),n.registerParameter(n.attackParameter),n.releaseParameter=new Wt("Release",n.effectNode,function(e,t){return e.follower.release=t},{min:0,max:2,unit:"",defaultValue:0}),n.registerParameter(n.releaseParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getJson",value:function(){var e=Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this);return e.name=this.name,e.baseFrequency=this.baseFrequencyParameter.get(),e.octave=this.octaveParameter.get(),e.q=this.qParameter.get(),e.sensitivity=this.sensitivityParameter.get(),e.attack=this.attackParameter.get(),e.release=this.releaseParameter.get(),e.wet=this.wetParameter.get(),e}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),"baseFrequency"in e&&this.baseFrequencyParameter.set(e.baseFrequency),"octave"in e&&this.octaveParameter.set(e.octave),"sensitivity"in e&&this.sensitivityParameter.set(e.sensitivity),"q"in e&&this.qParameter.set(e.q),"attack"in e&&this.attackParameter.set(e.attack),"release"in e&&this.releaseParameter.set(e.release),e.enabled&&this.enable(!0),"wet"in e&&this.setValue(e.wet)}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),t}(un.Effect),Nn=(un.Effect,function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Stereo Widener",function(){return new q.a.StereoWidener(.5)},e))).widthParameter=new Xt("Width",n.effectNode.width,{min:0,max:1,defaultValue:.5}),n.registerParameter(n.widthParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getJson",value:function(){var e=Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this);return e.width=this.widthParameter.get(),e=this.saveParameterToJson(e,"widthParameter",this.widthParameter)}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),this.widthParameter.set(e.width),this.loadParameterFromJson(e,"widthParameter",this.widthParameter)}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),t}(un.Effect)),qn=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,"Oscilloscope",function(){return new q.a.Analyser({type:"waveform",size:512})},e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getValue",value:function(){return this.effectNode.getValue()}},{key:"getEffectCopy",value:function(){return new t(this.seuqencerEngine)}}]),t}(un.Effect),Mn=function(e){function t(e,n,a){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e,n,a))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"dispose",value:function(){Object(ze.a)(Object(l.a)(t.prototype),"dispose",this).call(this)}},{key:"setCompressors",value:function(e){for(var t in this.compressors=[],e)this.compressors.push(new Dn(t,this.store,e[t]))}},{key:"getJson",value:function(){return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{compressors:this.compressors.map(function(e){return e.getJson()})})}},{key:"fromJson",value:function(e,n){for(var a in Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),e.compressors){var r=e.compressors[a].name;this.getCompressor(r).fromJson(e.compressors[a])}}},{key:"getCompressor",value:function(e){return this.compressors.find(function(t){return t.name===e})}}]),t}(un.Effect),Dn=function(){function e(t,n,a){Object(o.a)(this,e),this.name=t,this.store=n,this.compressorNode=a,this.parameters=[],this.thresholdParameter=new Xt("Threshold",this.compressorNode.threshold,{min:-80,max:8,unit:"",defaultValue:0,constantAutomationRate:!0}),this.registerParameter(this.thresholdParameter),this.ratioParameter=new Xt("Ratio",this.compressorNode.ratio,{min:1,max:24,unit:"",defaultValue:3,constantAutomationRate:!0}),this.registerParameter(this.ratioParameter),this.attackParameter=new Zt("Attack",this.compressorNode.attack,{constantAutomationRate:!0}),this.registerParameter(this.attackParameter),this.releaseParameter=new Zt("Release",this.compressorNode.release,{constantAutomationRate:!0}),this.registerParameter(this.releaseParameter),this.releaseParameter.set(.1),this.kneeParameter=new Xt("Knee",this.compressorNode.knee,{min:0,max:40,unit:"db",defaultValue:1,constantAutomationRate:!0}),this.registerParameter(this.kneeParameter)}return Object(c.a)(e,[{key:"registerParameter",value:function(e){void 0!==e&&(e.name=e.name,e.effectName=this.name,e.setStore(this.store),this.parameters.push(e))}},{key:"getJson",value:function(){var e={name:this.name,threshold:this.thresholdParameter.get(),ratio:this.ratioParameter.get(),attack:this.attackParameter.get(),release:this.releaseParameter.get()};return e=ln(e,"thresholdParameter",this.thresholdParameter),e=ln(e,"ratioParameter",this.ratioParameter),e=ln(e,"attackParameter",this.attackParameter),e=ln(e,"releaseParameter",this.releaseParameter)}},{key:"fromJson",value:function(e){this.thresholdParameter.set(e.threshold),this.ratioParameter.set(e.ratio),this.attackParameter.set(e.attack),this.releaseParameter.set(e.release),pn(e,"thresholdParameter",this.thresholdParameter),pn(e,"ratioParameter",this.ratioParameter),pn(e,"attackParameter",this.attackParameter),pn(e,"releaseParameter",this.releaseParameter)}}]),e}(),An=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Multiband Compressor",function(){return new q.a.MultibandCompressor},e))).setCompressors({LOW:n.effectNode.low,MID:n.effectNode.mid,HIGH:n.effectNode.high}),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"dispose",value:function(){Object(ze.a)(Object(l.a)(t.prototype),"dispose",this).call(this)}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),t}(Mn),Rn=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Chebyshev",function(){return new q.a.Chebyshev(1)},e))).effectNode.oversampling="none",n.orderParameter=new Qt("Order",n.effectNode,function(e,t){return e.order=t},{min:1,max:100,unit:"",defaultValue:1}),n.registerParameter(n.orderParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getJson",value:function(){var e=Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this);return e.order=this.effectNode.order,e.enabled=this.enabledParameter.get(),e.wet=this.effectNode.wet.value,e.name=this.name,e=this.saveParameterToJson(e,"orderParameter",this.orderParameter)}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),this.orderParameter.set(e.order),e.enabled&&this.enable(!0),this.setValue(e.value),this.loadParameterFromJson(e,"orderParameter",this.orderParameter)}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),t}(un.Effect),In=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Bit Crusher",function(){return new q.a.BitCrusher(8)},e))).bitsParameter=new Qt("Bits",n.effectNode,function(e,t){return e.bits=t},{min:1,max:8,unit:"",defaultValue:8}),n.registerParameter(n.bitsParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getJson",value:function(){var e=Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this);return e.bits=this.bitsParameter.get(),e.name=this.name,this.saveParameterToJson(e,"bitsParameter",this.bitsParameter)}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),this.effectNode.bits=e.bits,this.effectNode.wet.value=e.wet,e.enabled&&this.enable(!0),this.loadParameterFromJson(e,"bitsParameter",this.bitsParameter)}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),t}(un.Effect),Ln=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Compressor",function(){return new q.a.Gain(1)},e))).effectNode.gain.value=1,n.compressorNode=new q.a.Compressor(-24,3),n.effectNode.connect(n.compressorNode),n.gainParameter=new Xt("Gain",n.effectNode.gain,{min:0,max:2,unit:"db",defaultValue:.5}),n.registerParameter(n.gainParameter),n.thresholdParameter=new Xt("Threshold",n.compressorNode.threshold,{min:-80,max:8,unit:"",defaultValue:0,constantAutomationRate:!0}),n.registerParameter(n.thresholdParameter),n.ratioParameter=new Xt("Ratio",n.compressorNode.ratio,{min:1,max:24,unit:"",defaultValue:3,constantAutomationRate:!0}),n.registerParameter(n.ratioParameter),n.attackParameter=new Zt("Attack",n.compressorNode.attack,{constantAutomationRate:!0}),n.registerParameter(n.attackParameter),n.releaseParameter=new Zt("Release",n.compressorNode.release,{constantAutomationRate:!0}),n.registerParameter(n.releaseParameter),n.releaseParameter.set(.1),n.kneeParameter=new Xt("Knee",n.compressorNode.knee,{min:0,max:40,unit:"db",defaultValue:1,constantAutomationRate:!0}),n.registerParameter(n.kneeParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"dispose",value:function(){Object(ze.a)(Object(l.a)(t.prototype),"dispose",this).call(this),this.compressorNode.dispose(),this.compressorNode=void 0}},{key:"connect",value:function(e){this.connectedNode=e,this.compressorNode.connect(e)}},{key:"disconnect",value:function(e){null!=this.connectedNode&&(this.compressorNode.disconnect(e),this.connectedNode=null)}},{key:"getJson",value:function(){var e=Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this);return e.name=this.name,e.gain=this.gainParameter.get(),e.threshold=this.thresholdParameter.get(),e.ratio=this.ratioParameter.get(),e.release=this.releaseParameter.get(),e.attack=this.attackParameter.get(),e.knee=this.kneeParameter.get(),e.enabled=this.enabledParameter.get(),(this.gainParameter.isConnectedToAnyModulator()||Object.keys(this.gainParameter.patternToValue).length>0)&&(e.gainParameter=this.gainParameter.getJson()),(this.thresholdParameter.isConnectedToAnyModulator()||Object.keys(this.thresholdParameter.patternToValue).length>0)&&(e.thresholdParameter=this.thresholdParameter.getJson()),(this.ratioParameter.isConnectedToAnyModulator()||Object.keys(this.ratioParameter.patternToValue).length>0)&&(e.ratioParameter=this.ratioParameter.getJson()),(this.releaseParameter.isConnectedToAnyModulator()||Object.keys(this.releaseParameter.patternToValue).length>0)&&(e.releaseParameter=this.releaseParameter.getJson()),(this.attackParameter.isConnectedToAnyModulator()||Object.keys(this.attackParameter.patternToValue).length>0)&&(e.attackParameter=this.attackParameter.getJson()),this.kneeParameter.isConnectedToAnyModulator()|Object.keys(this.kneeParameter.patternToValue).length>0&&(e.kneeParameter=this.kneeParameter.getJson()),e}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),"gain"in e&&this.gainParameter.set(e.gain),"threshold"in e&&this.thresholdParameter.set(e.threshold),"ratio"in e&&this.ratioParameter.set(e.ratio),"release"in e&&this.releaseParameter.set(e.release),"attack"in e&&this.attackParameter.set(e.attack),"knee"in e&&this.kneeParameter.set(e.knee),e.enabled&&this.enable(!0),this.loadParameterFromJson(e,"gainParameter",this.gainParameter),this.loadParameterFromJson(e,"thresholdParameter",this.thresholdParameter),this.loadParameterFromJson(e,"ratioParameter",this.ratioParameter),this.loadParameterFromJson(e,"releaseParameter",this.releaseParameter),this.loadParameterFromJson(e,"attackParameter",this.attackParameter),this.loadParameterFromJson(e,"kneeParameter",this.kneeParameter)}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),t}(un.Effect),Fn=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Distortion",function(){return new q.a.Distortion(.4)},e))).effectNode.oversampling="4x",n.distortionParameter=new Qt("Distortion",n.effectNode,function(e,t){return e.distortion=t},{min:0,max:1,unit:"%",defaultValue:.1}),n.registerParameter(n.distortionParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getJson",value:function(){var e=Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this);return e.distortion=this.effectNode.distortion,e.enabled=this.enabledParameter.get(),e.wet=this.effectNode.wet.value,e.name=this.name,(this.distortionParameter.isConnectedToAnyModulator()||Object.keys(this.distortionParameter.patternToValue).length>0)&&(e.distortionParameter=this.distortionParameter.getJson()),e}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),this.distortionParameter.set(e.distortion),e.enabled&&this.enable(!0),this.setValue(e.value),this.loadParameterFromJson(e,"distortionParameter",this.distortionParameter)}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),t}(un.Effect),Vn=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Pitch Shift",function(){return new q.a.PitchShift(0)},e))).pitchParameter=new Qt("Pitch",n.effectNode,function(e,t){e.pitch=t},{min:-24,max:24,unit:"",defaultValue:12}),n.registerParameter(n.pitchParameter),n.windowSizeParameter=new Qt("Window Size",n.effectNode,function(e,t){return e.windowSize=t},{min:.03,max:.1,unit:"",defaultValue:.03}),n.registerParameter(n.windowSizeParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getJson",value:function(){var e=Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this);return e.pitch=this.pitchParameter.get(),e.windowSize=this.windowSizeParameter.get(),e.enabled=this.enabledParameter.get(),e.wet=this.effectNode.wet.value,e.name=this.name,e=this.saveParameterToJson(e,"pitchParameter",this.pitchParameter),e=this.saveParameterToJson(e,"windowSizeParameter",this.pitchParameter)}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),this.pitchParameter.set(e.pitch),this.windowSizeParameter.set(e.windowSize),e.enabled&&this.enable(!0),this.setValue(e.value),this.loadParameterFromJson(e,"pitchParameter",this.pitchParameter),this.loadParameterFromJson(e,"windowSizeParameter",this.pitchParameter)}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),t}(un.Effect),Bn=function(e){function t(e){var n;return Object(o.a)(this,t),n=Object(u.a)(this,Object(l.a)(t).call(this,"Panner",function(){return new q.a.Panner(0)},e)),console.log("_panner = "),console.log(n.effectNode._panner.pan),n.panningParameter=new Xt("Panning",n.effectNode._panner.pan,{min:-1,max:1,unit:"",defaultValue:0}),n.registerParameter(n.panningParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getJson",value:function(){var e=Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this);return e.panning=this.panningParameter.get(),e.enabled=this.enabledParameter.get(),e.name=this.name,e=this.saveParameterToJson(e,"panningParameter",this.panningParameter)}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),this.panningParameter.set(e.panning),e.enabled&&this.enable(!0),this.loadParameterFromJson(e,"panningParameter",this.panningParameter)}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),t}(un.Effect),Un=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"EQ 3",function(){return new q.a.EQ3},e))).lowParameter=new Wt("Low",n.effectNode.low,function(e,t){return e.value=t},{min:-10,max:10,unit:"db",defaultValue:0}),n.lowFrequencyParameter=new Wt("Low Frequency",n.effectNode.lowFrequency,function(e,t){return e.value=t},{min:0,max:400,unit:"hz",defaultValue:0}),n.midParameter=new Wt("Mid",n.effectNode.mid,function(e,t){return e.value=t},{min:-10,max:10,unit:"db",defaultValue:0}),n.highParameter=new Wt("High",n.effectNode.high,function(e,t){return e.value=t},{min:-10,max:10,unit:"db",defaultValue:0}),n.highFrequencyParameter=new Wt("High Frequency",n.effectNode.highFrequency,function(e,t){return e.value=t},{min:1e3,max:1e4,unit:"hz",defaultValue:2e3}),n.registerParameter(n.lowParameter),n.registerParameter(n.midParameter),n.registerParameter(n.highParameter),n.registerParameter(n.lowFrequencyParameter),n.registerParameter(n.highFrequencyParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getJson",value:function(){return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{low:this.lowParameter.get(),mid:this.midParameter.get(),high:this.highParameter.get(),lowFrequency:this.lowFrequencyParameter.get(),highFrequency:this.highFrequencyParameter.get(),enabled:this.enabledParameter.get(),name:this.name})}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),this.lowParameter.set(e.low),this.midParameter.set(e.mid),this.highParameter.set(e.high),this.lowFrequencyParameter.set(e.lowFrequency),this.highFrequencyParameter.set(e.highFrequency),this.enable(e.enabled)}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),t}(un.Effect),Hn="peaking",Jn=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"EQ 10",function(){return new q.a.Gain(1)},e))).filter31=new q.a.Filter(31,Hn),n.filter31.Q.value=.71,n.filter63=new q.a.Filter(63,Hn),n.filter63.Q.value=.71,n.filter125=new q.a.Filter(125,Hn),n.filter125.Q.value=.71,n.filter250=new q.a.Filter(250,Hn),n.filter250.Q.value=.71,n.filter500=new q.a.Filter(500,Hn),n.filter500.Q.value=.71,n.filter1k=new q.a.Filter(1e3,Hn),n.filter1k.Q.value=.71,n.filter2k=new q.a.Filter(2e3,Hn),n.filter2k.Q.value=.71,n.filter4k=new q.a.Filter(4e3,Hn),n.filter4k.Q.value=.71,n.filter8k=new q.a.Filter(8e3,Hn),n.filter8k.Q.value=.71,n.filter16k=new q.a.Filter(16e3,Hn),n.filter16k.Q.value=.71,n.outputNode=new q.a.Gain(1),n.effectNode.chain(n.filter31,n.filter63,n.filter125,n.filter250,n.filter500,n.filter1k,n.filter2k,n.filter4k,n.filter8k,n.filter16k,n.outputNode),n.gain31Parameter=new Xt("Gain 31",n.filter31.gain,{min:-12,max:12,unit:"db",defaultValue:0}),n.registerParameter(n.gain31Parameter),n.gain63Parameter=new Xt("Gain 63",n.filter63.gain,{min:-12,max:12,unit:"db",defaultValue:0}),n.registerParameter(n.gain63Parameter),n.gain125Parameter=new Xt("Gain 125",n.filter125.gain,{min:-12,max:12,unit:"db",defaultValue:0}),n.registerParameter(n.gain125Parameter),n.gain125Parameter=new Xt("Gain 125",n.filter125.gain,{min:-12,max:12,unit:"db",defaultValue:0}),n.registerParameter(n.gain125Parameter),n.gain250Parameter=new Xt("Gain 250",n.filter250.gain,{min:-12,max:12,unit:"db",defaultValue:0}),n.registerParameter(n.gain250Parameter),n.gain500Parameter=new Xt("Gain 500",n.filter500.gain,{min:-12,max:12,unit:"db",defaultValue:0}),n.registerParameter(n.gain500Parameter),n.gain1kParameter=new Xt("Gain 1k",n.filter1k.gain,{min:-12,max:12,unit:"db",defaultValue:0}),n.registerParameter(n.gain1kParameter),n.gain2kParameter=new Xt("Gain 2k",n.filter2k.gain,{min:-12,max:12,unit:"db",defaultValue:0}),n.registerParameter(n.gain2kParameter),n.gain4kParameter=new Xt("Gain 4k",n.filter4k.gain,{min:-12,max:12,unit:"db",defaultValue:0}),n.registerParameter(n.gain4kParameter),n.gain8kParameter=new Xt("Gain 8k",n.filter8k.gain,{min:-12,max:12,unit:"db",defaultValue:0}),n.registerParameter(n.gain8kParameter),n.gain16kParameter=new Xt("Gain 16k",n.filter16k.gain,{min:-12,max:12,unit:"db",defaultValue:0}),n.registerParameter(n.gain16kParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(){this.outputNode.disconnect()}},{key:"getJson",value:function(){var e=Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{gain63:this.gain63Parameter.get(),gain125:this.gain125Parameter.get(),gain250:this.gain250Parameter.get(),gain500:this.gain500Parameter.get(),gain1k:this.gain1kParameter.get(),gain2k:this.gain2kParameter.get(),gain4k:this.gain4kParameter.get(),gain8k:this.gain8kParameter.get(),gain16k:this.gain16kParameter.get()});return e=this.saveParameterToJson(e,"gain31Parameter",this.gain31Parameter),e=this.saveParameterToJson(e,"gain63Parameter",this.gain63Parameter),e=this.saveParameterToJson(e,"gain125Parameter",this.gain125Parameter),e=this.saveParameterToJson(e,"gain250Parameter",this.gain250Parameter),e=this.saveParameterToJson(e,"gain500Parameter",this.gain500Parameter),e=this.saveParameterToJson(e,"gain1kParameter",this.gain1kParameter),e=this.saveParameterToJson(e,"gain2kParameter",this.gain2kParameter),e=this.saveParameterToJson(e,"gain4kParameter",this.gain4kParameter),e=this.saveParameterToJson(e,"gain8kParameter",this.gain8kParameter),e=this.saveParameterToJson(e,"gain16kParameter",this.gain16kParameter)}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),this.gain63Parameter.set(e.gain63),this.gain125Parameter.set(e.gain125),this.gain250Parameter.set(e.gain250),this.gain500Parameter.set(e.gain500),this.gain1kParameter.set(e.gain1k),this.gain2kParameter.set(e.gain2k),this.gain4kParameter.set(e.gain4k),this.gain8kParameter.set(e.gain8k),this.gain16kParameter.set(e.gain16k),this.loadParameterFromJson(e,"gain31Parameter",this.gain31Parameter),this.loadParameterFromJson(e,"gain63Parameter",this.gain63Parameter),this.loadParameterFromJson(e,"gain125Parameter",this.gain125Parameter),this.loadParameterFromJson(e,"gain250Parameter",this.gain250Parameter),this.loadParameterFromJson(e,"gain500Parameter",this.gain500Parameter),this.loadParameterFromJson(e,"gain1kParameter",this.gain1kParameter),this.loadParameterFromJson(e,"gain2kParameter",this.gain2kParameter),this.loadParameterFromJson(e,"gain4kParameter",this.gain4kParameter),this.loadParameterFromJson(e,"gain8kParameter",this.gain8kParameter),this.loadParameterFromJson(e,"gain16kParameter",this.gain16kParameter),this.enable(e.enabled)}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),t}(un.Effect),Gn=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Gate",function(){return new q.a.Gain(2)},e))).connectedTrack=void 0,n.follower=new q.a.Follower(.012,.1),n.multiplier=new q.a.Gain(100),n.gate=new q.a.Gate(-30,.001,.2),n.smoothingParameter=new Wt("Smoothing",Object(p.a)(n),function(e,t){return n.gate.smoothing=t},{min:1e-5,max:2,unit:"ms",defaultValue:.012}),n.thresholdParameter=new Wt("Threshold",Object(p.a)(n),function(e,t){return n.gate.threshold=t},{min:-30,max:6,unit:"db",defaultValue:0}),n.registerParameter(n.smoothingParameter),n.registerParameter(n.thresholdParameter),n.effectNode.connect(n.gate),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"connect",value:function(e){this.gate.connect(e)}},{key:"disconnect",value:function(e){this.gate.disconnect(e)}},{key:"setSideChainedTrack",value:function(e,t){void 0!==this.connectedTrack&&this.connectedTrack.volumeNode.disconnect(this.multiplier),e.volumeNode.chain(this.multiplier,this.follower),this.follower.connect(this.effectNode.gain),this.connectedTrack=e,this.trackNumber=t}},{key:"getJson",value:function(){var e=Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this);return e.trackNumber=this.trackNumber,e.threshold=this.threshold,e.smoothing=this.smoothing,e=this.saveParameterToJson(e,"smoothingParameter",this.smoothingParameter),e=this.saveParameterToJson(e,"thresholdParameter",this.thresholdParameter)}},{key:"fromJson",value:function(e,n,a){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,a),e.enabled&&this.enable(!0),this.threshold=e.threshold,this.smoothing=e.smoothing,this.setSideChainedTrack(n[e.trackNumber],e.trackNumber),this.loadParameterFromJson(e,"thresholdParameter",this.thresholdParameter),this.loadParameterFromJson(e,"smoothingParameter",this.smoothingParameter)}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),this.sequencerEngine.tracks,!0),e}},{key:"smoothing",get:function(){return this.smoothingParameter.get()},set:function(e){return this.smoothingParameter.set(e)}},{key:"threshold",get:function(){return this.thresholdParameter.get()},set:function(e){return this.thresholdParameter.set(e)}}]),t}(un.Effect),zn="SAMPLER",_n="INSTRUMENT",Wn="INSTRUMENT_RACK",Kn=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,[{key:"getCopy",value:function(){var t=new e;return t.sequencerEngine=this.sequencerEngine,t.envelopesTrack=this.envelopesTrack,t.envelopeTrack=this.envelopeTrack,t.lfosTrack=this.lfosTrack,t.lfoTrack=this.lfoTrack,t.track=this.track,t.group=this.group,t.instrument=this.instrument,t.send=this.effect,t.midiEffect=this.midiEffect,t}},{key:"forSequencerEngine",value:function(e){return this.sequencerEngine=e,this}},{key:"forEnvelopeTrack",value:function(e,t){return this.envelopeTrack=e,this.envelopesTrack=t,this}},{key:"forLFOTrack",value:function(e,t){return this.lfoTrack=e,this.lfosTrack=t,this}},{key:"forTrack",value:function(e){return this.track=e,this}},{key:"forGroup",value:function(e){return this.group=e,this}},{key:"forSend",value:function(e){return this.send=e,this}},{key:"forEffect",value:function(e){return this.effect=e,this}},{key:"forMidiEffect",value:function(e){return this.midiEffect=e,this}},{key:"forInstrument",value:function(e){return this.instrument=e,this}},{key:"forSubDevice",value:function(e){return this.subDevice=e,this}},{key:"getEffectContext",value:function(){return void 0!==this.track?this.track:void 0!==this.group?this.group:void 0!==this.send?this.send:void 0}},{key:"getJson",value:function(){var e={},t=[];if(void 0!==this.track&&this.track.getTrackType()===_n&&(e=Object(X.a)({},e,{track:this.track.trackNumber,isInstrument:!0})),void 0!==this.track?(t=this.track.effects,e.track=this.track.trackNumber):void 0!==this.group?(t=this.group.effects,e.group=this.group.groupNumber):void 0!==this.send&&(t=this.send.effects,e.send=this.send.sendNumber),e.effect=t.indexOf(this.effect),this.midiEffect&&(e.midiEffect=this.track.midiEffects.effects.indexOf(this.midiEffect)),this.instrument){e.isInstrument=!0;var n=void 0;this.subDevice&&(n=this.track.instrument.getSubDeviceIndex(this.subDevice)),e.subDevice=n}return e}},{key:"subSequence",get:function(){return void 0!==this.envelopesTrack?this.envelopesTrack.subSequence:void 0!==this.lfosTrack?this.lfosTrack.subSequence:void 0!==this.track?this.track.subSequence:void 0}}]),e}();function Yn(e){return Math.pow(10,.05*e)}function Qn(e){return 20*Math.log(e)/Math.LN10}var Xn=65536,Zn=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Saturator",function(){return new q.a.Gain(1)},e))).waveShaperNode=new q.a.WaveShaper([-1,1]),n.effectNode.connect(n.waveShaperNode),n.postGain=new q.a.Gain(1),n.waveShaperNode.connect(n.postGain),n.params=n.getParams(-10,20,30,6),n.curve=new Float32Array(Xn),n.driveParameter=new Qt("Drive",n.effectNode.gain,function(e,t){n.effectNode.gain.value=t,n.postGain.gain.value=Math.pow(1/t,.6)},{min:0,max:4,unit:"",defaultValue:1,constantAutomationRate:!0}),n.registerParameter(n.driveParameter),n.waveShaperNode.curve=n.generateCurve(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"connect",value:function(e){this.postGain.connect(e)}},{key:"disconnect",value:function(e){this.postGain.disconnect(e)}},{key:"getParams",value:function(e,t,n,a){var r=Yn(e),s=(Yn(t),1/n),i=this.kAtSlope(1/n,e,t,r),o=e+t,c=Yn(o);return{linearThreshold:r,thresholdDb:e,kneeDb:t,ykneeThresholdDb:Qn(this.saturateBasic(c,i,r)),kneeThreshold:c,kneeThresholdDb:o,k:i,ratio:n,slope:s}}},{key:"slopeAt",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.params.linearThreshold;if(e<n)return 1;var a=1.001*e,r=Qn(e),s=Qn(a),i=Qn(this.saturateBasic(e,t,n));return(Qn(this.saturateBasic(a,t,n))-i)/(s-r)}},{key:"kAtSlope",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.params.thresholdDb,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.params.kneeDb,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.params.linearThreshold,r=Yn(t+n),s=.1,i=1e4,o=5,c=0;c<15;++c){this.slopeAt(r,o,a)<e?(i=o,o=Math.sqrt(s*i)):(s=o,o=Math.sqrt(s*i))}return o}},{key:"saturateBasic",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.params.linearThreshold;return e<n?e:n+(1-Math.exp(-t*(e-n)))/t}},{key:"saturate",value:function(e){var t;if(e<this.params.kneeThreshold)t=this.saturateBasic(e,this.params.k);else{var n=Qn(e);t=Yn(this.params.ykneeThresholdDb+this.params.slope*(n-this.params.kneeThresholdDb))}return t}},{key:"generateCurve",value:function(e){for(var t=Xn/2,n=0,a=0;a<t;++a)n=a/t,n=this.saturate(n),this.curve[t+a]=n,this.curve[t-a-1]=-n;return this.curve}},{key:"getJson",value:function(){var e=Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{drive:this.driveParameter.get()});return e=this.saveParameterToJson(e,"driveParameter",this.driveParameter)}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),this.driveParameter.set(e.drive),this.loadParameterFromJson(e,"driveParameter",this.driveParameter)}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),t}(un.Effect),$n=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Tape Delay",function(){return new q.a.Gain(1)},e))).initComponents(),n.rateParameter=new Xt("Rate",n.delayNode.delayTime,{defaultValue:.1,min:0,max:1},.001),n.registerParameter(n.rateParameter),n.feedbackParameter=new Xt("Feedback",n.feedbackNode.gain,{defaultValue:.1,min:0,max:1}),n.registerParameter(n.feedbackParameter),n.wetParameter=new Xt("Wet",n.crossFade.fade,{defaultValue:.5,min:0,max:1}),n.registerParameter(n.wetParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"initComponents",value:function(){this.inputNode=this.effectNode,this.crossFade=new q.a.CrossFade(.5),this.feedbackNode=new q.a.Gain(.1),this.saturatorNode=new Zn(this.sequencerEngine),this.saturatorNode.driveParameter.set(2.5),this.registerParameter(this.driveParameter),this.delayNode=new q.a.FeedbackDelay(.1,.1),this.eqNode=new vn(this.sequencerEngine,!1),this.eqNode.equalizerPoints[0].frequencyParameter.set(300),this.eqNode.equalizerPoints[4].qParameter.set(.7),this.eqNode.equalizerPoints[7].frequencyParameter.set(4e3),this.registerParameter(this.lowEQParameter),this.registerParameter(this.midEQParameter),this.registerParameter(this.highEQParameter),this.delayNode.wet.value=1,this.inputNode.connect(this.saturatorNode.effectNode),this.saturatorNode.connect(this.eqNode.effectNode),this.eqNode.connect(this.delayNode),this.inputNode.connect(this.crossFade,0,0),this.delayNode.connect(this.crossFade,0,1),this.delayNode.connect(this.feedbackNode),this.feedbackNode.connect(this.saturatorNode.effectNode),this.outputNode=new q.a.Gain(1),this.crossFade.connect(this.outputNode)}},{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}},{key:"getJson",value:function(){var e=Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{lowEQ:this.lowEQParameter.get(),midEQ:this.midEQParameter.get(),highEQ:this.highEQParameter.get(),feedback:this.feedbackParameter.get(),wet:this.wetParameter.get(),rate:this.rateParameter.get()});return e=this.saveParameterToJson(e,"lowEQParameter",this.lowEQParameter),e=this.saveParameterToJson(e,"midEQParameter",this.midEQParameter),e=this.saveParameterToJson(e,"highEQParameter",this.highEQParameter),e=this.saveParameterToJson(e,"feedbackParameter",this.feedbackParameter),e=this.saveParameterToJson(e,"rateParameter",this.rateParameter),e=this.saveParameterToJson(e,"wetParameter",this.wetParameter)}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),this.lowEQParameter.set(e.lowEQ),this.midEQParameter.set(e.midEQ),this.highEQParameter.set(e.highEQ),this.feedbackParameter.set(e.feedback),this.wetParameter.set(e.wet),this.rateParameter.set(e.rate),this.loadParameterFromJson(e,"lowEQParameter",this.lowEQParameter),this.loadParameterFromJson(e,"midEQParameter",this.midEQParameter),this.loadParameterFromJson(e,"highEQParameter",this.highEQParameter),this.loadParameterFromJson(e,"feedbackParameter",this.feedbackParameter),this.loadParameterFromJson(e,"rateParameter",this.rateParameter),this.loadParameterFromJson(e,"wetParameter",this.wetParameter)}},{key:"driveParameter",get:function(){return this.saturatorNode.driveParameter}},{key:"lowEQParameter",get:function(){return this.eqNode.equalizerPoints[0].gainParameter}},{key:"midEQParameter",get:function(){return this.eqNode.equalizerPoints[4].gainParameter}},{key:"highEQParameter",get:function(){return this.eqNode.equalizerPoints[7].gainParameter}}]),t}(un.Effect),ea=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Effect Rack",function(){return new q.a.Gain(1)},e))).inputNode=n.effectNode,n.inputNode.x=0,n.inputNode.y=200,n.outputNode=new q.a.Gain(1),n.outputNode.x=400,n.outputNode.y=200,n.effects=[],n.adjacencyLists={},n.lfos=[],n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"newLFO",value:function(){this.lfos.push(new jn(this.sequencerEngine,this.mixSession,void 0))}},{key:"onBPMUpdated",value:function(){for(var e in this.effects)this.effects[e].onBPMUpdated&&this.effects[e].onBPMUpdated()}},{key:"getSubDevices",value:function(){return this.effects.map(function(e){return{value:e,label:e.name}})}},{key:"getParameters",value:function(){var e=Object(ge.a)(this.parameters);for(var t in this.effects)e=[].concat(Object(ge.a)(e),Object(ge.a)(this.effects[t].getParameters()));for(var n in this.adjacencyList);return e}},{key:"getModAdjacencyLists",value:function(e){var t=this,n=this.modulators.filter(function(t){return t.getType()===e}),a={};for(var r in n){var s=n[r],i=Object.values(s.idToParameter).filter(function(e){return t.effects.some(function(t){return t.parameters.indexOf(e)>-1})});0!==i.length&&(void 0===a[s.number]&&(a[s.number]=[]),a[s.number]=i)}return a}},{key:"registerContext",value:function(e){Object(ze.a)(Object(l.a)(t.prototype),"registerContext",this).call(this,e),this.effects.forEach(function(t){return t.registerContext(e)})}},{key:"setSize",value:function(e,t,n,a){this.inputNode.x=0,this.inputNode.y=t/2-a/2,this.outputNode.x=e-n,this.outputNode.y=t/2-a/2}},{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(){this.outputNode.disconnect()}},{key:"addEffect",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.x=200,e.y=200,t&&e.enable(!0),t&&e.wetParameter&&e.wetParameter.set(1),e.registerContext(this.context||new Kn),this.effects.push(e),console.log(this.effects,this.adjacencyLists)}},{key:"dispose",value:function(){for(var e in this.effects.forEach(function(e){return e.dispose()}),this.adjacencyLists)this.adjacencyLists[e]&&this.adjacencyLists[e].forEach(function(e){return e.dispose()});this.adjacencyLists=void 0,Object(ze.a)(Object(l.a)(t.prototype),"dispose",this).call(this)}},{key:"deleteEffect",value:function(e){var t=this,n=this.adjacencyLists[e.id]||[];for(var a in n.forEach(function(e){return t.deleteEdge(e)}),this.adjacencyLists)(n=this.adjacencyLists[a].filter(function(t){return t.effect===e})).forEach(function(e){return t.deleteEdge(e)});for(var r in this.lfoAdjacencyLists)void 0!==this.lfoAdjacencyLists[r]&&(n=this.lfoAdjacencyLists[r].filter(function(t){return e.parameters.indexOf(t)>-1})).forEach(function(e){return t.deleteEdge(e)});for(var s in this.envelopeAdjacencyLists)void 0!==this.envelopeAdjacencyLists[s]&&(n=this.envelopeAdjacencyLists[s].filter(function(t){return e.parameters.indexOf(t)>-1})).forEach(function(e){return t.deleteEdge(e)});e.dispose(),this.effects.splice(this.effects.indexOf(e),1)}},{key:"deleteEdge",value:function(e){var t=this;if(e.modulator){var n=e.edge,a=e.modulator;a.getType()===Ht?n.disconnectFromLFO(a):n.disconnectFromEnvelope(a)}else{var r=function(n){var a=t.adjacencyLists[n],r=a.indexOf(e);r>-1&&(a.splice(r,1),-1===n?t.inputNode.disconnect(e.gain):t.effects.find(function(e){return e.id===n}).disconnect(e.gain))};for(var s in this.adjacencyLists)r(s)}}},{key:"getLFO",value:function(e){return this.modulators.filter(function(e){return e.getType()===Ht}).find(function(t){return t.number===e})}},{key:"getEnvelope",value:function(e){return this.modulators.filter(function(e){return e.getType()===Jt}).find(function(t){return t.number===e})}},{key:"connectEdge",value:function(e,t){var n=void 0;return n=e.effectNode?e.id:-1,e.connect(t.gain),void 0===this.adjacencyLists[n]&&(this.adjacencyLists[n]=[]),this.adjacencyLists[n].push(t),console.log(this.effects,this.adjacencyLists),t}},{key:"connectNodes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.effectNode,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.outputNode;if(e.getType)e.getType()===Ht&&t.connectToLFO?t.connectToLFO(e):t.connectToEnvelope&&t.connectToEnvelope(e);else if(!t.isAudioParamEnabled){var n=new ta(t,this.sequencerEngine);return this.connectEdge(e,n),n}}},{key:"getJson",value:function(){var e=this,n={},a=function(t){var a=e.adjacencyLists[t].map(function(t){return t.getJson(e)});if(-1===t)n[t]=a;else{var r=e.effects.find(function(e){return e.id===t});n[e.effects.indexOf(r)]=a}};for(var r in this.adjacencyLists)a(r);return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{adjacencyLists:n,effects:this.effects.map(function(e){return Object(X.a)({},e.getJson(),{x:e.x,y:e.y})})})}},{key:"fromJson",value:function(e,n,a,r){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,r);var s=e.effects;for(var i in s){var o=s[i],c=sa(o,n,this.sequencerEngine,a);this.addEffect(c,!1),c.x=o.x,c.y=o.y}var u=e.adjacencyLists;for(var p in u){var h=this.effects[p];for(var d in h||(h=this.inputNode),u[p]){var f=new ta(void 0,this.sequencerEngine);f.fromJson(u[p][d],this),this.connectEdge(h,f)}}}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine),n=this.context.track;return e.fromJson(this.getJson(),this.sequencerEngine.tracks,n.trackNumber,!0),e}},{key:"lfoAdjacencyLists",get:function(){return this.getModAdjacencyLists(Ht)}},{key:"envelopeAdjacencyLists",get:function(){return this.getModAdjacencyLists(Jt)}},{key:"modulators",get:function(){return[].concat(Object(ge.a)(this.sequencerEngine.lfos.map(function(e){return e.lfo})),Object(ge.a)(this.sequencerEngine.envelopes))}}]),t}(un.Effect),ta=function(){function e(t,n){Object(o.a)(this,e),this.gain=new q.a.Gain(1),t&&(t.effectNode?this.gain.connect(t.effectNode):this.gain.connect(t)),this.parameters=[],this.effect=t,this.sequencerEngine=n,this.store=n.store,this.gainParameter=new Xt("Gain",this.gain.gain,{min:0,max:1,unit:"db",defaultValue:.5}),this.registerParameter(this.gainParameter)}return Object(c.a)(e,[{key:"registerParameter",value:function(e){void 0!==e&&(e.name=e.name,e.effectName=this.name,e.setStore(this.store),this.parameters.push(e))}},{key:"getJson",value:function(e){var t={effect:e.effects.indexOf(this.effect),gain:this.gainParameter.get()};return t=ln(t,"gainParameter",this.gainParameter)}},{key:"fromJson",value:function(e,t){this.gainParameter.set(e.gain),pn(e,"gainParameter",this.gainParameter),this.effect=t.effects[e.effect],this.effect||(this.effect=t.outputNode),this.effect.effectNode?this.gain.connect(this.effect.effectNode):this.gain.connect(this.effect)}},{key:"dispose",value:function(){this.gainParameter.dispose(),this.gainParameter=void 0}}]),e}(),na=ea,aa=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Stereo Delay",function(){return new q.a.Gain(1)},e))).initComponents(),n.isSynced=!0,n.wetParameter=new Wt("Wet",Object(p.a)(n),function(e,t){n.leftDelay.wetParameter.set(t),n.rightDelay.wetParameter.set(t)},{min:0,max:1,unit:"",defaultValue:0,constantAutomationRate:!0}),n.registerParameter(n.wetParameter),n.feedbackParameter=new Wt("Feedback",Object(p.a)(n),function(e,t){n.leftDelay.feedbackParameter.set(t),n.rightDelay.feedbackParameter.set(t)},{min:0,max:1,unit:"",defaultValue:0,constantAutomationRate:!0}),n.registerParameter(n.feedbackParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(e){this.outputNode.disconnect(e)}},{key:"initComponents",value:function(){this.leftDelay=new En(this.sequencerEngine),this.rightDelay=new En(this.sequencerEngine),this.effectNode.connect(this.leftDelay.effectNode),this.effectNode.connect(this.rightDelay.effectNode),this.merger=new q.a.Merge,this.leftDelay.connect(this.merger.left),this.rightDelay.connect(this.merger.right),this.outputNode=new q.a.Gain(1),this.merger.connect(this.outputNode)}},{key:"getJson",value:function(){var e=Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{leftDelay:this.leftDelay.getJson(),rightDelay:this.rightDelay.getJson(),wet:this.wetParameter.get(),feedback:this.feedbackParameter.get(),isSynced:this.isSynced});return e=this.saveParameterToJson(e,"wetParameter",this.wetParameter),e=this.saveParameterToJson(e,"feedbackParameter",this.feedbackParameter)}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),this.isSynced=e.isSynced,this.wetParameter.set(e.wet),this.feedbackParameter.set(e.feedback),this.leftDelay.fromJson(e.leftDelay),this.rightDelay.fromJson(e.rightDelay),this.loadParameterFromJson(e,"feedbackParameter",this.feedbackParameter),this.loadParameterFromJson(e,"wetParameter",this.wetParameter)}},{key:"getEffectCopy",value:function(){var e=new t(this.sequencerEngine);return e.fromJson(this.getJson(),!0),e}}]),t}(un.Effect),ra={Filter:function(e){return new un.FilterEffect(e)},Delay:function(e){return new En(e)},Reverb:function(e){return new un.ReverbEffect(e)},"Convolver Reverb":function(e){return new kn(e)},Tremolo:function(e){return new un.TremoloEffect(e)},Chorus:function(e){return new un.ChorusEffect(e)},Gate:function(e){return new Gn(e)},"Auto Filter":function(e){return new un.AutoFilterEffect(e)},"Multiband Compressor":function(e){return new An(e)},Distortion:function(e){return new Fn(e)},Compressor:function(e){return new Ln(e)},"Bit Crusher":function(e){return new In(e)},"EQ 3":function(e){return new Un(e)},"EQ 10":function(e){return new Jn(e)},"Auto Wah":function(e){return new xn(e)},Phaser:function(e){return new Sn(e)},"Ultra Phaser":function(e){return new Sn(e)},"Pitch Shift":function(e){return new Vn(e)},Panner:function(e){return new Bn(e)},EQ8:function(e){return new vn(e)},Chebyshev:function(e){return new Rn(e)},"Stereo Widener":function(e){return new Nn(e)},"Tape Delay":function(e){return new $n(e)},Saturator:function(e){return new Zn(e)},"Stereo Delay":function(e){return new aa(e)},Oscilloscope:function(e){return new qn(e)},"Effect Rack":function(e){return new na(e)},Pan:function(e){return new un.PanEffect(e)}};function sa(e,t,n,a){var r=e.name,s=(e.enabled,e.value,ra[r](n));if(void 0!==a){var i=(new Kn).forTrack(t[a]);s.registerContext(i)}return s.fromJson(e,t,a),s}var ia=function(){function e(t,n,a,r){Object(o.a)(this,e),this.inputNode=t,this.effectsInputNode=new q.a.Gain,this.inputNode.connect(this.effectsInputNode),this.outputNode=n,this.mixSession=r.mixSession,this.parameterContext=a,this.sequencerEngine=r,this.effects=[],this.samplerConnectedToMaster=!1}return Object(c.a)(e,[{key:"initDefault",value:function(){this.effects=(this.sequencerEngine,[]),this.updateEffects()}},{key:"setupEffects",value:function(){this.connectEffects(this.effectsInputNode,this.effects)}},{key:"updateEffects",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.effects;this.effects=t,this.effects.map(function(t){return t.track=e}),this.connectEffects(this.effectsInputNode,t)}},{key:"disconnectAll",value:function(){this.effects.map(function(e){return e.disconnect()})}},{key:"connectEffects",value:function(e,t){e.disconnect(),this.effects.map(function(e){return e.disconnect()});for(var n=e,a=0;a<t.length;a++){var r=t[a].getEffect();t[a].isEnabled()&&(n.connect(r),n=t[a])}n.connect(this.outputNode),this.linkEffectParameters()}},{key:"linkEffectParameters",value:function(){var e=this;this.effects.forEach(function(t){t.registerContext(e.parameterContext),t.registerMixSession(e.mixSession)})}},{key:"dispose",value:function(){this.effectsInputNode.disconnect(),this.effectsInputNode.dispose(),this.effects.forEach(function(e){return e.disconnect()}),this.effects.forEach(function(e){return e.dispose()}),this.effects=void 0}},{key:"clear",value:function(){this.effects.forEach(function(e){return e.disconnect()}),this.effects.forEach(function(e){return e.dispose()}),this.effects=[]}},{key:"start",value:function(){this.effects.filter(function(e){return e.syncable()}).forEach(function(e){return e.start()}),this.effects.forEach(function(e){return e.parameters.filter(function(e){return e.isConnectedToAnyModulator()}).forEach(function(e){return e.refresh()})})}},{key:"getAllParameters",value:function(){var e=[];return this.effects.forEach(function(t){return t.getParameters().forEach(function(t){return e.push(t)})}),e}},{key:"getAllPatternLockedParameters",value:function(){return this.getAllParameters().filter(function(e){return e.hasPatternLockedValues()})}},{key:"moveEffectTo",value:function(e,t){if(e!=t){this.effectsInputNode.disconnect(this.effects[0]),this.effects.forEach(function(e){return e.disconnect()});var n=[];e>t?(n=this.effects.slice(0,t).concat([this.effects[e]]).concat(this.effects.slice(t,e)),this.effects.length>e+1&&(n=n.concat(this.effects.slice(e+1)))):(n=this.effects.slice(0,e).concat(this.effects.slice(e+1,t)).concat([this.effects[t],this.effects[e]]),this.effects.length>t+1&&(n=n.concat(this.effects.slice(t+1)))),this.updateEffects(n)}}},{key:"onBPMUpdated",value:function(){for(var e in this.effects)this.effects[e].onBPMUpdated&&this.effects[e].onBPMUpdated()}},{key:"getEffectNumber",value:function(e){var t=e.id;return this.effects.map(function(e){return e.id}).indexOf(t)}},{key:"getEffectById",value:function(e){return this.effects.find(function(t){return t.id===e})}},{key:"addEffect",value:function(e){this.effects=[].concat(Object(ge.a)(this.effects),[e]),this.updateEffects()}},{key:"deleteEffect",value:function(e){var t=this.getEffectNumber(e);t<0||(e.disconnect(),t>0&&this.effects[t-1].disconnect(),this.effects.splice(t,1),this.effects=Object(ge.a)(this.effects),this.updateEffects(this.effects))}},{key:"getCopy",value:function(t){var n=new e(t.gainNode,t.trackNode,(new Kn).forTrack(t),this.sequencerEngine);return n.effects=this.effects.map(function(e){return e.getEffectCopy()}),n}},{key:"getJson",value:function(){return this.effects.map(function(e){return e.getJson()})}},{key:"mate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=Math.max(e.effects.length,this.effects.length),a=[];e.disconnectAll();for(var r=[],s=0;s<n;s++){var i=this.effects[s],o=e.effects[s];wn(t)?(o&&a.push(o.getEffectCopy(this.track)),i&&r.push(i)):i&&a.push(i)}this.updateEffects(a),r.forEach(function(e){return e.dispose()}),e.effectsInputNode.disconnect(),e.effectsInputNode.dispose()}},{key:"fromJson",value:function(e,t,n){for(var a in e){var r=e[a];this.addEffect(sa(r,t,this.sequencerEngine,n))}}}]),e}();q.a.Master.context.createChannelMerger(32).connect(q.a.Master);var oa=function(){function e(t,n,a,r){Object(o.a)(this,e),this.groups=[],this.subSequence=r,this.channelMixer=t,this.sends=n,this.sequencerEngine=a,this.doneLoading=!1}return Object(c.a)(e,[{key:"newGroup",value:function(e){var t=new ca([],this.channelMixer,this.groups.length,this.sequencerEngine,this.subSequence);this.groups.push(t),t.connectAudio(this.getMaxChannel()),this.addToGroup(e,t)}},{key:"fromJson",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a=this;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("groups.fromJson("),console.log("with currentSubSequence.id = "+n.currentSubSequence.id),e.abrupt("return",new Promise(function(){var e=Object(g.a)(v.a.mark(function e(r,s){var i,o,c,u,l,p;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=4;break}return a.sequencerEngine.tracks.forEach(function(e){return a.addTrack(e)}),r(),e.abrupt("return");case 4:i=0;case 5:if(!(i<t.length)){e.next=15;break}return o=t[i],e.next=9,new ca([],a.channelMixer,a.groups.length,a.sequencerEngine,a.subSequence).fromJson(o,n);case 9:(c=e.sent).tracks.length>0&&(c.connectAudio(a.getMaxChannel()),a.groups.push(c)),o.outputs&&(u=Object(Z.a)(o.outputs,2),l=u[0],p=u[1],a.channelMixer.switchChannelOutput(c.outputNode,l,p)&&(c.outputs=[l,p]));case 12:i++,e.next=5;break;case 15:r();case 16:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateGroups",value:function(){this.groups.forEach(function(e){return e.setVolume(e.volume)}),this.groups.forEach(function(e){return e.setPanning(e.panning)})}},{key:"addToGroup",value:function(e,t){var n=e.group,a=1==n.tracks.length,r=this.groups.indexOf(n);e.disconnectFromGroup(),t.addTrack(e),t.tags=Array.from(new Set(t.tags.concat(n.tags))),a?(this.groups.splice(r,1),n.dispose()):(r=n.tracks.indexOf(e),n.tracks.splice(r,1))}},{key:"deleteTrack",value:function(e){var t=e.group;if(void 0!==t&&null!==t){var n=1==t.tracks.length,a=this.groups.indexOf(t);e.disconnectFromGroup(),n?(this.groups.splice(a,1),t.dispose()):(a=t.tracks.indexOf(e),t.tracks.splice(a,1))}}},{key:"addTrack",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.getTrackType(),e.next=e.t0===zn?3:10;break;case 3:if(void 0!==(n=t.sample.tags)){e.next=8;break}return e.next=7,t.sample.fetchTags();case 7:n=e.sent;case 8:return this.resolveTrackTags(t,n),e.abrupt("break",11);case 10:this.resolveTrackTags(t,[t.getTrackType()]);case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addMidiTrack",value:function(e){this.resolveTrackTags(e,["Midi Tracks"])}},{key:"resolveTrackTags",value:function(e,t){var n=0,a=null;for(var r in this.groups){var s=this.groups[r],i=ua(s.tags,t);i.length>n&&(a=s,n=i.length)}if(null==a){var o=new ca(t,this.channelMixer,this.groups.length,this.sequencerEngine,this.subSequence);return o.connectAudio(this.getMaxChannel()),o.addTrack(e),void this.groups.push(o)}a.tags=ua(a.tags,t),a.addTrack(e)}},{key:"dispose",value:function(){this.groups.forEach(function(e){return e.dispose()}),this.groups=[]}},{key:"getJson",value:function(e){return this.groups.map(function(t){return t.getJson(e)})}},{key:"getMaxChannel",value:function(){var e=[];this.groups.map(function(e){return e.outputs}).filter(function(e){return void 0!==e}).forEach(function(t){return e=e.concat(t)}),this.sends.sends.map(function(e){return e.outputs}).filter(function(e){return void 0!==e}).forEach(function(t){return e=e.concat(t)});var t=e.sort(function(e,t){return e-t}).reverse();if(0===t.length)return-1;for(var n=t[0],a=0;a<n;a+=2)if(-1==t.indexOf(a)&&-1==t.indexOf(a+1))return a-1;return n}}]),e}(),ca=function(){function e(t,n,a,r,s){Object(o.a)(this,e),this.tracks=[],this.subSequence=s,this.sequencerEngine=r,this.groupNumber=a,this.tags=t,this.inputNode=new q.a.Volume,this.outputNode=new q.a.PanVol,this.groupMeter=new q.a.Meter,this.muteableNode=new q.a.Volume,this.outputNode.connect(this.groupMeter),this.muteableNode.connect(this.outputNode),this.effectsChain=new ia(this.inputNode,this.muteableNode,(new Kn).forGroup(this),r),this.effectsChain.setupEffects(),this.setVolume(70),this.channelMixer=n,this.outputs=void 0,this.muted=!1,this.panning=0}return Object(c.a)(e,[{key:"getEffectNumber",value:function(e,t){return this.effects.indexOf(e)}},{key:"dispose",value:function(){this.outputs=this.channelMixer.disconnect(this.outputNode,this.outputs),this.inputNode.dispose(),this.muteableNode.dispose(),this.outputNode.dispose(),this.groupMeter.dispose(),this.inputNode=void 0,this.outputNode=void 0,this.groupMeter=void 0,this.effectsChain.dispose()}},{key:"mute",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.sequencerEngine.store.getState().mix.isRecordingMix&&this.mix.addEvent(new vt(this.groupNumber,e)),this.muted=e,this.muteableNode.volume.value=e?-125:0,this.sequencerEngine.store.dispatch(Object(w.zb)(this.groupNumber,e))}},{key:"moveEffectTo",value:function(e,t){this.effectsChain.moveEffectTo(e,t)}},{key:"deleteEffect",value:function(e){this.effectsChain.deleteEffect(e)}},{key:"connectAudio",value:function(e){this.outputs=this.channelMixer.connect(this.outputNode)}},{key:"fromJson",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a,r,s,i,o,c,u,l;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t.newVolume?this.setVolume(t.volume):(a=128*(t.volume+40)/43,this.setVolume(a)),r=[],s=0;s<t.tracks.length;s++)void 0!==(i=n.tracks[t.tracks[s]])&&(i.getTrackType()===zn&&r.push(i.sample.fetchTags()),this.addTrack(i));for(o=0;o<t.effects.length;o++)this.effectsChain.addEffect(sa(t.effects[o],n.tracks,n));return e.next=6,Promise.all(r);case 6:for(c=e.sent,u=new Set,l=0;l<c.length;l++)c[l].forEach(function(e){return u.add(e)});return this.tags=Array.from(u),e.abrupt("return",this);case 11:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSendNodes",value:function(){return[]}},{key:"addTrack",value:function(e){this.hasTrack(e)||(this.tracks.push(e),e.addToGroup(this))}},{key:"hasTrack",value:function(e){return this.tracks.indexOf(e)>-1}},{key:"setVolume",value:function(e){this.sequencerEngine.store.getState().mix.isRecordingMix&&this.mix.addEvent(new ft(this.groupNumber,e)),this.volume=e,this.outputNode.volume.value=le(e,0,128),this.sequencerEngine.store.dispatch(Object(w.Bb)(this.groupNumber,e))}},{key:"setPanning",value:function(e){this.panning=e,this.outputNode.pan.value=e,this.sequencerEngine.store.dispatch(Object(w.Ab)(this.groupNumber,e))}},{key:"updateEffects",value:function(e){this.effectsChain.updateEffects()}},{key:"getJson",value:function(e){return{newVolume:!0,tracks:this.tracks.map(function(e){return e.trackNumber}),effects:this.effectsChain.getJson(),volume:this.volume,outputs:this.outputs}}},{key:"mix",get:function(){return this.subSequence.mix}},{key:"solo",set:function(e){this.tracks.forEach(function(t){return t.solo(e)})},get:function(){var e=!1;for(var t in this.tracks)e=e||this.tracks[t].getSolo();return e}},{key:"effects",get:function(){return this.effectsChain.effects}}]),e}();function ua(e,t){return e.filter(function(e){return-1!==t.indexOf(e)})}var la=oa,pa=function(e){function t(e,n,a,r){var s;return Object(o.a)(this,t),(s=Object(u.a)(this,Object(l.a)(t).call(this,e,n,a,r))).lastValue=void 0,s.lastStep=void 0,s.envelope=new q.a.ScaledEnvelope,s.meter=new q.a.Analyser("waveform",32),s.envelope.connect(s.meter),s.envelope.min=0,s.envelope.max=1,s.parameters=[],s.setupParameters(),s.savedFrequency=void 0,s.parameterIdToVoiceToNode={},s}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getType",value:function(){return Jt}},{key:"dispose",value:function(){for(var e in this.envelope.dispose(),this.meter.dispose(),this.parameters.forEach(function(e){return e.dispose()}),this.parameterIdToVoiceToNode){var t=this.parameterIdToVoiceToNode[e];for(var n in t){t[n].filter(function(e){return e.dispose&&e._param}).forEach(function(e){return e.dispose()})}}this.parameterIdToVoiceToNode=void 0,this.envelope=void 0,this.meter=void 0,this.parameters=void 0}},{key:"getValue",value:function(e){if(e===this.lastStep)return this.lastValue;var t=this.meter.getValue()[0];return this.lastStep=e,this.lastValue=t,t}},{key:"getChain",value:function(e,t){return[new q.a.Scale(e.min,e.max),t]}},{key:"getModulator",value:function(){return this.envelope}},{key:"triggerAttack",value:function(e,t){this.envelope.cancel(e),this.envelope.triggerAttack(e,t)}},{key:"triggerAttackRelease",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;t=Math.max(t,0),this.envelope.cancel(t),this.envelope.triggerAttackRelease(e,t,n)}},{key:"triggerRelease",value:function(e){this.envelope.triggerRelease(e)}},{key:"setupParameters",value:function(){this.attackParameter=new Wt("Attack",this.envelope,function(e,t){return e.attack=(t+1e-6)/1e3},{min:0,max:1e4,unit:"ms",defaultValue:1e3}),this.registerParameter(this.attackParameter),this.decayParameter=new Wt("Decay",this.envelope,function(e,t){return e.decay=(t+1e-5)/1e3},{min:0,max:1e4,unit:"ms",defaultValue:1e3}),this.registerParameter(this.decayParameter),this.sustainParameter=new Wt("Sustain",this.envelope,function(e,t){return e.sustain=t},{min:0,max:1,unit:"",defaultValue:.5}),this.registerParameter(this.sustainParameter),this.releaseParameter=new Wt("Release",this.envelope,function(e,t){return e.release=(t+1e-6)/1e3},{min:0,max:1e4,unit:"ms",defaultValue:1e3}),this.registerParameter(this.releaseParameter),this.attackCurveParameter=new Wt("Attack Curve",this.envelope,function(e,t){e.attackCurve=t},{min:0,max:1e4,unit:"",defaultValue:"linear"}),this.registerParameter(this.attackCurveParameter),this.decayCurveParameter=new Wt("Decay Curve",this.envelope,function(e,t){return e.decayCurve=t},{min:0,max:1e4,unit:"",defaultValue:"linear"}),this.registerParameter(this.decayCurveParameter),this.releaseCurveParameter=new Wt("Release Curve",this.envelope,function(e,t){return e.releaseCurve=t},{min:0,max:1e4,unit:"",defaultValue:"exponential"}),this.registerParameter(this.releaseCurveParameter)}},{key:"refresh",value:function(){this.attack=this.attack,this.decay=this.decay,this.release=this.release,this.sustain=this.sustain}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getJson",value:function(){var e={attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release,attackCurve:this.attackCurve,decayCurve:this.decayCurve,releaseCurve:this.releaseCurve};return e=ln(e,"attackParameter",this.attackParameter),e=ln(e,"decayParameter",this.decayParameter),e=ln(e,"sustainParameter",this.sustainParameter),e=ln(e,"releaseParameter",this.releaseParameter),e=ln(e,"attackCurveParameter",this.attackCurveParameter),e=ln(e,"decayCurveParameter",this.decayCurveParameter),e=ln(e,"releaseCurveParameter",this.releaseCurveParameter)}},{key:"fromJson",value:function(e){this.disconnectAllModulators(),this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,e.attackCurve&&(this.attackCurve=e.attackCurve),e.decayCurve&&(this.decayCurve=e.decayCurve),e.releaseCurve&&(this.releaseCurve=e.releaseCurve),pn(e,"attackParameter",this.attackParameter,this.sequencerEngine),pn(e,"decayParameter",this.decayParameter,this.sequencerEngine),pn(e,"sustainParameter",this.sustainParameter,this.sequencerEngine),pn(e,"releaseParameter",this.releaseParameter,this.sequencerEngine),pn(e,"attackCurveParameter",this.attackCurveParameter,this.sequencerEngine),pn(e,"decayCurveParameter",this.decayCurveParameter,this.sequencerEngine),pn(e,"releaseCurveParameter",this.releaseCurveParameter,this.sequencerEngine)}},{key:"refresh",value:function(){}},{key:"getScaleFromChain",value:function(e){return e[0]}},{key:"mate",value:function(e,t){this.mateParameter(this.attackParameter,e.attackParameter,t),this.mateParameter(this.decayParameter,e.decayParameter,t),this.mateParameter(this.sustainParameter,e.sustainParameter,t),this.mateParameter(this.releaseParameter,e.releaseParameter,t)}},{key:"mateParameter",value:function(e,t,n){Cn(this.sequencerEngine,e,t,n)}},{key:"attack",get:function(){return this.attackParameter.get()},set:function(e){this.attackParameter.set(e)}},{key:"decay",get:function(){return this.decayParameter.get()},set:function(e){this.decayParameter.set(e)}},{key:"sustain",get:function(){return this.sustainParameter.get()},set:function(e){this.sustainParameter.set(e)}},{key:"release",get:function(){return this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e)}},{key:"attackCurve",get:function(){return this.attackCurveParameter.get()},set:function(e){this.attackCurveParameter.set(e)}},{key:"decayCurve",get:function(){return this.decayCurveParameter.get()},set:function(e){this.decayCurveParameter.set(e)}},{key:"releaseCurve",get:function(){return this.releaseCurveParameter.get()},set:function(e){this.releaseCurveParameter.set(e)}}]),t}(Tn),ha=function(){function e(t,n,a,r){Object(o.a)(this,e),this.store=t.store,this.sequencerEngine=t,this.number=r,this.envelope=new pa(t,n,(new Kn).forEnvelopeTrack(this,a),r)}return Object(c.a)(e,[{key:"getJson",value:function(){return this.envelope.getJson()}},{key:"name",get:function(){return"Envelope "+this.number}}]),e}();var da=function(){function e(t,n){Object(o.a)(this,e),this.sequencerEngine=t,this.subSequence=n,this.store=t.store,this.envelopes=function(e,t){var n=[];return n.push(new ha(e,e.mixSession,t,1)),n.push(new ha(e,e.mixSession,t,2)),n.push(new ha(e,e.mixSession,t,3)),n.push(new ha(e,e.mixSession,t,4)),n}(t,this),this.currentPattern=0}return Object(c.a)(e,[{key:"switchToPattern",value:function(e){this.currentPattern=e,this.updateRedux()}},{key:"updateRedux",value:function(){this.getAllPatternLockedParameters().forEach(function(e){return e.updateRedux()})}},{key:"deletePattern",value:function(e){this.store.dispatch(Object(w.rb)(this.subSequence.id,_t(e,this.patternLocks)))}},{key:"movePatternTo",value:function(e,t){this.store.dispatch(Object(w.rb)(this.subSequence.id,zt(e,t,this.patternLocks)))}},{key:"getAllPatternLockedParameters",value:function(){var e=[];return this.envelopes.forEach(function(t){return t.envelope.parameters.filter(function(e){return e.hasPatternLockedValues()}).forEach(function(t){return e.push(t)})}),e}},{key:"newPattern",value:function(e){var t=this,n=e-1;this.getAllPatternLockedParameters().forEach(function(e){return e.newPattern(t.currentPattern,n)});var a=this.patternLocks;a[n]=this.patternLocked,this.store.dispatch(Object(w.rb)(this.subSequence.id,a))}},{key:"togglePatternLocked",value:function(){this.patternLocked=!this.patternLocked}},{key:"patternLocks",get:function(){var e=this.store.getState().tracks.envelopePatternLocks[this.subSequence.id]||{};return Object(X.a)({},e)}},{key:"patternLocked",get:function(){return this.patternLocks[this.currentPattern]||!1},set:function(e){var t=this.patternLocks;t[this.currentPattern]=e,this.store.dispatch(Object(w.rb)(this.subSequence.id,t)),this.updateRedux()}}]),e}(),fa=new ht(32,!1),ma=new ht(32,!0),va=function(){function e(t,n){Object(o.a)(this,e),this.pattern=t,this.trackData=n}return Object(c.a)(e,[{key:"getStep",value:function(e,t,n){var a=this;return this.pattern.getStepAtResolution(e,t,function(e){return null===e.transpose&&n===a.trackData.transpose||e.transpose===n})}},{key:"getStepsAtStepNumber",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fa;return this.pattern.getPolyphonicStepsAtResolution(e,t)}},{key:"getStepWithTranspose",value:function(e,t,n){var a=this,r=function(e){return null===e.transpose&&n===a.trackData.transpose||Math.round(e.transpose)===n},s=(this.pattern.getStepAtResolution(e,t,r,void 0,!0),this.pattern.getAllOnStepAtResolutionAtAnyPosition(e,t).filter(function(e){return e.on&&r(e)}));if(s.length>0)return s[0]}},{key:"deleteStepsAtStepNumber",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t.isTriplet?(e=ma.transformStepAtResolution2(e,t),this.pattern.tripletStepBuckets[e]=new ct(this.pattern.track,!0)):(e=fa.transformStepAtResolution2(e,t),this.pattern.stepBuckets[e]=new ct(this.pattern.track)),n&&this.update(t.isTriplet)}},{key:"deleteStepAtStepNumber",value:function(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];t=this.getStepNumber(t,n);var r=n.isTriplet?this.pattern.tripletStepBucketsMatrix[t]:this.pattern.stepBucketsMatrix[t];if(void 0!==r){for(var s in r.steps){var i=r.steps[s].deleteStep(e);if(void 0!==i){r.steps[s]=i;break}}r.anyOn()||r.clear(),a&&this.update(n.isTriplet)}}},{key:"deleteStep",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.pattern.stepBucketsMatrix;for(var a in n){var r=n[a];for(var s in r.steps){var i=r.steps[s].deleteStep(e);if(void 0!==i){r.steps[s]=i;break}}r.anyOn()||r.clear()}t&&this.update()}},{key:"addStep",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];e.track=this.pattern.track;var i=fa.transformStepAtResolution2(t,n);t>=this.pattern.length(n)&&this.pattern.changeLength(i+2*e.duration,!1);var o=this.pattern.getStepAtResolution(i,fa,function(){return!0},a);if(void 0===o||s||(e=o.addStep(e)),this.pattern.setStepAtResolution(e,t,n,a),r)if(n.isTriplet)this.update(n.isTriplet);else{var c=fa.transformStepAtResolution2(t,n);this.pattern.stepBucketsMatrix[c]=this.pattern.stepBuckets[c],this.pattern.needsSync=!0}return e}},{key:"getSelectedSteps",value:function(e,t){for(var n=[],a=e.fromStep;a<=e.toStep;a++){var r=this.pattern.getAllOnStepAtResolutionAtAnyPosition(a,t);n=n.concat(r)}return n}},{key:"getSelectedPianoRollSteps",value:function(e,t){for(var n=this,a=[],r=e.stepNumber;r<e.stepNumber+e.numSteps;r++){var s=this.pattern.getAllOnStepAtResolutionAtAnyPosition(r,t).filter(function(t){return n.isStepSelected(t,e)});a=a.concat(s)}return a}},{key:"getStepNumber",value:function(e,t){return t.isTriplet?ma.transformStepAtResolution2(e,t):fa.transformStepAtResolution2(e,t)}},{key:"isStepSelected",value:function(e,t){var n=null===e.transpose?this.trackData.transpose:e.transpose;return n<=t.transpose&&n>t.transpose-t.numNotes}},{key:"getStepNumbers",value:function(e,t){var n=[];for(var a in e){var r=e[a],s=this.findStepNumber(r,t);n.push([r,s])}return n}},{key:"transformSteps",value:function(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];new Date;if(0===n.stepDifference&&0===n.transposeDifference)return e;var i=t.some(function(e){return 0===e[1]&&0===e[0].position});if(r&&i&&n.stepDifference<0)return e;for(var o in t){var c=t[o][0],u=t[o][1];isNaN(u),this.deleteStepAtStepNumber(c,u,a,!1)}var l=[],p={};for(var h in t){var d=t[h][0],f=t[h][1],m=f,v=null===d.transpose?this.trackData.transpose:d.transpose;if(isNaN(n.stepDifference)&&(n.stepDifference=0),d.transpose=v+n.transposeDifference,f+=d.position+n.stepDifference,!isNaN(f)){f<0?r?(f=0,d.position=0):f=this.pattern.length(a)+f:r&&(f%=this.pattern.length(a));var g=Math.floor(f),b=f-g;d.position=b,m!==g&&(p[m]=g),this.addStep(d,g,a,b,!1),l.push(d)}}new Date;return s&&(this.pattern.clearCache(),this.pattern.syncMatrixBySteps(p,a)),l}},{key:"findStepNumber",value:function(e,t){var n=this.pattern.stepBucketsMatrix;for(var a in n){var r=n[a];if(void 0!==r)for(var s in r.steps){if(r.steps[s].hasStep(e))return t.transformStepAtResolution2(a,t.isTriplet?ma:fa)}}}},{key:"findStepNumberAndDelete",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.pattern.stepBucketsMatrix;for(var r in a){var s=a[r];for(var i in s.steps){var o=s.steps[i].deleteStep(e);if(void 0!==o)return s.steps[i]=o,n&&this.update(t.isTriplet),t.transformStepAtResolution2(r,t.isTriplet?ma:fa)}}}},{key:"deleteSteps",value:function(e){var t=this;e.forEach(function(e){return t.deleteStep(e,!1)}),this.update()}},{key:"getAllSteps",value:function(){var e=[],t=this.pattern.stepBuckets;for(var n in t){var a=t[n];for(var r in a.steps){var s=a.steps[r];e=e.concat(s.getPolyphony().filter(function(e){return e.on}))}}return e}},{key:"pasteSteps",value:function(e,t,n,a){if(void 0!==e&&void 0!==t){var r=n.getStepNumbers(e,a),s=6e4;for(var i in r){var o=r[i][1];o<s&&(s=o)}for(var c in r)r[c][1]-=s;var u=t.stepNumber,l=[];for(var p in r){var h=r[p][0].getCopy(!0,!1,!1,!0,!1,!1),d=u+r[p][1];l.push(this.addStep(h,d,a,h.position,!1))}return this.update(a.isTriplet),l}}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.pattern.calculateFills(this.trackData),this.pattern.clearCache(),this.pattern.syncBuckets(e)}}]),e}(),ga=function(){function e(t){Object(o.a)(this,e),this.type=t,this.events=[],this.counter=0}return Object(c.a)(e,[{key:"getMixType",value:function(){return"BASIC"}},{key:"seekToTrackStep",value:function(e){this.events.length>0&&this.events[this.events.length-1].step<e||this.restart()}},{key:"restart",value:function(){this.counter=0,this.events.forEach(function(e){return e.restart()})}},{key:"scheduleNext",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n,a){var r,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:0==t&&this.restart(),r=this.counter,s=this.events;case 3:if(!(r<s.length)){e.next=19;break}if(t!==s[r].step){e.next=8;break}s[r].scheduleEvent(n,a,s[r+1]),e.next=16;break;case 8:if(!(t>s[r].step)||s[r].isSkippable()){e.next=12;break}s[r].scheduleEvent(0-s[r].time,a,s[r+1]),e.next=16;break;case 12:if(!(t<s[r].step)){e.next=16;break}return e.abrupt("break",19);case 16:r++,e.next=3;break;case 19:this.counter=r;case 20:case"end":return e.stop()}},e,this)}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"eraseEventsAtStep",value:function(e){this.events=this.events.filter(function(t){return t.step!=e})}},{key:"schedule",value:function(){this.events.forEach(function(e){return e.scheduleEvent()})}},{key:"getJson",value:function(){return{type:this.type,events:this.events.map(function(e){return e.getJson()}).filter(function(e){return void 0!==e})}}},{key:"getCopy",value:function(){var t=new e(this.type);return t.events=this.events,t}},{key:"loadFromJson",value:function(e,t,n){for(var a in e.events){var r=Et(e.events[a],this.type,t,n);void 0!==r&&(this.events.length>0&&r.step<this.events[this.events.length-1].step&&e.length-a>=500&&(this.events=[]),this.events.push(r))}}},{key:"calculateDurations",value:function(){var e=void 0,t=[];for(var n in this.events){var a=this.events[n];void 0===a||a.isEmpty()||(void 0===e||e.rolling||a.rolling)&&(t.push(a),void 0!==e&&(e.duration=this.events[n].step-e.step),e=this.events[n])}this.events=t}},{key:"clear",value:function(){this.events=[],this.counter=0}},{key:"getNextEvent",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.counter:0;t<this.events.length;t++)if(e.step<this.events[t].step)return this.events[t]}},{key:"getPreviousEvent",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=void 0,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?Math.max(0,this.counter-1):0;a<this.events.length;a++){if(t&&e.step<=this.events[a].step)return n;if(!t&&e.step<this.events[a].step)return n;n=this.events[a]}return n}},{key:"updateRedux",value:function(e,t){t.store.dispatch(Object(w.Yb)(e.id,this.type,Object(ge.a)(this.events)))}},{key:"prune",value:function(){this.events.every(function(e){return e.isPrunable()})&&(this.events=[]);var e=void 0,t=[];for(var n in this.events){var a=this.events[n];void 0!==e&&a.isPrunable()&&e.isPrunable()||(void 0===e&&a.isPrunable()||(t.push(a),e=a))}this.events=t}},{key:"getEventsBetween",value:function(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this.events.filter(function(n){return n.step>=e&&n.step<=t}):this.events.filter(function(n){return n.step>=e&&n.step<t})}}]),e}(),ba=function(e){function t(e,n,a){var r;return Object(o.a)(this,t),(r=Object(u.a)(this,Object(l.a)(t).call(this,e))).sequencerEngine=n,r.subSequence=a,r}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getMixType",value:function(){return"LINEAR"}},{key:"getValueAtStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=this.getNextEvent({step:e},!0),a=this.getPreviousEvent({step:e},!1,!0);if(void 0===a){if(void 0===n)return t;var r=e/n.step;return t*(1-r)+n.value*r}if(void 0===n)return a.volume;var s=(e-a.step)/(n.step-a.step);return a.volume*(1-s)+n.volume*s}},{key:"deleteEvent",value:function(e){var t=this.events.indexOf(e);t>-1&&this.events.splice(t,1),this.updateRedux(this.subSequence,this.sequencerEngine)}},{key:"loadFromJson",value:function(e,n,a){Object(ze.a)(Object(l.a)(t.prototype),"loadFromJson",this).call(this,e,n,a),this.updateRedux(a,n)}}]),t}(ga),ya=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,e))).defaultValue=n,a.heldEvent=void 0,a.currentEvent=n,a.cache={},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getMixType",value:function(){return"DETERMINISTIC"}},{key:"restart",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object(ze.a)(Object(l.a)(t.prototype),"restart",this).call(this),this.cache={},e||(this.heldEvent=void 0),this.currentEvent=this.defaultValue}},{key:"clear",value:function(){Object(ze.a)(Object(l.a)(t.prototype),"clear",this).call(this),this.cache={}}},{key:"holdEvent",value:function(e,t){this.heldEvent=e}},{key:"getValuesBetweenSteps",value:function(e,t){for(var n=[],a=void 0,r=e;r<t;r++){var s=this.getValue(r,!1,!1),i=s.getValue();this.type===Dt?void 0!==a&&i.equals(a)||n.push({step:r,value:i,event:s}):i!==a&&n.push({step:r,value:i,event:s}),a=i}for(var o=0;o<n.length;o++)void 0===n[o+1]?n[o].duration=t-n[o].step:n[o].duration=n[o+1].step-n[o].step,n[o].event.duration=n[o].duration;return n}},{key:"getValue",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getEvent(e,t).getValue()}},{key:"getEvent",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.heldEvent)return this.heldEvent;if(e in this.cache)return this.cache[e];0==e&&t&&this.restart();for(var n=t?this.counter:0,a=void 0;n<this.events.length&&!(this.events[n].step>e);n++)void 0!==this.heldEvent&&this.events[n].step!==e||(a=this.events[n]);return t&&(this.counter=Math.max(0,n-1)),void 0===a?(this.cache[e]=this.currentEvent,this.currentEvent):(this.currentEvent=a,this.heldEvent=void 0,this.cache[e]=a,a)}}]),t}(ga),ka=2,Ea=3,Sa=4,Oa=5,wa=6,Ca=7,Pa=8,Ta=9,ja=10,xa=11,Na=12,qa=13,Ma=14,Da=15,Aa=16,Ra=function(){function e(t,n){Object(o.a)(this,e),this.mix=t,this.type=n}return Object(c.a)(e,[{key:"execute",value:function(){}},{key:"getDuration",value:function(e){for(var t=0;t<this.events.length;t++){var n=this.events[t];if(void 0===e)return n.step-e.step}return 0}},{key:"calculateDurations",value:function(){for(var e=[],t=void 0,n=0;n<this.events.length;n++){var a=this.events[n];void 0!==t&&a.isEquivalent(t)||e.push(a),t=a}this.events=e,t=void 0;for(var r=0;r<this.events.length;r++){var s=this.events[r];void 0!==t&&(t.duration=s.step-t.step),t=s}}},{key:"mixByType",get:function(){var e=Ft(this.type)?this.mix.deterministicMixesByType:this.mix.mixesByType;return this.type in e||(Ft(this.type)?e[this.type]=new ya(this.type):e[this.type]=new ga(this.type)),e[this.type]}},{key:"events",get:function(){return this.mixByType.events},set:function(e){this.mixByType.events=e}}]),e}(),Ia=function(e){function t(e,n,a,r){var s;return Object(o.a)(this,t),(s=Object(u.a)(this,Object(l.a)(t).call(this,e,n.getType()))).event=n,s.time=a,s.trackStep=r,s}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(){if(this.event.setTime(this.time,this.trackStep),0==this.events.length||this.events[this.events.length-1].step<=this.trackStep)this.events.push(this.event);else{for(var e=0,t=this.events.length-1,n=void 0;e<=t;){if(n=Math.floor((e+t)/2),this.events[n].step<this.trackStep)e=n+1;else{if(!(this.events[n].step>this.trackStep))break;t=n-1}if(n>=1&&this.events[n-1].step<=this.trackStep&&this.events[n].step>=this.trackStep)break}this.events[n].step===this.trackStep?this.events[n]=this.event:this.events=this.events.slice(0,n).concat([this.event]).concat(this.events.slice(n)),this.counter=n}}},{key:"events",get:function(){return this.mixByType.events},set:function(e){this.mixByType.events=e}},{key:"counter",get:function(){return this.mixByType.counter},set:function(e){this.mixByType.counter=e}}]),t}(Ra),La=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(){Object(ze.a)(Object(l.a)(t.prototype),"execute",this).call(this),this.currentEvent=this.event}},{key:"currentEvent",set:function(e){this.mixByType.currentEvent=e}}]),t}(Ia),Fa=function(e){function t(e,n,a){var r;return Object(o.a)(this,t),(r=Object(u.a)(this,Object(l.a)(t).call(this,e,n.getType()))).event=n,r.duration=a,r}return Object(h.a)(t,e),Object(c.a)(t,[{key:"addEvent",value:function(e,t,n){new La(this.mix,e,t,n).execute()}},{key:"execute",value:function(){for(var e in this.events){var t=this.events[e];if(!t.isPrunable()){if(this.event.step===t.step||this.event.step===t.step+t.duration)return;if(this.event.step>t.step&&this.event.step<t.step+t.duration){var n=this.event.initialSubEvent;return n.step=this.event.step,void t.addSubEvent(n)}}}this.addEvent(this.event,0,this.event.step);var a=new St(!1,this.event.initialSubEvent.resolution);a.step=this.event.step+this.duration,this.addEvent(a,0,a.step)}}]),t}(Ra),Va=function(e){function t(e,n,a){var r;return Object(o.a)(this,t),(r=Object(u.a)(this,Object(l.a)(t).call(this,e,n.getType()))).event=n,r.duration=a,r}return Object(h.a)(t,e),Object(c.a)(t,[{key:"addEvent",value:function(e,t,n){e.isDeterministic()?new La(this.mix,e,t,n).execute():new Ia(this.mix,e,t,n).execute()}},{key:"execute",value:function(){if(!isNaN(this.event.step)){for(var e in this.events){var t=this.events[e];if(!t.isPrunable()&&void 0!==t.duration&&t.step<this.event.step&&t.step+t.duration>this.duration+this.event.step){var n=t.getCopy(this.mix.sequencerEngine);return n.step=this.event.step+this.duration,void this.addEvent(n,0,n.step)}}this.addEvent(this.event,0,this.event.step)}}}]),t}(Ra),Ba=function(e){function t(e,n){var a,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(o.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,e,n.getType()))).event=n,a.inPlace=r,a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(){var e=this.events.indexOf(this.event);if(e>-1&&this.events.splice(e,1),!this.inPlace){var t=this.event.duration;for(var n in this.events)if(this.events[n].step>this.event.step&&(this.events[n].step-=t,this.inPlace))return}this.mix.restart()}}]),t}(Ra),Ua=function(e){function t(e,n,a){var r;return Object(o.a)(this,t),(r=Object(u.a)(this,Object(l.a)(t).call(this,e,n.getType()))).event=n,r.subEvent=a,r}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(){var e=this.subEvent.step,t=this.subEvent.duration,n=this.event.deleteSubEvent(this.subEvent);if(!(n<0)){if(this.event.isEmpty())return n=this.mixByType.events.indexOf(this.event),this.mixByType.events.splice(n,1),this.mixByType.calculateDurations(),void this.mix.updateAllTypeRedux();var a=this.event.subEvents;for(var r in a)if(a[r].step>e){a[r].step-=t;break}this.mix.restart(),this.event.calculateDurations(),this.mixByType.calculateDurations(),this.mix.updateAllTypeRedux()}}}]),t}(Ra),Ha=function(e){function t(e,n,a){var r;return Object(o.a)(this,t),(r=Object(u.a)(this,Object(l.a)(t).call(this,e,n.getType()))).event=n,r.resolution=a,r}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(){void 0!==this.resolution&&(this.event.resolution=this.resolution)}}]),t}(Ra),Ja=function(e){function t(e,n,a){var r;return Object(o.a)(this,t),(r=Object(u.a)(this,Object(l.a)(t).call(this,e,n.getType()))).event=n,r.patternNumber=a,r}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(){this.event.patternNumber=this.patternNumber}}]),t}(Ra),Ga=function(e){function t(e,n,a){var r;return Object(o.a)(this,t),(r=Object(u.a)(this,Object(l.a)(t).call(this,e,n.getType()))).event=n,r.xTransform=a-r.event.step,r}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(){var e=this,t=this.mixByType.getNextEvent(this.event);if(void 0!==t){var n=this.mixByType.getNextEvent(t);(void 0===n||t.step+this.xTransform<=n.step)&&(this.event.step+=this.xTransform,t.step+=this.xTransform,this.event.initialSubEvent.step+=this.xTransform,this.event.subEvents.forEach(function(t){return t.step+=e.xTransform}),t.initialSubEvent.step+=this.xTransform,t.subEvents.forEach(function(t){return t.step+=e.xTransform}))}}}]),t}(Ra),za=function(){function e(t,n,a){Object(o.a)(this,e),this.track=t,this.pattern=n,this.step=a}return Object(c.a)(e,[{key:"execute",value:function(){var e=this.pattern.split(this.step);this.track.patterns.push(e),this.track.updateSteps(!0);var t={};t[Rt]=e,this.track.sequencerEngine.store.dispatch(Object(w.Hc)(t))}}]),e}();function _a(e,t,n){Wa(e.patterns.find(function(e){return e.overlapsStep(t)&&e.startStep<t}),t),Wa(e.patterns.find(function(e){return e.overlapsStep(n)&&e.startStep<n}),n);var a=e.patterns.filter(function(e){var a=e.startStep,r=e.startStep+e.length();return!(a>=t&&a<n||r>t&&r<=n)});e.patterns=a,e.updateSteps(!0)}function Wa(e,t){void 0!==e&&new za(e.track,e,t).execute()}var Ka=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,e,void 0))).selection=n,a.start=a.selection.start,a.end=a.selection.end,a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(){if(void 0!==this.mix.subSequence){for(var e in this.mix.mixesByType){var t=this.mix.mixesByType[e];this.deleteByType(parseInt(e),t)}for(var n in this.mix.deterministicMixesByType){var a=this.mix.deterministicMixesByType[n];this.deleteByType(parseInt(n),a)}this.mix.subSequence.isTrack&&this.executeForTrack(this.mix.subSequence.tracks[0])}else{var r=this.mix.deterministicMixesByType[Mt];this.deleteByType(Mt,r)}}},{key:"deleteByType",value:function(e,t,n){var a=t.getEventsBetween(this.start,this.end,!0).filter(function(e){return!e.isPrunable()});for(var r in a){var s=a[r];if(void 0!==s.initialSubEvent){var i=Object(ge.a)(s.subEvents);for(var o in i)new Ua(this.mix,s,i[o]).execute();new Ua(this.mix,s,s.initialSubEvent).execute()}else new Ba(this.mix,s,!0).execute()}if("LINEAR"===t.getMixType()){var c=Lt(e);if(void 0!==c){var u=t.getValueAtStep(this.start),l=Lt(e);c.step=this.start,l.step=this.end-1,c.setValue(u),l.setValue(u),c.subSequence=this.mix.subSequence,l.subSequence=this.mix.subSequence,new Va(this.mix,c,1).execute(),new Va(this.mix,l,1).execute()}}}},{key:"executeForTrack",value:function(e){_a(e,this.start,this.end)}}]),t}(Ra),Ya=function(e){function t(e,n,a,r){var s;return Object(o.a)(this,t),(s=Object(u.a)(this,Object(l.a)(t).call(this,e,void 0))).step=n,s.selection=a,s.start=s.selection.start,s.end=s.selection.end,s.mixType=r,s}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(){if(this.mix.subSequence.id===It.id&&(this.mixType=Mt),void 0===this.mixType){for(var e in this.mix.mixesByType){var t=this.mix.mixesByType[e];this.executeByType(parseInt(e),t)}for(var n in this.mix.deterministicMixesByType){var a=this.mix.deterministicMixesByType[n];this.executeByType(parseInt(n),a)}this.mix.subSequence.isTrack&&this.executeForTrack(this.mix.subSequence.tracks[0])}else this.mix.mixesByType[this.mixType]?this.executeByType(this.mixType,this.mix.mixesByType[this.mixType]):this.mix.deterministicMixesByType[this.mixType]&&this.executeByType(this.mixType,this.mix.deterministicMixesByType[this.mixType])}},{key:"executeByType",value:function(e,t,n){}},{key:"executeForTrack",value:function(){}},{key:"splitIntersectingPatterns",value:function(e){var t=this,n=e.patterns.find(function(e){return e.overlapsStep(t.start)&&e.startStep<t.start});this.splitPattern(n,this.start);var a=e.patterns.find(function(e){return e.overlapsStep(t.end)&&e.startStep<t.end});this.splitPattern(a,this.end)}},{key:"splitPattern",value:function(e,t){void 0!==e&&new za(e.track,e,t).execute()}}]),t}(Ra),Qa=function(e){function t(e,n,a,r,s){var i;return Object(o.a)(this,t),(i=Object(u.a)(this,Object(l.a)(t).call(this,e,n,a,r))).track=s,i}return Object(h.a)(t,e),Object(c.a)(t,[{key:"executeByType",value:function(e,t,n){var a=this,r=t.getEventsBetween(this.start,this.end,!0).filter(function(e){return!e.isPrunable()}).map(function(e){var t=e.getCopy(a.mix.sequencerEngine);return t.setTime(void 0,a.step+e.step-a.start),t.subEvents&&t.subEvents.forEach(function(e){return e.step=a.step+e.step-a.start}),t.duration=e.duration,t.subSequence=a.mix.subSequence,t});if("DETERMINISTIC"===t.getMixType()){var s=t.getEvent(this.start,!1).getCopy(this.mix.sequencerEngine);s.isPrunable()||(s.setTime(void 0,this.step),r.push(s))}if("LINEAR"===t.getMixType()){var i=Lt(e);if(void 0!==i){var o=t.getValueAtStep(this.start),c=t.getValueAtStep(this.end-1);i.setValue(o),i.setTime(void 0,this.step),i.subSequence=this.mix.subSequence;var u=Lt(e);u.setValue(c),u.setTime(void 0,this.step+this.end-this.start-1),u.subSequence=this.mix.subSequence;var l=Lt(e);l.setValue(c),l.setTime(void 0,this.step-1),l.subSequence=this.mix.subSequence,r.push(i),r.push(u),r.push(l)}}for(var p in r){var h=r[p];e===Mt?new Fa(this.mix,h,h.duration).execute():new Va(this.mix,h,h.duration).execute()}}},{key:"executeForTrack",value:function(e){var t=[],n=1/0,a=-1/0;for(var r in e.patterns){var s=e.patterns[r];if(s.startStep>=this.start&&s.startStep<this.end||s.endStep>=this.start&&s.endStep<this.end){var i=void 0;if(s.startStep<this.start){var o=this.start-s.startStep;i=s.getCopy(o,o+s.endStep-this.start)}else i=s.endStep>this.end?s.getCopy(0,this.end-s.startStep):s.getCopy();i.startStep<n&&(n=i.startStep),i.endStep>a&&(a=i.endStep),i.track=this.track;var c=i.startStep-this.start;i.startStep=this.step+c,t.push(i)}}n!==1/0&&a!==-1/0&&_a(this.track,this.step+n-this.start,this.step+a-this.start),this.track.patterns=[].concat(Object(ge.a)(this.track.patterns),t),this.track.updateSteps()}}]),t}(Ya),Xa=function(e){function t(e,n,a,r){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e,n,a,r))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getEventsAfter",value:function(e,t){return e.events.filter(function(e){return e.step>=t})}},{key:"executeByType",value:function(e,t,n){var a=this.getEventsAfter(t,this.start);for(var r in a){var s=a[r],i=(s.step,this.step-this.start);if(s.setTime(void 0,s.step+i),s.subEvents)for(var o in s.subEvents){s.subEvents[o].step+=i}}}}]),t}(Ya),Za=function(e){function t(e,n,a){var r;return Object(o.a)(this,t),(r=Object(u.a)(this,Object(l.a)(t).call(this,e,void 0,n,a))).step=r.end,r}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(){var e={start:this.end};new Xa(this.mix,this.end+this.duration,e).execute(),Object(ze.a)(Object(l.a)(t.prototype),"execute",this).call(this)}},{key:"executeForTrack",value:function(){var e=this,t=this.mix.subSequence.tracks[0];this.splitIntersectingPatterns(t);var n=this.end-this.start;t.patterns.filter(function(t){return t.startStep>=e.end}).forEach(function(e){return e.startStep+=n});for(var a in t.patterns){var r=t.patterns[a];if(r.startStep>=this.start&&r.startStep<this.end){var s=r.startStep-this.start,i=r.getCopy();i.startStep=this.end+s,t.patterns.push(i)}}t.updateSteps()}},{key:"duration",get:function(){return this.end-this.start}}]),t}(Qa),$a=function(){function e(t,n,a){Object(o.a)(this,e),this.track=t,this.pattern=n,this.startStep=a}return Object(c.a)(e,[{key:"execute",value:function(){this.pattern.startStep=this.startStep}}]),e}(),er=100;function tr(e,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1)*(t.resolution/8)*e/32*er}var nr=140,ar="RIGHT",rr="LEFT",sr=new ht(16,!1),ir=function(){function e(t,n,a){Object(o.a)(this,e),this.pattern=n,this.step=a,this.track=t}return Object(c.a)(e,[{key:"execute",value:function(){_a(this.track,this.step,this.step+this.pattern.length());var e=this.pattern.getCopy();e.track=this.track,e.startStep=this.step,this.track.patterns.push(e),this.track.updateSteps(!0);var t={};t[Rt]=e,this.track.sequencerEngine.store.dispatch(Object(w.Hc)(t));var n=this.step+e.length();this.track.sequencerEngine.store.dispatch(Object(w.y)(n))}},{key:"xScale",get:function(){return this.track.sequencerEngine.state.arrangement.xScale}}]),e}(),or=function(){function e(t,n){Object(o.a)(this,e),this.pattern=n,this.track=t}return Object(c.a)(e,[{key:"execute",value:function(){_a(this.track,this.pattern.endStep,this.pattern.endStep+this.pattern.length());var e=this.pattern.getCopy();e.track=this.track,e.startStep=this.pattern.startStep+this.pattern.length(),this.track.patterns.push(e),this.track.updateSteps(!0);var t={};t[Rt]=e,this.track.sequencerEngine.store.dispatch(Object(w.Hc)(t));var n=e.startStep;this.track.sequencerEngine.store.dispatch(Object(w.y)(n))}},{key:"xScale",get:function(){return this.track.sequencerEngine.state.arrangement.xScale}}]),e}(),cr=function(){function e(t,n,a){Object(o.a)(this,e),this.pattern=t,this.direction=n,this.resizedStep=a}return Object(c.a)(e,[{key:"findOverlappingPattern",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.resizedStep;return this.pattern.track.patterns.filter(function(t){return t!==e.pattern}).find(function(e){return e.overlapsStep(t)})}},{key:"cutOverlappingPattern",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.resizedStep;if(void 0!==e)if(this.direction===rr){var n=t-e.startStep;if(n<=0)return void this.deletePattern(e);e.changeLength(n)}else{var a=t-e.startStep;if(e.cutFromStart(a),e.startStep=t,0===e.length())return void this.deletePattern(e)}}},{key:"deletePattern",value:function(e){var t=e.track;t.patterns=t.patterns.filter(function(t){return t!==e})}},{key:"execute",value:function(){if(this.direction===ar){var e=this.resizedStep-this.pattern.startStep;if(e<=0)return;e>this.pattern.length()&&this.cutOverlappingPattern(this.findOverlappingPattern()),this.pattern.changeLength(e,!1)}else this.resizedStep<this.pattern.startStep?(this.cutOverlappingPattern(this.findOverlappingPattern()),this.pattern.addToStart(this.pattern.startStep-this.resizedStep)):(this.pattern.cutFromStart(this.resizedStep-this.pattern.startStep),0===this.pattern.length()&&this.deletePattern(this.pattern)),this.pattern.startStep=this.resizedStep;this.pattern.track.updateSteps(!0)}}]),e}();function ur(e,t){void 0===t&&(t=e);var n=t.payload,a=void 0;switch(t.type){case ka:(a=new Fa(e,n.event,n.duration)).execute();break;case Ca:(a=new Va(e,n.event,n.duration)).execute();break;case Ea:(a=new Ba(e,n.event,n.inPlace)).execute();break;case Sa:(a=new Ua(e,n.event,n.subEvent)).execute();break;case Oa:(a=new Ha(e,n.event,n.resolution)).execute();break;case wa:(a=new Ja(e,n.event,n.pattern)).execute();break;case Pa:(a=new Ga(e,n.event,n.newStep)).execute();break;case Ta:(a=new Qa(e,n.step,n.selection,n.eventType,n.track)).execute();break;case ja:(a=new Ka(e,n.selection)).execute();break;case xa:(a=new Za(e,n.selection,n.eventType)).execute();break;case Na:return(a=new $a(n.track,n.pattern,n.startStep)).execute(),a;case qa:return(a=new za(n.track,n.pattern,n.step)).execute(),a;case Ma:return(a=new ir(n.track,n.pattern,n.step)).execute(),a;case Da:return(a=new or(n.track,n.pattern)).execute(),a;case Aa:return(a=new cr(n.pattern,n.direction,n.resizedStep)).execute(),a;default:return}return n.event?n.event.parentEvent?(e.updateTypeRedux(n.event.parentEvent.getType()),e.prune(n.event.parentEvent.getType())):(e.updateTypeRedux(n.event.getType()),e.prune(n.event.getType())):e.updateAllTypeRedux(),a}var lr=function(e){function t(e,n,a,r){var s;return Object(o.a)(this,t),(s=Object(u.a)(this,Object(l.a)(t).call(this,e,n.getType()))).event=n,s.difference=a,s.inPlace=r,s}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(){this.event.duration=this.getDuration(this.event);this.events.map(function(e){return e.step});if(0!==this.differeence){for(var e=void 0,t=0;t<this.events.length;t++){var n=this.events[t];if(n.step>this.event.step){n.step+=this.difference;var a=this.events[t+1];if(a&&a.step<=n.step&&(e=t),this.inPlace)break}}void 0!==e&&this.events.splice(e,1),this.events.map(function(e){return e.step}),this.calculateDurations()}}}]),t}(Ra),pr=function(e){function t(e,n,a){var r;return Object(o.a)(this,t),(r=Object(u.a)(this,Object(l.a)(t).call(this,e,n[0].getType()))).eventsToPaste=n,r.stepNumber=a,r}return Object(h.a)(t,e),Object(c.a)(t,[{key:"insertEvent",value:function(e,t){new Va(this.mix,e,t).execute()}},{key:"execute",value:function(){var e=this.eventsToPaste[0].step;for(var t in this.eventsToPaste){var n=this.eventsToPaste[t];n.step=n.step-e+this.stepNumber,this.insertEvent(n,n.duration)}}}]),t}(Ra),hr=function(e){function t(e,n,a){var r;return Object(o.a)(this,t),(r=Object(u.a)(this,Object(l.a)(t).call(this,void 0,Dt))).sequenceRollEvent=e,r.event=n,r.difference=a,r}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(){for(var e=void 0,t=0;t<this.events.length;t++){var n=this.events[t];if(n.step>this.event.step){n.step+=this.difference;var a=this.events[t+1];a&&a.step<=n.step&&(e=t),n.duration+this.difference<0&&(e=t);break}}void 0!==e&&this.sequenceRollEvent.subEvents.splice(e-1,1),this.sequenceRollEvent.calculateDurations()}},{key:"events",get:function(){return this.sequenceRollEvent.events},set:function(e){this.sequenceRollEvent.events=e}}]),t}(Ra),dr="LEFT",fr=function(e){function t(e,n,a,r,s){var i;return Object(o.a)(this,t),(i=Object(u.a)(this,Object(l.a)(t).call(this,e,n.getType()))).sequenceRollEvent=n,i.resolutionChangeEvent=a,r===dr?i.newStart=s:i.difference=s,i.direction=r,i}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(){this.direction===dr?this.resizeLeftSide():this.resizeRightSide()}},{key:"resizeLeftSide",value:function(){0===this.sequenceRollEvent.getSubEvents().indexOf(this.resolutionChangeEvent)&&(this.sequenceRollEvent.step=this.newStart),this.resolutionChangeEvent.step=this.newStart,this.sequenceRollEvent.calculateDurations()}},{key:"resizeRightSide",value:function(){this.sequenceRollEvent.step,this.sequenceRollEvent.duration;var e=this.sequenceRollEvent.getSubEvents(),t=-1;for(var n in e)e[n].step===this.resolutionChangeEvent.step&&(t=parseInt(n));t===e.length-1?new lr(this.mix,this.sequenceRollEvent,this.difference,!0).execute():new hr(this.sequenceRollEvent,this.resolutionChangeEvent,this.difference).execute()}},{key:"getResolutionDuration",value:function(e){var t=e.step+e.duration,n=this.mix.getValuesBetweenSteps(Mt,e.step,t);for(var a in n)if(!n[a].value)return n[a].step-e.step;return e.duration}}]),t}(Ra),mr=function(){function e(t,n){Object(o.a)(this,e),this.sequencerEngine=t,this.subSequence=void 0===n?It:n}return Object(c.a)(e,[{key:"getTimeForEventToAdd",value:function(e){if(this.sequencerEngine.playing){var t=new q.a.Time(q.a.Master.currentTime).toMilliseconds()-new q.a.Time(this.sequencerEngine.automationTime).toMilliseconds(),n=this.sequencerEngine.automationStep||0;return e.isDeterministic()||n--,{time:t,step:n}}}},{key:"seekToTrackStep",value:function(e){}},{key:"resizeEvent",value:function(e,t,n){}},{key:"deleteEvent",value:function(e,t){}},{key:"deleteCompoundEvent",value:function(e,t){}},{key:"insertEvent",value:function(e,t){}},{key:"pasteEvents",value:function(e,t){}},{key:"restart",value:function(){}},{key:"addEvent",value:function(e){}},{key:"holdEvent",value:function(e){}},{key:"scheduleNext",value:function(e,t){}},{key:"schedule",value:function(){}},{key:"getValue",value:function(e,t){}},{key:"getEvent",value:function(e,t){}}]),e}(),vr=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,e,n))).mixesByType={},a.mixesByType[At]=new ba(At,e,n),a.deterministicMixesByType={},a.deterministicMixesByType[Dt]=new ya(Dt,new kt(new ht)),a.deterministicMixesByType[Mt]=new ya(Mt,new St(!1,new ht)),a.deterministicMixesByType[Ot]=new ya(Ot,new nt(0)),n&&a.updateAllTypeRedux(),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getValue",value:function(e,t){var n=this.deterministicMixesByType[e];if(void 0!==n)return n.getValue(t,!0)}},{key:"getEvent",value:function(e,t){var n=this.deterministicMixesByType[e];if(void 0!==n)return n.getEvent(t)}},{key:"getValuesBetweenSteps",value:function(e,t,n){var a=this.deterministicMixesByType[e];if(void 0!==a)return a.getValuesBetweenSteps(t,n)}},{key:"holdEvent",value:function(e){if(e.isDeterministic()){var t=e.getType();!t in this.deterministicMixesByType&&(this.deterministicMixesByType[t]=new ya),this.deterministicMixesByType[t].holdEvent(e)}}},{key:"dispatch",value:function(e){ur(this,e)}},{key:"addEvent",value:function(e){var t=this.getTimeForEventToAdd(e);if(void 0!==t){e.subSequence=this.subSequence;e.cancel(),e.isDeterministic()?new La(this,e,t.time,t.step).execute():new Ia(this,e,t.time,t.step).execute(),setTimeout(function(){e.canceled=!1},5e3),e.isDeterministic()&&this.updateAllTypeRedux()}}},{key:"getNextEvent",value:function(e){var t=e.getType();return this.deterministicMixesByType[t].getNextEvent(e)}},{key:"getPreviousEvent",value:function(e){var t=e.getType();return this.deterministicMixesByType[t].getPreviousEvent(e)}},{key:"resizeEvent",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];new lr(this,e,t,n).execute(),this.updateAllTypeRedux()}},{key:"resizeSequenceRoll",value:function(e,t,n,a){new fr(this,e,t,n,a).execute(),this.updateAllTypeRedux()}},{key:"insertEvent",value:function(e,t){new Va(this,e,t).execute(),this.updateAllTypeRedux()}},{key:"pasteEvents",value:function(e,t){new pr(this,e,t).execute(),this.updateAllTypeRedux()}},{key:"deleteEvent",value:function(e,t){new Ba(this,e,t).execute(),this.updateAllTypeRedux()}},{key:"deleteCompoundEvent",value:function(e,t){new Ua(this,e,t).execute(),this.updateAllTypeRedux()}},{key:"seekToTrackStep",value:function(e){for(var t in this.mixesByType)this.mixesByType[t].seekToTrackStep(e);for(var n in this.deterministicMixesByType)this.deterministicMixesByType[n].seekToTrackStep(e)}},{key:"restart",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var t in this.mixesByType)this.mixesByType[t].restart(e);for(var n in this.deterministicMixesByType)this.deterministicMixesByType[n].restart(e)}},{key:"scheduleNext",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a,r,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(s in a=new q.a.Time(q.a.Master.context.currentTime).toMilliseconds(),r=new q.a.Time(n).toMilliseconds()-a,this.mixesByType)this.mixesByType[s].scheduleNext(t,r,this.sequencerEngine);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"eraseEventsAtStep",value:function(e){for(var t in this.mixesByType)this.mixesByType[t].eraseEventsAtStep(e)}},{key:"schedule",value:function(){for(var e in this.mixesByType)this.mixesByType[e].schedule()}},{key:"getJson",value:function(){var e={};for(var t in this.mixesByType)e[t]=this.mixesByType[t].getJson();var n={};for(var a in this.deterministicMixesByType)n[a]=this.deterministicMixesByType[a].getJson();return{name:this.name,mixesByType:e,deterministicMixesByType:n}}},{key:"getCopy",value:function(){var e=new t(this.name);return e.mixesByType=this.mixesByType,e.deterministicMixesByType=this.deterministicMixesByType,e}},{key:"getFirstEvent",value:function(e){return this.deterministicMixesByType[e].defaultValue}},{key:"loadFromJson",value:function(e,t){if(void 0!==e){for(var n in console.log("load mix from json = ",e),t=this.sequencerEngine,e.mixesByType)this.mixesByType[n]=new ba(parseInt(n),t,this.subSequence),this.mixesByType[n].loadFromJson(e.mixesByType[n],t,this.subSequence);for(var a in e.deterministicMixesByType){var r=void 0;(a=parseInt(a))===Ot?r=new nt(0):a===Mt?r=new St(!1,new ht):a===Dt&&(r=new kt(new ht)),this.deterministicMixesByType[a]=new ya(parseInt(a),r),this.deterministicMixesByType[a].loadFromJson(e.deterministicMixesByType[a],t)}this.updateAllTypeRedux()}}},{key:"updateTypeRedux",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.Yb,n=this.deterministicMixesByType[e],a=[],r=this.getFirstEvent(e);r.step=0;for(var s=0;s<n.events.length;s++)r.duration=n.events[s].step-r.step,a.push(r),r=n.events[s];var i=n.events[n.events.length-1]||r;i&&(i.duration=void 0,a.push(i)),this.sequencerEngine.store.dispatch(t(this.subSequence.id,e,a))}},{key:"updateAllTypeRedux",value:function(){for(var e in this.mixesByType)this.mixesByType[e].updateRedux(this.subSequence,this.sequencerEngine);this.updateTypeRedux(Ot,w.Yb),this.updateTypeRedux(Mt,w.Yb)}},{key:"clear",value:function(){for(var e in this.deterministicMixesByType)this.deterministicMixesByType[e].clear();for(var t in this.mixesByType)this.mixesByType[t].clear();this.updateAllTypeRedux()}},{key:"prune",value:function(e){e in this.deterministicMixesByType&&this.deterministicMixesByType[e].prune(),e in this.mixesByType&&this.deterministicMixesByType[e].prune()}},{key:"length",get:function(){var e=[];for(var t in this.deterministicMixesByType){var n=this.deterministicMixesByType[t];e=[].concat(Object(ge.a)(e),Object(ge.a)(n.events.map(function(e){return e.step})))}for(var a in this.mixesByType){var r=this.mixesByType[a];e=[].concat(Object(ge.a)(e),Object(ge.a)(r.events.map(function(e){return e.step})))}var s=Math.max.apply(Math,Object(ge.a)(e.filter(function(e){return void 0!==e&&!isNaN(e)})));return s===-1/0?0:s}}]),t}(mr),gr=function(e){function t(e,n,a,r){var s;return Object(o.a)(this,t),(s=Object(u.a)(this,Object(l.a)(t).call(this,r))).pattern=e,s.stepNumber=n,s.resolution=a,s}return Object(h.a)(t,e),Object(c.a)(t,[{key:"search",value:function(e,t){if(void 0!==this.stepNumber){void 0===this.resolution||this.resolution.toString();if(this.stepNumber===e&&t.equals(this.resolution))return this;if(void 0!==this.children)for(var n in this.children){var a=this.children[n].search(e,t);if(void 0!==a)return a}}else for(var r in this.children){var s=this.children[r].search(e,t);if(void 0!==s)return s}}},{key:"toggle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this.on){var t=this.getAllLeaves().filter(function(e){return e.on}),n=[];for(var a in t){var r=t[a];n.push({stepBucket:this.stepBuckets[r.stepNumber],stepNumber:r.stepNumber});var s=e||this.stepBuckets[r.stepNumber].getAllOnSteps()[0].id;this.stepBuckets[r.stepNumber]=new ct(this.pattern.track,this.resolution.isTriplet),this.stepBuckets[r.stepNumber].steps[0].id=s}return n}var i=this.getLeftMostLeaf();this.on=!0,e=e||this.stepBuckets[i.stepNumber].steps[0].id,this.getLeftMostBucket().steps[0].id=e;var o=new ct(this.pattern.track,this.resolution.isTriplet);return o.steps[0].id=e,[{stepBucket:o,stepNumber:i.stepNumber}]}},{key:"getLeftMostBucket",value:function(){var e=this.getLeftMostLeaf();return this.stepBuckets[e.stepNumber]}},{key:"getJson",value:function(){return void 0===this.children?{stepNumber:this.stepNumber,resolution:this.resolution}:{stepNumber:this.stepNumber,resolution:this.resolution,children:this.children.map(function(e){return e.getJson()})}}},{key:"stepBuckets",get:function(){return this.resolution.isTriplet?this.pattern.tripletStepBuckets:this.pattern.stepBuckets}},{key:"on",set:function(e){this.getLeftMostBucket().steps[0].on=e},get:function(){return void 0===this.children?this.stepBuckets[this.stepNumber].anyOn():this.getAllLeaves().some(function(e){return e.on})}}]),t}(function(){function e(t){Object(o.a)(this,e),this.children=t}return Object(c.a)(e,[{key:"getAllLeaves",value:function(){if(void 0===this.children)return[this];var e=[];for(var t in this.children)e=e.concat(this.children[t].getAllLeaves());return e}},{key:"getLeftMostLeaf",value:function(){var e=this.getAllLeaves();if(e.length>0)return e[0]}}]),e}());function br(e,t){for(var n=new ht(1,t),a=e.length(n),r=[],s=0;s<a;s++){var i=new gr(e,s,n,void 0);r.push(yr(i,e,t))}return new gr(e,void 0,void 0,r)}function yr(e,t,n){var a=e.resolution;if(32===a.resolution)return e;var r=new ht(2*a.resolution,a.isTriplet);if(n){var s=new gr(t,3*e.stepNumber,r,void 0),i=new gr(t,3*e.stepNumber+1,r,void 0),o=new gr(t,3*e.stepNumber+2,r,void 0);e.children=[yr(s,t),yr(i,t),yr(o,t)]}else{var c=new gr(t,2*e.stepNumber,r,void 0),u=new gr(t,2*e.stepNumber+1,r,void 0);e.children=[yr(c,t),yr(u,t)]}return e}var kr=new ht(32,!1),Er=new ht(32,!0),Sr=(new ht(16,!1),0),Or=function(){function e(t,n){Object(o.a)(this,e),this.steps=[],this.id=Sr++,this.sequencerEngine=t,this.store=t.store,this.track=n,this.mix=new vr(t),this.stepBuckets=[],this.tripletStepBuckets=[],this.stepBucketsMatrix={},this.tripletStepBucketsMatrix={},this.transformBucketsIntoStepsCache={},this.stepFills=[],this.tripletStepFills=[],this.volume=75,this.panning=0,this.muted=!1,this.initBlankPattern(),this.color=void 0,this.loopsPlaying={},this.updateStepResolutionTree(),this.needsSync=!1,this._startStep=void 0,this.repeats=void 0}return Object(c.a)(e,[{key:"updateStepResolutionTree",value:function(){this.stepResolutionTree=br(this,!1),this.tripletStepResolutionTree=br(this,!0)}},{key:"getStepResolutionTree",value:function(e){return e?this.tripletStepResolutionTree:this.stepResolutionTree}},{key:"getBucketsForStepAtResolution",value:function(e,t){for(var n=this.getRangeOfStepsAtResolution(t),a=t.isTriplet?this.tripletStepBuckets:this.stepBuckets,r=t.isTriplet?Er.transformStepAtResolution(e,t):kr.transformStepAtResolution(e,t),s=[],i=r=Math.floor(r);i<n+r;i++)s.push(a[i%a.length]);return s}},{key:"deleteStepNumber",value:function(e){this.stepBuckets[e]=new ct(this.track)}},{key:"getRangeOfStepsAtResolution",value:function(e){return e.isTriplet?Er.numSteps()/e.numSteps():kr.numSteps()/e.numSteps()}},{key:"getAllOnStepAtResolutionAtAnyPosition",value:function(e,t){this.getRangeOfStepsAtResolution(t);var n=this.getBucketsForStepAtResolution(e,t),a=[];for(var r in n)a=a.concat(n[r].getAllOnSteps());return a}},{key:"getStepAtResolution",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=(this.getRangeOfStepsAtResolution(t),this.getBucketsForStepAtResolution(e,t));for(var s in r)if(void 0!==r[s]){var i=r[s].getStep(a);if(i.getPolyphony().some(function(e){return e.on&&n(e)}))return i}r.length}},{key:"getPolyphonicStepsAtResolution",value:function(e,t){var n=t.isTriplet?Er.numSteps()/t.numSteps():kr.numSteps()/t.numSteps(),a=[];if(t.isTriplet){var r=Er.transformStepAtResolution(e,t);this.tripletStepBuckets[r%this.tripletStepBuckets.length];for(var s=r;s<n+r;s++){var i=this.tripletStepBuckets[s%this.tripletStepBuckets.length].steps,o=function(e){var t=i[e].getPolyphony().filter(function(e){return e.on}).map(function(t){return{position:e,step:t}});a=a.concat(t)};for(var c in i)o(c)}}else{var u=kr.transformStepAtResolution(e,t);this.stepBuckets[u%this.stepBuckets.length];for(var l=u;l<n+u;l++){var p=this.stepBuckets[l%this.stepBuckets.length].steps,h=function(e){var t=p[e].getPolyphony().filter(function(e){return e.on}).map(function(t){return{position:e,step:t}});a=a.concat(t)};for(var c in p)h(c)}}return a}},{key:"setStepAtResolution",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;(void 0===t||isNaN(t))&&(t=0),(void 0===a||isNaN(a))&&(a=0),t=n.isTriplet?Er.transformStepAtResolution2(t,n):kr.transformStepAtResolution2(t,n);var r=Math.floor(t);if((a+=t-r)>=1){var s=Math.floor(a);r+=s,a-=s}n.isTriplet?this.tripletStepBuckets[r%this.tripletStepBuckets.length].setStepAtPosition(e,a):this.stepBuckets[r%this.stepBuckets.length].setStepAtPosition(e,a)}},{key:"addNote",value:function(e,t,n){var a=new ot;a.on=!0,a.duration=t,a.transpose=n,a.stepNumber=e,this.stepBuckets[e].setStep(0,a)}},{key:"clearCache",value:function(){this.transformBucketsIntoStepsCache={}}},{key:"loadStepBuckets",value:function(e){this.stepBuckets=e,this.tripletStepBuckets=Er.transformBucketsAtResolution(this.stepBuckets,kr),this.updateStepResolutionTree(),this.transformBucketsIntoStepsCache={},this.syncMatrix()}},{key:"syncBuckets",value:function(e){(e=void 0!==e&&e)?this.stepBuckets=kr.transformBucketsAtResolution(this.tripletStepBuckets,Er):this.tripletStepBuckets=Er.transformBucketsAtResolution(this.stepBuckets,kr),this.syncMatrix()}},{key:"syncMatrixBySteps",value:function(e,t){for(var n in this.needsSync=!1,e){var a=e[n];n=kr.transformStepAtResolution(n,t),a=kr.transformStepAtResolution(a,t);var r=this.stepBuckets[n],s=this.stepBuckets[a];r&&r.anyOn()?this.stepBucketsMatrix[n]=r:delete this.stepBucketsMatrix[n],s&&s.anyOn()?this.stepBucketsMatrix[a]=s:delete this.stepBucketsMatrix[a]}}},{key:"syncMatrix",value:function(){this.stepBucketsMatrix={},this.tripletStepBucketsMatrix={};for(var e=0;e<this.stepBuckets.length;e++){var t=this.stepBuckets[e];t.anyOn()&&(this.stepBucketsMatrix[e]=t)}for(var n=0;n<this.tripletStepBuckets.length;n++){var a=this.tripletStepBuckets[n];a.anyOn()&&(this.tripletStepBucketsMatrix[n]=a)}this.needsSync=!1}},{key:"getBucket",value:function(e,t){return e=(t=t||kr).isTriplet?Er.transformStepAtResolution2(e,t):kr.transformStepAtResolution2(e,t),t.isTriplet?this.tripletStepBuckets[e]:this.stepBuckets[e]}},{key:"clear",value:function(){this.stepBuckets.map(function(e){return e.clear()}),this.syncBuckets(),this.clearCache()}},{key:"changeLength",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e=Math.ceil(e),this.stepBuckets=this.stepBuckets.slice(0,e);for(var n=this.stepBuckets.length;n<e;n++)this.stepBuckets.push(new ct(this.track));this.clearCache(),t&&this.syncBuckets()}},{key:"length",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:kr;if(e===kr)return e.isTriplet?this.tripletStepBuckets.length:this.stepBuckets.length;var t=e.isTriplet?this.tripletStepBuckets.length:this.stepBuckets.length;return e.isTriplet?Math.ceil(e.transformStepAtResolution2(t,Er)):Math.ceil(e.transformStepAtResolution2(t,kr))}},{key:"initBlankPattern",value:function(){for(var e=0;e<kr.numSteps();e++)this.stepBuckets.push(new ct(this.track)),this.stepFills.push(!1);for(e=0;e<Er.numSteps();e++)this.tripletStepBuckets.push(new ct(this.track,!0)),this.tripletStepFills.push(!1)}},{key:"getFillsAtResolution",value:function(e){return e.isTriplet?e.transformList(this.tripletStepFills):e.transformList(this.stepFills)}},{key:"getStepsAtResolution",value:function(e){var t=e.isTriplet?this.tripletStepBuckets:this.stepBuckets;if(!(e in this.transformBucketsIntoStepsCache)){var n=e.transformBucketsIntoSteps(t);return this.transformBucketsIntoStepsCache[e]=n,n}return this.transformBucketsIntoStepsCache[e]}},{key:"getAnyStep",value:function(e){for(var t in this.stepBuckets[e].steps){var n=this.stepBuckets[e].steps[t];if(n.on)return n}return this.stepBuckets[e].steps[0]}},{key:"getBucketsAtResolution",value:function(e){var t=e.isTriplet?this.tripletStepBuckets:this.stepBuckets;return e.transformList(t)}},{key:"setLength",value:function(e){this.stepBuckets=[];for(var t=0;t<e;t++)this.stepBuckets.push(new ct(this.track));this.syncBuckets(!1)}},{key:"doubleTrackLength",value:function(){for(var e=this.stepBuckets.length,t=0;t<e;t++)this.stepBuckets.push(new ct(this.track)),this.stepFills.push(!1);e=this.tripletStepBuckets.length;for(var n=0;n<e;n++)this.tripletStepBuckets.push(new ct(this.track,!0)),this.tripletStepFills.push(!1);this.clearCache(),this.updateStepResolutionTree()}},{key:"halfTrackLength",value:function(){var e=this.length()/2;this.stepBuckets=this.stepBuckets.slice(0,e),this.stepFills=this.stepFills.slice(0,e),e=this.tripletStepBuckets.length/2,this.tripletStepBuckets=this.tripletStepBuckets.slice(0,e),this.tripletStepFills=this.tripletStepFills.slice(0,e),this.clearCache(),this.updateStepResolutionTree()}},{key:"loadFromJson",value:function(e){if(void 0===e.newVolume){var t=e.volume+40;this.volume=128*t/60}else this.volume=e.volume;this.panning="panning"in e?e.panning:0,this.muted=e.muted,this.loopsPlaying="loopsPlaying"in e?e.loopsPlaying:{},"startStep"in e&&(this.startStep=e.startStep),"repeats"in e&&(this.repeats=e.repeats)}},{key:"calculateFillsHelper",value:function(e,t,n){n.isTriplet?this.tripletStepFills.fill(!1):this.stepFills.fill(!1);for(var a=t.length,r=0;r<a;r++){var s=-16;for(var i in t[r].steps){var o=t[r].getStep(i);if(o.on){var c=null==o.duration?e.duration:o.duration;s<(c=2*Math.floor(c))&&(s=c)}}if(!(s<1))for(var u=0;u<s;u++){var l=(r+u)%a;n.isTriplet?this.tripletStepFills[l]=!0:this.stepFills[l]=!0}}}},{key:"calculateFills",value:function(e){this.calculateFillsHelper(e,this.stepBuckets,kr),this.calculateFillsHelper(e,this.tripletStepBuckets,Er)}},{key:"getJson",value:function(){return{newVolume:!0,automations:this.mix.getJson(),volume:this.volume,panning:this.panning,muted:this.muted,loopsPlaying:this.loopsPlaying,startStep:this.startStep,repats:this.repeats}}},{key:"getCopy",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.stepBuckets.length,r=new e(this.sequencerEngine,this.track);r.stepBuckets=[],r.mix=this.mix.getCopy(),r.tripletStepBuckets=[],r.volume=this.volume,r.panning=this.panning,r.muted=this.muted,r.steps=[],r.loopsPlaying={},Object.keys(this.loopsPlaying).map(function(e){return r.loopsPlaying[e]=t.loopsPlaying[e]});for(var s=n;s<a;s++)r.stepBuckets.push(this.stepBuckets[s].getCopy()),r.stepFills.push(this.stepFills[s]);return r.startStep=void 0===this.startStep?void 0:this.startStep+n,r.updateStepResolutionTree(),r.syncBuckets(),r}},{key:"chooseColor",value:function(e){this.color=e}},{key:"getUpdateStepsAction",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.store.getState().sequencer.resolution,a=this.length(n),r=new Array(a).fill(!1),s={},i={},o={},c={},u=new Array(a),l=this.getEasyPattern();t&&l.update();var p=n.isTriplet?this.tripletStepBucketsMatrix:this.stepBucketsMatrix,h=n.isTriplet?new ht(32,!0):new ht(32,!1),d=function(t){var l=Math.floor(n.transformStepAtResolution2(t,h));r[l]=!0;var d=h.resolution/n.resolution,f=(t-l*d)/d,m={},v=[];if(void 0===p[t])return"continue";var g={};for(var b in p[t].steps){var y=p[t].steps[b].getPolyphony();for(var k in y){var E=y[k];if(E.on){var S=Math.round(E.transpose);m[S]=parseFloat(b)/d+f;var O=new ht(16,!1);g[S]=n.transformStepAtResolution2(E.duration,O),v.push(E)}}}var w=p[t].getAllOnSteps()[0];u[l]=w;var C={};for(var P in v.filter(function(e){return e.on}).forEach(function(t){return C[Math.round(null==t.transpose?e.trackData.transpose:t.transpose)]=!0}),m)P in s||(s[P]={}),s[P][parseInt(l)]=!0,P in i||(i[P]={}),i[P][parseInt(l)]=m[P];for(var T in g)T in o||(o[T]={}),o[T][parseInt(l)]=g[T];for(var j in v){var x=v[j];if(x.on){var N=x.transpose;null==N&&(N=e.trackData.transpose);for(var q=n.transformStepAtResolution2(x.duration,new ht(16,!1)),M=0;M<q;M++){var D=(parseInt(l)+parseInt(M))%a;c[parseInt(D)]=!0}}}};for(var f in p)d(f);return this.sequencerEngine.midi&&this.sequencerEngine.cursor.track===this.trackNumber&&this.sequencerEngine.midi.updateSteps(r),{trackNumber:this.subSequence.isTrack?this.subSequence.id:this.trackNumber,steps:r,pianoRollSteps:s,trackFills:c,stepToId:u,pianoRollPositions:i,pianoRollDurations:o,muted:this.track.muted}}},{key:"getTrackStepsAction",value:function(){var e=this.store.getState().sequencer.resolution,t=this.length(e),n=new Array(t).fill(!1),a=e.isTriplet?this.tripletStepBucketsMatrix:this.stepBucketsMatrix,r=e.isTriplet?new ht(32,!0):new ht(32,!1);for(var s in a){n[Math.floor(e.transformStepAtResolution2(s,r))]=!0}return n}},{key:"getEasyPattern",value:function(){return new va(this,this.trackData)}},{key:"split",value:function(t){var n=t-this.startStep,a=(this.length(),new e(this.sequencerEngine,this.track));return a.stepBuckets=this.stepBuckets.slice(n),this.stepBuckets=this.stepBuckets.slice(0,n),a.startStep=t,this.syncBuckets(),a.syncBuckets(),a}},{key:"overlapsStep",value:function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?e>=this.startStep&&e<=this.startStep+this.length():e>=this.startStep&&e<this.startStep+this.length()}},{key:"addToStart",value:function(e){for(var t=[],n=0;n<e;n++)t.push(new ct(this.track));this.stepBuckets=[].concat(t,Object(ge.a)(this.stepBuckets)),this.syncBuckets()}},{key:"cutFromStart",value:function(e){this.stepBuckets=this.stepBuckets.slice(e),this.syncBuckets()}},{key:"startStep",set:function(e){e<0||(this._startStep=e,void 0!==e&&this.sequencerEngine.store.dispatch(Object(w.E)(this.track.subSequence.id,this.id,e)))},get:function(){return this._startStep}},{key:"step",get:function(){return this._startStep}},{key:"duration",get:function(){return this.length()}},{key:"endStep",get:function(){return this._startStep+this.length()}},{key:"trackPatternSteps",get:function(){var e=this.subSequence.isTrack?this.subSequence.id:this.trackNumber;return this.sequencerEngine.state.tracks.trackPatternSteps[e]||{}}},{key:"subSequence",get:function(){return this.track.subSequence}},{key:"trackNumber",get:function(){return this.track.trackNumber}},{key:"trackData",get:function(){return this.track.trackData}}]),e}(),wr=function(){function e(t,n){Object(o.a)(this,e),this.sequencerEngine=t,this.subSequence=n,this.initSteps()}return Object(c.a)(e,[{key:"initSteps",value:function(){for(var e in this.patterns=[new Or(this.sequencerEngine)],this.pattern=this.patterns[0],this.pattern.stepBuckets){var t=this.pattern.stepBuckets[e];for(var n in t.steps)t.steps[n].on=!0}this.currentPattern=0}},{key:"switchToPattern",value:function(e){if(e>=0&&e<this.patterns.length){var t=this.patterns[e];this.pattern=t,this.currentPattern=e}}},{key:"newPattern",value:function(){var e=this.pattern.getCopy();this.patterns.push(e);this.patterns.length}},{key:"deletePattern",value:function(e){this.patterns.splice(e,1)}},{key:"getBucket",value:function(e,t){return e.getBucket(t)}}]),e}(),Cr=function(){function e(t,n,a,r){Object(o.a)(this,e),this.store=t.store,this.sequencerEngine=t,this.number=r,this.lfo=new jn(t,a,(new Kn).forLFOTrack(this,n),r),this.lfo.lfoMin=-100,this.lfo.lfoMax=100}return Object(c.a)(e,[{key:"start",value:function(){this.lfo.start()}},{key:"stop",value:function(){this.lfo.stop()}},{key:"getName",value:function(){return"LFO "+this.number}},{key:"getJson",value:function(){return this.lfo.getJson()}}]),e}();var Pr=function(){function e(t,n){Object(o.a)(this,e),this.sequencerEngine=t,this.subSequence=n,this.store=t.store,this.lfos=function(e,t){var n=[];return n.push(new Cr(e,t,e.mixSession,1)),n.push(new Cr(e,t,e.mixSession,2)),n.push(new Cr(e,t,e.mixSession,3)),n.push(new Cr(e,t,e.mixSession,4)),n}(t,this),this.currentPattern=0}return Object(c.a)(e,[{key:"switchToPattern",value:function(e){this.currentPattern=e,this.updateRedux()}},{key:"updateRedux",value:function(){this.getAllPatternLockedParameters().forEach(function(e){return e.updateRedux()})}},{key:"deletePattern",value:function(e){var t=this.patternLocks;this.store.dispatch(Object(w.Ob)(this.subSequence.id,_t(e,t)))}},{key:"movePatternTo",value:function(e,t){var n=this.patternLocks;this.store.dispatch(Object(w.Ob)(this.subSequence.id,zt(e,t,n)))}},{key:"getAllPatternLockedParameters",value:function(){var e=[];return this.lfos.forEach(function(t){return t.lfo.parameters.filter(function(e){return e.hasPatternLockedValues()}).forEach(function(t){return e.push(t)})}),e}},{key:"newPattern",value:function(e){var t=this,n=e-1;this.getAllPatternLockedParameters().forEach(function(e){return e.newPattern(t.currentPattern,n)});var a=this.patternLocks;a[n]=this.patternLocked,this.store.dispatch(Object(w.Ob)(this.subSequence.id,a))}},{key:"togglePatternLocked",value:function(){this.patternLocked=!this.patternLocked}},{key:"start",value:function(){for(var e in this.lfos){this.lfos[e].start()}}},{key:"stop",value:function(){for(var e in this.lfos){this.lfos[e].stop()}}},{key:"onBPMUpdated",value:function(){this.lfos.forEach(function(e){return e.lfo.onBPMUpdated()})}},{key:"patternLocks",get:function(){var e=this.store.getState().tracks.lfoPatternLocks[this.subSequence.id]||{};return Object(X.a)({},e)}},{key:"patternLocked",get:function(){return this.patternLocks[this.currentPattern]||!1},set:function(e){var t=this.patternLocks;t[this.currentPattern]=e,this.store.dispatch(Object(w.Ob)(this.subSequence.id,t)),this.updateRedux()}}]),e}(),Tr=0,jr=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(o.a)(this,e),this.sequencerEngine=t,this.store=t.store,this.isTrack=n,this.id=Tr++,this.groups=new la(t.channelMixer,t.sends,t,this),this.lfosTrack=new Pr(t,this),this.envelopesTrack=new da(t,this),this.tracks=[],this.mix=new vr(t,this),this.masterStepManager=new wr(t,this),this.setAutomationToShow(Ot)}return Object(c.a)(e,[{key:"linearRampFade",value:function(e,t,n){this.tracks.forEach(function(a){return a.linearRampFade(e,t,n)})}},{key:"dispose",value:function(){this.tracks.forEach(function(e){return e.dispose()}),this.groups.dispose(),this.tracks=void 0,this.groups=void 0,this.lfos.forEach(function(e){return e.lfo.dispose()}),this.envelopes.forEach(function(e){return e.dispose()}),this.lfosTrack=void 0,this.envelopesTrack=void 0}},{key:"addTrack",value:function(e){e.subSequence=this,this.tracks.push(e),this.isTrack&&this.groups.addTrack(e)}},{key:"setId",value:function(e){this.id=e,Tr=e+1}},{key:"setAutomationToShow",value:function(e){this.store.dispatch(Object(w.u)(this.id,e))}},{key:"updateVolumeFromAutomation",value:function(e){var t=this.volumeAutomationMix.getValueAtStep(e,this.fadeVolume);this.looping&&e===this.loopStart?(this.mix.restart(),this.fade=t):this.fadeVolume!==t&&this.store.dispatch(Object(w.Ud)(this.id,t))}},{key:"getJson",value:function(){return{isTrack:this.isTrack}}},{key:"fromJson",value:function(e){void 0!==e.isTrack&&(this.isTrack=e.isTrack)}},{key:"fade",set:function(e){e=e||0,this.fadeVolume!==e&&(this.muted||this.tracks.forEach(function(t){return t.fade=e}),this.store.dispatch(Object(w.Ud)(this.id,e)))}},{key:"mute",set:function(e){var t=e?0:this.fadeVolume;this.tracks.forEach(function(e){return e.fade=t}),this.store.dispatch(Object(w.Vd)(this.id,e))}},{key:"channelMixer",get:function(){return this.sequencerEngine.channelMixer}},{key:"sends",get:function(){return this.sequencerEngine.sends}},{key:"lfos",get:function(){return this.lfosTrack.lfos}},{key:"envelopes",get:function(){return this.envelopesTrack.envelopes.map(function(e){return e.envelope})}},{key:"fadeVolume",get:function(){return this.store.getState().mix.subSequenceFades[this.id]||1}},{key:"volumeAutomationMix",get:function(){return this.mix.mixesByType[At]}},{key:"loopStart",get:function(){return this.store.getState().arrangement.selection.start}},{key:"looping",get:function(){return this.store.getState().arrangement.selection.start}}]),e}(),xr=function e(t,n,a){Object(o.a)(this,e),this.stepData=t,this.time=n,this.stepNumber=a},Nr=function(){function e(t,n){Object(o.a)(this,e),this.id=Object(We.uuid)(),this.track=n,this.sequencerEngine=n.sequencerEngine,this.store=this.sequencerEngine.store,this.name=t,this.parameters=[],this.enabledParameter=new Wt("enabled",this,function(e,t){return[]},{min:!1,max:!0,unit:"",defaultValue:!0}),this.registerParameter(this.enabledParameter)}return Object(c.a)(e,[{key:"toggleEnabled",value:function(){this.enabled=!this.enabled}},{key:"isEnabled",value:function(){return this.enabled}},{key:"getJson",value:function(){var e={name:this.name,enabled:this.enabled,id:this.id};for(var t in e=this.saveParameterToJson(e,"enabledParameter",this.enabledParameter),this.parameters){var n=this.parameters[t];e[n.name]=n.get();var a=n.name+"Parameter";e=this.saveParameterToJson(e,a,n)}return e}},{key:"fromJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var n in void 0===e.id||t||(this.id=e.id),this.enabled=e.enabled,this.loadParameterFromJson(e,"enabledParameter",this.enabledParameter),this.parameters){var a=this.parameters[n],r=e[a.name];void 0!==r&&a.set(r),this.loadParameterFromJson(e,a.name+"Parameter",a)}}},{key:"registerContext",value:function(e){e=e.forEffect(this),this.parameters.forEach(function(t){return t.setContext(e)})}},{key:"registerMixSession",value:function(e){this.parameters.forEach(function(t){return t.setMixSession(e)})}},{key:"registerTrack",value:function(e){this.parameters.forEach(function(t){return t.setTrack(e)})}},{key:"registerParameter",value:function(e){void 0!==e&&(e.effectName=this.name,e.setStore(this.store),this.parameters.push(e))}},{key:"saveParameterToJson",value:function(e,t,n){if(n.isConnectedToAnyModulator()||Object.keys(n.patternToValue).length>0){var a=Object(X.a)({},e);return a[t]=n.getJson(),a}return e}},{key:"loadParameterFromJson",value:function(e,t,n){t in e&&n.fromJson(e[t],this.sequencerEngine)}},{key:"enabled",get:function(){return this.enabledParameter.get()},set:function(e){this.enabledParameter.set(e)}}]),e}(),qr=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,e,n))).initCache(),a.triggers=[],a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"registerContext",value:function(e){e=e.forMidiEffect(this),this.parameters.forEach(function(t){return t.setContext(e)})}},{key:"isRealTime",value:function(){return!0}},{key:"isMidiEffect",value:function(){return!0}},{key:"needsStableLookAhead",value:function(){return!1}},{key:"onNewStep",value:function(){this.clear()}},{key:"clear",value:function(){this.triggers=[]}},{key:"input",value:function(e){this.triggers.push(e)}},{key:"output",value:function(){}},{key:"removeNote",value:function(){}},{key:"getCopy",value:function(e){return this}},{key:"addNote",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=this.getStep(this.track.trackData,e,null,!1);a.velocity=this.track.trackData.velocity,a.duration=null,a.transpose=e,a.slice=t,this.input(new xr(a,0,n),!0)}},{key:"getStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.transpose,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.duration,a=void 0;return!(arguments.length>3&&void 0!==arguments[3])||arguments[3]?(a=this.cachedSteps[this.cacheIndex],this.cacheIndex=(this.cacheIndex+1)%this.cachedSteps.length):a=new ot(void 0,void 0,void 0,this.track),a.transpose=t,a.velocity=e.velocity,a.duration=n,a.attack=e.attack,a.release=e.release,a.start=e.start,a.chop=e.chop,a.pitchAttack=e.pitchAttack,a.pitchSustain=e.pitchSustain,a.pitchRelease=e.pitchRelease,a.pitchDecay=e.pitchDecay,a.slice=e.slice,a.reverse=e.reverse,a.panning=e.panning,a.selectedRecording=e.selectedRecording,a}},{key:"initCache",value:function(){this.cachedSteps=[];for(var e=0;e<16;e++){var t=new ot(void 0,void 0,void 0,this.track);t.loadDefaults(),this.cachedSteps.push(t)}this.cacheIndex=0}}]),t}(Nr),Mr=new ht(32,!1),Dr={};function Ar(e,t){var n=Dr[e];if(void 0!==n){var a=n[t.toString()];if(void 0!==a)return a}else Dr[e]={};var r=function(e,t){var n=t.transformStepAtResolution2(e,Mr),a=t.transformStepAtResolution2(e+1,Mr),r=[];Math.floor(n)==n?r.push(n):a-n>1&&r.push(Math.ceil(n));Math.floor(a)>Math.floor(n)&&Math.floor(a)!=a&&r.push(Math.floor(a));for(var s=[],i=0;i<r.length;i++){var o=r[i],c=Mr.transformStepAtResolution2(o,t),u=c-e;s.push({step:o,time:new q.a.Time("32n")*u})}return s}(e,t);return Dr[e][t.toString()]=r,r}var Rr="DOWN",Ir="UP",Lr=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Arpeggiator",e))).notesToRemove=[],n.arpRateParameter=new Wt("arpRate",Object(p.a)(n),function(e,t){return t},{min:new ht(4,!1),max:new ht(32,!1),builder:function(e){return new ht(16,!1).fromJson(e)},unit:"",defaultValue:new ht(16,!1)}),n.registerParameter(n.arpRateParameter),n.arpOctavesParameter=new Wt("arpOctaves",Object(p.a)(n),function(e,t){return t},{min:0,max:8,unit:"",defaultValue:1}),n.registerParameter(n.arpOctavesParameter),n.arpDirectionParameter=new Wt("arpDirection",Object(p.a)(n),function(e,t){return t},{min:Rr,max:Ir,unit:"",defaultValue:Rr}),n.registerParameter(n.arpDirectionParameter),n.arpDurationFactorParameter=new Wt("arpDurationFactor",Object(p.a)(n),function(e,t){return t},{min:1e-4,max:8,unit:"x",defaultValue:1}),n.registerParameter(n.arpDurationFactorParameter),n.arpRepeatParameter=new Wt("arpRepeatFactor",Object(p.a)(n),function(e,t){return t},{min:1,max:8,unit:"x",defaultValue:1}),n.registerParameter(n.arpRepeatParameter),n.noteToDuration={},n.notes=[],n.index=0,n.repeatIndex=0,n.currentOctave=0,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isRealTime",value:function(){return!1}},{key:"onNewStep",value:function(){}},{key:"clear",value:function(){this.noteToDuration={},this.notesToRemove=[],this.notes=[],this.repeatIndex=0,this.index=0,this.arpDirection===Rr?this.currentOctave=this.arpOctaves:this.currentOctave=0}},{key:"input",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.stepData.duration,a=e.stepData.transpose;t||(a in this.noteToDuration?this.noteToDuration[a]=this.noteToDuration[a]+2*n:this.noteToDuration[a]=2*n),this.getIndexOfTrigger(e)<0&&(e.stepData=this.getStep(e.stepData,a,n,!1),this.notes.push(e),this.notes=this.notes.sort(function(e,t){return e.stepData.transpose-t.stepData.transpose}),this.arpDirection===Rr&&this.notes.reverse())}},{key:"output",value:function(e,t,n){var a=this,r=this.getNextTriggers(t).map(function(t){return t.time+=e,t.stepNumber=n,t});return this.notesToRemove.forEach(function(e){return a.actuallyRemoveNote(e)}),this.notesToRemove=[],r}},{key:"getIndexOfTrigger",value:function(e){for(var t in this.notes)if(this.notes[t].stepData.transpose===e.stepData.transpose)return t;return-1}},{key:"actuallyRemoveNote",value:function(e){var t=-1;for(var n in this.notes)if(e===this.notes[n].stepData.transpose){t=n;break}t>-1&&this.notes.splice(t,1),this.index>=this.notes.length&&(this.index=0,this.currentOctave=0),0===this.notes.length&&this.clear()}},{key:"removeNote",value:function(e){this.notesToRemove.push(e)}},{key:"nextNote",value:function(e){if(0!=this.notes.length){var t=this.notes[this.index],n=t.stepData.transpose;n+=12*this.currentOctave,this.repeatIndex++,this.repeatIndex>=this.arpRepeat&&(this.repeatIndex=0,this.index++),this.index>=this.notes.length&&(this.index=0,this.arpDirection===Ir?this.currentOctave=(this.currentOctave+1)%(e+1):this.arpDirection===Rr&&(this.currentOctave=(this.currentOctave-1)%(e+1),this.currentOctave<0&&(this.currentOctave=e)));var a=this.getStep(t.stepData,n,this.track.trackData.duration*this.arpDurationFactor);return new xr(a,t.time,t.stepNumber)}}},{key:"getNextTriggers",value:function(e){var t=this,n=Ar(e,this.arpRate).map(function(e){var n=t.nextNote(t.arpOctaves);return void 0!==n&&(n.time=e.time),n}).filter(function(e){return void 0!==e});for(var a in void 0===window.timeB&&(window.timeB=0,window.timeBCount=0),this.noteToDuration)this.noteToDuration[a]-=1,this.noteToDuration[a]<=0&&(delete this.noteToDuration[a],this.removeNote(parseInt(a)));return 0===Object.keys(this.noteToDuration).length&&0===this.notes.length&&this.clear(),n}},{key:"getCopy",value:function(e){var n=new t(e);return n.fromJson(this.getJson(),!0),n}},{key:"getJson",value:function(){return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{arpRate:this.arpRate.getJson()})}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),this.arpRate=new ht(16,!1).fromJson(e.arpRate)}},{key:"getCopy",value:function(e){var n=new t(e);return n.fromJson(this.getJson(),!0),n}},{key:"arpRate",get:function(){return this.arpRateParameter.get()},set:function(e){this.arpRateParameter.set(e)}},{key:"arpOctaves",get:function(){return this.arpOctavesParameter.get()}},{key:"arpDirection",get:function(){return this.arpDirectionParameter.get()}},{key:"arpDurationFactor",get:function(){return this.arpDurationFactorParameter.get()}},{key:"arpRepeat",get:function(){return this.arpRepeatParameter.get()}}]),t}(qr),Fr=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Harmony",e))).pitchParameter=new Wt("pitch",Object(p.a)(n),function(e,t){return t},{min:-32,max:32,unit:"",defaultValue:5}),n.registerParameter(n.pitchParameter),n.timingOffsetParameter=new Wt("timingOffset",Object(p.a)(n),function(e,t){return t},{min:0,max:4,unit:"",defaultValue:0}),n.registerParameter(n.timingOffsetParameter),n.velocityParameter=new Wt("velocity",Object(p.a)(n),function(e,t){return t},{min:0,max:1,unit:"",defaultValue:1}),n.registerParameter(n.velocityParameter),n.probabilityParameter=new Wt("probability",Object(p.a)(n),function(e,t){return t},{min:0,max:100,unit:"",defaultValue:100}),n.registerParameter(n.probabilityParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"output",value:function(){var e=[];for(var t in this.triggers){var n=this.triggers[t];if(e.push(n),this.probability/100>=Math.random()){var a=n.stepData.getCopy(!0,!1,!0,!0,!1);a.transpose+=this.pitch,a.velocity=this.velocity;var r=n.time+this.timingOffset*new q.a.Time("32n").toMilliseconds()/1e3;e.push(new xr(a,r,n.stepNumber))}}return e}},{key:"getCopy",value:function(e){var n=new t(e);return n.fromJson(this.getJson(),!0),n}},{key:"pitch",get:function(){return this.pitchParameter.get()}},{key:"velocity",get:function(){return this.velocityParameter.get()}},{key:"timingOffset",get:function(){return this.timingOffsetParameter.get()}},{key:"probability",get:function(){return this.probabilityParameter.get()}}]),t}(qr),Vr=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Parameterizer",e))).parameter=void 0,n.factorParameter=new Wt("factor",Object(p.a)(n),function(e,t){return t},{min:0,max:1,unit:"",defaultValue:1}),n.registerParameter(n.factorParameter),n.offsetParameter=new Wt("offset",Object(p.a)(n),function(e,t){return t},{min:-16,max:16,unit:"",defaultValue:0}),n.registerParameter(n.offsetParameter),n.probabilityParameter=new Wt("probability",Object(p.a)(n),function(e,t){return t},{min:0,max:100,unit:"",defaultValue:100}),n.registerParameter(n.probabilityParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getCopy",value:function(e){var n=new t(e);return n.fromJson(this.getJson(),!0),n}},{key:"getAvailableParameters",value:function(){return[this.track.trackData.durationParameter,this.track.trackData.chopParameter,this.track.trackData.velocityParameter,this.track.trackData.transposeParameter,this.track.trackData.startParameter,this.track.trackData.attackParameter,this.track.trackData.releaseParameter,this.track.trackData.pitchAttackParameter,this.track.trackData.pitchDecayParameter,this.track.trackData.pitchSustainParameter,this.track.trackData.pitchReleaseParameter]}},{key:"output",value:function(){var e=this;if(void 0===this.parameter)return this.triggers;for(var t in this.triggers){var n=this.triggers[t],a=this.getStep(n.stepData,void 0,void 0,!0),r=a.parameters.filter(function(t){return t.name===e.parameter.name});if(r.length>0){var s=r[0].get();Math.random()<this.probability/100&&r[0].set(s*this.factor+this.offset)}n.stepData=a}return this.triggers}},{key:"getJson",value:function(){return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{parameter:void 0===this.parameter?void 0:this.parameter.name})}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n);var a=this.getAvailableParameters();void 0!==e.parameter&&(this.parameter=a.filter(function(t){return t.name===e.parameter})[0])}},{key:"factor",set:function(e){this.factorParameter.set(e)},get:function(){return this.factorParameter.get()}},{key:"offset",set:function(e){this.offsetParameter.set(e)},get:function(){return this.offsetParameter.get()}},{key:"probability",set:function(e){this.probabilityParameter.set(e)},get:function(){return this.probabilityParameter.get()}}]),t}(qr),Br=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Timing",e))).oddOffsetParameter=new Wt("oddTiming",Object(p.a)(n),function(e,t){return t},{min:0,max:4,unit:"1/32th",defaultValue:0}),n.registerParameter(n.oddOffsetParameter),n.evenOffsetParameter=new Wt("evenTiming",Object(p.a)(n),function(e,t){return t},{min:0,max:4,unit:"1/32th",defaultValue:0}),n.registerParameter(n.evenOffsetParameter),n.probabilityParameter=new Wt("probability",Object(p.a)(n),function(e,t){return t},{min:0,max:100,unit:"",defaultValue:100}),n.registerParameter(n.probabilityParameter),n.resolutionParameter=new Wt("resolution",Object(p.a)(n),function(e,t){return t},{min:1,max:32,unit:"",defaultValue:2}),n.registerParameter(n.resolutionParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getCopy",value:function(e){var n=new t(e);return n.fromJson(this.getJson()),n}},{key:"needsStableLookAhead",value:function(){return!0}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),e.oddOffset&&(this.oddOffset=e.oddOffset),e.evenOffset&&(this.evenOffset=e.evenOffset)}},{key:"output",value:function(){for(var e in this.triggers){var t=this.triggers[e],n=t.time;if(Math.random()<=this.probability/100){var a=Math.floor(t.stepNumber/this.resolution)%2==0?this.evenOffset:this.oddOffset;t.time=n+a*new q.a.Time("32n").toMilliseconds()/1e3}}return this.triggers}},{key:"getCopy",value:function(e){var n=new t(e);return n.fromJson(this.getJson(),!0),n}},{key:"oddOffset",get:function(){return this.oddOffsetParameter.get()},set:function(e){this.oddOffsetParameter.set(e)}},{key:"evenOffset",get:function(){return this.evenOffsetParameter.get()},set:function(e){this.evenOffsetParameter.set(e)}},{key:"probability",set:function(e){this.probabilityParameter.set(e)},get:function(){return this.probabilityParameter.get()}},{key:"resolution",get:function(){return this.resolutionParameter.get()},set:function(e){return this.resolutionParameter.set(e)}}]),t}(qr),Ur=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Midi Outputter",e))).trackOutputParameter=new Wt("trackOutput",Object(p.a)(n),function(e,t){return t},{min:0,max:16,unit:"",defaultValue:void 0}),n.registerParameter(n.trackOutputParameter),n.probabilityParameter=new Wt("probability",Object(p.a)(n),function(e,t){return t},{min:0,max:100,unit:"",defaultValue:100}),n.registerParameter(n.probabilityParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getCopy",value:function(e){var n=new t(e);return n.fromJson(this.getJson(),!0),n}},{key:"getAvailableParameters",value:function(){return[this.track.trackData.durationParameter,this.track.trackData.chopParameter,this.track.trackData.velocityParameter,this.track.trackData.transposeParameter,this.track.trackData.attackParameter,this.track.trackData.releaseParameter,this.track.trackData.pitchAttackParameter,this.track.trackData.pitchDecayParameter,this.track.trackData.pitchSustainParameter,this.track.trackData.pitchReleaseParameter]}},{key:"output",value:function(e,t,n){if(Math.random()<this.probability/100&&this.trackOutput){var a=this.track.subSequence.tracks[this.trackOutput];if(void 0===a)return this.triggers;for(var r in a.midiEffects.onNewStep(),this.triggers)a.midiEffects.input(this.triggers[r].stepData.getCopy(!0,!1),this.triggers[r].time,n);a.midiEffects.output(e,t,n).forEach(function(e){return a.trigger(e.stepData,e.time)})}return this.triggers}},{key:"trackOutput",set:function(e){this.trackOutputParameter.set(e)},get:function(){return this.trackOutputParameter.get()}},{key:"probability",set:function(e){this.probabilityParameter.set(e)},get:function(){return this.probabilityParameter.get()}}]),t}(qr),Hr=new q.a.Time("32n"),Jr=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Chord Rhythm",e))).durationFactorParameter=new Wt("durationFactor",Object(p.a)(n),function(e,t){return[]},{defaultValue:1,min:0,max:2,unit:""}),n.registerParameter(n.durationFactorParameter),n.oddDelayTimeParameter=new Wt("oddDelayTime",Object(p.a)(n),function(e,t){return[]},{defaultValue:1,min:.01,max:16,unit:""}),n.registerParameter(n.oddDelayTimeParameter),n.evenDelayTimeParameter=new Wt("evenDelayTime",Object(p.a)(n),function(e,t){return[]},{defaultValue:1,min:.01,max:16,unit:""}),n.registerParameter(n.evenDelayTimeParameter),n.delayTimeFactorParameter=new Wt("delayTimeFactor",Object(p.a)(n),function(e,t){return[]},{defaultValue:1,min:.01,max:4,unit:""}),n.registerParameter(n.delayTimeFactorParameter),n.evenVelocityParameter=new Wt("evenVelocity",Object(p.a)(n),function(e,t){return[]},{defaultValue:1,min:.01,max:1,unit:""}),n.registerParameter(n.evenVelocityParameter),n.oddVelocityParameter=new Wt("oddVelocity",Object(p.a)(n),function(e,t){return[]},{defaultValue:1,min:.01,max:1,unit:""}),n.registerParameter(n.oddVelocityParameter),n.repeatsParameter=new Wt("repeats",Object(p.a)(n),function(e,t){return[]},{defaultValue:1,min:1,max:8,unit:""}),n.registerParameter(n.repeatsParameter),n.syncedParameter=new Wt("synced",Object(p.a)(n),function(e,t){return[]},{defaultValue:!0,min:!1,max:!0,unit:""}),n.registerParameter(n.syncedParameter),n.velocitySpreadParameter=new Wt("velocitySpread",Object(p.a)(n),function(e,t){return[]},{defaultValue:50,min:0,max:100,unit:""}),n.registerParameter(n.velocitySpreadParameter),n.velocityParameter=new Wt("velocity",Object(p.a)(n),function(e,t){return[]},{defaultValue:1,min:0,max:1,unit:""}),n.registerParameter(n.velocityParameter),n.delays=[],n.liveTriggers=[],n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onNewStep",value:function(){this.triggers=[]}},{key:"removeNote",value:function(e,t){arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.gated;this.delays=this.delays.filter(function(t){return t.trigger.stepData.transpose!==e})}},{key:"input",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.liveTriggers.push(e):Object(ze.a)(Object(l.a)(t.prototype),"input",this).call(this,e)}},{key:"clear",value:function(){this.triggers=[],this.delays=[]}},{key:"getDelayTrigger",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=(e.time-t)/Hr;return a=n?0:a,{stepNumber:e.stepNumber,stepOffset:a,trigger:this.copyTrigger(e),duration:n?void 0:e.stepData.duration,repeats:1,elapsed:0,even:!0}}},{key:"copyTrigger",value:function(e){var t=this.getStep(e.stepData,void 0,void 0,!1);return new xr(t,e.time,e.stepNUmber)}},{key:"output",value:function(e,t,n){var a=this;for(var r in this.triggers){var s=this.triggers[r];this.delays.push(this.getDelayTrigger(s,e))}for(var i in this.liveTriggers){var o=this.liveTriggers[i];o.stepNumber=t,this.delays.push(this.getDelayTrigger(o,e,!0))}var c=[],u=void 0,l=void 0,p=function(n){var r=a.delays[n],s=r.repeats/a.repeats%2==0,i=s?a.evenDelayTime:a.oddDelayTime;i*=a.delayTimeFactor;var o=s?a.evenVelocity:a.oddVelocity;if(o*=a.velocity,0===r.elapsed||a.shouldPlayDelay(r,t,r.isEven?a.evenDelayTime:a.oddDelayTime)){var p=a.getTimesToPlay(r,e,i),h=p.map(function(e){return a.getTriggerToPlay(r.trigger,e.timeToPlay,t,o,i)});c=[].concat(Object(ge.a)(c),Object(ge.a)(h)),u=t,l=p[p.length-1].offset,r.isEven=s,r.stepNumber=t,r.stepOffset=l,r.repeats++}r.elapsed++};for(var h in this.delays)p(h);return this.synced&&void 0!==u&&this.delays.forEach(function(e){e.stepNumber=u,e.stepOffset=l}),this.delays=this.delays.filter(function(e){return void 0===e.duration||e.elapsed<2*e.duration}),this.liveTriggers=[],c}},{key:"getTriggerToPlay",value:function(e,t,n,a,r){var s=this.copyTrigger(e);return s.time=t,s.stepData.duration=this.durationFactor*(r/2),s.stepNumber=n,s.stepData.velocity*=a,s}},{key:"shouldPlayDelay",value:function(e,t,n){var a=t,r=t+1,s=((e.stepNumber+e.stepOffset)%this.patternLength+n)%this.patternLength;return a<=s&&s<r}},{key:"getTimesToPlay",value:function(e,t,n){for(var a=((e.stepNumber+e.stepOffset)%this.patternLength+n)%this.patternLength,r=a-Math.floor(a),s=[];r<1;r+=n)s.push({timeToPlay:t+r*Hr,offset:r});return s}},{key:"isRealTime",value:function(){return!1}},{key:"getCopy",value:function(e){var n=new t(e);return n.fromJson(this.getJson(),!0),n}},{key:"oddDelayTime",get:function(){return this.oddDelayTimeParameter.get()}},{key:"synced",get:function(){return this.syncedParameter.get()}},{key:"repeats",get:function(){return this.repeatsParameter.get()}},{key:"evenDelayTime",get:function(){return this.evenDelayTimeParameter.get()}},{key:"durationFactor",get:function(){return this.durationFactorParameter.get()}},{key:"delayTimeFactor",get:function(){return this.delayTimeFactorParameter.get()}},{key:"velocitySpread",get:function(){return this.velocitySpreadParameter.get()/100}},{key:"oddVelocity",get:function(){return Math.max(0,Math.sqrt(this.velocitySpread)-.2)}},{key:"velocity",get:function(){return this.velocityParameter.get()}},{key:"evenVelocity",get:function(){var e=1-this.velocitySpread;return Math.max(0,Math.sqrt(e)-.2)}},{key:"patternLength",get:function(){return this.track.length}}]),t}(qr),Gr=(new q.a.Time("32n"),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Chord Sculptor",e))).liveTriggers=[],n.linesParameter=new Wt("lines",Object(p.a)(n),function(e,t){return n.lines=t},{defaultValue:[],min:[],max:[],unit:""}),n.registerParameter(n.linesParameter),n.effects=[],n.rawLines=[],n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"clear",value:function(){this.effects.forEach(function(e){return e.clear()})}},{key:"onNewStep",value:function(){this.effects.forEach(function(e){return e.onNewStep()})}},{key:"removeNote",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.gated;this.effects.forEach(function(a){return a.removeNote(e,t,n)})}},{key:"isRealTime",value:function(){return!1}},{key:"removeNote",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.gated;this.effects.forEach(function(a){return a.removeNote(e,t,n)})}},{key:"input",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.effects.forEach(function(n){return n.input(e,t)})}},{key:"output",value:function(e,t,n){var a=[];for(var r in this.effects)a=[].concat(Object(ge.a)(a),Object(ge.a)(this.effects[r].output(e,t,n)));return a}},{key:"getCopy",value:function(e){var n=new t(e);return n.fromJson(this.getJson(),!0),n}},{key:"lines",set:function(e){this.rawLines=e;var t=[];for(var n in e){var a=e[n],r=a.x1,s=a.y1,i=a.x2,o=a.y2,c=a.brightness,u=Math.abs(Math.ceil(16*(i-r))),l=8*s,p=8*o,h=4*(r+i)/2,d=c||1,f=new Jr(this.track);f.evenDelayTimeParameter.set(l),f.oddDelayTimeParameter.set(p),f.repeatsParameter.set(u),f.durationFactorParameter.set(h),f.velocityParameter.set(d),t.push(f)}this.effects=t}}]),t}(qr)),zr=function(e){function t(e,n,a){var r;return Object(o.a)(this,t),(r=Object(u.a)(this,Object(l.a)(t).call(this,e,a,function(e,t){a.send(n,t)},{min:0,max:127,defaultValue:1}))).ccNumber=n,a.setCallback(n,function(e){r.set(e)}),r}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getJson",value:function(){var e=Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this);return e.ccNumber=this.ccNumber,e}}]),t}(Wt),_r={"Moog Minitaur":[{"VCO 2":{FREQ:17},FILTER:{CUTOFF:19,RES:21,"EG AMOUNT":22},MIX:{"VCO 1 LVL":15,"VCO 2 LVL":16}},{OSCILLATORS:{"OSC 1 SHAPE":70,"OSC 2 SHAPE":71},MOD:{"LFO RATE":3,"VCO LFO AMT":13,"VCF LFO AMT":12}},{"FILTER ENVELOPE":{ATTACK:23,"DECAY/RELEASE":24,SUSTAIN:25},"AMP ENVELOPE":{ATTACK:28,"DECAY/RELEASE":31,SUSTAIN:30}}],"Boutique SH-01A":[{VCF:{CUTOFF:74,RES:71,"ENV DEPTH":24,"MOD DEPTH":25,"KEY FOLLOW":26,"BEND DEPTH":27}},{LFO:{RATE:3,WAVEFORM:12,MODE:79}},{VCO:{"MOD DEPTH":13,RANGE:14,"PULSE WIDTH":15,"PWM SOURCE":16,"MOD SENS":17}},{VCO:{"BEND DEPTH":18,"PWM LEVEL":19,"SAW LEVEL":20,"SUB LEVEL":21,"SUB TYPE":22,"NOISE LEVEL":23}},{ENV:{ATTACK:73,DECAY:75,SUSTAIN:30,RELEASE:72},VCA:{"ENV SW":28,"ENV MODE":29}},{PORTAMENTO:{"PORTAMENTO MODE":31,PORTAMENTO:65,"PORTAMENTO TIME":5},MISC:{"TRANSPOSE SW":77,"NOISE MODE":78,TUNE:76}}]},Wr={"MIDI Mix":{note:{0:{PATTERN_SWITCH:1,SEQUENCE_ROLL:3,PREVIOUS_PATTERN:25,NEXT_PATTERN:26},1:{PATTERN_SWITCH:4,SEQUENCE_ROLL:6},2:{PATTERN_SWITCH:7,SEQUENCE_ROLL:9},3:{PATTERN_SWITCH:10,SEQUENCE_ROLL:12},4:{PATTERN_SWITCH:13,SEQUENCE_ROLL:15},5:{PATTERN_SWITCH:16,SEQUENCE_ROLL:18},6:{PATTERN_SWITCH:19,SEQUENCE_ROLL:21},7:{PATTERN_SWITCH:22,SEQUENCE_ROLL:24}},cc:{0:{KNOB_1:16,KNOB_2:17,KNOB_3:18,VOLUME:19},1:{KNOB_1:20,KNOB_2:21,KNOB_3:22,VOLUME:23},2:{KNOB_1:24,KNOB_2:25,KNOB_3:26,VOLUME:27},3:{KNOB_1:28,KNOB_2:29,KNOB_3:30,VOLUME:31},4:{KNOB_1:46,KNOB_2:47,KNOB_3:48,VOLUME:49},5:{KNOB_1:50,KNOB_2:51,KNOB_3:52,VOLUME:53},6:{KNOB_1:54,KNOB_2:55,KNOB_3:56,VOLUME:57},7:{KNOB_1:58,KNOB_2:59,KNOB_3:60,VOLUME:61},MASTER:62}},"Komplete Kontrol M DAW":{actions:{PLAY:94,RECORD:95,CLEAR:93}}},Kr=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Midi Interface",e))).ccParameters=[],n.midiOutput=void 0,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"setConfig",value:function(e,t){if(this.midiOutput=e,this.midiCC=this.track.sequencerEngine.midi.deviceToMidiCC[e.name],this.midiDeviceName=e.name,void 0!==this.midiCC)for(var n in t){var a=t[n],r={};for(var s in a){var i=a[s];for(var o in r[s]={},i){var c=i[o],u=new zr(o,c,this.midiCC);this.registerParameter(u),r[s][o]=u}}this.ccParameters.push(r)}}},{key:"getCopy",value:function(e){var n=new t(e);return n.fromJson(this.getJson(),!0),n}},{key:"output",value:function(e,t,n){return this.triggers}},{key:"getJson",value:function(){var e=Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this);e.midiOutput=this.midiOutput.name;var n=[];for(var a in this.ccParameters){var r=this.ccParameters[a],s={};for(var i in r){var o=r[i],c={};for(var u in o){var p=o[u];c[p.name]=p.getJson()}s[i]=c}n.push(s)}return e.config=n,e}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n);var a=this.track.sequencerEngine.midi;if(void 0!==a){var r=a.controllerOutputs.filter(function(t){return t.name===e.midiOutput})[0];if(void 0!==r){for(var s in this.midiOutput=r,this.track.addMidiOutput(r,!0),this.midiCC=this.track.sequencerEngine.midi.deviceToMidiCC[r.name],e.config){var i=e.config[s];for(var o in i){var c=i[o];for(var u in c){var p=c[u],h=new zr(u,p.ccNumber,this.midiCC);h.fromJson(p,this.track.sequencerEngine),this.registerParameter(h),c[u]=h}}}this.ccParameters=e.config}}}}]),t}(qr),Yr=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Midi Delay",e))).delayTimeParameter=new Wt("delayTime",Object(p.a)(n),function(e,t){return t},{min:1,max:64,unit:"",defaultValue:1}),n.registerParameter(n.delayTimeParameter),n.repeatsParameter=new Wt("repeats",Object(p.a)(n),function(e,t){return[]},{defaultValue:1,min:1,max:32,unit:"bars"}),n.registerParameter(n.repeatsParameter),n.wetParameter=new Wt("wet",Object(p.a)(n),function(e,t){return t},{min:0,max:1,unit:"",defaultValue:.5}),n.registerParameter(n.wetParameter),n.delays=[],n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onNewStep",value:function(){this.triggers=[]}},{key:"clear",value:function(){this.triggers=[],this.delays=[]}},{key:"input",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.delays.length>8&&(this.delays=this.delays.slice(this.delays.length-8)),this.delays.push({stepNumber:e.stepNumber,trigger:this.copyTrigger(e),repeats:0,elapsed:0}),this.triggers.push(e)}},{key:"copyTrigger",value:function(e){var t=this.getStep(e.stepData,void 0,void 0,!1);return new xr(t,e.time,e.stepNUmber)}},{key:"output",value:function(e,t,n){var a=[],r=[];for(var s in this.delays){var i=this.delays[s];if(i.elapsed++,this.shouldPlayDelay(t,i)){var o=this.getStep(i.trigger.stepData,void 0,void 0,!1);o.velocity=o.velocity*(this.repeats-i.repeats)/this.repeats,o.velocity*=this.wet;var c=new xr(o,e,t);if(a.push(c),i.repeats++,i.repeats>=this.repeats)continue}r.push(i)}var u=this.triggers;for(var l in u){var p=this.getStep(u[l].stepData);p.velocity*=1-this.wet,u[l].stepData=p}return a=a.concat(u),this.delays=r,a}},{key:"shouldPlayDelay",value:function(e,t){var n=t.elapsed-1;return 0!==n&&n%Math.floor(this.delayTime)===0}},{key:"getCopy",value:function(e){var n=new t(e);return n.fromJson(this.getJson(),!0),n}},{key:"wet",get:function(){return this.wetParameter.get()}},{key:"repeats",get:function(){return this.repeatsParameter.get()}},{key:"delayTime",get:function(){return this.delayTimeParameter.get()},set:function(e){this.delayTimeParameter.set(e)}}]),t}(qr),Qr=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Alternate Tuning",e))).tuningMappings={0:.1,1:.5,2:.8,3:.9,4:1.2,5:1.5,6:2.3,7:2.9,8:3.3,9:4.2,10:5.1,11:7},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"output",value:function(){for(var e in this.triggers){var t=this.getStep(this.triggers[e].stepData,this.getTranspose(this.triggers[e].stepData.transpose),this.triggers[e].stepData.duration,!1);this.triggers[e].stepData=t}return this.triggers}},{key:"getTranspose",value:function(e){var t=12*Math.floor(e/12);return(e%=12)<0&&(e=12+e),e in this.tuningMappings?t+this.tuningMappings[e]:e}},{key:"getJson",value:function(){return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{tuningMappings:this.tuningMappings})}},{key:"fromJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e,n),this.tuningMappings=e.tuningMappings}},{key:"getCopy",value:function(e){var n=new t(e);return n.fromJson(this.getJson(),!0),n}}]),t}(qr);function Xr(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}var Zr=function(e){function t(e){var n,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Object(o.a)(this,t),n=Object(u.a)(this,Object(l.a)(t).call(this,"Warp",e)),a&&(n.enabledParameter=new Wt("enabled",Object(p.a)(n),function(e,t){return n.onEnable(t)},{min:!1,max:!0,unit:"",defaultValue:!0}),n.registerParameter(n.enabledParameter)),n.warpLengthParameter=new Wt("warpLength",Object(p.a)(n),function(e,t){return[]},{defaultValue:1,min:.25,max:16,unit:"bars"}),n.registerParameter(n.warpLengthParameter),n.warpFactorParameter=new Wt("warpFactor",Object(p.a)(n),function(e,t){return[]},{defaultValue:2,min:1,max:8,unit:""}),n.registerParameter(n.warpFactorParameter),n.glideParameter=new Wt("glide",Object(p.a)(n),function(e,t){return[]},{defaultValue:1,min:0,max:4,unit:""}),n.registerParameter(n.glideParameter),n.resolutionParameter=new Wt("resolution",Object(p.a)(n),function(e,t){return t},{min:new ht(4,!1),max:new ht(32,!1),unit:"",defaultValue:new ht(16,!1)}),n.registerParameter(n.resolutionParameter),n.loopLengthParameter=new Wt("loopLength",Object(p.a)(n),function(e,t){return[]},{defaultValue:100,min:0,max:100,unit:"%"}),n.registerParameter(n.loopLengthParameter),n.durationFactorParameter=new Wt("durationFactor",Object(p.a)(n),function(e,t){return[]},{defaultValue:1,min:0,max:2,unit:""}),n.registerParameter(n.durationFactorParameter),n.smoothnessParameter=new Wt("smoothness",Object(p.a)(n),function(e,t){return[]},{defaultValue:1,min:1,max:20,unit:""}),n.registerParameter(n.smoothnessParameter),n.sliceRetriggerParameter=new Wt("sliceRetrigger",Object(p.a)(n),function(e,t){return[]},{defaultValue:!0,min:!1,max:!0,unit:""}),n.registerParameter(n.sliceRetriggerParameter),n.noteToDuration={},n.noteToTrigger={},n.stepNumberTriggered=0,n.notes={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onEnable",value:function(e){this.track.sequencerEngine.store.dispatch(Object(w.qe)(this.track.subSequence.id,this.track.trackNumber,e))}},{key:"releaseAll",value:function(e){this.notes={},this.noteToTrigger={},this.noteToDuration={}}},{key:"isNothingPlaying",value:function(){return Xr(this.noteToTrigger)&&Xr(this.notes)}},{key:"input",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(ze.a)(Object(l.a)(t.prototype),"input",this).call(this,e,n);var a=e.stepNumber,r=e.stepData.transpose,s=e.stepData.slice;if(this.isNothingPlaying()&&this.sliceRetrigger&&(this.stepNumberTriggered=void 0),n)if(this.gated){var i=this.notes[r]||[];i.push(s),this.notes[r]=i}else(this.isNothingPlaying()||0==a||this.sliceRetrigger)&&(this.stepNumberTriggered=a),this.releaseAll(),this.notes[r]=[s];else{var o=2*e.stepData.duration;(!this.gated||this.track.rolling&&this.sequencerEngine.isSequenceRolling)&&(this.clear(!1),(this.sliceRetrigger||0===a)&&(this.stepNumberTriggered=a)),void 0===this.noteToDuration[r]&&(this.noteToDuration[r]=0),this.noteToDuration[r]=o,this.noteToTrigger[r]=e}}},{key:"output",value:function(e,t,n){var a=[],r=Ar(t,this.resolution);for(var s in this.noteToTrigger){var i=this.noteToTrigger[s];for(var o in r)this.getTrigger(i.stepData,s,e+r[o].time,t,n,i.stepData.slice).forEach(function(e){return a.push(e)})}for(var c in this.notes){var u=this.notes[c];for(var l in u){var p=u[l];for(var h in r)this.getTrigger(this.track.trackData,c,e+r[h].time,t,n,p).forEach(function(e){return a.push(e)})}}for(var d in this.noteToDuration)this.gated&&(this.noteToDuration[d]=Math.max(0,this.noteToDuration[d]-1),this.noteToDuration[d]<=0&&(this.track.rolling&&this.sequencerEngine.isSequenceRolling||delete this.noteToTrigger[d]));return a}},{key:"addNote",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=this.getStep(this.track.trackData,e,null,!1);a.velocity=this.track.trackData.velocity,a.duration=null,a.transpose=e,a.slice=t,this.input(new xr(a,0,n+1),!0)}},{key:"removeNote",value:function(e,t){if(!(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.gated)&&void 0!==this.notes[e]){var n=this.notes[e],a=n.indexOf(t);a>-1&&(n.splice(a,1),this.notes[e]=n),0===this.notes[e].length&&delete this.notes[e]}}},{key:"getStepPercentage",value:function(e,t){var n=e-this.stepNumberTriggered;return n<0&&(n+=this.track.length),100*n/(32*this.getSliceWarpLength(t))/(this.warpLength*this.warpFactor)}},{key:"getSliceWarpLength",value:function(){var e=this.track.tempo,t=this.track.sequencerEngine.bpm;return void 0===e||null===e||0===e?1:e/t}},{key:"getSliceLoopLength",value:function(e,t){var n=void 0;this.track.instrument?n=this.track.instrument.getSampler(e).sampler:n=this.track.getSamplers()[0];if(void 0===n)return 8;var a=n.getSlice(t).getDuration();return 100*(64*new q.a.Time("32n").toMilliseconds()/1e3)/a}},{key:"getTrigger",value:function(e,t,n,a,r,s){void 0===this.stepNumberTriggered&&(this.gated||this.sliceRetrigger||this.isNothingPlaying())&&(this.stepNumberTriggered=a),t=parseFloat(t);var i=this.getStepPercentage(a,s),o=e.duration<1?e.duration:1,c=this.getStep(e,t,o,!0);return c.start=i*this.getSliceLoopLength(t,s)/100%this.loopLength,c.slice=s,c.duration*=this.durationFactor,c.attack+=8*this.smoothness,c.release+=2*this.smoothness,[new xr(c,n,r)]}},{key:"isRealTime",value:function(){return!1}},{key:"onNewStep",value:function(){}},{key:"clear",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.noteToDuration={},this.noteToTrigger={},e&&(this.stepNumberTriggered=void 0),this.notes={}}},{key:"getNextTriggerStep",value:function(e){var t=32/this.resolution.resolution;return e+(t-e%t)}},{key:"getCopy",value:function(e){var n=new t(e);return n.fromJson(this.getJson(),!0),n}},{key:"sampler",get:function(){return this.track.getSamplers()[0]}},{key:"gated",get:function(){return this.track.gated}},{key:"durationFactor",get:function(){return this.durationFactorParameter.get()},set:function(e){return this.durationFactorParameter.set(e)}},{key:"glide",get:function(){return this.glideParameter.get()},set:function(e){return this.glideParameter.set(e)}},{key:"warpFactor",get:function(){return this.warpFactorParameter.get()},set:function(e){return this.warpFactorParameter.set(e)}},{key:"warpLength",get:function(){return this.warpLengthParameter.get()},set:function(e){return this.warpLengthParameter.set(e)}},{key:"loopLength",get:function(){return this.loopLengthParameter.get()},set:function(e){return this.loopLengthParameter.set(e)}},{key:"smoothness",get:function(){return this.smoothnessParameter.get()},set:function(e){return this.smoothnessParameter.set(e)}},{key:"resolution",get:function(){return(new ht).fromJson(this.resolutionParameter.get())},set:function(e){return this.resolutionParameter.set(e)}},{key:"sliceRetrigger",get:function(){return this.sliceRetriggerParameter.get()},set:function(e){return this.sliceRetriggerParameter.set(e)}}]),t}(qr),$r=n(439),es=Object($r.a)(function(e){return e.cycle},function(e){return e.stepNumber},function(e){return e.length},function(e,t,n){return function e(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4?arguments[4]:void 0,i=a/t.length,o=Math.floor(n%a/i);r+=i*o;for(var c=[];o<t.length&&!(n>r+i);o++){if(null!==t[o]&&Array.isArray(t[o]))n>=r&&n<r+i&&e(t[o],n,i,r,s).forEach(function(e){return c.push(e)});else if(t[o]&&t[o].cycle){if(n>=r&&n<r+i){var u=!0;"/"===t[o].operator&&(u=s%t[o].operand===0),u&&e(t[o].cycle,n,i,r,s).forEach(function(e){return c.push(e)})}}else if(n===Math.floor(r)){var l=!0;"/"===t[o].operator&&(l=s%t[o].operand===0),l&&c.push({transpose:t[o].transpose,offset:r-Math.floor(r),duration:i/2})}r+=i}return c}(ts(e),t%n,n,0,Math.floor(t/n))}),ts=function e(t){var n=[];for(var a in t)Array.isArray(t[a])?n.push(e(t[a])):n=[].concat(Object(ge.a)(n),Object(ge.a)(ns(t[a])));return n},ns=function(e){var t=void 0,n=e.operator,a=e.operand,r=(e.transpose,e.cycle);if(t=r?ts(r):e,"*"===n){for(var s=[],i=0;i<a;i++)s.push(t);return s}return[e]};function as(e,t){console.log("completeLeaf(",e,t),e.cycle?(isNaN(parseInt(e.operand))||(e.operand=parseInt(e.operand)),t.push(e)):null===e.transpose?(console.log("adding null leaf"),t.push(e)):isNaN(parseInt(e.transpose))||(e.transpose=parseInt(e.transpose),isNaN(parseInt(e.operand))||(e.operand=parseInt(e.operand)),t.push(e))}var rs=function e(t){for(var n="",a=0;a<t.length;a++)Array.isArray(t[a])?n+="["+e(t[a])+"] ":null===t[a].transpose?n+="~ ":(n+=ss(t[a]),a<t.length-1&&(n+=" "));return n},ss=function(e){return e.cycle?"["+rs(e.cycle)+"]"+e.operator+e.operand:e.operator?e.transpose+e.operator+e.operand:e.transpose},is=new q.a.Time("16n"),os=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e,!1))).name="Tidal",n.cycleParameter=new Wt("cycle",Object(p.a)(n),function(e,t){return[]},{defaultValue:void 0,min:!1,max:!0,unit:""}),n.registerParameter(n.cycleParameter),n.cycleLengthParameter=new Wt("cycleLength",Object(p.a)(n),function(e,t){return[]},{defaultValue:32,min:4,max:64,unit:""}),n.registerParameter(n.cycleLengthParameter),n.resolution=new ht(32,!1),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isRealTime",value:function(){return!1}},{key:"getTrigger",value:function(e,t,n,a,r,s){if(void 0===this.stepNumberTriggered&&(this.gated||this.sliceRetrigger||this.isNothingPlaying())&&(this.stepNumberTriggered=a),void 0!==this.cycle){var i=a-this.stepNumberTriggered;i<0&&(i+=this.track.length);var o=es({cycle:this.cycle,stepNumber:i,length:this.cycleLength}),c=[];for(var u in o){var l=o[u],p=l.transpose,h=l.offset,d=l.duration;null!==p&&((e=this.getStep(e,t,1,!0)).slice=s,e.transpose=parseFloat(e.transpose)+parseFloat(p),e.duration=d*this.durationFactor,e.on=!0,c.push(new xr(e,is*h+n,r)))}return c}}},{key:"getCopy",value:function(e){var n=new t(e);return n.fromJson(this.getJson(),!0),n}},{key:"cycleLength",get:function(){return Math.floor(this.cycleLengthParameter.get())},set:function(e){return this.cycleLengthParameter.set(e)}},{key:"cycle",get:function(){return this.cycleParameter.get()},set:function(e){return this.cycleParameter.set(e)}},{key:"cycleString",get:function(){return rs(this.cycle)}}]),t}(Zr),cs={Arpeggiator:function(e){return new Lr(e)},Parameterizer:function(e){return new Vr(e)},Timing:function(e){return new Br(e)},"Midi Outputter":function(e){return new Ur(e)},"Midi Interface":function(e){return new Kr(e)},Harmony:function(e){return new Fr(e)},"Alternate Tuning":function(e){return new Qr(e)},"Midi Delay":function(e){return new Yr(e)},"Chord Rhythm":function(e){return new Jr(e)},"Chord Sculptor":function(e){return new Gr(e)},Warp:function(e){return new Zr(e)},Tidal:function(e){return new os(e)}};function us(e,t){if(e.name in cs)return cs[e.name](t)}var ls=function(){function e(t){Object(o.a)(this,e),this.track=t,this.effects=[],this.inputedTriggers=[],this.noteToTriggers={},this.stepNumber=0}return Object(c.a)(e,[{key:"addEffect",value:function(e){this.effects=[].concat(Object(ge.a)(this.effects),[e]),this.linkEffectParameters()}},{key:"getEffectById",value:function(e){return this.effects.find(function(t){return t.id===e})}},{key:"getCopy",value:function(t){var n=new e(t);return n.effects=this.effects.map(function(e){return e.getCopy(t)}),n.linkEffectParameters(),n}},{key:"linkEffectParameters",value:function(){var e=this;this.effects.forEach(function(t){t.registerContext((new Kn).forTrack(e.track)),t.registerMixSession(e.track.mixSession),t.registerTrack(e.track)})}},{key:"deleteEffect",value:function(e){var t=this.effects.map(function(e){return e.id}).indexOf(e.id);this.effects.splice(t,1),this.effects=Object(ge.a)(this.effects)}},{key:"moveEffectTo",value:function(e,t){if(e!=t){var n=[];e>t?(n=this.effects.slice(0,t).concat([this.effects[e]]).concat(this.effects.slice(t,e)),this.effects.length>e+1&&(n=n.concat(this.effects.slice(e+1)))):(n=this.effects.slice(0,e).concat(this.effects.slice(e+1,t)).concat([this.effects[t],this.effects[e]]),this.effects.length>t+1&&(n=n.concat(this.effects.slice(t+1)))),this.effects=n}}},{key:"needsStableLookAhead",value:function(){return this.effects.some(function(e){return e.needsStableLookAhead()})}},{key:"input",value:function(e,t,n){this.inputedTriggers.push(new xr(e,t,n))}},{key:"output",value:function(e,t,n){var a=this;this.stepNumber=t;var r=this.inputedTriggers;for(var s in r.forEach(function(t){return a.triggerAttackReleasePreFXEnvelopes(e,t)}),this.effects){var i=this.effects[s];if(i.isEnabled()){for(var o in r){var c=r[o];i.input(c)}r=i.output(e,t,n)}}return this.triggerAttackReleasePostFXEnvelopes(r),r}},{key:"liveInputTrigger",value:function(e){var t=this;if(this.triggerAttackPreFXEnvelopes(void 0,e),this.isRealTime()){var n=e.transpose,a=[new xr(e,void 0,void 0)];for(var r in this.effects)if(this.effects[r].onNewStep(),this.effects[r].isEnabled()){for(var s in a)this.effects[r].input(a[s]);a=this.effects[r].output(void 0,void 0)}this.triggerAttackPostFXEnvelopes(a),a.forEach(function(e){t.track.liveTrigger(e.stepData,e.stepData.slice)}),void 0!==this.noteToTriggers[n]?this.noteToTriggers[n]=[].concat(Object(ge.a)(this.noteToTriggers[n]),Object(ge.a)(a)):this.noteToTriggers[n]=a}else this.addNote(e)}},{key:"triggerReleasePreFXEnvelopes",value:function(e){for(var t in this.track.connectedEnvelopes){this.track.connectedEnvelopes[t].envelope.triggerRelease(e)}}},{key:"triggerAttackPreFXEnvelopes",value:function(e,t){for(var n in this.track.connectedEnvelopes){var a=this.track.connectedEnvelopes[n];if("PRE_FX"===a.mode)a.envelope.triggerAttack(e,t.velocity)}}},{key:"triggerAttackReleasePreFXEnvelopes",value:function(e,t){var n=t.stepData;for(var a in this.track.connectedEnvelopes){var r=this.track.connectedEnvelopes[a];if("PRE_FX"===r.mode)r.envelope.triggerAttackRelease(this.getDuration(n.duration),e,n.velocity)}}},{key:"getDuration",value:function(e){return new q.a.Time("16n")*e}},{key:"triggerAttackPostFXEnvelopes",value:function(e){var t=this;e.forEach(function(e){for(var n in t.track.connectedEnvelopes){var a=t.track.connectedEnvelopes[n];if("POST_FX"===a.mode)a.envelope.triggerAttack(isNaN(e.time)?void 0:e.time,e.stepData.velocity)}})}},{key:"triggerAttackReleasePostFXEnvelopes",value:function(e){var t=this;e.forEach(function(e){for(var n in t.track.connectedEnvelopes){var a=t.track.connectedEnvelopes[n];if("POST_FX"===a.mode)a.envelope.triggerAttackRelease(t.getDuration(e.stepData.duration),e.time,e.stepData.velocity)}})}},{key:"liveInputRelease",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.isRealTime()){var n=this.noteToTriggers[e],a=[];for(var r in n)n[r].stepData.slice===t?this.track.liveTriggerRelease(n[r].stepData.transpose,n[r].stepData.slice):a.push(n[r]);this.noteToTriggers[e]=a,0===this.noteToTriggers[e].length&&delete this.noteToTriggers[e]}else this.removeNote(e,t);this.triggerReleasePreFXEnvelopes()}},{key:"addNote",value:function(e){var t=[new xr(e)],n=void 0;for(var a in this.effects){if(!(n=this.effects[a]).isRealTime())break;for(var r in this.effects[a].onNewStep(),t)n.input(t[r]);t=this.effects[a].output()}n.addNote(t[0].stepData.transpose,t[0].stepData.slice,this.stepNumber)}},{key:"removeNote",value:function(e,t){this.effects.forEach(function(n){return n.removeNote(e,t)})}},{key:"isRealTime",value:function(){return this.effects.filter(function(e){return e.isEnabled()}).every(function(e){return e.isRealTime()})}},{key:"isLiveRealTime",value:function(){return!!this.track.isEnabled&&this.effects.some(function(e){return"Arpeggiator"===e.name})}},{key:"onNewStep",value:function(){this.inputedTriggers=[],this.effects.forEach(function(e){return e.onNewStep()})}},{key:"clear",value:function(){this.effects.forEach(function(e){return e.clear()})}},{key:"fromJson",value:function(e){for(var t in e){var n=us(e[t],this.track);n.fromJson(e[t]),this.addEffect(n)}}},{key:"getEffectNumber",value:function(e){return this.effects.indexOf(e)}},{key:"getJson",value:function(){return this.effects.map(function(e){return e.getJson()})}},{key:"getAllParameters",value:function(){var e=[];return this.effects.forEach(function(t){return t.parameters.forEach(function(t){return e.push(t)})}),e}},{key:"getAllPatternLockedParameters",value:function(){return this.getAllParameters().filter(function(e){return e.hasPatternLockedValues()})}},{key:"mate",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=Math.max(e.effects.length,this.effects.length),a=[],r=0;r<n;r++){var s=this.effects[r],i=e.effects[r];wn(t)?i&&a.push(i.getCopy(this.track)):s&&a.push(s)}this.effects=a,this.linkEffectParameters()}}]),e}(),ps=(n(601),n(59)),hs=function(){function e(){Object(o.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"name",type:"bytes32"}],name:"syncClockMaster",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"name",type:"bytes32"}],name:"syncClockSlave",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"",type:"address"},{indexed:!0,name:"",type:"bytes32"},{indexed:!1,name:"index",type:"bytes32"}],name:"ClockSyncMaster",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"",type:"address"},{indexed:!0,name:"",type:"bytes32"},{indexed:!1,name:"index",type:"bytes32"}],name:"ClockSyncSlave",type:"event"}],this.contractAddress="0x17eafcd1dc39c8d78ff165e1dbd0fe9e82afbdc2"}return Object(c.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),ds=(n(1799),n(65),n(1808),"MASTER");n(2239);var fs=n(907),ms=(R.a.web3,function(){function e(t){Object(o.a)(this,e),this.sequencerEngine=t,this.store=this.sequencerEngine.store,this.contract=(new hs).getContract(R.a.web3),this.listeningForClockSyncs=!1,this.connected=!1,this.isInitial=!0,this.userToSignal={}}return Object(c.a)(e,[{key:"setClockType",value:function(e){this.store.dispatch(Object(w.O)(e)),this.initiator=e===ds,this.clockType=e,"NONE"!==e&&(this.setupWebRTC(),this.listeningForClockSyncs!==e&&this.listenForClockSyncs(e))}},{key:"retry",value:function(){this.setupWebRTC()}},{key:"startListening",value:function(){this.connected?console.log("is connected"):this.listenForClockSyncs("SLAVE")}},{key:"stopListening",value:function(){this.timer&&clearInterval(this.timer)}},{key:"listenForClockSyncs",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a=this;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.timer&&clearInterval(this.timer),this.listeningForClockSyncs=t,this.isInitial||this.store.dispatch(Object(w.U)("WAITING")),e.next=5,R.a.getUser();case 5:n=e.sent,this.listenCallback(t,n),this.timer=setInterval(function(){a.listenCallback(t,n)},1e4);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"listenCallback",value:function(e,t){var n=this;fetch("/getClockUsers/"+(e===ds?"SLAVE":ds)+"/"+t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(){var a=Object(g.a)(v.a.mark(function a(r){var s,i,o,c,u,l;return v.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,r.json();case 2:s=a.sent,console.log("fetch returned"),console.log(s),i=[],a.t0=v.a.keys(s);case 7:if((a.t1=a.t0()).done){a.next=22;break}if(o=a.t1.value,(c=s[o].userId)!==t){a.next=12;break}return a.abrupt("continue",7);case 12:if(u=s[o].signal,!(c in n.userToSignal)){a.next=15;break}return a.abrupt("continue",7);case 15:return n.userToSignal[c]=u,a.next=18,R.a.users.getUserName(c);case 18:l=a.sent,e===ds?(n.signal(u),n.store.dispatch(Object(w.T)(l))):(i.push(l),n.store.dispatch(Object(w.K)(i))),a.next=7;break;case 22:case"end":return a.stop()}},a)}));return function(e){return a.apply(this,arguments)}}())}},{key:"syncToUser",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.isInitial=!1,this.setClockType("SLAVE"),this.signal(this.userToSignal[t]),e.next=5,R.a.users.getUserName(t);case 5:n=e.sent,console.log("sync to user the signal for username = "+n+" is "),this.userToConnectTo=t,this.store.dispatch(Object(w.T)(n));case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setupWebRTC",value:function(){var e=this;arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(t,n){e.connected=!1,e.peer=new fs({initiator:e.initiator,trickle:!1}),e.peer.on("error",function(t){console.log(t),e.connected=!1,e.retry()}),e.peer.on("signal",function(t){return e.onSignal(t)}),e.peer.on("connect",function(){e.connected=!0,e.store.dispatch(Object(w.U)("SYNCED")),clearInterval(e.timer)}),e.peer.on("data",function(t){return e.onMessageFromPeer(t)}),e.peer.on("close",function(){e.connected=!1,e.store.dispatch(Object(w.U)("DISCONNECTED"))}),t()})}},{key:"onSignal",value:function(e){var t=this;console.log("Recieved a signal = "+e),B.a.addJson(e).then(function(){var e=Object(g.a)(v.a.mark(function e(n){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.clockType===ds?t.publishMaster(n):t.publishSlave(n,t.userToConnectTo);case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())}},{key:"onMessageFromPeer",value:function(e){var t,n=JSON.parse((t=e,String.fromCharCode.apply(null,new Uint16Array(t))));switch(n.type){case 1:this.lastTickTime=(new Date).getTime(),this.step=parseInt(n.payload.step),this.time=parseFloat(n.payload.time),this.length=parseInt(n.payload.length),this.peer.send(JSON.stringify({type:2,payload:""})),this.updateClockTickUI(this.step);break;case 2:this.peer.send(JSON.stringify({type:3}));break;case 4:this.sequencerEngine.stop();break;case 5:this.sequencerEngine.bpm=n.payload;break;case 3:this.rtt=(new Date).getTime()-this.lastTickTime;var a=this.rtt/2,r=this.step%this.sequencerEngine.length,s=this.sequencerEngine.length;if(s>this.length&&(s=this.length),r===s-2&&!this.initiator&&!this.sequencerEngine.playing&&this.isPlayScheduled){var i=this.lastTickTime-a+this.time-(new Date).getTime();i+=new q.a.Time("32n").toMilliseconds(),this.sequencerEngine.timeToCompare=(new Date).getTime()+i,this.sequencerEngine.play()}}}},{key:"updateClockTickUI",value:function(e){var t=this.length||this.sequencerEngine.length;if(0===(e%=t)%4){var n=e/t*100,a=25;n>=25&&n<50?a=50:n>=50&&n<75?a=75:n>=75&&(a=100),this.store.dispatch(Object(w.N)(a))}}},{key:"signal",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.getJson(t);case 2:n=e.sent,this.peer.signal(n);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"publishMaster",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.store.dispatch(Object(w.U)("WAITING")),e.next=3,R.a.getUser();case 3:a=e.sent,fetch("/publishClock/"+a,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({clockType:ds,signal:t})});case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"publishSlave",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.store.dispatch(Object(w.U)("WAITING")),e.next=3,R.a.getUser();case 3:a=e.sent,fetch("/publishClock/"+a,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({clockType:"SLAVE",signal:t,userToConnectTo:n})});case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"onStop",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.connected&&this.initiator&&this.peer.send(JSON.stringify({type:4}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onBPMChanged",value:function(){var e=Object(g.a)(v.a.mark(function e(t){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.connected&&this.clockType===ds&&this.peer.send(JSON.stringify({type:5,payload:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onTick",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.connected&&this.clockType===ds&&(this.peer.send(JSON.stringify({type:1,payload:{step:n,time:t,length:this.sequencerEngine.length}})),this.updateClockTickUI(n));case 1:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"state",get:function(){return this.store.getState()}},{key:"isPlayScheduled",get:function(){return this.state.clock.playScheduled}}]),e}()),vs=n(151),gs=n.n(vs),bs=n(45),ys=function(){function e(t,n){Object(o.a)(this,e),this.input=t,this.output=n,this.ccToCallback={}}return Object(c.a)(e,[{key:"setCallback",value:function(e,t){this.ccToCallback[e]=t}},{key:"send",value:function(e,t){(t=Math.round(t))<0?t=0:t>127&&(t=127),this.output.sendControlChange(e,t)}},{key:"onEvent",value:function(e){var t=this.ccToCallback[e.controller.number];t&&t(e.value)}}]),e}(),ks="FILTER",Es="DELAY",Ss="SEND_A",Os=function(){function e(t){Object(o.a)(this,e),this.action=t}return Object(c.a)(e,[{key:"onChange",value:function(e,t){this.action===Ss&&e&&e.setSendVolume(0,le(t,0,128))}}]),e}(),ws="RESOLUTION",Cs="TRACK_ROLL",Ps="SEQUENCE_ROLL",Ts={1:new ht(4,!1),2:new ht(4,!0),3:new ht(8,!1),4:new ht(8,!0),5:new ht(16,!1),6:new ht(16,!0),7:new ht(32,!1),8:new ht(32,!0)},js=function(){function e(t,n){Object(o.a)(this,e),this.sequencerEngine=t,this.ccToAction=this.convertConfig(n.cc),n.actions?this.noteToAction=this.convertConfig2(n.actions):this.noteToAction=this.convertConfig(n.note),this.overwrittenCC=new Set,this.knob1Action=new Os(ks),this.knob2Action=new Os(Es),this.knob3Action=new Os(Ss),this.rollingCount=0}return Object(c.a)(e,[{key:"overwrite",value:function(e){this.overwrittenCC.add(e)}},{key:"onNoteOnEvent",value:function(e){var t=e.note.number,n=this.noteToAction[t];if(void 0!==n)switch(n.action){case Ps:this.onSequenceRollOn(n.track);break;case"PLAY":this.onPlay();break;case"RECORD":this.onRecord();break;case"CLEAR":this.onClear();break;case"PATTERN_SWITCH":this.onPatternSwitch(n.track);break;case"NEXT_PATTERN":this.onNextPattern();break;case"PREVIOUS_PATTERN":this.onPreviousPattern();break;default:return}}},{key:"onNoteOffEvent",value:function(e){var t=e.note.number,n=this.noteToAction[t];if(void 0!==n)switch(n.action){case Ps:this.onSequenceRollOff(n.track);break;case"PATTERN_SWITCH":break;default:return}}},{key:"onEvent",value:function(e,t){var n=this.ccToAction[e];if(void 0!==n&&!this.overwrittenCC.has(e))switch(n.action){case"VOLUME":this.onVolume(n.track,t);break;case"KNOB_1":this.onKnob1(n.track,t);break;case"KNOB_2":this.onKnob2(n.track,t);break;case"KNOB_3":this.onKnob3(n.track,t)}}},{key:"onVolume",value:function(e,t){var n=this.sequencerEngine.subSequences[e];void 0!==n&&(n.fade=t/128)}},{key:"onKnob1",value:function(e,t){var n=this.getTrack(e);this.knob1Action.onChange(n,t);var a=this.sequencerEngine.subSequences[e];void 0!==a&&this.sequencerEngine.switchToSubSequence(a.id)}},{key:"onKnob2",value:function(e,t){var n=this.getTrack(e);this.knob2Action.onChange(n,t);var a=this.sequencerEngine.subSequences[e];void 0!==a&&this.sequencerEngine.switchToSubSequence(a.id)}},{key:"onKnob3",value:function(e,t){var n=this.getTrack(e);this.knob3Action.onChange(n,t);var a=this.sequencerEngine.subSequences[e];void 0!==a&&this.sequencerEngine.switchToSubSequence(a.id)}},{key:"convertConfig2",value:function(e){var t={};for(var n in e){t[e[n]]={action:n}}return t}},{key:"convertConfig",value:function(e){var t={};for(var n in e){var a={track:Object($e.a)(n)?parseInt(n):n},r=e[n];for(var s in r){t[r[s]]=Object(X.a)({},a,{action:s})}}return t}},{key:"getTrack",value:function(e){if("MASTER"!==e)return this.sequencerEngine.tracks[e]}},{key:"onSequenceRollOn",value:function(e){var t=Ts[e];void 0!==t&&(this.sequencerEngine.resolution=t,this.sequencerEngine.trackRolling=!0,this.sequencerEngine.setSequenceRolling(!0,t),this.rollingCount++)}},{key:"onSequenceRollOff",value:function(e){this.rollingCount--,0===this.rollingCount&&(this.sequencerEngine.trackRolling=!1,this.sequencerEngine.setSequenceRolling(!1,void 0))}},{key:"onPatternSwitch",value:function(e){this.sequencerEngine.switchToPattern(e)}},{key:"onNextPattern",value:function(){this.sequencerEngine.switchToNextPattern()}},{key:"onPreviousPattern",value:function(){this.sequencerEngine.switchToPreviousPattern()}},{key:"onPlay",value:function(){this.sequencerEngine.play()}},{key:"onClear",value:function(){var e=this.sequencerEngine.getSelectedTrack();e&&(e.pattern.clear(),e.updateSteps())}},{key:"onRecord",value:function(){this.sequencerEngine.recording(!this.sequencerEngine.isRecording)}}]),e}(),xs=n(1058),Ns=function(){function e(t,n,a){Object(o.a)(this,e),this.sequencerEngine=t,this.store=this.sequencerEngine.store,this.input=n,this.output=a,this.step=0,this.subSequenceNumber=0,this.patternNumber=0,this.numberOfPatterns=1,this.setupLights(),this.setupListeners()}return Object(c.a)(e,[{key:"setupListeners",value:function(){var e=this;this.input.addListener("noteon","all",function(e){}),this.input.addListener("noteoff","all",function(e){}),this.store.subscribe(function(){return e.onStateUpdate()})}},{key:"onStateUpdate",value:function(){var e=this.store.getState(),t=this.sequencerEngine.getSubSequence(e.sequencer.currentSubSequence);if(void 0!==t){var n=this.sequencerEngine.subSequences.indexOf(t),a=e.sequencer.currentPattern[t.id],r=e.sequencer.numberOfPatterns;this.subSequenceNumber===n&&this.patternNumber===a&&this.numberOfPatterns===r||(this.patternNumber=a,this.subSequenceNumber=n,this.idToPattern=e.sequencer.currentPattern,this.numberOfPatterns=r,this.onStateChanged())}}},{key:"onStateChanged",value:function(){this.pad.reset(8),console.log("patternNumber = "+this.patternNumber+" and subSequenceNumber = "+this.subSequenceNumber),this.color(this.pad.red,8,this.subSequenceNumber);for(var e=0;e<this.sequencerEngine.subSequences.length;e++)this.color(this.pad.red,0,e);for(var t in this.idToPattern){t=parseInt(t),console.log("id we got = "+t);var n=this.sequencerEngine.getSubSequence(t);if(void 0===n)return;var a=this.sequencerEngine.subSequences.indexOf(n),r=this.idToPattern[t],s=n.tracks[0];if(void 0!==s)for(var i=0;i<Math.min(8,s.patterns.length);i++)this.color(this.pad.yellow,i,a);console.log("coloring x = "+r+" y ="+a),this.color(this.pad.red,r,a)}}},{key:"onTick",value:function(){}},{key:"setupLights",value:function(){var e=this;this.pad=new xs.a,this.pad.connect().then(function(){e.pad.reset(8),e.pad.on("key",function(t){return e.handleKeyPressed(t)}),e.onStateUpdate()})}},{key:"handleKeyPressed",value:function(e){var t=e.x,n=e.y;if(e.pressed){var a=this.sequencerEngine.subSequences[n];if(void 0!==a){var r=a.tracks[0];void 0!==r&&t<r.patterns.length&&(this.sequencerEngine.switchToSubSequence(a.id),this.sequencerEngine.switchToPattern(t))}}}},{key:"color",value:function(e,t,n){this.pad.col(e,{0:t,1:n,x:t,y:n,length:2,pressed:!0})}}]),e}(),qs="MAP",Ms="PADS",Ds=["Launchpad Mini"],As=["IAC Driver Bus 1","IAC Driver Bus 2","IAC Driver Bus 3"],Rs={"Akai MPD26 Port 1":Ms,"MPD218 Port A":Ms},Is=function(){function e(t,n,a){var r=this;Object(o.a)(this,e);this.keyboardEngine=t,this.sequencerEngine=this.keyboardEngine.sequencerEngine,this.keyboardHelper=n,this.deviceToMidiCC={},this.sliders={},this.controllerInputs=[],this.controllerOutputs=[],this.inputToMode={},this.updateBpm=a,this.previousTimestamp=null,this.currentTimestamp=null,gs.a.enable(function(e){e?console.log("WebMidi could not be enabled.",e):r.setup()},!0)}return Object(c.a)(e,[{key:"setup",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadAvailableDevices();case 2:this.setupKeyboardRouting(),void 0!==this.onEnableCallback&&this.onEnableCallback();case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loadAvailableDevices",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t=this;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){gs.a.inputs.filter(function(e){return!Ds.some(function(t){return t===e.name})&&!As.some(function(t){return t===e.name})}).forEach(function(e){return t.trackInput(e,Rs[e.name]||"KEYBOARD")});var a=gs.a.inputs.filter(function(e){return Ds.some(function(t){return t===e.name})}),r=gs.a.outputs.filter(function(e){return Ds.some(function(t){return t===e.name})});a.length>0&&void 0===t.launchPad&&(t.launchPad=new Ns(t.sequencerEngine,a[0],r[0])),gs.a.outputs.map(function(e){return t.trackOutput(e)}),e()}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"setStartCallback",value:function(e){this.startCallback=e}},{key:"setStopCallback",value:function(e){this.stopCallback=e}},{key:"getInputs",value:function(){return gs.a.inputs}},{key:"getOutputs",value:function(){return gs.a.outputs}},{key:"getTrackedInputs",value:function(){return this.controllerInputs}},{key:"getTrackedOutputs",value:function(){return this.controllerOutputs}},{key:"isOutputTracked",value:function(e){return this.controllerOutputs.some(function(t){return t.name==e.name})}},{key:"getOutput",value:function(e){var t=this.controllerOutputs.filter(function(e){return e.name==t.name});return t.length>0?t[0]:null}},{key:"playNote",value:function(e,t,n,a,r,s){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;t=t||"all",(n=Math.round(n))>70?n=70:n<-36&&(n=-36);var o=bs.a.fromTranspose(n).toString();if(null!=e&&(a-=0,e.playNote(o,t,{velocity:i,time:"+"+a}),void 0!==r)){var c=a+r-20;c-a<10&&(c+=10-(c-a)),e.stopNote(o,t,{time:"+"+c,release:s})}}},{key:"playNoteSimple",value:function(e,t,n,a){n=n||"all",e.playNote(t,n,{release:a})}},{key:"releaseNoteSimple",value:function(e,t,n,a){n=n||"all",e.stopNote(t,n,{release:a})}},{key:"trackOutput",value:function(e){for(var t in this.controllerOutputs)if(this.controllerOutputs[t].name===e.name)return;this.controllerOutputs.push(e),void 0===this.deviceToMidiCC[e.name]&&(this.deviceToMidiCC[e.name]=new ys),this.deviceToMidiCC[e.name].output=e}},{key:"untrackOutput",value:function(e){for(var t=-1,n=0;n<this.controllerOutputs.length;n++)if(this.controllerOutputs[n].name===e.name){t=n;break}t>-1&&(this.controllerOutputs.splice(t,1),delete this.inputToMode[e.name])}},{key:"trackInput",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"KEYBOARD";if(Wr[e.name]&&void 0===this.sliders[e.name]){var n=Wr[e.name];this.sliders[e.name]=new js(this.sequencerEngine,n,e)}else{for(var a in this.addControlChangeListeners(e),this.controllerInputs)if(this.controllerInputs[a].name===e.name)return;this.controllerInputs.push(e),this.setInputMode(e,t)}}},{key:"isInputTracked",value:function(e){return this.controllerInputs.some(function(t){return t.name==e.name})}},{key:"isInputSynced",value:function(e){return void 0!==this.systemInput&&this.systemInput.name==e.name}},{key:"untrackInput",value:function(e){for(var t=-1,n=0;n<this.controllerInputs.length;n++)if(this.controllerInputs[n].name===e.name){t=n;break}t>-1&&(this.controllerInputs.splice(t,1),delete this.inputToMode[e.name])}},{key:"setInputMode",value:function(e,t){this.inputToMode[e.name]=t}},{key:"syncOutput",value:function(e){this.systemOutput===e?this.systemOutput=void 0:this.systemOutput=e}},{key:"onTick",value:function(e,t,n){if(void 0!==this.systemOutput){var a=new q.a.Time("32n").toMilliseconds()/3;e+=20;for(var r=0;r<3;r++)this.systemOutput.sendClock({time:"+"+e}),e+=a}this.launchPad&&this.launchPad.onTick(t,n)}},{key:"onPlay",value:function(){void 0!==this.systemOutput&&this.systemOutput.sendStart({time:"+0"})}},{key:"onStop",value:function(){void 0!==this.systemOutput&&this.systemOutput.sendStop()}},{key:"syncInput",value:function(e){void 0!==this.systemInput&&this.removeSystemListeners(),this.systemInput=e,this.addSystemInputListeners()}},{key:"unsyncInput",value:function(e){this.removeSystemListeners(),this.systemInput=void 0}},{key:"removeSystemListeners",value:function(){this.systemInput.removeListener("clock","all"),this.systemInput.removeListener("start","all"),this.systemInput.removeListener("stop","all")}},{key:"addSystemInputListeners",value:function(){var e=this;this.last10=[],this.systemInput.addListener("start","all",function(t){e.sequencerEngine.play(0,!0)}),this.systemInput.addListener("stop","all",function(t){e.sequencerEngine.stop()})}},{key:"onEnable",value:function(e){this.onEnableCallback=e}},{key:"addControlChangeListeners",value:function(e){var t=this;e.removeListener("controlchange","all"),void 0===this.deviceToMidiCC[e.name]&&(this.deviceToMidiCC[e.name]=new ys);var n=this.deviceToMidiCC[e.name],a=this.sliders[e.name];n.input=e,console.log("add controll change listeners=",e.name),e.addListener("controlchange","all",function(e){if(n.onEvent(e),a&&a.onEvent(e.controller.number,e.value),118===e.controller.number)t.sequencerEngine.play();else if(117===e.controller.number)t.sequencerEngine.stop();else if(119===e.controller.number){var r=t.sequencerEngine.store.getState();t.sequencerEngine.recording(!r.sequencer.isRecording)}else 116===e.controller.number?t.sequencerEngine.switchToNextPattern():115===e.controller.number&&t.sequencerEngine.switchToPreviousPattern();if(e.controller.number>=1&&e.controller.number<=6){var s=t.sequencerEngine.groups.groups[e.controller.number-1];void 0!==s&&(1==s.tracks.length?s.tracks[0].setVolume(e.value):s.setVolume(e.value))}else{var i=e.controller.number;if("DELETE"===t.midiMapMode)t.store.dispatch(Object(w.b)(i));else if(t.midiMappings[i]&&(void 0===t.parameterSelected||t.midiMappings[i].indexOf(t.parameterSelected)>-1)){t.midiMappings[i].map(function(e){return t.sequencerEngine.idToParameter[e]}).filter(function(e){return e.object}).forEach(function(t){return t.normalizedSet(e.value/127)})}else if(t.actionMappings[i]&&(void 0===t.actionSelected||t.actionMappings[i].indexOf(t.actionSelected)>-1)){t.actionMappings[i].forEach(function(t){return t.execute(e.value)})}else t.midiMapMode===qs&&t.actionSelected?t.store.dispatch(Object(w.n)(t.actionSelected,i)):t.midiMapMode===qs&&t.parameterSelected&&t.store.dispatch(Object(w.gc)(t.parameterSelected,i))}})}},{key:"removeListeners",value:function(e){e.removeListener("noteon","all"),e.removeListener("noteoff","all")}},{key:"getInputsForMode",value:function(e){var t=this;return this.controllerInputs.filter(function(n){return n.name in t.inputToMode&&t.inputToMode[n.name]==e})}},{key:"getInputMode",value:function(e){return this.inputToMode[e]||"KEYBOARD"}},{key:"setupKeyboardRouting",value:function(){var e=this;gs.a.inputs.forEach(function(t){return e.removeListeners(t)}),this.addNoteOnListener(function(t,n,a){e.keyboardHelper.onNoteDown(n,!0,t,a)},void 0),this.addNoteOffListener(function(t,n){e.keyboardHelper.onNoteOff(n,!0,t)},void 0)}},{key:"addNoteOnListener",value:function(e,t){var n=this;void 0===t&&(t=function(){return n.controllerInputs});gs.a.inputs.map(function(a){return a.addListener("noteon","all",function(r){var s=n.sliders[a.name];if(s)s.onNoteOnEvent(r);else if(t().some(function(e){return e.name==a.name})){var i=r.note.name+r.note.octave;e(a.name,i,Math.min(1,r.velocity+.3))}})})}},{key:"addNoteOffListener",value:function(e,t){var n=this;void 0===t&&(t=function(){return n.controllerInputs});gs.a.inputs.map(function(a){return a.addListener("noteoff","all",function(r){var s=n.sliders[a.name];if(s)s.onNoteOffEvent(r);else if(t().some(function(e){return e.name==a.name})){var i=r.note.name+r.note.octave;e(a.name,i)}})})}},{key:"updateSteps",value:function(e){}},{key:"store",get:function(){return this.sequencerEngine.store}},{key:"state",get:function(){return this.store.getState()}},{key:"midiMapMode",get:function(){return this.state.midi.midiMapMode}},{key:"parameterSelected",get:function(){return this.state.midi.parameterSelected}},{key:"midiMappings",get:function(){return this.state.midi.mappings}},{key:"actionSelected",get:function(){return this.state.midi.actionSelected}},{key:"actionMappings",get:function(){return this.state.midi.actionMappings}}]),e}();n(213);function Ls(e){return new q.a.Time(e).toMilliseconds()-new q.a.Time(q.a.Master.context.currentTime).toMilliseconds()}var Fs=n(111),Vs=function(){function e(t,n){var a=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(o.a)(this,e),this.sequencerEngine=t,this.input=n,this.soundUploader=new Fs.a(2,function(e,t,n){return a.onSoundUploaded(t)}),this.isMaster=r,this.resampleCount=0}return Object(c.a)(e,[{key:"getRecorder",value:function(){return new window.Recorder(this.input,{numChannels:2,bufferLen:1024})}},{key:"start",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.track=t,this.freeze=n,this.sequencerEngine.store.dispatch(Object(w.Mb)(void 0===t||t.trackNumber)),this.resamplingDurationElapsed=0;var a=Ls(e);this.recorder=this.getRecorder(),this.recorder.record(a+(new Date).getTime())}},{key:"stop",value:function(e){var t=this,n=Ls(e);setTimeout(function(){t.recorder.stop(Ls(e)+(new Date).getTime()),t.recorder.getBuffer(function(e){return t.saveBuffer(e)}),t.sequencerEngine.store.dispatch(Object(w.Mb)(void 0))},n+0)}},{key:"saveBuffer",value:function(e){this.audioBuffer=this.getAudioBuffer(e),this.soundUploader.uploadBufferToIpfs(e,!0,0)}},{key:"getAudioBuffer",value:function(e){var t=e[0].length,n=q.a.Master.context.createBuffer(2,t,q.a.Master.context.sampleRate);return n.copyToChannel(e[0],0,0),n.copyToChannel(e[1],1,0),n}},{key:"onSoundUploaded",value:function(e){var t=this;console.log("onSoundUploaded("+e+")");var n=new K.a(e);if(n.audioBuffer=this.audioBuffer,n.name="Resampled Recording",n.tags=["Resampled"],this.autoResampleMode){n.name=bs.a.fromTranspose(this.autoResampleTrackNote).toString();var a=this.autoResampleTrack;a.midiOutputs&&n.tags.push(Array.from(a.midiOutputs)[0].name)}if(n.isResampled=!0,n.samplesUsed=[],this.isMaster){var r=this.sequencerEngine.tracks.filter(function(e){return!e.muted&&e.sample}).map(function(e){return e.sample});r.forEach(function(e){var t;return(t=n.tags).push.apply(t,Object(ge.a)(e.tags))}),n.tags=Array.from(new Set(n.tags)),n.samplesUsed=r.map(function(e){return e.getId()})}void 0===n.samplesUsed&&(n.samplesUsed=[]),this.freeze?this.track.freeze(n):this.sequencerEngine.addSound(n,void 0,void 0,void 0,!0).then(function(e){t.autoResampleMode&&t.matchLengths(e)}),this.autoResampleMode&&(this.resampleCount%this.samplesPerNote===0&&(this.autoResampleTrackNote=this.autoResampleTrackNote+2),this.resampleCount++,this.sequencerEngine.store.dispatch(Object(w.wc)(!0)))}},{key:"prepare",value:function(){}},{key:"matchLengths",value:function(e){for(;e.length>this.autoResampleTrack.length;)e.halfTrackLength()}},{key:"autoResampleTrack",get:function(){return this.sequencerEngine.tracks[0]}},{key:"autoResampleTrackNote",get:function(){return this.autoResampleTrack.pattern.stepBuckets[0].steps[0].transpose},set:function(e){this.autoResampleTrack.pattern.stepBuckets[0].steps[0].transpose=e}},{key:"autoResampleMode",get:function(){return this.sequencerEngine.autoResampleMode}},{key:"samplesPerNote",get:function(){return this.sequencerEngine.resampleConfig.samplesPerNote}}]),e}(),Bs=function e(){Object(o.a)(this,e),this.samplesPerNote=1};function Us(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:nr,a=tr(32,t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1);return Math.floor(32*(e-n)/a)}function Hs(e,t,n,a){for(var r in t.filter(function(e){return void 0!==e}).forEach(function(e){return e.chokes.onStep()}),n)if(void 0!==t[r]&&void 0!==t[r].chokes&&void 0!==t[r].chokes.choke){var s=t[r].chokes.choke,i=n[r];for(var o in i){var c=i[o],u=2*c.stepData.duration;s.chokes.newChoke(u,c.time)}}var l=function(e){var r=t[e];return void 0===r||void 0===r.chokes||r.chokes.isChoked()?"continue":void 0===n[e]?"continue":void n[e].forEach(function(e){r.trigger(e.stepData,e.time,a)})};for(var p in n)l(p)}var Js=1,Gs=1,zs=2,_s=3,Ws=function(){function e(){Object(o.a)(this,e),this.trackToSlices={},this.trackToTransposes={}}return Object(c.a)(e,[{key:"clear",value:function(){this.trackToSlices={},this.trackToTransposes={}}},{key:"addTrackSlice",value:function(e,t,n){void 0===n?e in this.trackToSlices?this.trackToSlices[e].add(t):this.trackToSlices[e]=new Set([t]):e in this.trackToTransposes?this.trackToTransposes[e].add(n):this.trackToTransposes[e]=new Set([n])}},{key:"deleteTrack",value:function(e){e in this.trackToSlices&&delete this.trackToSlices[e],e in this.trackToTransposes&&delete this.trackToTransposes[e]}},{key:"removeTrackSlice",value:function(e,t,n){if(void 0!==n){var a=this.trackToTransposes[e];void 0===a||(a.size<=1?delete this.trackToTransposes[e]:this.trackToTransposes[e].delete(n))}else{var r=this.trackToSlices[e];void 0===r||(r.size<=1?delete this.trackToSlices[e]:this.trackToSlices[e].delete(t))}}},{key:"getTrackSlicesRolling",value:function(e){var t=e.trackNumber,n=[];return(this.trackToTransposes[t]||[]).forEach(function(e){return n.push(new Ks(parseInt(t),0,e))}),(this.trackToSlices[t]||[]).forEach(function(e){return n.push(new Ks(parseInt(t),e,void 0))}),n}},{key:"getTriggerTimes",value:function(e,t){return Ar(e,t)}},{key:"getTrackRollEffectIfAny",value:function(e){for(var t in e.liveEffects.effects){var n=e.liveEffects.effects[t];if(n.effect===Js)return n}}},{key:"getTriggers",value:function(e,t,n){var a=this.getTrackRollEffectIfAny(n);if(a){var r=a.rollFactor;(t=t.getCopy()).resolution*=r}var s=this.getTriggerTimes(e,t),i=[];return 0==s.length?i:(this.getTrackSlicesRolling(n).forEach(function(e){return s.forEach(function(t){return i.push(new Ys(e,t.time,t.step))})}),i)}}]),e}(),Ks=function e(t,n,a){Object(o.a)(this,e),this.trackNumber=t,this.sliceNumber=n,this.transpose=a},Ys=function e(t,n,a){Object(o.a)(this,e),this.trackSlice=t,this.time=n,this.step=a},Qs=Ws;function Xs(e){for(var t,n,a=e.length;0!==a;)n=Math.floor(Math.random()*a),t=e[a-=1],e[a]=e[n],e[n]=t;return e}var Zs=function(){function e(){Object(o.a)(this,e),this.selectedTags=[],this.selectedOrTags=[],this.selectedStyles=[],this.selectedCountries=[],this.selectedVideos=[],this.selectedDiscogs=[],this.filterFavorites=!1,this.year=void 0,this.chord=void 0}return Object(c.a)(e,[{key:"toString",value:function(){console.log("selectedTags = "+this.selectedTags.join(",")),console.log("selectedOrTags = "+this.selectedOrTags.join(",")),console.log("selectedStyles= "+this.selectedStyles.join(",")),console.log("selectedCountries = = "+this.selectedCountries.join(","))}},{key:"empty",value:function(){return 0==this.selectedTags.length&&0==this.selectedStyles.length&&0==this.selectedOrTags.length&&0==this.selectedCountries.length&&void 0===this.chord&&void 0==this.year}},{key:"getSearchQueryParameters",value:function(){var e="?tags="+this.selectedTags.join(",")+"&styles="+this.selectedStyles.join(",")+"&countries="+this.selectedCountries.join(",");return void 0!==this.year&&(e+="&year="+this.year),e}},{key:"getTopTags",value:function(){return this.getTopFields("/getTags")}},{key:"getTopStyles",value:function(){return this.getTopFields("/getStyles")}},{key:"getTopCountries",value:function(){return this.getTopFields("/getCountries")}},{key:"getTopFields",value:function(e){var t=this;return new Promise(function(n,a){var r=t.getSearchQueryParameters();e+=r,f.a.get(e).then(function(e){var t=e.data.data,a=[];for(var r in t)a.push(r);n(a)}).catch(function(e){a(e)})})}},{key:"getSounds",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a,r;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a="/filterSearch/"+t+"/"+n+this.getSearchQueryParameters(),e.next=3,f.a.get(a);case 3:return r=e.sent,e.abrupt("return",this.searchCallback(r));case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"searchCallback",value:function(e){for(var t=e.data.data,n=[],a=0;a<t.length;a++)n.push(t[a].id);return{sounds:n,total:e.data.total}}}]),e}(),$s=function(){function e(){Object(o.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"bytes32",name:"hash",type:"bytes32"}],name:"newGuildClassification",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"guildsAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"},{indexed:!0,internalType:"bytes32",name:"hash",type:"bytes32"}],name:"NewGuildClassification",type:"event"}],this.contractAddress="0x3831959eF022C226F3bdfF6481f4666901428f90"}return Object(c.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),ei=n(31),ti=n(41),ni=n(43),ai=n.n(ni),ri=n(218),si=new $s,ii="undefined"!==typeof window.web3?new ai.a(window.web3.currentProvider):new ai.a(new ai.a.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),oi={},ci=function(){function e(){Object(o.a)(this,e),void 0!==ii&&ii.eth.net.isListening()&&(this.contract=new ii.eth.Contract(si.abi,si.contractAddress),this.ethAddress=this.contract.options.address)}return Object(c.a)(e,[{key:"saveClassifications",value:function(e,t){var n=this;return new Promise(function(){var a=Object(g.a)(v.a.mark(function a(r,s){var i,o;return v.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,B.a.addJson(t);case 2:return i=a.sent,a.next=5,ii.eth.getAccounts();case 5:o=a.sent,n.contract.methods.newGuildClassification(e,Object(ri.b)(i)).send({from:o[0]},function(e,t){e?s(e):r(i)});case 7:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"getClassificationsHash",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:0,n=new ti.a(si.contractAddress).from(ei.i).select("contentHash").where("guildId",t),e.next=4,n.executeQuery();case 4:if(a=e.sent,console.log("classifications we got for guild ="+t),0!==a.length){e.next=8;break}return e.abrupt("return",void 0);case 8:return e.abrupt("return",a[0].contentHash);case 9:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"getClassifications",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return console.log("getClassifications("+t+")"),new Promise(function(){var n=Object(g.a)(v.a.mark(function n(a,r){var s,i;return v.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!oi[t]){n.next=2;break}return n.abrupt("return",a(oi[t]));case 2:return n.next=4,e.getClassificationsHash(t);case 4:if(void 0!==(s=n.sent)){n.next=9;break}a({}),n.next=14;break;case 9:return n.next=11,B.a.getJson(s);case 11:i=n.sent,oi[t]=i,a(i);case 14:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}}]),e}(),ui=new ci,li=function(){function e(){Object(o.a)(this,e),this.tagToLevel={},this.tagToParent={},this.tagToChildren={},this.loadHierarchy()}return Object(c.a)(e,[{key:"loadHierarchy",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r,s,i;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ui.getClassifications();case 2:for(a in t=e.sent,n={},t)for(r in n[a]=this.getParentOfTag(a,t),t[a])s=t[a][r],n[s]=a;for(i in this.tagToChildren=t,this.tagToParent=n,this.tagToLevel={},n)this.tagToLevel[i]=this.getLevel(i,n);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getAllChildren",value:function(e){var t=this.tagToChildren[e],n=[];for(var a in t)n=n.concat(this.getAllChildren(t[a]));return n.concat(t)}},{key:"reduce",value:function(e,t){if(e.length<=40)return e;var n=1,a=0===t.length,r=!0,s=[];for(var i in t){var o=t[i];s=s.concat(this.getAllChildren(o)),void 0===this.tagToLevel[o]?a=!0:r=!1,this.tagToLevel[o]>=n&&(n=this.tagToLevel[o])}return a&&(n+=2),r?this.filterReduction(e,2,s,a):this.filterReduction(e,n,s,a)}},{key:"filterReduction",value:function(e,t,n,a){var r=this;return e.filter(function(e){return n.indexOf(e.value)>-1||r.tagToLevel[e.value]<=t||a&&void 0===r.tagToLevel[e.value]})}},{key:"getLevel",value:function(e,t){return void 0===t[e]?0:t[e]===e?0:1+this.getLevel(t[e],t)}},{key:"getParentOfTag",value:function(e,t){for(var n in t){if(t[n].indexOf(e)>-1)return n}return null}}]),e}(),pi="OR",hi="AND",di="TAG";function fi(e){e=e.map(function(t){return{value:t.value,rank:Math.pow(.9,8*t.rank/e.length)}});var t=Math.max.apply(Math,e.map(function(e){return e.rank}));return e.map(function(e){return{value:e.value,rank:e.rank/t}})}function mi(e,t){var n={};for(var a in e)a in t&&(n[a]=e[a].rank+t[a].rank);return n}var vi=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this))).cache=e,n.varietyReducer=new li,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"freeTextSearch",value:function(e){var t=this;return new Promise(function(n,a){n({TAG:fi(t.cache.freeTextSearch(di,e)),STYLE:fi(t.cache.freeTextSearch("STYLE",e)),COUNTRY:fi(t.cache.freeTextSearch("COUNTRY",e)),YEAR:fi(t.cache.freeTextSearch("YEAR",e))})})}},{key:"getTopVideos",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.empty()){e.next=4;break}return e.abrupt("return",this.cache.getAllForField("YOUTUBE",0,1e7));case 4:return a=this.selectedOrTags.length>0?pi:hi,e.abrupt("return",this.getTopFields(0,1e7,"YOUTUBE",a));case 6:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTopDiscogs",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.empty()){e.next=4;break}return e.abrupt("return",this.cache.getAllForField("DISCOGS",0,1e7));case 4:return a=this.selectedOrTags.length>0?pi:hi,e.abrupt("return",this.getTopFields(0,1e7,"DISCOGS",a));case 6:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTopTags",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n,a){var r,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=void 0===a?this.selectedTags:a,!this.filterFavorites){e.next=6;break}return e.next=4,R.a.getFavoritesForUser();case 4:return r=e.sent,e.abrupt("return",this.getTagsForSounds(r));case 6:return e.next=8,this.getTopFields(t,n,di);case 8:return s=e.sent,e.abrupt("return",this.varietyReducer.reduce(s,this.selectedTags));case 10:case"end":return e.stop()}},e,this)}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"getTopStyles",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.selectedOrTags.length>0?pi:hi,e.abrupt("return",this.getTopFields(void 0,void 0,"STYLE",t));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getTopCountries",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.selectedOrTags.length>0?pi:hi,e.abrupt("return",this.getTopFields(void 0,void 0,"COUNTRY",t));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getVideoInfo",value:function(e){var t=Array.from(this.cache.getFieldsForField(di,"YOUTUBE",e)),n=Array.from(this.cache.getFieldsForField("STYLE","YOUTUBE",e)),a=Array.from(this.cache.getFieldsForField("YEAR","YOUTUBE",e));return{tags:t.map(function(e){return e.value}),styles:n.map(function(e){return e.value}),year:a.map(function(e){return e.value})[0]}}},{key:"getTopFields",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n,a){var r,s,i,o,c,u,l=this,p=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=p.length>3&&void 0!==p[3]?p[3]:hi,s=this.getSelectedFields(r),!this.empty()){e.next=4;break}return e.abrupt("return",fi(this.cache.getAllForField(a,t,n)));case 4:for(c in i=[],o=function(e){s[e].forEach(function(t){i.push(l.cache.getFieldsForField(a,e,t))})},s)o(c);return u=[],u=r==pi?Array.from(this.unionAll(i)):Array.from(this.intersectAll(i)),e.abrupt("return",fi(u));case 10:case"end":return e.stop()}},e,this)}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"getSelectedFields",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hi,t=void 0===this.year?[]:[this.year];return{TAG:e==pi?this.selectedOrTags:this.selectedTags,STYLE:this.selectedStyles,COUNTRY:this.selectedCountries,YEAR:t}}},{key:"getTagsForSounds",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r,s,i;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r in n={},a=[],t)a.push(R.a.getTagsForSound(t[r]));return e.next=5,Promise.all(a);case 5:for(i in s=e.sent)s[i].forEach(function(e){return n[e]=!0});return e.abrupt("return",Object.keys(n));case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"unionAll",value:function(e){if(void 0===e||0==e.length)return[];var t={};return e.forEach(function(e){return e.forEach(function(e){e.value in t||(t[e.value]=0),t[e.value]+=e.rank})}),t}},{key:"intersectAll",value:function(e){if(void 0===e||0==e.length)return[];var t=[],n=function(n){r=e[n];var a={};r.forEach(function(e){return a[e.value]=e.rank}),t.push(a)};for(var a in e){var r;n(a)}var s=t[0];for(a=1;a<t.length;a++)s=mi(s,t[a]);var i=new Set;for(var o in s)i.add({value:o,rank:s[o]/t.length});return i}}]),t}(Zs);function gi(e,t){var n=new Set(e),a=new Set(t);return Array.from(n).every(function(e){return a.has(e)})&&Array.from(a).every(function(e){return n.has(e)})}var bi=function(){function e(t){Object(o.a)(this,e),this.store=t,this.selectedTags=[],this.selectedOrTags=[],this.selectedStyles=[],this.selectedCountries=[],this.selectedVideos=[],this.filterFavorites=!1,this.chord=!1,this.year=void 0,this.unsortedResults=[],this.canceled=!1,this.mostRecentResults=void 0,this.mostPopularResults=void 0,this.shuffledResults=void 0,console.log("constructing new search query obj")}return Object(c.a)(e,[{key:"addLazyResults",value:function(){var e=Object(g.a)(v.a.mark(function e(t){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.linkedPromiseList=t;case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getNext",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n=this;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.linkedPromiseList&&!this.canceled){e.next=3;break}return this.canceled||this.setFinalResults(this.unsortedResults),e.abrupt("return",void 0);case 3:return e.next=5,this.linkedPromiseList.getCurrent();case 5:if(t=e.sent,(t=Array.from(new Set(t))).forEach(function(e){n.unsortedResults.push(e)}),this.setFinalResults(this.unsortedResults),void 0!==this.linkedPromiseList){e.next=11;break}return e.abrupt("return",void 0);case 11:return e.next=13,this.linkedPromiseList.getNext();case 13:return this.linkedPromiseList=e.sent,e.abrupt("return",this.linkedPromiseList);case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"addUnsortedResults",value:function(e){this.unsortedResults=e}},{key:"sort",value:function(){this.setFinalResults(this.unsortedResults)}},{key:"setFinalResults",value:function(e){this.unsortedResults=e,"MOST_POPULAR"===this.sortBy?this.mostPopularResults?this.results=this.mostPopularResults:(this.results=this.sortByRanking(Object(ge.a)(this.unsortedResults)),this.mostPopularResults=this.results):"RANDOM"===this.sortBy?void 0===this.shuffledResults?(console.log("shuffling"),this.results=Xs(Object(ge.a)(this.unsortedResults)),this.shuffledResults=this.results):this.results=this.shuffledResults:this.mostRecentResults?this.results=this.mostRecentResults:(this.results=this.unsortedResults,this.mostRecentResults=this.results)}},{key:"sortByRanking",value:function(e){var t=this;return void 0===this.sampleToRanking?e:(e.sort(function(e,n){var a=e in t.sampleToRanking?t.sampleToRanking[e]:0;return(n in t.sampleToRanking?t.sampleToRanking[n]:0)-a}),e)}},{key:"getAllSounds",value:function(){var e=this,t=void 0===this.favorites||void 0===this.results?this.results:this.results.filter(function(t){return e.favorites.indexOf(t)>-1});return Array.from(new Set(t))}},{key:"getResults",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,a=this.getAllSounds();return void 0!==a&&(void 0!==this.stylesSounds&&(a=a.filter(function(t){return e.stylesSounds.has(t)})),void 0!==this.yearSounds&&(a=a.filter(function(t){return e.yearSounds.has(t)})),void 0!==this.chordSounds&&(a=a.filter(function(t){return e.chordSounds.has(t)})),void 0!==this.videosSounds&&(a=a.filter(function(t){return e.videosSounds.has(t)}))),void 0===a?{sounds:[],total:0}:void 0!==t&&void 0!==n?t>=a.length?{sounds:[],total:0}:t+n>=a.length?{sounds:a.slice(t),total:a.length}:{sounds:a.slice(t,t+n),total:a.length}:{sounds:a,total:a.length}}},{key:"cancel",value:function(){this.canceled=!0}},{key:"empty",value:function(){return 0===this.selectedTags.length&&0===this.selectedStyles.length&&0===this.selectedOrTags.length&&-0==this.selectedCountries.length&&0===this.selectedVideos.length&&void 0===this.chord&&void 0===this.year}},{key:"equals",value:function(e){var t=!1;return this.chord===e.chord?t=!0:void 0===this.chord||void 0===e.chord?t=!1:this.chord.join(",")===e.chord.join(",")&&(t=!0),gi(this.selectedTags,e.selectedTags)&&gi(this.selectedOrTags,e.selectedOrTags)&&gi(this.selectedStyles,e.selectedStyles)&&gi(this.selectedVideos,e.selectedVideos)&&gi(this.selectedDiscogs,e.selectedDiscogs)&&gi(this.selectedCountries,e.selectedCountries)&&function(e,t){if(void 0!==e&&void 0===t)return!1;if(void 0!==t&&void 0===e)return!1;if(void 0===e&&void 0===t)return!0;e=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),t=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate());var n=Math.abs(e-t);if(0===Math.floor(n/1e3/60/60/24))return!0;return!1}(this.fromDate,e.fromDate)&&this.filterFavorites===e.filterFavorites&&t&&this.year===e.year}},{key:"sortBy",get:function(){return this.store.getState().selector.sortBy}}]),e}(),yi=n(339);function ki(e,t){return new Set(Object(ge.a)(e).filter(function(e){return t.has(e)}))}function Ei(e,t){return Si.apply(this,arguments)}function Si(){return(Si=Object(g.a)(v.a.mark(function e(t,n){var a,r,s,i,o,c,u;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r in a=[],t)s=t[r],a.push(n(s));return e.next=4,Promise.all(a);case 4:i=e.sent,o=new Set(i[0]),e.t0=v.a.keys(i);case 7:if((e.t1=e.t0()).done){e.next=15;break}if(0!=(c=e.t1.value)){e.next=11;break}return e.abrupt("continue",7);case 11:u=new Set(i[c]),o=ki(o,u),e.next=7;break;case 15:return e.abrupt("return",Array.from(o));case 16:case"end":return e.stop()}},e)}))).apply(this,arguments)}var Oi=new(function(){function e(){Object(o.a)(this,e),this.recentQueries=[],this.guildId=0}return Object(c.a)(e,[{key:"setStore",value:function(e){var t=this;void 0===this.store&&e&&(this.store=e,this.store.subscribe(function(){return t.onChange()}))}},{key:"onChange",value:function(){var e=this.store.getState().guilds.selectedGuild,t=e?e.guildId:0;t!==this.guildId&&(console.log("guild changed to guildId = "+t),this.guildId=t,this.clear())}},{key:"clear",value:function(){this.recentQueries=[]}},{key:"createSearchQuery",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new bi(this.store);return n.selectedTags=e.selectedTags,n.selectedOrTags=e.selectedOrTags,n.selectedStyles=e.selectedStyles,n.selectedVideos=e.selectedVideos,n.selectedDiscogs=e.selectedDiscogs,n.selectedCountries=e.selectedCountries,n.filterFavorites=e.filterFavorites,n.fromDate=e.fromDate,n.chord=void 0===e.chord?void 0:Object(ge.a)(e.chord),n.year=e.year,t||(n.sampleToRanking=e.sampleToRanking),n}},{key:"getSearchQueryIfExists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.createSearchQuery(e),a=this.recentQueries.filter(function(e){return n.equals(e)&&!n.canceled});return void 0===(a=0==a.length?void 0:a[0])||t||(a.sampleToRanking=e.sampleToRanking,a.canceled=!1),void 0!==a&&a.sort(),a}},{key:"addNewQuery",value:function(e){this.recentQueries.push(e),this.recentQueries.length>25&&this.recentQueries.splice(0,1)}}]),e}()),wi={};function Ci(e,t){if(void 0!==e||void 0!==t){var n=new Set;return e&&e.forEach(function(e){return n.add(e)}),t&&t.forEach(function(e){return n.add(e)}),console.log("union gave me = "),console.log(e),console.log(t),console.log(n),n}}var Pi=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,e))).store=n?n.store:void 0,a.cache=e,a.updateSoundRankings(),Oi.setStore(a.store),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getNewIndex",value:function(){var e=Object(g.a)(v.a.mark(function e(t){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cache.loadNewIndex(t);case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"clearCache",value:function(){Oi.clear(),wi={}}},{key:"filterByMonth",value:function(){var e=Object(g.a)(v.a.mark(function e(t){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cache.filterByMonth(t.getMonth(),t.getFullYear());case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"clearFilterByMonth",value:function(){this.cache.clearFilter()}},{key:"getAllSounds",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a,r,s,i,o,c;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(a=Oi.getSearchQueryIfExists(this,!0))){e.next=3;break}return e.abrupt("return",a);case 3:return a=Oi.createSearchQuery(this,!0),e.next=6,this.getSoundsWithVideos(this.selectedVideos);case 6:return r=e.sent,e.next=9,this.getSoundsWithDiscogs(this.selectedDiscogs);case 9:if(s=e.sent,a.videosSounds=Ci(r,s),i=[],!this.filterFavorites){e.next=18;break}return e.next=15,R.a.getFavoritesForUser();case 15:i=e.sent,e.next=29;break;case 18:if(o=void 0,void 0===r&&void 0===s){e.next=23;break}o=a.videosSounds,e.next=28;break;case 23:return(c=new Date(this.fromDate)).setDate(this.fromDate.getDate()+31),e.next=27,R.a.getAllSounds(this.fromDate,c);case 27:o=e.sent;case 28:o.forEach(function(e){-1==i.indexOf(e)&&i.push(e)});case 29:return a.setFinalResults(i),Oi.addNewQuery(a),e.abrupt("return",a);case 32:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSounds",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a,r,s,i,o,c,u,l,p,h,d,f,m,g;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(a=Oi.getSearchQueryIfExists(this))){e.next=3;break}return e.abrupt("return",a);case 3:return a=Oi.createSearchQuery(this),r=(new Date).getTime(),e.next=7,this.getSoundsWithTags(this.selectedTags);case 7:return s=e.sent,e.next=10,this.getSoundsWithVideos(this.selectedVideos);case 10:return i=e.sent,e.next=13,this.getSoundsWithDiscogs(this.selectedDiscogs);case 13:return o=e.sent,e.next=16,this.getSoundsWithOrTags(this.sortTagsByPopularity(this.selectedOrTags));case 16:return c=e.sent,e.next=19,this.getSoundsWithStyles(this.selectedStyles);case 19:return u=e.sent,e.next=22,this.getSoundsWithCountries(this.selectedCountries);case 22:return l=e.sent,e.next=25,this.getSoundsWithYear(this.year);case 25:return p=e.sent,e.next=28,this.getSoundsWithChord(this.chord);case 28:if(h=e.sent,d=(new Date).getTime(),console.log("getSoundsWIthTgs took = "+(d-r)),f=[h,s,u,l,p],m=this.intersectResultsForFilters(f),!this.filterFavorites){e.next=39;break}return e.next=36,R.a.getFavoritesForUser();case 36:e.t0=e.sent,e.next=40;break;case 39:e.t0=void 0;case 40:return g=e.t0,a.videosSounds=Ci(i,o),a.favorites=g,a.countriesSounds=l,a.stylesSounds=u,a.yearSounds=p,a.chordSounds=h,a.addUnsortedResults(m),a.addLazyResults(c),Oi.addNewQuery(a),e.abrupt("return",a);case 51:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSoundsWithTags",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n=this;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",[]);case 2:return e.t0=Set,e.next=5,Ei(t,function(e){return n.getSoundsWithTag(e)});case 5:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithTag",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in wi)){e.next=3;break}return console.log("found in cache"),e.abrupt("return",wi[t]);case 3:return e.next=5,R.a.getSoundsWithTag(t);case 5:return n=e.sent,wi[t]=n,e.abrupt("return",n);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithVideos",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r,s,i;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",void 0);case 2:for(a in n=[],t)n.push(R.a.getSoundsWithVideo(t[a]));return e.next=6,Promise.all(n);case 6:for(i in r=e.sent,s=[],r)s=s.concat(r[i]);return e.abrupt("return",new Set(s));case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithDiscogs",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r,s,i;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",void 0);case 2:for(a in console.log("get sounds with discogs = "),console.log(t),n=[],t)n.push(R.a.getSoundsWithDiscogs(t[a]));return e.next=8,Promise.all(n);case 8:for(i in r=e.sent,s=[],r)s=s.concat(r[i]);return console.log(s),e.abrupt("return",new Set(s));case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithOrTags",value:function(){var e=Object(g.a)(v.a.mark(function e(t){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.abrupt("return",this.recursivelySearchOrTags(t));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"recursivelySearchOrTags",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=t.length){e.next=2;break}return e.abrupt("return",new Promise(function(e,t){return e(void 0)}));case 2:return n=t[0],e.abrupt("return",new yi.a(function(){return R.a.getSoundsWithTag(n)},this.recursivelySearchOrTags(t.slice(1))));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithStyles",value:function(){var e=Object(g.a)(v.a.mark(function e(t){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.t0=Set,e.next=5,Ei(t,function(e){return R.a.getSoundsWithStyle(e)});case 5:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithCountries",value:function(){var e=Object(g.a)(v.a.mark(function e(t){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.t0=Set,e.next=5,Ei(t,function(e){return R.a.getSoundsWithCountry(e)});case 5:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithYear",value:function(){var e=Object(g.a)(v.a.mark(function e(t){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.t0=Set,e.next=5,R.a.getSoundsWithYear(this.year);case 5:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSoundsWithChord",value:function(){var e=Object(g.a)(v.a.mark(function e(t){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.t0=Set,e.t1=Object,e.next=6,(new W.a).searchRankedNotes(this.chord);case 6:return e.t2=e.sent,e.t3=e.t1.keys.call(e.t1,e.t2),e.abrupt("return",new e.t0(e.t3));case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"intersectResultsForFilters",value:function(e){if(this.selectedOrTags.length>0)return[];var t=!1,n=new Set([]);for(var a in e){var r=e[a];if(void 0!==r)if(n.size>0){if(!(r.size>0))continue;n=ki(n,r),t=!0}else!t&&r.size>0&&(n=r)}return Array.from(n)}},{key:"sortTagsByPopularity",value:function(e){var t=this.cache.getAllForField(di,0,2e3);return e.sort(function(e,n){return t.indexOf(e)-t.indexOf(n)}),e}},{key:"updateSoundRankings",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.a.getOverallVotedRankings();case 2:this.sampleToRanking=e.sent;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"sortBy",get:function(){return Oi.sortBy},set:function(e){Oi.sortBy=e}}]),t}(vi),Ti=["hi-hat","snare","kick","crash","ride","breaks","sherman","ambient","sub","rim","side-stick","sidestick","clap","piano","guitar","rimshot","percussion"],ji=function(){function e(t,n){Object(o.a)(this,e),this.sample=t,this.sequencerEngine=n,this.searcher=new Pi(n.ethereumCache,n),this.nextSounds=[],this.previousSounds=[],this.counter=0}return Object(c.a)(e,[{key:"getCopy",value:function(t){var n=new e(t,this.sequencerEngine);return n.searcher=this.searcher,this.sounds&&(n.sounds=Xs(Object(ge.a)(this.sounds))),n.initBuffers(),n}},{key:"hasNext",value:function(){return void 0===this.sounds||this.nextSounds.length>0}},{key:"hasPrevious",value:function(){return void 0===this.sounds||this.previousSounds.length>0}},{key:"dispose",value:function(){this.nextSounds.forEach(function(e){return e.dispose(!0)}),this.previousSounds.forEach(function(e){return e.dispose(!0)}),this.sounds=void 0,this.nextSounds=void 0,this.previousSounds=void 0,this.sample&&(this.sample.dispose(!0),this.sample=void 0),this.searcher=void 0}},{key:"search",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r,s,i=this;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sample.fetchTags();case 2:return t=e.sent,this.searcher.selectedTags=t,e.next=6,this.searcher.getSounds();case 6:n=e.sent;case 7:return e.next=9,n.getNext();case 9:if(!e.sent){e.next=12;break}e.next=7;break;case 12:this.sounds=n.getResults().sounds,e.t0=v.a.keys(t);case 14:if((e.t1=e.t0()).done){e.next=31;break}if(a=e.t1.value,r=t[a],!(Ti.indexOf(r)>-1)){e.next=29;break}return this.searcher.selectedTags=[r],e.next=21,this.searcher.getSounds();case 21:s=e.sent;case 22:return e.next=24,s.getNext();case 24:if(!e.sent){e.next=27;break}e.next=22;break;case 27:this.sounds=this.sounds.concat(s.getResults().sounds).filter(function(e){return e!==i.sample.getId()}),this.sounds=Array.from(new Set(this.sounds));case 29:e.next=14;break;case 31:this.counter=0,this.initBuffers();case 33:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"initBuffers",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.sounds){e.next=2;break}return e.abrupt("return");case 2:this.loading=!0,this.sounds.length,t=0;case 5:if(!(this.nextSounds.length<2)){e.next=24;break}return e.prev=6,e.next=9,this.loadNextForInitialBuffer(t);case 9:n=e.sent,a=n.next,r=n.previous,this.nextSounds.push(a),this.previousSounds.push(r),e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(6),!(t>=4)){e.next=20;break}return e.abrupt("break",24);case 20:console.log("timed out loading next and previous...");case 21:t++,e.next=5;break;case 24:this.loading=!1;case 25:case"end":return e.stop()}},e,this,[[6,16]])}));return function(){return e.apply(this,arguments)}}()},{key:"loadNextForInitialBuffer",value:function(e){var t=this;return new Promise(function(){var n=Object(g.a)(v.a.mark(function n(a,r){var s,i,o,c,u;return v.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return setTimeout(function(){r()},1500),n.prev=1,s=t.sounds.length,i=(t.counter+e)%s,o=t.sounds[i],c=new K.a(o),n.next=8,c.load();case 8:return i=((t.counter-e-1)%s+s)%s,o=t.sounds[i],u=new K.a(o),n.next=13,u.load().catch(r);case 13:a({next:c,previous:u}),n.next=19;break;case 16:n.prev=16,n.t0=n.catch(1),r();case 19:case"end":return n.stop()}},n,null,[[1,16]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"sleep",value:function(e){return new Promise(function(){var t=Object(g.a)(v.a.mark(function t(n,a){return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:setTimeout(function(){return n()},e);case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getNext",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n=this;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.sounds){e.next=3;break}return e.next=3,this.search();case 3:if(!this.loading){e.next=8;break}return e.next=6,this.sleep(50);case 6:e.next=3;break;case 8:return t=this.nextSounds.shift(),setTimeout(function(){n.loadNext(t)},100),e.abrupt("return",t);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getPrevious",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.sounds){e.next=3;break}return e.next=3,this.search();case 3:if(!this.loading){e.next=8;break}return e.next=6,this.sleep(50);case 6:e.next=3;break;case 8:return t=this.previousSounds.shift(),this.loadPrevious(t),e.abrupt("return",t);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loadNext",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r,s,i=this;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("load next called"),n=!1,setTimeout(function(){n||(i.loading=!1)},1500),this.loading=!0,(a=this.previousSounds.pop())&&a.dispose(!0),this.previousSounds=[this.sample].concat(Object(ge.a)(this.previousSounds)),this.sample=t,!0,r=void 0,s=0;case 11:if(void 0!==r){e.next=28;break}return e.prev=12,e.next=15,this.loadNextAvailableSample();case 15:r=e.sent,e.next=25;break;case 18:if(e.prev=18,e.t0=e.catch(12),!(s>=4)){e.next=24;break}return this.loading=!1,n=!0,e.abrupt("return");case 24:console.log("retrying");case 25:s++,e.next=11;break;case 28:this.nextSounds.push(r),this.loading=!1,n=!0;case 31:case"end":return e.stop()}},e,this,[[12,18]])}));return function(t){return e.apply(this,arguments)}}()},{key:"loadNextAvailableSample",value:function(){var e=this;return new Promise(function(){var t=Object(g.a)(v.a.mark(function t(n,a){var r,s,i;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.counter=(e.counter+1)%e.sounds.length,r=(e.counter+2)%e.sounds.length,s=e.sounds[r],i=new K.a(s),setTimeout(function(){a()},1500),t.prev=5,t.next=8,i.load();case 8:n(i),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(5),a();case 14:case"end":return t.stop()}},t,null,[[5,11]])}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"loadPrevious",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,(n=this.nextSounds.pop())&&n.dispose(!0),this.nextSounds=[this.sample].concat(Object(ge.a)(this.nextSounds)),this.sample=t,this.counter=this.mod(this.counter-1,this.sounds.length),a=this.mod(this.counter-2,this.sounds.length),r=this.sounds[a],s=new K.a(r),e.next=11,s.load();case 11:this.previousSounds.push(s),this.loading=!1;case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"mod",value:function(e,t){return(e%t+t)%t}}]),e}(),xi=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,"Roll Effect",Js,e))).rollFactorParameter=new Wt("Roll Factor",Object(p.a)(n),function(e,t){return t},{min:.125,max:8,unit:"x",defaultValue:1}),n.registerParameter(n.rollFactorParameter),n.modeParameter=new Kt("Mode",Object(p.a)(n),function(e,t){return t},{min:Gs,max:_s,unit:"",defaultValue:zs}),n.registerParameter(n.modeParameter),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getJson",value:function(){var e=Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this);return e.rollFactor=this.rollFactor,e.mode=this.mode,e=this.saveParameterToJson(e,"rollFactorParameter",this.rollFactorParameter),e=this.saveParameterToJson(e,"modeParameter",this.modeParameter)}},{key:"fromJson",value:function(e){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e),this.mode=e.mode,this.rollFactor=e.rollFactor,this.loadParameterFromJson(e,"rollFactorParameter",this.rollFactorParameter),this.loadParameterFromJson(e,"modeParameter",this.modeParameter)}},{key:"mode",get:function(){return this.modeParameter.get()},set:function(e){this.modeParameter.set(e)}},{key:"rollFactor",get:function(){return this.rollFactorParameter.get()},set:function(e){this.rollFactorParameter.set(e)}}]),t}(function(e){function t(e,n,a){var r;return Object(o.a)(this,t),(r=Object(u.a)(this,Object(l.a)(t).call(this,e,a))).effect=n,r}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getJson",value:function(){var e=Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this);return e.effect=this.effect,e}}]),t}(Nr));function Ni(e,t){if(e.effect===Js)return new xi(t)}var qi=function(){function e(t){Object(o.a)(this,e),this.track=t,this.effects=[]}return Object(c.a)(e,[{key:"addEffect",value:function(e){this.effects.push(e),this.linkEffectParameters()}},{key:"linkEffectParameters",value:function(){var e=this;this.effects.forEach(function(t){t.registerContext((new Kn).forTrack(e.track)),t.registerMixSession(e.track.mixSession),t.registerTrack(e.track)})}},{key:"deleteEffect",value:function(e){var t=this.effects.indexOf(e);this.effects.splice(t,1)}},{key:"getEffect",value:function(e){var t=this.effects.filter(function(t){return t.effect==e&&t.isEnabled()});return t.length>0?t[0]:void 0}},{key:"clear",value:function(){}},{key:"getJson",value:function(){return this.effects.map(function(e){return e.getJson()})}},{key:"fromJson",value:function(e){for(var t in e)console.log(e),this.addEffect(Ni(e[t],this.track)),this.effects[this.effects.length-1].fromJson(e[t])}}]),e}(),Mi=function(){function e(t){Object(o.a)(this,e),this.track=t,this.choke=void 0,this.transposeMatch=void 0,this.chokingDuration=0,this.isLiveTriggering=!1}return Object(c.a)(e,[{key:"onStep",value:function(){this.chokingDuration=Math.max(this.chokingDuration-1,0)}},{key:"newChoke",value:function(e,t){this.chokingDuration=e,this.track.releaseAll(t)}},{key:"isChoked",value:function(){return this.isLiveTriggering||this.chokingDuration>0}},{key:"liveTrigger",value:function(){this.choke&&(this.choke.chokes.isLiveTriggering=!0,this.choke.releaseAll())}},{key:"liveRelease",value:function(){this.choke&&(this.choke.chokes.isLiveTriggering=!1)}},{key:"getJson",value:function(){return{choke:void 0===this.choke?void 0:this.choke.trackNumber}}},{key:"fromJson",value:function(e,t){void 0!==e.choke&&(this.choke=t[e.choke])}}]),e}(),Di=["RECORD_STEP"],Ai=function(e,t,n,a){return{type:"ADD_STEP",payload:{track:e,step:t,stepNumber:n,resolution:a}}},Ri=function(e,t,n,a){return{type:"DELETE_STEP",timestamp:(new Date).getTime(),payload:{track:e,step:t,stepNumber:n,resolution:a}}},Ii=function(e,t,n){return{type:"DELETE_STEP_NUMBER",timestamp:(new Date).getTime(),payload:{track:e,stepNumber:t,resolution:n}}},Li=function(e,t,n){return{type:"TOGGLE_STEP",payload:{track:e,stepNumber:t,resolution:n}}},Fi=function(e,t,n,a){return{type:"MOVE_STEPS",payload:{track:e,steps:t,transformation:n,wrap:arguments.length>4&&void 0!==arguments[4]&&arguments[4],resolution:a}}},Vi=function(e,t){return{type:"DELETE_STEPS",payload:{track:e,steps:t}}},Bi=function(e,t,n,a){return{type:"UPDATE_STEP_PARAMETER",payload:{track:e,step:t,parameter:n,value:a}}},Ui=function(e,t,n,a){return{type:"ADD_EFFECT",payload:{effect:e,track:t,group:n,send:a}}},Hi=function(e,t,n,a){return{type:"TOGGLE_EFFECT",payload:{effect:e,track:t,group:n,send:a}}},Ji=function(e,t,n,a,r,s){return{type:"MOVE_EFFECT",payload:{from:e,to:t,isMidiEffect:n,track:a,group:r,send:s}}},Gi=function(e,t){return{type:"UPDATE_PARAMETER",payload:{parameter:e,value:t}}},zi=function(e,t){return{type:"UPDATE_TRACK_VOLUME",payload:{track:e,value:t}}},_i=function(e,t,n,a){return{type:"ADD_AUTOMATION_BREAK_POINT",payload:{automation:e,step:t,value:n,pointId:a}}},Wi=function(e,t,n,a){return{type:"MOVE_AUTOMATION_BREAK_POINT",payload:{automation:e,point:t,step:n,value:a}}},Ki=function(e,t){return{type:"REMOVEAUTOMATION_BREAK_POINT",payload:{automation:e,point:t}}},Yi=new q.a.Time("32n");function Qi(e,t,n){var a=e[0],r=e.map(function(e){return $i(e-a,t,n)}),s=Zi(r,32),i=Xi(r,32,s),o=Zi(i,16),c=Zi(i=Xi(i,16,o),8),u=Zi(i=Xi(i,8,c),4),l=Zi(i=Xi(i,4,u),2),p=Zi(i=Xi(i,2,l),1);return i=Xi(i,1,p),console.log("timing 1 = "),console.log(p),{steps:i,unquantizedSteps:r,timings:[p,l,u,c,o,s].filter(function(e){return!(0===(t=e).even&&0===t.odd);var t})}}function Xi(e,t,n){var a=32/t;return e.map(function(e){return{stepNumber:e.stepNumber,offset:Math.max(0,Math.floor(e.stepNumber/a)%2===0?e.offset-n.even:e.offset-n.odd)}})}function Zi(e,t){var n=32/t,a=void 0,r=void 0;for(var s in e){var i=e[s],o=i.stepNumber,c=i.offset;Math.floor(o/n)%2===0?(1===t&&console.log("even for 1 offset = "+c),(void 0===r||r>c)&&(r=c)):(1===t&&console.log("odd for 1 offset = "+c),(void 0===a||a>c)&&(a=c))}return{resolution:t,even:r||0,odd:a||0}}function $i(e,t,n){var a=e*t/n/Yi.toMilliseconds(),r=a-Math.floor(a);return{stepNumber:Math.floor(a),offset:r}}var eo="ALL",to=function(){function e(){Object(o.a)(this,e),this.type=eo,this.nameToMidiInput={}}return Object(c.a)(e,[{key:"addMidiInput",value:function(e){this.nameToMidiInput[e.name]=e,this.type="CUSTOM"}},{key:"deleteMidiInput",value:function(e){e.name in this.nameToMidiInput&&(delete this.nameToMidiInput[e.name],0===Object.keys(this.nameToMidiInput).length&&(this.type=eo))}},{key:"setType",value:function(e){e!==eo&&"COMPUTER_KEYBOARD"!==e||(this.nameToMidiInput={}),this.type=e}},{key:"accepts",value:function(e,t){return this.type===eo||(e?t in this.nameToMidiInput:"COMPUTER_KEYBOARD"===this.type)}},{key:"getMidiInputs",value:function(){return Object.values(this.nameToMidiInput)}},{key:"getMidiInputNames",value:function(){return Object.keys(this.nameToMidiInput)}}]),e}();function no(){if(!(this instanceof no))return arguments.length>1||"number"!==typeof arguments[0]?no.apply(new no(arguments.length),arguments):new no(arguments[0]);if(0===arguments.length)throw new Error("Missing Argument: You must pass a valid buffer length");return this.size=this.start=0,this.overflow=null,arguments.length>1||"number"!==typeof arguments[0]?(this.data=new Array(arguments.length),this.end=(this.length=arguments.length)-1,this.push.apply(this,arguments)):(this.data=new Array(arguments[0]),this.end=(this.length=arguments[0])-1),this}function ao(e,t){return e==t?0:e>t?1:-1}no.prototype={constructor:no,pop:function(){var e;if(0!==this.size)return e=this.data[this.end],delete this.data[this.end],this.end=(this.end-1+this.length)%this.length,this.size--,e},push:function(){var e=0;if(this.overflow&&this.size+arguments.length>this.length)for(;e<this.size+arguments.length-this.length;e++)this.overflow(this.data[(this.end+e+1)%this.length],this);for(e=0;e<arguments.length;e++)this.data[(this.end+e+1)%this.length]=arguments[e];return this.size<this.length&&(this.size+e>this.length?this.size=this.length:this.size+=e),this.end=(this.end+e)%this.length,this.start=(this.length+this.end-this.size+1)%this.length,this.size},reverse:function(){for(var e,t=0;t<~~(this.size/2);t++)e=this.data[(this.start+t)%this.length],this.data[(this.start+t)%this.length]=this.data[(this.start+(this.size-t-1))%this.length],this.data[(this.start+(this.size-t-1))%this.length]=e;return this},rotateLeft:function(e){if("undefined"===typeof e&&(e=1),"number"!==typeof e)throw new Error("Argument must be a number");for(;--e>=0;)this.push(this.shift());return this},rotateRight:function(e){if("undefined"===typeof e&&(e=1),"number"!==typeof e)throw new Error("Argument must be a number");for(;--e>=0;)this.unshift(this.pop());return this},shift:function(){var e;if(0!==this.size)return e=this.data[this.start],this.start=(this.start+1)%this.length,this.size--,e},sort:function(e){return this.data.sort(e||ao),this.start=0,this.end=this.size-1,this},unshift:function(){var e=0;if(this.overflow&&this.size+arguments.length>this.length)for(;e<this.size+arguments.length-this.length;e++)this.overflow(this.data[this.end-e%this.length],this);for(e=0;e<arguments.length;e++)this.data[(this.length+this.start-e%this.length-1)%this.length]=arguments[e];return this.length-this.size-e<0&&(this.end+=this.length-this.size-e,this.end<0&&(this.end=this.length+this.end%this.length)),this.size<this.length&&(this.size+e>this.length?this.size=this.length:this.size+=e),this.start-=arguments.length,this.start<0&&(this.start=this.length+this.start%this.length),this.size},indexOf:function(e,t){for(t||(t=0);t<this.size;t++)if(this.data[(this.start+t)%this.length]===e)return t;return-1},lastIndexOf:function(e,t){for(t||(t=this.size-1);t>=0;t--)if(this.data[(this.start+t)%this.length]===e)return t;return-1},sortedIndex:function(e,t,n){t=t||ao;var a=this.start,r=this.size-1;for(a&&t.call(n,e,this.data[r])>0&&(a=0,r=this.end);a<r;){var s=a+r>>>1;t.call(n,e,this.data[s])>0?a=s+1:r=s}return((a-this.start)%this.size+this.size)%this.size},every:function(e,t){for(var n=0;n<this.size;n++)if(!e.call(t,this.data[(this.start+n)%this.length],n,this))return!1;return!0},forEach:function(e,t){for(var n=0;n<this.size;n++)e.call(t,this.data[(this.start+n)%this.length],n,this)},some:function(e,t){for(var n=0;n<this.size;n++)if(e.call(t,this.data[(this.start+n)%this.length],n,this))return!0;return!1},avg:function(){return 0==this.size?0:this.sum()/this.size},sum:function(){for(var e=this.size,t=0;e--;)t+=this.data[e];return t},median:function(){if(0===this.size)return 0;var e=this.slice().sort(ao),t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2},empty:function(){return this.size=this.start=0,this.end=this.length-1,this},fill:function(e){var t=0;if("function"===typeof e)for(;this.data[t]=e(),++t<this.length;);else for(;this.data[t]=e,++t<this.length;);return this.start=0,this.end=this.length-1,this.size=this.length,this},first:function(){return this.data[this.start]},last:function(){return this.data[this.end]},get:function(e){return this.data[(this.start+e)%this.length]},isFull:function(e){return this.length===this.size},set:function(e,t){return this.data[(this.start+e)%this.length]=t},toArray:function(){return this.slice()},slice:function(e,t){var n=this.size;if((e=+e||0)<0){if(e>=t)return[];e=-e>n?0:n+e}null==t||t>n?t=n:t<0?t+=n:t=+t||0,n=e<t?t-e:0;for(var a=Array(n),r=0;r<n;r++)a[r]=this.data[(this.start+e+r)%this.length];return a}};var ro=no;var so=function(e,t){this.timestretch=function(e){for(var t=e.getChannelData(0),n=e.getChannelData(1),a=[],r=[],s=0;s<100;s++)this.process(t[s],a),this.process(n[s],r);t=new Float32Array(a),n=new Float32Array(r),e.set(q.a.Buffer.fromArray([t,n]))},this.process=function(e,t){var n=function(e){for(var t=new Float32Array(e.length),n=0;n<e.length;n++)t[n]=s[n]*e[n];return t}(e);return function(e,t,n,a,r,s,i){for(var o,c=0,u=0;u<e;u++)o=r.shift()||0,c=a.shift()||0,i.push(c/(o<.01?1:o)),a.push(0),r.push(0);for(var u=0;u<s;u++)c=a.shift(),a.push(t[u]+c),o=r.shift(),r.push(n[u]+o)}(r,n,i,h,d,c,t),m=!1,r},this.beta_fn=function(e){return n<=1?2:n<=1.2?2:n<=1.4?2:n<=1.8?2.5:3},this.overlap_fn=function(e){return e<1.25?e+.15:e>=1.25&&e<1.5?e+.2:e>=1.5&&e<1.8?e+.6:e>=1.8&&e<2?e+.9:e+2.2},this.get_hs=function(){return r},this.get_ha=function(){return a},this.get_alpha=function(){return n},this.get_real_alpha=function(){return r/a},this.get_overlap_factor=function(){return l},this.clear_buffers=function(){h=new ro(c),d=new ro(c),m=!0},this.set_window_type=function(e){p=o[e]?e:p},this.set_alpha=function(e,t,s){n=e,void 0==s?this.set_beta(this.beta_fn(n)):this.set_beta(s),l=void 0==t?this.overlap_fn(n):t,a=Math.round(c/l),r=Math.round(n*a)},this.set_beta=function(e){s=function(e,t,n){for(var a=new Float32Array(e),r=0;r<e;r++)a[r]=o[n](e,r,t);return a}(c,u=e,p),i=new Float32Array(s.length);for(var t=0;t<i.length;t++)i[t]=Math.pow(s[t],1)};var n,a,r,s,i,o={Lanczos:function(e,t,n){var a=2*t/(e-1)-1;return Math.pow(Math.sin(Math.PI*a)/(Math.PI*a),n)},Triangular:function(e,t,n){return Math.pow(2/e*(e/2-Math.abs(t-(e-1)/2)),n)},Bartlett:function(e,t,n){return Math.pow(2/(e-1)*((e-1)/2-Math.abs(t-(e-1)/2)),n)},BartlettHann:function(e,t,n){return Math.pow(.62-.48*Math.abs(t/(e-1)-.5)-.38*Math.cos(2*Math.PI*t/(e-1)),n)},Blackman:function(e,t,n){var a=n/2;return(1-n)/2-.5*Math.cos(2*Math.PI*t/(e-1))+a*Math.cos(4*Math.PI*t/(e-1))},Cosine:function(e,t,n){return Math.pow(Math.cos(Math.PI*t/(e-1)-Math.PI/2),n)},Gauss:function(e,t,n){return Math.pow(Math.E,-.5*Math.pow((t-(e-1)/2)/(n*(e-1)/2),2))},Hamming:function(e,t,n){return Math.pow(.54-.46*Math.cos(2*Math.PI*t/(e-1)),n)},Hann:function(e,t,n){return Math.pow(.5*(1-Math.cos(2*Math.PI*t/(e-1))),n)},Rectangular:function(e,t,n){return n},SinBeta:function(e,t,n){return Math.pow(Math.sin(Math.PI*t/e),n)},Trapezoidal:function(e,t,n){var a=Math.round(e/4),r=a-1,s=9*a-1;return t<=r?Math.pow(t/r,n):t>=s?Math.pow(s/t,n):1}},c=e,u=1,l=1.1,p="Lanczos";this.set_alpha(1),this.set_beta(u);for(var h=new ro(c),d=new ro(c),f=0;f<c;f++)h.push(0),d.push(0);var m=!0;this.is_clean=function(){return m}};var io=function(e){var t,n=e||4096,a=new so(n),r=new so(n),s=0,i=1,o=new ro(Math.round(1.2*n)),c=new ro(Math.round(1.2*n)),u=new Float32Array(e);this.process=function(e){if(t){for(var l=0,p=t.getChannelData(0),h=t.getChannelData(1),d=e.getChannelData(0),f=e.getChannelData(1);c.size>0&&l<e.length;)d[g=l++]=o.shift(),f[g]=c.shift();if(l!=e.length)do{var m=p.subarray(s,s+n),v=h.subarray(s,s+n);void 0!=i&&i!=a.get_alpha()&&(a.set_alpha(i),r.set_alpha(i),i=void 0),m.length<n?(u.set(0,m),a.process(u,o),u.set(0,v),r.process(u,c),u.fill(0)):(a.process(m,o),r.process(v,c));for(var g=l;o.size>0&&g<e.length;g++)d[g]=o.shift(),f[g]=c.shift();l+=a.get_hs(),s+=a.get_ha()}while(l<e.length)}},this.set_audio_buffer=function(e){t=e},Object.defineProperties(this,{position:{get:function(){return s},set:function(e){s=new Number(e)}},alpha:{get:function(){return a.get_alpha()},set:function(e){i=new Number(e)}}})},oo="TRIGGER_SAMPLE",co="RELEASE_SAMPLE",uo=(n(598),n(2575),n(2306),n(436)),lo="SEQUENCER_VIEW",po="MIX_VIEW",ho=8,fo=new q.a.Time("16n"),mo=new q.a.Time("32n"),vo=q.a.Frequency("C3"),go=0,bo=function(){function e(t,n,a,r,s){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];Object(o.a)(this,e),this.id=go++,this.store=t.store,this.parameters=[],this.counter=0,this.baseTranspose=0,this.sample=n,this.tempo=n.tempo||s.tempo,this.samplerData=s,this.onsets=n.onsets||[],this.sliceData=r,this.track=t,this.note=null,this.slices=[],this.transposeParameter=new Wt("transpose",this,function(e,t){return[]},{defaultValue:0,min:-32,max:32}),this.registerParameter(this.transposeParameter),i||(this.gainNode=new q.a.Volume,this.volumeParameter=new Xt("volume",this.gainNode.volume,{min:-100,max:0,unit:"db",defaultValue:0}),this.registerParameter(this.volumeParameter)),this.alpha=1,this.tempoSynced=!1,this.audioBuffer=n.audioBuffer,this.setVolume(s.volume),this.offset=s.offset,this.transpose=s.transpose,this.onNewSampler=a,this.baseBuffer=new q.a.Buffer(n.audioBuffer),r=void 0===r?[{startTime:0,endTime:this.getDuration()}]:r,this.sliceData=r,this.pitchEnvelopes=[];for(var c=i?1:ho,u=0;u<c;u++){var l=new q.a.ScaledEnvelope({attack:.01,decay:.01,min:0,max:1,sustain:1,release:.01,curve:"linear"});l._releaseCurve="linear",l._decayCurve="linear",this.pitchEnvelopes.push(l)}this.pitchEnvelopeIndex=0,this.detuneSignal=new q.a.Signal(0),this.detuneParameter=new Xt("detune",this.detuneSignal,{min:-200,max:200,automationRate:Ye}),this.registerParameter(this.detuneParameter)}return Object(c.a)(e,[{key:"registerParameter",value:function(e){e.setStore(this.store),this.parameters.push(e)}},{key:"init",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.samplerData;var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sliceData,t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return void 0!==this.tempo||t||(this.tempo=this.analyze()),0==this.slices.length&&this.loadSlices(e),this}},{key:"sleep",value:function(e){return new Promise(function(t,n){setTimeout(function(){return t()},e)})}},{key:"analyze",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.baseBuffer,t=this.track.sequencerEngine.aubio,n=this.state.waveform.onsetThreshold,a=Object(uo.a)(e,t,n),r=a.tempo,s=a.onsets,i=a.onsetToPitch;return this.onsets=s,this.onsetToPitch=i,r}},{key:"loadSlices",value:function(e){var t=this;e.map(function(e){return t.newSlice(e.startTime,e.endTime)})}},{key:"getVolume",value:function(){return this.volumeParameter.get()}},{key:"setVolume",value:function(e){void 0!==this.volumeParameter&&this.volumeParameter.set(e)}},{key:"getJson",value:function(){return{slices:this.slices.map(function(e){return e.getJson()}),volume:this.gainNode.volume.value,tempoSynced:this.tempoSynced,tempo:this.tempo,transpose:this.transpose,alpha:this.alpha,offset:this.offset,reversed:this.isReversed(),sampleId:this.sample.getId()}}},{key:"release",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,n=this.get(e),a=q.a.Master.context.currentTime,r=void 0!==t?this.getNoteFromTranspose(t):this.lastNote;n.triggerRelease(r,a),this.triggerReleaseWaveformAnimation()}},{key:"getNoteFromTranspose",value:function(e){return e+=this.track.sequencerEngine.transpose,e+=this.baseTranspose,vo.transpose(e).transpose(this.transpose)}},{key:"releaseAll",value:function(e){var t=this;this.slices.map(function(n){return n.sampler.triggerRelease(t.lastNote,e)})}},{key:"trigger",value:function(){var t=Object(g.a)(v.a.mark(function t(n){var a,r,s,i,o,c,u,l,p,h,d,f,m;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.getDefaultTriggerConfig(n),a=n.stepData,r=n.time,void 0===n.transpose&&(n.transpose=n.stepData.transpose||0),s=n.stepData.duration,void 0!==(i=this.get(n.sliceNumber))&&null!==i&&i.loaded){t.next=8;break}return t.abrupt("return");case 8:for(o=null,null==s||(o="number"===typeof s?fo*s:new q.a.Time(s)),c=this.getNoteFromTranspose(n.transpose),u=a.velocity,l=a.chop,p=(null==o?fo:o)/l,r=r||q.a.Master.context.currentTime,r=mo*this.offset+r,h=new q.a.Time(r),i.attack=new q.a.Time(a.attack/1e3),i.release=new q.a.Time(a.release/1e3),a.reverse!==this.isReversed()&&this.reverse(a.reverse),d=h,f=0;f<l;f++)n.gated||null==this.lastNote||(this.releaseAll(h),this.triggerReleaseWaveformAnimation(h)),m=this.getPitchEnvelope(i,c,r,u,a),n.gated&&!n.skipRelease?this.triggerAttackRelease(i,c,o,h,u,[m],this.convertToStartTime(n.sliceNumber,a.start)):this.triggerAttack(i,c,h,u,[m],this.convertToStartTime(n.sliceNumber,a.start)),h+=p;this.lastNote=c,this.triggerWaveformAnimation(n.skipRelease?void 0:d,n.gated&&!n.skipRelease?o:void 0,n.sliceNumber,n.transpose,this.convertToStartTime(n.sliceNumber,a.start));case 25:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"convertToStartTime",value:function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)/100*this.getSlice(e).buffer.duration}},{key:"getPitchEnvelope",value:function(e,t,n,a,r){q.a.Frequency(t).toMidi();var s=this.pitchEnvelopes[this.pitchEnvelopeIndex];s.cancel(n-.001),this.pitchEnvelopeIndex=(this.pitchEnvelopeIndex+1)%this.pitchEnvelopes.length;var i=null===r.pitchSustain?1:r.pitchSustain;return s.attack=null==r.pitchAttack?0:r.pitchAttack/1e3,s.attack+=.001,s.decay=null==r.pitchDecay?0:r.pitchDecay/1e3,s.decay+=.001,s.min=0,s.max=6*i*100,s.sustain=i,s.sustain+=.001,s.release=null==r.pitchRelease?0:r.pitchRelease/1e3,s.release+=.001,s}},{key:"triggerAttack",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.get(0),n=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return new Promise(function(){var c=Object(g.a)(v.a.mark(function c(u,l){var p,h;return v.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:p=function(t){setTimeout(function(){void 0===t||void 0===t._source||e.isDisposed()||(e.detuneSignal.disconnect(t._source.detune),s.forEach(function(e){return e.disconnect(t._source.detune)}))},4e3),u()};try{void 0!==(h=t.triggerAttack(n,a,r,i,p,o))&&void 0!==h._source&&(s.forEach(function(e){return e.connect(h._source.detune)}),e.detuneSignal.connect(h._source.detune),s.forEach(function(e){return e.triggerAttack(a)}))}catch(l){console.log(l)}e.lastNote=n;case 3:case"end":return c.stop()}},c)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"triggerAttackRelease",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.get(0),n=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,c=arguments.length>7?arguments[7]:void 0;return new Promise(function(){var u=Object(g.a)(v.a.mark(function u(l,p){var h,d;return v.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:h=1===i.length?function(){return l()}:function(t){setTimeout(function(){void 0===t||void 0===t._source||e.isDisposed()||(e.detuneSignal.disconnect(t._source.detune),i.forEach(function(e){return e.disconnect(t._source.detune)}))},4e3),l()};try{r<0&&(r=0),void 0!==(d=t.triggerAttackRelease(n,a,r,s,o,h,c))&&void 0!==d._source&&(i.forEach(function(e){return e.connect(d._source.detune)}),e.detuneSignal.connect(d._source.detune),i.length>1?i.forEach(function(e){0===e.release?e.triggerAttack(r):e.triggerAttackRelease(a,r)}):i[0].triggerAttackRelease(a,r))}catch(p){console.log(p)}e.lastNote=n;case 3:case"end":return u.stop()}},u)}));return function(e,t){return u.apply(this,arguments)}}())}},{key:"getDuration",value:function(){return this.baseBuffer._buffer.length/q.a.context.sampleRate}},{key:"sliceFirstOnset",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r,s,i,o=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]&&o[0],!(void 0===this.onsets||0===this.onsets.length||this.slices.length>1)){e.next=3;break}return e.abrupt("return");case 3:if(0===(n=this.getSlice(0)).startTime&&(a=this.onsets[0]/1e3)<n.endTime&&this.slice(0,a,n.endTime,!0),!t){e.next=7;break}return e.abrupt("return");case 7:for(r=Math.floor((this.onsets.length-1)/5),s=1;s<Math.min(5,this.onsets.length);s++)(i=this.onsets[s*r]/1e3)<n.endTime&&this.newSlice(i,n.endTime);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"slice",value:function(e,t,n){var a=this,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=this.slices[e];n=void 0==n?this.getDuration():n,s.startTime=t,s.endTime=n;this.alpha;var i=++this.counter;setTimeout(function(){if(i===a.counter||r){var e=a.baseBuffer.slice(t,n);s.buffer.set(e),a.onNewSampler(a)}},100),this.sliceData[e]={startTime:t,endTime:n},this.updateSlicesState()}},{key:"updateSlicesState",value:function(){this.store.dispatch(Object(w.Cc)(this.id,this.slices.map(function(e){return e.getJson()})))}},{key:"syncTempo",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null!=this.tempo&&(t?(this.alpha=this.tempo/e,this.timestretch()):this.baseTranspose=12*(e/this.tempo-1)),this.tempoSynced=!0}},{key:"unsyncTempo",value:function(){this.alpha=1,this.tempoSynced=!1,this.baseTranspose=0}},{key:"timestretch",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(1!=this.alpha){e.next=3;break}return this.unsyncTempo(),e.abrupt("return");case 3:t=this.getDuration(),n=new io(4096),a=this.alpha,n.alpha=a,r=t*a*q.a.context.sampleRate-4096*this.alpha,s=q.a.context.createBuffer(2,r,q.a.context.sampleRate),n.set_audio_buffer(this.baseBuffer.get()),n.process(s);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"reverse",value:function(e){var t=this;this.baseBuffer.reverse=e,this.slices.forEach(function(e,n){return t.slice(n,e.startTime,e.endTime,!0)})}},{key:"isReversed",value:function(){return void 0!==this.baseBuffer&&this.baseBuffer.reverse}},{key:"deleteSlice",value:function(e){1!==this.slices.length&&(this.slices.splice(e,1),this.sliceData.splice(e,1),this.updateSlicesState())}},{key:"newSlice",value:function(e,t){if(void 0!==e||void 0!==t){t=t||this.getDuration();var n=this.baseBuffer.slice(e,t),a=new yo(n,new q.a.Sampler({C3:n},{curve:"linear"}),e,t);return a.sampler.connect(this.gainNode),this.slices.push(a),this.sliceData.push({startTime:e,endTime:t}),this.slice(this.slices.length-1,e,t,!0),this.slices[this.slices.length-1]}}},{key:"getStartTime",value:function(e){return this.slices[e].startTime}},{key:"getEndTime",value:function(e){return null==this.slices[e].endTime&&(this.slices[e].endTime=this.slices[0].buffer._buffer.duration),this.slices[e].endTime}},{key:"getNumberOfSlices",value:function(){return this.slices.length}},{key:"dispose",value:function(){this.audioBuffer=void 0,this.baseBuffer.dispose(),this.slices.forEach(function(e){return e.dispose()}),this.gainNode.dispose(),this.pitchEnvelopes.forEach(function(e){return e.dispose()}),this.baseBuffer=void 0,this.slices=void 0,this.gainNode=void 0,this.pitchEnvelopes=void 0}},{key:"get",value:function(e){return this.slices[e%this.slices.length].sampler}},{key:"getSlice",value:function(e){return this.slices[e%this.slices.length]}},{key:"isLoaded",value:function(){return this.slices.length>0&&this.slices[0].sampler.loaded}},{key:"triggerWaveformAnimation",value:function(e,t,n,a,r){if(this.isWaveformShown()||this.isMixViewShown()){var s=this.getSlice(n),i=s.startTime+r,o=new Event(oo);o.trackNumber=this.track.trackNumber,o.subSequenceId=this.track.subSequence.id,o.startTime=i,o.duration=t,o.sliceStartTime=r,o.sliceDuration=s.getDuration(),o.sliceNumber=n,o.transpose=a,o.time=void 0===e?0:this.track.sequencerEngine.getMilliseconds(e),window.dispatchEvent(o)}}},{key:"triggerReleaseWaveformAnimation",value:function(e){if(this.isWaveformShown()||this.isMixViewShown()){var t=new Event(co);t.time=void 0===e?0:this.track.sequencerEngine.getMilliseconds(e),window.dispatchEvent(t)}}},{key:"isMixViewShown",value:function(){var e=this.track.subSequence.id;return this.track.sequencerEngine.currentSubSequence.id===e&&this.state.sequencer.viewMode===po}},{key:"isWaveformShown",value:function(){return this.track.subSequence.id===this.track.sequencerEngine.currentSubSequence.id&&"SOUND_DETAILS_VIEW"===this.state.sequencer.viewMode&&this.track.sequencerEngine.cursor.track===this.track.trackNumber}},{key:"getCopy",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.track,a={volume:this.volume,offset:this.offset,transpose:this.transpose,reversed:this.isReversed()},r=new e(n,this.sample,t,this.sliceData,a);return r.init(),r}},{key:"isDisposed",value:function(){return void 0===this.audioBuffer}},{key:"transpose",get:function(){return this.transposeParameter.get()},set:function(e){this.transposeParameter.set(e)}},{key:"volume",get:function(){return this.volumeParameter.get()},set:function(e){this.volumeParameter.set(e)}},{key:"state",get:function(){return this.store.getState()}}],[{key:"getDefaultTriggerConfig",value:function(e){return void 0===e.gated&&(e.gated=!0),void 0===e.sliceNumber&&(e.sliceNumber=0),void 0===e.skipRelease&&(e.skipRelease=!1),e}}]),e}(),yo=function(){function e(t,n,a,r){Object(o.a)(this,e),this.buffer=t,this.originalBuffer=t.get(),this.sampler=n,this.startTime=void 0==a?0:a,this.endTime=r,this.slice=void 0}return Object(c.a)(e,[{key:"getDuration",value:function(){return this.endTime-this.startTime}},{key:"dispose",value:function(){this.buffer.dispose(),this.sampler.dispose(),this.originalBuffer=void 0,this.buffer=void 0,this.sampler=void 0,this.startTime=void 0,this.endTime=void 0}},{key:"getJson",value:function(){return{startTime:this.startTime,endTime:this.endTime}}},{key:"getCopy",value:function(){return new e(this.buffer,this.sampler,this.startTime,this.endTime)}}]),e}(),ko=bo;var Eo="DOWN",So=function(){function e(){Object(o.a)(this,e),this.enabled=!1,this.noteToDuration={},this.notes=[],this.index=0,this.currentOctave=0,this.arpRate=new ht(8,!1),this.arpDirection=Eo}return Object(c.a)(e,[{key:"clear",value:function(){this.notesToDuration={},this.notes=[],this.index=0,this.currentOctave=0}},{key:"setEnabled",value:function(e){this.enabled=e}},{key:"toggleEnabled",value:function(){this.enabled=!this.enabled}},{key:"addNote",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;void 0!==t&&(e in this.noteToDuration?this.noteToDuration[e]=this.noteToDuration[e]+2*t:this.noteToDuration[e]=2*t),this.notes.indexOf(e)<0&&(this.notes.push(e),this.notes=this.notes.sort(),this.arpDirection===Eo&&this.notes.reverse(),this.index=this.notes.indexOf(e))}},{key:"removeNote",value:function(e){var t=this.notes.indexOf(e);t>-1&&this.notes.splice(t,1),this.index>=this.notes.length&&(this.index=0,this.currentOctave=0)}},{key:"nextNote",value:function(e){if(0!=this.notes.length){var t=this.notes[this.index];return this.index=(this.index+1)%this.notes.length,0==this.index&&e>0&&("UP"===this.arpDirection?this.currentOctave=(this.currentOctave+1)%(e+1):this.arpDirection===Eo&&(this.currentOctave=(this.currentOctave-1)%(e+1))),t+12*this.currentOctave}}},{key:"getNextTriggers",value:function(e,t){var n=this,a=Ar(t,e.arpRate).map(function(t){return{transpose:n.nextNote(e.arpOctaves),time:t.time,step:t.step}}).filter(function(e){return void 0!==e.transpose});for(var r in this.noteToDuration)this.noteToDuration[r]-=1,this.noteToDuration[r]<=0&&(delete this.noteToDuration[r],this.removeNote(parseInt(r)));return a}}]),e}(),Oo=function(){function e(t,n){Object(o.a)(this,e),this.envelope=t,this.mode=n}return Object(c.a)(e,[{key:"equals",value:function(e){return this.envelope===e.envelope&&this.mode===e.mode}},{key:"getJson",value:function(){return{envelope:this.envelope.number-1,mode:this.mode}}}]),e}(),wo=R.a.presets,Co=new ht(32,!1),Po=new ht(16,!1),To=0,jo={Track:function(){function e(t,n,a,r,s,i){Object(o.a)(this,e),this.subSequence=i,this.id=To++,this.trackNumber=t,this.gated=!0,this.sequencerEngine=n,this.store=n.store,this.parameters=[],this.update=s,this.gainNode=new q.a.PanVol,this.volumeNode=new q.a.Volume,this.muteableNode=new q.a.Volume,this.trackNode=new q.a.Solo,this.volumeParameter=new Xt("volume",this.volumeNode.volume,{defaultValue:0,min:-100,max:0}),this.registerParameter(this.volumeParameter),this.trackMeter=new q.a.Meter(.9),this.faderNode=new q.a.Gain,this.trackNode.connect(this.volumeNode),this.volumeNode.connect(this.faderNode),this.faderNode.connect(this.muteableNode),this.muteableNode.connect(this.trackMeter),this.muted=!1,this.sendNodes=[],this.sendNodeVolumeParameters=[],this.patternNumberLocked=void 0,this.pattern=new Or(this.sequencerEngine,this),this.patterns=[this.pattern];for(var c=1;c<r;c++)this.patterns.push(new Or(this.sequencerEngine,this));this.currentPattern=this.getInitialPattern(),this.soundIds=[],this.auditionedSounds=[],this.toAudition=[],this.trackData=new ot(this.sequencerEngine,this.mix,(new Kn).forTrack(this)),this.trackData.loadDefaults(),this.on=!1,this.samplers={},this.group=null,this.selectedStep=void 0,this.name=void 0,this.videoId="",this.sample=void 0,this.arpManager=new So,this.resampler=void 0,this.masterResampler=new Vs(this.sequencerEngine,this.volumeNode),this.effectsChains=[new ia(this.gainNode,this.trackNode,(new Kn).forTrack(this),this.sequencerEngine)],this.effectsChains[0].initDefault(),this.midiEffects=new ls(this),this.liveEffects=new qi(this),this.midiInputs=new to,this.samples=[],this.connectedEnvelopes=[],this.frozenSamplesToSave=[],this.chokes=new Mi(this)}return Object(c.a)(e,[{key:"registerParameter",value:function(e){this.parameters.push(e),e.setStore(this.store),e.setContext((new Kn).forTrack(this))}},{key:"newEffectsChain",value:function(){var e=new ia(this.gainNode,this.trackNode,(new Kn).forTrack(this),this.sequencerEngine);e.initDefault(),this.effectsChains.push(e),this.store.dispatch(Object(w.ob)(this.subSequence.id,this.trackNumber,this.effectsChains.length-1))}},{key:"deleteEffectsChain",value:function(){var e=this.effectsChains[this.chainNumber];void 0!==e&&(e.dispose(),this.effectsChains.splice(this.chainNumber,1),this.store.dispatch(Object(w.ob)(this.subSequence.id,this.trackNumber,this.effectsChains.length-1)))}},{key:"getEffects",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.chainNumber;return this.effectsChains[e].effects}},{key:"connectToEnvelope",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"POST_FX";for(var n in this.sequencerEngine.tracks){var a=this.sequencerEngine.tracks[n];a.isConnectedToEnvelope(e)&&a.disconnectFromEnvelope(e)}this.connectedEnvelopes.push(new Oo(e,t))}},{key:"disconnectFromEnvelope",value:function(e){for(var t=0;t<this.connectedEnvelopes.length;t++)if(this.connectedEnvelopes[t].envelope===e)return void this.connectedEnvelopes.splice(t,1)}},{key:"getEnvelopeMode",value:function(e){return this.connectedEnvelopes.filter(function(t){return t.envelope===e}).map(function(e){return e.mode})[0]}},{key:"setEnvelopeMode",value:function(e,t){return this.connectedEnvelopes.filter(function(t){return t.envelope===e}).forEach(function(e){return e.mode=t})}},{key:"isConnectedToEnvelope",value:function(e){return this.connectedEnvelopes.some(function(t){return t.envelope===e})}},{key:"start",value:function(){if(this.effectsChains.forEach(function(e){return e.start()}),this.midiEffects.clear(),this.liveEffects.clear(),this.getTrackType()===_n){var e=this.getInstrument();e.hasLFO()&&(e.stop(),e.start())}this.patterns.forEach(function(e){return e.isRecording=!1}),this.scheduleTrackPatternChangeIfAny()}},{key:"linearRampFade",value:function(e,t,n){this.faderNode.gain.linearRampTo(e,.001,q.a.Master.context.currentTime+.001),this.faderNode.gain.linearRampTo(t,n,q.a.Master.context.currentTime+.003)}},{key:"deletePatternLocks",value:function(){this.getAllPatternLockedParameters().forEach(function(e){return e.deleteLocks()}),this.store.dispatch(Object(w.ke)(this.subSequence.id,this.trackNumber,{}))}},{key:"togglePatternLock",value:function(){this.store.dispatch(Object(w.je)(this.subSequence.id,this.trackNumber,this.currentPattern,!this.patternLocked)),this.getAllPatternLockedParameters().forEach(function(e){return e.updateRedux()})}},{key:"getName",value:function(e){return void 0!==e?this.samples[e].name:void 0===this.sample?"":this.sample.name}},{key:"isRecordable",value:function(){return!1}},{key:"setSequencerEngine",value:function(e){this.sequencerEngine=e}},{key:"triggerMidiNoteOn",value:function(e,t){this.triggerSample(0,!1,this.resolution.getTimeInStep(),e+this.trackData.transpose,!0)}},{key:"triggerMidiNoteOff",value:function(e){}},{key:"initPatternBuffer",value:function(e){var t=this.pattern.stepBuckets.length;this.patternRollStepNumber=e%t}},{key:"updatePatternRollStepNumber",value:function(e){if(void 0!==this.patternRollStepNumber){var t=e.getNumberOfStepsAtBaseResolution();this.patternRollStepNumber-=this.patternRollStepNumber%t}}},{key:"getFactoredResolution",value:function(){var e=this.sequencerEngine.rollingResolution,t=this.liveEffects.getEffect(Js);return t&&((e=e.getCopy()).resolution*=t.rollFactor),e}},{key:"solo",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.trackNode.solo=e,t&&this.store.dispatch(Object(w.ne)(this.trackNumber,e))}},{key:"getSolo",value:function(){return this.trackNode.solo}},{key:"dispose",value:function(){var e=this.getAllParameters();this.trackNode.disconnect(this.volumeNode),this.muteableNode.disconnect(this.trackMeter),this.gainNode.dispose(),this.trackNode.dispose(),this.muteableNode.dispose(),this.trackMeter.dispose(),this.faderNode.dispose(),this.sendNodes.forEach(function(e){return e.dispose()}),this.effectsChains.forEach(function(e){return e.dispose()}),this.getSamplers().filter(function(e){return void 0!==e}).forEach(function(e){return e.dispose()}),this.faderNode=void 0,this.gainNode=void 0,this.muteableNode=void 0,this.trackNode=void 0,this.trackMeter=void 0,this.sendNodes=void 0,this.pattern=void 0,this.patterns=void 0,this.soundIds=void 0,this.auditionedSounds=void 0,this.trackData=void 0,this.samplerConnectedToMaster=!1,this.samplers=void 0,this.group=null,this.selectedStep=void 0,this.name=void 0,this.videoId=void 0,this.sample&&this.sample.dispose(!0),this.sample=void 0,this.arpManager=void 0,this.presetId=void 0,this.samplesStream&&(this.samplesStream.dispose(),this.samplesStream=void 0),e.forEach(function(e){return e.dispose()})}},{key:"getTrackType",value:function(){return zn}},{key:"addToGroup",value:function(e){this.muteableNode.connect(e.inputNode),this.group=e}},{key:"disconnectFromGroup",value:function(){this.muteableNode.disconnect(),this.reconnectAll(),this.group=void 0}},{key:"getLoadedSampleIfAny",value:function(e){return this.sequencerEngine.loadedSamples[e]}},{key:"addSound",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n,a){var r;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.store.dispatch(Object(w.ge)(this.subSequence.id,this.trackNumber,!0)),"string"!==typeof t&&"number"!==typeof t){e.next=20;break}if(r=t,this.soundIds.push(r),void 0===this.getLoadedSampleIfAny(r)){e.next=9;break}t=this.getLoadedSampleIfAny(r),void 0===this.sample&&(this.sample=t),e.next=18;break;case 9:return t=new K.a(r),void 0===this.sample&&(this.sample=t),e.prev=11,e.next=14,t.load();case 14:e.next=18;break;case 16:e.prev=16,e.t0=e.catch(11);case 18:e.next=32;break;case 20:if(void 0===this.sample&&(this.sample=t),this.sample.isLoaded()){e.next=31;break}return e.prev=22,e.next=25,this.sample.load();case 25:e.next=31;break;case 27:return e.prev=27,e.t1=e.catch(22),console.log("error in track load"),e.abrupt("return");case 31:this.soundIds.push(t.getId());case 32:if(t.isLoaded()){e.next=34;break}return e.abrupt("return");case 34:this.samples.push(t),a=a||!1,this.loadTrackInfo(a,t,n),this.samplesStream=new ji(t,this.sequencerEngine),this.store.dispatch(Object(w.ge)(this.subSequence.id,this.trackNumber,!1));case 39:case"end":return e.stop()}},e,this,[[11,16],[22,27]])}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"auditionNext",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r,s=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]&&s[0],n=(new Date).getTime(),e.prev=2,!this.loadingAudition){e.next=5;break}return e.abrupt("return");case 5:if(this.samplesStream.hasNext()){e.next=7;break}return e.abrupt("return");case 7:return this.loadingAudition=!0,e.next=10,this.samplesStream.getNext();case 10:a=e.sent,this.loadingAudition=!1,this.useSound(a,t),r=(new Date).getTime(),r-n,e.next=20;break;case 17:e.prev=17,e.t0=e.catch(2),this.loadingAudition=!1;case 20:case"end":return e.stop()}},e,this,[[2,17]])}));return function(){return e.apply(this,arguments)}}()},{key:"auditionPrevious",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]&&a[0],e.prev=1,!this.loadingAudition){e.next=4;break}return e.abrupt("return");case 4:if(this.samplesStream.hasPrevious()){e.next=6;break}return e.abrupt("return");case 6:return this.loadingAudition=!0,e.next=9,this.samplesStream.getPrevious();case 9:n=e.sent,this.loadingAudition=!1,this.useSound(n,t),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),this.loadingAudition=!1;case 17:case"end":return e.stop()}},e,this,[[1,14]])}));return function(){return e.apply(this,arguments)}}()},{key:"useSound",value:function(e,t){if(t)for(var n in this.samplers)this.samplers[n].dispose(),delete this.samplers[n];this.sample=e,this.soundIds=[e.getId()],this.toAudition.push(e.getId()),this.loadTrackInfo(!0,e)}},{key:"auditionSound",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>1&&void 0!==r[1]&&r[1],a=r.length>2?r[2]:void 0,t.isLoaded()){e.next=5;break}return e.next=5,t.load();case 5:this.savedSoundIds=Object(ge.a)(this.soundIds),this.soundIds=[t.getId()],this.toAudition.push(t.getId()),this.auditionedSounds.push(t.getId()),this.samplesStream&&n&&this.samplesStream.dispose(),this.samplesStream=a||new ji(t,this.sequencerEngine),this.loadTrackInfo(!0,t);case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"isAuditioning",value:function(){return this.auditionedSounds.length>0}},{key:"completeAudition",value:function(){for(var e in this.auditionedSounds)if(-1==this.soundIds.indexOf(this.auditionedSounds[e])){var t=this.samplers[this.auditionedSounds[e]];t&&(t.dispose(),delete this.samplers[this.auditionedSounds[e]])}this.auditionedSounds=[],this.store.dispatch(Object(w.zc)(void 0))}},{key:"cancelAudition",value:function(){this.isAuditioning()&&(this.soundIds=this.savedSoundIds,this.revertAuditionedSounds()),this.store.dispatch(Object(w.zc)(void 0))}},{key:"revertAuditionedSounds",value:function(){for(var e in this.auditionedSounds){var t=this.samplers[this.auditionedSounds[e]];t&&(t.dispose(),delete this.samplers[this.auditionedSounds[e]])}this.auditionedSounds=[]}},{key:"loadTrackInfo",value:function(e,t,n){var a=this;void 0===n&&(n={slices:void 0,offset:0,transpose:0,volume:0}),e=e||!0;var r=this;this.store.dispatch(Object(w.yc)(t.getId(),t.getJson())),e?(this.videoId=t.videoId,this.sample=t,void 0===this.videoId&&"MIDI"!==this.getTrackType()&&(this.name=t.name),this.update()):(this.name=t.name,this.update());var s=n.slices;this.samplers[t.getId()]=new ko(this,t,function(e){return a.onNewSampler(r,e)},s,n),this.samplers[t.getId()].init(),t.addedToProject=!0}},{key:"updateEffects",value:function(e){void 0===e&&(e=this.effects),this.effectsChains[this.chainNumber].updateEffects(e)}},{key:"onNewSampler",value:function(e,t){for(var n in this.samplers)if(t===this.samplers[n]&&this.toAudition.indexOf(n)>-1&&this.isWarped()){var a=this.toAudition.indexOf(n);this.toAudition.splice(a,1),t.sliceFirstOnset();break}t.gainNode.connect(this.gainNode),e.switchToPattern(e.currentPattern),e.setVolume(e.getVolume(),!0),e.setPanning(e.getPanning())}},{key:"liveTrigger",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.triggerSample(t,e.transpose,!0),this.chokes.liveTrigger()}},{key:"releaseAll",value:function(e){this.getSamplers().filter(function(e){return void 0!==e}).filter(function(e){return e.isLoaded()}).map(function(t){return t.releaseAll(e)})}},{key:"liveTriggerRelease",value:function(e,t){this.gated&&(this.triggerRelease(e,t),this.chokes.liveRelease())}},{key:"trigger",value:function(e,t){var n=this;t=t||q.a.Master.context.currentTime,this.getSamplers().filter(function(e){return void 0!==e}).filter(function(e){return e.isLoaded()}).map(function(a){return a.trigger({gated:!!n.isWarped()||n.gated,stepData:e,time:t,sliceNumber:e.slice})})}},{key:"triggerFrozenSample",value:function(e,t){this.getSamplers().filter(function(e){return void 0!==e}).filter(function(e){return e.isLoaded()}).map(function(n){return n.trigger({gated:!1,stepData:e,time:t,sliceNumber:e.slice})})}},{key:"triggerSamples",value:function(e,t){var n=this;this.soundIds.filter(function(e){return n.isRecordingPlaying(e)}).map(function(e){return n.samplers[e]}).filter(function(e){return void 0!==e}).filter(function(e){return e.isLoaded()}).map(function(n){return n.trigger({gated:!1,stepData:e,time:t})})}},{key:"triggerSlice",value:function(e){var t=this.trackData.transpose;this.triggerSample(e,t)}},{key:"triggerSample",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.getSamplers().filter(function(e){return void 0!==e}).filter(function(e){return e.isLoaded()}).forEach(function(r){return r.trigger({gated:!!n.isWarped()||n.gated,sliceNumber:e,stepData:n.trackData,transpose:t,skipRelease:a})})}},{key:"triggerRelease",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.getSamplers().filter(function(e){return e.isLoaded()}).forEach(function(n){return n.release(t,e)})}},{key:"setSends",value:function(e){var t=this;this.sends=e,this.sends.getSends().map(function(e){return t.newSend(e)})}},{key:"setSendVolume",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.addEvent(new gt(this,e,t),n),this.sendNodeVolumeParameters[e].set(t),this.store.dispatch(Object(w.me)(this.trackNumber,e,t))}},{key:"setupEffects",value:function(){var e=this.effectsChains[this.chainNumber];e&&e.setupEffects()}},{key:"newSend",value:function(e){var t=new q.a.Volume(-100);this.muteableNode.connect(t),e.connectToTrack(t),this.sendNodes.push(t);var n=new Xt("send volume",t.volume,{defaultValue:-100,min:-100,max:0});this.registerParameter(n),this.sendNodeVolumeParameters.push(n)}},{key:"reconnectAll",value:function(){var e=this;this.sendNodes.forEach(function(t){return e.muteableNode.connect(t)}),this.muteableNode.connect(this.trackMeter)}},{key:"toggleEnabled",value:function(){this.setIsEnabled(!this.isEnabled)}},{key:"setIsEnabled",value:function(e){this.isEnabled=e,this.isEnabled&&this.store.dispatch(Object(w.we)(!1)),this.store.dispatch(Object(w.fe)(this.subSequence.id,this.trackNumber,this.isEnabled))}},{key:"getSendNodes",value:function(){return this.sendNodes}},{key:"getSampler",value:function(e){return e=e||0,this.samplers[this.soundIds[e]]}},{key:"getSamplers",value:function(){var e=this;return this.soundIds.map(function(t){return e.samplers[t]})}},{key:"deleteSound",value:function(e){var t=this.soundIds.indexOf(e);t>-1&&(this.soundIds.splice(t,1),delete this.samplers[e],this.soundId=this.soundIds[0])}},{key:"getVolume",value:function(){return this.pattern.volume}},{key:"getMuted",value:function(){return this.pattern.isMuted}},{key:"newPattern",value:function(e){var t=this;if(e=void 0!==e&&e){var n=this.pattern.getCopy();this.patterns.push(n);this.patterns.length;this.getAllPatternLockedParameters().forEach(function(e){return e.newPattern(t.currentPattern,t.patterns.length-1)}),this.store.dispatch(Object(w.je)(this.subSequence.id,this.trackNumber,this.patterns.length-1,this.patternLocked))}else this.patterns.push(new Or.Pattern(this.sequencerEngine,this))}},{key:"switchToPattern",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e>=0&&e<this.patterns.length){var t=this.patterns[e],n=t.volume,a=t.muted;this.pattern=t,this.currentPattern=e,this.setVolume(n,!0),this.mute(a,!0);(new Date).getTime();var r=this.getAllPatternLockedParameters(),s={};for(var i in r){var o=r[i].updateRedux(!0);void 0!==o&&(s[o.id]=o.value)}(new Date).getTime();return this.setPanning(this.pattern.panning),s}return{}}},{key:"getAllParameters",value:function(){var e=[].concat(Object(ge.a)(this.trackData.parameters),Object(ge.a)(this.parameters));for(var t in this.effectsChains)e=[].concat(Object(ge.a)(e),Object(ge.a)(this.effectsChains[t].getAllParameters()));return e=[].concat(Object(ge.a)(e),Object(ge.a)(this.midiEffects.getAllParameters()))}},{key:"getAllPatternLockedParameters",value:function(){var e=[].concat(Object(ge.a)(this.trackData.parameters),Object(ge.a)(this.parameters)).filter(function(e){return e.hasPatternLockedValues()});for(var t in this.effectsChains){var n=this.effectsChains[t].getAllPatternLockedParameters();for(var a in n)e.push(n[a])}return this.midiEffects.getAllPatternLockedParameters().forEach(function(t){return e.push(t)}),e}},{key:"deletePattern",value:function(e){if(this.patterns.splice(e,1),this.getAllPatternLockedParameters().forEach(function(t){return t.deletePattern(e)}),void 0!==this.store.getState().tracks.trackPatternLocks[this.subSequence.id]){var t=Object(X.a)({},this.store.getState().tracks.trackPatternLocks[this.subSequence.id][this.trackNumber]);this.store.dispatch(Object(w.ke)(this.subSequence.id,this.trackNumber,_t(e,t)))}}},{key:"movePatternTo",value:function(e,t){if(e!=t){var n=[];e>t?(n=this.patterns.slice(0,t).concat([this.patterns[e]]).concat(this.patterns.slice(t,e)),this.patterns.length>e+1&&(n=n.concat(this.patterns.slice(e+1)))):(n=this.patterns.slice(0,e).concat(this.patterns.slice(e+1,t)).concat([this.patterns[t],this.patterns[e]]),this.patterns.length>t+1&&(n=n.concat(this.patterns.slice(t+1)))),this.patterns=n,this.getAllPatternLockedParameters().forEach(function(n){return n.movePatternTo(e,t)});var a=Object(X.a)({},this.store.getState().tracks.trackPatternLocks[this.subSequence.id][this.trackNumber]);this.store.dispatch(Object(w.ke)(this.subSequence.id,this.trackNumber,zt(e,t,a)))}}},{key:"getStepAtResolution",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.resolution,n=this.getStepsAtResolution(t);return n[Math.floor(e)%n.length]}},{key:"getStepsAtResolution",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Co;return this.pattern.getStepsAtResolution(e).slice(0,this.pattern.length(e))}},{key:"getBucketsAtResolution",value:function(e){return this.pattern.getBucketsAtResolution(e)}},{key:"getFillsAtResolution",value:function(e){return this.pattern.getFillsAtResolution(e)}},{key:"getStepDataForStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.getCopy(!1,!1,!0,!0,t),a=n.getPolyphony();for(var r in a){var s=a[r];s.duration=null==s.durationParameter.value?this.trackData.duration:s.duration,s.transpose=null==s.transposeParameter.value?this.trackData.transpose:s.transpose,s.velocity=null==s.velocityParameter.value?this.trackData.velocity:s.velocity,s.start=null==s.startParameter.value?this.trackData.start:s.start,s.chop=null==s.chopParameter.value?this.trackData.chop:s.chop,s.chopDuration=null==s.chopDurationParameter.value?this.trackData.chopDuration:s.chopDuration,s.attack=null==s.attackParameter.value?this.trackData.attack:s.attack,s.release=null==s.releaseParameter.value?this.trackData.release:s.release,s.slice=null==s.sliceParameter.value?this.trackData.slice:s.slice,s.panning=s.panningParameter.value,s.pitchAttack=null==s.pitchAttackParameter.value?this.trackData.pitchAttack:s.pitchAttack,s.pitchDecay=null==s.pitchDecayParameter.value?this.trackData.pitchDecay:s.pitchDecay,s.pitchSustain=null==s.pitchSustainParameter.value?this.trackData.pitchSustain:s.pitchSustain,s.pitchRelease=null==s.pitchReleaseParameter.value?this.trackData.pitchRelease:s.pitchRelease,s.monophonic=null==s.monophonicParameter.value?this.trackData.monophonic:s.monophonic,s.reverse=null==s.reverse?this.trackData.reverse:s.reverse,s.effectAutomations=s.effectAutomations}return n}},{key:"getMainSoundId",value:function(){return this.soundIds[0]}},{key:"calculateFills",value:function(){this.pattern.calculateFills(this.trackData)}},{key:"updateStepDuration",value:function(e,t,n){n=n||Co;var a=this.getBucketsAtResolution(n);for(var r in a[e].steps){var s=a[e].getStep(r);s.on&&(s.duration=t)}this.pattern.calculateFills(this.trackData),this.updateSteps()}},{key:"doubleTrackLength",value:function(){this.pattern.doubleTrackLength(),this.pattern.calculateFills(this.trackData),this.updateSteps()}},{key:"halfTrackLength",value:function(){this.pattern.halfTrackLength(),this.pattern.calculateFills(this.trackData),this.updateSteps()}},{key:"getJson",value:function(){for(var e={},t=0;t<this.soundIds.length;t++){var n=this.samplers[this.soundIds[t]];n&&(e[this.soundIds[t]]=n.getJson())}var a=this.store.getState().tracks.trackPatternLocks[this.trackNumber]||{},r=[];for(var s in this.sendNodeVolumeParameters){var i=this.sendNodeVolumeParameters[s],o={volume:i.get()};o=ln(o,"volumeParameter",i),r.push(o)}return{annotations:this.annotations.map(function(e){return e.getJson()}),isMuted:this.pattern.isMuted,sends:r,isNewVolume:!0,volume:this.pattern.volume,samplers:e,gated:this.gated,type:this.getTrackType(),patternLocks:a,envelopeConnections:this.connectedEnvelopes.map(function(e){return e.getJson()}),isFrozen:this.isFrozen,isFrozenPlaying:this.isFrozenPlaying,frozenJson:this.frozenJson,chokes:this.chokes.getJson(),rawVolume:this.volumeNode.volume.value}}},{key:"setPanning",value:function(e,t){void 0!==t?this.gainNode.pan.linearRampToValueAtTime(e,Math.max(0,t)):this.gainNode.pan.value=e,this.pattern.panning=e,this.store.dispatch(Object(w.ie)(this.trackNumber,e))}},{key:"getPanning",value:function(){return this.pattern.panning}},{key:"setVolume",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.addEvent(new dt(this,e),t),this.pattern.volume=e,e>6&&(e=le(e,0,128)),this.volumeParameter.set(e),this.store.dispatch(Object(w.pe)(this.trackNumber,e))}},{key:"setRawVolume",value:function(e){this.volumeParameter.set(e),this.pattern.volume=e+15}},{key:"mute",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=void 0===e||e,this.addEvent(new mt(this,e),t),this.muted=e,this.muteableNode.mute=e,this.pattern.muted=e,this.store.dispatch(Object(w.he)(this.trackNumber,e))}},{key:"moveEffectTo",value:function(e,t){this.effectsChains[this.chainNumber].moveEffectTo(e,t)}},{key:"moveMidiEffectTo",value:function(e,t){this.midiEffects.moveEffectTo(e,t)}},{key:"onBPMUpdated",value:function(){this.effectsChains.forEach(function(e){return e.onBPMUpdated()})}},{key:"getEffectNumber",value:function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.midiEffects.getEffectNumber(e):this.effectsChains[this.chainNumber].getEffectNumber(e)}},{key:"deleteEffect",value:function(e){this.effectsChains[this.chainNumber].deleteEffect(e)}},{key:"numberOfSlices",value:function(){var e=0;for(var t in this.samplers)this.samplers[t].slices.length>e&&(e=this.samplers[t].slices.length);return e}},{key:"isLoaded",value:function(){return this.soundIds.length>0&&void 0!==this.getSampler(0)&&this.getSampler(0).isLoaded()}},{key:"updateStepData",value:function(e,t,n){var a=Co.transformStepAtResolution(t,n),r=Math.floor(a),s=this.pattern.stepBuckets[r];for(var i in s.steps){if(s.getStep(i).on){s.setStep(i,e,!0),this.pattern.syncBuckets();break}}this.updateSteps()}},{key:"stepSelected",value:function(e){this.selectedStep=e}},{key:"stepUnselected",value:function(e){this.selectedStep=void 0}},{key:"isReversed",value:function(){return this.getSamplers().filter(function(e){return void 0!==e}).some(function(e){return e.isReversed()})}},{key:"reverse",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.getSamplers().forEach(function(t){return t.reverse(e)})}},{key:"addEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.store.getState();!t&&this.isRecordingAutomations()&&this.mix.addEvent(e)}},{key:"isRecordingAutomations",value:function(){return"RECORD"===this.state.sequencer.automationMode&&this.state.sequencer.isRecording||this.state.mix.isRecordingMix}},{key:"setKeyboardEngine",value:function(e){this.keyboardEngine=e}},{key:"updateSteps",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];arguments.length>1&&void 0!==arguments[1]&&arguments[1]||(this.store.dispatch(Object(w.pe)(this.trackNumber,this.pattern.volume)),this.store.dispatch(Object(w.ie)(this.trackNumber,this.pattern.panning)),this.store.dispatch(Object(w.he)(this.trackNumber,this.muted)),this.store.dispatch(Object(w.fe)(this.subSequence.id,this.trackNumber,this.isEnabled)));var t=this.pattern.getUpdateStepsAction(e),n=void 0;if(this.subSequence.isTrack)for(var a in n={},this.patterns)n[a]=this.patterns[a].getTrackStepsAction();this.store.dispatch(Object(w.s)(t.trackNumber,t.steps,t.pianoRollSteps,t.trackFills,t.stepToId,t.pianoRollPositions,t.pianoRollDurations,n))}},{key:"getUpdateStepsAction",value:function(){return this.pattern.getUpdateStepsAction()}},{key:"getEasyPattern",value:function(){return new va(this.pattern,this.trackData)}},{key:"deleteMidiInput",value:function(e){this.midiInputs.deleteMidiInput(e)}},{key:"addMidiInput",value:function(e){this.midiInputs.addMidiInput(e)}},{key:"getInstrumentType",value:function(){return zn}},{key:"clearEffectsAndSamplers",value:function(){this.effectsChains.forEach(function(e){return e.dispose()}),this.midiEffects.effects=[],this.liveEffects.effects=[],this.samplers={};var e=this.getSamplers();this.soundIds=[],e.filter(function(e){return void 0!==e}).forEach(function(e){return e.dispose()}),this.trackData=new ot(this.sequencerEngine,this.mix,(new Kn).forTrack(this)),this.trackData.loadDefaults()}},{key:"freeze",value:function(e){var t=this.sample;t&&(e.name=t.name,e.tags=e.tags.concat(t.tags),e.videoId=t.videoId,e.sourceSample=t,this.frozenSamplesToSave=[e]),this.frozenJson=this.sequencerEngine.getTrackPreset(this.trackNumber),this.store.dispatch(Object(w.ee)(this.subSequence.id,this.trackNumber,!0)),this.clearEffectsAndSamplers(),this.effectsChains=[new ia(this.gainNode,this.trackNode,(new Kn).forTrack(this),this.sequencerEngine)],this.effectsChains[0].initDefault(),this.loadTrackInfo(!1,e),this.soundIds=[e.getId()],this.isFrozenPlaying=!0}},{key:"unfreezeInstrument",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.frozenJson;this.sequencerEngine.loadSamplersIntoTrack(this,e.trackParameters,this.sequencerEngine.tracks.length,this.sequencerEngine.currentSubSequence)}},{key:"unfreeze",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.clearEffectsAndSamplers(),this.store.dispatch(Object(w.ee)(this.subSequence.id,this.trackNumber,!1)),this.unfreezeInstrument(),this.trackData=new ot(this.sequencerEngine,this.mix,(new Kn).forTrack(this)),this.trackData.loadDefaults(),this.trackData.loadFromJson(this.frozenJson.trackData,void 0,!1,!1,this.sequencerEngine),e.next=8,this.sequencerEngine.loadEffectsPreset(this.frozenJson,!1,this);case 8:this.effectsChains.forEach(function(e){return e.effects.forEach(function(e){return e.parameters.forEach(function(e){e.set(e.get())})})});case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fromJson",value:function(e){if(void 0!==e.isFrozen&&(this.isFrozen=e.isFrozen),void 0!==e.annotations)for(var t in e.annotations){var n=e.annotations[t],a=n.x,r=n.y,s=n.text;this.newAnnotation(a,r,s)}if(void 0!==e.isFrozenPlaying&&(this.isFrozenPlaying=e.isFrozenPlaying),this.frozenJson=e.frozenJson,this.currentPattern=this.getInitialPattern(),e.sends)for(var i in e.sends)this.sendNodeVolumeParameters[i].set(e.sends[i].volume),pn(e.sends[i],"volumeParameter",this.sendNodeVolumeParameters[i])}},{key:"warp",value:function(){var e=this.midiEffects.effects.filter(function(e){return"Warp"===e.name})[0];e?this.operationManager.dispatch(Hi(e,this)):this.operationManager.dispatch(Ui(new Zr(this),this)),this.getSamplers()[0].sliceFirstOnset()}},{key:"isWarped",value:function(){return this.midiEffects.effects.filter(function(e){return"Warp"===e.name}).filter(function(e){return e.enabled}).length>0}},{key:"mateWithPreset",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r,s,i,o,c=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:.5,a=c.length>2?c[2]:void 0,e.next=4,wo.getPresetData(t.contentHash);case 4:for(s in(r=e.sent).lfos)this.sequencerEngine.lfos[s].lfo.mateJson(r.lfos[s],n);if(this.instrument.mateJson(r.trackParameters.instrument,n),!a){e.next=14;break}return e.next=10,this.sequencerEngine.getEffectsPreset(r,this);case 10:for(i=e.sent,this.effectsChains[0].mate(i.effectsChains[0],n),o=1;o<i.effectsChains.length;o++)i.effectsChains[o].dispose();i.midiEffects&&this.midiEffects.mate(i.midiEffects,n);case 14:return this.sequencerEngine.update(),e.abrupt("return");case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"extractStems",value:function(){var e=this;return new Promise(function(t){var n=e.sample.audioBuffer,a=[n.getChannelData(0),n.getChannelData(1)];new Fs.a(2).exportToWAV(a,function(){var n=Object(g.a)(v.a.mark(function n(a){var r;return v.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,B.a.addBytesArray(a);case 2:r=n.sent,fetch("/splitStems/"+r,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(){var n=Object(g.a)(v.a.mark(function n(a){var r,s,i,o,c;return v.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=a.drums?e.sample.getCopyWith(a.drums,"drums"):void 0,s=a.vocals?e.sample.getCopyWith(a.vocals,"vocals"):void 0,i=a.bass?e.sample.getCopyWith(a.bass,"bass"):void 0,o=a.other?e.sample.getCopyWith(a.other,"other"):void 0,c=[r,s,i,o].filter(function(e){return void 0!==e}).map(function(e){return e.fetchAudio()}),n.next=7,Promise.all(c);case 7:r&&(e.sequencerEngine.addSound(r),e.sequencerEngine.addSampleToSync(r)),s&&(e.sequencerEngine.addSound(s),e.sequencerEngine.addSampleToSync(s)),i&&(e.sequencerEngine.addSound(i),e.sequencerEngine.addSampleToSync(i)),o&&(e.sequencerEngine.addSound(o),e.sequencerEngine.addSampleToSync(o)),t();case 12:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}());case 4:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}())})}},{key:"extractGroove",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r,s,i,o,c,u,l,p,h;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getSamplers()[0],n=t.onsets,a=t.tempo,r=t.slices[0].startTime,n=n.filter(function(e){return e/1e3>=r}),s=Qi(n,a,this.sequencerEngine.bpm),"QmRHeFU644J9LFZoPzd93M4WqF8tyhydDYL2EZWS6dmbF8",e.next=9,this.sequencerEngine.addSound("QmRHeFU644J9LFZoPzd93M4WqF8tyhydDYL2EZWS6dmbF8");case 9:for(c in i=e.sent,o=i.getEasyPattern(),s.steps.forEach(function(e){return o.addStep(i.getNewStep(),e.stepNumber,Co,e.offset,!1,!0)}),s.timings)u=s.timings[c].resolution,l=s.timings[c].odd,p=s.timings[c].even,(h=new Br(i)).oddOffset=l,h.evenOffset=p,h.resolution=32/u,i.midiEffects.addEffect(h);o.update(!1),i.updateSteps();case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getNewStep",value:function(){var e=new ot(this.sequencerEngine,void 0,void 0,this);return e.on=!0,e}},{key:"showEffects",value:function(e){this.store.dispatch(Object(w.Cd)(this.trackNumber,e))}},{key:"isEffectsShowing",value:function(){return this.state.tracks.showTrackEffects[this.trackNumber]}},{key:"restart",value:function(){}},{key:"onStepEnded",value:function(){}},{key:"onNewStep",value:function(){this.midiEffects.onNewStep()}},{key:"getInitialPattern",value:function(){if(!this.subSequence.isTrack)return 0}},{key:"scheduleTrackPatternChangeIfAny",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sequencerEngine.trackStep;arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.subSequence.isTrack&&!this.patterns.some(function(e){return e.isRecording})){for(var t in this.patterns){t=parseInt(t);var n=this.patterns[t],a=n.startStep;if(void 0!==a&&(e>=a&&e<a+n.length()))return void(t!==this.currentPattern&&this.switchToPattern(t))}this.currentPattern=void 0,this.pattern=this.patterns[0]}}},{key:"getGuildIds",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.sample){e.next=2;break}return e.abrupt("return",[0]);case 2:return e.next=4,R.a.guildSamples.getGuildIdForSound(this.sample.getId());case 4:return t=e.sent,e.abrupt("return",void 0===t?[0]:[t]);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"makePublicIfNeeded",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"replaceSoundId",value:function(e,t){var n=this.soundIds.indexOf(e);if(-1!==n){this.soundIds[n]=t;var a=this.samplers[this.sample.getId()];this.samplers[t]=a,this.sample.ipfsHash=t,delete this.samplers[e]}}},{key:"rolling",get:function(){var e=this.liveEffects.getEffect(Js);if(!e)return this.sequencerEngine.rolling;switch(e.mode){case _s:return!0;case Gs:return!1;default:return this.sequencerEngine.rolling}}},{key:"patternLocked",get:function(){var e=this.store.getState().tracks.trackPatternLocks[this.subSequence.id];return void 0!==e&&((e[this.trackNumber]||{})[this.currentPattern]||!1)}},{key:"fade",set:function(e){var t=function(e){return Math.exp(1-1/Math.pow(e,1.01))}(e);this.faderNode.gain.setValueAtTime(t,1e-4)}},{key:"patternLocks",set:function(e){for(var t in e)this.store.dispatch(Object(w.je)(this.subSequence.id,this.trackNumber,t,e[t]));this.getAllPatternLockedParameters().forEach(function(e){return e.updateRedux()})}},{key:"resolution",get:function(){return this.sequencerEngine.resolution}},{key:"mix",get:function(){return this.state.sequencer.isRecording&&"RECORD"===this.state.sequencer.automationMode?this.pattern.mix:this.subSequence.mix}},{key:"chainNumber",get:function(){return(this.store.getState().effects.effectsChainToShow[this.subSequence.id]||{})[this.trackNumber]||0}},{key:"effectsChain",get:function(){return this.effectsChains[this.chainNumber]}},{key:"effects",get:function(){return void 0===this.effectsChains[this.chainNumber]?[]:this.effectsChains[this.chainNumber].effects}},{key:"length",get:function(){return this.pattern.length()}},{key:"state",get:function(){return this.store.getState()}},{key:"isFrozen",get:function(){return(this.store.getState().tracks.tracksFrozen[this.subSequence.id]||{})[this.trackNumber]},set:function(e){this.store.dispatch(Object(w.ee)(this.subSequence.id,this.trackNumber,e))}},{key:"isFrozenPlaying",get:function(){return(this.store.getState().tracks.frozenTracksPlaying[this.subSequence.id]||{})[this.trackNumber]},set:function(e){this.store.dispatch(Object(w.wb)(this.subSequence.id,this.trackNumber,e))}},{key:"tempo",get:function(){return void 0===this.getSamplers()[0]?void 0:this.getSamplers()[0].tempo}},{key:"operationManager",get:function(){return this.sequencerEngine.operationManager}}]),e}(),baseResolution:Co,oldDefaultResolution:Po};var xo=function(){function e(t){Object(o.a)(this,e),this.type=t}return Object(c.a)(e,[{key:"execute",value:function(e){}}]),e}(),No=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,ws))).sequencerEngine=e,a.resolution=n,a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(e){var t=this,n=qo.filter(function(e){return e.isTriplet===t.resolution.isTriplet}),a=127/n.length,r=Math.floor(e/a);r>=n.length&&(r=n.length-1);var s=n[r];this.sequencerEngine.resolution.equals(s)||(this.sequencerEngine.resolution=s)}}]),t}(xo),qo=[new ht(4,!1),new ht(4,!0),new ht(8,!1),new ht(8,!0),new ht(16,!1),new ht(16,!0),new ht(32,!1),new ht(32,!0)],Mo=No,Do=function(){function e(){Object(o.a)(this,e),this.parameterLocks=[]}return Object(c.a)(e,[{key:"addParameterLock",value:function(e,t,n,a,r){this.parameterLocks.push(new Ao(e,t,n,a,r))}},{key:"deleteParameterLock",value:function(e){var t=this.parameterLocks.indexOf(e);t>-1&&this.parameterLocks.splice(t,1)}},{key:"fromJson",value:function(e,t){for(var n in e){var a=e[n],r=void 0===a.effectNumber?this.getTrackParameterFromJson(a,t):this.getEffectParameterFromJson(a,t);void 0!==r&&this.parameterLocks.push(new Ao(a.trackNumber,a.groupNumber,a.sendNumber,a.effectNumber,r))}}},{key:"getTrackParameterFromJson",value:function(e,t){var n=e.trackNumber;if(void 0!==n){var a=t.tracks[n].trackData,r=e.parameter.name,s=a.parameters.filter(function(e){return e.name===r});if(!(s.length<1)){var i=s[0];return i.min=e.parameter.min,i.max=e.parameter.max,i}}}},{key:"getEffectParameterFromJson",value:function(e,t){var n=void 0;if(void 0!==e.trackNumber)n=t.tracks[e.trackNumber].effects[e.effectNumber];else if(void 0!==e.groupNumber){var a=t.groups.groups[e.groupNumber];if(void 0===a)return;n=a.effects[e.effectNumber]}else if(void 0!==e.sendNumber){n=t.sends.sends[e.sendNumber].effects[e.effectNumber]}if(void 0!==n){var r=e.parameter.name,s=n.parameters.filter(function(e){return e.name===r});if(!(s.length<1)){var i=s[0];return i.min=e.parameter.min,i.max=e.parameter.max,i}}}},{key:"getJson",value:function(){return this.parameterLocks.map(function(e){return e.getJson()})}}]),e}(),Ao=function(){function e(t,n,a,r,s){Object(o.a)(this,e),this.trackNumber=t,this.sendNumber=a,this.groupNumber=n,this.effectNumber=r,this.parameter=s}return Object(c.a)(e,[{key:"getJson",value:function(){var e={parameter:this.parameter.getJson(),effectNumber:this.effectNumber};return void 0!==this.trackNumber&&(e.trackNumber=this.trackNumber),void 0!==this.groupNumber&&(e.groupNumber=this.groupNumber),void 0!==this.sendNumber&&(e.sendNumber=this.sendNumber),e}}]),e}(),Ro=Do,Io=(new nt(0),function(){function e(t,n,a){Object(o.a)(this,e),this.text=a,this.x=t,this.y=n}return Object(c.a)(e,[{key:"getJson",value:function(){return{text:this.text,x:this.x,y:this.y}}}]),e}()),Lo=function(e){function t(e,n,a,r,s,i){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e,n,a,r,s,i))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getCopy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e,n,a,r,s,i){return new t(e,n,a,r,s,i)},n=this.trackData.getCopy(),a=this.patterns.map(function(e){return e.getCopy()}),r=this.currentPattern,s=a[r],i=[].concat(this.soundIds),o=e(this.trackNumber,this.sequencerEngine,this.mixSession,this.patterns.length,this.update,this.subSequence);for(var c in a){var u=a[c];for(var l in u.stepBuckets)for(var p in u.stepBuckets[l].track=o,u.stepBuckets.steps)u.stepBuckets.steps[p].track=o;u.track=o}this.sample&&(o.sample=this.sample.getCopy()),o.name=this.name,o.videoId=this.videoId,o.effectsChains=this.effectsChains.map(function(e){return e.getCopy(o)}),o.midiEffects=this.midiEffects.getCopy(o),o.trackData=n,o.patterns=a,o.currentPattern=r,o.pattern=s,o.soundIds=i;var h={};for(var d in this.samplers)h[d]=this.samplers[d].getCopy(function(e){return o.onNewSampler(o,e)},o);return o.samplers=h,o.updateSteps(!0),this.samplesStream?o.samplesStream=this.samplesStream.getCopy(o.sample):o.samplesStream=new ji(o.sample,this.sequencerEngine),o}},{key:"addNotes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sequencerEngine.bpm,a=q.a.Time("16n").toMilliseconds();e=e.map(function(e){var r=e.velocity/127;return{transpose:e.pitch-60,startTime:1e3*e.startTime,velocity:r,duration:n/t.sequencerEngine.bpm*(1e3*(e.endTime-e.startTime))/a}});q.a.Time("32n").toMilliseconds();var r=-1;for(var s in e){var i=$i(e[s].startTime,n,this.sequencerEngine.bpm);e[s].step=i.stepNumber,e[s].position=i.offset,e[s].step>r&&(r=e[s].step)}for(;r>=this.pattern.length();)this.sequencerEngine.doubleTrackLength(this.trackNumber);var o=this.getEasyPattern();e.forEach(function(e){return o.addStep(t.getStepDataForNote(e),e.step,jo.baseResolution,e.position,!1,!0)}),o.update(!1),this.updateSteps()}},{key:"getStepDataForNote",value:function(e){var t=new ot(this.sequencerEngine,void 0,void 0,this);return t.on=!0,t.transpose=e.transpose,t.duration=e.duration,t.velocity=e.velocity,t}},{key:"toggleStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.store.getState().sequencer.resolution,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;this.pattern.toggleStep(jo.baseResolution.transformStepAtResolution(e,t),t,n,this.trackData.transpose===n),this.pattern.syncBuckets(),this.updateSteps()}},{key:"getStep",value:function(e){return this.pattern.getAnyStep(e%this.pattern.length())}},{key:"recordHit",value:function(e,t,n,a,r){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;t=t||jo.baseResolution;var i=new ot(void 0,void 0,void 0,this);if(i.on=!0,i.slice=n,i.duration=a,i.transpose=r,i.velocity=s,void 0===this.currentPattern){console.log("current pattern is undefined");var o=new Or(this.sequencerEngine,this),c=e-e%t.transformStepAtResolution2(16,jo.baseResolution);o.startStep=jo.baseResolution.transformStepAtResolution2(c,t),this.patterns.push(o),this.switchToPattern(this.patterns.length-1),this.updateSteps()}void 0!==this.pattern.startStep&&(console.log("pattern.startStep = %s",this.pattern.startStep),e-=t.transformStepAtResolution2(this.pattern.startStep,jo.baseResolution)),this.pattern.isRecording=!0,this.sequencerEngine.operationManager.dispatch(function(e,t,n,a){return{type:"RECORD_STEP",timestamp:(new Date).getTime(),payload:{track:e,step:t,stepNumber:n,resolution:a}}}(this,i,e,t))}},{key:"syncBuckets",value:function(e){this.pattern.syncBuckets(e.isTriplet),this.pattern.clearCache()}},{key:"recordUnquantizedHit",value:function(e,t,n,a,r){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,i=jo.baseResolution,o=new ot;o.on=!0,o.slice=t,o.velocity=s,o.duration=n,o.transpose=r,this.getEasyPattern().addStep(o,e%this.pattern.length(i),i,a),this.updateSteps()}},{key:"selectSlice",value:function(e,t){for(var n=-16,a=0;a<this.soundIds.length;a++){var r=this.samplers[this.soundIds[a]].getNumberOfSlices();n<r&&(n=r)}t%=n;var s=this.pattern.stepBuckets[e];for(var i in s.steps)s.steps[i].slice=t}}]),t}(function(e){function t(e,n,a,r,s,i){var c;return Object(o.a)(this,t),(c=Object(u.a)(this,Object(l.a)(t).call(this,e,n,a,r,s,i))).annotations=[],c}return Object(h.a)(t,e),Object(c.a)(t,[{key:"deleteAnnotation",value:function(e){var t=this.annotations.indexOf(e);t>-1&&this.annotations.splice(t,1)}},{key:"newAnnotation",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.annotations.push(new Io(e,t,n))}}]),t}(jo.Track)),Fo=new q.a.Time("16n"),Vo=function(){function e(t,n,a,r,s){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;Object(o.a)(this,e),this.sequencerEngine=r,this.velocity=i,this.startTime=q.a.Master.context.currentTime,this.currentStep=r.getCurrentStep(a,t),this.currentGlobalStep=r.lastTrackStep,this.currentStepUnquantized=r.trackStepReal,this.currentStepTime=r.currentStepTime,t.subSequence.isTrack||(this.currentStepUnquantized=this.currentStepUnquantized%t.pattern.length()),this.quantized=s,this.track=t,this.trackNumber=t?t.trackNumber:0,this.sliceNumber=n,this.resolution=a,this.rolling=!!t&&t.rolling}return Object(c.a)(e,[{key:"getDuration",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.quantized,t=q.a.Master.context.currentTime,n=void 0,a=void 0,r=Fo.toMilliseconds()/1e3;if((void 0===this.currentStepTime||Math.abs(this.currentStepTime-this.startTime)>r)&&e){var s=Math.max(this.currentGlobalStep,0);n=(a=(this.sequencerEngine.lastTrackStep-s)/2)*Fo.toMilliseconds()}else a=(n=new q.a.Time(t).toMilliseconds()-new q.a.Time(e?this.currentStepTime:this.startTime).toMilliseconds())/Fo.toMilliseconds();return{duration:n,durationSixteenths:a}}},{key:"record",value:function(e,t,n){t=t||this.track,n=n||t.trackData.transpose;var a=this.getDuration(),r=a.duration,s=a.durationSixteenths,i=(c=new q.a.Time(this.startTime).toMilliseconds()-new q.a.Time(this.currentStepTime).toMilliseconds())/new q.a.Time("32n").toMilliseconds();if(this.quantized){i=Math.max(0,i);var o=this.currentStepUnquantized+i;o=Math.round(this.resolution.transformStepAtResolution2(o,jo.baseResolution)),t.subSequence.isTrack||(o%=this.track.pattern.length(this.resolution)),isNaN(o)&&(o=0),t.recordHit(o,this.resolution,this.sliceNumber,s,n,this.velocity)}else{var c;i=(c=new q.a.Time(this.startTime).toMilliseconds()-new q.a.Time(this.currentStepTime).toMilliseconds())/new q.a.Time("32n").toMilliseconds();if(c<0&&(i=1+i,0==this.currentStepUnquantized?this.currentStepUnquantized=31:this.currentStepUnquantized--),this.rolling)for(var u=this.getNumberOfRollsForDuration(r,t),l=32/this.resolution.numSteps(),p=this.getDurationOfRollTime(t),h=this.currentStepUnquantized+i;h<=this.currentStepUnquantized+l*u;h+=l){var d=Math.floor(h),f=h-d;t.recordUnquantizedHit(d,this.sliceNumber,p,f,n,this.velocity)}else t.recordUnquantizedHit(this.currentStepUnquantized,this.sliceNumber,s,i,n,this.velocity)}}},{key:"getDurationOfRollTime",value:function(e){return this.resolution.getTimeInStep().toMilliseconds()/Fo.toMilliseconds()}},{key:"getStepsInRollTime",value:function(e){var t=this.resolution,n=t.numSteps()/t.baseResolution,a=t.numSteps();return 32===a?n:48===a?n:16===a?2*n:24==a?2*n:8===a?4*n:12===a?4*n:4===a?8*n:6==a?8*n:null}},{key:"getRollResolution",value:function(e){var t=e.liveEffects.getEffect(Js),n=this.resolution;return t&&((n=n.getCopy()).resolution*=t.rollFactor),n}},{key:"getNumberOfRollsForDuration",value:function(e,t){return e/this.resolution.getTimeInStep().toMilliseconds()}}]),e}(),Bo=function(e){function t(e,n,a,r,s,i){var c;return Object(o.a)(this,t),(c=Object(u.a)(this,Object(l.a)(t).call(this,e,n,a,r,s,i))).audioInputChannel=void 0,c.isRecording=!1,c.soundUploader=new Fs.a(1,function(e,t,n){return c.onSoundUploaded(t,n)}),c}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isRecordable",value:function(){return!0}},{key:"onSoundUploaded",value:function(e,t){this.soundIds.splice(this.soundIds.indexOf(t),1);var n=this.samplers[t];delete this.samplers[t],this.samplers[e]=n;var a=this.pattern.loopsPlaying[t];delete this.pattern.loopsPlaying[t],this.pattern.loopsPlaying[e]=a,this.soundIds.push(e),new K.a(e).name="Recording "+this.getName()}},{key:"setAudioInputManager",value:function(e){this.audioInputManager=e}},{key:"setAudioInput",value:function(e){console.log("setting audio input to channel = "+e),void 0!==this.audioInputChannel&&this.disconnectAudioInput(this.audioInputChannel),this.audioInputChannel=e,void 0!==e?(console.log("channel was not undefined so connecting"),console.log("gain node"),console.log(this.gainNode),console.log(e),this.audioInputManager.connect(this.gainNode,e),this.recorder=this.audioInputManager.getRecorder()):this.disconnectAudioInput(this.audioInputChannel)}},{key:"disconnectAudioInput",value:function(e){console.log("disconnecting channel = "+e),this.audioInputManager.disconnect(this.gainNode,e),this.audioInputChannel=void 0}},{key:"isAudioInputChannelConnected",value:function(e){return this.audioInputChannel===e}},{key:"recording",value:function(e){this.isRecording=e}},{key:"startRecording",value:function(e){if(void 0!==this.recorder){var t=this,n=Ls(e);setTimeout(function(){t.recorder.record()},n+0)}}},{key:"stopRecording",value:function(e){if(void 0!==this.recorder){var t=this;setTimeout(function(){t.recorder.stop(),t.recorder.getBuffer(function(e){return t.saveBuffer(e)})},Ls(e)+10)}}},{key:"saveBuffer",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r,s,i,o,c,u,l,p=this;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,a={slices:void 0,offset:0,transpose:0,volume:4},r=t[0].length,(s=q.a.Master.context.createBuffer(2,r,q.a.Master.context.sampleRate)).copyToChannel(t[0],0,0),s.copyToChannel(t[0],1,0),i=[{startTime:0,endTime:s.duration}],o=new K.a,this.sample=o,o.isResampled=!0,o.tags=["Recorded"],o.name="Recorded",o.audioBuffer=s,(c=new ko(this,o,function(e){return p.onNewRecordedSampler(n,e)},i,a)).init(),u=n.soundIds.length,this.samplers[u]=c,this.soundIds.push(u),this.pattern.loopsPlaying[u]=!0,this.recorder.clear(),e.next=22,this.soundUploader.uploadBufferToIpfs(t,!0,u);case 22:l=e.sent,o.ipfsHash=l,this.sequencerEngine.newRecordingToSaveLater(o);case 25:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onNewRecordedSampler",value:function(e,t){t.gainNode.connect(this.gainNode),e.switchToPattern(e.currentPattern),e.setVolume(e.getVolume()),e.setPanning(e.getPanning())}}]),t}(Lo),Uo="SAMPLED_INSTRUMENT",Ho="SYNTH",Jo="MULTI_SYNTH",Go="FM_SYNTH",zo="METAL_SYNTH",_o={SAMPLER:"Sampler",SYNTH:"Synth",MULTI_SYNTH:"Multi Oscillator Synth",FM_SYNTH:"FM Synth",EXTERNAL_INSTRUMENT:"External Instrument",SAMPLED_INSTRUMENT:"Sampled Instrument",INSTRUMENT_RACK:"Instrument Rack",METAL_SYNTH:"Metal Synth",EFFECTS:"FX"},Wo=new q.a.Time("16n"),Ko=function(e){function t(e,n,a,r,s,i,c){var p;return Object(o.a)(this,t),(p=Object(u.a)(this,Object(l.a)(t).call(this,e,n,a,r,s,i))).midiOutputs=new Set,p.midiEngine=void 0,p.isRecordingMidi=!1,p.isEnabled=!1,p.recordedTriggers={},void 0!=c&&c||p.setupEffects(),p.audioInputManager=void 0,p.midiChannel=void 0,p.gated=!0,p.latency=0,p}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getInstrumentType",value:function(){return"EXTERNAL_INSTRUMENT"}},{key:"getName",value:function(){return"External Instrument"}},{key:"getCopy",value:function(){var e=Object(ze.a)(Object(l.a)(t.prototype),"getCopy",this).call(this,function(e,n,a,r,s,i){return new t(e,n,a,r,s,i)});return e.setMidiEngine(this.midiEngine),e.midiChannel=this.middieChannel,e.sequencerEngine=this.sequencerEngine,e.midiOutputs=new Set(this.midiOutputs),e.latency=this.latency,e}},{key:"getSoundUploader",value:function(){return this.soundUploader}},{key:"setAudioSettings",value:function(e){this.audioSettings=e}},{key:"setSequencerEngine",value:function(e){this.sequencerEngine=e}},{key:"recording",value:function(e){this.isRecordingMidi=e}},{key:"toggleRecording",value:function(e){this.pattern.loopsPlaying[e]=!this.pattern.loopsPlaying[e]}},{key:"isRecordingPlaying",value:function(e){return this.pattern.loopsPlaying[e]}},{key:"getRecordings",value:function(){return this.getSamplers()}},{key:"deleteMidiOutput",value:function(e){this.midiOutputs.has(e)&&this.midiOutputs.delete(e)}},{key:"addMidiOutput",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.name in _r&&!t&&this.addMidiInterfaceEffect(e,_r[e.name]),this.midiOutputs.add(e)}},{key:"addMidiInterfaceEffect",value:function(e,t){if(!this.midiEffects.effects.filter(function(e){return"Midi Interface"===e.name})[0]){var n=new Kr(this);n.setConfig(e,t),this.midiEffects.addEffect(n),this.sequencerEngine.update()}}},{key:"setAudioInputManager",value:function(e){this.audioInputManager=e}},{key:"onLoadTrackUrl",value:function(e,n,a){return Object(ze.a)(Object(l.a)(t.prototype),"onLoadTrackUrl",this).call(this,e,n,a)}},{key:"disconnect",value:function(){void 0!==this.audioChannel&&this.audioInputManager.disconnect(this.gainNode,this.audioChannel),this.audioChannel=void 0}},{key:"getMidiOutputs",value:function(){return this.midiOutputs}},{key:"setMidiEngine",value:function(e){this.midiEngine=e;var t=this;setTimeout(function(){t.setupMidiInput()},1e3)}},{key:"inputNoteForStep",value:function(e,t){var n=bs.a.fromString(t).getTranspose();this.getStepsAtResolution(this.sequencerEngine.resolution)[e].transpose=n,this.syncBuckets(this.sequencerEngine.resolution),this.update()}},{key:"triggerMidiNoteOn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.onNoteOn(void 0,bs.a.fromTranspose(e).toString(),t)}},{key:"onNoteOn",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;void 0!==this.sequencerEngine.cursor.step&&this.sequencerEngine.cursor.show&&this.inputNoteForStep(this.sequencerEngine.cursor.getStep(this.sequencerEngine.resolution),t),this.isEnabled&&(this.midiOutputs.size>0&&!this.arpManager.enabled&&this.midiOutputs.forEach(function(e){return n.midiEngine.playNoteSimple(e,t,n.midiChannel,0,0,a)}),this.isRecordingMidi)}},{key:"triggerMidiNoteOff",value:function(e){this.onNoteOff(void 0,bs.a.fromTranspose(e).toString())}},{key:"onNoteOff",value:function(e,t){var n=this;this.midiOutputs.size>0&&this.midiOutputs.forEach(function(e){return n.midiEngine.releaseNoteSimple(e,t,n.midiChannel,0)}),this.isRecordingMidi&&this.recordedTriggers}},{key:"setupMidiInput",value:function(){}},{key:"getTrackType",value:function(){return"MIDI"}},{key:"liveTrigger",value:function(e){this.triggerMidiNoteOn(e.transpose)}},{key:"liveTriggerRelease",value:function(e){this.triggerMidiNoteOff(e)}},{key:"trigger",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a,r,s,i,o,c,u,l,p=this;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n-=this.latency/1e3,a=t.transpose,r=new q.a.Time(new q.a.Time(t.duration)*Wo),Ls(n),s=t.release/16,i=t.chop,o=(null==r?Wo:r)/i,c=n,u=t.velocity,u*=1-t.start,l=0;l<i;l++)this.midiOutputs.forEach(function(e){return p.midiEngine.playNote(e,p.midiChannel,a,Ls(c),r.toMilliseconds(),s,u)}),c+=o;case 12:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"expandRecordedTracks",value:function(){var e=this,t=Object.keys(this.pattern.loopsPlaying).filter(function(t){return e.pattern.loopsPlaying[t]});console.log("loops playing = "),console.log(t),console.log(this.samplers),t.forEach(function(t){return e.sequencerEngine.addSound(t,void 0,void 0,void 0,!0)})}},{key:"getJson",value:function(){return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{latency:this.latency})}},{key:"fromJson",value:function(e){e.latency&&(this.latency=e.latency)}}]),t}(Bo),Yo=new q.a.Time("16n"),Qo=new q.a.Time("16n"),Xo=function(){function e(){Object(o.a)(this,e),this.offset=0,this.parameters=[]}return Object(c.a)(e,[{key:"registerParameter",value:function(e,t){var n=this.context.forInstrument(this);e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(n),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getSubDevices",value:function(){return[]}},{key:"getSubDeviceIndex",value:function(e){return this.getSubDevices().map(function(e){return e.value}).indexOf(e)}},{key:"getSubDevice",value:function(e){return this.getSubDevices().map(function(e){return e.value})[e]}},{key:"getName",value:function(){return""}},{key:"connect",value:function(e){void 0!==e&&(this.getInstrument().connect(e),this.node=e)}},{key:"disconnect",value:function(e){this.getInstrument().disconnect(e),this.node=void 0}},{key:"dispose",value:function(){this.disconnect(),this.parameters.forEach(function(e){return e.dispose()})}},{key:"isMonophonic",value:function(){return!1}},{key:"getEnvelope",value:function(){}},{key:"getInstrument",value:function(){}},{key:"getInstrumentType",value:function(){}},{key:"releaseAll",value:function(){}},{key:"getJson",value:function(){return{instrumentType:this.getInstrumentType()}}},{key:"hasLFO",value:function(){return!1}},{key:"release",value:function(e){e=void 0!==e?e:this.lastNote,this.isMonophonic()&&this.lastNote!==e||void 0!==this.lastNote&&this.getInstrument().triggerRelease([e])}},{key:"trigger",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n=e.start,a=null;null==e.duration||(a="number"===typeof e.duration?Yo*e.duration:new q.a.Time(e.duration));var r=this.getNoteFromTranspose(e.transpose),s=null===e.velocity?1:e.velocity,i=null==e.chop?1:e.chop,o=(null==a?Yo:a)/i.toString();t=t||void 0,this.offset>0&&(void 0===t&&(t=q.a.Master.context.currentTime),t=Qo*this.offset+t);var c=new q.a.Time(t);this.setEnvelopes(e);for(var u=this.getInstrument(),l=0;l<i;l++)this.lastNote=r,null!=a?u.triggerAttackRelease(r,a,c,s,n):u.triggerAttack(r,c,s,n),c+=o}},{key:"hasNotes",value:function(){return!0}},{key:"setEnvelopes",value:function(e){var t=this.getEnvelopes();t.forEach(function(t){return t.attack=new q.a.Time((1+e.attack)/1e3)}),t.forEach(function(t){return t.release=new q.a.Time((1+e.release)/1e3)})}},{key:"getNoteFromTranspose",value:function(e){return e+this.sequencerEngine.transpose}},{key:"getDefaultNote",value:function(){return q.a.Frequency("C3")}},{key:"getParameters",value:function(){return this.parameters}},{key:"getEnvelopes",value:function(){return[]}},{key:"findParameter",value:function(e,t){var n=this.getParameters().filter(function(e){return t===e.name});return 0===n.length?0:n[0]}},{key:"name",get:function(){return this.getName()}}]),e}(),Zo=function(){function e(t,n,a,r){Object(o.a)(this,e),this.synth=t,this.store=n,this.mixSession=a,this.context=r,this.parameters=[],this.setupParameters()}return Object(c.a)(e,[{key:"onNewSynth",value:function(e){this.synth=e,this.refreshParameters()}},{key:"refreshParameters",value:function(){this.baseFrequency=this.baseFrequency,this.octaves=this.octaves,this.attack=this.attack,this.decay=this.decay,this.sustain=this.sustain,this.release=this.release}},{key:"setupParameters",value:function(){this.attackParameter=new Wt("Filter Envelope Attack",this,function(e,t){return e.synth.set({filterEnvelope:{attack:t/1e3}})},{min:0,max:1e4,unit:"ms",defaultValue:60}),this.registerParameter(this.attackParameter),this.decayParameter=new Wt("Filter Envelope Decay",this,function(e,t){return e.synth.set({filterEnvelope:{decay:t/1e3}})},{min:0,max:1,unit:"ms",defaultValue:60}),this.registerParameter(this.decayParameter),this.sustainParameter=new Wt("Filter Envelope Sustain",this,function(e,t){return e.synth.set({filterEnvelope:{sustain:t}})},{min:0,max:1,unit:"",defaultValue:.9}),this.registerParameter(this.sustainParameter),this.releaseParameter=new Wt("Filter Envelope Release",this,function(e,t){return e.synth.set({filterEnvelope:{release:t/1e3}})},{min:0,max:1,unit:"ms",defaultValue:60}),this.registerParameter(this.releaseParameter),this.baseFrequencyParameter=new Kt("Filter Envelope Base Frequency",this,function(e,t){return e.synth.set({filterEnvelope:{baseFrequency:t}})},{min:0,max:1e4,unit:"HZ",defaultValue:100}),this.registerParameter(this.baseFrequencyParameter),this.octavesParameter=new Kt("Filter Envelope Octaves",this,function(e,t){return e.synth.set({filterEnvelope:{octaves:t}})},{min:0,max:10,unit:"",defaultValue:1}),this.registerParameter(this.octavesParameter)}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),this.parameters.push(e)}},{key:"copyFrom",value:function(e){this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.baseFrequency=e.baseFrequency,this.octaves=e.octaves}},{key:"getJson",value:function(){return{baseFrequency:this.baseFrequency,octaves:this.octaves,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release}}},{key:"fromJson",value:function(e){"baseFrequency"in e&&(this.baseFrequency=e.baseFrequency),"octaves"in e&&(this.octaves=e.octaves),"attack"in e&&(this.attack=e.attack),"decay"in e&&(this.decay=e.decay),"sustain"in e&&(this.sustain=e.sustain),"releease"in e&&(this.release=e.release)}},{key:"attack",get:function(){return this.attackParameter.get()},set:function(e){this.attackParameter.set(e)}},{key:"decay",get:function(){return this.decayParameter.get()},set:function(e){this.decayParameter.set(e)}},{key:"sustain",get:function(){return this.sustainParameter.get()},set:function(e){this.sustainParameter.set(e)}},{key:"release",get:function(){return this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e)}},{key:"baseFrequency",get:function(){return this.baseFrequencyParameter.get()},set:function(e){this.baseFrequencyParameter.set(e)}},{key:"octaves",get:function(){return this.octavesParameter.get()},set:function(e){this.octavesParameter.set(e)}}]),e}(),$o=function(e){function t(e,n,a){var r;return Object(o.a)(this,t),(r=Object(u.a)(this,Object(l.a)(t).call(this))).sequencerEngine=e,r.store=e.store,r.mixSession=n,r.context=a,r.synth=new q.a.PolySynth(1,q.a.MonoSynth),r.synth.volume.value=-4,r.lfos=[r.createLFO(),r.createLFO(),r.createLFO(),r.createLFO()],r.filterEnvelope=new Zo(r.synth,r.store,n,a),r.polyphonySet=!1,r.parameters=[],r.parameterToSignal={},r.parameterToLFOs={},r.setupParameters(),r.lfos.forEach(function(e){return e.start()}),r.refreshParameters(),r.node=void 0,r}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getName",value:function(){return"Synth"}},{key:"isMonophonic",value:function(){return 1===this.polyphony}},{key:"getInstrument",value:function(){return this}},{key:"getInstrumentType",value:function(){return Ho}},{key:"hasLFO",value:function(){return!0}},{key:"start",value:function(){this.lfos.forEach(function(e){return e.start()})}},{key:"stop",value:function(){this.lfos.forEach(function(e){return e.stop()})}},{key:"refreshParameters",value:function(){this.pulseWidth=this.pulseWidth,this.oscillatorType=this.oscillatorType,this.filterQ=this.filterQ,this.portamento=this.portamento,this.filterCutoff=this.filterCutoff}},{key:"createNewSynth",value:function(e){var t=this.node;this.disconnect(t),this.synth=new q.a.PolySynth(e,q.a.MonoSynth),this.filterEnvelope.onNewSynth(this.synth),this.connect(t),this.polyphonySet=!1,this.refreshParameters(),this.reconnectAllLFOParameters()}},{key:"triggerAttack",value:function(e,t,n){var a=this.getNoteFromTranspose(e);this.synth.triggerAttack(a,t,n)}},{key:"triggerAttackRelease",value:function(e,t,n,a){var r=this.getNoteFromTranspose(e);this.synth.triggerAttackRelease(r,t,n,a)}},{key:"triggerRelease",value:function(e){var t=this,n=e.map(function(e){return t.getNoteFromTranspose(e)});this.synth.triggerRelease(n)}},{key:"createLFO",value:function(){return new jn(this.sequencerEngine,this.mixSession,this.context)}},{key:"setupParameters",value:function(e){var t=this;this.oscillatorTypeParameter=new Wt("Oscillator Type",this,function(e,t){return e.synth.set({oscillator:{type:t}})},{min:0,max:1,unit:"",defaultValue:"triangle",automatable:!1}),this.registerParameter(this.oscillatorTypeParameter),this.oscillatorFrequencyParameter=new Wt("Oscillator Frequency",this,function(e,t){return[]},{min:0,max:1,unit:"",defaultValue:0,automatable:!1}),this.registerParameter(this.oscillatorFrequencyParameter),this.pulseWidthParameter=new Wt("Pulse Width",this,function(e,t){return e.synth.set({oscillator:{width:t}})},{min:0,max:1,unit:"",defaultValue:.1}),this.registerParameter(this.pulseWidthParameter,function(e){return e.oscillator.width}),this.filterCutoffParameter=new Kt("Filter Cutoff",this,function(e,t){e.synth.set({filter:{frequency:t}})},{min:0,max:1e4,unit:"HZ",defaultValue:1200}),this.registerParameter(this.filterCutoffParameter,function(e){return e.filter.frequency}),this.filterQParameter=new Kt("Filter Q",this,function(e,t){return e.synth.set({filter:{Q:t}})},{min:0,max:9,unit:"",defaultValue:1}),this.registerParameter(this.filterQParameter,function(e){return e.filter.Q}),this.portamentoParameter=new Wt("Portamento",this,function(e,t){return e.synth.set({portamento:t/20})},{min:0,max:10,unit:"",defaultValue:0}),this.registerParameter(this.portamentoParameter),this.detuneParameter=new Kt("Detune",this,function(e,t){e.synth.set({detune:t})},{min:-100,max:100,unit:"",defaultValue:0,automatable:!1}),this.parameterToSignal[this.detuneParameter.name]=function(e){return e.oscillator.detune},this.registerParameter(this.detuneParameter),this.polyphonyParameter=new Kt("Polyphony",this,function(e,n){t.polyphonySet&&t.createNewSynth(n),t.polyphonySet=!0},{min:0,max:16,unit:"",defaultValue:1,automatable:!1}),this.registerParameter(this.polyphonyParameter),this.ampAttackParameter=new Wt("Amp Attack",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:10}),this.registerParameter(this.ampAttackParameter),this.ampDecayParameter=new Wt("Amp Decay",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:10}),this.registerParameter(this.ampDecayParameter),this.ampSustainParameter=new Wt("Amp Sustain",this,function(e,t){return t},{min:0,max:1,unit:"",defaultValue:1}),this.registerParameter(this.ampSustainParameter),this.ampReleaseParameter=new Wt("Amp Release",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:10}),this.registerParameter(this.ampReleaseParameter)}},{key:"registerParameter",value:function(e,t){void 0!==t&&(this.parameterToSignal[e.name]=t),e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getCopy",value:function(e){var n=this,a=new t(this.store,this.mixSession,e);for(var r in a.instrumentType=this.instrumentType,a.oscillatorFrequency=this.oscillatorFrequency,a.filterCutoff=this.filterCutoff,a.filterQ=this.filterQ,a.polyphony=this.polyphony,a.portamento=this.portamento,a.filterEnvelope.copyFrom(this.filterEnvelope),a.oscillatorType=this.oscillatorType,a.pulseWidth=this.pulseWidth,a.lfos)a.lfos[r].copyFrom(this.lfos[r]);a.parameterToLFOs={};var s=function(e){var t=n.parameterToLFOs[e],r=a.getParameterByName(e);t.forEach(function(e){var t=a.lfos[n.lfos.indexOf(e)];a.connectLFOToParameter(t,r)})};for(var i in this.parameterToLFOs)s(i);return a}},{key:"getParameters",value:function(){return[].concat(Object(ge.a)(this.parameters),Object(ge.a)(this.filterEnvelope.parameters))}},{key:"getJson",value:function(){var e={instrumentType:this.getInstrumentType(),oscillatorType:this.oscillatorType,oscillatorFrequency:this.oscillatorFrequency,filterCutoff:this.filterCutoff,filterQ:this.filterQ,polyphony:this.polyphony,portamento:this.portamento,pulseWidth:this.pulseWidth,lfos:this.lfos.map(function(e){return e.getJson()}),parameterToLFOs:this.getParameterToLFOsJson(),filterEnvelope:this.filterEnvelope.getJson(),ampAttack:this.ampAttack,ampDecay:this.ampDecay,ampSustain:this.ampSustain,ampRelease:this.ampRelease};return e=ln(e,"filterCutoffParameter",this.filterCutoffParameter),e=ln(e,"filterQParameter",this.filterQParameter),e=ln(e,"portamentoParameter",this.portamentoParameter),e=ln(e,"pulseWidthParameter",this.pulseWidthParameter),e=ln(e,"oscillatorFrequencyParameter",this.oscillatorFrequencyParameter),e=ln(e,"oscillatorTypeParameter",this.oscillatorTypeParameter),e=ln(e,"ampAttackParameter",this.ampAttackParameter),e=ln(e,"ampDecayParameter",this.ampDecayParameter),e=ln(e,"ampSustainParameter",this.ampSustainParameter),e=ln(e,"ampReleaseParameter",this.ampReleaseParameter)}},{key:"getParameterToLFOsJson",value:function(){var e=this,t={},n=function(n){var a=[];e.parameterToLFOs[n].forEach(function(t){return a.push(e.lfos.indexOf(t))}),t[n]=a};for(var a in this.parameterToLFOs)n(a);return t}},{key:"fromJson",value:function(e){if("instrumentType"in e&&(this.instrumentType=e.instrumentType),"polyphony"in e&&(this.polyphony=e.polyphony),"oscillatorFrequency"in e&&(this.oscillatorFrequency=e.oscillatorFrequency),"pulseWidth"in e&&(this.pulseWidth=e.pulseWidth),"oscillatorType"in e&&(this.oscillatorType=e.oscillatorType),"filterCutoff"in e&&(this.filterCutoff=e.filterCutoff),"filterQ"in e&&(this.filterQ=e.filterQ),"portamento"in e&&(this.portamento=e.portamento),"filterEnvelope"in e&&this.filterEnvelope.fromJson(e.filterEnvelope),"lfos"in e)for(var t in e.lfos)this.lfos[t].fromJson(e.lfos[t]);"parameterToLFOs"in e&&this.loadParameterToLFOsJson(e.parameterToLFOs),"ampAttack"in e&&(this.ampAttack=e.ampAttack),"ampDecay"in e&&(this.ampDecay=e.ampDecay),"ampSustain"in e&&(this.ampSustain=e.ampSustain),"ampRelease"in e&&(this.ampRelease=e.ampRelease),pn(e,"filterCutoffParameter",this.filterCutoffParameter,this.sequencerEngine),pn(e,"filterQParameter",this.filterQParameter,this.sequencerEngine),pn(e,"portamentoParameter",this.portamentoParameter,this.sequencerEngine),pn(e,"pulseWidthParameter",this.pulseWidthParameter,this.sequencerEngine),pn(e,"oscillatorFrequencyParameter",this.oscillatorFrequencyParameter,this.sequencerEngine),pn(e,"oscillatorTypeParameter",this.oscillatorTypeParameter,this.sequencerEngine),pn(e,"ampAttackParameter",this.ampAttackParameter,this.sequencerEngine),pn(e,"ampDecayParameter",this.ampDecayParameter,this.sequencerEngine),pn(e,"ampSustainParameter",this.ampSustainParameter,this.sequencerEngine),pn(e,"ampReleaseParameter",this.ampReleaseParameter,this.sequencerEngine)}},{key:"getParameterByName",value:function(e){var t=this.parameters.filter(function(t){return t.name===e});if(!(t.length<1))return t[0]}},{key:"loadParameterToLFOsJson",value:function(e){var t=this,n=function(n){var a=t.getParameterByName(n);if(void 0===a)return"continue";e[n].forEach(function(e){return t.connectLFOToParameter(t.lfos[e],a)})};for(var a in e)n(a)}},{key:"connectLFOToParameter",value:function(e,t){var n=this,a=!1;void 0!==this.parameterToSignal[t.name]&&(this.synth.voices.forEach(function(r,s){var i=n.parameterToSignal[t.name](r);void 0===i?a=!0:e.connect(i,t,s)}),a||(t.name in this.parameterToLFOs?this.parameterToLFOs[t.name].add(e):this.parameterToLFOs[t.name]=new Set([e]),this.refreshParameters()))}},{key:"disconnectLFOToParameter",value:function(e,t){var n=this;this.parameterToLFOs[t.name].has(e)&&(this.synth.voices.forEach(function(a,r){e.disconnect(n.parameterToSignal[t.name](a),t,r)}),this.parameterToLFOs[t.name].delete(e))}},{key:"isParameterConnectedToLFO",value:function(e,t){return e.name in this.parameterToLFOs&&this.parameterToLFOs[e.name].has(t)}},{key:"toggleParameterWithLFO",value:function(e,t){this.isParameterConnectedToLFO(e,t)?this.disconnectLFOToParameter(t,e):this.connectLFOToParameter(t,e)}},{key:"reconnectAllLFOParameters",value:function(){var e=this,t=function(t){var n=e.parameterToLFOs[t],a=e.getParameterByName(t);n.forEach(function(t){return e.connectLFOToParameter(t,a)})};for(var n in this.parameterToLFOs)t(n)}},{key:"onChangeToPulse",value:function(){var e=this;this.pulseWidthParameter.name in this.parameterToLFOs&&this.parameterToLFOs[this.pulseWidthParameter.name].forEach(function(t){return e.connectLFOToParameter(t,e.pulseWidthParameter,!0)})}},{key:"connect",value:function(e){void 0!==e&&(this.synth.connect(e),this.node=e)}},{key:"disconnect",value:function(e){this.synth.disconnect(e),this.node=void 0}},{key:"getEnvelopes",value:function(){return this.synth.voices.map(function(e){return e.envelope})}},{key:"releaseAll",value:function(){this.lastNote=void 0,this.synth.releaseAll()}},{key:"getNoteFromTranspose",value:function(e){return e+=this.sequencerEngine.transpose,this.getDefaultNote().transpose(e+this.oscillatorFrequency)}},{key:"setEnvelopes",value:function(e){var t=this,n=this.getEnvelopes();n.forEach(function(e){return e.attack=new q.a.Time((1+t.ampAttack)/1e3)}),n.forEach(function(e){return e.release=new q.a.Time((1+t.ampRelease)/1e3)}),n.forEach(function(e){return e.sustain=Math.min(.99,t.ampSustain)}),n.forEach(function(e){return e.decay=new q.a.Time((1+t.ampDecay)/1e3)})}},{key:"releaseAll",value:function(){this.synth.voices.forEach(function(e){return e.triggerRelease()})}},{key:"oscillatorType",get:function(){return this.oscillatorTypeParameter.get()},set:function(e){var t=this.oscillatorTypeParameter.get();this.oscillatorTypeParameter.set(e),"pulse"===e&&t!==e&&this.onChangeToPulse()}},{key:"oscillatorFrequency",get:function(){return this.oscillatorFrequencyParameter.get()},set:function(e){this.oscillatorFrequencyParameter.set(e)}},{key:"filterCutoff",get:function(){return this.filterCutoffParameter.get()},set:function(e){this.filterCutoffParameter.set(e)}},{key:"filterQ",get:function(){return this.filterQParameter.get()},set:function(e){this.filterQParameter.set(e)}},{key:"portamento",get:function(){return this.portamentoParameter.get()},set:function(e){this.portamentoParameter.set(e)}},{key:"polyphony",get:function(){return void 0===this.polyphonyParameter?8:this.polyphonyParameter.get()},set:function(e){this.polyphonyParameter.set(e)}},{key:"detune",get:function(){return this.detuneParameter.get()},set:function(e){this.detuneParameter.set(e)}},{key:"pulseWidth",get:function(){return this.pulseWidthParameter.get()},set:function(e){this.pulseWidthParameter.set(e)}},{key:"ampAttack",get:function(){return this.ampAttackParameter.get()},set:function(e){return this.ampAttackParameter.set(e)}},{key:"ampDecay",get:function(){return this.ampDecayParameter.get()},set:function(e){return this.ampDecayParameter.set(e)}},{key:"ampSustain",get:function(){return this.ampSustainParameter.get()},set:function(e){return this.ampSustainParameter.set(e)}},{key:"ampRelease",get:function(){return this.ampReleaseParameter.get()},set:function(e){return this.ampReleaseParameter.set(e)}}]),t}(Xo),ec=function(e){function t(e,n,a,r,s,i){var c,h=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return Object(o.a)(this,t),(c=Object(u.a)(this,Object(l.a)(t).call(this,e,n,a,r,s,i))).setupEffects(),c.instrument=void 0,h&&c.setInstrument(new $o(n,a,(new Kn).forTrack(Object(p.a)(c)))),c}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getInstrumentType",value:function(){return this.instrument.getInstrumentType()}},{key:"setIsEnabled",value:function(e){Object(ze.a)(Object(l.a)(t.prototype),"setIsEnabled",this).call(this,e),e||this.getInstrument().releaseAll()}},{key:"makePublicIfNeeded",value:function(){}},{key:"dispose",value:function(){Object(ze.a)(Object(l.a)(t.prototype),"dispose",this).call(this),this.instrument.dispose()}},{key:"getAllPatternLockedParameters",value:function(){var e=Object(ze.a)(Object(l.a)(t.prototype),"getAllPatternLockedParameters",this).call(this),n=this.getInstrument().getParameters();return n=n.filter(function(e){return e.hasPatternLockedValues()}),e.concat(n)}},{key:"getCopy",value:function(){var e=Object(g.a)(v.a.mark(function e(){var n,a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(ze.a)(Object(l.a)(t.prototype),"getCopy",this).call(this,function(e,n,a,r,s,i){return new t(e,n,a,r,s,i)}),e.next=3,this.instrument.getCopy((new Kn).forTrack(n));case 3:return a=e.sent,n.setInstrument(a),e.abrupt("return",n);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getName",value:function(){return void 0===this.instrument?"Instrument":this.instrument.getName()}},{key:"getTrackType",value:function(){return _n}},{key:"getInstrument",value:function(){return this.instrument}},{key:"setInstrument",value:function(e){void 0!==this.instrument&&this.instrument.disconnect(this.gainNode),this.instrument=e,void 0!==this.instrument&&this.instrument.connect(this.gainNode)}},{key:"liveTrigger",value:function(e){this.trigger(e,0,!0)}},{key:"liveTriggerRelease",value:function(e){this.triggerRelease(e)}},{key:"trigger",value:function(e,t){void 0!==this.instrument&&this.instrument.trigger(e,t)}},{key:"triggerRelease",value:function(e){void 0!==this.instrument&&this.instrument.release(e)}},{key:"getJson",value:function(){return Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{instrumentType:this.instrument.getInstrumentType(),instrument:this.instrument.getJson(),presetName:this.presetName})}},{key:"fromJson",value:function(){var e=Object(g.a)(v.a.mark(function e(n){var a,r,s,i,o=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=!(o.length>1&&void 0!==o[1])||o[1],console.log("InstrumentTrack fromJson"),Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,n),a&&this.store.dispatch(Object(w.ge)(this.subSequence.id,this.trackNumber,!0)),n.envelopes)for(r in n.envelopes)this.connectToEnvelope(this.sequencerEngine.envelopes[n.envelopes[r]]);if("envelopeConnections"in n)for(s in n.envelopeConnections)i=n.envelopeConnections[s],this.connectToEnvelope(this.subSequence.envelopes[i.envelope],i.mode);if(n.isFrozen){e.next=9;break}return e.next=9,this.instrument.fromJson(n.instrument);case 9:void 0!==n.presetName&&(this.presetName=n.presetName),a&&this.store.dispatch(Object(w.ge)(this.subSequence.id,this.trackNumber,!1));case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"unfreezeInstrument",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.frozenJson;this.instrument.fromJson(e.trackParameters.instrument)}}]),t}(Lo),tc=function(){function e(t,n,a,r,s,i){Object(o.a)(this,e),this.sequencerEngine=t,this.store=this.sequencerEngine.store,this.mixSession=n,this.context=a.getCopy().forSubDevice(this),this.envelope=new q.a.ScaledEnvelope,void 0!==r&&(this.audioNode=r,this.envelope.connect(r)),this.min=s,this.max=i,this.parameters=[],this.setupParameters(),this.savedFrequency=void 0}return Object(c.a)(e,[{key:"dispose",value:function(){this.envelope.dispose(),this.envelope=void 0}},{key:"connect",value:function(e){this.envelope.connect(e)}},{key:"disconnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.audioNode;this.envelope.disconnect(e)}},{key:"triggerAttack",value:function(e,t){this.envelope.triggerAttack(e,t)}},{key:"triggerAttackRelease",value:function(e,t,n){this.envelope.triggerAttackRelease(e,t,n)}},{key:"triggerRelease",value:function(e){this.envelope.triggerRelease(e)}},{key:"setupParameters",value:function(){var e=this;this.attackParameter=new Wt("Attack",this.envelope,function(e,t){return e.attack=(t+1e-6)/1e3},{min:0,max:1e4,unit:"ms",defaultValue:80}),this.registerParameter(this.attackParameter),this.decayParameter=new Wt("Decay",this.envelope,function(e,t){return e.decay=(t+1e-5)/1e3},{min:0,max:3e3,unit:"ms",defaultValue:500}),this.registerParameter(this.decayParameter),this.sustainParameter=new Wt("Sustain",this.envelope,function(e,t){return e.sustain=t},{min:0,max:1,unit:"",defaultValue:.8}),this.registerParameter(this.sustainParameter),this.releaseParameter=new Wt("Release",this.envelope,function(e,t){return e.release=(t+1e-6)/1e3},{min:0,max:3e3,unit:"ms",defaultValue:100}),this.registerParameter(this.releaseParameter),this.attackCurveParameter=new Wt("Attack Curve",this.envelope,function(e,t){e.attackCurve=t},{min:0,max:1e4,unit:"",defaultValue:"exponential",automatable:!1}),this.registerParameter(this.attackCurveParameter),this.decayCurveParameter=new Wt("Decay Curve",this.envelope,function(e,t){return e.decayCurve=t},{min:0,max:1e4,unit:"",defaultValue:"exponential",automatable:!1}),this.registerParameter(this.decayCurveParameter),this.releaseCurveParameter=new Wt("Release Curve",this.envelope,function(e,t){return e.releaseCurve=t},{min:0,max:1e4,unit:"",defaultValue:"exponential",automatable:!1}),this.registerParameter(this.releaseCurveParameter),this.levelParameter=new Wt("Level",this,function(t,n){return e.frequency=e.savedFrequency||0},{min:-1,max:1,unit:"",defaultValue:0}),this.registerParameter(this.levelParameter)}},{key:"refresh",value:function(){this.attack=this.attack,this.decay=this.decay,this.level=this.level,this.release=this.release,this.sustain=this.sustain}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getJson",value:function(){var e={level:this.level,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release,attackCurve:this.attackCurve,decayCurve:this.decayCurve,releaseCurve:this.releaseCurve};return e=ln(e,"attackParameter",this.attackParameter),e=ln(e,"decayParameter",this.decayParameter),e=ln(e,"sustainParameter",this.sustainParameter),e=ln(e,"releaseParameter",this.releaseParameter),e=ln(e,"attackCurveParameter",this.attackCurveParameter),e=ln(e,"decayCurveParameter",this.decayCurveParameter),e=ln(e,"releaseCurveParameter",this.releaseCurveParameter),e=ln(e,"levelParameter",this.levelParameter)}},{key:"fromJson",value:function(e){this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.level=e.level,e.attackCurve&&(this.attackCurve=e.attackCurve),e.decayCurve&&(this.decayCurve=e.decayCurve),e.releaseCurve&&(this.releaseCurve=e.releaseCurve),pn(e,"attackParameter",this.attackParameter,this.sequencerEngine),pn(e,"decayParameter",this.decayParameter,this.sequencerEngine),pn(e,"sustainParameter",this.sustainParameter,this.sequencerEngine),pn(e,"releaseParameter",this.releaseParameter,this.sequencerEngine),pn(e,"attackCurveParameter",this.attackCurveParameter,this.sequencerEngine),pn(e,"decayCurveParameter",this.decayCurveParameter,this.sequencerEngine),pn(e,"releaseCurveParameter",this.releaseCurveParameter,this.sequencerEngine),pn(e,"levelParameter",this.levelParameter,this.sequencerEngine)}},{key:"refresh",value:function(){this.parameters.filter(function(e){return e.isConnectedToAnyLFO()}).forEach(function(e){return e.callSetter()})}},{key:"mateJson",value:function(e,t){this.mateParameter("attack",e,this.attackParameter,t),this.mateParameter("decay",e,this.decayParameter,t),this.mateParameter("sustain",e,this.sustainParameter,t),this.mateParameter("release",e,this.releaseParameter,t)}},{key:"mateParameter",value:function(e,t,n,a){Cn(this.sequencerEngine,e,t,n,a)}},{key:"dispose",value:function(){this.envelope.dispose()}},{key:"frequency",set:function(e){this.savedFrequency=e;var t=void 0;t=this.level>0?void 0!==this.max?e+this.level*(this.max-e):e+this.level*e*2:void 0!==this.min&&this.min<0?-1*this.level*(this.min+e):this.level*e,this.envelope.min=2*e,this.envelope.max=t}},{key:"level",set:function(e){this.levelParameter.set(e)},get:function(){return void 0===this.levelParameter||void 0===this.levelParameter.get()?0:this.levelParameter.get()}},{key:"attack",get:function(){return this.attackParameter.get()},set:function(e){this.attackParameter.set(e)}},{key:"decay",get:function(){return this.decayParameter.get()},set:function(e){this.decayParameter.set(e)}},{key:"sustain",get:function(){return this.sustainParameter.get()},set:function(e){this.sustainParameter.set(e)}},{key:"release",get:function(){return this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e)}},{key:"attackCurve",get:function(){return this.attackCurveParameter.get()},set:function(e){this.attackCurveParameter.set(e)}},{key:"decayCurve",get:function(){return this.decayCurveParameter.get()},set:function(e){this.decayCurveParameter.set(e)}},{key:"releaseCurve",get:function(){return this.releaseCurveParameter.get()},set:function(e){this.releaseCurveParameter.set(e)}}]),e}(),nc=function(){function e(t,n,a){Object(o.a)(this,e),this.sequencerEngine=t,this.store=t.store,this.mixSession=n,this.context=a.getCopy().forSubDevice(this),this.parameters=[],this.envelope=new tc(this.sequencerEngine,this.mixSession,this.context,void 0,-2e3,2e3),this.setupParameters()}return Object(c.a)(e,[{key:"setupParameters",value:function(){var e=this;this.attackParameter=new Wt("Attack",this,function(t,n){return e.envelope.attack=n},{min:0,max:1e4,unit:"ms",defaultValue:1e3}),this.registerParameter(this.attackParameter),this.decayParameter=new Wt("Decay",this,function(t,n){return e.envelope.decay=n},{min:0,max:1,unit:"ms",defaultValue:1e3}),this.registerParameter(this.decayParameter),this.sustainParameter=new Wt("Sustain",this,function(t,n){return e.envelope.sustain=n},{min:0,max:1,unit:"",defaultValue:.5}),this.registerParameter(this.sustainParameter),this.releaseParameter=new Wt("Release",this.envelope,function(t,n){return e.envelope.release=n},{min:0,max:1,unit:"ms",defaultValue:1e3}),this.registerParameter(this.releaseParameter),this.levelParameter=new Wt("Level",this,function(t,n){return e.envelope.level=n},{min:-1,max:1,unit:"",defaultValue:0}),this.registerParameter(this.levelParameter),this.attackCurveParameter=new Wt("Attack Curve",this.envelope,function(e,t){return e.attackCurve=t},{min:0,max:1e4,unit:"",defaultValue:"linear"}),this.registerParameter(this.attackCurveParameter),this.decayCurveParameter=new Wt("Decay Curve",this.envelope,function(e,t){return e.decayCurve=t},{min:0,max:1e4,unit:"",defaultValue:"linear"}),this.registerParameter(this.decayCurveParameter),this.releaseCurveParameter=new Wt("Release Curve",this.envelope,function(e,t){return e.releaseCurve=t},{min:0,max:1e4,unit:"",defaultValue:"exponential"}),this.registerParameter(this.releaseCurveParameter)}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getJson",value:function(){var e={level:this.level,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release,attackCurve:this.attackCurve,decayCurve:this.decayCurve,releaseCurve:this.releaseCurve};return e=ln(e,"attackParameter",this.attackParameter),e=ln(e,"decayParameter",this.decayParameter),e=ln(e,"sustainParameter",this.sustainParameter),e=ln(e,"releaseParameter",this.releaseParameter),e=ln(e,"levelParameter",this.levelParameter),e=ln(e,"attackCurveParameter",this.attackCurveParameter),e=ln(e,"decayCurveParameter",this.decayCurveParameter),e=ln(e,"releaseCurveParameter",this.releaseCurveParameter)}},{key:"fromJson",value:function(e){this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.level=e.level,e.attackCurve&&(this.attackCurve=e.attackCurve),e.decayCurve&&(this.decayCurve=e.decayCurve),e.releaseCurve&&(this.releaseCurve=e.releaseCurve),pn(e,"attackParameter",this.attackParameter,this.sequencerEngine),pn(e,"decayParameter",this.decayParameter,this.sequencerEngine),pn(e,"sustainParameter",this.sustainParameter,this.sequencerEngine),pn(e,"releaseParameter",this.releaseParameter,this.sequencerEngine),pn(e,"levelParameter",this.levelParameter,this.sequencerEngine),pn(e,"attackCurveParameter",this.attackCurveParameter,this.sequencerEngine),pn(e,"decayCurveParameter",this.decayCurveParameter,this.sequencerEngine),pn(e,"releaseCurveParameter",this.releaseCurveParameter,this.sequencerEngine)}},{key:"getCopy",value:function(t){var n=new e(this.sequencerEngine,this.mixSession,t);return n.fromJson(this.getJson()),n}},{key:"refresh",value:function(){this.parameters.filter(function(e){return e.isConnectedToAnyLFO()}).forEach(function(e){return e.callSetter()})}},{key:"mateJson",value:function(e,t){this.mateParameter("attack",e,this.attackParameter,t),this.mateParameter("decay",e,this.decayParameter,t),this.mateParameter("sustain",e,this.sustainParameter,t),this.mateParameter("release",e,this.releaseParameter,t)}},{key:"mateParameter",value:function(e,t,n,a){Cn(this.sequencerEngine,e,t,n,a)}},{key:"dispose",value:function(){this.envelope.dispose(),this.envelope=void 0}},{key:"attack",get:function(){return this.attackParameter.get()},set:function(e){this.attackParameter.set(e)}},{key:"decay",get:function(){return this.decayParameter.get()},set:function(e){this.decayParameter.set(e)}},{key:"sustain",get:function(){return this.sustainParameter.get()},set:function(e){this.sustainParameter.set(e)}},{key:"release",get:function(){return this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e)}},{key:"level",get:function(){return this.levelParameter.get()},set:function(e){this.levelParameter.set(e)}},{key:"attackCurve",get:function(){return this.attackCurveParameter.get()},set:function(e){this.attackCurveParameter.set(e)}},{key:"decayCurve",get:function(){return this.decayCurveParameter.get()},set:function(e){this.decayCurveParameter.set(e)}},{key:"releaseCurve",get:function(){return this.releaseCurveParameter.get()},set:function(e){this.releaseCurveParameter.set(e)}}]),e}(),ac="AMP",rc=new q.a.Frequency("C3"),sc=0,ic=function(){function e(t,n,a,r,s){var i=this,c=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];Object(o.a)(this,e),this.sequencerEngine=t,this.id=sc++,this.store=t.store,this.mixSession=n,this.context=a.getCopy().forSubDevice(this),this.pitchEnvelope=s,this.synthFactory=r,this.polyphonySet=!1,this.parameters=[],this.volume=new q.a.Volume,this.enabledParameter=new Wt("Enabled",this,function(e,t){t&&!i.isInitialized()&&i.create()},{min:!1,max:!0,unit:"",defaultValue:!1,automatable:!1}),this.registerParameter(this.enabledParameter),c&&this.create()}return Object(c.a)(e,[{key:"dispose",value:function(){this.synth&&this.synth.dispose(),this.volume&&this.volume.dispose(),this.parameters.forEach(function(e){return e.dispose()}),this.parameters=void 0,this.synth=void 0,this.volume=void 0}},{key:"create",value:function(){this.synth=this.synthFactory(1),this.synth.volume.value=-4,this.synth.connect(this.volume),this.setupParameters()}},{key:"isInitialized",value:function(){return void 0!==this.synth}},{key:"setupParameters",value:function(){var e=this;this.oscillatorLevelParameter=new Xt("Oscillator Level",this.volume.volume,{min:-32,max:0,unit:"db",defaultValue:-6}),this.registerParameter(this.oscillatorLevelParameter),this.oscillatorTypeParameter=new Wt("Oscillator Type",this,function(e,t){return e.synth.set({oscillator:{type:t}})},{min:0,max:1,unit:"",defaultValue:"triangle",automatable:!1}),this.registerParameter(this.oscillatorTypeParameter),this.oscillatorFrequencyParameter=new Wt("Oscillator Frequency",this,function(e,t){return[]},{min:0,max:1,unit:"",defaultValue:0,automatable:!1}),this.registerParameter(this.oscillatorFrequencyParameter),this.detuneParameter=new Kt("Detune",this,function(e,t){e.synth.set({detune:t})},{min:-1e3,max:1e3,unit:"",defaultValue:0}),this.registerParameter(this.detuneParameter),this.portamentoParameter=new Wt("Portamento",this,function(e,t){return e.synth.set({portamento:t/20})},{min:0,max:10,unit:"",defaultValue:0}),this.registerParameter(this.portamentoParameter),this.polyphonyParameter=new Kt("Polyphony",this,function(t,n){e.polyphonySet&&e.createNewSynth(n),e.polyphonySet=!0},{min:0,max:16,unit:"",defaultValue:1,automatable:!1}),this.registerParameter(this.polyphonyParameter),this.partialsParameter=new Wt("Partials",this,function(e,t){return e.synth.set({oscillator:{partials:t}})},{unit:"",defaultValue:null,automatable:!1}),this.registerParameter(this.partialsParameter),this.synth.set({filter:{frequency:1e4},filterEnvelope:{attack:1e-4,decay:1e-4,sustain:1,release:10}}),this.refreshLFOs()}},{key:"registerParameter",value:function(e,t){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"disconnectSynthFromPitchEnvelope",value:function(){}},{key:"removeBuiltInFilterEnvelope",value:function(){}},{key:"connectSynthToPitchEnvelope",value:function(){}},{key:"createNewSynth",value:function(e){if(void 0!==this.polyphonyParameter&&e===this.synth.voices.length)return;var t=this.synth;this.parameters.forEach(function(e){return e.disconnectFromAllModulators()}),this.synth.disconnect(this.volume),this.disconnectSynthFromPitchEnvelope(this.synth),this.synth=this.synthFactory(e),this.synth.connect(this.volume),this.polyphonySet=!1,this.refreshParameters(),this.connectSynthToPitchEnvelope(this.synth),this.voiceCounter=0,t.dispose(),this.refreshLFOs(),this.removeBuiltInFilterEnvelope(this.synth),this.onNewSynth&&this.onNewSynth()}},{key:"getDetuneVoices",value:function(){return this.synth.voices.map(function(e){return e.detune})}},{key:"refreshParameters",value:function(){this.oscillatorType=this.oscillatorType,this.portamento=this.portamento,null!==this.partials&&(this.partials=this.partials)}},{key:"getCopy",value:function(e,t,n){return n.oscillatorFrequency=this.oscillatorFrequency,n.oscillatorLevel=this.oscillatorLevel,n.detune=this.detune,n.polyphony=this.polyphony,n.portamento=this.portamento,n.oscillatorType=this.oscillatorType,n.pulseWidth=this.pulseWidth,n}},{key:"getJson",value:function(){var e={enabled:this.enabled,oscillatorType:this.oscillatorType,oscillatorFrequency:this.oscillatorFrequency,oscillatorLevel:this.oscillatorLevel,polyphony:this.polyphony,portamento:this.portamento,detune:this.detune,partials:this.partials};return e=ln(e,"enabledParameter",this.enabledParameter),e=ln(e,"oscillatorLevelParameter",this.oscillatorLevelParameter),e=ln(e,"detuneParameter",this.detuneParameter),e=ln(e,"portamentoParameter",this.portamentoParameter),e=ln(e,"oscillatorFrequencyParameter",this.oscillatorFrequencyParameter),e=ln(e,"oscillatorTypeParameter",this.oscillatorTypeParameter),e=ln(e,"partialsParameter",this.partialsParameter)}},{key:"fromJson",value:function(e){this.enabled=e.enabled,this.enabled&&!this.isInitialized()&&this.create(),this.polyphony=e.polyphony,this.oscillatorFrequency=e.oscillatorFrequency,Object($e.a)(e.detune)&&(this.detune=e.detune),this.oscillatorType=e.oscillatorType,this.portamento=e.portamento,this.oscillatorLevel=e.oscillatorLevel,void 0!==e.partials&&null!==e.partials&&(this.partials=e.partials),pn(e,"enabledParameter",this.enabledParameter,this.sequencerEngine),pn(e,"portamentoParameter",this.portamentoParameter,this.sequencerEngine),pn(e,"detuneParameter",this.detuneParameter,this.sequencerEngine),pn(e,"oscillatorFrequencyParameter",this.oscillatorFrequencyParameter,this.sequencerEngine),pn(e,"oscillatorTypeParameter",this.oscillatorTypeParameter,this.sequencerEngine),pn(e,"oscillatorLevelParameter",this.oscillatorLevelParameter,this.sequencerEngine),pn(e,"partialsParameter",this.partialsParameter,this.sequencerEngine)}},{key:"setEnvelopes",value:function(e,t){this.getAmpEnvelopes();this.synth.set({envelope:{attack:new q.a.Time((1+t.attack)/1e3),decay:new q.a.Time((1+t.decay)/1e3),sustain:Math.min(t.sustain,.99),release:new q.a.Time((1+t.release)/1e3)}})}},{key:"getAmpEnvelopes",value:function(){return this.synth.voices.map(function(e){return e.envelope})}},{key:"releaseAll",value:function(){this.synth.releaseAll(),this.synth.voices.forEach(function(e){return e.triggerRelease()}),this.pitchEnvelope&&this.pitchEnvelope.triggerRelease(),this.lastNote=void 0}},{key:"getNoteFromTranspose",value:function(e){return this.getDefaultNote().transpose(e+this.oscillatorFrequency)}},{key:"getDefaultNote",value:function(){return rc}},{key:"connect",value:function(e){void 0!==e&&(this.volume.connect(e),this.node=e)}},{key:"disconnect",value:function(e){this.volume.disconnect(e),this.node=void 0}},{key:"refreshLFOs",value:function(){this.detuneParameter.setAudioParams(this.synth.voices.map(function(e){return e.oscillator.detune}))}},{key:"mateParameter",value:function(e,t,n,a){Cn(this.sequencerEngine,e,t,n,a)}},{key:"mateJson",value:function(e,t){this.mateParameter("enabled",e,this.enabledParameter,t),this.enabled&&(this.enabled=!0,this.mateParameter("polyphony",e,this.polyphonyParameter,t),this.mateParameter("oscillatorType",e,this.oscillatorTypeParameter,t),this.mateParameter("oscillatorFrequency",e,this.oscillatorFrequencyParameter,t),this.mateParameter("detune",e,this.detuneParameter,t),this.mateParameter("portamento",e,this.portamentoParameter,t))}},{key:"enabled",get:function(){return this.enabledParameter.get()},set:function(e){this.enabledParameter.set(e)}},{key:"oscillatorLevel",get:function(){return this.oscillatorLevelParameter.get()},set:function(e){return this.oscillatorLevelParameter.set(e)}},{key:"oscillatorType",get:function(){return this.oscillatorTypeParameter.get()},set:function(e){this.oscillatorTypeParameter.get();this.oscillatorTypeParameter.set(e),"custom"===e&&(this.partials=[1,1,1,1,1,1,0,1,0,1,0,1].concat(Array(32).fill(0)))}},{key:"partials",set:function(e){"custom"!==this.oscillatorType&&(this.oscillatorType="custom"),this.partialsParameter.set(e)},get:function(){return this.partialsParameter.get()}},{key:"oscillatorFrequency",get:function(){return this.oscillatorFrequencyParameter.get()},set:function(e){this.oscillatorFrequencyParameter.set(e)}},{key:"detune",get:function(){return this.detuneParameter.get()},set:function(e){this.detuneParameter.set(e)}},{key:"pulseWidth",get:function(){return this.pulseWidthParameter.get()},set:function(e){this.pulseWidthParameter.set(e)}},{key:"portamento",get:function(){return this.portamentoParameter.get()},set:function(e){this.portamentoParameter.set(e)}},{key:"polyphony",get:function(){return void 0===this.polyphonyParameter?8:this.polyphonyParameter.get()},set:function(e){this.polyphonyParameter.set(e)}}]),e}(),oc=function(e){function t(e,n,a,r){var s,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return Object(o.a)(this,t),(s=Object(u.a)(this,Object(l.a)(t).call(this,e,n,a,function(e){return new q.a.PolySynth(e,q.a.MonoSynth,{disableFilter:!0})},r,i))).lastNote=void 0,s.frequencyToVoice={},s.voiceCounter=0,s.node=void 0,s}return Object(h.a)(t,e),Object(c.a)(t,[{key:"create",value:function(){Object(ze.a)(Object(l.a)(t.prototype),"create",this).call(this),this.removeBuiltInFilterEnvelope(this.synth),this.connectSynthToPitchEnvelope(this.synth)}},{key:"triggerAttack",value:function(e,t,n){if(this.enabled){var a=this.getNoteFromTranspose(e);this.lastNote=e,this.synth.voices[this.voiceCounter].triggerAttack(a,t,n),this.frequencyToVoice[a.toFrequency()]=this.voiceCounter,this.voiceCounter=(this.voiceCounter+1)%this.polyphony}}},{key:"hasCustomWaveform",value:function(){return null!==this.partialsParameter.get()}},{key:"triggerAttackRelease",value:function(e,t,n,a){if(this.enabled){var r=this.getNoteFromTranspose(e);this.synth.voices[this.voiceCounter].triggerAttackRelease(r,t,n,a),this.frequencyToVoice[r.toFrequency()]=this.voiceCounter,this.voiceCounter=(this.voiceCounter+1)%this.polyphony}}},{key:"triggerRelease",value:function(e){var t=this;if(this.enabled&&(void 0===e.map&&(e=[e]),1!=this.polyphony||e[0]===this.lastNote)){var n=e.map(function(e){return t.getNoteFromTranspose(e)}),a=this.frequencyToVoice[n[0].toFrequency()];void 0!==a?(this.pitchEnvelope.triggerRelease(a),this.synth.voices[a].triggerRelease()):this.synth.triggerRelease(n)}}},{key:"setupParameters",value:function(){Object(ze.a)(Object(l.a)(t.prototype),"setupParameters",this).call(this),this.pulseWidthParameter=new Wt("Pulse Width",this,function(e,t){return e.synth.set({oscillator:{width:t}})},{min:0,max:1,unit:"",defaultValue:.1}),this.registerParameter(this.pulseWidthParameter)}},{key:"refreshParameters",value:function(){Object(ze.a)(Object(l.a)(t.prototype),"refreshParameters",this).call(this),this.pulseWidth=this.pulseWidth}},{key:"removeBuiltInFilterEnvelope",value:function(e){}},{key:"connectSynthToPitchEnvelope",value:function(e){var t=this;this.getDetuneVoices().forEach(function(e){return t.pitchEnvelope.connect(e)})}},{key:"disconnectSynthFromPitchEnvelope",value:function(e){var t=this;this.getDetuneVoices().forEach(function(e){return t.pitchEnvelope.disconnect(e)})}},{key:"getCopy",value:function(e,n){var a=new t(this.store,this.mixSession,e,n);return this.getCopy(e,n,a)}},{key:"getJson",value:function(){return ln(Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{pulseWidth:this.pulseWidth}),"pulseWidthParameter",this.pulseWidthParameter)}},{key:"fromJson",value:function(e){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e),this.pulseWidth=e.pulseWidth,pn(e,"pulseWidthParameter",this.pulseWidthParameter)}}]),t}(ic),cc=function(e){function t(e,n,a){var r;return Object(o.a)(this,t),(r=Object(u.a)(this,Object(l.a)(t).call(this))).sequencerEngine=e,r.store=e.store,r.mixSession=n,r.context=a.getCopy().forInstrument(Object(p.a)(r)),r.pitchEnvelope=new nc(e,n,r.context),r.oscillatorNodes=[r.createNewOscillator(),r.createNewOscillator(),r.createNewOscillator(!1),r.createNewOscillator(!1)],r.oscillators[0].enabled=!0,r.oscillators[1].enabled=!0,r.filter=new un.FilterEffect(e,Ye),r.ampEnvelope=new tc(e,n,r.context),r.filterEnvelope=new tc(e,n,r.context,r.filter.effectNode.frequency,0,1e4),r.connectAudioNodes(),r.polyphonySet=!1,r.parameters=[],r.setupParameters(),r.refreshParameters(),r.filter.cutoffParameter.audioParam.input.automationRate="a-rate",r}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getSubDevices",value:function(){return[{label:"Filter",value:this},{label:"Oscillator 1",value:this.oscillatorNodes[0]},{label:"Oscillator 2",value:this.oscillatorNodes[1]},{label:"Oscillator 3",value:this.oscillatorNodes[2]},{label:"Oscillator 4",value:this.oscillatorNodes[3]},{label:"Amp. Envelope",value:this.ampEnvelope},{label:"Filter Envelope",value:this.filterEnvelope},{label:"Pitch Envelope",value:this.pitchEnvelope}]}},{key:"getSubDeviceIndex",value:function(e){return this.getSubDevices().map(function(e){return e.value}).indexOf(e)}},{key:"getSubDevice",value:function(e){return this.getSubDevices().map(function(e){return e.value})[e]}},{key:"getOscillator",value:function(e){return this.oscillatorNodes[e]}},{key:"connectAudioNodes",value:function(){var e=this;this.oscillatorNodes.forEach(function(t){return t.connect(e.filter.effectNode)})}},{key:"connect",value:function(e){void 0!==e&&this.filter.connect(e)}},{key:"disconnect",value:function(e){this.filter.disconnect(e)}},{key:"createNewOscillator",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new oc(this.sequencerEngine,this.mixSession,this.context,this.pitchEnvelope.envelope,e)}},{key:"addNewOscillator",value:function(){this.oscillators.push(this.createNewOscillator())}},{key:"triggerAttack",value:function(e,t,n){this.pitchEnvelope.refresh(),this.filterEnvelope.refresh(),this.filterEnvelope.triggerAttack(t,n),this.pitchEnvelope.envelope.triggerAttack(t,n),this.oscillators.forEach(function(a){return a.triggerAttack(e,t,n)})}},{key:"triggerAttackRelease",value:function(e,t,n,a){this.pitchEnvelope.refresh(),this.filterEnvelope.refresh(),this.filterEnvelope.triggerAttackRelease(t,n,a),this.pitchEnvelope.envelope.triggerAttackRelease(t,n,a),this.oscillators.forEach(function(r){return r.triggerAttackRelease(e,t,n,a)})}},{key:"triggerRelease",value:function(e){this.filterEnvelope.triggerRelease(),this.pitchEnvelope.envelope.triggerRelease(),this.oscillators.forEach(function(t){return t.triggerRelease(e)})}},{key:"getName",value:function(){return"M. Synth"}},{key:"getInstrument",value:function(){return this}},{key:"getInstrumentType",value:function(){return Jo}},{key:"refreshParameters",value:function(){this.filterQ=this.filterQ,this.filterCutoff=this.filterCutoff}},{key:"createLFO",value:function(){return new jn(this.sequencerEngine,this.mixSession,this.context)}},{key:"setupParameters",value:function(e){var t=this;this.filterCutoffParameter=new Qt("Filter Cutoff",this.filter.effectNode.frequency,function(e,n){t.filterEnvelope.frequency=n,t.filter.cutoffFrequency=n,t.oscillators.forEach(function(e){return e.cutoffFrequency=n})},{min:0,max:1e4,unit:"HZ",defaultValue:1200,constantAutomationRate:!0}),this.registerParameter(this.filterCutoffParameter,function(e){return e.filter.frequency}),this.filterQParameter=new Qt("Filter Q",this.filter.effectNode.Q,function(e,n){return t.filter.Q=n},{min:0,max:9,unit:"",defaultValue:1}),this.registerParameter(this.filterQParameter,function(e){return e.filter.Q})}},{key:"getCopy",value:function(e){var n=new t(this.sequencerEngine,this.mixSession,e);return n.fromJson(this.getJson()),n}},{key:"getJson",value:function(){var e={instrumentType:this.getInstrumentType(),filterCutoff:this.filterCutoff,filterQ:this.filterQ,oscillators:this.oscillators.map(function(e){return e.getJson()}),ampEnvelope:this.ampEnvelope.getJson(),filterEnvelope:this.filterEnvelope.getJson(),pitchEnvelope:this.pitchEnvelope.getJson()};return e=ln(e,"filterCutoffParameter",this.filterCutoffParameter),e=ln(e,"filterQParameter",this.filterQParameter)}},{key:"fromJson",value:function(e){for(var t in this.instrumentType=e.instrumentType,this.filterCutoff=e.filterCutoff,this.filterQ=e.filterQ,this.oscillators){t=parseInt(t),this.oscillators[t].fromJson(e.oscillators[t])}this.filterEnvelope.fromJson(e.filterEnvelope),this.ampEnvelope.fromJson(e.ampEnvelope),this.pitchEnvelope.fromJson(e.pitchEnvelope),pn(e,"filterCutoffParameter",this.filterCutoffParameter,this.sequencerEngine),pn(e,"filterQParameter",this.filterQParameter,this.sequencerEngine)}},{key:"releaseAll",value:function(){this.oscillators.forEach(function(e){return e.releaseAll()})}},{key:"isMonophonic",value:function(){return this.oscillators.every(function(e){return 1==e.polyphony})}},{key:"setEnvelopes",value:function(e){var t=this;this.oscillators.forEach(function(n){return n.setEnvelopes(e,t.ampEnvelope)})}},{key:"getParameters",value:function(){var e=Object(ge.a)(this.parameters);for(var t in this.oscillators)e=e.concat(this.oscillators[t].parameters);return(e=e.concat(this.ampEnvelope.parameters).concat(this.pitchEnvelope.parameters).concat(this.filterEnvelope.parameters)).filter(function(e){return void 0!==e})}},{key:"findParameter",value:function(e,t){var n=e.envelopeType,a=this.getParameters();n===ac?a=this.ampEnvelope.parameters:"PITCH"===n?a=this.pitchEnvelope.parameters:"FILTER"===n&&(a=this.filterEnvelope.parameters);var r=a.filter(function(e){return e.name===t});if(0!==r.length)return r[0]}},{key:"mateJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;for(var n in e.oscillators){this.getOscillator(n).mateJson(e.oscillators[n])}this.ampEnvelope.mateJson(e.ampEnvelope,t),this.filterEnvelope.mateJson(e.filterEnvelope,t),this.pitchEnvelope.mateJson(e.pitchEnvelope,t),this.mateParameter("filterCutoff",e,this.filterCutoffParameter,t),this.mateParameter("filterQ",e,this.filterQParameter,t),this.mateParameter("noiseVolume",e,this.noiseVolumeParameter,t)}},{key:"mateParameter",value:function(e,t,n,a){Cn(this.sequencerEngine,e,t,n,a)}},{key:"dispose",value:function(){this.oscillatorNodes.forEach(function(e){return e.dispose()}),this.filter.dispose(),this.pitchEnvelope.dispose(),this.filterEnvelope.dispose(),this.ampEnvelope.dispose(),this.oscillatorNodes=void 0,this.filter=void 0,this.pitchEnvelope=void 0,this.filterEnvelope=void 0,this.ampEnvelope=void 0,this.parameters.forEach(function(e){return e.dispose()}),this.parameters=void 0}},{key:"oscillators",get:function(){return this.oscillatorNodes.filter(function(e){return e.isInitialized()})}},{key:"name",get:function(){return this.getName()}},{key:"filterCutoff",get:function(){return this.filterCutoffParameter.get()},set:function(e){this.filterCutoffParameter.set(e)}},{key:"filterQ",get:function(){return this.filterQParameter.get()},set:function(e){this.filterQParameter.set(e)}}]),t}(Xo),uc=function(e){function t(e,n,a,r,s,i){var c;return Object(o.a)(this,t),(c=Object(u.a)(this,Object(l.a)(t).call(this,e,n,a,r,s,i,!1))).setInstrument(new cc(n,a,(new Kn).forTrack(Object(p.a)(c)))),c}return Object(h.a)(t,e),t}(ec),lc=function(e){function t(e,n,a){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e,n,a,function(e){return new q.a.PolySynth(e,q.a.FMSynth)}))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"setupParameters",value:function(){Object(ze.a)(Object(l.a)(t.prototype),"setupParameters",this).call(this),this.harmonicityParameter=new Qt("Harmonicity",this,function(e,t){return e.synth.set({harmonicity:t})},{min:0,max:20,unit:"",defaultValue:3}),this.registerParameter(this.harmonicityParameter),this.modulationIndexParameter=new Qt("modulationIndex",this,function(e,t){return e.synth.set({modulationIndex:t})},{min:0,max:1e3,unit:"",defaultValue:10}),this.harmonicityParameter.setAudioParams(this.synth.voices.map(function(e){return e.harmonicity})),this.modulationIndexParameter.setAudioParams(this.synth.voices.map(function(e){return e.modulationIndex})),this.partialCountParameter=new Wt("Partial Count",this,function(e,t){return e.synth.set({oscillator:{partialCount:t}})},{min:0,automatable:!1,max:16,unit:"",defaultValue:0}),this.registerParameter(this.partialCountParameter),this.registerParameter(this.modulationIndexParameter)}},{key:"refreshParameters",value:function(){Object(ze.a)(Object(l.a)(t.prototype),"refreshParameters",this).call(this),this.harmonicity=this.harmonicity,this.modulationIndex=this.modulationIndex,this.partialCount=this.partialCount,this.harmonicityParameter.setAudioParams(this.synth.voices.map(function(e){return e.harmonicity})),this.modulationIndexParameter.setAudioParams(this.synth.voices.map(function(e){return e.modulationIndex}))}},{key:"getJson",value:function(){var e=Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{harmonicity:this.harmonicity,modulationIndex:this.modulationIndex,partialCount:this.partialCount});return e=ln(e,"harmonicityParameter",this.harmonicityParameter),e=ln(e,"modulationIndexParameter",this.modulationIndexParameter),e=ln(e,"partialCountParameter",this.partialCountParameter)}},{key:"fromJson",value:function(e){Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,e),this.harmonicity=parseFloat(e.harmonicity),this.modulationIndex=parseFloat(e.modulationIndex),this.partialCount=e.partialCount,pn(e,"harmonicityParameter",this.harmonicityParameter,this.sequencerEngine),pn(e,"modulationIndexParameter",this.modulationIndexParameter,this.sequencerEngine),pn(e,"partialCountParameter",this.partialCountParameter,this.sequencerEngine)}},{key:"mateJson",value:function(e,n){Object(ze.a)(Object(l.a)(t.prototype),"mateJson",this).call(this,e,n),this.mateParameter("harmonicity",e,this.harmonicityParameter,n),this.mateParameter("modulationIndex",e,this.modulationIndexParameter,n),this.mateParameter("partialCount",e,this.partialCountParameter,n)}},{key:"harmonicity",get:function(){return this.harmonicityParameter.get()},set:function(e){return this.harmonicityParameter.set(e)}},{key:"modulationIndex",get:function(){return this.modulationIndexParameter.get()},set:function(e){return this.modulationIndexParameter.set(e)}},{key:"partialCount",get:function(){return this.partialCountParameter.get()},set:function(e){return this.partialCountParameter.set(e)}}]),t}(ic),pc=function(){function e(t,n,a,r){Object(o.a)(this,e),this.sequencerEngine=t,this.store=t.store,this.mixSession=n,this.context=a.getCopy().forSubDevice(this),this.fmSynth=r,this.parameters=[],this.setupParameters()}return Object(c.a)(e,[{key:"setupParameters",value:function(){this.oscillatorTypeParameter=new Wt("Oscillator Type",this,function(e,t){return e.synth.set({modulation:{type:t}})},{min:0,max:1,unit:"",defaultValue:"triangle",automatable:!1}),this.registerParameter(this.oscillatorTypeParameter),this.partialCountParameter=new Wt("Partial Count",this,function(e,t){return e.synth.set({modulation:{partialCount:t}})},{min:0,max:16,unit:"",defaultValue:0}),this.registerParameter(this.partialCountParameter)}},{key:"refreshParameters",value:function(){this.oscillatorType=this.oscillatorType}},{key:"registerParameter",value:function(e,t){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getJson",value:function(){var e={oscillatorType:this.oscillatorType,partialCount:this.partialCount};return e=ln(e,"partialCountParameter",this.partialCountParameter),ln(e,"oscillatorTypeParameter",this.oscillatorTypeParameter)}},{key:"fromJson",value:function(e){this.oscillatorType=e.oscillatorType,e.partialCount&&(this.partialCount=e.partialCount),pn(e,"oscillatorTypeParameter",this.oscillatorTypeParameter),pn(e,"partialCountParameter",this.partialCountParameter)}},{key:"mateJson",value:function(e,t){this.mateParameter("partialCount",e,this.partialCountParameter,t),this.mateParameter("oscillatorType",e,this.oscillatorTypeParameter,t)}},{key:"mateParameter",value:function(e,t,n,a){Cn(this.sequencerEngine,e,t,n,a)}},{key:"synth",get:function(){return this.fmSynth.synth}},{key:"oscillatorType",get:function(){return this.oscillatorTypeParameter.get()},set:function(e){this.oscillatorTypeParameter.set(e)}},{key:"partialCount",get:function(){return this.partialCountParameter.get()},set:function(e){return this.partialCountParameter.set(e)}}]),e}(),hc=function(e){function t(e,n,a){var r;return Object(o.a)(this,t),(r=Object(u.a)(this,Object(l.a)(t).call(this))).notes=[],r.sequencerEngine=e,r.store=e.store,r.mixSession=n,r.context=a.getCopy().forInstrument(Object(p.a)(r)),r.ampEnvelope=new tc(e,n,r.context),r.modulationEnvelope=new tc(e,n,r.context),r.filter=new un.FilterEffect(e,Ye),r.filter.effectNode.rolloff=-18,r.filterEnvelope=new tc(e,n,r.context,r.filter.effectNode.frequency,0,1e4),r.filterEnvelope2=new tc(e,n,r.context,r.filter.effectNode.frequency,0,1e4),r.carrierOscillator=new lc(e,n,r.context),r.modulatorOscillator=new pc(e,n,r.context,Object(p.a)(r)),r.noiseOscillator=new q.a.NoiseSynth,r.connectSynthToFilter(),r.parameters=[],r.setupParameters(),r.carrierOscillator.onNewSynth=function(){return r.onNewSynth()},r.lastTime=void 0,r.currentNotes=[],r}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getSubDevices",value:function(){return[{label:"Filter",value:this},{label:"Carrier Oscillator",value:this.carrierOscillator},{label:"Modulator Oscillator",value:this.modulatorOscillator},{label:"Amp Envelope",value:this.ampEnvelope},{label:"Filter Envelope",value:this.filterEnvelope},{label:"Filter Envelope 2",value:this.filterEnvelope2},{label:"Modulation Envelope",value:this.modulationEnvelope}]}},{key:"onNewSynth",value:function(){this.connectSynthToFilter(),this.modulatorOscillator.refreshParameters()}},{key:"triggerAttack",value:function(e,t,n){this.filterEnvelope.refresh(),this.filterEnvelope2.refresh();var a=this.carrierOscillator.getNoteFromTranspose(e);this.notes.push(a),this.filterEnvelope.triggerAttack(t,n),this.filterEnvelope2.triggerAttack(t,n),this.synth.triggerAttack(a,t,n),this.noiseOscillator.triggerAttack(t,n)}},{key:"triggerAttackRelease",value:function(e,t,n,a){var r=this.carrierOscillator.getNoteFromTranspose(e);this.notes.push(r),this.filterEnvelope.refresh(),this.filterEnvelope2.refresh(),this.filterEnvelope.triggerAttackRelease(t,n,a),this.filterEnvelope2.triggerAttackRelease(t,n,a),this.synth.triggerAttackRelease(r,t,n,a),this.noiseOscillator.triggerAttackRelease(t,n,a)}},{key:"triggerRelease",value:function(e){var t=this,n=e.map(function(e){return t.carrierOscillator.getNoteFromTranspose(e)});this.filterEnvelope.triggerRelease(),this.filterEnvelope2.triggerRelease(),this.synth.triggerRelease(n),this.noiseOscillator.triggerRelease()}},{key:"releaseAll",value:function(){this.synth.releaseAll(),this.notes=[]}},{key:"setEnvelopes",value:function(e){this.carrierOscillator.setEnvelopes(e,this.ampEnvelope),this.setModulationEnvelopes(),this.setAmpEnvelopeForNoise(e)}},{key:"setModulationEnvelopes",value:function(){this.synth.set({modulationEnvelope:{attack:new q.a.Time((1+this.modulationEnvelope.attack)/1e3),decay:new q.a.Time((1+this.modulationEnvelope.decay)/1e3),sustain:this.modulationEnvelope.sustain,release:new q.a.Time((1+this.modulationEnvelope.release)/1e3)}})}},{key:"setAmpEnvelopeForNoise",value:function(){this.noiseOscillator.envelope.attack=new q.a.Time((1+this.ampEnvelope.attack)/1e3),this.noiseOscillator.envelope.decay=new q.a.Time((1+this.ampEnvelope.decay)/1e3),this.noiseOscillator.envelope.sustain=this.ampEnvelope.sustain,this.noiseOscillator.envelope.release=new q.a.Time((1+this.ampEnvelope.release)/1e3)}},{key:"dispose",value:function(){this.noiseOscillator.dispose(),this.filterEnvelope.dispose(),this.filterEnvelope2.dispose(),this.filter.dispose(),this.carrierOscillator.dispose(),this.noiseOscillator=void 0,this.filterEnvelope=void 0,this.filterEnvelope2=void 0,this.filter=void 0,this.carrierOscillator=void 0}},{key:"connectSynthToFilter",value:function(){this.synth.connect(this.filter.effectNode),this.noiseOscillator.connect(this.filter.effectNode)}},{key:"connect",value:function(e){void 0!==e&&this.filter.connect(e)}},{key:"disconnect",value:function(e){this.filter.disconnect(e)}},{key:"setupParameters",value:function(){var e=this;this.filterCutoffParameter=new Qt("Filter Cutoff",this.filter.effectNode.frequency,function(t,n){e.filterEnvelope.frequency=n,e.filterEnvelope2.frequency=n,e.filter.cutoffFrequency=n},{min:0,max:1e4,unit:"HZ",defaultValue:1200,constantAutomationRate:!0}),this.registerParameter(this.filterCutoffParameter,function(e){return e.filter.frequency}),this.filterQParameter=new Qt("Filter Q",this.filter.effectNode.Q,function(t,n){return e.filter.Q=n},{min:0,max:9,unit:"",defaultValue:1}),this.registerParameter(this.filterQParameter,function(e){return e.filter.Q}),this.noiseVolumeParameter=new Qt("noiseVolume",this.noiseOscillator.volume,function(t,n){return e.noiseOscillator.volume.value=n},{min:-100,max:-4,unit:"db",defaultValue:-100}),this.registerParameter(this.noiseVolumeParameter)}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setMixSession(this.mixSession),e.setContext(this.context),e.setTrack(this.context.track),this.parameters.push(e)}},{key:"getParameters",value:function(){return[].concat(Object(ge.a)(this.parameters),Object(ge.a)(this.ampEnvelope.parameters),Object(ge.a)(this.filterEnvelope.parameters),Object(ge.a)(this.filterEnvelope2.parameters),Object(ge.a)(this.modulationEnvelope.parameters),Object(ge.a)(this.carrierOscillator.parameters),Object(ge.a)(this.modulatorOscillator.parameters))}},{key:"isMonophonic",value:function(){return 1===this.carrierOscillator.polyphony}},{key:"refreshParameters",value:function(){this.filterQ=this.filterQ,this.filterCutoff=this.filterCutoff}},{key:"getName",value:function(){return"FM Synth"}},{key:"getInstrument",value:function(){return this}},{key:"getInstrumentType",value:function(){return Go}},{key:"getJson",value:function(){var e={instrumentType:this.getInstrumentType(),filterCutoff:this.filterCutoff,filterQ:this.filterQ,carrierOscillator:this.carrierOscillator.getJson(),modulatorOscillator:this.modulatorOscillator.getJson(),ampEnvelope:this.ampEnvelope.getJson(),filterEnvelope:this.filterEnvelope.getJson(),filterEnvelope2:this.filterEnvelope2.getJson(),modulationEnvelope:this.modulationEnvelope.getJson(),noiseVolume:this.noiseVolumeParameter.get()};return e=ln(e,"filterCutoffParameter",this.filterCutoffParameter),e=ln(e,"filterQParameter",this.filterQParameter),e=ln(e,"noiseVolumeParameter",this.noiseVolumeParameter)}},{key:"fromJson",value:function(e){for(var t in this.instrumentType=e.instrumentType,this.filterCutoff=e.filterCutoff,this.filterQ=e.filterQ,e.lfos)this.lfos[t].fromJson(e.lfos[t]);void 0!==e.noiseVolume&&this.noiseVolumeParameter.set(e.noiseVolume),this.carrierOscillator.fromJson(e.carrierOscillator),this.modulatorOscillator.fromJson(e.modulatorOscillator),this.filterEnvelope.fromJson(e.filterEnvelope),e.filterEnvelope2&&this.filterEnvelope2.fromJson(e.filterEnvelope2),this.ampEnvelope.fromJson(e.ampEnvelope),this.modulationEnvelope.fromJson(e.modulationEnvelope),pn(e,"filterCutoffParameter",this.filterCutoffParameter,this.sequencerEngine),pn(e,"filterQParameter",this.filterQParameter,this.sequencerEngine),pn(e,"noiseVolumeParameter",this.noiseVolumeParameter,this.sequencerEngine)}},{key:"getCopy",value:function(e){var n=new t(this.sequencerEngine,this.mixSession,e);return n.fromJson(this.getJson()),n}},{key:"mateJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;this.carrierOscillator.mateJson(e.carrierOscillator,t),this.modulatorOscillator.mateJson(e.modulatorOscillator,t),this.ampEnvelope.mateJson(e.ampEnvelope,t),this.filterEnvelope.mateJson(e.filterEnvelope,t),this.filterEnvelope2.mateJson(e.filterEnvelope2,t),this.modulationEnvelope.mateJson(e.modulationEnvelope,t),this.mateParameter("filterCutoff",e,this.filterCutoffParameter,t),this.mateParameter("filterQ",e,this.filterQParameter,t),this.mateParameter("noiseVolume",e,this.noiseVolumeParameter,t)}},{key:"mateParameter",value:function(e,t,n,a){Cn(this.sequencerEngine,e,t,n,a)}},{key:"findParameter",value:function(e,t){var n=e.envelopeType,a=this.getParameters();n===ac?a=this.ampEnvelope.parameters:"MODULATION"===n?a=this.modulationEnvelope.parameters:"FILTER"===n?a=this.filterEnvelope.parameters:"FILTER_2"===n&&(a=this.filterEnvelope2.parameters);var r=a.filter(function(e){return e.name===t});if(0!==r.length)return r[0]}},{key:"synth",get:function(){return this.carrierOscillator.synth}},{key:"filterCutoff",get:function(){return this.filterCutoffParameter.get()},set:function(e){this.filterCutoffParameter.set(e)}},{key:"filterQ",get:function(){return this.filterQParameter.get()},set:function(e){this.filterQParameter.set(e)}}]),t}(Xo),dc=function(e){function t(e,n,a,r,s,i){var c;return Object(o.a)(this,t),(c=Object(u.a)(this,Object(l.a)(t).call(this,e,n,a,r,s,i,!1))).setInstrument(new hc(n,a,(new Kn).forTrack(Object(p.a)(c)))),c}return Object(h.a)(t,e),t}(ec),fc=function(e){function t(e,n,a,r,s){var i;return Object(o.a)(this,t),(i=Object(u.a)(this,Object(l.a)(t).call(this,e,n,a,r,s,!0))).parameters=[],i.onParameter=new Wt("on",Object(p.a)(i),function(e,t){return[]},{min:!1,max:!0,unit:"",defaultValue:!1}),i.registerParameter(i.onParameter),i.loopParameter=new Wt("loop",Object(p.a)(i),function(e,t){return[]},{min:!1,max:!0,unit:"",defaultValue:!1}),i.registerParameter(i.loopParameter),i.loadFromJson(s),i.startTime=void 0,i.endTime=void 0,i}return Object(h.a)(t,e),Object(c.a)(t,[{key:"auditionSound",value:function(e){this.sample=e,this.audioBuffer=e.audioBuffer,this.baseBuffer=new q.a.Buffer(e.audioBuffer),this.sampler._buffers._buffers[48]=this.baseBuffer,this.slice(0,0,this.getDuration()),this.registerParameter(this.volumeParameter)}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.samplerData,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sliceData,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(ze.a)(Object(l.a)(t.prototype),"init",this).call(this,e,n,a),this.sampler=new q.a.Sampler({C3:this.baseBuffer},{curve:"linear"}),this.volumeParameter=new Xt("volume",this.sampler.output.volume,{min:-100,max:0,unit:"db",defaultValue:0}),this.registerParameter(this.volumeParameter),this}},{key:"dispose",value:function(){this.sample.dispose(),this.sampler.dispose(),this.baseBuffer.dispose(),this.slices=[],this.detuneSignal.dispose(),this.pitchEnvelopes.forEach(function(e){return e.dispose()}),this.sample=void 0,this.sampler=void 0,this.baseBuffer=void 0,this.pitchEnvelopes=void 0,this.detuneSignal=void 0}},{key:"isDisposed",value:function(){return void 0===this.sampler}},{key:"getSlice",value:function(){return{buffer:this.baseBuffer,startTime:this.startTime,endTime:this.endTime}}},{key:"get",value:function(){return this.sampler}},{key:"newSlice",value:function(e,t){return this.startTime=e,this.endTime=t,this.slices.push(new mc(this.baseBuffer,e,t)),this.sliceData.push({startTime:e,endTime:t}),this.slice(this.slices.length-1,e,t,!0),this.slices[this.slices.length-1]}},{key:"slice",value:function(e,t,n){arguments.length>3&&void 0!==arguments[3]&&arguments[3];var a=this.slices[e];n=void 0==n?this.getDuration():n,a.startTime=t,a.endTime=n;this.alpha;this.sliceData[e]={startTime:t,endTime:n},this.startTime=t,this.endTime=n,this.updateSlicesState()}},{key:"loadFromJson",value:function(e){this.onParameter.set(void 0===e.on||e.on),pn(e,"onParameter",this.onParameter),this.loop=e.loop||!1,pn(e,"loopParameter",this.loopParameter),this.detune=e.detune||0,pn(e,"detuneParameter",this.detuneParameter)}},{key:"registerParameter",value:function(e){e.setStore(this.store),this.parameters.push(e)}},{key:"getJson",value:function(){var e=Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{on:this.onParameter.get(),loop:this.loop,detune:this.detune});return e=ln(e,"onParameter",this.onParameter),e=ln(e,"loopParameter",this.loopParameter),e=ln(e,"detuneParameter",this.detuneParameter)}},{key:"triggerAttack",value:function(){var e=Object(g.a)(v.a.mark(function e(n,a,r,s,i,o){var c,u,p,h,d,f;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getNoteFromTranspose(n),c=this.get(0),u=s.start,u=this.convertToStartTime(0,u),u+=this.startTime,c.loop=this.loop,p=this.getLoopPoints(s),h=p.loopStart,d=p.loopEnd,u=h,c.loopStart=h,c.loopEnd=d,f=[this.getPitchEnvelope(c,n,a,r,this.track.trackData)],i&&f.push(i),e.next=14,Object(ze.a)(Object(l.a)(t.prototype),"triggerAttack",this).call(this,c,n,a,r,f,u,o);case 14:case"end":return e.stop()}},e,this)}));return function(t,n,a,r,s,i){return e.apply(this,arguments)}}()},{key:"triggerAttackRelease",value:function(){var e=Object(g.a)(v.a.mark(function e(n,a,r,s,i,o,c){var u,p,h,d,f,m;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getNoteFromTranspose(n),u=i.start,u=this.convertToStartTime(0,u),u+=this.startTime,(p=this.get(0)).loop=this.loop,h=this.getLoopPoints(i),d=h.loopStart,f=h.loopEnd,u=d,p.loopStart=d,p.loopEnd=f,m=[this.getPitchEnvelope(p,n,r,s,this.track.trackData)],o&&m.push(o),e.next=14,Object(ze.a)(Object(l.a)(t.prototype),"triggerAttackRelease",this).call(this,p,n,a,r,s,m,u,c);case 14:case"end":return e.stop()}},e,this)}));return function(t,n,a,r,s,i,o){return e.apply(this,arguments)}}()},{key:"triggerRelease",value:function(e){var t=this;e=e.map(function(e){return t.getNoteFromTranspose(e)}),this.get(0).triggerRelease(e)}},{key:"getLoopPoints",value:function(e){var t=e.loopStart,n=e.loopLength,a=(t=this.startTime+this.getDuration()*(t/100))+this.getDuration()*(n/100);return{loopStart:t,loopEnd:Math.min(a,this.endTime)}}},{key:"setLoopPoints",value:function(e){var t=this.getLoopPoints(e),n=t.loopStart,a=t.loopEnd;for(var r in this.sampler._activeSources){this.sampler._activeSources[r].forEach(function(e){e.loopStart=n,e.loopEnd=a})}}},{key:"gainNode",get:function(){return this.sampler.output}},{key:"detune",set:function(e){this.detuneParameter.set(e)},get:function(){return this.detuneParameter.get()}},{key:"on",set:function(e){this.onParameter.set(e)},get:function(){return this.onParameter.get()}},{key:"loop",set:function(e){this.loopParameter.set(e)},get:function(){return this.loopParameter.get()}}]),t}(ko),mc=function(){function e(t,n,a){Object(o.a)(this,e),this.buffer=t,this.originalBuffer=t,this.startTime=n,this.endTime=a}return Object(c.a)(e,[{key:"getCopy",value:function(){return new e(this.buffer,this.startTime,this.endTime)}},{key:"getJson",value:function(){return{buffer:this.buffer,startTime:this.startTime,endTime:this.endTime}}},{key:"dispose",value:function(){}}]),e}(),vc=fc;var gc=function(){function e(t){Object(o.a)(this,e),this.input=this.output=new q.a.Gain(1)}return Object(c.a)(e,[{key:"restart",value:function(e){this.lfo&&(this.lfo.stop(e),this.lfo.start(e))}},{key:"onTick",value:function(e){}},{key:"trigger",value:function(e,t,n){var a=t.loopLengthSeconds;if(void 0!==this.lfo&&!(a<=0)){var r=q.a.Frequency(a,"s").transpose(n);isNaN(r)||void 0===r||(this.lfo.frequency.value=r),this.restart(e)}}},{key:"loop",set:function(e){e&&void 0===this.lfo?(this.lfo=new q.a.LFO({type:"triangle",phase:90,min:.7,max:1}),this.lfo.connect(this.input.gain)):e||void 0===this.lfo||(this.lfo.dispose(),this.lfo=void 0)}},{key:"smooth",set:function(e){this.lfo&&(this.lfo.min=e)}}]),e}(),bc=6,yc=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;arguments.length>1&&arguments[1];Object(o.a)(this,e),this.outputNode=new q.a.Gain(1),this.voiceNumber=t,this.ampEnvelope=new q.a.AmplitudeEnvelope(10,10,1,100),this.ampLFO=new gc,this.ampEnvelope.connect(this.ampLFO.input),this.ampLFO.output.connect(this.outputNode),this.ampEnvelope.releaseCurve="linear",this.ampEnvelope.attackCurve="linear",this.ampEnvelope.decayCurve="linear",this.samplerToTriggers={},this.samplerToTransposes={},this.idToSampler={},this.samplerLimit=bc}return Object(c.a)(e,[{key:"clear",value:function(){this.samplerToTriggers={},this.idToSampler={}}},{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"dispose",value:function(){this.outputNode.dispose(),this.ampEnvelope.dispose(),this.outputNode=void 0,this.ampEnvelope=void 0,this.samplerToTriggers=void 0}},{key:"useSampler",value:function(e,t,n,a){void 0!==this.samplerToTriggers[e.id]&&void 0!==this.samplerToTriggers[e.id][n]&&0!==this.samplerToTriggers[e.id][n]||(this.samplerToTriggers[e.id]={},this.samplerToTriggers[e.id][n]=0),this.samplerToTriggers[e.id][n]++,this.idToSampler[e.id]=e,this.ampLFO.trigger(t,a,n+e.transpose),this.tooManyTriggers()>0&&this.releaseOldestTrigger(e,0,t)}},{key:"onVoiceRelease",value:function(e,t){this.samplerToTriggers[e.id]&&delete this.samplerToTriggers[e.id][t]}},{key:"disconnectSampler",value:function(e,t){return void 0===this.samplerToTriggers[e.id]||void 0===this.samplerToTriggers[e.id][t]||0===this.samplerToTriggers[e.id][t]&&(delete this.samplerToTriggers[e.id][t],!0)}},{key:"isUsed",value:function(){return Object.keys(this.samplerToTriggers).length>0}},{key:"isUsingSampler",value:function(e){return void 0!==this.samplerToTriggers[e.id]&&Object.keys(this.samplerToTriggers[e.id]).length>0}},{key:"tooManyTriggers",value:function(){return this.totalTriggers-bc}},{key:"getFromMap",value:function(e,t){return Object.keys(e).filter(function(t){return e[t]&&e[t].length>0})[t]}},{key:"releaseOldestTrigger",value:function(e,t,n){for(var a in(n-=.005)<0&&(n=0),this.idToSampler)if(this.idToSampler[a]!==e){var r=this.idToSampler[a].sampler,s=this.getFromMap(r._activeSources,t);if(void 0!==s)return void r.triggerRelease(new q.a.Midi(s).toFrequency(),n,.005)}var i=e.sampler,o=this.getFromMap(i._activeSources,t);i.triggerRelease(new q.a.Midi(o).toFrequency(),n,.005)}},{key:"totalTriggers",get:function(){var e=0;for(var t in this.samplerToTriggers){var n=this.samplerToTriggers[t];for(var a in n)e+=n[a]}return e}}]),e}(),kc=function(){function e(t,n,a){Object(o.a)(this,e),this.voices=[],this.outputNode=new q.a.Gain(1);for(var r=0;r<t;r++){var s=new yc(r,a);s.connect(this.outputNode),this.voices.push(s)}this.unusedVoices=Object(ge.a)(this.voices),this.outputNode.connect(n),this.numVoices=t,this.samplersUsed=new Set}return Object(c.a)(e,[{key:"getVoices",value:function(){return 1===this.numVoices?[this.voices[0]]:this.voices}},{key:"clear",value:function(){this.voices.forEach(function(e){return e.clear()}),this.samplersUsed=new Set}},{key:"dispose",value:function(){this.voices.forEach(function(e){return e.dispose()}),this.outputNode.dispose(),this.voices=void 0,this.outputNode=void 0}},{key:"getUnusedVoiceIfAny",value:function(e){return 1===this.numVoices?this.voices[0]:0===this.unusedVoices.length?this.voices[Math.floor(Math.random()*this.numVoices)]:this.unusedVoices.shift()}},{key:"getVoiceUsingSampler",value:function(e,t){return this.voices.find(function(n){return n.samplerToTriggers[e.id]&&n.samplerToTriggers[e.id][t]})}},{key:"useSamplerWithVoice",value:function(e,t,n,a,r){t.useSampler(e,n,a,r),this.samplersUsed.add(e)}},{key:"disconnectSamplerFromVoice",value:function(e,t,n){t.disconnectSampler(e,n)&&(t.isUsed()||(this.unusedVoices.push(t),this.samplersUsed.delete(e)))}},{key:"triggerAttack",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n,a,r,s,i){var o;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.getUnusedVoiceIfAny(t),this.useSamplerWithVoice(t,o,a,n,s),o.ampEnvelope.triggerAttack(a,r),e.next=5,t.triggerAttack(n,a,r,s,i,o.ampEnvelope);case 5:this.disconnectSamplerFromVoice(t,o,n);case 6:case"end":return e.stop()}},e,this)}));return function(t,n,a,r,s,i){return e.apply(this,arguments)}}()},{key:"triggerAttackRelease",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n,a,r,s,i,o){var c;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c=this.getUnusedVoiceIfAny(t),this.useSamplerWithVoice(t,c,r,n,i),c.ampEnvelope.triggerAttackRelease(a,r,s,i),e.next=5,t.triggerAttackRelease(n,a,r,s,i,o,c.ampEnvelope);case 5:c.onVoiceRelease(t,n),this.disconnectSamplerFromVoice(t,c,n);case 7:case"end":return e.stop()}},e,this)}));return function(t,n,a,r,s,i,o){return e.apply(this,arguments)}}()},{key:"triggerRelease",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.triggerRelease(n),void 0!==(a=this.getVoiceUsingSampler(t,n[0]))){e.next=4;break}return e.abrupt("return");case 4:a.totalTriggers<=1&&a.ampEnvelope.triggerRelease(),a.onVoiceRelease(t,n[0]);case 6:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"ampEnvelopes",get:function(){return this.voices.map(function(e){return e.ampEnvelope})}}]),e}(),Ec=n(338),Sc=function(){function e(){Object(o.a)(this,e),this.isRecording=!1}return Object(c.a)(e,[{key:"startRecordLoop",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("start record loop");case 1:if(void 0===this.recorder){e.next=7;break}return e.next=4,this.sleep(1e4);case 4:this.isRecording||(console.log("clearing"),this.recorder.clear()),e.next=1;break;case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"sleep",value:function(e){return new Promise(function(){var t=Object(g.a)(v.a.mark(function t(n,a){return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:setTimeout(function(){n()},e);case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"start",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.recorder.clear(),this.isRecording=!0}},{key:"stop",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(function(){var n=Object(g.a)(v.a.mark(function n(a,r){return v.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.sleep(t);case 2:e.recorder.getBuffer(function(t){var n=e.getSample(t);e.recorder.clear(),e.isRecording=!1,a(n)});case 3:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getSample",value:function(e){var t=e[0].length,n=q.a.Master.context.createBuffer(2,t,q.a.Master.context.sampleRate);n.copyToChannel(e[0],0,0),n.copyToChannel(e[1],1,0);var a=new K.a;return a.audioBuffer=n,a}},{key:"input",set:function(e){if(void 0===e)return this.recorder.clear(),this.recorder.stop(),this.recorder=void 0,void(this.isRecording=!1);this.recorder=new window.Recorder(e,{numChannels:2,bufferLen:1024}),this.recorder.record((new Date).getTime()),this.startRecordLoop()}}]),e}(),Oc=1,wc=2,Cc=2,Pc=3;var Tc=.025,jc=800;function xc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Tc,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:jc,r=e.getChannelData(0),s=window.api.create_buffer(r.length);window.Module.HEAPF32.set(r,s>>2),window.api.findLoop(s,r.length,t,n,a);var i=window.api.get_result_pointer(),o=new Uint16Array(window.Module.HEAP16.buffer,i,2);if(console.log("resultView = ",o),0!=o[0]||0!=o[1]){var c={start:o[0],end:o[1],difference:1};return window.api.destroy_buffer(s),c}}var Nc=6,qc=function(e){function t(e,n,a,r){var s;return Object(o.a)(this,t),(s=Object(u.a)(this,Object(l.a)(t).call(this))).cache={},s.sequencerEngine=e,s.store=e.store,s.mixSession=n,s.context=a,s.track=r,s.solutionNumber=0,s.outputNode=new q.a.Gain(1),s.voices=new kc(Nc,s.outputNode,Object(p.a)(s)),s.resampler=new Sc,s.samplers={},s.recordingModeParameter=new Wt("recordingMode",Object(p.a)(s),function(e,t){return[]},{min:!1,max:!0,unit:"",defaultValue:!1}),s.registerParameter(s.recordingModeParameter),s.interpolationModeParameter=new Wt("interpolationMode",Object(p.a)(s),function(e,t){return[]},{min:Oc,max:wc,unit:"",defaultValue:Oc}),s.registerParameter(s.interpolationModeParameter),s.mixModeParameter=new Wt("mixMode",Object(p.a)(s),function(e,t){return[]},{min:Cc,max:Pc,unit:"",defaultValue:Pc}),s.registerParameter(s.mixModeParameter),s.glideParameter=new Wt("glide",Object(p.a)(s),function(e,t){return[]},{min:0,max:5e3,unit:"",defaultValue:0}),s.registerParameter(s.glideParameter),s.monophonicParameter=new Wt("monophonic",Object(p.a)(s),function(e,t){s.voices.numVoices=t?1:Nc},{min:!1,max:!0,unit:"",defaultValue:!1}),s.registerParameter(s.monophonicParameter),s.detuneSignal=new q.a.Signal(1e3),s.detuneParameter=new Xt("detune",s.detuneSignal,{min:-200,max:200,defaultValue:0,automationRate:Ye}),s.registerParameter(s.detuneParameter),s.smoothParameter=new Wt("smooth",Object(p.a)(s),function(e,t){var n=1-t;s.voices.voices.forEach(function(e){return e.ampLFO.smooth=n})},{min:0,max:1,unit:"",defaultValue:!1}),s.registerParameter(s.smoothParameter),s.setupAmpEnvelopeParameters(),s.setupLoopParameters(),s.lastTranspose=void 0,s.triggerCounters={},s}return Object(h.a)(t,e),Object(c.a)(t,[{key:"setupAmpEnvelopeParameters",value:function(){var e=this;this.ampAttackParameter=new Wt("ampAttack",this,function(t,n){for(var a in e.ampEnvelopes)e.ampEnvelopes[a].attack=n/1e3},{min:0,max:5e3,unit:"",defaultValue:10}),this.registerParameter(this.ampAttackParameter),this.ampDecayParameter=new Wt("ampDecay",this,function(t,n){for(var a in e.ampEnvelopes)e.ampEnvelopes[a].decay=n/1e3},{min:0,max:5e3,unit:"",defaultValue:10}),this.registerParameter(this.ampDecayParameter),this.ampSustainParameter=new Wt("ampSustain",this,function(t,n){for(var a in e.ampEnvelopes)e.ampEnvelopes[a].sustain=Math.min(.99,n)},{min:0,max:1,unit:"",defaultValue:.8}),this.registerParameter(this.ampSustainParameter),this.ampReleaseParameter=new Wt("ampRelease",this,function(t,n){for(var a in e.ampEnvelopes)e.ampEnvelopes[a].release=n/1e3},{min:0,max:5e3,unit:"",defaultValue:10}),this.registerParameter(this.ampReleaseParameter)}},{key:"setupLoopParameters",value:function(){var e=this;this.loopParameter=new Wt("loop",this,function(t,n){e.loop=n},{min:!1,max:!0,unit:"",defaultValue:!1}),this.registerParameter(this.loopParameter),this.loopStartParameter=new Wt("loopStart",this,function(t,n){Array.from(e.voices.samplersUsed).forEach(function(t){return t.setLoopPoints({loopStart:n,loopLength:e.loopLength})})},{min:0,max:100,unit:"",defaultValue:0}),this.registerParameter(this.loopStartParameter),this.loopLengthParameter=new Wt("loopLength",this,function(t,n){Array.from(e.voices.samplersUsed).forEach(function(t){return t.setLoopPoints({loopStart:e.loopStart,loopLength:n})})},{min:0,max:100,unit:"",defaultValue:100}),this.registerParameter(this.loopLengthParameter)}},{key:"onNewStep",value:function(){var e=this;if(this.loop&&(this.loopStartParameter.isConnectedToAnyModulator()||this.loopLengthParameter.isConnectedToAnyModulator())){var t=1-this.smoothParameter.get();this.voices.voices.filter(function(e){return e.ampLFO.lfo}).forEach(function(e){return e.ampLFO.lfo.min=t}),Array.from(this.voices.samplersUsed).forEach(function(t){return t.setLoopPoints({loopStart:e.loopStart,loopLength:e.loopLength})})}}},{key:"connect",value:function(e){this.outputNode.connect(e)}},{key:"disconnect",value:function(){this.outputNode.disconnect()}},{key:"connectToTrack",value:function(e){if(!e)return this.connectedTrack=void 0,void(this.resampler.input=void 0);this.connectedTrack=e,this.resampler.input=e.volumeNode}},{key:"getInstrument",value:function(){return this}},{key:"getInstrumentType",value:function(){return Uo}},{key:"getName",value:function(){return"Sampled Instrument"}},{key:"getPitchEnvelope",value:function(e){if(0!==this.glide){var t=100*((void 0===this.lastTranspose?e:this.lastTranspose)-e),n=new q.a.ScaledEnvelope({attack:this.glide/1e3,decay:.01,min:t,max:0,sustain:1,release:0,curve:"linear"});return n._releaseCurve="linear",n._decayCurve="linear",n}}},{key:"triggerAttack",value:function(e,t,n,a){var r=this.getSampler(e,!1),s=r.samplers,i=r.closest;if(void 0!==s){var o=this.getPitchEnvelope(e);for(var c in this.lastTranspose=parseFloat(e),this.monophonic&&this.releaseAll(t),s)s[c].sampler.attack=this.ampAttack/1e3,s[c].sampler.release=this.ampRelease/1e3,this.voices.triggerAttack(s[c],e-i,t,n,this.getLoopPoints(a,s[c]),o)}}},{key:"playSampler",value:function(e){this.voices.triggerAttack(e,0,0,1,0,void 0)}},{key:"triggerAttackRelease",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n,a,r,s){var i,o,c,u,l,p;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.getSampler(t,!0),o=i.samplers,c=i.closest,void 0!==o){e.next=3;break}return e.abrupt("return");case 3:for(l in u=this.getPitchEnvelope(t),this.lastTranspose=parseFloat(t),this.monophonic&&this.releaseAll(a),o)(p=o[l]).sampler.release=this.ampRelease/1e3,p.sampler.attack=this.ampAttack/1e3,this.voices.triggerAttackRelease(p,t-c,n,a,r,this.getLoopPoints(s,p),u);case 7:case"end":return e.stop()}},e,this)}));return function(t,n,a,r,s){return e.apply(this,arguments)}}()},{key:"getLoopPoints",value:function(e,t){return{start:e,loopStart:this.loopStart,loopLength:this.loopLength,loopLengthSeconds:(t.endTime-t.startTime)*(this.loopLength/100)}}},{key:"triggerRelease",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r,s,i,o,c;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=v.a.keys(t);case 1:if((e.t1=e.t0()).done){e.next=10;break}if(n=e.t1.value,a=t[n],r=this.getSampler(a,!0),s=r.samplers,i=r.closest,void 0!==s){e.next=7;break}return e.abrupt("continue",1);case 7:for(o in s)c=s[o],this.voices.triggerRelease(c,[a-i]);e.next=1;break;case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"releaseAll",value:function(e){for(var t in this.voices.clear(),this.samplers){this.samplers[t].forEach(function(t){t.get(0).release=.01,t.get(0).releaseAll(e)})}}},{key:"newSample",value:function(e,t){var n=this;return new Promise(function(){var a=Object(g.a)(v.a.mark(function a(r,s){var i,o;return v.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(void 0!==(t=t.getCopy()).audioBuffer){a.next=4;break}return a.next=4,t.fetchAudio();case 4:i={slices:void 0,offset:0,transpose:0,volume:0},o=new vc(n.track,t,function(){return[]},void 0,i),setTimeout(Object(g.a)(v.a.mark(function a(){var s,i,c;return v.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(o.init(),n.detuneSignal.connect(o.detuneSignal.input),o.sliceFirstOnset(!0),void 0===(s=o.onsets[0]||0)){a.next=11;break}return a.next=7,n.getPitch(t,s);case 7:void 0===(i=a.sent)?void 0===e&&(e=0):(void 0===e&&(e=i),(c=e-i)<-30&&(c+=36),o.transpose=c),a.next=12;break;case 11:void 0===e&&(e=0);case 12:n.cache={},void 0===n.samplers[e]&&(n.samplers[e]=[]),n.samplers[e]=[].concat(Object(ge.a)(n.samplers[e]),[o]),n.selectSampler(e,o),r({sampler:o,samplers:n.samplers[e]});case 17:case"end":return a.stop()}},a)})),500);case 7:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"getTriggerCount",value:function(e){return this.triggerCounters[e]||0}},{key:"getAllSamplersAtExactTranspose",value:function(e){var t=this.samplers[e];return this.mixMode===Cc&&(t=this.samplers[e].filter(function(e){return e.on})),t}},{key:"filterNeededSamplers",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0!==e){if(this.mixMode===Pc){var a=[e[this.getTriggerCount(t)%e.length]];return n&&(this.triggerCounters[t]=this.getTriggerCount(t)+1),a}return e}}},{key:"getSampler",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e in this.cache){var n=this.cache[e];return Object(X.a)({},n,{samplers:this.filterNeededSamplers(n.samplers,e,t)})}var a=e;e in this.samplers||(a=this.findClosest(e));var r=this.getAllSamplersAtExactTranspose(a);return this.cache[e]={closest:parseFloat(a),samplers:r},{closest:parseFloat(a),samplers:this.filterNeededSamplers(r,e,t)}}},{key:"findClosest",value:function(e){return this.interpolationMode===Oc?function(e,t){var n=void 0,a=void 0;for(var r in t){r=parseInt(r);var s=Math.abs(e-r);void 0!==n?s<a&&(n=r,a=s):(n=r,a=s)}return parseFloat(n)}(e,this.samplers):function(e,t){var n=bs.a.fromTranspose(e);n.octave=0;var a=void 0,r=void 0,s=void 0;for(var i in t){var o=bs.a.fromTranspose(i);o.octave=0;var c=Math.abs(n.getTranspose()-o.getTranspose()),u=Math.abs(e-i);(void 0===s||c<s||c===s&&u<r)&&(a=i,s=c,r=u)}return parseFloat(a)}(e,this.samplers)}},{key:"getJson",value:function(){var e=Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{ampAttack:this.ampAttack,ampDecay:this.ampDecay,ampSustain:this.ampSustain,ampRelease:this.ampRelease,interpolationMode:this.interpolationMode,mixMode:this.mixMode,samplers:{},glide:this.glide,monophonic:this.monophonic,detune:this.detuneParameter.get(),loopStart:this.loopStart,loopLength:this.loopLength,smooth:this.smoothParameter.get()});for(var n in this.samplers)e.samplers[n]=this.samplers[n].map(function(e){return e.getJson()});return e=ln(e,"ampAttackParameter",this.ampAttackParameter),e=ln(e,"ampDecayParameter",this.ampDecayParameter),e=ln(e,"ampSustainParameter",this.ampSustainParameter),e=ln(e,"ampReleaseParameter",this.ampReleaseParameter),e=ln(e,"interpolationModeParameter",this.interpolationModeParameter),e=ln(e,"mixModeParameter",this.mixModeParameter),e=ln(e,"glideParameter",this.glideParameter),e=ln(e,"monophonicParameter",this.monophonicParameter),e=ln(e,"detuneParameter",this.detuneParameter),e=ln(e,"loopStartParameter",this.loopStartParameter),e=ln(e,"loopLengthParameter",this.loopLengthParameter),e=ln(e,"smoothParameter",this.smoothParameter)}},{key:"fromJson",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.clearSamples(),this.ampAttackParameter.set(t.ampAttack),this.ampDecayParameter.set(t.ampDecay),this.ampSustainParameter.set(t.ampSustain),this.ampReleaseParameter.set(t.ampRelease),void 0!==t.loopStart&&this.loopStartParameter.set(t.loopStart),void 0!==t.loopLength&&this.loopLengthParameter.set(t.loopLength),void 0!==t.detune?this.detuneParameter.set(t.detune):this.detuneParameter.set(0),t.interpolationMode&&(this.interpolationMode=t.interpolationMode),void 0!==t.mixMode&&(this.mixMode=t.mixMode),void 0!==t.glide&&(this.glide=t.glide),void 0!==t.monophonic&&(this.monophonic=t.monophonic),void 0!==t.smooth&&this.smoothParameter.set(t.smooth),pn(t,"ampAttackParameter",this.ampAttackParameter,this.sequencerEngine),pn(t,"ampDecayParameter",this.ampDecayParameter,this.sequencerEngine),pn(t,"ampSustainParameter",this.ampSustainParameter,this.sequencerEngine),pn(t,"ampReleaseParameter",this.ampReleaseParameter,this.sequencerEngine),pn(t,"interpolationModeParameter",this.interpolationModeParameter),pn(t,"mixModeParameter",this.mixModeParameter),pn(t,"glideParameter",this.glideParameter,this.sequencerEngine),pn(t,"monophonicParameter",this.monophonicParameter,this.sequencerEngine),pn(t,"detuneParameter",this.detuneParameter,this.sequencerEngine),pn(t,"loopStartParameter",this.loopStartParameter,this.sequencerEngine),pn(t,"loopLengthParameter",this.loopLengthParameter,this.sequencerEngine),pn(t,"smoothParameter",this.smoothParameter,this.sequencerEngine),e.t0=v.a.keys(t.samplers);case 26:if((e.t1=e.t0()).done){e.next=43;break}if(n=e.t1.value,void 0===t.samplers[n].length){e.next=39;break}e.t2=v.a.keys(t.samplers[n]);case 30:if((e.t3=e.t2()).done){e.next=37;break}return a=e.t3.value,r=t.samplers[n][a],e.next=35,this.loadSamplerFromJson(parseFloat(n),r);case 35:e.next=30;break;case 37:e.next=41;break;case 39:return e.next=41,this.loadSamplerFromJson(parseFloat(n),t.samplers[n]);case 41:e.next=26;break;case 43:this.loop=this.loop;case 44:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadSamplerFromJson",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a,r;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new K.a(n.sampleId,this.sequencerEngine.encryptedIpfs),e.prev=1,e.next=4,a.load();case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return");case 9:(r=new vc(this.track,a,function(){return[]},n.slices,n)).init(void 0,void 0,!0),this.detuneSignal.connect(r.detuneSignal,0,0),void 0===this.samplers[t]&&(this.samplers[t]=[]),this.samplers[t].push(r),this.cache={};case 15:case"end":return e.stop()}},e,this,[[1,6]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearSamples",value:function(){for(var e in this.samplers){for(var t in this.samplers[e])this.samplers[e][t].dispose();delete this.samplers[e]}}},{key:"dispose",value:function(){this.clearSamples(),this.voices.dispose(),this.voices=void 0,this.samplers=void 0,this.outputNode.dispose(),this.outputNode=void 0}},{key:"getPitch",value:function(e){var t=this;arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(){var n=Object(g.a)(v.a.mark(function n(a,r){var s,i,o;return v.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0===(s=t.getNoteFromName(e.name))){n.next=4;break}return a(s),n.abrupt("return");case 4:return a(void 0),n.abrupt("return");case 10:(i=n.sent).notes.length>0&&(i.notes.sort(function(e,t){return t.endTime-t.starTime-(e.endTime-e.startTime)}),o=i.notes[0].pitch-48,a(o)),a(void 0);case 13:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"deleteSampler",value:function(e){for(var t in this.samplers){var n=this.samplers[t].indexOf(e);n>-1&&(this.samplers[t].splice(n,1),e.dispose()),0===this.samplers[t].length&&delete this.samplers[t]}this.cache={},this.voices.clear()}},{key:"selectSampler",value:function(e,t){this.cache={},this.samplers[e].filter(function(e){return e!==t}).forEach(function(e){return e.on=!1}),t.on=!0}},{key:"getNoteFromName",value:function(e){var t=void 0;if(2===e.length?t=e.substring(0,1):3===e.length&&(t=e.substring(0,2)),t&&bs.a.baseNotes.indexOf(t)>-1)return bs.a.fromString(e).getTranspose()}},{key:"findLoop",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n,a){var r,s,i,o,c;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(this.solutionNumber+=500,t=this.solutionNumber),r=this.getAllSamplersAtExactTranspose(0)[0],s=xc(r.audioBuffer,t,n,a),i=s.start,!((o=s.end)<i)){e.next=7;break}return this.solutionNumber=Math.ceil(10*Math.random()),this.findLoop(void 0,n,a),e.abrupt("return");case 7:c=100*i/(q.a.Master.context.sampleRate*r.getDuration()),this.loopStartParameter.set(c),this.loopLengthParameter.set(100*(o-i)/(q.a.Master.context.sampleRate*r.getDuration()));case 10:case"end":return e.stop()}},e,this)}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"getCopy",value:function(){var e=Object(g.a)(v.a.mark(function e(){var n,a,r=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>0&&void 0!==r[0]?r[0]:this.context,a=new t(this.sequencerEngine,this.mixSession,n,n.track),e.next=4,a.fromJson(this.getJson());case 4:return e.abrupt("return",a);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"makePublicIfNeeded",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r,s,i;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 2:if((e.t1=e.t0()).done){e.next=22;break}t=e.t1.value,n=this.samplers[t],e.t2=v.a.keys(n);case 6:if((e.t3=e.t2()).done){e.next=20;break}return a=e.t3.value,r=this.samplers[t][a],s=r.sample,e.next=12,R.a.guildSamples.getGuildIdForSound(s.getId());case 12:if(0===e.sent){e.next=18;break}return e.next=16,R.a.guildSamples.saveSample(s);case 16:i=e.sent,s.ipfsHash=i;case 18:e.next=6;break;case 20:e.next=2;break;case 22:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"allSamplers",get:function(){var e=[];for(var t in this.samplers)e=[].concat(Object(ge.a)(e),Object(ge.a)(this.samplers[t]));return e}},{key:"loop",get:function(){return this.allSamplers.every(function(e){return e.loop})},set:function(e){this.allSamplers.forEach(function(t){return t.loop=e}),this.voices.voices.forEach(function(t){return t.ampLFO.loop=e})}},{key:"ampEnvelopes",get:function(){return this.voices.ampEnvelopes}},{key:"loopStart",get:function(){return this.loopStartParameter.get()}},{key:"loopLength",get:function(){return this.loopLengthParameter.get()}},{key:"glide",get:function(){return this.glideParameter.get()},set:function(e){this.glideParameter.set(e)}},{key:"interpolationMode",get:function(){return this.interpolationModeParameter.get()},set:function(e){this.interpolationModeParameter.set(e),this.cache={}}},{key:"monophonic",get:function(){return this.monophonicParameter.get()},set:function(e){this.monophonicParameter.set(e)}},{key:"mixMode",get:function(){return this.mixModeParameter.get()},set:function(e){this.mixModeParameter.set(e),this.cache={}}},{key:"ampAttack",get:function(){return this.ampAttackParameter.get()}},{key:"ampDecay",get:function(){return this.ampDecayParameter.get()}},{key:"ampSustain",get:function(){return this.ampSustainParameter.get()}},{key:"ampRelease",get:function(){return this.ampReleaseParameter.get()}},{key:"recordingMode",get:function(){return this.recordingModeParameter.get()&&void 0!==this.connectedTrack}}]),t}(Xo),Mc=R.a.presets,Dc=function(e){function t(e,n,a,r,s,i){var c;!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return Object(o.a)(this,t),(c=Object(u.a)(this,Object(l.a)(t).call(this,e,n,a,r,s,i,!1))).setInstrument(new qc(n,a,(new Kn).forTrack(Object(p.a)(c)),Object(p.a)(c))),c}return Object(h.a)(t,e),Object(c.a)(t,[{key:"auditionPreset",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("SampledInstrumentTrack.auditionPreset("+t.name+")"),n=t.name,e.next=4,Mc.getPresetData(t);case 4:a=e.sent,this.fromJson(a.trackParameters),this.presetName=n,this.update();case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadTrackInfo",value:function(e,t){this.selectedSampler&&(this.sample=t,this.selectedSampler.auditionSound(t),this.sequencerEngine.update())}},{key:"restart",value:function(){this.instrument.triggerCounters={},this.instrument.cache={},this.instrument.voices.clear()}},{key:"onNewStep",value:function(){Object(ze.a)(Object(l.a)(t.prototype),"onNewStep",this).call(this),this.instrument.onNewStep()}},{key:"getCopy",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(ze.a)(Object(l.a)(t.prototype),"getCopy",this).call(this,function(e,n,a,r,s,i){return new t(e,n,a,r,s,i)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"makePublicIfNeeded",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),t}(ec),Ac=function(){function e(t,n){Object(o.a)(this,e),this.track=t,this.instrumentRack=n,this.track.instrumentRack=this.instrumentRack,this.sequencerEngine=t.sequencerEngine,this.store=this.sequencerEngine.store,this.parameters=[],this.volumeParameter=new Xt("volume",this.track.volumeNode.volume,{min:0,max:1,unit:"db",defaultValue:0}),this.registerParameter(this.volumeParameter),this.track.effectsChains[0].parameterContext=(new Kn).forTrack(n);var a=this.track.instrument.parameters;for(var r in a)a[r].setContext((new Kn).forTrack(n))}return Object(c.a)(e,[{key:"getName",value:function(){return this.track.getName()}},{key:"registerParameter",value:function(e){e.setStore(this.store),e.setContext((new Kn).forTrack(this.instrumentRack)),this.parameters.push(e)}},{key:"getJson",value:function(){var e={track:this.track.getJson(),effectsChains:this.track.effectsChains.map(function(e){return e.getJson()}),midiEffects:this.track.midiEffects.getJson(),volume:this.volumeParameter.get(),sendVolumes:this.track.getSendNodes().map(function(e){return e.volume.value})};return e=ln(e,"volumeParameter",this.volumeParameter)}},{key:"fromJson",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a,r;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.track.fromJson(t.track,!1);case 2:if(this.track.effectsChains[0].clear(),this.track.effectsChains[0].fromJson(t.effectsChains[0],this.sequencerEngine.tracks,n),this.track.midiEffects.fromJson(t.midiEffects),this.volumeParameter.set(t.volume),t.sendVolumes)for(a=this.track.getSendNodes(),r=0;r<t.sendVolumes.length;r++)a[r].volume.value=t.sendVolumes[r];pn(t,"volumeParameter",this.volumeParameter,this.sequencerEngine);case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getCopy",value:function(){var t=Object(g.a)(v.a.mark(function t(){var n,a,r;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.track.getCopy();case 2:return n=t.sent,a=new e(n,this.instrumentRack),r=this.getJson(),t.next=7,a.fromJson(r);case 7:return t.abrupt("return",a);case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"getAllParameters",value:function(){return Object(ge.a)(this.parameters)}},{key:"effectsChains",get:function(){return this.track.effectsChains}},{key:"presetName",get:function(){return this.track.presetName}},{key:"trackNumber",get:function(){return this.track.trackNumber}}]),e}();function Rc(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.numberOfPatterns(),r=void 0;if(t===_n)switch(n){case Go:r=new dc(e.tracks.length,e,e.mixSession,a,function(){return e.update()},e.currentSubSequence);break;case Jo:r=new uc(e.tracks.length,e,e.mixSession,a,function(){return e.update()},e.currentSubSequence);break;case Ho:r=new ec(e.tracks.length,e,e.mixSession,a,function(){return e.update()},e.currentSubSequence);break;case Uo:r=new Dc(e.tracks.length,e,e.mixSession,a,function(){return e.update()},e.currentSubSequence)}else t===Wn&&(r=new Lc(e.tracks.length,e,e.mixSession,a,function(){return e.update()},e.currentSubSequence));if(void 0!==r)return r}var Ic=R.a.presets,Lc=function(e){function t(e,n,a,r,s,i){var c;!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return Object(o.a)(this,t),(c=Object(u.a)(this,Object(l.a)(t).call(this,e,n,a,r,s,i))).setupEffects(),c.tracks=[],c}return Object(h.a)(t,e),Object(c.a)(t,[{key:"addPreset",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.name,e.next=3,Ic.getPresetData(t);case 3:return a=e.sent,e.next=6,this.sequencerEngine.loadTrackPreset(a,void 0,!0,!1,n);case 6:return(r=e.sent).presetName=n,s=new Ac(r,this),e.abrupt("return",this.addInstrument(s));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addSample",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=this.addInstrumentType(Uo)).track.instrument.newSample(0,t),n.track.presetName=t.name,e.abrupt("return",n);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addInstrumentType",value:function(e){var t=Rc(this.sequencerEngine,"INSTRUMENT",e);t.setSends(this.sequencerEngine.sends),t.effectsChains[0].clear();var n=new Ac(t,this);return this.addInstrument(n)}},{key:"getName",value:function(){return"Instrument Rack"}},{key:"getTrackType",value:function(){return Wn}},{key:"addInstrument",value:function(e){var t=e.track;return t.trackNumber=this.tracks.length,this.tracks.push(e),t.muteableNode.connect(this.gainNode),e}},{key:"deleteInstrument",value:function(e){var t=this.tracks.indexOf(e);-1!==t&&(this.tracks.splice(t,1),e.track.dispose())}},{key:"liveTrigger",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.tracks.forEach(function(t){return t.track.midiEffects.liveInputTrigger(e)})}},{key:"releaseAll",value:function(e){this.tracks.forEach(function(t){return t.track.releaseAll(e)})}},{key:"liveTriggerRelease",value:function(e,t){this.tracks.forEach(function(n){return n.track.midiEffects.liveInputRelease(e,t)})}},{key:"trigger",value:function(e,t,n){this.tracks.forEach(function(a){return a.track.midiEffects.input(e,t,n)})}},{key:"triggerSamples",value:function(e,t){this.tracks.forEach(function(n){return n.track.triggerSamples(e,t)})}},{key:"triggerSlice",value:function(e){this.tracks.forEach(function(t){return t.track.triggerSlice(e)})}},{key:"triggerSample",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.tracks.forEach(function(a){return a.track.triggerSample(e,t,n)})}},{key:"triggerRelease",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.tracks.forEach(function(n){return n.track.triggerRelease(e,t)})}},{key:"getJson",value:function(){var e=Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this);return e.tracks=this.tracks.map(function(e){return e.getJson()}),e}},{key:"onBPMUpdated",value:function(){for(var e in this.effectsChains.forEach(function(e){return e.onBPMUpdated()}),this.tracks)for(var t in this.tracks[e].effectsChains)this.tracks[e].effectsChains[t].onBPMUpdated()}},{key:"getAllPatternLockedParameters",value:function(){var e=Object(ze.a)(Object(l.a)(t.prototype),"getAllPatternLockedParameters",this).call(this);for(var n in this.tracks)e=[].concat(Object(ge.a)(e),Object(ge.a)(this.tracks[n].track.getAllPatternLockedParameters()),Object(ge.a)(this.tracks[n].parameters.filter(function(e){return e.hasPatternLockedValues()})));return e}},{key:"fromJson",value:function(){var e=Object(g.a)(v.a.mark(function e(n){var a,r,s,i,o,c;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Object(ze.a)(Object(l.a)(t.prototype),"fromJson",this).call(this,n),this.store.dispatch(Object(w.ge)(this.subSequence.id,this.trackNumber,!0)),e.t0=v.a.keys(n.tracks);case 3:if((e.t1=e.t0()).done){e.next=14;break}return a=e.t1.value,r=n.tracks[a].track,s=r.type,i=r.instrumentType,(o=Rc(this.sequencerEngine,s,i)).setSends(this.sequencerEngine.sends),c=new Ac(o,this),e.next=11,c.fromJson(n.tracks[a],!1);case 11:this.addInstrument(c),e.next=3;break;case 14:this.store.dispatch(Object(w.ge)(this.subSequence.id,this.trackNumber,!1));case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onNewStep",value:function(){Object(ze.a)(Object(l.a)(t.prototype),"onNewStep",this).call(this),this.tracks.forEach(function(e){return e.track.onNewStep()})}},{key:"onStepEnded",value:function(e,t){var n=this,a=function(a){var r=n.tracks[a].track;r.midiEffects.output(e,t,t).forEach(function(e){return r.trigger(e.stepData,e.time,t)})};for(var r in this.tracks)a(r)}},{key:"start",value:function(){Object(ze.a)(Object(l.a)(t.prototype),"start",this).call(this),this.tracks.forEach(function(e){return e.track.start()})}},{key:"solo",value:function(e){Object(ze.a)(Object(l.a)(t.prototype),"solo",this).call(this,e),this.tracks.forEach(function(t){return t.track.solo(e,void 0,!1)})}},{key:"getCopy",value:function(){var e=Object(ze.a)(Object(l.a)(t.prototype),"getCopy",this).call(this,function(e,n,a,r,s,i){return new t(e,n,a,r,s,i)}),n=this.instrument.getCopy((new Kn).forTrack(e));return e.setInstrument(n),e}},{key:"getAllParameters",value:function(){var e=[];for(var t in this.tracks)e=[].concat(Object(ge.a)(e),Object(ge.a)(this.tracks[t].getAllParameters()));return e}},{key:"instrument",get:function(){return this}}]),t}(Lo),Fc=function(e){function t(e,n,a){var r;return Object(o.a)(this,t),(r=Object(u.a)(this,Object(l.a)(t).call(this))).sequencerEngine=e,r.store=e.store,r.mixSession=n,r.context=a,r.synth=new q.a.MetalSynth,r.setupParameters(),r}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getInstrumentType",value:function(){return zo}},{key:"getName",value:function(){return"Metal Synth"}},{key:"setupParameters",value:function(){var e=this;this.frequencyParameter=new Wt("Frequency",this,function(t,n){return e.synth.frequency.value=n},{min:0,max:15e3,unit:"",defaultValue:200}),this.registerParameter(this.frequencyParameter),this.resonanceParameter=new Wt("Resonance",this,function(t,n){return e.synth.resonance=n},{min:0,max:1e4,unit:"",defaultValue:100}),this.registerParameter(this.resonanceParameter),this.harmonicityParameter=new Wt("Harmonicity",this,function(t,n){return e.synth.harmonicity=n},{min:0,max:200,unit:"",defaultValue:100}),this.registerParameter(this.harmonicityParameter),this.modulationIndexParameter=new Wt("Modulation Index",this,function(t,n){return e.synth.modulationIndex=n},{min:0,max:200,unit:"",defaultValue:20}),this.registerParameter(this.modulationIndexParameter),this.attackParameter=new Wt("Attack",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:10}),this.registerParameter(this.attackParameter),this.decayParameter=new Wt("Decay",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:200}),this.registerParameter(this.decayParameter),this.sustainParameter=new Wt("Sustain",this,function(e,t){return t},{min:0,max:1,unit:"",defaultValue:1}),this.registerParameter(this.sustainParameter),this.releaseParameter=new Wt("Release",this,function(e,t){return t},{min:0,max:1e4,unit:"",defaultValue:1e3}),this.registerParameter(this.releaseParameter)}},{key:"setEnvelopes",value:function(e){var t=this,n=this.getEnvelopes();n.forEach(function(e){return e.attack=new q.a.Time((1+t.ampAttack)/1e3)}),n.forEach(function(e){return e.release=new q.a.Time((1+t.ampRelease)/1e3)}),n.forEach(function(e){return e.sustain=t.ampSustain}),n.forEach(function(e){return e.decay=new q.a.Time((1+t.ampDecay)/1e3)})}},{key:"getInstrument",value:function(){return this.synth}},{key:"getEnvelopes",value:function(){return[this.synth.envelope]}},{key:"hasNotes",value:function(){return!1}},{key:"getJson",value:function(){var e=Object(X.a)({},Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this),{frequency:this.frequency,resonance:this.resonance,harmonicity:this.harmonicity,modulationIndex:this.modulationIndex,ampAttack:this.ampAttack,ampDecay:this.ampDecay,ampSustain:this.ampSustain,ampRelease:this.ampRelease});return e=ln(e,"frequencyParameter",this.frequencyParameter),e=ln(e,"resonanceParameter",this.resonanceParameter),e=ln(e,"harmonicityParameter",this.harmonicityParameter),e=ln(e,"modulationIndexParameter",this.modulationIndexParameter),e=ln(e,"attackParameter",this.attackParameter),e=ln(e,"decayParameter",this.decayParameter),e=ln(e,"sustainParameter",this.sustainParameter),e=ln(e,"releaseParameter",this.releaseParameter)}},{key:"fromJson",value:function(e){this.frequency=e.frequency,this.resonance=e.resonance,this.harmonicity=e.harmonicity,this.modulationIndex=e.modulationIndex,this.ampAttack=e.ampAttack,this.ampDecay=e.ampDecay,this.ampSustain=e.ampSustain,this.ampRelease=e.ampRelease,pn(e,"frequencyParameter",this.frequencyParameter),pn(e,"resonanceParameter",this.resonanceParameter),pn(e,"modulationIndexParameter",this.modulationIndexParameter),pn(e,"harmonicityParameter",this.harmonicityParameter),pn(e,"attackParameter",this.attackParameter),pn(e,"decayParameter",this.decayParameter),pn(e,"sustainParameter",this.sustainParameter),pn(e,"releaseParameter",this.releaseParameter)}},{key:"frequency",get:function(){return this.frequencyParameter.get()},set:function(e){this.frequencyParameter.set(e)}},{key:"resonance",get:function(){return this.resonanceParameter.get()},set:function(e){this.resonanceParameter.set(e)}},{key:"harmonicity",get:function(){return this.harmonicityParameter.get()},set:function(e){this.harmonicityParameter.set(e)}},{key:"modulationIndex",get:function(){return this.modulationIndexParameter.get()},set:function(e){this.modulationIndexParameter.set(e)}},{key:"ampAttack",get:function(){return this.attackParameter.get()},set:function(e){this.attackParameter.set(e)}},{key:"ampDecay",get:function(){return this.decayParameter.get()},set:function(e){this.decayParameter.set(e)}},{key:"ampSustain",get:function(){return this.sustainParameter.get()},set:function(e){this.sustainParameter.set(e)}},{key:"ampRelease",get:function(){return this.releaseParameter.get()},set:function(e){this.releaseParameter.set(e)}}]),t}(Xo),Vc=function(e){function t(e,n,a,r,s,i){var c;return Object(o.a)(this,t),(c=Object(u.a)(this,Object(l.a)(t).call(this,e,n,a,r,s,i))).setInstrument(new Fc(n,a,(new Kn).forTrack(Object(p.a)(c)))),c}return Object(h.a)(t,e),t}(ec),Bc=function(e){function t(e,n,a,r,s,i){var c;return Object(o.a)(this,t),(c=Object(u.a)(this,Object(l.a)(t).call(this,e,n,a,r,s,i))).setupEffects(),c}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isRecorable",value:function(){return!0}},{key:"getCopy",value:function(){var e=Object(ze.a)(Object(l.a)(t.prototype),"getCopy",this).call(this,function(e,n,a,r,s,i){return new t(e,n,a,s,r,s,i)});return e.selectedRecording=this.selectedRecording,e}},{key:"getName",value:function(){return"Audio Track"}},{key:"getSelectedRecording",value:function(){return this.selectedRecording}},{key:"setSelectedRecording",value:function(e){this.selectedRecording=e}},{key:"getRecordings",value:function(){return Object(ze.a)(Object(l.a)(t.prototype),"getSamplers",this).call(this)}},{key:"getJson",value:function(){var e=Object(ze.a)(Object(l.a)(t.prototype),"getJson",this).call(this);return e.selectedRecording=this.selectedRecording,e}},{key:"fromJson",value:function(e){this.selectedRecording=e.selectedRecording}},{key:"getSelectedRecordingSampler",value:function(){return Object(ze.a)(Object(l.a)(t.prototype),"getSamplers",this).call(this)[this.selectedRecording]}},{key:"getSelectedRecordingSoundId",value:function(){return this.soundIds[this.selectedRecording]}},{key:"getSamplers",value:function(){var e=Object(ze.a)(Object(l.a)(t.prototype),"getSamplers",this).call(this);return e.length>0?[e[this.selectedRecording]]:e}},{key:"getTrackType",value:function(){return"AUDIO"}},{key:"selectedRecording",get:function(){return this.trackData.selectedRecording},set:function(e){this.trackData.selectedRecording=e}}]),t}(Bo),Uc=n(423),Hc=n.n(Uc),Jc=["A","B","C","D","E","F","G","H"],Gc=function(){function e(t,n,a){Object(o.a)(this,e),this.sends=[],this.channelMixer=n,this.sequencerEngine=a,this.masterBus=new zc("Master Bus",void 0,void 0,void 0,a);var r=new zc("A",this.masterBus,n,0,a),s=new kn(a);s.enable(!0),s.setWet(1),r.addEffect(s);var i=new zc("B",this.masterBus,n,1,a),c=new En(a);c.enable(!0),c.setWet(1),i.addEffect(c),this.sends.push(r),this.sends.push(i),r.setSends(this),i.setSends(this)}return Object(c.a)(e,[{key:"createNewSend",value:function(){var e=new zc(Jc[this.sends.length],this.masterBus,this.channelMixer,this.sends.length,this.sequencerEngine);for(var t in e.setSends(this),this.sends.push(e),this.sequencerEngine.subSequences){var n=this.sequencerEngine.subSequences[t];for(var a in n.tracks)n.tracks[a].newSend(e)}}},{key:"dispose",value:function(){this.sends.forEach(function(e){return e.dispose()}),this.masterBus.dispose(),this.sends=void 0}},{key:"getSends",value:function(){return this.sends}},{key:"getJson",value:function(){return this.sends.map(function(e){return e.getJson()})}},{key:"loadFromJson",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];t>=this.sends.length&&this.createNewSend(),this.sends[t].loadFromJson(n)}}}]),e}(),zc=function(){function e(t,n,a,r,s){Object(o.a)(this,e),this.name=t,this.sequencerEngine=s,this.sendNumber=r,this.inputVolume=new q.a.Volume(0),this.outputVolume=new q.a.Volume(0),this.muteableNode=new q.a.Volume(0),this.muteableNode.connect(this.outputVolume),this.tracks=[],this.muted=!1,this.effectsChain=new ia(this.inputVolume,this.muteableNode,(new Kn).forSend(this),s),void 0===n?this.inputVolume.connect(this.outputVolume):this.outputs=a.connect(this.outputVolume),this.sendNodes=[],this.channelMixer=a}return Object(c.a)(e,[{key:"dispose",value:function(){this.inputVolume.dispose(),this.outputVolume.dispose(),this.muteableNode.dispose(),this.effectsChain.dispose(),this.effectsChain=void 0,this.inputVolume=void 0,this.outputVolume=void 0,this.muteableNode=void 0,this.effectsChain=void 0}},{key:"newSend",value:function(e){var t=new q.a.Volume(-100);this.outputVolume.connect(t),e.connectToTrack(t),this.sendNodes.push(t)}},{key:"getSendNodes",value:function(){return this.sendNodes}},{key:"setSends",value:function(e){this.sends=e}},{key:"moveEffectTo",value:function(e,t){this.effectsChain.moveEffectTo(e,t)}},{key:"deleteEffect",value:function(e){this.effectsChain.deleteEffect(e)}},{key:"mute",value:function(e){this.muted=e,this.muteableNode.volume.value=e?-120:0}},{key:"updateEffects",value:function(){this.effectsChain.updateEffects()}},{key:"getVolume",value:function(){return this.outputVolume.volume.value}},{key:"setVolume",value:function(e){this.outputVolume.volume.value=e}},{key:"connectToTrack",value:function(e,t){(t=t||!1)&&e.disconnect(this.inputVolume),e.connect(this.inputVolume)}},{key:"getEffects",value:function(){return this.effectsChain.effects}},{key:"getName",value:function(){return this.name}},{key:"addEffect",value:function(e){this.effectsChain.addEffect(e)}},{key:"getLastEffect",value:function(){return 0==this.effectsChain.effects.length?this.inputVolume:this.effectsChain.effects[this.effectsChain.effects.length-1]}},{key:"getJson",value:function(){return{volume:this.getVolume(),effectsChain:this.effectsChain.getJson(),outputs:this.outputs}}},{key:"loadFromJson",value:function(e){this.setVolume(e.volume);var t=[];for(var n in this.effectsChain.effects.forEach(function(e){return e.dispose()}),this.effectsChain.effects=[],t=e.effectsChain?e.effectsChain:e.effects)this.effectsChain.addEffect(sa(t[n],void 0,this.sequencerEngine));if(e.outputs){var a=Object(Z.a)(e.outputs,2),r=a[0],s=a[1];this.channelMixer.switchChannelOutput(this.outputNode,r,s)&&(this.outputs=[r,s])}}},{key:"outputNode",get:function(){return this.outputVolume}},{key:"effects",get:function(){return this.effectsChain.effects}}]),e}(),_c=Gc,Wc=function(){function e(t){Object(o.a)(this,e),this.store=t,this.input=void 0,this.setupRecording(),this.splitter=void 0,this.init(),this.deviceId=void 0}return Object(c.a)(e,[{key:"init",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(t=localStorage.getItem("deviceId"))){e.next=11;break}return e.next=4,navigator.mediaDevices.enumerateDevices();case 4:if(!e.sent.some(function(e){return e.deviceId===t})){e.next=11;break}return e.next=8,navigator.mediaDevices.getUserMedia({audio:{deviceId:t,echoCancellation:!1}});case 8:n=e.sent,console.log("setting to input = "+t),this.newInputSource(n,t);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getInputChannels",value:function(){return void 0===this.input?[]:[1,2]}},{key:"connect",value:function(e,t){1==t?this.splitter.left.connect(e):this.splitter.right.connect(e)}},{key:"disconnect",value:function(e,t){1==t?this.splitter.left.disconnect():this.splitter.right.disconnect()}},{key:"getRecorder",value:function(){return new window.Recorder(this.input,{numChannels:1,bufferLen:1024})}},{key:"newInputSource",value:function(e,t){this.input.disconnect(),this.splitter.disconnect(),this.startUserMedia(e),t&&(this.deviceId=t),this.store.dispatch(Object(w.J)(t))}},{key:"startUserMedia",value:function(e){this.input=this.audioContext.createMediaStreamSource(e),this.splitter=new q.a.Split,this.input.connect(this.splitter)}},{key:"setupRecording",value:function(){var e=this;try{window.AudioContext=q.a.Master.context,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia,window.URL=window.URL||window.webkitURL,this.audioContext=q.a.Master.context}catch(t){console.log("No web audio support in this browser!")}void 0!==navigator.mediaDevices&&navigator.mediaDevices.getUserMedia({audio:{mandatory:{echoCancellation:!1}}}).then(function(t){return e.startUserMedia(t)}).catch(function(e){console.log("No live audio input: "+e)})}}]),e}(),Kc=function(){function e(){Object(o.a)(this,e),this.latency=0}return Object(c.a)(e,[{key:"getLatency",value:function(){return this.latency}},{key:"setLatency",value:function(e){this.latency=e}}]),e}(),Yc=(un.FilterEffect,function(){function e(t,n,a){Object(o.a)(this,e),this.input=n,this.output=a,this.sequencerEngine=t,this.eq=new vn(t,!1),this.auxSend=new q.a.Gain(0),this.getLowEQ().frequencyParameter.set(250),this.getMidEQ().frequencyParameter.set(1e3),this.getMidEQ().qParameter.set(.9),this.getHighEQ().frequencyParameter.set(3400),this.input.connect(this.eq.effectNode),this.eq.connect(this.output),this.eq.outputNode.connect(this.auxSend)}return Object(c.a)(e,[{key:"dispose",value:function(){this.eq.dispose(),this.auxSend.dispose(),this.auxSend=void 0,this.eq=void 0,this.input=void 0,this.output=void 0}},{key:"getLowEQ",value:function(){return this.eq.equalizerPoints[0]}},{key:"getMidEQ",value:function(){return this.eq.equalizerPoints[4]}},{key:"getHighEQ",value:function(){return this.eq.equalizerPoints[7]}},{key:"color",set:function(e){this.auxSend.gain.value=e}}]),e}()),Qc=function(){function e(t){Object(o.a)(this,e),this.sequencerEngine=t,this.isMulti=!1,this.lazyConnections=[],this.ctxt=q.a.Master.context._context,console.log("max channel count = "+this.ctxt.destination.maxChannelCount),this.ctxt.destination.maxChannelCount>=2&&(this.ctxt.destination.channelCount=this.ctxt.destination.maxChannelCount,this.ctxt.destination.channelCountMode="explicit",this.ctxt.destination.channelInterpretation="discrete"),this.stereoMerger=new q.a.Volume,this.stereoOnly=t.stereoOnly,this.maxChannel=0,this.stereoConnected=!0,this.stereoMerger.connect(q.a.Master),this.outputConnections=[],this.stereoOnly||this.switchOutputs(!0)}return Object(c.a)(e,[{key:"updateChannelCount",value:function(){q.a.Master.context._context.destination.maxChannelCount>=2&&(this.ctxt.destination.channelCount=this.ctxt.destination.maxChannelCount,this.ctxt.destination.channelCountMode="explicit",this.ctxt.destination.channelInterpretation="discrete")}},{key:"connectMixEffects",value:function(){this.stereoMerger.disconnect(),this.mixEffects=new Yc(this.sequencerEngine,this.stereoMerger,q.a.Master)}},{key:"dispose",value:function(){this.mixEffects&&this.mixEffects.dispose(),this.stereoMerger.dispose(),this.stereoMerger=null}},{key:"setVolume",value:function(e){this.stereoMerger.volume.exponentialRampToValueAtTime(e,.05),this.sequencerEngine.store.dispatch(Object(w.Vb)(this.sequencerEngine.getSequenceId(),e))}},{key:"numberOfChannels",value:function(){return this.stereoConnected?2:this.ctxt.destination.channelCount}},{key:"disconnect",value:function(e,t){e.disconnect(this.stereoMerger)}},{key:"switchChannelOutput",value:function(e,t,n){if(this.stereoOnly||t>=this.numberOfChannels()||n>=this.numberOfChannels())return!1;var a=this.outputConnections.find(function(t){return t.output===e});return a.splitter.disconnect(),a.splitter.connect(this.multiMerger,0,t),n&&a.splitter.connect(this.multiMerger,1,n),!0}},{key:"connect",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.maxChannel;if(e.connect(this.stereoMerger),!this.stereoOnly){var a=function(){var a=q.a.Master.context.createChannelSplitter(2);e.connect(a);var r=n%t.channelCount,s=(n+1)%t.channelCount;return a.connect(t.multiMerger,0,r),a.connect(t.multiMerger,1,s),{splitter:a,output:e,leftChannel:r,rightChannel:s}};this.isMulti?this.outputConnections.push(a()):this.lazyConnections.push(a)}return[n%32,(n+1)%32]}},{key:"switchOutputs",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isMulti=t,t?(this.stereoOnly||(console.log("connecting multi merger!"),console.log(q.a.Master),void 0===this.multiMerger&&(this.stereoOnly||(this.multiMerger=q.a.Master.context.createChannelMerger(32))),this.multiMerger.connect(q.a.Master),q.a.Master.channelCount=32,this.lazyConnections.forEach(function(t){e.outputConnections.push(t())}),this.lazyConnections=[]),this.stereoConnected&&this.stereoMerger.disconnect(q.a.Master)):(this.stereoMerger.connect(q.a.Master),this.stereoConnected||this.stereoOnly||this.multiMerger.disconnect(q.a.Master)),this.stereoConnected=!t,console.log("stereo connected = "+this.stereoConnected)}},{key:"channelCount",get:function(){return this.multiMerger.numberOfInputs}}]),e}(),Xc=function(){function e(t){Object(o.a)(this,e),this.sequencerEngine=t}return Object(c.a)(e,[{key:"execute",value:function(){}},{key:"undo",value:function(){}},{key:"serialize",value:function(e,t){var n=Object(X.a)({},e);return n.payload=Object(X.a)({},n.payload),n.payload.track&&(n.payload.subSequence=n.payload.track.subSequence.id,n.payload.track=n.payload.track.trackNumber),{type:"operation",roomName:this.roomName,operation:Object(X.a)({},n,{uuid:t})}}},{key:"deserialize",value:function(e){var t=Object(X.a)({},e.payload);return void 0!==t.track&&(void 0!==t.subSequence?t.track=this.sequencerEngine.getSubSequence(t.subSequence).tracks[e.payload.track]:t.track=this.sequencerEngine.tracks[e.payload.track]),e.payload.resolution&&(t.resolution=(new ht).fromJson(e.payload.resolution)),Object(X.a)({},e,{payload:t})}},{key:"deserializeStep",value:function(e,t,n){var a=new ot;return a.track=t,a.stepNumber=n,a.loadFromJson(e,t.effects,void 0,void 0,void 0,t,t.midiEffects),a.id=e.id,a}},{key:"getStepsForStepNumbers",value:function(e,t){var n=t.getEasyPattern(),a=[],r=function(t){var r=e[t],s=n.getAllSteps().find(function(e){return e.id===r.id});s&&a.push(s)};for(var s in e)r(s);return a}},{key:"sleep",value:function(e){return new Promise(function(){var t=Object(g.a)(v.a.mark(function t(n){return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:setTimeout(n,e);case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}},{key:"roomName",get:function(){return"test"}}]),e}(),Zc=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"serialize",value:function(e,n){var a=Object(ze.a)(Object(l.a)(t.prototype),"serialize",this).call(this,e,n),r=a.operation;return r.payload.step=r.payload.step.getJson(),a}},{key:"deserialize",value:function(e){var n=Object(ze.a)(Object(l.a)(t.prototype),"deserialize",this).call(this,e),a=n.payload,r=a.track;if(void 0!==r)return a.step=this.deserializeStep(a.step,r,a.stepNumber),n}}]),t}(Xc),$c=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(e){var t=e.track,n=e.step,a=e.stepNumber,r=e.resolution,s=void 0===r?jo.baseResolution:r,i=Math.floor(a);return t.getEasyPattern().deleteStepAtStepNumber(n,i,s),t.updateSteps(),{}}},{key:"undo",value:function(e){new eu(this.sequencerEngine).execute(e.payload.track,e.payload.step,e.payload.stepNumber,e.payload.resolution),e.payload.track.updateSteps()}}]),t}(Zc),eu=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(e){var t=e.track,n=e.step,a=e.stepNumber,r=e.resolution,s=void 0===r?jo.baseResolution:r,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===t)return{};var o=Math.floor(a),c=a-o;return t.getEasyPattern().addStep(n,o,s,c),i&&this.updateRedux(n,o,c,t,s),{}}},{key:"updateRedux",value:function(e,t,n,a,r){var s=a.subSequence.isTrack?a.subSequence.id:a.trackNumber,i=Object(ge.a)(this.state.tracks.trackSteps[s]||[]),o=Object(X.a)({},this.state.tracks.trackFills[s]),c=Object(X.a)({},this.state.tracks.trackStepIds[s]),u=this.state.tracks.trackPianoRollSteps[s]||{},l=this.state.tracks.trackPianoRollPositions[s]||{},p=this.state.tracks.trackPianoRollDurations[s]||{},h=this.state.tracks.trackPatternSteps[s]||{};u[e.transpose]=Object(X.a)({},u[e.transpose]),l[e.transpose]=Object(X.a)({},l[e.transpose]),p[e.transpose]=Object(X.a)({},p[e.transpose]),o=o||new Array(i.length).fill(!1),i[t]=!0,c[t]=e,h[a.currentPattern]=Object(ge.a)(i),u[e.transpose][t]=!0,l[e.transpose][t]=n;var d=new ht(16,!1);p[e.transpose][t]=r.transformStepAtResolution2(e.duration,d);for(var f=0;f<e.duration;f++)o[(f+t)%i.length]=!0;this.sequencerEngine.store.dispatch(Object(w.s)(s,i,u,o,c,l,p,h))}},{key:"undo",value:function(e){new $c(this.sequencerEngine).execute(e.payload),e.payload.track.updateSteps()}},{key:"state",get:function(){return this.sequencerEngine.store.getState()}}]),t}(Zc),tu=[{value:"Auto Wah",label:"Auto Wah"},{value:"Bit Crusher",label:"Bit Crusher"},{value:"Chebyshev",label:"Chebyshev"},{value:"Chorus",label:"Chorus"},{value:"Compressor",label:"Compressor"},{value:"Convolver Reverb",label:"Convolver Reverb"},{value:"Delay",label:"Delay"},{value:"Distortion",label:"Distortion"},{value:"Effect Rack",label:"Effect Rack"},{value:"EQ 3",label:"EQ 3"},{value:"EQ8",label:"EQ 8"},{value:"Filter",label:"Filter"},{value:"Gate",label:"Gate"},{value:"Multiband Compressor",label:"Multiband Compressor"},{value:"Oscilloscope",label:"Oscilloscope"},{value:"Panner",label:"Panner"},{value:"Pitch Shift",label:"Pitch Shift"},{value:"Phaser",label:"Phaser"},{value:"Reverb",label:"Reverb"},{value:"Saturator",label:"Saturator"},{value:"Stereo Delay",label:"Stereo Delay"},{value:"Stereo Widener",label:"Stereo Widener"},{value:"Tape Delay",label:"Tape Delay"},{value:"Tremolo",label:"Tremolo"}];function nu(e,t){var n=null;return"Filter"===e?n=new un.FilterEffect(t):"Reverb"===e?n=new un.ReverbEffect(t):"Convolver Reverb"===e?n=new kn(t):"Delay"===e?n=new En(t):"Chorus"===e?n=new un.ChorusEffect(t):"Tremolo"===e?n=new un.TremoloEffect(t):"Auto Filter"===e?n=new un.AutoFilterEffect(t):"Compressor"===e?n=new Ln(t):"Multiband Compressor"===e?n=new An(t):"Distortion"===e?n=new Fn(t):"Bit Crusher"===e?n=new In(t):"EQ 3"===e?n=new Un(t):"EQ 10"===e?n=new Jn(t):"Phaser"===e?n=new Sn(t):"Auto Wah"===e?n=new xn(t):"Gate"===e?n=new Gn(t):"Pitch Shift"===e?n=new Vn(t):"Panner"===e?n=new Bn(t):"EQ8"===e?n=new vn(t):"Chebyshev"===e?n=new Rn(t):"Stereo Widener"===e?n=new Nn(t):"Saturator"===e?n=new Zn(t):"Tape Delay"===e?n=new $n(t):"Stereo Delay"===e?n=new aa(t):"Oscilloscope"===e?n=new qn(t):"Effect Rack"===e&&(n=new na(t)),n.toggle(),n}var au=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(e){e.effect,e.track,e.group,e.send}},{key:"undo",value:function(e){}},{key:"serialize",value:function(e,n){var a=Object(ze.a)(Object(l.a)(t.prototype),"serialize",this).call(this,e,n),r=a.operation,s=r.payload;return void 0!==s.group&&(s.group=s.group.groupNumber),void 0!==r.send&&(s.send=s.send.sendNumber),s.isMidiEffect=s.effect.isMidiEffect(),s.effect=s.effect.getJson(),a}},{key:"deserialize",value:function(e){var n,a=Object(ze.a)(Object(l.a)(t.prototype),"deserialize",this).call(this,e),r=a.payload,s=r.track||r.group||r.send;return r.isMidiEffect?void 0===(n=s.midiEffects.getEffectById(r.effect.id))&&(n=us(r.effect,s)).fromJson(r.effect):void 0===(n=s.effectsChain.getEffectById(r.effect.id))&&(n=nu(r.effect.name,this.sequencerEngine)).fromJson(r.effect,this.sequencerEngine.tracks,r.track.trackNumber),r.effect=n,a}}]),t}(Xc),ru=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(e){var t=e.effect,n=e.track,a=e.group,r=e.send,s=n||a||r;t.isMidiEffect()?s.midiEffects.addEffect(t):(s.effectsChain.addEffect(t),t.setValue(0)),n&&n.updateSteps()}}]),t}(au),su=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(e){var t=e.effect,n=e.track,a=e.group,r=e.send,s=n||a||r;t.isMidiEffect()?s.midiEffects.deleteEffect(t):s.effectsChain.deleteEffect(t),n&&n.updateSteps()}}]),t}(au),iu=n(219),ou=n(442),cu=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"".concat(window.location.host,"/ws");return Object(o.a)(this,t),(e=Object(u.a)(this,Object(l.a)(t).call(this))).ackTimeoutMS=5e3,e.open=!1,e.callbacks={},e.s=new WebSocket("ws://".concat(n)),e.s.addEventListener("open",e.onOpen.bind(Object(p.a)(e))),e.s.addEventListener("message",e.onMessage.bind(Object(p.a)(e))),e.s.addEventListener("close",e.onClose.bind(Object(p.a)(e))),e.s.addEventListener("error",e.onError.bind(Object(p.a)(e))),e}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onOpen",value:function(e){this.open=!0,this.dispatchEvent(new Event("open")),console.log("websocket opened:",e)}},{key:"onMessage",value:function(e){var t=JSON.parse(e.data);t.id?this.dispatchEvent(new CustomEvent(t.id,{detail:t})):this.dispatch(t)}},{key:"onClose",value:function(e){this.open=!1,this.dispatchEvent(new Event("closed")),console.log("websocket closed:",e)}},{key:"onError",value:function(e){this.dispatchEvent(new CustomEvent("error",{detail:e})),console.error("websocket error:",e)}},{key:"send",value:function(e){return this.open?(this.s.send(JSON.stringify(e)),!0):(console.log("send attempted before websocket connection was open"),!1)}},{key:"sendWithResponse",value:function(e){var t=this;return new Promise(function(n,a){e.id?t.send(e)?(t.addEventListener(e.id,function(e){return n(e.detail)}),setTimeout(function(){return a("response ".concat(e.id," not received after ").concat(t.ackTimeoutMS,"ms"))},t.ackTimeoutMS)):a("sendWithResponse attempted before websocket connection was open"):a('input must be an object with an "id" property')})}},{key:"dispatch",value:function(e){if(e.type){var t=this.callbacks[e.type];t?t(e):console.log("received message with unregistered type:",e)}else console.error("received message with no type:",e)}},{key:"register",value:function(e,t){this.callbacks[e]=t}}]),t}(Object(ou.a)(EventTarget)),uu=(n(2320),n(2321),function(){function e(t,n){Object(o.a)(this,e),this.onSyncedOperation=n,this.sequencerEngine=t,iu.initializeApp({apiKey:"AIzaSyDwXxldpqZT1X3IK82OtJ2SzkjX6OhXGaY",authDomain:"fir-test-9a9f3.firebaseapp.com",databaseURL:"https://fir-test-9a9f3.firebaseio.com",projectId:"fir-test-9a9f3",storageBucket:"fir-test-9a9f3.appspot.com",messagingSenderId:"1043409033882",appId:"1:1043409033882:web:102b9f24ce8fd87ec15d23",measurementId:"G-4Z8FM61HPQ"}),this.db=iu.firestore(),this.rtdb=iu.database(),this.auth=iu.auth(),this.users=this.db.collection("users"),this.rooms=this.db.collection("rooms"),this.init()}return Object(c.a)(e,[{key:"init",value:function(){var e=this;iu.auth().signInAnonymously().catch(function(e){console.log("error signing in anonymously:",e)}),iu.auth().onAuthStateChanged(function(t){t&&e.users.add({online:!0}).then(function(t){var n=t.id;console.log("added user");var a=e.rtdb.ref("/status/".concat(n));a.set("online").then(function(){console.log("added user presence ref")}).catch(function(e){console.log("error adding user presence ref:",e)}),a.onDisconnect().set("offline"),window.addEventListener("beforeunload",function(){a.set("offline")}),e.socket=new cu,e.socket.register("operationUpdate",e.onSyncedOperation),e.socket.addEventListener("open",function(){e.socket.send({id:Object(We.uuid)(),type:"announce",userID:n}),e.socket.sendWithResponse({id:Object(We.uuid)(),type:"enterRoom",roomName:"test"}).then(function(t){console.log("number of operations=",t.operations.length),t.operations.forEach(function(t){return e.onSyncedOperation({operation:t},!0)}),e.sequencerEngine.updateSteps(!0),console.log("entered the room",t)})})}).catch(function(e){console.log("error adding user:",e)})})}}]),e}()),lu=20,pu=function(){function e(t,n){Object(o.a)(this,e),this.sequencerEngine=t,this.firebaseHandler=new uu(this.sequencerEngine,n),this.actionsRemaining=lu,this.queuedActions=[]}return Object(c.a)(e,[{key:"logAction",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n,a){var r;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.serialize(a,t);case 2:(r=e.sent)&&(this.actionsRemaining--,this.queuedActions.push(r));case 4:case"end":return e.stop()}},e,this)}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"submitActions",value:function(){var e=this;if(!(this.actionsRemaining<0)){for(var t in this.queuedActions)this.firebaseHandler.socket.send(this.queuedActions[t]);this.queuedActions=[],this.timeRemaining=6e4,this.timeout=setInterval(function(){e.timeRemaining=e.timeRemaining-1e3,e.timeRemaining<=0&&(clearTimeout(e.timeout),e.actionsRemaining=lu)},1e3)}}},{key:"removeActionWithId",value:function(e){var t=this.queuedActions.length;this.queuedActions=this.queuedActions.filter(function(t){return t.operation.uuid!==e});var n=this.queuedActions.length;n<t&&(this.actionsRemaining+=t-n)}},{key:"actionsRemaining",set:function(e){this.sequencerEngine.store.dispatch(Object(w.o)(e))},get:function(){return this.sequencerEngine.store.getState().installation.actionsRemaining}},{key:"timeRemaining",set:function(e){this.sequencerEngine.store.dispatch(Object(w.Zd)(e))},get:function(){return this.sequencerEngine.store.getState().installation.timeRemaining}}]),e}(),hu=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(e){var t=e.effect,n=e.track,a=e.group,r=e.send,s=n||a||r;t.toggleEnabled(),t.isMidiEffect()||s.effectsChain.updateEffects(),n&&n.updateSteps()}}]),t}(au),du=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(e){var t=e.from,n=e.to,a=e.isMidiEffect,r=void 0!==a&&a,s=e.track,i=e.group,o=e.send,c=s||i||o;r?c.midiEffects.moveEffectTo(t,n):c.effectsChain.moveEffectTo(t,n),s&&s.updateSteps()}},{key:"undo",value:function(e){}},{key:"serialize",value:function(e,n){var a=Object(ze.a)(Object(l.a)(t.prototype),"serialize",this).call(this,e,n),r=a.operation,s=r.payload;return void 0!==s.group&&(s.group=s.group.groupNumber),void 0!==r.send&&(s.send=s.send.sendNumber),a}}]),t}(Xc),fu=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(e){var t=e.track,n=e.stepNumber,a=e.resolution,r=void 0===a?jo.baseResolution:a,s=t.getEasyPattern(),i=s.getStepsAtStepNumber(n,r),o=i.map(function(e){return Object(X.a)({},e,{step:e.step.getCopy()})});return s.deleteSteps(i.map(function(e){return e.step})),t.updateSteps(),{stepsDeleted:o}}},{key:"undo",value:function(e){}}]),t}(Xc),mu=0,vu=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(e){var t=e.track,n=e.steps,a=e.transformation,r=e.resolution,s=void 0===r?jo.baseResolution:r,i=e.wrap,o=void 0!==i&&i,c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],u=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=t.getEasyPattern().getStepNumbers(n,s),p=t.getEasyPattern().transformSteps(n,l,a,s,o);if(c)if(u){var h=++mu;setTimeout(function(){h===mu&&t.updateSteps(!1,!0)},50)}else t.updateSteps(!1,!0);return c&&!u&&this.sequencerEngine.store.dispatch(Object(w.Sc)(p)),{stepNumbers:l}}},{key:"undo",value:function(e){var t=Object(X.a)({},e.payload.transformation);t.stepDifference=-1*t.stepDifference,t.transposeDifference=-1*t.transposeDifference,this.execute(Object(X.a)({},e.payload,{transformation:t}))}},{key:"serialize",value:function(){var e=Object(g.a)(v.a.mark(function e(n,a){var r,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(ze.a)(Object(l.a)(t.prototype),"serialize",this).call(this,n,a),(s=r.operation).payload.steps=s.payload.steps.map(function(e){return e.id}),s.payload.stepNumbers=s.payload.stepNumbers.map(function(e){var t=Object(Z.a)(e,2),n=t[0],a=t[1];return[n.id,a]}),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"deserialize",value:function(e){var n=Object(ze.a)(Object(l.a)(t.prototype),"deserialize",this).call(this,e),a=n.payload,r=a.track;if(void 0!==r){var s=a.steps;return a.steps=this.getStepsForStepNumbers(s.map(function(e){return{id:e}}),r,jo.baseResolution),n}}}]),t}(Xc),gu=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(e){var t=e.track,n=e.steps,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===t)return{stepsDeleted:[]};var r=t.getEasyPattern().getStepNumbers(n,jo.baseResolution);return t.getEasyPattern().deleteSteps(n),a&&t.updateSteps(),{stepsDeleted:r}}},{key:"undo",value:function(e){var t=new eu(this.sequencerEngine),n=e.payload.stepsDeleted;for(var a in n)t.execute({track:e.payload.track,step:n[a][0],stepNumber:n[a][1],resolution:jo.baseResolution});e.payload.track.updateSteps()}},{key:"serialize",value:function(e,n){var a=Object(ze.a)(Object(l.a)(t.prototype),"serialize",this).call(this,e,n),r=a.operation;return r.payload.steps=r.payload.steps.map(function(e){return e.getJson()}),r.payload.stepsDeleted=r.payload.stepsDeleted.map(function(e){var t=Object(Z.a)(e,2),n=t[0],a=t[1];return[n.getJson(),a]}),a}},{key:"deserialize",value:function(e){var n=this,a=Object(ze.a)(Object(l.a)(t.prototype),"deserialize",this).call(this,e),r=a.payload,s=r.track;if(void 0!==s){var i=r.steps.map(function(e){return n.deserializeStep(e,s,e.stepNumber)});return r.steps=this.getStepsForStepNumbers(i,s,jo.baseResolution),a}}}]),t}(Xc),bu=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(e){var t=e.track,n=e.steps,a=e.stepNumber,r=e.resolution,s=void 0===r?jo.baseResolution:r,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===t)return{steps:[]};var o=t.getEasyPattern(),c=o.pattern.getStepResolutionTree(s.isTriplet).search(a,s).toggle(n&&n[0]?n[0].stepBucket.steps[0].id:void 0);return o.update(s.isTriplet),i&&t.updateSteps(),{steps:c}}},{key:"undo",value:function(e){var t=e.payload.track.getEasyPattern();if(void 0!==e.payload.steps){var n=e.payload.resolution.isTriplet?t.pattern.tripletStepBuckets:t.pattern.stepBuckets;for(var a in e.payload.steps){var r=e.payload.steps[a];n[r.stepNumber]=r.stepBucket}}t.update(e.payload.resolution.isTriplet),e.payload.track.updateSteps()}},{key:"serialize",value:function(e,n){var a=Object(ze.a)(Object(l.a)(t.prototype),"serialize",this).call(this,e,n),r=a.operation;return r.payload.steps&&(r.payload.steps=r.payload.steps.map(function(e){return Object(X.a)({},e,{stepBucket:e.stepBucket.getJson()})})),a}},{key:"deserialize",value:function(e){var n=Object(ze.a)(Object(l.a)(t.prototype),"deserialize",this).call(this,e),a=n.payload;if(void 0!==a.track){var r=a.track,s=[];if(e.payload.steps)for(var i in e.payload.steps){var o=e.payload.steps[i],c=o.stepBucket,u=o.stepNumber,p=new ct(r,c.isTriplet);for(var h in c){var d=c[h],f=new ot;f.track=r,f.stepNumber=u,f.loadFromJson(d,r.effects,void 0,void 0,void 0,r,r.midiEffects),f.id=d.id,p.steps[h]=f}s.push({stepNumber:u,stepBucket:p})}return a.steps=s,n}}}]),t}(Xc),yu=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(e){var t=e.patternNumber,n=this.sequencerEngine.tracks.map(function(e){return e.patterns[t]});return this.sequencerEngine.deletePattern(t),{patterns:n,patternNumber:t}}},{key:"undo",value:function(e){var t=e.payload.patterns,n=e.payload.patternNumber;for(var a in t){var r=this.sequencerEngine.tracks[a],s=r.patterns.slice(0,n).concat([t[a]]).concat(r.patterns.slice(n));r.patterns=s,r.switchToPattern(r.currentPattern),r.updateSteps()}this.sequencerEngine.store.dispatch(Object(w.bc)(this.sequencerEngine.numberOfPatterns()))}}]),t}(Xc),ku=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),t}(eu),Eu=0,Su=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(e){var t=e.track,n=(e.step,e.parameter),a=e.value,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=n.get();if(n.set(a),r)if(s){var o=++Eu;setTimeout(function(){o===Eu&&t.updateSteps()},50)}else t.updateSteps();return{previousValue:i}}},{key:"undo",value:function(e){}},{key:"serialize",value:function(e,n){var a=Object(ze.a)(Object(l.a)(t.prototype),"serialize",this).call(this,e,n),r=a.operation;return r.payload.step=r.payload.step.id,r.payload.parameter=r.payload.parameter.name,a}},{key:"deserialize",value:function(e){var n=Object(ze.a)(Object(l.a)(t.prototype),"deserialize",this).call(this,e),a=n.payload,r=a.track;if(void 0!==r&&(a.step=this.getStepsForStepNumbers([{id:a.step}],r)[0],void 0!==a.step))return a.parameter=a.step.parameters.find(function(e){return e.name===a.parameter}),n}},{key:"state",get:function(){return this.sequencerEngine.store.getState()}}]),t}(Xc),Ou=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"serialize",value:function(e,n){var a=Object(ze.a)(Object(l.a)(t.prototype),"serialize",this).call(this,e,n),r=a.operation.payload;if(r.parameter&&(r.parameter=r.parameter.getJson()),r.automation){var s=r.automation.parameter;r.parameter=s.getJson(),r.automation=r.automation.id}return a}},{key:"deserialize",value:function(e){var n=Object(ze.a)(Object(l.a)(t.prototype),"deserialize",this).call(this,e),a=n.payload,r=a.parameter,s=(r.id,r.name),i=r.context;if(void 0!==i.track&&(a.track=this.sequencerEngine.tracks[i.track]),void 0!==i.midiEffect){var o=this.sequencerEngine.tracks[i.track].midiEffects.effects[i.midiEffect].parameters.find(function(e){return e.name===s});a.parameter=o||void 0}else if(void 0!==i.effect&&-1!==i.effect){if(void 0!==i.track){var c=this.sequencerEngine.tracks[i.track].effects[i.effect].getParameters().find(function(e){return e.name===s});a.parameter=c||void 0}}else if(i.isInstrument)if(a.instrument=a.track.instrument,i.subDevice){var u=a.instrument.getSubDevice(i.subDevice);a.parameter=u.parameters.find(function(e){return e.name===s})}else a.parameter=a.instrument.parameters.find(function(e){return e.name===s});else a.parameter=void 0;return a.automation&&a.parameter&&(a.automation=a.parameter.unlockedAutomation),n}}]),t}(Xc),wu=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(e){var t=e.parameter,n=e.value;void 0!==t&&t.set(n)}}]),t}(Ou),Cu=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(e){var t=e.track,n=e.value;t&&!isNaN(n)&&t.setVolume(n)}}]),t}(Xc),Pu=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(e){var t=e.track,n=e.mute;t&&t.mute(n)}}]),t}(Xc),Tu=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(e){var t=e.automation,n=e.step,a=e.value,r=e.pointId;return{point:t.addBreakPoint(n,a,r)}}}]),t}(Ou),ju=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(e){var t=e.automation,n=e.point;t.removeBreakPoint(n)}}]),t}(Ou),xu=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(e){var t=e.automation,n=e.point,a=e.step,r=e.value;t.movePoint(n,a,r)}}]),t}(Ou);var Nu=function(){function e(t){Object(o.a)(this,e),this.sequencerEngine=t,this.executedActions=[],this.undoneActions=[],this.addStepAction=new eu(this.sequencerEngine),this.deleteStepAction=new $c(this.sequencerEngine),this.deleteStepNumberAction=new fu(this.sequencerEngine),this.moveStepsAction=new vu(this.sequencerEngine),this.deleteStepsAction=new gu(this.sequencerEngine),this.toggleStepAction=new bu(this.sequencerEngine),this.deletePatternAction=new yu(this.sequencerEngine),this.recordStepAction=new ku(this.sequencerEngine),this.updateStepParameterAction=new Su(this.sequencerEngine),this.addEffectAction=new ru(this.sequencerEngine),this.deleteEffectAction=new su(this.sequencerEngine),this.toggleEffectAction=new hu(this.sequencerEngine),this.moveEffectAction=new du(this.sequencerEngine),this.updateParameterAction=new wu(this.sequencerEngine),this.updateTrackVolumeAction=new Cu(this.sequencerEngine),this.updateTrackMuteAction=new Pu(this.sequencerEngine),this.addAutomationBreakPointAction=new Tu(this.sequencerEngine),this.removeAutomationBreakPointAction=new ju(this.sequencerEngine),this.moveAutomationBreakPointAction=new xu(this.sequencerEngine),this.uuids=new Set}return Object(c.a)(e,[{key:"setupSyncing",value:function(){var e=this;this.roomActionsManager=new pu(this.sequencerEngine,function(t,n){return e.onSyncedOperation(t,n)})}},{key:"getAction",value:function(e){switch(e.type){case"ADD_STEP":return this.addStepAction;case"DELETE_STEP":return this.deleteStepAction;case"DELETE_STEP_NUMBER":return this.deleteStepNumberAction;case"RECORD_STEP":return this.recordStepAction;case"MOVE_STEPS":return this.moveStepsAction;case"DELETE_STEPS":return this.deleteStepsAction;case"TOGGLE_STEP":return this.toggleStepAction;case"DELETE_PATTERN":return this.deletePatternAction;case"UPDATE_STEP_PARAMETER":return this.updateStepParameterAction;case"ADD_EFFECT":return this.addEffectAction;case"DELETE_EFFECT":return this.deleteEffectAction;case"TOGGLE_EFFECT":return this.toggleEffectAction;case"MOVE_EFFECT":return this.moveEffectAction;case"UPDATE_PARAMETER":return this.updateParameterAction;case"UPDATE_TRACK_VOLUME":return this.updateTrackVolumeAction;case"UPDATE_TRACK_MUTE":return this.updateTrackMuteAction;case"ADD_AUTOMATION_BREAK_POINT":return this.addAutomationBreakPointAction;case"REMOVEAUTOMATION_BREAK_POINT":return this.removeAutomationBreakPointAction;case"MOVE_AUTOMATION_BREAK_POINT":return this.moveAutomationBreakPointAction;default:return}}},{key:"undo",value:function(){if(this.executedActions.length>0){var e=this.executedActions.pop();if(this.undoAction(e),this.undoneActions.push(e),Di.indexOf(e.type)>-1){var t=this.executedActions[this.executedActions.length-1];if(void 0===t)return;this.shouldAlsoUndo(e,t)&&this.undo()}}}},{key:"shouldAlsoUndo",value:function(e,t){return e.timestamp-t.timestamp<5e3&&Di.indexOf(t.type)>-1}},{key:"redo",value:function(){if(this.undoneActions.length>0){var e=this.undoneActions.pop();this.runAction(e),this.logAction(e)}}},{key:"onSyncedOperation",value:function(e){var t=e.operation,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.uuids.has(t.uuid)){var a=this.getAction(t);void 0!==a&&void 0!==(a=a.deserialize(t))&&this.dispatch(a,!0,n)}}},{key:"dispatch",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r,s,i=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]&&i[1],a=i.length>2&&void 0!==i[2]&&i[2],!(!n&&this.roomActionsManager&&this.roomActionsManager.actionsRemaining<=0)){e.next=4;break}return e.abrupt("return");case 4:if(r=this.makeCopyOfAction(t),void 0!==this.getAction(t)){e.next=7;break}return e.abrupt("return");case 7:if(s=this.runAction(t,!a,n),r.payload=Object(X.a)({},r.payload,s),n){e.next=12;break}return e.next=12,this.logAction(r);case 12:return e.abrupt("return",s);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"logAction",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=Object(We.uuid)(),this.roomActionsManager&&this.roomActionsManager.logAction(n,this.getAction(t),t),this.executedActions.push(Object(X.a)({},t,{uuid:n}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"runAction",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,a=this.getAction(e);if(void 0!==a)return a.execute(e.payload,t,n)}},{key:"makeCopyOfAction",value:function(e){var t;switch(e.type){case"ADD_STEP":case"DELETE_STEP":case"RECORD_STEP":return(t=Object(X.a)({},e)).payload.step=t.payload.step.getCopy(!0,!0,!0),t;case"MOVE_STEPS":return(t=Object(X.a)({},e)).payload.steps=e.payload.steps,t;case"DELETE_STEPS":return(t=Object(X.a)({},e)).payload.steps=e.payload.steps.map(function(e){return e.getCopy(!0,!0,!0)}),t;case"UPDATE_STEP_PARAMETER":return t=Object(X.a)({},e);default:return Object(X.a)({},e)}}},{key:"undoAction",value:function(e){var t=this.getAction(e);return void 0===t?{}:(this.roomActionsManager.removeActionWithId(e.uuid),t.undo(e))}}]),e}(),qu=0,Mu=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.a.Transport,a=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;Object(o.a)(this,e),this.idToParameter={},this.stereoOnly=r,this.engineId=qu++,this.transport=n,this.transport.swingSubvision="16n",this.ethereum=R.a,this.store=t,this.encryptedIpfs=new gn.a(this.store,R.a.guilds,R.a.encryption,R.a.crypto),this.mix=new vr(this),this.channelMixer=new Qc(this),this.audioInputManager=new Wc(this.store),this.sends=new _c(!1,this.channelMixer,this),this.subSequences=[],this.newSubSequence(),this.audioSettings=new Kc,this.recordingsCounter=1,this.operationManager=new Nu(this),this.parameterLocks=[new Ro,new Ro],void 0!==a?this.aubio=a:this.initAubio()}return Object(c.a)(e,[{key:"initAubio",value:function(){var e=this;window.Aubio().then(function(t){console.log("initialized aubio"),e.aubio=t})}},{key:"newSubSequence",value:function(e,t){var n=new jr(this,void 0!==t);return t&&n.addTrack(t),void 0!==e&&n.setId(e),this.addSubSequence(n,void 0===t),n}},{key:"deleteSubSequence",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentSubSequence.id;if(1!==this.subSequences.length){var t=-1;for(var n in this.subSequences)if(this.subSequences[n].id===e){t=n;break}if(!(t<0)){var a=this.subSequences.filter(function(t){return t.id!==e})[0];this.switchToSubSequence(a.id),this.subSequences[t].dispose(),this.subSequences.splice(t,1),this.store.dispatch(Object(w.Xd)(this.engineId,this.subSequences.map(function(e){return e.id})))}}}},{key:"addSubSequence",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.subSequences.push(e),this.currentSubSequence=e,this.store.dispatch(Object(w.Xd)(this.engineId,this.subSequences.map(function(e){return e.id}))),this.store.dispatch(Object(w.Z)(e.id,0)),t&&this.store.dispatch(Object(w.ab)(this.engineId,this.currentSubSequence.id))}},{key:"switchToSubSequence",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.subSequences.filter(function(t){return t.id===e})[0];void 0!==n&&(this.currentSubSequence=n,this.store.dispatch(Object(w.ab)(this.engineId,this.currentSubSequence.id)),this.store.dispatch(Object(w.bc)(this.currentSubSequence.id,this.numberOfPatterns())),t&&this.updateTracks(),this.groups.updateGroups())}},{key:"switchToNextSubSequence",value:function(){var e=this.subSequences.indexOf(this.currentSubSequence);e<this.subSequences.length-1?e++:e=0,this.switchToSubSequence(this.subSequences[e].id)}},{key:"switchToPreviousSubSequence",value:function(){var e=this.subSequences.indexOf(this.currentSubSequence);e>0?e--:e=this.subSequences.length-1,this.switchToSubSequence(this.subSequences[e].id)}},{key:"getSequenceId",value:function(){return void 0===this.loadedSequenceId?0:this.loadedSequenceId}},{key:"setMasterVolume",value:function(e){this.groups.channelMixer.setVolume(e)}},{key:"getMasterVolume",value:function(){this.groups.channelMixer.getVolume()}},{key:"getSubSequenceName",value:function(e){for(var t=["A","B","C","D","E","F","G","H","I","J","K"],n=0;n<this.subSequences.length;n++)if(this.subSequences[n].id===e)return t[n];return""}},{key:"getSubSequence",value:function(e){return this.subSequences.filter(function(t){return t.id===e})[0]}},{key:"auditionSound",value:function(e,t){var n=this.tracks[t];this.tracks.filter(function(e){return e!==n}).filter(function(e){return e.isAuditioning()}).forEach(function(e){return e.completeAudition()}),n.auditionSound(e)}},{key:"addSound",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n,a,r){var s,i,o,c=this,u=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=u.length>4&&void 0!==u[4]&&u[4],i={slices:void 0===a||0==a.length?void 0:a,offset:0,transpose:0,volume:0},void 0!==n){e.next=18;break}return(o=new Lo(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return c.update()},this.currentSubSequence)).setSends(this.sends),o.setupEffects(),this.currentSubSequence.addTrack(o),o.switchToPattern(this.currentPattern),e.next=10,o.addSound(t,i,!0);case 10:return this.groups.addTrack(o),s&&(this.recordingsCounter++,this.newRecordingToSaveLater(t)),this.selectTrack(this.tracks.length-1),this.tracks.filter(function(e){return e.isAuditioning()}).forEach(function(e){return e.completeAudition()}),o.updateSteps(),e.abrupt("return",o);case 18:if(!(this.tracks.length>n)){e.next=23;break}return(o=this.tracks[n]).addSound(t,i),this.selectTrack(n),e.abrupt("return",o);case 23:case"end":return e.stop()}},e,this)}));return function(t,n,a,r){return e.apply(this,arguments)}}()},{key:"transcribeIntoMidi",value:function(e){var t=this;return new Promise(function(n,a){var r=e.getSamplers()[0],s=r.getSlice(0);Object(Ec.a)(s.buffer._buffer).then(function(e){var a=e.notes;t.addMidiTrack().addNotes(a,r.tempo),n()})})}},{key:"duplicateTrack",value:function(e){if(void 0!==this.tracks[e]){var t=this.tracks[e].getCopy();this.setupNewTrack(t,!0),t.setupEffects(),this.currentSubSequence.addTrack(t),this.updateTracks(),this.groups.addTrack(t),this.update()}}},{key:"deleteTrack",value:function(e){"MIDI"==this.tracks[e].getTrackType()&&this.tracks[e].disconnect();var t=this.tracks[e],n=t.sample,a=this.samplesToSync.indexOf(n);for(var r in a>-1&&this.samplesToSync.splice(a,1),this.tracks)this.tracks[r].chokes.choke===t&&(this.tracks[r].chokes.choke=void 0);t.group;this.groups.deleteTrack(t),this.rollingManager.deleteTrack(t),this.tracks.splice(e,1),this.cursor.track>=e&&(this.cursor.track--,this.cursor.track<0&&(this.cursor.track=0)),this.scripting.deleteHistoryForTrack(e),this.keyboardEngine.deleteTrack(e),this.tracks.forEach(function(e,t){e.trackNumber=t}),this.tracks.forEach(function(e,t){return e.updateSteps()});var s=t.subSequence.id,i=this.state.tracks.tracksFrozen[s]||{},o=this.state.tracks.frozenTracksPlaying[s]||{};this.store.dispatch(Object(w.xb)(s,_t(e,i)));this.store.dispatch(Object(w.yb)(s,_t(e,o)));var c=this.state.effects.effectsChainToShow[s]||{};this.store.dispatch(Object(w.pb)(s,_t(e,c))),this.updateSteps(),this.update(),this.selectTrack(Math.max(e-1,0));var u=this.tracks.map(function(e){return e.isWarped()});this.store.dispatch(Object(w.Wd)(s,u)),t.dispose()}},{key:"newPattern",value:function(e){this.tracks.map(function(t){return t.newPattern(e)}),this.update(),this.store.dispatch(Object(w.bc)(this.currentSubSequence.id,this.numberOfPatterns())),this.lfosTrack.newPattern(this.numberOfPatterns()),this.envelopesTrack.newPattern(this.numberOfPatterns())}},{key:"deletePattern",value:function(e){if(0!=this.tracks.length&&1!=this.tracks[0].patterns.length){e=e||this.tracks[0].currentPattern,this.tracks.map(function(t){return t.deletePattern(e)});var t=e>0?e-1:0;this.switchToPattern(t),this.store.dispatch(Object(w.bc)(this.currentSubSequence.id,this.numberOfPatterns())),this.lfosTrack.deletePattern(e),this.envelopesTrack.deletePattern(e)}}},{key:"switchToPattern",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.currentSubSequence;e<0||n.tracks.length<=0||n.tracks[0].patterns.length<=e||(this.state.mix.isRecordingMix&&!t?n.mix.addEvent(new nt(e)):t||n.mix.holdEvent(new nt(e)),this.switchToPatternHelper(e,n),n.lfosTrack.switchToPattern(e),n.envelopesTrack.switchToPattern(e),this.getAllPatternLockedParameters().forEach(function(e){return e.updateRedux()}))}},{key:"getCurrentPattern",value:function(e){return this.store.getState().sequencer.currentPattern[e.id]}},{key:"switchToPatternHelper",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.currentSubSequence,n=((new Date).getTime(),t.tracks.map(function(t){return t.switchToPattern(e)})),a={};for(var r in n)a=Object(X.a)({},a,n[r]);this.store.dispatch(Object(w.mb)(a));(new Date).getTime();this.store.dispatch(Object(w.Z)(t.id,e));(new Date).getTime();"ARRANGEMENT_VIEW"!==this.viewMode&&this.updateSteps();(new Date).getTime()}},{key:"updateSteps",value:function(e){(new Date).getTime();var t=this.tracks.map(function(e){return e.getUpdateStepsAction()});(new Date).getTime();this.store.dispatch(Object(w.Ie)(t));(new Date).getTime()}},{key:"switchToLastPattern",value:function(){0!=this.tracks.length&&this.switchToPattern(this.numberOfPatterns()-1)}},{key:"switchToPreviousPattern",value:function(){if(0!=this.tracks.length){var e=this.tracks[0].currentPattern-1%this.tracks[0].patterns.length;this.switchToPattern(e)}}},{key:"switchToNextPattern",value:function(){if(0!=this.tracks.length){var e=this.tracks[0].currentPattern+1%this.tracks[0].patterns.length;this.switchToPattern(e)}}},{key:"movePatternTo",value:function(e,t){this.tracks.forEach(function(n){return n.movePatternTo(e,t)}),this.switchToPattern(t),this.lfosTrack.movePatternTo(e,t)}},{key:"numberOfPatterns",value:function(){return 0==this.tracks.length?1:this.tracks[0].patterns.length}},{key:"isLoaded",value:function(e){return void 0!==this.tracks&&void 0!==this.tracks[e]&&this.tracks[e].isLoaded()}},{key:"setUpdateCallback",value:function(e){this.callback=e}},{key:"update",value:function(e){void 0!==this.callback&&this.callback(e)}},{key:"addTrack",value:function(e){this.currentSubSequence.addTrack(e),e.setupEffects(),this.groups.addTrack(e),this.setupNewTrack(e)}},{key:"addAudioTrack",value:function(){var e=this,t=new Bc(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence);return this.setupNewTrack(t),t}},{key:"addSampledInstrumentTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],new Dc(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence));return this.groups.addTrack(t),this.setupNewTrack(t),t}},{key:"addInstrumentRackTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],new Lc(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence));return this.groups.addTrack(t),this.setupNewTrack(t),t}},{key:"addInstrumentTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],new ec(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence));return this.groups.addTrack(t),this.setupNewTrack(t),t}},{key:"addFMSynthTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],new dc(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence));return this.groups.addTrack(t),this.setupNewTrack(t),t}},{key:"addMetalSynthTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],new Vc(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence));return this.groups.addTrack(t),this.setupNewTrack(t),t}},{key:"addMultiSynthTrack",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],new uc(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence));return this.groups.addTrack(t),this.setupNewTrack(t),t}},{key:"addMidiTrack",value:function(){var e=this,t=new Ko(this.tracks.length,this,this.mixSession,this.numberOfPatterns(),function(){return e.update()},this.currentSubSequence);return t.setMidiEngine(this.midi),t.setAudioSettings(this.audioSettings),this.setupNewTrack(t),t}},{key:"setupNewTrack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.isRecordable()&&this.setupRecordableTrack(e,t),e.sequencerEngine=this,n||e.setSends(this.sends),e.setKeyboardEngine(this.keyboardEngine),t||this.currentSubSequence.addTrack(e),t?e.switchToPattern(0):e.switchToPattern(this.tracks[0].currentPattern),this.update(),this.updateTracks()}},{key:"setupRecordableTrack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.setAudioInputManager(this.audioInputManager),t||this.groups.addTrack(e),e.setSequencerEngine(this)}},{key:"updateTracks",value:function(){var e=this;this.tracks.forEach(function(t,n){t.trackNumber=n,t.sequencerEngine=e,t.patterns.forEach(function(t){return t.sequencerEngine=e})});var t=this.tracks.map(function(e){return e.getUpdateStepsAction()});this.store.dispatch(Object(w.Ie)(t))}},{key:"dispose",value:function(){for(var e in this.loadedSamples)this.loadedSamples[e].dispose();this.loadedSamples={},this.channelMixer.dispose(),this.channelMixer=void 0,this.sends.dispose(),this.subSequences.forEach(function(e){return e.dispose()})}},{key:"newSequence",value:function(){for(var e in this.subSequences){this.subSequences[e].dispose()}this.subSequences=[],this.newSubSequence(),this.mix=new vr(this),this.update(),this.store.dispatch(Object(w.bc)(this.currentSubSequence.id,1)),this.store.dispatch(Object(w.k)()),this.loadedSequenceId=void 0,this.stop()}},{key:"scrollToSelectedTrack",value:function(){var e=this;this.tracks.length<3||setTimeout(function(){window.location.hash="",window.location.hash="track-"+(e.cursor.track+1)},50)}},{key:"togglePatternLock",value:function(){this.store.dispatch(Object(w.ed)(this.currentPattern,!this.patternLocked))}},{key:"getAllPatternLockedParameters",value:function(){return this.parameters.filter(function(e){return e.hasPatternLockedValues()})}},{key:"mixes",get:function(){return[].concat(Object(ge.a)(this.subSequences.map(function(e){return e.mix})),[this.mix])}},{key:"tracks",get:function(){return this.currentSubSequence.tracks},set:function(e){this.currentSubSequence.tracks=e}},{key:"groups",get:function(){return this.currentSubSequence.groups},set:function(e){this.currentSubSequence.groups=e}},{key:"rollingResolution",set:function(e){if(this.store.getState().mix.isRecordingMix){var t=this.mix.getEvent(Mt,this.automationStep),n=new kt(e);n.step=this.automationStep,t.addSubEvent(n)}else this.state.mix.isPlayingMix&&this.mix.holdEvent(new kt(e))},get:function(){if(this.store.getState().mix.isPlayingMix){var e=this.mix.getEvent(Mt,this.automationStep);if(void 0!==e)return e.getSubEvent(this.automationStep).getValue()}return this.resolution}},{key:"resolution",set:function(e){if(this.resolution.isTriplet!==e.isTriplet)for(var t in this.subSequences)for(var n in this.subSequences[t].tracks){var a=this.subSequences[t].tracks[n];a.pattern.needsSync&&a.pattern.syncBuckets(this.resolution.isTriplet)}this.rollingResolution=e,this.state.midi.midiMapMode===qs&&this.store.dispatch(Object(w.m)(new Mo(this,e))),this.store.dispatch(Object(w.xc)(e)),this.tracks.forEach(function(t){return t.updatePatternRollStepNumber(e)}),"ARRANGEMENT_VIEW"!==this.state.sequencer.viewMode&&this.updateSteps()},get:function(){return this.state.sequencer.resolution}},{key:"state",get:function(){return this.store.getState()}},{key:"length",get:function(){var e=-1;for(var t in this.subSequences)for(var n in this.subSequences[t].tracks){var a=this.subSequences[t].tracks[n].length;a>=e&&(e=a)}return e}},{key:"subSequenceMix",get:function(){return this.currentSubSequence.mix}},{key:"currentPattern",get:function(){return this.getCurrentPattern(this.currentSubSequence)}},{key:"patternLocks",set:function(e){this.store.dispatch(Object(w.fd)(e))}},{key:"viewMode",get:function(){return this.state.sequencer.viewMode}},{key:"patternLocked",get:function(){return this.store.getState().sequencer.patternLocks[this.currentPattern]||!1}},{key:"guildId",get:function(){return this.state.guilds.selectedGuild?this.state.guilds.selectedGuild.guildId:0}}]),e}(),Du=function(){function e(){Object(o.a)(this,e),this.addListeners(),this.currentChord=void 0,this.lastChordTime=void 0,this.newChordListeners=[],this.sameChordListeners=[],this.octaveUpListeners=[],this.octaveDownListeners=[]}return Object(c.a)(e,[{key:"addListeners",value:function(){var e=this;window.addEventListener("CHORD_ON_EVENT",function(t){e.chordOn(t.notesDown)}),window.addEventListener("CHORD_OFF_EVENT",function(t){e.chordOff(t.notesDown)})}},{key:"setCurrentChord",value:function(e){this.currentChord=e,this.lastChordTime=(new Date).getTime()}},{key:"chordOn",value:function(e){void 0===this.currentChord||(this.isSameChord(this.currentChord,e)?this.sameChord():this.isOctaveUp(this.currentChord,e)?this.octaveUp(e):this.isOctaveDown(this.currentChord,e)?this.octaveDown(e):this.isOctaveDown(this.currentChord,e,2)?(console.log("its two octaves down!"),this.twoOctavesDown(e)):this.isOctaveUp(this.currentChord,e,2)&&(console.log("its two octaves up!"),this.twoOctavesUp(e))),void 0!==this.currentChord&&(this.chordContains(this.currentChord,e)||this.isSameChord(this.currentChord,e))||this.newChord(e)}},{key:"dispatchEvent",value:function(e){var t=new Event(e);t.chord=this.currentChord,window.dispatchEvent(t)}},{key:"sameChord",value:function(){this.dispatchEvent("SAME_CHORD")}},{key:"octaveDown",value:function(e){this.dispatchEvent("OCTAVE_DOWN")}},{key:"twoOctavesDown",value:function(e){this.dispatchEvent("TWO_OCTAVES_DOWN")}},{key:"octaveUp",value:function(e){this.dispatchEvent("OCTAVE_UP")}},{key:"twoOctavesUp",value:function(e){this.dispatchEvent("TWO_OCTAVES_UP")}},{key:"newChord",value:function(e){this.setCurrentChord(e),this.dispatchEvent("NEW_CHORD")}},{key:"stripOctave",value:function(e){return new Set(Array.from(e).map(function(e){return bs.a.fromString(e).note}))}},{key:"chordContains",value:function(e,t){e=this.stripOctave(e),t=this.stripOctave(t);var n=!0,a=!1,r=void 0;try{for(var s,i=t[Symbol.iterator]();!(n=(s=i.next()).done);n=!0){var o=s.value;if(!e.has(o))return!1}}catch(c){a=!0,r=c}finally{try{n||null==i.return||i.return()}finally{if(a)throw r}}return!0}},{key:"isOctaveUp",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=!0,r=!0,s=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done);r=!0){var u=o.value,l=bs.a.fromString(u).addTranspose(12*n).toString();t.has(l)||(a=!1)}}catch(p){s=!0,i=p}finally{try{r||null==c.return||c.return()}finally{if(s)throw i}}return a}},{key:"isOctaveDown",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=!0,r=!0,s=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done);r=!0){var u=o.value,l=bs.a.fromString(u).addTranspose(-12*n).toString();t.has(l)||(a=!1)}}catch(p){s=!0,i=p}finally{try{r||null==c.return||c.return()}finally{if(s)throw i}}return a}},{key:"isSameChord",value:function(e,t){return this.eqSet(e,t)}},{key:"eqSet",value:function(e,t){if(e.size!==t.size)return!1;var n=!0,a=!1,r=void 0;try{for(var s,i=e[Symbol.iterator]();!(n=(s=i.next()).done);n=!0){var o=s.value;if(!t.has(o))return!1}}catch(c){a=!0,r=c}finally{try{n||null==i.return||i.return()}finally{if(a)throw r}}return!0}},{key:"chordOff",value:function(e){}},{key:"addCallback",value:function(){}}]),e}(),Au=function(){function e(t,n){Object(o.a)(this,e),this.chordsManager=new Du,this.sequencerEngine=t,this.store=this.sequencerEngine.store,this.keyboardEngine=n,this.recordedTriggers={},this.notesDown=new Set}return Object(c.a)(e,[{key:"onNoteDown",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(n&&this.addNoteOn(e),!(e in this.recordedTriggers)){var s=this.store.getState().sequencer.resolution,i=this.store.getState().sequencer.quantized;this.keyboardEngine.onKeyDown(e,s,!this.sequencerEngine.rolling,n,a,r);var o=this.keyboardEngine.recordHit(e,n,s,i,a,r);null!=o&&("tracks"in o?o.recordedTriggers.forEach(function(e){t.sequencerEngine.tracks[e.trackNumber];t.sequencerEngine.rollingManager.addTrackSlice(e.trackNumber,0,o.transpose),t.store.dispatch(Object(w.Ee)(e.trackNumber,e.sliceNumber))}):(this.sequencerEngine.rollingManager.addTrackSlice(o.trackNumber,o.sliceNumber),this.store.dispatch(Object(w.Ee)(o.trackNumber,o.sliceNumber))),this.recordedTriggers[e]=o)}}},{key:"onAlphabetKeyDown",value:function(e){this.onNoteDown(e.key,!1)}},{key:"addNoteOn",value:function(e){this.notesDown=new Set(this.notesDown),this.notesDown.add(e);var t=new Event("CHORD_ON_EVENT");t.notesDown=this.notesDown,window.dispatchEvent(t)}},{key:"addNoteOff",value:function(e){this.notesDown.has(e)&&(this.notesDown=new Set(this.notesDown),this.notesDown.delete(e));var t=new Event("CHORD_OFF_EVENT");t.notesDown=this.notesDown,window.dispatchEvent(t)}},{key:"onNoteOff",value:function(e){var t=this;if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.addNoteOff(e),e in this.recordedTriggers){var n=this.recordedTriggers[e];if(void 0!==n.tracks)n.recordedTriggers.forEach(function(e){return t.store.dispatch(Object(w.Fe)(e.trackNumber,e.sliceNumber))}),n.recordedTriggers.filter(function(e){return e.rolling}).forEach(function(e){e.track;t.sequencerEngine.rollingManager.removeTrackSlice(e.trackNumber,0,n.transpose)}),n.tracks.filter(function(e){return e.trackData}).filter(function(e){return!e.rolling}).forEach(function(a){t.releaseAndRecord(a,n,e,!0)});else{var a=this.sequencerEngine.tracks[n.trackNumber];if(void 0===a)return;this.sequencerEngine.rollingManager.removeTrackSlice(n.trackNumber,n.sliceNumber,void 0),this.store.dispatch(Object(w.Fe)(n.trackNumber,n.sliceNumber)),a.rolling||this.releaseAndRecord(a,n,e)}delete this.recordedTriggers[e]}}},{key:"onKeyUp",value:function(e){this.onNoteOff(e.key)}},{key:"releaseAndRecord",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=t.transpose;void 0===r&&(r=e.trackData.transpose),e.midiEffects.liveInputRelease(a?r+e.trackData.transpose:r,t.sliceNumber),(this.store.getState().sequencer.isRecording||e.subSequence.isTrack&&this.store.getState().mix.isRecordingMix)&&t.record(this.sequencerEngine)}}]),e}(),Ru=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,Cs))).sequencerEngine=e,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(e){var t=e>63.5;this.sequencerEngine.trackRolling=t}}]),t}(xo),Iu=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,Ps))).sequencerEngine=e,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(e){var t=e>63.5;console.log("excecuting sequence roll action"),this.sequencerEngine.sequenceRolling=t}}]),t}(xo),Lu=new q.a.Time("16n"),Fu=new q.a.Time("32n"),Vu=function(e){function t(e,n,a,r){var s;return Object(o.a)(this,t),(s=Object(u.a)(this,Object(l.a)(t).call(this,e,n,a,r))).currentStepTime=null,s.previousStepTime=null,s.lastTrackStep=void 0,s.tracksToRecord={},s.tracksRecording={},s.rollingManager=new Qs,s.nextTimeScheduled=void 0,s.nextStepScheduled=void 0,s.startedTransportExplicitly=!1,s.patternSwitchScheduled=null,s.isRecording=!1,s.playing=!1,s.sequenceRolling=!1,s.resampler=void 0,s.automationStep=0,s.bpmParameter=new Wt("BPM",Object(p.a)(s),function(e,t){return s.onNewBpm(t)},{min:1,max:500,unit:"",defaultValue:s.transport.bpm.value}),s.swingParameter=new Wt("Swing",Object(p.a)(s),function(e,t){s.onNewSwing(t)},{min:50,max:75,unit:"",defaultValue:50}),s.parameters=[],s.registerParameter(s.bpmParameter),s.registerParameter(s.swingParameter),s.latency=void 0,s.clockSync=new ms(Object(p.a)(s)),s.masterResampler=new Vs(Object(p.a)(s),s.groups.channelMixer.stereoMerger,!0),s.transpose=0,s.autoResampleMode=!1,s.resampleConfig=new Bs,s}return Object(h.a)(t,e),Object(c.a)(t,[{key:"registerParameter",value:function(e){this.parameters.push(e),e.setStore(this.store),e.setContext((new Kn).forSequencerEngine(this))}},{key:"startPlaySequence",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.playSequence.cancel(),this.playSequence.start(t);case 2:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"schedulePlay",value:function(){!this.playing&&this.clockSync.connected&&"SLAVE"===this.clockSync.clockType?this.store.dispatch(Object(w.rc)(!0)):this.play()}},{key:"play",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.playTimestamp=(new Date).getTime(),this.playing=!this.playing,this.latency=void 0,this.trackStep=this.isLooping&&this.state.mix.isPlayingMix?this.loopStart:this.startStep,this.currentStep=0,this.previousStep=0,this.previousStepTime=void 0,this.currentStepTime=void 0,this.playing){for(var n in t||this.hasAtleastOneSequencerEnginePlaying()||this.updateBpm(this.bpm),this.startPlaySequence(e,t),!t&&this.hasAtleastOneSequencerEnginePlaying()||(this.startedTransportExplicitly=!0,this.transport.start("+0.000001"),this.transport.loop=!0,this.transport.loopStart="0:0:0",this.transport.loopEnd=this.length/32+":0:0",this.midi&&this.midi.onPlay()),this.subSequences)this.subSequences[n].lfosTrack.start(),this.subSequences[n].tracks.forEach(function(e){return e.restart()}),this.subSequences[n].tracks.forEach(function(e){return e.start()});this.store.dispatch(Object(w.Hb)(this.getSequenceId(),!0))}else this.stop();this.store.dispatch(Object(w.rc)(!1))}},{key:"restartAllMixes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.isLooping;for(var t in this.mixes.forEach(function(t){return t.restart(e)}),this.setSequenceRolling(!1,void 0,!0),this.subSequences)for(var n in this.subSequences[t].tracks){this.subSequences[t].tracks[n].patternRollStepNumber=void 0}this.schedulePatternBufferClear=!1}},{key:"stop",value:function(){for(var e in this.restartAllMixes(),this.latency=void 0,this.playing=!1,this.trackStepReal=0,this.playSequence.stop(),this.startedTransportExplicitly=!1,this.hasMultipleSequencerEnginesPlaying()||(this.transport.stop("+0.01"),this.midi&&this.midi.onStop()),this.subSequences)this.subSequences[e].lfosTrack.stop();for(var t in this.tracks.map(function(e){return e.effects.filter(function(e){return e.syncable()}).map(function(e){return e.stop()})}),this.store.dispatch(Object(w.Hb)(this.getSequenceId(),!1)),this.store.dispatch(Object(w.Ib)(!1)),this.store.dispatch(Object(w.Y)(this.getSequenceId(),0)),this.clockSync&&this.clockSync.onStop(),this.subSequences)this.subSequences[t].tracks.forEach(function(e){e.chokes.chokingDuration=0,e.chokes.liveRelease()})}},{key:"seekToTrackStep",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.isLooping&&(this.looping=!1),this.trackStep=e,this.mixes.forEach(function(t){return t.seekToTrackStep(e)}),0==e&&n&&this.switchToPatternHelper(0),this.subSequences.forEach(function(e){return e.tracks.forEach(function(e){return e.scheduleTrackPatternChangeIfAny(t.trackStep,!0)})})}},{key:"loadNewSequence",value:function(){this.playSequence=this.getPlaySequence()}},{key:"sleep",value:function(){var e=Object(g.a)(v.a.mark(function e(t){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){setTimeout(function(){return e(t)},t)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPlaySequence",value:function(){var e=this,t=Array(16).fill(1).map(function(e,t){return t}),n=new q.a.Sequence(function(t,n){t=e.handleLatency(t),e.lastTrackStep===e.trackStep&&(e.trackStep+=1);e.automationStep;for(var a in e.automationStep=e.getLoopedStep(e.trackStep),e.handleMixSessionStep(),void 0!==e.stepOneCallback&&(e.startedTransportExplicitly&&15==n?e.stepOneCallback(t):e.startedTransportExplicitly||0!=n||e.stepOneCallback(t)),n=e.trackStep,e.scripting&&e.scripting.onStepReached(n),n%e.length===0&&e.scheduleAnyMasterResampling(t),e.scheduleParametersToRecord(n),e.subSequences){var r=e.subSequences[a];e.state.mix.isPlayingMix&&r.updateVolumeFromAutomation(n),e.scheduleTracks(r.tracks,n,t)}e.scheduleSamplesRolling(n,t),n%=e.length,e.nextTimeScheduled=t,e.nextStepScheduled=n;var s=e.getLoopedStep(e.trackStep+1);e.lastTrackStep=e.trackStep,e.trackStep=s,e.previousStepTime=e.latestStepTime;var i=e.trackStep;e.latestStepTime=t;new q.a.Time(e.latestStepTime);var o=e.currentStep;e.currentStep=n,e.previousStep=o,e.clockSync.onTick(e.getMilliseconds(t),n),e.midi&&e.midi.onTick(e.getMilliseconds(t),n,e.resolution),q.a.Draw.schedule(function(){e.playing&&(e.lastTrackStepReal=i,e.previousStepReal=e.trackStepReal,e.previousStepTimeReal=e.currentStepTime,e.trackStepReal=s,e.currentStepTime=t,e.store.dispatch(Object(w.X)(e.getSequenceId(),n,e.trackStep)))},t)},t,"32n");return n.loop=!0,n}},{key:"getLoopedStep",value:function(e){if(this.isLooping&&this.state.mix.isPlayingMix){var t=(e-this.loopStart)%(this.loopEnd-this.loopStart);return e=this.loopStart+t}return e}},{key:"handleLatency",value:function(e){if(void 0===this.latency&&!this.clockSync.initiator){this.timeToCompare=this.timeToCompare-(new Date).getTime(),this.latency=this.timeToCompare-this.getMilliseconds(e),this.latency+=Fu.toMilliseconds();var t=(new Date).getTime()-this.playTimestamp;this.latency-=t/2}return this.latency&&(e+=this.latency/1e3),e+=this.state.sequencer.latency/1e3}},{key:"handleMixSessionStep",value:function(e){var t=this;if(this.state.mix.isPlayingMix){for(var n in this.isLooping&&this.trackStep===this.loopStart&&this.restartAllMixes(!0),this.subSequences){var a=this.subSequences[n],r=this.subSequences[n].mix.getValue(Ot,this.automationStep);void 0!==r&&r!==this.getCurrentPattern(a)&&this.switchToPattern(r,!0,a)}var s=this.isSequenceRollingAtStep(this.automationStep);void 0!==s&&s!==this.isSequenceRolling&&this.setSequenceRolling(s,void 0,!0);try{this.mixes.forEach(function(n){return n.scheduleNext(t.trackStep,e)})}catch(i){console.log("caught err while scheduling automation = "),console.log(i)}}}},{key:"scheduleParametersToRecord",value:function(e){if(this.isRecording){var t=this.state.tracks.parametersToRecord,n=function(n){var a=t[n];if(t[n].context.track){var r=a.context.track,s=r.pattern,i=e%r.length,o=s.stepBuckets[i];for(var c in o.steps){var u=o.steps[c];if(u.on)u.parameters.filter(function(e){return e.name===a.name}).forEach(function(e){return e.set(a.get())})}}};for(var a in t)n(a)}}},{key:"scheduleTracks",value:function(e,t,n){for(var a={},r=0;r<e.length;r++)try{a[e[r].trackNumber]=this.scheduleTrack(e[r],t,n)}catch(s){console.log("caught error while scheduling track err = "),console.log(s)}Hs(0,e,a,t),e.forEach(function(e){return e.onStepEnded(n,t)})}},{key:"scheduleTrack",value:function(e,t,n){e.subSequence.isTrack&&e.scheduleTrackPatternChangeIfAny(t);var a=void 0===e.pattern.startStep?0:e.pattern.startStep,r=e.subSequence.isTrack?t-a:t%e.pattern.length();e.isEnabled;try{e.pattern.mix.scheduleNext(r,n,this)}catch(o){console.log("caught an error while scheduling pattern events = "),console.log(o)}if(0==r&&(this.scheduleAnyTrackRecording(e,n),this.scheduleAnyTrackResampling(e,n),this.scheduleAnyAudioTrackPlaying(e,n),this.scheduleAnyFrozenTrackPlaying(e,n)),!e.isFrozen){if(this.scheduleSequenceRollingIfNeeded(e,r,n)){var s=e.getFactoredResolution().getNumberOfStepsAtBaseResolution(),i=e.patternRollStepNumber+r%s;return i%=e.pattern.stepBuckets.length,this.getTrackTriggers(e,n,i,e.pattern,r)}return this.getTrackTriggers(e,n,r,e.pattern,r)}}},{key:"scheduleAnyTrackRecording",value:function(e,t){this.store.getState();this.tracksToRecord[e.trackNumber]?(e.startRecording(t),this.store.dispatch(Object(w.He)(e.trackNumber,!0)),this.tracksRecording[e.trackNumber]=!0,delete this.tracksToRecord[e.trackNumber]):this.tracksRecording[e.trackNumber]&&(e.stopRecording(t),this.store.dispatch(Object(w.He)(e.trackNumber,!1)),delete this.tracksRecording[e.trackNumber])}},{key:"scheduleAnyMasterResampling",value:function(e){var t=this.store.getState();void 0!==this.resampler&&(this.resampler.resamplingDurationElapsed++,this.resampler.resamplingDurationElapsed==t.tracks.resampleDuration&&(this.resampler.stop(e),this.resampler=void 0)),t.sequencer.resampleMaster&&(this.store.dispatch(Object(w.wc)(!1)),this.resampler=this.masterResampler,this.resampler.start(e))}},{key:"scheduleAnyTrackResampling",value:function(e,t){var n=this.store.getState();if(e.subSequence===this.currentSubSequence){void 0!==e.resampler&&(e.resampler.resamplingDurationElapsed++,e.resampler.resamplingDurationElapsed==n.tracks.resampleDuration&&(e.resampler.stop(t),e.resampler=void 0));var a=n.tracks.tracksToResample,r=a.indexOf(e.trackNumber);r>-1&&(a.splice(r,1),this.store.dispatch(Object(w.re)(a)),e.resampler=e.masterResampler,e.resampler.start(t)),n.tracks.trackToFreeze&&n.tracks.trackToFreeze.trackNumber===e.trackNumber&&n.tracks.trackToFreeze.subSequenceId===e.subSequence.id&&(e.resampler=e.masterResampler,e.resampler.start(t,e,!0),this.store.dispatch(Object(w.oe)(void 0)))}}},{key:"scheduleAnyFrozenTrackPlaying",value:function(e,t){if(e.isFrozen&&e.isFrozenPlaying){var n=new ot;n.loadDefaults(),n.attack=10,n.release=Lu.toMilliseconds()/4,e.triggerFrozenSample(n,t)}}},{key:"scheduleAnyAudioTrackPlaying",value:function(e,t){if("MIDI"===e.getTrackType()&&Object.keys(e.samplers).length>0){var n=new ot;n.loadDefaults(),n.attack=80,n.release=Lu.toMilliseconds()/4,e.triggerSamples(n,t)}}},{key:"scheduleSequenceRollingIfNeeded",value:function(e,t,n){this.store.getState();return this.schedulePatternBufferClear?(e.patternRollStepNumber=void 0,this.schedulePatternBufferClear=!1,!1):!(!this.isSequenceRolling||!e.rolling)&&(e.updatePatternRollStepNumber(this.rollingResolution),!0)}},{key:"getTrackTriggers",value:function(e,t,n,a,r){n=this.getStepNumber(n,r);var s=e.subSequence.masterStepManager.getBucket(a,n);e.onNewStep();var i=s?s.steps:[];for(var o in i){var c=i[o],u=new q.a.Time(t)+Fu*o;c.triggerAutomations(u,e);var l=c.getPolyphony();for(var p in l){var h=l[p];h.on&&e.midiEffects.input(h,u,r)}}var d=e.midiEffects.output(t,n,r);if(this.shouldPlayStep(r))return d}},{key:"shouldPlayStep",value:function(e){return e%=32,e=Math.floor(e/2),this.state.steps.masterStepToggles[e]}},{key:"scheduleTrackRolling",value:function(e,t,n){var a=this;e.subSequence.isTrack||(t%=e.length);var r=this.getMilliseconds(n),s=e.getFactoredResolution();setTimeout(function(){var r=a.rollingManager.getTriggers(t,s,e);r.filter(function(t){return t.trackSlice.trackNumber===e.trackNumber}).length>0&&(e.onNewStep(),r.forEach(function(r){if(void 0!==(e=a.tracks[r.trackSlice.trackNumber])){var i=new ot;i.slice=r.trackSlice.sliceNumber,i.transpose=void 0===r.trackSlice.transpose?e.trackData.transpose:r.trackSlice.transpose+e.trackData.transpose,i=e.getStepDataForStep(i);var o=new q.a.Time(n)+r.time;e.midiEffects.input(i,o,t),(a.isRecording||e.subSequence.isTrack&&a.isRecordingMix)&&e.recordHit(r.step,s,i.slice,null,i.transpose)}}),r=e.midiEffects.output(n,t),Hs(0,[e],{0:r}),e.onStepEnded(n,t))},r-20)}},{key:"scheduleSamplesRolling",value:function(e,t){var n=this;this.tracks.filter(function(e){return e.rolling}).forEach(function(a){return n.scheduleTrackRolling(a,e,t)})}},{key:"missedNextScheduledStep",value:function(){return q.a.Master.context.currentTime<=this.nextTimeScheduled}},{key:"scheduleNext",value:function(e,t,n){var a=this,r=this.tracks[e];if(r.getTrackType()!==_n){var s=this.rollingManager.getTriggerTimes(this.nextStepScheduled,this.resolution,r),i=r.getFactoredResolution();s.forEach(function(e){var s=new ot;s.slice=t,s.transpose=void 0===n?r.trackData.transpose:n+r.trackData.transpose,s=r.getStepDataForStep(s),r.trigger(s,a.nextTimeScheduled+e.time),a.isRecording&&(r.recordHit(e.step,i,t,s.duration,s.transpose),r.updateSteps())})}}},{key:"getCurrentStepTime",value:function(){var e=this.getMilliseconds(this.latestStepTime),t=new q.a.Time(q.a.Master.context.currentTime).toMilliseconds()-new q.a.Time(this.previousStepTime).toMilliseconds();return t<0||e>0&&e>t?this.previousStepTime:this.latestStepTime}},{key:"getCurrentStep",value:function(e,t){Math.abs(new q.a.Time(q.a.Master.context.currentTime)-new q.a.Time(this.latestAbsoluteTime)),Math.abs(new q.a.Time(q.a.Master.context.currentTime)-new q.a.Time(this.previousAbsoluteTime));var n=void 0;n=t?t.subSequence.isTrack?1e6:t.pattern.length():this.length;var a=this.lastTrackStep%n;return e=e||jo.baseResolution,Math.floor(a/(jo.baseResolution.numSteps()/e.numSteps()))}},{key:"getMilliseconds",value:function(e){return new q.a.Time(e).toMilliseconds()-new q.a.Time(q.a.Master.context.currentTime).toMilliseconds()}},{key:"recordTrack",value:function(e){this.tracksToRecord[e]=!0}},{key:"isTrackRecording",value:function(e){return this.tracksRecording[e]}},{key:"doubleTrackLength",value:function(e){this.tracks[e].doubleTrackLength(),this.transport.loopStart="0:0:0",this.transport.loopEnd=this.length/32+":0:0"}},{key:"halfTrackLength",value:function(e){this.tracks[e].halfTrackLength(),this.transport.loopStart="0:0:0",this.transport.loopEnd=this.length/32+":0:0"}},{key:"setSequenceRolling",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.rollingResolution,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.state.midi.midiMapMode===qs&&this.store.dispatch(Object(w.m)(new Iu(this))),e?e!=this.isSequenceRolling&&function(){var e=n.getNumberOfStepsAtBaseResolution(),r=t.automationStep;for(var s in r-=r%e,t.subSequences)t.subSequences[s].tracks.forEach(function(e){return e.initPatternBuffer(r)});a&&(t.trackRolling=!0)}():this.schedulePatternBufferClear=!0,this.isSequenceRolling=e,!a)if(this.store.getState().mix.isRecordingMix){var r=this.resolution;this.mix.addEvent(new St(e,r))}else this.store.getState().mix.isPlayingMix&&this.mix.holdEvent(new St(e,this.resolution))}},{key:"isSequenceRollingAtStep",value:function(e){if(this.store.getState().mix.isPlayingMix){var t=this.mix.getValue(Mt,e);return this.mix.getValue(Mt,e-1)&&!t&&(this.trackRolling=!1),t}return this.isSequenceRolling}},{key:"onNewBpm",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t&&t<500&&t>=1){for(n in this.transport.bpm.value=t,this.store.dispatch(Object(w.L)(t)),this.subSequences)this.subSequences[n].lfosTrack.onBPMUpdated();this.tracks.forEach(function(e){return e.onBPMUpdated()}),this.clockSync&&this.clockSync.onBPMChanged(t)}case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateBpm",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>1&&void 0!==r[1]&&r[1],this.bpm=t,!n){for(a in this.subSequences)this.subSequences[a].lfosTrack.onBPMUpdated();this.tracks.forEach(function(e){return e.onBPMUpdated()})}case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onNewSwing",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=(t-50)/50,this.transport.swing=n;case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateSwing",value:function(e){this.swing=e}},{key:"recording",value:function(e){this.store.dispatch(Object(w.Jb)(e)),this.isRecording=e,this.tracks.filter(function(e){return"MIDI"===e.getTrackType()}).map(function(t){return t.recording(e)})}},{key:"connectToKeyboardEngine",value:function(e){var t=this;this.keyboardEngine=e,this.keyboardHelper=new Au(this,e),this.midi=new Is(e,this.keyboardHelper,function(e){return t.updateBpm(e)}),this.midi.setStartCallback(function(){return t.play()}),this.midi.setStopCallback(function(){return t.stop()})}},{key:"hasMultipleSequencerEnginesPlaying",value:function(){var e=this.store.getState().sequencer.isPlaying;return Object.keys(e).filter(function(t){return e[t]}).length>1}},{key:"hasAtleastOneSequencerEnginePlaying",value:function(){var e=this.store.getState().sequencer.isPlaying;return Object.keys(e).filter(function(t){return e[t]}).length>0}},{key:"getStepNumber",value:function(e,t){return this.stepNumberScript?this.stepNumberScript(e):e}},{key:"rolling",get:function(){return this.store.getState().sequencer.trackRolling}},{key:"startStep",get:function(){var e=this.state.sequencer.viewMode;return void 0===this.state.arrangement.mouseX||e===lo&&!this.isLooping?0:Us(this.state.arrangement.mouseX,this.resolution,void 0,this.state.arrangement.xScale)}},{key:"isLooping",get:function(){return this.state.arrangement.looping}},{key:"looping",set:function(e){this.store.dispatch(Object(w.A)(e))}},{key:"loopStart",get:function(){return this.state.arrangement.selection.start}},{key:"loopEnd",get:function(){return this.state.arrangement.selection.end}},{key:"trackRolling",set:function(e){this.state.midi.midiMapMode===qs&&this.store.dispatch(Object(w.m)(new Ru(this))),this.store.dispatch(Object(w.le)(e)),this.rollingManager.clear()}},{key:"isRecordingMix",get:function(){return this.store.getState().mix.isRecordingMix}},{key:"sequenceRolling",set:function(e){this.setSequenceRolling(e)}},{key:"lfos",get:function(){return this.lfosTrack.lfos}},{key:"envelopesTrack",get:function(){return this.currentSubSequence.envelopesTrack}},{key:"lfosTrack",get:function(){return this.currentSubSequence.lfosTrack}},{key:"envelopes",get:function(){return this.envelopesTrack.envelopes.map(function(e){return e.envelope})}},{key:"bpm",get:function(){return this.bpmParameter.get()},set:function(e){this.bpmParameter.set(e)}},{key:"swing",get:function(){return this.swingParameter.get()},set:function(e){this.swingParameter.set(e)}},{key:"state",get:function(){return this.store.getState()}}]),t}(Mu),Bu=n(340),Uu=n(165),Hu=n(341),Ju=(n(600),"PUBLIC"),Gu="GUILD",zu=R.a.presets;function _u(e){var t=e.toString().indexOf("t");return t>0?new ht(parseInt(e.slice(0,t)),!0):new ht(parseInt(e),!1)}function Wu(e){return!isNaN(parseFloat(e))&&isFinite(e)}var Ku=function(e){function t(e,n,a,r){var s;return Object(o.a)(this,t),(s=Object(u.a)(this,Object(l.a)(t).call(this,e,n,a,r))).recordingsToSave=[],s.loadedSequenceId=void 0,s.samplesToSync=[],s.loadedSamples={},s.editHistory=[],s}return Object(h.a)(t,e),Object(c.a)(t,[{key:"save",value:function(e,t){var n=this,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0,s=void 0!==r&&t!=Ju?r.guildId:0;return new Promise(function(){var i=Object(g.a)(v.a.mark(function i(o,c){var u,l;return v.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,n.saveAnyNewRecordings(s);case 2:u=ln(u={hasPatterns:!0,subSequences:n.getSubSequences(),sendVolumes:n.getSendVolumesToSave(),bpm:n.bpm,swing:n.swing,resolution:jo.baseResolution.toString(),tracksParameters:n.getTracksParametersToSave(),gateMode:n.gateMode,tracksPatterns:n.getTracksPatternsToSave(),scripting:n.scripting.getJson(),parameterLocks:n.parameterLocks.map(function(e){return e.getJson()}),mix:n.mix.getJson(),sends:n.sends.getJson(),patternColors:n.store.getState().toolbar.patternColors,lfos:n.lfos.map(function(e){return e.getJson()}),envelopes:n.envelopes.map(function(e){return e.getJson()}),lfoPatternLocks:n.store.getState().tracks.lfoPatternLocks,envelopePatternLocks:n.store.getState().tracks.envelopePatternLocks,patternLocks:n.store.getState().sequencer.patternLocks,trackPatternLocks:n.store.getState().tracks.trackPatternLocks},"bpmParameter",n.bpmParameter),u=ln(u,"swingParameter",n.swingParameter),l=new Bu.a(!0),"PRIVATE"===t?R.a.crypto.encryptAndSave(e,u,n.loadedSequenceId,a).then(function(e){n.update(e),o(e)}):t===Gu?R.a.guildSequences.newGuildSequence(u,e,n.loadedSequenceId,r.guildId).then(function(e){n.update(e),o(e)}):t===Ju&&l.save(e,u,n.loadedSequenceId,n.getSamples(),a).then(function(e){n.update(e.ipfsHash),n.loadedSequenceId=e.ipfsHash,o(e.ipfsHash)});case 8:case"end":return i.stop()}},i)}));return function(e,t){return i.apply(this,arguments)}}())}},{key:"getTrackMidiEffectsToSave",value:function(){var e=[];for(var t in this.tracks)e.push(this.tracks[t].midiEffects.getJson());return e}},{key:"getTrackLiveEffectsToSave",value:function(){var e=[];for(var t in this.tracks)e.push(this.tracks[t].liveEffects.getJson());return e}},{key:"getTrackEffectsToSave",value:function(){var e=[];for(var t in this.tracks){for(var n=[],a=this.tracks[t].effects,r=0;r<a.length;r++)n.push(a[r].getJson());e.push(n)}return e}},{key:"getTrackEffectsChainsToSave",value:function(){var e=[];for(var t in this.tracks)e.push(this.tracks[t].effectsChains.map(function(e){return e.getJson()}));return e}},{key:"getSubSequences",value:function(){var e=[];for(var t in this.subSequences){this.switchToSubSequence(this.subSequences[t].id);for(var n=[],a=[],r=0;r<this.subSequences[t].tracks.length;r++){var s=[],i=this.subSequences[t].tracks[r];a.push(i.getJson());for(var o=0;o<this.numberOfPatterns();o++){var c=i.patterns[o];if(void 0!==c){for(var u={},l=0;l<c.stepBuckets.length;l++){var p=c.getBucket(l);if(p.anyEffectAutomation()||p.anyOn())for(var h in p.steps)u[l]=p.getJson()}u.size=c.length(),u.buckets=!0,s.push(u)}}n.push(s)}var d=this.subSequences[t].groups.getJson(),f=this.subSequences[t].lfosTrack.lfos.map(function(e){return e.getJson()}),m=this.subSequences[t].envelopesTrack.envelopes.map(function(e){return e.getJson()});e.push(Object(X.a)({},this.subSequences[t].getJson(),{tracks:n,tracksData:a,lfos:f,envelopes:m,groups:d,tracksPatterns:this.getTracksPatternsToSave(),tracksEffectsChains:this.getTrackEffectsChainsToSave(),tracksMidiEffects:this.getTrackMidiEffectsToSave(),tracksLiveEffects:this.getTrackLiveEffectsToSave(),tracksParameters:this.getTracksParametersToSave(),sendVolumes:this.getSendVolumesToSave(),mix:this.subSequences[t].mix.getJson(),id:this.subSequences[t].id}))}return e}},{key:"getSendVolumesToSave",value:function(){return this.tracks.map(function(e){return e.getSendNodes().map(function(e){return e.volume.value})})}},{key:"getTracksPatternsToSave",value:function(){return this.tracks.map(function(e){return e.patterns.map(function(e){return e.getJson()})})}},{key:"getTracksParametersToSave",value:function(){return this.tracks.map(function(e){return e.trackData.getJson()})}},{key:"loadSubSequences",value:function(e){var t=this,n=[];0===this.tracks.length&&this.subSequences.length<=1&&(this.subSequences.forEach(function(e){return e.dispose()}),this.subSequences=[]);var a=function(a){var r=e.subSequences[a],s=r.id,i=t.newSubSequence(s),o=r.tracks.map(function(e,n){for(var a=-16,s=e.length,o=0;o<e.length;o++){var c=e[o].size;c>a&&(a=c)}"type"in r.tracksData[n]&&r.tracksData[n].type;var u=r.tracksData[n].type,l=void 0;if("MIDI"===u)l=new Ko(n,t,t.mixSession,s,function(){return t.update()},t.sends);else if(u===zn)l=new Lo(n,t,t.mixSession,s,function(){return t.update()},i);else if("AUDIO"===u)(l=new Bc(n,t,t.mixSession,s,function(){return t.update()},i)).fromJson(r.tracksData[n]);else if(u===_n||u===Wn){var p=r.tracksData[n].instrumentType;l=Rc(t,u,p)}return l.setSends(t.sends),l.fromJson(r.tracksData[n]),l});for(var c in r.tracksData){var u=r.tracksData[c];"chokes"in u&&o[c].chokes.fromJson(u.chokes,o)}o.forEach(function(e){return i.addTrack(e)}),i.fromJson(r),n.push(i)};for(var r in e.subSequences)a(r);return n}},{key:"getAllRecordingsToSave",value:function(){var e=this.recordingsToSave.filter(function(e){return void 0!==e.audioBuffer});for(var t in this.subSequences){var n=this.subSequences[t];for(var a in n.tracks)e=[].concat(Object(ge.a)(e),Object(ge.a)(n.tracks[a].frozenSamplesToSave))}return[].concat(Object(ge.a)(e),Object(ge.a)(this.samplesToSync))}},{key:"saveAnyNewRecordings",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r,s,i,o,c,u,l,p,h,d,f,m,g,b,y,k,E,S,O,w,C,P,T,j,x,N,q;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=this.recordingsToSave.filter(function(e){return void 0!==e.audioBuffer}),e.t0=v.a.keys(this.subSequences);case 2:if((e.t1=e.t0()).done){e.next=16;break}a=e.t1.value,r=this.subSequences[a],e.t2=v.a.keys(r.tracks);case 6:if((e.t3=e.t2()).done){e.next=14;break}if(s=e.t3.value,0!==t){e.next=11;break}return e.next=11,r.tracks[s].makePublicIfNeeded();case 11:n=[].concat(Object(ge.a)(n),Object(ge.a)(r.tracks[s].frozenSamplesToSave)),e.next=6;break;case 14:e.next=2;break;case 16:i=new Uu.a,o=[],e.t4=v.a.keys(n);case 19:if((e.t5=e.t4()).done){e.next=46;break}for(c=e.t5.value,u=n[c],l=u.name,p=["","","",""],h=u.videoId||"",d=u.getTagsToSave(),f=(new Date).getFullYear(),d.length>4&&(d=d.slice(0,4)),m=d.length;m<4;m++)d.push("");if(g="",b=u.getId(),0===t){e.next=40;break}return e.next=34,B.a.getSound(b);case 34:return y=e.sent,e.next=37,this.encryptedIpfs.addSound(y,Gu,t,i);case 37:k=e.sent,this.replaceWithEncryptedSample(b,k),b=k;case 40:if(!u.isResampled){e.next=43;break}return R.a.resample.newResample(b,l,d,u.samplesUsed,t),e.abrupt("continue",19);case 43:o.push({ipfsHash:b,title:l,videoId:h,tags:d,styles:p,country:g,year:f,coverArt:void 0,discogsId:void 0}),e.next=19;break;case 46:e.t6=v.a.keys(this.samplesToSync);case 47:if((e.t7=e.t6()).done){e.next=70;break}for(E=e.t7.value,S=this.samplesToSync[E],O=S.name,w=["","","",""],C=S.videoId||"",(P=S.tags).length>4&&(P.reverse(),P=P.slice(0,4)),T=P.length;T<4;T++)P.push("");if(j=S.year||2020,x=S.country||"",N=S.getId(),0===t){e.next=67;break}return e.next=62,B.a.getSound(N);case 62:return q=e.sent,e.next=65,this.encryptedIpfs.addSound(q,Gu,t,i);case 65:N=e.sent,this.replaceWithEncryptedSample(N);case 67:o.push({ipfsHash:N,title:O,videoId:C,tags:P,styles:w,country:x,year:j,coverArt:S.coverArtHash,discogsId:S.discogsId}),e.next=47;break;case 70:if(0!==o.length){e.next=72;break}return e.abrupt("return");case 72:0!==t?R.a.newEncryptedSamples(o,t,i):R.a.newSamplesWithMetadata(o,0);case 73:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadTrackPatternLocks",value:function(e){var t=Object(X.a)({},e.trackPatternLocks);e.tracks&&((t={})[this.currentSubSequence.id]=e.trackPatternLocks),t=Object(X.a)({},this.state.tracks.trackPatternLocks,t),this.store.dispatch(Object(w.r)(t))}},{key:"loadTrackMidiEffects",value:function(e,t,n){return void 0!==e.tracksMidiEffects?(n[t].midiEffects.fromJson(e.tracksMidiEffects[t]),n[t].midiEffects.effects):[]}},{key:"loadTrackEffects",value:function(e,t,n){var a=[],r=n[t].effectsChains[0];if(void 0!==e.tracksEffects){for(var s=0;s<e.tracksEffects[t].length;s++)a.push(sa(e.tracksEffects[t][s],n,this,t));r.updateEffects(a)}else if(void 0!==e.tracksEffectsChains){var i=n[t],o=e.tracksEffectsChains[t],c=[];for(var u in o){var l=new ia(i.gainNode,i.trackNode,(new Kn).forTrack(i),this),p=o[u];for(var h in p){var d=p[h];l.addEffect(sa(d,n,this,t))}l.updateEffects(),c.push(l)}i.effectsChains.forEach(function(e){return e.dispose()}),i.effectsChains=c}else a=[],r.updateEffects(a);return a}},{key:"loadSubSequenceMix",value:function(e,t){console.log("load sub sequence mix called with json",e.mix),t.mix.loadFromJson(e.mix,this)}},{key:"sleep",value:function(e){return new Promise(function(){var t=Object(g.a)(v.a.mark(function t(n,a){return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:setTimeout(function(){return n()},e);case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getSleepTime",value:function(){return this.state.mix.isPlayingMix?750:5}},{key:"loadSubSequencePatterns",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n,a){var r,s,i,o,c,u,l,p,h,d,f,m,g,b,y,k,E,S,O,w,C,P,T,j,x,N,q=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:!(q.length>3&&void 0!==q[3])||q[3],r=n.tracks,s=0;case 3:if(!(s<t.tracks.length)){e.next=58;break}return i=r[s],o=-16,c=[],u=t.tracks[s],l=this.loadTrackEffects(t,s,r),p=this.loadTrackMidiEffects(t,s,r),e.next=12,this.sleep(this.getSleepTime());case 12:h=0;case 13:if(!(h<u.length)){e.next=41;break}d=[],f=u[h],(m="size"in f?f.size:a.numSteps())>o&&(o=m),g=(new Date).getTime(),b="buckets"in f,y=0;case 21:if(!(y<m)){e.next=33;break}if(y in f){e.next=26;break}return k=new ct(i),d.push(k),e.abrupt("continue",30);case 26:if(E=new ct(i),S=f[y],b)for(w in S)(C=new ot).track=i,C.stepNumber=y,C.loadFromJson(S[w],l,void 0,void 0,void 0,i,p),E.steps[w]=C;else(O=new ot).track=i,O.stepNumber=y,O.loadFromJson(f[y],l,void 0,void 0,void 0,i,p),E.steps[0]=O;d.push(E);case 30:y++,e.next=21;break;case 33:(P=new Or(this,i)).loadStepBuckets(d,!0),c.push(P),T=(new Date).getTime(),T-g;case 38:h++,e.next=13;break;case 41:return j="type"in t.tracksData[s]&&"MIDI"===t.tracksData[s].type,void 0,void 0,j&&(i.setMidiEngine(this.midi),i.setSequencerEngine(this)),i.patterns=c,i.pattern.muted=t.tracksData[s].muted,i.gated=t.tracksData[s].gated,e.next=50,this.sleep(this.getSleepTime());case 50:x=(new Date).getTime(),j?this.loadSamplersIntoTrack(i,t.tracksData[s],s,n):this.loadSamplersIntoTrack(i,t.tracksData[s],s,n),i.setupEffects(),N=(new Date).getTime(),N-x;case 55:s++,e.next=3;break;case 58:case"end":return e.stop()}},e,this)}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"loadSubSequenceTracksParameters",value:function(e,t){for(var n in e.tracksParameters){var a=e.tracksParameters[n];t[n].trackData.loadFromJson(a,void 0,!1,!1,this),t[n].pattern.calculateFills(a)}}},{key:"loadSubSequencePatternParameters",value:function(e,t){for(var n in t)for(var a=t[n],r=0;r<a.patterns.length;r++)a.patterns.length>r&&a.patterns[r].loadFromJson(e.tracksPatterns[n][r])}},{key:"loadSubSequenceEffects",value:function(e,t){for(var n in t){var a=t[n];this.setupNewTrack(a,!0,!0);for(var r=a.getSendNodes(),s=0;s<e.sendVolumes[n].length;s++)r[s].volume.value=e.sendVolumes[n][s];void 0!==e.tracksLiveEffects&&a.liveEffects.fromJson(e.tracksLiveEffects[n])}}},{key:"getMaxSubSequenceId",value:function(){var e=-1;for(var t in this.subSequences){var n=this.subSequences[t].id;n>e&&(e=n)}return e}},{key:"loadSubSequenceLFOs",value:function(e,t){for(var n in e.lfos){var a=e.lfos[n];t.lfos[parseInt(n)].lfo.fromJson(a)}}},{key:"loadSubSequenceEnvelopes",value:function(e,t){for(var n in e.envelopes){var a=e.envelopes[n];t.envelopes[parseInt(n)].fromJson(a)}}},{key:"normalizeSubSequenceIds",value:function(e){var t=this.getMaxSubSequenceId();t++;var n={};for(var a in e.subSequences){var r=e.subSequences[a].id;n[r]=r+t}this.convertSubSequenceIds(e,n)}},{key:"convertSubSequenceIds",value:function(e,t){for(var n in e.subSequences){var a=e.subSequences[n];void 0!==t[a.id]&&(a.id=t[a.id]),e.subSequences[n]=a}var r={},s={},i={},o=new Set(Object.values(t));for(var c in e.trackPatternLocks){if(void 0!==t[c=parseInt(c)])r[t[c]]=e.trackPatternLocks[c];else o.has(c)||(r[c]=e.trackPatternLocks[c])}for(var u in e.envelopePatternLocks){if(void 0!==t[u])i[t[u]]=e.envelopePatternLocks[u];else o.has(u)||(i[u]=e.envelopePatternLocks[u])}for(var l in e.lfoPatternLocks){if(void 0!==t[l])s[t[l]]=e.lfoPatternLocks[l];else o.has(l)||(s[l]=e.lfoPatternLocks[l])}e.trackPatternLocks=r,e.lfoPatternLocks=s,e.envelopePatternLocks=i}},{key:"loadSequence",value:function(e){var t=this;return console.log("loadSequence("+e+")"),new Promise(function(){var n=Object(g.a)(v.a.mark(function n(a,r){var s,i,o,c,u,l;return v.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Ge.a.getAccount();case 2:if(s=n.sent,i=void 0,n.prev=4,void 0===s){n.next=27;break}return n.next=8,R.a.guildSequences.getGuildSequence(e);case 8:if(void 0!==(o=n.sent)){n.next=14;break}return n.next=12,R.a.encryption.getSequencesSharedWithUser(e);case 12:o=(o=n.sent)[0];case 14:if(void 0===o){n.next=20;break}return n.next=17,R.a.crypto.fetchAndDecrypt(e,o);case 17:i=n.sent,n.next=27;break;case 20:return n.next=22,R.a.encryption.getEncryptedSequenceIfAny(e);case 22:if(void 0===(c=n.sent)){n.next=27;break}return n.next=26,R.a.crypto.fetchAndDecrypt(e,c);case 26:i=n.sent;case 27:n.next=31;break;case 29:n.prev=29,n.t0=n.catch(4);case 31:u=!1,0==t.tracks.length&&(u=!0),(l=new Bu.a(!Wu(e),Wu(e)?e:void 0,Wu(e)?void 0:e,i)).loadTitle().then(function(e){t.store.dispatch(Object(w.dd)(e))}),l.load().then(function(){var n=Object(g.a)(v.a.mark(function n(r){var s,i,o,c,l,p,h,d,f,m,g,b,y,k,E,S,O,C;return v.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t.loadedSequenceId=e,console.log("sequence data"),console.log(Object(X.a)({},r)),s=Object(Hu.a)(r),n.next=6,Object(Hu.b)(s,t.encryptedIpfs,t.getSleepTime());case 6:if(t.loadedSamples=n.sent,t.normalizeSubSequenceIds(r),t.length,i=jo.oldDefaultResolution,r.groups,t.hasAtleastOneSequencerEnginePlaying()||(t.updateBpm(r.bpm),pn(r,"bpmParameter",t.bpmParameter)),"sends"in r&&t.sends.loadFromJson(r.sends),void 0===r.subSequences){for(c in r.subSequences=[{id:0,tracks:r.tracks,tracksData:r.tracksData,groups:r.groups,envelopes:r.envelopes,lfos:r.lfos,tracksParameters:r.tracksParameters,tracksPatterns:r.tracksPatterns,tracksEffects:r.tracksEffects,tracksMidiEffects:r.tracksMidiEffects,tracksLiveEffects:r.tracksLiveEffects,sendVolumes:r.sendVolumes}],o={},r.tracksData)l=r.tracksData[c],o[c]=l.patternLocks;r.trackPatternLocks=o}t.normalizeSubSequenceIds(r),"swing"in r&&(t.updateSwing(r.swing),pn(r,"swingParameter",t.swingParameter)),i=_u(r.resolution),p=!1,"hasPatterns"in r&&(p=!0),h=t.loadSubSequences(r),t.loadTrackPatternLocks(r),n.t0=v.a.keys(h);case 22:if((n.t1=n.t0()).done){n.next=38;break}return d=n.t1.value,f=(new Date).getTime(),t.switchToSubSequence(h[d].id),n.next=28,t.loadSubSequencePatterns(r.subSequences[d],h[d],i,p);case 28:t.loadSubSequenceTracksParameters(r.subSequences[d],h[d].tracks),t.loadSubSequencePatternParameters(r.subSequences[d],h[d].tracks),t.loadSubSequenceEffects(r.subSequences[d],h[d].tracks),t.loadSubSequenceLFOs(r.subSequences[d],h[d]),t.loadSubSequenceEnvelopes(r.subSequences[d],h[d]),t.loadSubSequenceMix(r.subSequences[d],h[d]),m=(new Date).getTime(),m-f,n.next=22;break;case 38:t.switchToSubSequence(h[0].id),"lfoPatternLocks"in r&&(g=Object(X.a)({},r.lfoPatternLocks),r.tracks&&((g={})[t.currentSubSequence.id]=r.lfoPatternLocks),g=Object(X.a)({},t.state.tracks.lfoPatternLocks,g),t.store.dispatch(Object(w.q)(g))),"envelopePatternLocks"in r&&(b=Object(X.a)({},r.envelopePatternLocks),r.tracks&&((b={})[t.currentSubSequence.id]=r.envelopePatternLocks),b=Object(X.a)({},t.state.tracks.envelopePatternLocks,b),t.store.dispatch(Object(w.p)(b))),t.gateMode=!("gateMode"in r)||r.gateMode,u&&(t.playSequence=t.getPlaySequence()),n.t2=v.a.keys(h);case 44:if((n.t3=n.t2()).done){n.next=51;break}return y=n.t3.value,t.switchToSubSequence(h[y].id),n.next=49,h[y].groups.fromJson(r.subSequences[y].groups,t);case 49:n.next=44;break;case 51:return"mix"in r&&t.mix.loadFromJson(r.mix,t),t.loadParameterLocks(r),n.next=55,t.sleep(t.getSleepTime());case 55:for(k in h)for(S in(E=h[k]).tracks)void 0===(O=E.tracks[S]).group&&("MIDI"===O.getTrackType()?E.groups.addMidiTrack(O):void 0!==O.sample&&void 0!==O.sample.ipfsHash&&E.groups.addTrack(O));if("patternColors"in r)for(C in r.patternColors)t.store.dispatch(Object(w.jc)(parseInt(C),r.patternColors[C]));t.play(),t.play(),t.updateTracks(),t.store.dispatch(Object(w.Tb)(e,!1)),window.installation&&t.operationManager.setupSyncing(),t.switchToSubSequence(h[0].id),t.store.dispatch(Object(w.bc)(t.numberOfPatterns())),void 0!==t.update&&t.update(e),t.selectTrack(0),a();case 67:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}());case 36:case"end":return n.stop()}},n,null,[[4,29]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"newNumberOfPatterns",value:function(e){for(var t=this.numberOfPatterns();t<e;t++)this.newPattern(!0)}},{key:"combineWithSequencerEngine",value:function(e){for(var t in e.subSequences){var n=e.subSequences[t];if(void 0!==this.getSubSequence(n.id)){var a=-1;for(var r in this.subSequences){var s=this.subSequences[r].id;s>a&&(a=s)}n.id=a+1,this.addSubSequence(n)}}}},{key:"loadParameterLocks",value:function(e){if("parameterLocks"in e){var t=e.parameterLocks;for(var n in this.parameterLocks=[],t){var a=new Ro;a.fromJson(t[n],this),this.parameterLocks.push(a)}for(;this.parameterLocks.length<2;)this.parameterLocks.push(new Ro)}}},{key:"loadSamplersIntoTrack",value:function(e,t,n,a){var r=void 0;if(void 0!==t){if(e.pattern.volume=t.volume,"samplers"in t)for(var s in t.samplers)Wu(s)?e.addSound(parseInt(s),t.samplers[s]):e.addSound(s,t.samplers[s]),void 0===r&&(r=t.samplers[s]);if("envelopes"in t)for(var i in t.envelopes)e.connectToEnvelope(a.envelopes[t.envelopes[i]]);if("envelopeConnections"in t)for(var o in t.envelopeConnections){var c=t.envelopeConnections[o];e.connectToEnvelope(a.envelopes[c.envelope],c.mode)}}return r}},{key:"loadSlices",value:function(e,t){var n=[];return"samplersParameters"in e&&(Array.isArray(e.samplersParameters[t])?n=e.samplersParameters[t]:n.push({startTime:e.samplersParameters[t].startTime,endTime:e.samplersParameters[t].endTime})),n}},{key:"newRecordingToSaveLater",value:function(e){this.recordingsToSave.push(e)}},{key:"getParameterFromJson",value:function(e){var t=e.context,n=new Kn,a=void 0,r=[];if(void 0!==t.track){var s=0;void 0!==t.chainNumber&&(s=t.effectsChainNumber),r=(a=this.tracks[t.track]).effectsChains[s].effects,n=n.forTrack(a)}else if(void 0!==t.group){var i=this.groups.groups[t.group];r=i.effects,n=n.forGroup(i)}else if(void 0!==t.sends){var o=this.sends.sends[t.sends];r=o.effects,n=n.forSend(o)}var c=void 0;if(t.isInstrument)c=a.instrument.parameters;else if(void 0!==t.effect&&-1!=t.effect){c=r[t.effect].parameters}else void 0!==a&&(c=a.trackData.parameters);if(void 0!==c){var u=e.name,l=c.filter(function(e){return e.name===u});if(l.length>=1)return l[0]}}},{key:"getEffectsPreset",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a,r,s,i,o,c,u;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a={},t.trackEffectsChains){for(s in r=[],t.trackEffectsChains){for(c in i=new ia(n.gainNode,n.trackNode,(new Kn).forTrack(n),this),o=t.trackEffectsChains[s])u=o[c],i.addEffect(sa(u,this.tracks,this,s));r.push(i)}a.effectsChains=r}return t.midiEffects&&(a.midiEffects=new ls(n),a.midiEffects.fromJson(t.midiEffects)),e.abrupt("return",a);case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadEffectsPreset",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a,r,s=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>2&&void 0!==s[2]?s[2]:this.tracks[this.store.getState().cursor.track],n&&this.loadLFOsAndEnvelopes(t),e.next=4,this.getEffectsPreset(t,a);case 4:(r=e.sent).effectsChains&&(a.effectsChains=r.effectsChains),r.midiEffects&&(a.midiEffects=r.midiEffects);case 7:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"auditionPreset",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a,r,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("audiitonPreset"),a=t.name,e.next=4,zu.getPresetData(t);case 4:r=e.sent,(s=this.tracks[n]).fromJson(r.trackParameters),s.presetName=a,this.update();case 9:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadPreset",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a,r,s,i,o,c,u,l;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.contentHash,r=t.name,console.log("load preset preset name",t,r),void 0===a&&"string"===typeof t&&(a=t),e.next=6,zu.getPresetData(t);case 6:return s=e.sent,e.next=9,zu.getPresetInstrumentType(a);case 9:if("EFFECTS"!==e.sent){e.next=13;break}return this.loadEffectsPreset(s,n),e.abrupt("return");case 13:if(void 0!==s.tracks){e.next=17;break}return this.loadTrackPreset(s,a,n,void 0,r),console.log("finished loading preset"),e.abrupt("return");case 17:for(o in i={},s.tracks)i[o]=this.tracks.length,this.loadTrackPreset(s.tracks[o],void 0,n);if(s.keyMappings)for(c in s.keyMappings)u=s.keyMappings[c],l=i[u.trackNumber],this.keyboardEngine.map(u.key,l,u.sliceNumber);case 20:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadLFOsAndEnvelopes",value:function(e){if("lfos"in e)for(var t in e.lfos){var n=e.lfos[t];this.lfos[parseInt(t)].lfo.disconnectAllModulators(),this.lfos[parseInt(t)].lfo.fromJson(n)}if("envelopes"in e)for(var a in e.envelopes){var r=e.envelopes[a];this.envelopes[parseInt(a)].fromJson(r)}}},{key:"loadPresetAsSubSequence",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a,r,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.contentHash,r=t.name,void 0===a&&"string"===typeof t&&(a=t),void 0!==n){e.next=7;break}return e.next=6,zu.getPresetData(t);case 6:n=e.sent;case 7:return e.next=9,this.loadTrackPreset(n,a,!1,!1,r,1);case 9:s=e.sent,this.newSubSequence(void 0,s),this.loadLFOsAndEnvelopes(n),s.trackNumber=0,s.updateSteps();case 14:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadTrackPreset",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n,a){var r,s,i,o,c,u,l,p,h,d,f,m,g,b,y,k=this,E=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(E.length>3&&void 0!==E[3])||E[3],s=E.length>4?E[4]:void 0,i=E.length>5&&void 0!==E[5]?E[5]:this.numberOfPatterns(),a&&this.loadLFOsAndEnvelopes(t),console.log("loadTrackPreset",t),o=void 0,"MIDI"===t.trackParameters.type?(o=new Ko(this.tracks.length,this,this.mixSession,i,function(){return k.update()},this.currentSubSequence),this.loadSamplersIntoTrack(o,t.trackParameters,this.tracks.length,this.currentSubSequence),o.setMidiEngine(this.midi),this.setupRecordableTrack(o)):t.trackParameters.type===_n||t.trackParameters.type===Wn?(c=t.trackParameters.instrumentType,o=Rc(this,t.trackParameters.type,c,i)):(o=new Lo(this.tracks.length,this,this.mixSession,i,function(){return k.update()},this.sends),this.loadSamplersIntoTrack(o,t.trackParameters,this.tracks.length,this.currentSubSequence)),o.setSends(this.sends),o.fromJson(t.trackParameters),o.trackData.loadFromJson(t.trackData,void 0,!1,!1,this),console.log("setting preset name = "+s),t.trackEffects){for(u=[],l=0;l<t.trackEffects.length;l++)u.push(sa(t.trackEffects[l],this.tracks,this));o.effectsChains[0].effects=u}else if(t.trackEffectsChains){for(h in p=[],t.trackEffectsChains){for(m in d=new ia(o.gainNode,o.trackNode,(new Kn).forTrack(o),this),f=t.trackEffectsChains[h])g=f[m],d.addEffect(sa(g,this.tracks,this,h));d.updateEffects(),p.push(d)}o.effectsChains.forEach(function(e){return e.dispose()}),o.effectsChains=p}if(t.midiEffects&&o.midiEffects.fromJson(t.midiEffects),t.liveEffects&&o.liveEffects.fromJson(t.liveEffects),o.gated=t.trackParameters.gated,r){if(this.setupNewTrack(o,!0,!0),this.groups.addTrack(o),"sendVolumes"in t)for(b=o.getSendNodes(),y=0;y<t.sendVolumes.length;y++)b[y].volume.value=t.sendVolumes[y];this.currentSubSequence.addTrack(o),o.switchToPattern(this.currentPattern),o.updateSteps(),this.update()}return o.presetId=n,o.presetName=s,e.abrupt("return",o);case 19:case"end":return e.stop()}},e,this)}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"saveProjectAsPreset",value:function(){var e=this,t=[];for(var n in this.tracks){var a=this.getTrackPreset(n);t.push(a)}var r=void 0;t.length>0&&(r=t[0].lfos);var s={lfos:r,tracks:t,keyMappings:this.keyboardEngine.keyMappings,midiMappings:this.keyboardEngine.midiMappings},i=window.prompt("Type name of preset");zu.newPreset(s,i).catch(function(e){console.log(e)}).then(function(t){e.presetId=t})}},{key:"saveTrackPreset",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n,a,r){var s,i,o,c;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=this.tracks[t],0!=r){e.next=4;break}return e.next=4,s.makePublicIfNeeded();case 4:i=a?this.getEffectPreset(t):this.getTrackPreset(t),o=a?"EFFECTS":s.getInstrumentType(),c=void 0,void 0===s.sample||a||(c=s.sample.getId()),zu.newPreset(i,n,c,o,r).catch(function(e){console.log(e)}).then(function(e){if(s.presetId=e,"EXTERNAL_INSTRUMENT"===o){var t=s.midiEffects.effects.filter(function(e){return"Midi Interface"===e.name})[0];if(void 0!==t){var n=t.midiOutput.name;zu.tagPreset(e,[n])}}});case 9:case"end":return e.stop()}},e,this)}));return function(t,n,a,r){return e.apply(this,arguments)}}()},{key:"updateTrackPreset",value:function(e){var t=this.getTrackPreset(e),n=this.tracks[e];zu.updatePresetIpfsHash(n.presetId,t)}},{key:"getEffectPreset",value:function(e){var t=this.tracks[e],n=t.effectsChains.map(function(e){return e.getJson()});return{lfo:this.lfos.map(function(e){return e.getJson()}),envelopes:this.envelopes.map(function(e){return e.getJson()}),trackEffectsChains:n,midiEffects:t.midiEffects.getJson(),liveEffects:t.liveEffects.getJson()}}},{key:"getTrackPreset",value:function(e){var t=this.tracks[e],n=t.getSendNodes().map(function(e){return e.volume.value}),a=t.effectsChains.map(function(e){return e.getJson()});return{lfos:this.lfos.map(function(e){return e.getJson()}),envelopes:this.envelopes.map(function(e){return e.getJson()}),trackData:t.trackData.getJson(),trackParameters:t.getJson(),sendVolumes:n,sendVolumees:n,trackEffectsChains:a,midiEffects:t.midiEffects.getJson(),liveEffects:t.liveEffects.getJson()}}},{key:"loadOldMixFromJson",value:function(e){if(void 0!==e){var t={},n={};for(var a in e.deterministicMixesByType)1===parseInt(a)?n[a]=e.deterministicMixesByType[a]:t[a]=e.deterministicMixesByType[a];this.mix.loadFromJson(Object(X.a)({},e,{deterministicMixesByType:t})),this.currentSubSequence.mix.loadFromJson(Object(X.a)({},e,{deterministicMixesByType:n}))}}},{key:"getSamples",value:function(){var e=[];for(var t in this.subSequences){var n=this.subSequences[t];for(var a in n.tracks){var r=n.tracks[a];r.sample&&e.push(r.sample.getId())}}return e}},{key:"addSampleToSync",value:function(e){this.samplesToSync.push(e)}},{key:"replaceWithEncryptedSample",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a,r,s,i,o,c;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(a in this.subSequences)for(s in(r=this.subSequences[a]).tracks){for(c in i=r.tracks[s],o={},i.samplers)c===t?o[n]=i.samplers[c]:o[c]=i.samplers[c];i.samplers=o,i.soundIds=Object.keys(i.samplers)}case 1:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadSampleFromSequence",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a,r,s,i,o,c,u;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("loadSampleFromSequence sampleId=%s sequenceId=%s",t,n),e.next=3,B.a.getJson(n);case 3:for(i in a=e.sent,console.log(a),r=a.subSequences,s={},r)for(u in o=r[i],c=function(e){e=parseInt(e);var n=o.tracksData[e];if(t in n.samplers){(s=Object(X.a)({},o)).trackParameters=n,s.sendVolumes=o.sendVolumes[e],s.trackPatterns=o.tracksPatterns[e],s.trackEffectsChains=o.tracksEffectsChains[e],s.trackMidiEffects=o.tracksMidiEffects[e],s.trackLiveEffects=o.tracksLiveEffects[e],s.trackData=o.tracksParameters[e],s.mix=o.mix,s.tracks=o.tracks[e];var a=o.groups.find(function(t){return t.tracks.indexOf(e)>-1});a.tracks=[0],s.groups=[a]}u=e},o.tracksData)c(u);this.loadPresetAsSubSequence({},s);case 9:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),t}(Vu),Yu=function e(){Object(o.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"month",type:"uint32"},{name:"year",type:"uint32"}],name:"newMonthlyIndex",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"month",type:"uint32"},{indexed:!0,name:"year",type:"uint64"}],name:"NewMonthlyIndex",type:"event"}],this.contractAddress="0xfaa21e766f988524d3f38b9c46c22aca11d76dd5"},Qu=n(93),Xu=new Yu,Zu="undefined"!==typeof window.web3?new ai.a(window.web3.currentProvider):new ai.a(new ai.a.providers.HttpProvider("https://ropsten.infura.io/2f3dce2af1044e88b4851c3d73c3d00c")),$u=function(){function e(){Object(o.a)(this,e),this.indexContract=new Zu.eth.Contract(Xu.abi,Xu.contractAddress),this.indexContractAddress=this.indexContract.options.address}return Object(c.a)(e,[{key:"getIndexForMonth",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a,r,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Qu.a(this.indexContractAddress).from(ei.q).select("hash").where("month",t).where("year",n).executeQuery();case 2:if(a=e.sent,console.log("got the results for monthly = "),console.log(a),void 0!==a&&0!==a.length){e.next=7;break}return e.abrupt("return");case 7:return r=a[0].hash,e.next=10,B.a.getJson(r);case 10:return s=e.sent,e.abrupt("return",s);case 12:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function el(e){var t=void 0;for(var n in e){var a=e[n];void 0!==a&&(t=void 0!==t?tl(t,a):a)}return t}function tl(e,t){var n={};for(var a in e){var r=e[a],s=t[a];for(var i in n[a]={},r){var o=r[i],c=s[i];n[a][i]=nl(o,c)}}return n}function nl(e,t){var n=al(e),a=al(t),r={};for(var s in n)r[s]=s in a?[].concat(Object(ge.a)(n[s]),Object(ge.a)(a[s])):n[s];for(var i in a)i in n||(r[i]=n[i]);return function(e){return Object.keys(e).map(function(t){return{dimension:t,values:e[t]}})}(r)}function al(e){var t={};for(var n in e){var a=e[n];t[a.dimension]=a.values}return t}var rl=new(function(){function e(){Object(o.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"bytes32",name:"ipfsHash",type:"bytes32"}],name:"newIndex",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"guildsAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"},{indexed:!1,internalType:"bytes32",name:"indexHash",type:"bytes32"}],name:"NewIndex",type:"event"}],this.contractAddress="0xefBe8bf3720fE3aD117B1397DD95c77240Fe8837"}return Object(c.a)(e,[{key:"getContract",value:function(e){return console.log("getting contract w address = "+this.contractAddress),new e.eth.Contract(this.abi,this.contractAddress)}}]),e}()),sl=new $u,il={},ol=function(){function e(t){var n=this;Object(o.a)(this,e),this.fullIndex=void 0,this.guildId=0,this.useMonth=!1,this.monthlyIndices=[],this.monthlyFilter=void 0,this.store=t,t&&this.store.subscribe(function(){return n.onStateUpdate()})}return Object(c.a)(e,[{key:"onStateUpdate",value:function(){var e=this.store.getState(),t=e.guilds.selectedGuild?e.guilds.selectedGuild.guildId:0;t!==this.guildId&&(this.guildId=t,this.loadIndex())}},{key:"loadNewIndex",value:function(){var e=Object(g.a)(v.a.mark(function e(t){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.guildId=t,e.next=3,this.loadIndex();case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"filterByMonth",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.monthlyFilter&&this.monthlyFilter.month===t&&this.monthlyFilter.year===n){e.next=4;break}return e.next=3,sl.getIndexForMonth(t,n);case 3:this.monthlyIndex=e.sent;case 4:return this.useMonth=!0,this.monthlyFilter={month:t,year:n},e.abrupt("return",!0);case 7:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearFilter",value:function(){this.useMonth=!1}},{key:"loadIndex",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=n.length>0&&void 0!==n[0]?n[0]:this.guildId)||!Ge.a.isLoggedIn()){e.next=8;break}return e.next=4,this.fetchAndMergeIndices();case 4:return this.fullIndex=e.sent,console.log("merged indices = "),console.log(this.fullIndex),e.abrupt("return");case 8:return e.next=10,this.fetchIndex(t);case 10:this.fullIndex=e.sent;case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fetchAndMergeIndices",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("fetch and merge indicies"),t=[0],e.next=4,R.a.guilds.getGuildsForUser();case 4:n=Array.from(new Set(t.map(function(e){return e.guildId}))),console.log("guilds = "),console.log(n),a=[],e.t0=v.a.keys(n);case 9:if((e.t1=e.t0()).done){e.next=20;break}return r=e.t1.value,s=n[r],console.log("fetching index for guildId = "+s),e.t2=a,e.next=16,this.fetchIndex(s);case 16:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=9;break;case 20:return console.log("indices to merge = "),console.log(a),e.abrupt("return",el(a));case 23:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fetchIndex",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:this.guildId,e.next=3,this.getIndexHash(t);case 3:if(n=e.sent,console.log("hash returned = "+n),void 0!==n){e.next=8;break}return e.abrupt("return",void 0);case 8:return e.next=10,B.a.getJson(n);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getAllForField",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;if(void 0===this.index)return[];var a=this.index[e][e].map(function(e,t){return{value:e.dimension,rank:t}});return this.sort(a),a.length<t+n?a.slice(t):a.slice(t,t+n)}},{key:"getFieldsForField",value:function(e,t,n){if(void 0===this.index)return new Set([]);var a=this.index[t][e].filter(function(e){return e.dimension==n});if(0==a.length)return new Set([]);if(void 0===a[0].values)return new Set;var r=Object(ge.a)(a[0].values).map(function(e,t){return{value:e,rank:t}});return this.sort(r),new Set(r)}},{key:"freeTextSearch",value:function(e,t){console.log("freeTextSearch("+e+" ,"+t+")"),console.log(this.fullIndex);var n=this.getAllForField(e,0,5e3);return n=n.filter(function(e){return e.value.toString().toLowerCase().includes(t.toLowerCase())}).map(function(e,t){return{value:e.value,rank:e.rank}})}},{key:"sort",value:function(e){return e.sort(function(e,t){return e=e.value,t=t.value,void 0===e[0]?1:void 0===t[0]?-1:e[0]===e[0].toLocaleLowerCase()&&t[0]===t[0].toLocaleLowerCase()||e[0]===e[0].toLocaleUpperCase()&&t[0]===t[0].toLocaleUpperCase()?e.localeCompare(t):e[0]===e[0].toLocaleLowerCase()?-1:1})}},{key:"getIndexHash",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in il)){e.next=4;break}return e.next=3,il[t];case 3:return e.abrupt("return",e.sent);case 4:return n=new Promise(function(){var e=Object(g.a)(v.a.mark(function e(n,a){var r,s,i;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ti.a(rl.contractAddress).from(ei.n).select("indexHash").where("guildId",t).limit(1),e.next=3,r.executeQuery();case 3:if(0!==(s=e.sent).length){e.next=7;break}return n(void 0),e.abrupt("return");case 7:i=s[0].indexHash,n(i);case 9:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),il[t]=n,e.next=8,n;case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"index",get:function(){return this.useMonth?void 0===this.monthlyIndex?this.fullIndex:this.monthlyIndex.index:this.fullIndex}},{key:"toBlock",get:function(){return this.monthlyIndex.toBlock}},{key:"fromBlock",get:function(){return this.monthlyIndex.fromBlock}}]),e}(),cl=new ht(32,!1),ul=function(){function e(t){Object(o.a)(this,e),this.store=t,this.step=0,this.track=0,this.group=0,this.show=!1}return Object(c.a)(e,[{key:"getJson",value:function(){return{step:this.step,track:this.track}}},{key:"getStep",value:function(e){return void 0===e?this.step:e.transformStepAtResolution2(this.step,cl)}},{key:"setStep",value:function(e,t){this.step=cl.transformStepAtResolution2(e,t)}},{key:"updateRedux",value:function(){this.store.dispatch(Object(w.ad)(this.track)),this.store.dispatch(Object(w.Yc)(this.getStep(this.resolution))),this.store.dispatch(Object(w.mc)(this.getStep(this.resolution)))}},{key:"step",set:function(e){this.store.dispatch(Object(w.db)(e)),this.updateRedux()},get:function(){return this.store.getState().cursor.step}},{key:"track",set:function(e){this.store.dispatch(Object(w.eb)(e))},get:function(){return this.store.getState().cursor.track}},{key:"show",set:function(e){this.store.dispatch(Object(w.cb)(e))},get:function(){return this.store.getState().cursor.show}},{key:"resolution",get:function(){return this.store.getState().sequencer.resolution}}]),e}(),ll=new ht(32,!1),pl=function(e){function t(e){var n,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e,r,s,a))).searcher=new Pi(new ol(e),Object(p.a)(n)),n.searcher.cache.loadIndex(),n.cursor=new ul(e),n.stereoOnly=a,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"setScripting",value:function(e){this.scripting=e}},{key:"clearSequence",value:function(){this.tracks.map(function(e){return e.pattern.clear()}),this.updateTracks()}},{key:"getSelectedStep",value:function(){return this.cursor.getStep(this.resolution)}},{key:"getSelectedStepData",value:function(){return this.getSelectedTrack().getStepAtResolution(this.cursor.step,ll)}},{key:"getSelectedTrack",value:function(){return void 0===this.cursor.track?0:this.tracks[this.cursor.track]}},{key:"selectTrack",value:function(e){this.cursor.track=e,this.store.getState().mix.selectedTrack!==this.cursor.track&&this.store.dispatch(Object(w.ad)(e)),this.tracks[e]&&this.tracks[e].updateSteps(),this.tracks[e]&&(this.cursor.step=this.cursor.step%this.tracks[e].pattern.length()),this.store.dispatch(Object(w.Yc)(this.cursor.getStep(this.resolution)))}},{key:"select",value:function(e,t){void 0!==this.tracks[e]&&(this.tracks[e].stepSelected(t),this.cursor.setStep(t,this.resolution),this.cursor.track=e,this.store.dispatch(Object(w.ad)(e)),this.store.dispatch(Object(w.Yc)(t)))}},{key:"selectGroupStep",value:function(e,t){this.cursor.setStep(t,this.resolution),this.cursor.group=e,this.store.dispatch(Object(w.Yc)(t))}},{key:"left",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(0!=this.tracks.length){var t=this.cursor.getStep(this.resolution);if(--t<0){this.up(e);var n=this.getTrackLength();return this.cursor.setStep(n-1,this.resolution),void(e&&(this.store.dispatch(Object(w.ad)(this.cursor.track)),this.store.dispatch(Object(w.Yc)(n-1))))}this.cursor.setStep(t,this.resolution),this.tracks[this.cursor.track].stepSelected(this.cursor.step),e&&this.cursor.updateRedux()}}},{key:"getTrackLength",value:function(){return this.getSelectedTrack().getStepsAtResolution(this.resolution).length}},{key:"right",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(0!=this.tracks.length){var t=this.tracks[this.cursor.track].getStepsAtResolution(this.resolution).length,n=this.cursor.getStep(this.resolution);if(++n>=t)return this.cursor.step=0,this.down(e),void(e&&this.cursor.updateRedux());this.cursor.setStep(n,this.resolution),this.tracks[this.cursor.track].stepSelected(this.cursor.step),this.store.getState().mix.selectedTrack!==this.cursor.track&&e&&this.store.dispatch(Object(w.ad)(this.cursor.track)),e&&this.store.dispatch(Object(w.Yc)(n))}}},{key:"setSelectedTrack",value:function(e){this.store.dispatch(Object(w.ad)(e))}},{key:"up",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(0!=this.tracks.length){if(0==this.cursor.track)return this.cursor.track=this.tracks.length-1,void(this.store.getState().mix.selectedTrack!==this.cursor.track&&this.selectTrack(this.cursor.track));this.cursor.track--,this.store.getState().mix.selectedTrack!==this.cursor.track&&this.selectTrack(this.cursor.track),this.tracks[this.cursor.track].stepSelected(this.cursor.step)}}},{key:"down",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(0!=this.tracks.length){if(this.cursor.track==this.tracks.length-1)return this.cursor.track=0,void this.selectTrack(this.cursor.track);this.cursor.track++,this.store.getState().mix.selectedTrack!==this.cursor.track&&this.selectTrack(this.cursor.track),this.tracks[this.cursor.track].stepSelected(this.cursor.step)}}},{key:"searchForSounds",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a,r,s,i,o,c,u,l,p,h,d,f,m;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.searcher.selectedTags=t,console.log("getting sounds..."),a=(new Date).getTime(),e.next=5,this.searcher.getSounds();case 5:return r=e.sent,e.next=8,r.getNext();case 8:if(s=(new Date).getTime(),i=s-a,console.log("took "+i+" ms to get sounds"),!(r.unsortedResults.length>0)){e.next=38;break}if(o=Math.floor(Math.random()*r.unsortedResults.length),console.log("index = "+o),c=r.unsortedResults[o],!n){e.next=26;break}return u=new K.a(c),e.next=19,u.load();case 19:l=this.getSelectedTrack(),(p=new ji(u,this)).sounds=Xs(Object(ge.a)(r.unsortedResults)),p.initBuffers(),l.auditionSound(u,!1,p),e.next=38;break;case 26:return h=new K.a(c),e.next=29,h.load();case 29:return e.next=31,this.addSound(h);case 31:d=(new Date).getTime(),f=d-s,console.log("took "+f+" ms to add sound"),(m=this.tracks[this.tracks.length-1]).samplesStream.sounds=Xs(Object(ge.a)(r.unsortedResults)),this.scrollToSelectedTrack(),setTimeout(function(){m.samplesStream.initBuffers()},250);case 38:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),t}(Ku),hl=function(){function e(t,n){Object(o.a)(this,e),this.sampler=t,this.sliceNumber=n}return Object(c.a)(e,[{key:"start",get:function(){return this.sampler.getStartTime(this.sliceNumber)},set:function(e){this.sampler.slice(this.sliceNumber,e,this.end)}},{key:"end",get:function(){return this.sampler.getEndTime(this.sliceNumber)},set:function(e){this.sampler.slice(this.sliceNumber,this.start,e)}}]),e}();function dl(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.cursor.step;return e.getSelectedTrack().getEasyPattern().getStepsAtStepNumber(e.cursor.step).map(function(e){return e.step})}function fl(e,t){var n=t.split("=");if(2!=n.length)return!1;var a=n[0],r=n[1];if(!Object($e.a)(r))return!1;if(r=parseFloat(r),"length"===a)return function(e,t){t=jo.baseResolution.transformStepAtResolution2(t,e.resolution);var n=e.getSelectedTrack();n.pattern.changeLength(t),n.updateSteps()}(e,r),!0;var s=dl(e);for(var i in s){var o=s[i];if(!(a in o))return!1;o[a]=r}return e.getSelectedTrack().updateSteps(),!0}var ml=function(){function e(t){Object(o.a)(this,e),this.sequencerEngine=t}return Object(c.a)(e,[{key:"run",value:function(e){return"run"!==e&&(e.indexOf("=")>-1?fl(this.sequencerEngine,e):e in this&&(this[e](),!0))}},{key:"warp",value:function(){this.track&&(this.track.warp(),this.sequencerEngine.update())}},{key:"gate",value:function(){this.track&&(this.track.gated=!0)}},{key:"ungate",value:function(){this.track&&(this.track.gated=!1)}},{key:"sampleSynth",value:function(){this.sequencerEngine.autoResampleMode=!0,this.sequencerEngine.masterResampler.prepare(),this.sequencerEngine.store.dispatch(Object(w.wc)(!0))}},{key:"makeInstrument",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.sequencerEngine.addSampledInstrumentTrack(),e.t0=v.a.keys(this.sequencerEngine.tracks);case 2:if((e.t1=e.t0()).done){e.next=10;break}if(n=e.t1.value,!(a=this.sequencerEngine.tracks[n].sample)){e.next=8;break}return e.next=8,t.instrument.newSample(void 0,a);case 8:e.next=2;break;case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"track",get:function(){return this.sequencerEngine.getSelectedTrack()}}]),e}(),vl=500;function gl(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;t.cursor.step;bl(t)&&function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.getSelectedStepData(),a=new Set;for(;n.on;)if(a.add(n.id),t?e.right(!1):e.left(!1),n=e.getSelectedStepData(),a.has(n.id))return void e.cursor.updateRedux();e.cursor.updateRedux()}(t,e),yl(t,e)}function bl(e){var t=e.cursor.getStep(e.resolution);return e.getSelectedTrack().getEasyPattern().getStepsAtStepNumber(t,e.resolution).map(function(e){return e.step}).some(function(e){return e.on})}function yl(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.getSelectedStepData(),a=new Set,r=0;!n.on;)if(r++,a.add(n.id),t?e.right(!1):e.left(!1),n=e.getSelectedStepData(),a.has(n.id)||r>vl)return void e.cursor.updateRedux();e.cursor.updateRedux()}function kl(e){for(var t=e.getSelectedStep()%e.resolution.numSteps(),n=0;n<t;n++)e.left(!1);e.cursor.updateRedux()}function El(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.resolution.numSteps(),a=0;a<n;a++)e.right(!1);t&&e.cursor.updateRedux()}function Sl(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.resolution.numSteps(),a=0;a<n;a++)e.left(!1);e.cursor.updateRedux(),t&&e.cursor.updateRedux()}var Ol=500;function wl(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];bl(e)||yl(e);for(var n=e.getSelectedTrack(),a=n.getEasyPattern(),r=[],s=new Set,i=0;bl(e);){i++;var o=e.getSelectedStepData();if(s.has(o)||i>Ol)return;s.add(o);var c=e.cursor.getStep(e.resolution),u=a.getStepsAtStepNumber(c,e.resolution).map(function(t){return Object(X.a)({},t,{stepNumber:e.cursor.step})});r=[].concat(Object(ge.a)(r),Object(ge.a)(u)),e.right()}var l=Pl(r);return t&&e.operationManager.dispatch(Vi(n,r.map(function(e){return e.step}))),l}function Cl(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];kl(e);for(var n=e.resolution.numSteps(),a=e.resolution.getNumberOfStepsAtBaseResolution(),r=[],s=e.getSelectedTrack(),i=s.getEasyPattern(),o=e.cursor.step,c=0;c<n;c++){var u=i.getStepsAtStepNumber(o).map(function(e){return Object(X.a)({},e,{stepNumber:o})});r=[].concat(Object(ge.a)(r),Object(ge.a)(u)),o+=a}var l=Pl(r);return t&&e.operationManager.dispatch(Vi(s,r.map(function(e){return e.step}))),l}function Pl(e){var t=[];for(var n in e)t.push(Object(X.a)({},e[n],{step:e[n].step.getCopy(!0,!1,!0,!1,!1)}));return t}var Tl=function(){function e(t){var n=this;Object(o.a)(this,e),this.sequencerEngine=t,this.cursor=t.cursor,this.currentCommand=void 0,this.number=void 0,this.killRing=[],this[0]=function(){n.zero()}}return Object(c.a)(e,[{key:"run",value:function(e){e in this&&(this.currentCommand&&this.number?(this[e](parseInt(this.number)),this.number=void 0,this.currentCommand=void 0):(this[e](),this.currentCommand=e)),Object($e.a)(e)&&(void 0===this.number&&(this.number=""),this.number+=e)}},{key:"d",value:function(e){if(e=void 0===e?1:e,"d"==this.currentCommand){this.killRing=[];for(var t=0;t<e;t++)this.killRing=[].concat(Object(ge.a)(this.killRing),Object(ge.a)(Cl(this.sequencerEngine))),El(this.sequencerEngine,!1);for(var n=0;n<e;n++)Sl(this.sequencerEngine,!1);this.updateRedux(),this.currentCommand=void 0}}},{key:"x",value:function(){this.killRing=function(e){var t=e.getSelectedTrack();if(bl(e)){var n=e.getSelectedStepData(),a=e.cursor.step,r=Pl([{stepNumber:a,step:n}]);return e.operationManager.dispatch(Ii(t,a)),r}return[]}(this.sequencerEngine)}},{key:"w",value:function(e){if("d"!=this.currentCommand)if("y"!=this.currentCommand){e=void 0===e?1:e-1;for(var t=0;t<e;t++)gl(!0,this.sequencerEngine)}else{e=void 0===e?1:e,this.killRing=[];for(var n=0;n<e;n++)this.killRing=[].concat(Object(ge.a)(this.killRing),Object(ge.a)(wl(this.sequencerEngine,!1)));this.currentCommand=void 0}else{e=void 0===e?1:e,this.killRing=[];for(var a=0;a<e;a++)this.killRing=[].concat(Object(ge.a)(this.killRing),Object(ge.a)(wl(this.sequencerEngine)));this.currentCommand=void 0}}},{key:"b",value:function(e){e=void 0===e?1:e-1;for(var t=0;t<e;t++)gl(!1,this.sequencerEngine)}},{key:"h",value:function(){this.sequencerEngine.left()}},{key:"l",value:function(){this.sequencerEngine.right()}},{key:"j",value:function(){El(this.sequencerEngine)}},{key:"k",value:function(){Sl(this.sequencerEngine)}},{key:"t",value:function(){this.dispatch(Li(this.track,this.stepNumber,this.resolution))}},{key:"e",value:function(){this.cursor.show=!this.cursor.show}},{key:"zero",value:function(){kl(this.sequencerEngine)}},{key:"a",value:function(){this.track.doubleTrackLength()}},{key:"s",value:function(){this.track.halfTrackLength()}},{key:"i",value:function(){!function(e){var t=dl(e,e.cursor.step);for(var n in t){var a=t[n].duration||1;t[n].duration=a+1}e.getSelectedTrack().updateSteps()}(this.sequencerEngine)}},{key:"o",value:function(){!function(e){var t=dl(e,e.cursor.step);for(var n in t){var a=t[n].duration||1;t[n].duration=Math.max(1,a-1)}e.getSelectedTrack().updateSteps()}(this.sequencerEngine)}},{key:"y",value:function(e){if(e=void 0===e?1:e,"y"==this.currentCommand){this.killRing=[];for(var t=0;t<e;t++)this.killRing=[].concat(Object(ge.a)(this.killRing),Object(ge.a)(Cl(this.sequencerEngine,!1))),El(this.sequencerEngine,!1);for(var n=0;n<e;n++)Sl(this.sequencerEngine,!1);this.updateRedux(),this.currentCommand=void 0}}},{key:"p",value:function(){!function(e,t){var n=e.getSelectedTrack(),a=e.cursor.step,r=Math.min.apply(Math,Object(ge.a)(t.map(function(e){return e.stepNumber})));t=t.map(function(e){return Object(X.a)({},e,{stepNumber:a+e.stepNumber-r})});var s=e.operationManager;t.forEach(function(e){return s.dispatch(Ai(n,e.step.getCopy(!0,!1,!0,!1,!1),e.stepNumber))})}(this.sequencerEngine,Object(ge.a)(this.killRing))}},{key:"dispatch",value:function(e){this.op.dispatch(e)}},{key:"updateRedux",value:function(){this.cursor.updateRedux()}},{key:"stepNumber",get:function(){return this.sequencerEngine.getSelectedStep()}},{key:"track",get:function(){return this.sequencerEngine.getSelectedTrack()}},{key:"op",get:function(){return this.sequencerEngine.operationManager}},{key:"resolution",get:function(){return this.sequencerEngine.resolution}}]),e}();function jl(e){return e.includes("[")?{effectName:e.slice(0,e.indexOf("[")),parameters:function(e){for(var t=[],n="",a="",r=!0,s=!1,i=0;i<e.length;i++){var o=e.charAt(i);if("="!=o){if(r)n+=o;else if(s){if(" "==o){t.push({parameter:n,value:a}),s=!1,r=!0,n="",a="";continue}a+=o}}else r=!1,s=!0}""!==n&&t.push({parameter:n,value:a});return t}(e=e.includes("]")?e.slice(e.indexOf("[")+1,e.indexOf("]")):e.slice(e.indexOf("[")+1))}:{effectName:e,parameters:[]}}function xl(e,t){var n=function(n){var a=t[n],r=a.parameter,s=a.value,i=r.split(" ").join(""),o=e.parameters.find(function(e){return e.name.toLowerCase()===r.toLowerCase()||e.name.toLowerCase()===i.toLowerCase()});if(void 0===o)return"continue";if(s.includes("%")){s=parseFloat(s.slice(0,s.indexOf("%")));var c=o.max-o.min;o.set(c*(s/100))}else s=parseFloat(s),o.set(s)};for(var a in t)n(a)}function Nl(e,t,n){var a=t in ra?ra[t](e):cs[t](e.getSelectedTrack()),r=(n=n.toLowerCase()).split(" ").join("");return a.parameters.map(function(e){return e.name}).filter(function(e){return e.toLowerCase().includes(n)||e.toLowerCase().includes(r)})}var ql=function(){function e(t){Object(o.a)(this,e),this.sequencerEngine=t,this.emacsScripting=new ml(this.sequencerEngine),this.viScripting=new Tl(this.sequencerEngine),this.cursor=t.cursor,this.clipboard=[],this.cmd={},this.stepFunctions={},this.stepTimes={},this.commandHistory=[],this.historyCounter=0,this.futureCalls=[]}return Object(c.a)(e,[{key:"viCommand",value:function(e){var t=void 0!==this.viScripting.currentCommand;return this.viScripting.run(e),t}},{key:"emacsCommand",value:function(e){this.emacsScripting.run(e)}},{key:"isEmacsCommand",value:function(){return"M-x"===this.sequencerEngine.state.commands.commandPrefix}},{key:"runScript",value:function(e){if(this.isEmacsCommand())return this.emacsScripting.run(e),!0;try{if(this.commandHistory.push({cursor:this.cursor.getJson(),command:e,enabled:!0}),e.startsWith("/"))this.search(e.slice(1));else if(e.startsWith("+"))this.addCommand(e.slice(1));else{if(e.startsWith(":"))return this.emacsScripting.run(e.slice(1));t=this,new Function("with(this) { "+e+"}").call(t)}return this.historyCounter=0,!0}catch(n){return void 0!==this.onFlashInfo&&this.onFlashInfo(n.message),!1}var t}},{key:"runEmacsCommand",value:function(e){}},{key:"search",value:function(e){var t=e.endsWith("/");t&&(e=e.slice(0,e.length-1));var n=e.split("+");this.sequencerEngine.searchForSounds(n,t)}},{key:"addCommand",value:function(e){!function(e,t){var n=e.getSelectedTrack();if(void 0!==n){var a=jl(t),r=a.effectName,s=a.parameters;if(r in ra){var i=ra[r](e);return n.effects.push(i),i.enable(!0),n.updateEffects(),console.log(i),n.showEffects(!0),e.store.dispatch(Object(w.Jc)(i.id)),void xl(i,s)}if(r in cs){var o=cs[r](n);n.midiEffects.addEffect(o),o.enabled=!0,n.showEffects(!0),e.store.dispatch(Object(w.Jc)(o.id)),xl(o,s)}}}(this.sequencerEngine,e)}},{key:"getJson",value:function(){return{commandHistory:this.commandHistory.filter(function(e){return e.enabled})}}},{key:"fromJson",value:function(e){for(var t=e.commandHistory,n=0;n<t.length;n++){var a=null;if("string"===typeof t[n])this.cursor.step=0,this.cursor.track=0,a=t[n];else if("cursor"in t[n]){var r=t[n].cursor;this.cursor.step=r.step,this.cursor.track=r.track,a=t[n].command}this.runScript(a)}}},{key:"recordMix",value:function(e){this.sequencerEngine.recordingMix=e}},{key:"slice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.sequencerEngine.getSelectedTrack().getSamplers()[0];return new hl(t,e)}},{key:"midiFX",value:function(){var e=this;this.sequencerEngine.getSelectedTrack(),this.sequencrerEngine.midiEffects;return function(){e.sequencerEngine.getSelectedTrack()}}},{key:"left",value:function(){this.sequencerEngine.left()}},{key:"right",value:function(){this.sequencerEngine.right()}},{key:"up",value:function(){this.sequencerEngine.up()}},{key:"down",value:function(){this.sequencerEngine.down()}},{key:"arp",value:function(e){this.sequencerEngine.getSelectedTrack().trackData.arpOn=e}},{key:"arpRate",value:function(e,t){this.sequencerEngine.getSelectedTrack()}},{key:"arpOctaves",value:function(e){this.sequencerEngine.getSelectedTrack().trackData.arpOctaves=e}},{key:"steps",value:function(e){var t=this.sequencerEngine.getSelectedTrack(),n=t.getStepsAtResolution(this.sequencerEngine.resolution);void 0===e&&(e=n.length),e+this.sequencerEngine.getSelectedStep()>=n.length&&(e-=e+this.sequencerEngine.getSelectedStep()-n.length);var a=this.sequencerEngine.getSelectedStep();return new Ml(this.sequencerEngine,t,n.slice(a,a+e),a)}},{key:"copy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.clipboard=this.steps(e).map(function(e){return e.getCopy()}),this.clipboard[0]}},{key:"paste",value:function(){for(var e=this.steps(this.clipboard.length).stepDataList,t=0;t<e.length;t++)e[t].copyFrom(this.clipboard[t]);this.sequencerEngine.getSelectedTrack().syncBuckets(this.sequencerEngine.resolution),this.sequencerEngine.getSelectedTrack().updateSteps()}},{key:"rand",value:function(){return Math.random()}},{key:"onStepReached",value:function(e){if(e in this.stepFunctions){try{this.stepFunctions[e].map(function(e){return e()})}catch(t){void 0!==this.onFlashInfo&&this.onFlashInfo(t.message)}this.stepTimes[e]++}}},{key:"stepFunction",value:function(e){var t=this,n=this.steps().get(0),a=(this.sequencerEngine.getSelectedTrack(),this.cursor.step),r=function(){e(n,t.stepTimes[a])};a in this.stepFunctions?this.stepFunctions[a].push(r):(this.stepFunctions[a]=[r],this.stepTimes[a]=0)}},{key:"volume",value:function(e){this.sequencerEngine.getSelectedTrack().setRawVolume(e)}},{key:"start",value:function(){this.cursor.step=0}},{key:"end",value:function(){var e=this.sequencerEngine.getTrackLength();this.cursor.setStep(e-1,this.sequencerEngine.resolution)}},{key:"line",value:function(e){var t=this;this.steps(e).map(function(){t.right()})}},{key:"clearStepFunctions",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=0;t<e;t++){var n=this.cursor.step+t;delete this.stepFunctions[n]}}},{key:"pattern",value:function(e){this.sequencerEngine.switchToPattern(e)}},{key:"clearSequence",value:function(){this.sequencerEngine.clearSequence()}},{key:"clear",value:function(){this.sequencerEngine.getSelectedTrack().pattern.clear()}},{key:"upHistory",value:function(){var e=this.commandHistory.length-this.historyCounter-1,t=this.commandHistory[e];return this.historyCounter=Math.min(this.historyCounter+1,this.commandHistory.length),void 0===t?"":t.command}},{key:"downHistory",value:function(){return this.historyCounter--,this.historyCounter<=0?(this.historyCounter=0,""):this.commandHistory[this.commandHistory.length-this.historyCounter].command}},{key:"deleteHistoryForTrack",value:function(e){for(var t=[],n=0;n<this.commandHistory.length;n++)this.commandHistory[n].cursor.track!=e&&t.push(this.commandHistory[n]);this.commandHistory=t}},{key:"map",value:function(e){this.sequencerEngine.stepNumberScript=e}},{key:"com",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){for(var n=e,a=t.length-1;a>=0;a--)n=t[a](n);return n}}},{key:"currentStep",get:function(){return this.sequencerEngine.trackStep}},{key:"phi",get:function(){return 1.61803398875}}]),e}();var Ml=function(e){function t(e,n,a,r){var s,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return Object(o.a)(this,t),(s=Object(u.a)(this,Object(l.a)(t).call(this,e))).stepDataList=a,s.step=r,s.stepOffset=i,s.track=n,s}return Object(h.a)(t,e),Object(c.a)(t,[{key:"filter",value:function(e){return new t(this.sequencerEngine,this.track,this.stepDataList.filter(e),this.step)}},{key:"isOn",value:function(){return this.filter(function(e){return e.on})}},{key:"sync",value:function(){this.sequencerEngine.getSelectedTrack().syncBuckets(this.sequencerEngine.resolution),this.track.updateSteps()}},{key:"get",value:function(e){return this.stepDataList[e]}},{key:"even",value:function(){for(var e=[],n=0;n<this.stepDataList.length;n+=2)e.push(this.stepDataList[n]);return new t(this.sequencerEngine,this.track,e,this.step,2*this.stepOffset)}},{key:"odd",value:function(){for(var e=[],n=1;n<this.stepDataList.length;n+=2)e.push(this.stepDataList[n]);var a=this.sequencerEngine.resolution.transformStepAtBaseResolution(1);return new t(this.sequencerEngine,this.track,e,this.step+a,2*this.stepOffset)}},{key:"stepFunction",value:function(e){var t=this;this.do(function(){return t.sequencerEngine.scripting.stepFunction(e)})}},{key:"do",value:function(e){var t=this.sequencerEngine.cursor,n=t.step,a=this.step;for(var r in this.stepDataList)t.step=a,e(),a+=this.sequencerEngine.resolution.transformStepAtBaseResolution(this.stepOffset);t.step=n}},{key:"map",value:function(e){var t=this.stepDataList.map(e);return this.sync(),t}},{key:"on",set:function(e){this.map(function(t,n){return t.on="function"===typeof e?e(n):e}),this.sync()},get:function(){return this.map(function(e){return e.on})}},{key:"duration",set:function(e){this.map(function(t,n){return t.duration="function"===typeof e?e(n):e}),this.sync()},get:function(){return this.map(function(e){return e.duration})}},{key:"chop",set:function(e){this.map(function(t,n){return t.chop="function"===typeof e?e(n):e}),this.sync()},get:function(){return this.map(function(e){return e.chop})}},{key:"velocity",set:function(e){this.map(function(t,n){return t.velocity="function"===typeof e?e(n):e}),this.sync()},get:function(){return this.map(function(e){return e.velocity})}},{key:"transpose",set:function(e){this.map(function(t,n){return t.transpose="function"===typeof e?e(n):e}),this.sync()},get:function(){return this.map(function(e){return e.transpose})}},{key:"attack",set:function(e){this.map(function(t,n){return t.transpose="function"===typeof e?e(n):e}),this.sync()},get:function(){return this.map(function(e){return e.attack})}},{key:"release",set:function(e){this.map(function(t,n){return t.transpose="function"===typeof e?e(n):e}),this.sync()},get:function(){return this.map(function(e){return e.release})}}]),t}(ql),Dl=ql,Al=function(){function e(t){Object(o.a)(this,e),this.store=t,this.auxEffects=new On(q.a.Master,this),this.idToSequencerEngine={},this.headSequencerEngine=void 0,this.sequencerEnginesToPlay=[],this.sequenceIdQueue=[],window.sequencerEngine=this,this.initAubio()}return Object(c.a)(e,[{key:"initAubio",value:function(){var e=this;window.Aubio().then(function(t){console.log("initialized aubio"),e.aubio=t})}},{key:"stop",value:function(){for(var e in this.idToSequencerEngine)this.idToSequencerEngine[e].stop()}},{key:"updateBpm",value:function(e){for(var t in this.idToSequencerEngine)this.idToSequencerEngine[t].updateBpm(e)}},{key:"getSequencerEngine",value:function(e){return this.idToSequencerEngine[e]}},{key:"stepOneCallback",value:function(e){e=q.a.Transport.getSecondsAtTime(e),this.sequencerEnginesToPlay.forEach(function(t){t.play(e)}),this.sequencerEnginesToPlay=[]}},{key:"getSequencesPlaying",value:function(e){var t=this.store.getState().sequencer.isPlaying;return Object.keys(this.idToSequencerEngine).filter(function(n){return!1===e&&void 0===t[n]||t[n]===e})}},{key:"unloadTrack",value:function(e){console.log("unloadTrack("+e+")");var t=this.idToSequencerEngine[e];t.playing&&t.stop(),delete this.idToSequencerEngine[e];var n=this.sequenceIdQueue.indexOf(e);n>-1&&this.sequenceIdQueue.splice(n,1),this.store.dispatch(Object(w.Hb)(e,void 0)),setTimeout(function(){t.dispose()},500)}},{key:"loadTrack",value:function(e){var t=this.getSequencesPlaying(!1);if(this.sequenceIdQueue.length>7)if(t.length>0)this.unloadTrack(t[0]);else{var n=this.sequenceIdQueue.shift();this.unloadTrack(n)}this.store.dispatch(Object(w.Tb)(e,!0));var a=new pl(this.store,!0,void 0,this.aubio);a.channelMixer.connectMixEffects();var r=new Dl(a,!0);a.setScripting(r),a.loadSequence(e),a.channelMixer.mixEffects.auxSend.connect(this.auxEffects.input),this.sequenceIdQueue.push(e),this.idToSequencerEngine[e]=a,this.store.dispatch(Object(w.Hb)(e,!1))}},{key:"play",value:function(e){var t=this,n=this.getSequencerEngine(e.id);if(void 0!==n){e.playing&&this.setHeadSequencerEngine(void 0);var a=this.getSequencesPlaying(!0);0==this.getSequencesPlaying(!0).length||n.playing?(this.store.dispatch(Object(w.Ib)(!0)),n.playing||0!=a.length||this.setHeadSequencerEngine(n),n.play()):this.sequencerEnginesToPlay.push(n),(a=a.map(function(e){return t.idToSequencerEngine[e]}).filter(function(e){return e!==n})).length>0&&a.every(function(e){return void 0===e.stepOneCallback})&&this.setHeadSequencerEngine(a[0])}}},{key:"setHeadSequencerEngine",value:function(e){var t=this;void 0!==e||void 0===this.headSequencerEngine?(this.headSequencerEngine=e,this.headSequencerEngine.stepOneCallback=function(e){return t.stepOneCallback(e)}):this.headSequencerEngine.stepOneCallback=void 0}},{key:"sampleRate",set:function(e){Je.setSampleRate(e)}}]),e}(),Rl=n(193),Il=n.n(Rl),Ll=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"lock-button-container"},r.a.createElement("img",{onMouseOver:function(t){return e.setContextualHelp(t,e.props.contextualHelp||"TRACK_LOCK_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.props.toggleLock()},className:"lock-button",src:this.props.patternLocked?"/closed-padlock.png":"/opened-padlock.png"}))}}]),t}(a.Component),Fl=Object(y.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(w.V)(t))}}})(Ll),Vl=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isToggled",value:function(){return void 0!==this.props.instrument?this.props.instrument.isParameterConnectedToLFO(this.props.parameter,this.props.lfo):this.props.parameter.isConnectedToLFO(this.props.lfo)}},{key:"toggle",value:function(){void 0!==this.props.instrument?this.props.instrument.toggleParameterWithLFO(this.props.parameter,this.props.lfo):(this.props.parameter.isAudioParamEnabled()||this.props.parameter.enableAudioParam(),this.isToggled()?this.props.parameter.disconnectFromLFO(this.props.lfo):(this.props.parameter.connectToLFO(this.props.lfo),this.props.setShowLFOs(!0),this.props.setSelectedLFO(this.props.lfo.number),window.location.hash="lfos")),this.setState(this.state)}},{key:"onMouseOver",value:function(e){e.stopPropagation(),console.log("on mouse over = LFO_TOGGLE_BUTTON"),this.props.setContextualHelp("LFO_TOGGLE_BUTTON")}},{key:"render",value:function(){var e=this,t=this.isToggled()?" toggled ":"",n=this.props.lfos.indexOf(this.props.lfo);return r.a.createElement("div",{onMouseOver:function(t){return e.onMouseOver(t)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.toggle()},className:"parameter-lfo-toggle lfo-"+n+t},n+1)}}]),t}(a.Component),Bl=Object(y.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(w.V)(t))},setSelectedLFO:function(t){return e(Object(w.Oc)(t))},setShowLFOs:function(t){return e(Object(w.pd)(t))}}})(Vl),Ul=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isToggled",value:function(){return this.props.parameter.isConnectedToEnvelope(this.props.envelope)}},{key:"toggle",value:function(){this.props.parameter.isAudioParamEnabled()||this.props.parameter.enableAudioParam(),this.isToggled()?this.props.parameter.disconnectFromEnvelope(this.props.envelope):(this.props.parameter.connectToEnvelope(this.props.envelope),this.props.setSelectedEnvelope(this.props.envelope.number),this.props.setShowEnvelopes(!0),window.location.hash="envelopes"),this.setState(this.state)}},{key:"onMouseOver",value:function(e){e.stopPropagation(),this.props.setContextualHelp("ENVELOPE_TOGGLE_BUTTON")}},{key:"render",value:function(){var e=this,t=this.isToggled()?" toggled ":"",n=this.props.envelopes.indexOf(this.props.envelope);return r.a.createElement("div",{onMouseOver:function(t){return e.onMouseOver(t)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.toggle()},className:"parameter-envelope-toggle lfo-"+n+t},n+1)}}]),t}(a.Component),Hl=Object(y.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(w.V)(t))},setSelectedEnvelope:function(t){return e(Object(w.Kc)(t))},setShowEnvelopes:function(t){return e(Object(w.md)(t))}}})(Ul),Jl=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={parameter:n.props.parameter,showModulators:!!n.props.parameter.isConnectedToAnyModulator&&n.props.parameter.isConnectedToAnyModulator(),editing:!1,value:n.props.value},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onEdit",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.stopPropagation(),t!==this.state.editing&&t&&this.setState({value:this.props.value}),this.setState({editing:t})}},{key:"shouldComponentUpdate",value:function(e){return this.state.parameter=e.parameter,e.parameter.isConnectedToAnyModulator&&(this.state.showModulators=e.parameter.isConnectedToAnyModulator()),e.value!==parseFloat(this.state.value)&&(this.state.value=e.value),!0}},{key:"onUpdateParameter",value:function(e){if("."===e)e=0;else if("-"===e)e=0;else if(""===e)e=0;else if(!Object($e.a)(e))return;if(e=parseFloat(e),this.props.midiMapMode===qs&&this.props.setParameterMidiMapSelection(this.props.parameter.id),this.props.isParameter?this.operationManager?this.operationManager.dispatch(Gi(this.state.parameter,e)):this.state.parameter.set(e):void 0===this.props.updateFunction?this.state.parameter.value=e:this.props.updateFunction(e),void 0!==this.props.automation){var t=this.props.automation.get(this.props.parameter);void 0===t?this.props.automation.set(this.props.parameter,new rt(this.props.effectNumber,this.props.parameter,e,this.props.automationContext)):t.value=e}this.setState(this.state),void 0!==this.props.onParameterChanged&&this.props.onParameterChanged(this.state.parameter,e)}},{key:"deleteAutomation",value:function(){this.props.automation.delete(this.props.parameter)}},{key:"hasAutomationSet",value:function(){return void 0!==this.props.automation&&void 0!==this.props.automation.get(this.props.parameter)}},{key:"getValue",value:function(){var e=void 0!==this.props.value?this.props.value:this.props.isParameter?this.props.parameter.get():this.props.getValue();if(void 0===this.props.automation)return e;var t=this.props.automation.get(this.props.parameter);return void 0===t?e:t.value}},{key:"getLFOs",value:function(){return void 0!==this.props.sequencerEngine?this.props.sequencerEngine.lfosTrack.lfos.map(function(e){return e.lfo}):this.props.lfoEnabled?this.props.lfos:[]}},{key:"onClickParameterName",value:function(){this.props.midiMapMode===qs?this.props.deleteParameterMidiMapping(this.props.parameter.id):void 0!==this.props.sequencerEngine&&this.setState({showModulators:!0})}},{key:"getEnvelopes",value:function(){return void 0===this.props.sequencerEngine?[]:this.props.sequencerEngine.envelopes}},{key:"onMouseOver",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"onTypedInputChanged",value:function(e){(Object($e.a)(e)||"."===e||""===e||"-"===e)&&(this.state.value=e,this.onUpdateParameter(e))}},{key:"onKeyPress",value:function(e){"Enter"===e.key&&this.setState({editing:!1})}},{key:"render",value:function(){var e=this,t=(this.getValue(),this.getLFOs()),n=this.getEnvelopes(),a=void 0!==this.props.customClassName?this.props.customClassName:"";a+=this.props.selectedParameter===this.props.parameter?" selected-parameter parameter-box":"parameter-box";var s=this.props.refined?.01:this.props.step;this.props.isMidiSelected&&this.props.midiMapMode===qs&&(a+=" midi-selected");var i=this.props.contextualHelp||"EFFECT_PARAMETER";return r.a.createElement("div",{className:a},r.a.createElement("div",{className:"parameter-label-container"},r.a.createElement("div",{className:"parameter-label effect-parameter-label"},r.a.createElement("div",{onClick:function(){return e.onClickParameterName()},onMouseOver:function(t){return e.onMouseOver(t,i)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"parameter-label-name"},this.props.name,": "),r.a.createElement(O,{condition:this.state.editing},r.a.createElement(A.h,{className:"tag-sound-input"},r.a.createElement(A.g,{value:this.state.value,onKeyUp:function(t){return e.onKeyPress(t)},onChange:function(t){return e.onTypedInputChanged(t.target.value)},placeholder:"Parameter",className:"parameter-input-box"}))),r.a.createElement(O,{condition:!this.state.editing},r.a.createElement("div",{onMouseOver:function(t){return e.onMouseOver(t,"PARAMETER_VALUE")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"parameter-label-value",onClick:function(t){return e.onEdit(t)}},this.displayValue)),r.a.createElement(O,{condition:this.hasAutomationSet()},r.a.createElement("div",{onClick:function(){return e.deleteAutomation()},className:"automation-label"},"AUTOMATION")))),r.a.createElement(O,{condition:this.props.lfoEnabled&&(void 0===this.props.sequencerEngine||this.state.showModulators)},r.a.createElement("div",{className:"lfo-boxes"},t.map(function(n,a){var s;return r.a.createElement(Bl,(s={parameter:e.props.parameter,lfo:n,lfos:t},Object(_e.a)(s,"parameter",e.props.parameter),Object(_e.a)(s,"instrument",e.props.instrument),s))}),n.map(function(t,a){var s;return r.a.createElement(Hl,(s={parameter:e.props.parameter,envelope:t,envelopes:n},Object(_e.a)(s,"parameter",e.props.parameter),Object(_e.a)(s,"instrument",e.props.instrument),s))}))),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(O,{condition:!this.props.hideSlider},r.a.createElement(fe.a,{value:parseFloat(this.props.value),change:function(t){return e.onUpdateParameter(t.target.value)},step:s,max:this.props.max,min:this.props.min,orientation:"horizontal",reversed:!1})))}},{key:"operationManager",get:function(){return this.props.sequencerEngine&&this.props.sequencerEngine.operationManager}},{key:"displayValue",get:function(){var e=this.props.unit||"";return(void 0===this.props.displayFunction?this.props.value:this.props.displayFunction(this.props.value))+" "+e}}]),t}(a.Component),Gl=Object(y.b)(function(e,t){var n=void 0!==t.value?t.value:t.isParameter&&void 0===t.automation?e.effects.effectParameters[t.parameter.id]:t.isParameter&&void 0!==t.automation.get(t.parameter)?t.automation.get(t.parameter).value:t.isParameter?t.parameter.get():t.getValue();return"object"===typeof n?n.toSeconds?n=n.toSeconds():n._val&&(n=new q.a.Time(n._val).toSeconds()):"string"===typeof n&&(n=new q.a.Time(n).toSeconds()),{value:n,isMidiSelected:t.parameter.id===e.midi.parameterSelected,midiMapMode:e.midi.midiMapMode}},function(e){return{setContextualHelp:function(t){return e(Object(w.V)(t))},setParameterMidiMapSelection:function(t){return e(Object(w.fc)(t))},deleteParameterMidiMapping:function(t){return e(Object(w.c)(t))}}})(Jl),zl=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"play",value:function(){this.props.sequencerEngine.schedulePlay()}},{key:"record",value:function(){var e=!this.props.isRecording;this.props.sequencerEngine.recording(e)}},{key:"resample",value:function(){this.props.sequencerEngine.masterResampler.prepare(),this.props.setResampleMaster(!0)}},{key:"toggleQuantize",value:function(){this.props.setQuantized(!this.props.quantized)}},{key:"onClickRollingMode",value:function(){this.props.sequencerEngine.trackRolling=!this.props.trackRolling}},{key:"updateBpm",value:function(e){var t=this;Object($e.a)(e)&&(e=parseFloat(e),this.props.sequencerEngine.updateBpm(e),this.setState(this.state),void 0!==this.timestretchTimeout&&clearTimeout(this.timestretchTimeout),this.timestretchTimeout=setTimeout(function(){t.props.sequencerEngine.tracks.map(function(t){return t.soundIds.map(function(n){var a=t.samplers[n];a.tempoSynced&&a.syncTempo(e)})}),t.timestretchTimeout=void 0},150))}},{key:"updateSwing",value:function(e){Object($e.a)(e)&&(this.props.sequencerEngine.updateSwing(e),this.setState(this.state))}},{key:"toggleLock",value:function(){this.props.sequencerEngine.togglePatternLock()}},{key:"render",value:function(){var e=this,t="play-button ";return this.props.playScheduled&&(t+=" flashit"),r.a.createElement("div",{className:"sequencer-buttons-container"},r.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("PLAY_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.play()},className:"action-buttons"},r.a.createElement("span",{className:t},this.props.isPlaying?"STOP":"PLAY")),r.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("RECORD_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"action-buttons",onClick:function(){return e.record()}},r.a.createElement("span",{className:this.props.isRecording?"recording record-button":"record-button"},this.props.isRecordingExpanded?"RECORDING +":this.props.isRecording?"RECORDING":"RECORD")),r.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("RECORD_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"action-buttons",onClick:function(){return e.resample()}},r.a.createElement("span",{className:this.props.isResampling?"recording record-button":"record-button"},this.props.isResampling?"RESAMPLING":"RESAMPLE")),r.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("ROLL_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"action-buttons",onClick:function(){return e.onClickRollingMode()}},r.a.createElement("span",{className:this.props.trackRolling?"infinity-mode infinity-button":"infinity-button"},"ROLL")),r.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("QUANTIZE_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"action-buttons",onClick:function(){return e.toggleQuantize()}},r.a.createElement("span",{className:this.props.quantized?"infinity-mode infinity-button":"infinity-button"},this.props.quantized?"QUANTIZED":"UNQUANTIZED")),this.props.sequencerEngine.bpmParameter?r.a.createElement("div",{className:"bpm-container"},r.a.createElement(Gl,{name:"BPM",contextualHelp:"BPM_SLIDER",parameter:this.props.sequencerEngine.bpmParameter,step:1,min:1,isParameter:!0,max:250})):"",r.a.createElement(Fl,{contextualHelp:"BPM_LOCK",patternLocked:this.props.patternLocked,toggleLock:function(){return e.toggleLock()}}))}}]),t}(a.Component),_l=Object(y.b)(function(e,t){var n=t.sequencerEngine.getSequenceId();return{viewMode:e.sequencer.viewMode,quantized:e.sequencer.quantized,isRecording:e.sequencer.isRecording,isRecordingExpanded:e.sequencer.isRecordingExpanded,isPlaying:e.sequencer.isPlaying[n]||!1,isCommandDown:e.keyboard.isCommandDown,sequenceName:e.sequencer.sequenceName,trackRolling:e.sequencer.trackRolling,patternLocked:e.sequencer.patternLocks[t.sequencerEngine.currentPattern]||!1,playScheduled:e.clock.playScheduled,commandPrefix:e.commands.commandPrefix,isResampling:e.tracks.isResampling||e.sequencer.resampleMaster}},function(e){return{setViewMode:function(t){return e(Object(w.ye)(t))},setQuantized:function(t){return e(Object(w.uc)(t))},setContextualHelp:function(t){return e(Object(w.V)(t))},setIsRecording:function(t){return e(Object(w.Jb)(t))},setTrackRolling:function(t){return e(Object(w.le)(t))},setCommandPrefix:function(t){return e(Object(w.R)(t))},setIsRecordingExpanded:function(t){return e(Object(w.Kb)(t))},setCommandInput:function(t){return e(Object(w.Q)(t))},setResampleMaster:function(t){return e(Object(w.wc)(t))}}})(zl),Wl=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"auto-complete-suggestions"},this.props.suggestions.map(function(e){return r.a.createElement("div",{className:"suggestion"},e)}))}}]),t}(a.Component),Kl=new U.a,Yl=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getTrack",value:function(e){return this.props.sequencerEngine.tracks[e]}},{key:"getSample",value:function(e){var t=this.getTrack(e);return void 0===t?void 0:t.sample}},{key:"isSample",value:function(e){return void 0!==this.getSample(e)}},{key:"isThumbnail",value:function(e){return this.isSample(e)&&""!==this.getSample(e).videoId&&void 0!==this.getSample(e).videoId}},{key:"getThumbnailURL",value:function(e){return this.getSample(e).getThumbnail()}},{key:"getStyle",value:function(){var e={};if(void 0!==this.props.keyMapping){var t=this.props.keyMapping;e.borderBottomColor=Kl.getColor(t.sliceNumber),e.borderBottomStyle="solid",e.borderBottomWidth="3px",this.isThumbnail(t.trackNumber)?(e.backgroundImage='url("'+this.getThumbnailURL(t.trackNumber)+'")',e.backgroundPosition="center",e.backgroundSize="cover"):this.isSample(t.trackNumber)&&(e.backgroundColor=this.getSample(t.trackNumber).color)}return e}},{key:"key",get:function(){return this.props.value.toLowerCase()}}]),t}(a.Component),Ql=(new U.a,function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickKey",value:function(){this.props.mini&&this.key in this.mappings?this.props.sequencerEngine.selectTrack(this.mappings[this.key].trackNumber):this.isSample(this.props.trackNumber)&&(this.props.keyboardEngine.hasKeyMapping(this.key)?this.props.keyboardEngine.deleteKeyMapping(this.key):this.props.keyboardEngine.map(this.key,this.props.trackNumber,this.props.selectedSlice))}},{key:"render",value:function(){var e=this,t=this.props.mini?"key mini":"key";return this.props.triggering&&(t+=" flashit"),r.a.createElement("div",{onClick:function(){return e.onClickKey()},style:this.getStyle(),className:t},this.props.value)}},{key:"mappings",get:function(){return void 0===this.props.keyboardEngine?{}:this.props.keyboardEngine.getMappings()}}]),t}(Yl)),Xl=Object(y.b)(function(e,t){var n=e.keyboard.keyMappings[t.keyboardKey],a=void 0===n?void 0:e.tracks.triggers[n.trackNumber];return{triggering:void 0!==a&&a[n.sliceNumber],keyMapping:n}},function(e,t){return{setContextualHelp:function(t){return e(Object(w.V)(t))}}})(Ql),Zl=[["Q","W","E","R","T","Y","U","I","O","P"],["A","S","D","F","G","H","J","K","L"],["Z","X","C","V","B","N","M"]],$l=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getKey",value:function(e){return e.toLowerCase()}},{key:"render",value:function(){var e=this,t=this.props.mini?"keyboard mini":"keyboard";return r.a.createElement("div",{className:t},r.a.createElement("div",{className:"keyboard-row"},Zl[0].map(function(t){return r.a.createElement(Xl,{key:t,mini:e.props.mini,selectedSlice:e.props.selectedSlice,keyboardKey:e.getKey(t),sequencerEngine:e.props.sequencerEngine,trackNumber:e.props.trackNumber,keyboardEngine:e.props.keyboardEngine,value:t})})),r.a.createElement("div",{className:"keyboard-row keyboard-row-2"},Zl[1].map(function(t){return r.a.createElement(Xl,{key:t,mini:e.props.mini,selectedSlice:e.props.selectedSlice,keyboardKey:e.getKey(t),sequencerEngine:e.props.sequencerEngine,trackNumber:e.props.trackNumber,keyboardEngine:e.props.keyboardEngine,value:t})})),r.a.createElement("div",{className:"keyboard-row keyboard-row-3"},Zl[2].map(function(t){return r.a.createElement(Xl,{key:t,mini:e.props.mini,selectedSlice:e.props.selectedSlice,keyboardKey:e.getKey(t),sequencerEngine:e.props.sequencerEngine,trackNumber:e.props.trackNumber,keyboardEngine:e.props.keyboardEngine,value:t})})))}}]),t}(a.Component),ep=(n(2325),function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getContextualHelp",value:function(){return this.props.contextualHelp?P[this.props.contextualHelp]:void 0!==this.props.sequencerEngine?r.a.createElement($l,{mini:!0,sequencerEngine:this.props.sequencerEngine,keyboardEngine:this.props.sequencerEngine.keyboardEngine}):""}},{key:"render",value:function(){var e=void 0===this.props.contextualHelp?"contextual-help empty":"contextual-help";return r.a.createElement("div",{className:e},this.getContextualHelp())}}]),t}(a.Component)),tp=Object(y.b)(function(e){return{contextualHelp:e.sequencer.contextualHelp}},null)(ep),np=(n(2326),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={focused:e.scriptingFocused,command:"",info:"",suggestions:[]},n.sequencerEngine=n.props.sequencerEngine,e.scripting.onFlashInfo=function(e){return n.onFlashInfo(e)},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){return this.state.focused!=e.scriptingFocused&&e.scriptingFocused&&this.input.focus(),this.state.focused=e.scriptingFocused,!0}},{key:"onFlashInfo",value:function(e){var t=this;this.setState({info:e}),setTimeout(function(){t.setState({info:""})},2e3)}},{key:"handleChange",value:function(e){""===e.target.value&&this.setState({suggestions:[]}),this.setState({command:e.target.value})}},{key:"onKeyPress",value:function(e){var t=this;if("Enter"===e.key)this.props.scripting.runScript(this.state.command)&&(this.props.update(),this.setState({running:!0}),setTimeout(function(){t.setState({running:!1}),t.setState({command:"",suggestions:[]}),t.input.blur()},100),this.props.setCommandPrefix(void 0));else if("ArrowUp"===e.key)this.setState({command:this.props.scripting.upHistory()});else if("ArrowDown"===e.key)this.setState({command:this.props.scripting.downHistory()});else if("Tab"===e.key)return e.preventDefault(),this.autoComplete(),!1}},{key:"autoComplete",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r,s,i,o,c,u,l,p,h,d,f;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("auto complete called"),!this.state.command.startsWith("/")){e.next=18;break}if(t=this.state.command.slice(1),n=this.terms,void 0!==(t=n[n.length-1])){e.next=7;break}return e.abrupt("return");case 7:if(1!==n.length){e.next=15;break}return e.next=10,this.props.sequencerEngine.searcher.freeTextSearch(t);case 10:a=e.sent,1===(r=a.TAG.map(function(e){return e.value})).length?(n[n.length-1]=r[0],this.setState({suggestions:[],command:"/"+n.join("+")})):(s=this.getLongestCommonPrefix(r),this.setState({suggestions:r}),s&&this.setState({command:"/"+s})),e.next=16;break;case 15:n.length>1&&this.searchForTags(n);case 16:e.next=19;break;case 18:this.state.command.startsWith("+")&&(i=jl(this.state.command.slice(1)),o=i.effectName,c=i.parameters,this.state.command.includes("[")?(p=0===c.length?"":""===c[c.length-1].value?c[c.length-1].parameter:"",1===(h=Nl(this.props.sequencerEngine,o,p)).length?(d="+"+o+"[",f=c.slice(0,c.length-1),d+=f.map(function(e){return e.parameter+"="+e.value}).join(" "),f.length>0&&(d+=" "),d+=h[0],this.setState({suggestions:[],command:d})):this.setState({suggestions:h})):(u=Object.keys(ra).filter(function(e){return e.toLowerCase().startsWith(o.toLowerCase())}),l=Object.keys(cs).filter(function(e){return e.toLowerCase().startsWith(o.toLowerCase())}),1===(u=[].concat(Object(ge.a)(u),Object(ge.a)(l))).length?this.setState({command:"+"+u[0]}):u.length>1&&this.setState({suggestions:u})));case 19:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"searchForTags",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r,s,i;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.slice(0,t.length-1),a=t[t.length-1],(r=this.props.sequencerEngine.searcher).selectedTags=n,e.next=6,r.getTopTags();case 6:if(s=e.sent,r.selectedTags=[],1!==(s=s.map(function(e){return e.value}).filter(function(e){return e.toLowerCase().includes(a.toLowerCase())})).length){e.next=12;break}return this.setState({command:"/"+n.join("+")+"+"+s[0],suggestions:[]}),e.abrupt("return");case 12:if(this.setState({suggestions:s}),""!==n){e.next=15;break}return e.abrupt("return");case 15:(i=this.getLongestCommonPrefix(s))&&this.setState({command:"/"+n.join("+")+"+"+i});case 17:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getLongestCommonPrefix",value:function(e){var t=void 0;for(var n in e)if(void 0===t)t=e[n];else if(void 0===(t=this.getCommonPrefix(e[n],t)))return;return t}},{key:"getCommonPrefix",value:function(e,t){for(var n="",a=0;a<Math.min(e.length,t.length)&&e[a]===t[a];a++)n+=e[a];return""===n?void 0:n}},{key:"setInput",value:function(e){this.input=e,this.props.onSetInput(e),this.props.setCommandInput(e)}},{key:"render",value:function(){var e=this,t="script-input";return this.state.running&&(t+=" running"),r.a.createElement(Il.a,{className:"sticky-script-container",mode:"bottom",boundaryElement:".scroll-area",hideOnBoundaryHit:!1,bottomOffset:100},r.a.createElement("div",{className:"bottom-toolbar"},r.a.createElement("div",{className:"bottom-toolbar-left"},r.a.createElement(O,{condition:this.state.suggestions.length>0},r.a.createElement(Wl,{suggestions:this.state.suggestions})),r.a.createElement(O,{condition:0===this.state.suggestions.length},r.a.createElement(_l,{sequencerEngine:this.props.sequencerEngine})),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement("div",{className:"bar"}),r.a.createElement("div",{className:"script-container"},r.a.createElement("div",{className:"command-label"},r.a.createElement(O,{condition:void 0!==this.props.commandPrefix},this.props.commandPrefix),r.a.createElement(O,{condition:void 0===this.props.commandPrefix},">")),r.a.createElement("div",{className:"command-container"},""!==this.state.info?r.a.createElement("div",{className:"error-message"},this.state.info," "):r.a.createElement("input",{value:this.state.command,onChange:function(t){return e.handleChange(t)},onKeyDown:function(t){return e.onKeyPress(t)},ref:function(t){e.setInput(t)},className:t,type:"text"})),r.a.createElement("div",{className:"sequence-name-container"},void 0!==this.props.sequenceName?this.props.sequenceName:""),r.a.createElement("div",{className:"history-button",onClick:function(){return e.props.setViewMode("SCRIPTING_VIEW")}},"..."))),r.a.createElement(tp,{sequencerEngine:this.props.sequencerEngine})))}},{key:"terms",get:function(){return this.state.command.slice(1).split("+")}}]),t}(a.Component)),ap=Object(y.b)(function(e,t){var n=e.sequencer.sequencerEngine.getSequenceId();return{sequencerEngine:e.sequencer.sequencerEngine,viewMode:e.sequencer.viewMode,quantized:e.sequencer.quantized,isRecording:e.sequencer.isRecording,isRecordingExpanded:e.sequencer.isRecordingExpanded,isPlaying:e.sequencer.isPlaying[n]||!1,isCommandDown:e.keyboard.isCommandDown,sequenceName:e.sequencer.sequenceName,trackRolling:e.sequencer.trackRolling,patternLocked:e.sequencer.patternLocks[t.sequencerEngine.currentPattern]||!1,playScheduled:e.clock.playScheduled,commandPrefix:e.commands.commandPrefix}},function(e){return{setViewMode:function(t){return e(Object(w.ye)(t))},setQuantized:function(t){return e(Object(w.uc)(t))},setContextualHelp:function(t){return e(Object(w.V)(t))},setIsRecording:function(t){return e(Object(w.Jb)(t))},setTrackRolling:function(t){return e(Object(w.le)(t))},setCommandPrefix:function(t){return e(Object(w.R)(t))},setIsRecordingExpanded:function(t){return e(Object(w.Kb)(t))},setCommandInput:function(t){return e(Object(w.Q)(t))}}})(np),rp=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickCommand",value:function(e){this.props.scripting.commandHistory[e].enabled=!this.props.scripting.commandHistory[e].enabled,console.log(this.props.scripting.commandHistory[e]),this.setState(this.state)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",{className:"header"},"Scripting History"),r.a.createElement("div",{className:"back-button",onClick:function(){return e.props.setViewMode(lo)}},"Back"),this.props.scripting.commandHistory.map(function(t,n){return r.a.createElement(sp,{cmd:t,onClick:function(){return e.onClickCommand(n)}})}))}}]),t}(a.Component),sp=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{onClick:this.props.onClick,className:this.props.cmd.enabled?"command":"disabled-command command"},this.props.cmd.command," - track: ",this.props.cmd.cursor.track," - step: ",this.props.cmd.cursor.step)}}]),t}(a.Component),ip=Object(y.b)(null,function(e){return{setViewMode:function(t){return e(Object(w.ye)(t))}}})(rp),op=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={minValue:n.min,maxValue:n.max},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onChangeMin",value:function(e){(Object($e.a)(e)||"."===e||""===e||"-"===e)&&(this.setState({minValue:e}),Object($e.a)(e)?(console.log("returning because = "+e),this.mod.min=e):"."!==e&&""!==e&&"-"!==e||(this.mod.min=0))}},{key:"onChangeMax",value:function(e){Object($e.a)(e)||"."===e||""===e||"-"===e?(this.setState({maxValue:e}),Object($e.a)(e)?this.mod.max=e:"."!==e&&""!==e&&"-"!==e||(this.mod.max=0)):console.log("returning because = "+e)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"parameter-mod"},r.a.createElement("div",{className:"parameter-mod-pieces"},r.a.createElement("div",{className:"parameter-mod-modulator"},this.mod.type," ",this.mod.modulator.number," "),r.a.createElement("div",{className:"parameter-mod-text"},"mod"),r.a.createElement("div",{className:"parameter-mod-parameter"},this.parameter.name," ")),r.a.createElement("div",{className:"parameter-mod-min"},"Min:",r.a.createElement(cp,{placeholder:"Min",onChange:function(t){return e.onChangeMin(t)},number:this.state.minValue})),r.a.createElement("div",{className:"parameter-mod-max"},"Max:",r.a.createElement(cp,{placeholder:"Max",onChange:function(t){return e.onChangeMax(t)},number:this.state.maxValue})))}},{key:"parameter",get:function(){return this.props.parameterMod.parameter}},{key:"mod",get:function(){return this.props.parameterMod}},{key:"min",get:function(){return this.mod.scale.min}},{key:"max",get:function(){return this.mod.scale.max}}]),t}(a.Component),cp=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"number-input-container"},r.a.createElement(A.g,Object(_e.a)({onChange:function(t){return e.props.onChange(t.target.value)},value:this.props.number,className:"search-input",placeholder:this.props.placeholder},"className","number-input")))}}]),t}(a.Component),up=op,lp=n(29),pp=n.n(lp),hp=(a.Component,function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={option:void 0},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onChooseParameter",value:function(e){this.setState({option:e})}},{key:"render",value:function(){var e=this;return r.a.createElement(pp.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.options,onChange:function(t){return e.onChooseParameter(t)},value:this.state.option,placeholder:"Parameter"})}},{key:"options",get:function(){return this.props.parameters.map(function(e){return{value:e,label:e.name}})}}]),t}(a.Component)),dp=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,this.parameterMods.map(function(e,t){return r.a.createElement(up,{key:"mod-"+t+"-"+e.parameter.id,parameterMod:e})}))}},{key:"parameterMods",get:function(){var e=[];return this.props.parameters.forEach(function(t){return e=e.concat(t.parameterMods)}),e}}]),t}(a.Component),fp=(n(2327),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={showMods:!1,isCollapsed:e.isMixCollapsed||e.isCollapsed,isDraggable:!0},n.onClickMods=n.onClickMods.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onMouseEnter",value:function(){}},{key:"onMouseLeave",value:function(){}},{key:"shouldComponentUpdate",value:function(e){return e.isCollapsed!==this.props.isCollapsed&&(this.state.isCollapsed=e.isCollapsed),!0}},{key:"toggleCollapsed",value:function(){this.props.effect.isEnabled()&&this.props.setEffectCollapsed(this.props.effect.id,!this.state.isCollapsed)}},{key:"onClickMods",value:function(){this.setState({showMods:!this.state.showMods})}},{key:"deleteEffect",value:function(){var e,t,n,a;this.operationManager.dispatch((e=this.props.effect,t=this.props.track,n=this.props.group,a=this.props.send,{type:"DELETE_EFFECT",payload:{effect:e,track:t,group:n,send:a}})),this.props.onDeleteEffect()}},{key:"handleToggle",value:function(){this.operationManager.dispatch(Hi(this.props.effect,this.props.track,this.props.group,this.props.send)),this.props.onToggle()}},{key:"getTrackOrGroup",value:function(){return this.props.send||this.props.track||this.props.group}},{key:"getContextNumber",value:function(){return void 0!==this.props.track?this.props.track.trackNumber:void 0!==this.props.group?this.props.group.groupNumber:1}},{key:"onDragStart",value:function(e){if(!this.props.automation&&this.getTrackOrGroup()){var t=this.getTrackOrGroup().getEffectNumber(this.props.effect,this.props.isMidiEffect);this.props.isMidiEffect?this.props.dragMidiEffect({number:this.getContextNumber(),effectNumber:t}):this.props.dragEffect({number:this.getContextNumber(),effectNumber:t})}}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"onDrop",value:function(e){if(!this.props.automation&&this.getTrackOrGroup()){if(void 0!==this.props.effectDragging){var t=this.getTrackOrGroup().getEffectNumber(this.props.effect,this.props.isMidiEffect);if(this.props.isMidiEffect)return void this.props.dragEffect(void 0);this.props.effectDragging.number===this.getContextNumber()&&this.operationManager.dispatch(Ji(this.props.effectDragging.effectNumber,t,!1,this.props.track,this.props.group,this.props.send)),this.props.dragEffect(void 0)}else{if(void 0===this.props.midiEffectDragging)return;var n=this.getTrackOrGroup().getEffectNumber(this.props.effect,this.props.isMidiEffect);this.props.isMidiEffect&&this.props.midiEffectDragging.number===this.getContextNumber()&&this.operationManager.dispatch(Ji(this.props.midiEffectDragging.effectNumber,n,!0,this.props.track,this.props.group,this.props.send)),this.props.dragMidiEffect(void 0),this.props.dragEffect(void 0)}this.props.onDeleteEffect()}}},{key:"getClassName",value:function(e){return this.props.effect.isEnabled()?e:e+" disabled"}},{key:"selectEffect",value:function(e){e.stopPropagation(),this.props.setSelectedEffect(this.props.effect.id),this.props.track&&(this.props.track.sequencerEngine.selectedEffect=this.props.effect)}},{key:"render",value:function(){var e=this,t=this.props.isTall?"tall-effect effect":"effect";this.props.effectClass&&(t+=" "+this.props.effectClass);var n=void 0!==this.props.automation?"enabled "+t+" effect-automation":this.props.effect.isEnabled()?t+" enabled":"effect disabled";return this.state.isCollapsed&&(n+=" collapsed"),this.props.isSelected&&(n+=" selected"),this.props.isMidiEffect&&(n+=" midi"),r.a.createElement("div",{onClick:function(t){return e.selectEffect(t)},onMouseEnter:function(t){return e.onMouseEnter(t)},onMouseLeave:function(t){return e.onMouseLeave(t)},onDragStart:function(t){return e.onDragStart(t)},onDragOver:function(t){return e.onDragOver(t)},onDrop:function(t){e.onDrop(t)},draggable:this.state.isDraggable,className:n},r.a.createElement("div",{className:"effect-header"},r.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"EFFECT_TOGGLE_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.handleToggle()},className:"effect-toggle"},r.a.createElement("div",{className:"toggle-icon"})),r.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"EFFECT_COLLAPSE_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.toggleCollapsed()},className:"collapse-toggle"},r.a.createElement(O,{condition:this.state.isCollapsed},r.a.createElement("div",{className:"arrow-down"})),r.a.createElement(O,{condition:!this.state.isCollapsed},r.a.createElement("div",{className:"arrow-right"}))),r.a.createElement(O,{condition:this.props.effect.isEnabled()&&!this.state.isCollapsed},r.a.createElement("div",{className:"effect-name"},this.props.effect.name)),r.a.createElement(O,{condition:this.props.effect.isEnabled()&&!this.state.isCollapsed},r.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"PARAMETER_MODS_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:this.onClickMods,className:"mods-button small-button"},this.state.showMods?"Back":"Mods")),r.a.createElement(O,{condition:void 0===this.props.automation&&!this.state.isCollapsed},r.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"EFFECT_DELETE_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"delete-button",onClick:function(){return e.deleteEffect()}},"x"))),r.a.createElement("div",{className:"inner-effect"},r.a.createElement(O,{condition:!this.props.effect.isEnabled()||this.state.isCollapsed},r.a.createElement("div",{className:"effect-name"},this.props.effect.name)),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(O,{condition:this.state.showMods},r.a.createElement(dp,{parameters:this.props.effect.parameters})),r.a.createElement(O,{condition:!this.state.showMods&&!this.state.isCollapsed},this.props.children),r.a.createElement("div",{className:"clear-fix"})))}},{key:"operationManager",get:function(){return this.props.sequencerEngine.operationManager}}]),t}(a.Component)),mp=Object(y.b)(function(e,t){return{effectDragging:e.sequencer.effectDragging,midiEffectDragging:e.effects.midiEffectDragging,isCollapsed:e.effects.effectCollapsed[t.effect.id],isSelected:e.effects.selectedEffect===t.effect.id,isEnabled:t.effect.isEnabled()}},function(e,t){return{setContextualHelp:function(t){return e(Object(w.V)(t))},dragEffect:function(t){return e(Object(w.d)(t))},dragMidiEffect:function(t){return e(Object(w.Wb)(t))},setEffectCollapsed:function(t,n){return e(Object(w.kb)(t,n))},setSelectedEffect:function(t){return e(Object(w.Jc)(t))}}})(fp),vp=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"hasAutomationSet",value:function(){return void 0!==this.props.automation&&void 0!==this.props.automation.get(this.props.parameter)}},{key:"deleteAutomation",value:function(){this.props.automation.delete(this.props.parameter)}},{key:"render",value:function(){var e=this;bp(this.props.value);return r.a.createElement("div",{className:"lfo-rate-dropdown"},this.props.hideLabel?"":r.a.createElement("div",{className:"lfo-rate-label"},"Rate:"),r.a.createElement(pp.a,{className:"osc-type-dropdown float-left",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:gp,onChange:function(t){return e.props.onChange(t.value)},value:bp(this.props.value),placeholder:"Rate"}),r.a.createElement(O,{condition:this.hasAutomationSet()},r.a.createElement("div",{onClick:function(){return e.deleteAutomation()},className:"automation-label float-right"},"AUTOMATION")),r.a.createElement("div",{className:"clear-fix"}))}}]),t}(a.Component),gp=[{value:new ht(4,!1),label:"1/4"},{value:new ht(4,!0),label:"1/4t"},{value:new ht(8,!1),label:"1/8"},{value:new ht(8,!0),label:"1/8t"},{value:new ht(16,!1),label:"1/16"},{value:new ht(16,!0),label:"1/16t"},{value:new ht(32,!1),label:"1/32"},{value:new ht(32,!0),label:"1/32t"}];function bp(e){for(var t=0;t<gp.length;t++)if(gp[t].value.resolution==e.resolution&&gp[t].value.isTriplet==e.isTriplet)return gp[t];return null}var yp=Object(y.b)(function(e,t){return{value:void 0===t.automation||void 0===t.automation.get(t.parameter)?e.effects.effectParameters[t.parameter.id]:t.automation.get(t.parameter).value}},void 0)(vp),kp=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={effect:e.effect},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"handleOptionChange",value:function(e){this.setState(this.state)}},{key:"handleParameterChange",value:function(e,t){if(this.props.automation){var n=this.props.automation.get(e);void 0===n?this.props.automation.set(this.props.parameter,new rt(this.props.effectNumber,e,t)):n.value=t}else this.props.sequencerEngine.operationManager.dispatch(Gi(e,t))}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"getParameter",value:function(e){var t=e.get();if(this.props.automation){var n=this.props.automation.get(e);if(void 0!==n)return n.value}return t}},{key:"render",value:function(){var e,t=this;return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement(yp,{automation:this.props.automation,onChange:function(e){return t.handleParameterChange(t.state.effect.arpRateParameter,e)},parameter:this.state.effect.arpRateParameter}),r.a.createElement("div",{className:"lfo-rate-dropdown"},r.a.createElement("div",{className:"lfo-rate-label"},"Direction:"),r.a.createElement(pp.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:Ep,onChange:function(e){return t.handleParameterChange(t.state.effect.arpDirectionParameter,e.value)},value:(e=this.getParameter(this.state.effect.arpDirectionParameter),Ep.filter(function(t){return t.value===e})[0]),placeholder:"Direction"}),r.a.createElement("div",{className:"clear-fix"})),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Octaves",parameter:this.state.effect.arpOctavesParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:0,max:6}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Repeats",parameter:this.state.effect.arpRepeatParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:1,max:8}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Duration Factor",parameter:this.state.effect.arpDurationFactorParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.1,min:.1,max:8})):"")}}]),t}(a.Component),Ep=[{value:Rr,label:"Down"},{value:Ir,label:"Up"}];var Sp=Object(y.b)(function(e,t){return{arpDirection:t.effect.arpDirectionParameter.get()}},null)(kp),Op=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"getParameterOptions",value:function(){return this.props.effect.getAvailableParameters().map(function(e){return{label:e.name,value:e}})}},{key:"getParameterOption",value:function(e){if(void 0!==e){var t=this.getParameterOptions().filter(function(t){return t.value===e});return t.length>0?t[0]:void 0}}},{key:"handleParameterChange",value:function(e){this.props.effect.parameter=e.value,this.setState(this.state)}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(O,{condition:this.isEnabled()},r.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"PARAMETERIZER_DROPDOWN")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"parameter-dropdown-container"},r.a.createElement("div",{className:"lfo-rate-label"},"Parameter:"),r.a.createElement(pp.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.getParameterOptions(),onChange:function(t){return e.handleParameterChange(t)},value:this.getParameterOption(this.props.effect.parameter),placeholder:"Parameter"})),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,contextualHelp:"PARAMETERIZER_FACTOR",name:"Factor",automation:this.props.automation,parameter:this.props.effect.factorParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.01,min:.01,max:8}),r.a.createElement(Gl,{contextualHelp:"PARAMETERIZER_OFFSET",effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Offset",parameter:this.props.effect.offsetParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.1,min:-12,max:12}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Probability",contextualHelp:"PROBABILITY",automation:this.props.automation,parameter:this.props.effect.probabilityParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:0,max:100})))}}]),t}(a.Component),wp=Object(y.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(w.V)(t))}}})(Op),Cp=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"handleResolutionChange",value:function(e){this.props.effect.resolution=e.value,this.setState(this.state)}},{key:"render",value:function(){var e,t=this;return r.a.createElement("div",null,r.a.createElement(O,{condition:this.isEnabled()},r.a.createElement("div",{className:"lfo-rate-dropdown"},r.a.createElement("div",{className:"lfo-rate-label"},"Resolution:"),r.a.createElement(pp.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:Pp,onChange:function(e){return t.handleResolutionChange(e)},value:(e=this.props.effect.resolution,Pp.filter(function(t){return t.value===e})[0]),placeholder:"Rate"}),r.a.createElement("div",{className:"clear-fix"})),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Odd Timing Offset",parameter:this.props.effect.evenOffsetParameter,onParameterChanged:this.props.onParameterChanged,automation:this.props.automation,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.01,min:-.5,max:4}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Even Timing Offset",parameter:this.props.effect.oddOffsetParameter,automation:this.props.automation,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.01,min:-.5,max:4}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Probability",parameter:this.props.effect.probabilityParameter,automation:this.props.automation,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:0,max:100})))}}]),t}(a.Component),Pp=[{value:32,label:"1"},{value:16,label:"1/2"},{value:8,label:"1/4"},{value:4,label:"1/8"},{value:2,label:"1/16"},{value:1,label:"1/32"}];var Tp=Cp,jp=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"onChangeResolution",value:function(e){this.props.sequencerEngine.operationManager.dispatch(Gi(this.props.effect.resolutionParameter,e))}},{key:"onChangeSliceRetrigger",value:function(e){document.activeElement.blur(),this.props.effect.sliceRetrigger=!this.props.effect.sliceRetrigger,this.setState(this.state)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(O,{condition:this.isEnabled()},r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(yp,{automation:this.props.automation,parameter:this.props.effect.resolutionParameter,onChange:function(t){return e.onChangeResolution(t)}}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Warp Speed",parameter:this.props.effect.warpLengthParameter,automation:this.props.automation,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.01,min:.01,max:16}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Warp Factor",parameter:this.props.effect.warpFactorParameter,onParameterChanged:this.props.onParameterChanged,automation:this.props.automation,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:1,max:8}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Loop Length",automation:this.props.automation,parameter:this.props.effect.loopLengthParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,unit:"%",step:.1,min:.1,max:100}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Grain Size",automation:this.props.automation,parameter:this.props.effect.durationFactorParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.01,min:.01,max:2}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Smoothness",parameter:this.props.effect.smoothnessParameter,automation:this.props.automation,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.1,min:1,max:20}),r.a.createElement("div",{className:"refined-checkbox-preferences"},r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",value:"reversed",checked:this.props.effect.sliceRetrigger,onChange:function(t){return e.onChangeSliceRetrigger(t.target.value)}}),"Slice Retrigger"))))}}]),t}(a.Component),xp=Object(y.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(w.V)(t))}}})(jp),Np=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={value:n.props.effect.cycleString},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){return e.cycle!==this.props.cycle&&(this.state.value=rs(e.cycle),console.log("cycle changed =",this.state.value)),!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"onEditCycle",value:function(e){this.setState({value:e})}},{key:"preventDragging",value:function(e,t){e.target.parentNode.parentNode.parentNode.parentNode.setAttribute("draggable",t)}},{key:"onKeyDown",value:function(e){"Enter"===e.key&&this.submit()}},{key:"submit",value:function(){var e=this,t=function(e){e=" "+e+" ";for(var t=[],n=[t],a={cycle:void 0,transpose:"",operand:"",operator:void 0},r=0;r<e.length;r++){var s=e.charAt(r);switch(s){case"*":""===a.transpose&&(a.cycle=t.pop()),a.operator="*";break;case"/":""===a.transpose&&(a.cycle=t.pop()),a.operator="/";break;case"~":a.transpose=null;break;case" ":as(a,t),a={cycle:void 0,transpose:"",operand:"",operator:void 0};break;case"[":as(a,t),t=[],n.push(t),a={cycle:void 0,transpose:"",operand:"",operator:void 0};break;case"]":as(a,t);var i=n.pop();(t=n[n.length-1]||[]).push(i),a={cycle:void 0,transpose:"",operand:"",operator:void 0};break;default:a.operator?a.operand+=s:a.transpose+=s}}return n[0]}(this.state.value);t&&t.length>0?(console.log("cycle =",t),this.props.sequencerEngine.operationManager.dispatch(Gi(this.props.effect.cycleParameter,t))):(this.setState({showError:!0}),setTimeout(function(){e.setState({showError:!1})},1e3))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(O,{condition:this.isEnabled()},r.a.createElement("div",{className:"tidal-component"},r.a.createElement(A.g,{value:this.state.value,onKeyDown:function(t){return e.onKeyDown(t)},onMouseDown:function(t){e.preventDragging(t,!1)},onMouseUp:function(t){e.preventDragging(t,!0),t.target.parentNode.parentNode.parentNode.parentNode.setAttribute("draggable",!0)},onChange:function(t){return e.onEditCycle(t.target.value)},placeholder:"Output Note",className:"tidal-input"}),r.a.createElement("div",{className:"enter-button",onClick:function(){return e.submit()}},"Enter")),r.a.createElement(O,{condition:this.state.showError},r.a.createElement("div",{className:"error-box"},"Syntax Error")),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Cycle Length",parameter:this.props.effect.cycleLengthParameter,automation:this.props.automation,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:4,max:64}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Duration Factor",parameter:this.props.effect.durationFactorParameter,automation:this.props.automation,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.01,min:0,max:4})))}}]),t}(a.Component),qp=Object(y.b)(function(e,t){return{cycle:t.effect.cycle}},null)(Np),Mp=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"getParameterOptions",value:function(){return this.props.sequencerEngine.tracks.map(function(e){return{label:e.trackNumber+1,value:e}})}},{key:"getParameterOption",value:function(e){if(void 0!==e){e=this.props.sequencerEngine.tracks[e];var t=this.getParameterOptions().filter(function(t){return t.value===e});return t.length>0?t[0]:void 0}}},{key:"handleParameterChange",value:function(e){this.props.effect.trackOutput=e.value.trackNumber,this.setState(this.state)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(O,{condition:this.isEnabled()},r.a.createElement("div",{className:"parameter-dropdown-container"},r.a.createElement("div",{className:"lfo-rate-label"},"Track:"),r.a.createElement(pp.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.getParameterOptions(),onChange:function(t){return e.handleParameterChange(t)},value:this.getParameterOption(this.props.effect.trackOutput),placeholder:"Output"})),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Probability",parameter:this.props.effect.probabilityParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:0,max:100})))}}]),t}(a.Component),Dp=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"render",value:function(){var e=this.props.effect.ccParameters;return r.a.createElement("div",null,r.a.createElement("div",{className:"external-instrument-name"},this.props.effect.midiOutput.name),r.a.createElement("div",{className:"midi-interface-effect"},r.a.createElement(O,{condition:this.isEnabled()},e.map(function(e){return r.a.createElement("div",{className:"instrument-section"},Object.keys(e).map(function(t){return r.a.createElement(Ap,{section:e[t],sectionName:t})}))}))))}}]),t}(a.Component),Ap=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"external-instrument-subsection"},r.a.createElement("div",{className:"instrument-subsection-name"},this.props.sectionName),r.a.createElement("div",{className:"clear-fix"}),Object.keys(this.props.section).map(function(t){return r.a.createElement(Gl,{effectNumber:e.props.effectNumber,name:t,parameter:e.props.section[t],onParameterChanged:e.props.onParameterChanged,isParameter:!0,step:1,min:0,max:127})}))}}]),t}(a.Component),Rp=Dp,Ip=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"getParameterOptions",value:function(){return this.props.effect.getAvailableParameters().map(function(e){return{label:e.name,value:e}})}},{key:"getParameterOption",value:function(e){if(void 0!==e){var t=this.getParameterOptions().filter(function(t){return t.value===e});return t.length>0?t[0]:void 0}}},{key:"handleParameterChange",value:function(e){this.props.effect.parameter=e.value,this.setState(this.state)}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(O,{condition:this.isEnabled()},r.a.createElement(Gl,{effectNumber:this.props.effectNumber,contextualHelp:"PARAMETERIZER_FACTOR",name:"Pitch",parameter:this.props.effect.pitchParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.1,min:-32,max:32}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,contextualHelp:"PARAMETERIZER_FACTOR",name:"Velocity",parameter:this.props.effect.velocityParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.01,min:0,max:1}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,contextualHelp:"PARAMETERIZER_FACTOR",name:"Timing Offset",parameter:this.props.effect.timingOffsetParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.01,min:0,max:4}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Probability",contextualHelp:"PROBABILITY",parameter:this.props.effect.probabilityParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:0,max:100})))}}]),t}(a.Component),Lp=Object(y.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(w.V)(t))}}})(Ip),Fp=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"render",value:function(){var e=this;return console.log("last note played = "+this.props.lastNotePlayed),r.a.createElement("div",null,r.a.createElement(O,{condition:this.isEnabled()},[0,1,2,3,4,5,6,7,8,9,10,11].map(function(t){return r.a.createElement(Vp,{isLastNote:e.props.lastNotePlayed===t,input:t,effect:e.props.effect})})))}}]),t}(a.Component),Vp=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getOutput",value:function(){return this.props.effect.tuningMappings[this.props.input]}},{key:"onUpdateOutput",value:function(e){try{e=parseFloat(e),this.props.effect.tuningMappings[this.props.input]=e}catch(t){console.log("error")}this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.props.isLastNote?"note-mapping highlighted":"note-mapping";return r.a.createElement("div",{className:t},r.a.createElement("label",{className:"input-note"},this.props.input,":"),r.a.createElement(A.g,{value:this.getOutput(),onChange:function(t){return e.onUpdateOutput(t.target.value)},placeholder:"Output Note",className:"note-mapping-output"}))}}]),t}(a.Component),Bp=Object(y.b)(function(e,t){return{lastNotePlayed:e.keyboard.lastNotePlayed}},function(e,t){return{setContextualHelp:function(t){return e(Object(w.V)(t))}}})(Fp),Up=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,name:"Wet",parameter:this.props.effect.wetParameter,lfoEnabled:!0,onParameterChanged:this.props.onParameterChanged,isParameter:!0,displayFunction:function(e){return Math.floor(100*e)},unit:"%",step:.01,max:1,min:0})}}]),t}(a.Component),Hp=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(O,{condition:this.isEnabled()},r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Steps Delay",parameter:this.props.effect.delayTimeParameter,automation:this.props.automation,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:1,max:64}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Repeats",parameter:this.props.effect.repeatsParameter,automation:this.props.automation,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:1,max:32}),r.a.createElement(Up,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})))}}]),t}(a.Component);var Jp=Object(y.b)(function(e,t){return{value:e.effects.effectParameters[t.parameter.id]}},null)(function(e){var t=Object(a.useCallback)(function(t){document.activeElement.blur(),console.log("setting parameter to = "+!e.value),e.parameter.set(!e.value)},[e.parameter,e.value]);return r.a.createElement("div",{className:"checkbox-parameter"},r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",value:"checked",checked:e.value,onChange:function(e){return t(e.target.value)}}),e.name))}),Gp=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(O,{condition:this.isEnabled()},r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Duration Factor",parameter:this.props.effect.durationFactorParameter,onParameterChanged:this.props.onParameterChanged,automation:this.props.automation,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.01,min:.1,max:2}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Even Delay Time",automation:this.props.automation,parameter:this.props.effect.oddDelayTimeParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:.01,max:16}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Odd Delay Time",automation:this.props.automation,parameter:this.props.effect.evenDelayTimeParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:.01,max:16}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Repeats",automation:this.props.automation,parameter:this.props.effect.repeatsParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:1,min:1,max:8}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Velocity Spread",automation:this.props.automation,parameter:this.props.effect.velocitySpreadParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.01,min:1,max:100}),r.a.createElement(Jp,{name:"Synced",parameter:this.props.effect.syncedParameter})))}}]),t}(a.Component),zp=Object(y.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(w.V)(t))}}})(Gp);function _p(e){var t=e.line;if(void 0===t)return r.a.createElement("div",null);var n=Object(a.useCallback)(function(t){console.log("on change value = "+t),e.onChangeValue({brightness:t})},[]),s=t.brightness||1;return r.a.createElement("div",{className:"line-parameters"},r.a.createElement("div",null,"Brightness: ",s),r.a.createElement(fe.a,{value:parseFloat(s),change:function(e){return n(e.target.value)},step:.01,max:1,min:0,orientation:"horizontal",reversed:!1}))}var Wp=10;function Kp(e,t,n){for(var a in e){var r=e[a];if(Yp(t,n,r.x1,r.y1)<Wp)return{x:r.x1,y:r.y1};if(Yp(t,n,r.x2,r.y2)<Wp)return{x:r.x2,y:r.y2}}return{x:t,y:n}}function Yp(e,t,n,a){return Math.sqrt(Math.pow(n-e,2)+Math.pow(a-t,2))}var Qp=new U.a,Xp="#eb3434",Zp="#ebe534";function $p(e){var t=Object(a.useState)(!1),n=Object(Z.a)(t,2),s=n[0],i=n[1],o=e.line,c=s||e.isSelected?Zp:Xp;c=Qp.brighten(c,o.brightness||1);var u=Object(a.useCallback)(function(t){t.cancelBubble=!0,e.onClickLine()},[e.onClickLine]),l=Object(a.useCallback)(function(t,n,a){t.cancelBubble=!0,e.onClickPoint(n,a)},[e.onClickPoint]);return r.a.createElement(b.Group,null,r.a.createElement(b.Line,{onMouseLeave:function(){return i(!1)},onMouseOver:function(){return i(!0)},onMouseDown:u,strokeWidth:10,alpha:.1,stroke:"black",points:[o.x1,o.y1,o.x2,o.y2]}),r.a.createElement(b.Line,{onMouseDown:u,strokeWidth:2,stroke:c,points:[o.x1,o.y1,o.x2,o.y2]}),r.a.createElement(b.Circle,{onMouseDown:function(e){return l(e,o.x1,o.y1)},x:o.x1,y:o.y1,radius:8,fill:"black"}),r.a.createElement(b.Circle,{x:o.x1,y:o.y1,radius:2,fill:"red"}),r.a.createElement(b.Circle,{onMouseDown:function(e){return l(e,o.x2,o.y2)},x:o.x2,y:o.y2,radius:8,fill:"black"}),r.a.createElement(b.Circle,{x:o.x2,y:o.y2,radius:2,fill:"red"}))}var eh="rgb(2, 30, 11)";function th(e){var t=Array(16).fill(0),n=e.width/16,a=e.width/16;return r.a.createElement(b.Group,null,t.map(function(t,a){return r.a.createElement(b.Line,{stroke:eh,strokeWidth:1,points:[a*n,0,a*n,e.height]})}),t.map(function(t,n){return r.a.createElement(b.Line,{stroke:eh,strokeWidth:1,points:[0,n*a,e.width,n*a]})}))}n(2328);var nh=400,ah=400,rh="PENCIL",sh="LINE";function ih(e){var t=Object(a.useState)(rh),n=Object(Z.a)(t,2),s=(n[0],n[1],Object(a.useState)(void 0)),i=Object(Z.a)(s,2),o=i[0],c=i[1],u=Object(a.useState)(void 0),l=Object(Z.a)(u,2),p=l[0],h=l[1],d=Object(a.useState)(!1),f=Object(Z.a)(d,2),m=f[0],v=f[1],g=Object(a.useState)([]),y=Object(Z.a)(g,2),k=y[0],E=y[1],S=Object(a.useState)(sh),O=Object(Z.a)(S,2),w=O[0],C=O[1],P=Object(a.useState)([]),T=Object(Z.a)(P,2),j=T[0],x=T[1],N=Object(a.useCallback)(function(e){C(e)},[C]),q=Object(a.useCallback)(function(e){if(m)if(w===sh){var t=Kp(k,e.evt.layerX,e.evt.layerY),n=t.x,a=t.y,r=Object(X.a)({},o,{x2:n,y2:a});c(r)}else{var s=e.evt.layerX,i=e.evt.layerY;x([].concat(Object(ge.a)(j),[{x:s,y:i}]))}},[m,x,j,w,o,c,k]),M=function(t){e.onLinesChanged(t.map(function(e){var t=e.x1,n=e.y1,a=e.x2,r=e.y2,s=e.brightness;return{x1:t/ah,y1:n/nh,x2:a/ah,y2:r/nh,brightness:s}}))},D=Object(a.useCallback)(function(e){if(o){var t=[].concat(Object(ge.a)(k),[o]);E(t),M(t)}v(!1),c(void 0)},[E,k,v,o,c]),A=Object(a.useCallback)(function(t){E([]),e.onLinesChanged([])},[E]),R=Object(a.useCallback)(function(e){if(void 0!==p){var t=k.indexOf(p);k.splice(t,1),E(k),h(void 0),M(k)}},[E,p,h]),I=Object(a.useCallback)(function(e){if(p)h(void 0);else{var t=Kp(k,e.evt.layerX,e.evt.layerY),n=t.x,a=t.y;c({x1:n,y1:a,x2:n,y2:a}),v(!0)}},[v,c,k,h,p]),L=Object(a.useCallback)(function(e){h(e===p?void 0:e)},[h,p]),F=Object(a.useCallback)(function(e){var t=Object(ge.a)(k),n=t.indexOf(p);t[n]=Object(X.a)({},p,e),E(t),h(t[n]),M(t)},[h,k,p,E]),V=Object(a.useCallback)(function(e,t,n){var a=Object(X.a)({},e);t===e.x1&&n===e.y1&&(a={x1:a.x2,y1:a.y2,x2:a.x1,y2:a.y1});var r=k.indexOf(e);k.splice(r,1),E(k),c(a),v(!0)},[E,c,k,v]);return Object(a.useEffect)(function(){E(e.lines.map(function(e){var t=e.x1,n=e.y1,a=e.x2,r=e.y2,s=e.brightness;return{x1:ah*t,y1:nh*n,x2:ah*a,y2:nh*r,brightness:s}}))},[e.lines,E]),r.a.createElement("div",{className:"draw-component"},r.a.createElement(b.Stage,{onMouseDown:I,onMouseMove:q,onMouseLeave:function(){return v(!1)},onMouseUp:D,width:ah,height:nh},r.a.createElement(b.Layer,null,r.a.createElement(b.Rect,{x:0,y:0,width:ah,height:nh,fill:"black"}),r.a.createElement(th,{width:ah,height:nh}),j.map(function(e){return r.a.createElement(b.Circle,{x:e.x,y:e.y,radius:5,fill:"red"})}),r.a.createElement(ch,{currentLine:o}),k.map(function(e){return r.a.createElement($p,{onClickPoint:function(t,n){return V(e,t,n)},isSelected:p===e,onClickLine:function(){return L(e)},line:e})}))),r.a.createElement("div",{className:"draw-toolbar"},r.a.createElement(oh,{name:"Line",isSelected:w===sh,onClick:function(){return N(sh)}}),r.a.createElement(oh,{name:"Pencil",isSelected:w===rh,onClick:function(){return N(rh)}}),r.a.createElement("div",{className:"option",onClick:A},"Clear"),r.a.createElement("div",{className:"option",onClick:R},"Delete")),r.a.createElement(_p,{line:p,onChangeValue:F}))}function oh(e){var t="option";return e.isSelected&&(t+=" selected"),r.a.createElement("div",{onClick:e.onClick,className:t},e.name)}function ch(e){if(e.currentLine){var t=e.currentLine;return r.a.createElement(b.Line,{strokeWidth:2,stroke:"red",points:[t.x1,t.y1,t.x2,t.y2]})}return r.a.createElement(b.Circle,{x:0,y:0,radius:1,fill:"black"})}var uh=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(O,{condition:this.isEnabled()},r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(ih,{lines:this.props.effect.rawLines,onLinesChanged:function(t){return e.props.effect.linesParameter.set(t)}})))}}]),t}(a.Component),lh=Object(y.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(w.V)(t))}}})(uh),ph=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return"Arpeggiator"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(Sp,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Parameterizer"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(wp,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Timing"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(Tp,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Midi Outputter"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(Mp,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Midi Interface"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(Rp,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Harmony"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(Lp,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Alternate Tuning"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(Bp,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Warp"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(xp,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Midi Delay"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(Hp,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Chord Rhythm"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(zp,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Chord Sculptor"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(lh,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Tidal"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(qp,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):void 0}}]),t}(a.Component),hh=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={effect:e.effect},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"handleModeChange",value:function(e){this.state.effect.mode=e.value,this.setState(this.state)}},{key:"handleFactorChange",value:function(e){this.state.effect.rollFactor=e.value,this.setState(this.state)}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){var e,t=this;void 0!==this.props.automation||this.state.effect.isEnabled();return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement("div",{className:"lfo-rate-dropdown roll-factor"},r.a.createElement("div",{className:"lfo-rate-label"},"Mode:"),r.a.createElement(pp.a,{className:"osc-type-dropdown roll-factor-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:mh,onChange:function(e){return t.handleModeChange(e)},value:(e=this.state.effect.mode,mh.filter(function(t){return t.value===e})[0]),placeholder:"Rate"}),r.a.createElement("div",{className:"clear-fix"})),r.a.createElement("div",{className:"lfo-rate-dropdown roll-factor"},r.a.createElement("div",{className:"lfo-rate-label"},"Roll Factor:"),r.a.createElement(pp.a,{className:"osc-type-dropdown roll-factor-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:dh,onChange:function(e){return t.handleFactorChange(e)},value:fh(this.state.effect.rollFactor),placeholder:"Rate"}),r.a.createElement("div",{className:"clear-fix"}))):"")}}]),t}(a.Component),dh=[{value:.125,label:"1/8"},{value:.25,label:"1/4"},{value:.5,label:"1/2"},{value:1,label:"1"},{value:2,label:"2"},{value:4,label:"4"},{value:8,label:"8"}];function fh(e){return dh.filter(function(t){return t.value===e})[0]}var mh=[{value:zs,label:"Sync"},{value:_s,label:"On"},{value:Gs,label:"Off"}];var vh=hh,gh=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;if(this.props.effect.effect===Js)return r.a.createElement(mp,{onDeleteEffect:this.props.onDeleteEffect,isMidiEffect:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,effect:this.props.effect,automation:this.props.automation},r.a.createElement(vh,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect}))}}]),t}(a.Component);var bh=300,yh=250;function kh(e){var t=Object(a.useState)([]),n=Object(Z.a)(t,2),s=n[0],i=n[1],o=void 0!==e.automation||e.effect.isEnabled();void 0!==e.automation||e.effect.isEnabled();if(function(e,t){var n=Object(a.useRef)();Object(a.useEffect)(function(){n.current=e},[e]),Object(a.useEffect)(function(){if(null!==t){var e=setInterval(function(){n.current()},t);return function(){return clearInterval(e)}}},[t])}(function(){o&&i(Array.from(e.effect.getValue()))},100),!o)return r.a.createElement("div",null);return r.a.createElement("div",null,r.a.createElement(b.Stage,{width:yh,height:bh},r.a.createElement(b.Layer,null,s.map(function(e,t){return function(e,t){e*=2;var n=Math.floor(yh*t/512),a=void 0,r=void 0;return e<0?(a=bh/2,r=Math.abs(e)*bh/2):(a=bh/2-e*bh/2,r=e*bh/2),{x:n,y:a,height:r,width:3}}(e,t)}).map(function(e){return r.a.createElement(b.Rect,{x:e.x,y:e.y,width:e.width,height:e.height,fill:"red"})}))))}var Eh=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"handleSendVolumeChange",value:function(e){-40===e&&(e=-100),this.props.track.setSendVolume(this.props.sendNumber,e)}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"render",value:function(){var e=this,t=0===this.props.sendNumber?"TRACK_SEND_A_SLIDER":"TRACK_SEND_B_SLIDER";return console.log("send contextual help = "+t),r.a.createElement("div",{onMouseOver:function(n){return e.setContextualHelp(n,t)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"enabled effect"},r.a.createElement("div",{className:"effect-name"},this.props.send.getName()),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(fe.a,{value:this.props.volume,change:function(t){return e.handleSendVolumeChange(t.target.value)},step:.1,max:3,min:-40,orientation:"vertical",reversed:!0}))}}]),t}(a.Component),Sh=Object(y.b)(function(e,t){var n=void 0===t.track?void 0:e.tracks.trackSendVolumes[t.track.trackNumber];return{volume:void 0!==n?n[t.sendNumber]:t.sendNode?t.sendNode.volume.value:0,isRecordingMix:e.mix.isRecordingMix,isRecording:e.sequencer.isRecording}},function(e){return{setContextualHelp:function(t){return e(Object(w.V)(t))},setTrackSendVolume:function(t,n,a){return e(Object(w.me)(t,n,a))}}})(Eh);function Oh(e){var t=e.sequencerEngine.resampleConfig,n=Object(a.useState)(t.samplesPerNote),s=Object(Z.a)(n,2),i=(s[0],s[1]),o={label:t.samplesPerNote,value:t.samplesPerNote},c=Object(a.useCallback)(function(e){t.samplesPerNote=e,i(e)},[i]);return r.a.createElement("div",{className:"samples-per-note"},r.a.createElement("div",{className:"dropdown-label"},"Samples Per Note:"),r.a.createElement(pp.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=[],n=1;n<=e;n++)t.push({label:n,value:n});return t}(),onChange:function(e){return c(e.value)},value:o,placeholder:"Samples per note"}))}function wh(e){var t=Object(a.useState)(e.sequencerEngine.autoResampleMode),n=Object(Z.a)(t,2),s=n[0],i=n[1],o=Object(a.useCallback)(function(){var t=e.sequencerEngine;if(s)return t.autoResampleMode=!1,t.store.dispatch(Object(w.wc)(!1)),void i(!1);t.autoResampleMode=!0,t.masterResampler.prepare(),t.store.dispatch(Object(w.wc)(!0)),i(!0)},[s,i]),c=s?"sample-synth-button sampling":"sample-synth-button";return r.a.createElement("div",{className:"resample-config"},r.a.createElement("div",{onClick:o,className:c},s?"SAMPLING SYNTH...":"SAMPLE SYNTH"),r.a.createElement(Oh,{sequencerEngine:e.sequencerEngine}))}var Ch=function(e){function t(e){var n;Object(o.a)(this,t);var a=void 0===(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).props.track.midiChannel?"all":n.props.track.midiChannel;return n.state={midiChannel:a},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onSelectMidiChannel",value:function(e){this.state.midiChannel=e.value,this.props.track.midiChannel=e.value,this.setState(this.state)}},{key:"updateLatency",value:function(e){this.props.track.latency=e,this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.props.track.sequencerEngine.midi;return r.a.createElement("div",{className:"instrument external-instrument"},r.a.createElement("div",{className:"midi-channel-container"},r.a.createElement("div",{className:"midi-channel"},"Channel: "),r.a.createElement(pp.a,{className:"midi-input-dropdown",controlClassName:"midi-input-control-dropdown",options:Th,onChange:function(t){return e.onSelectMidiChannel(t)},value:jh(this.state.midiChannel),placeholder:"Midi Channel"})),r.a.createElement("div",{className:"midi-outputs-container"},t.getTrackedOutputs().map(function(t){return r.a.createElement(Ph,{track:e.props.track,output:t})})),r.a.createElement("div",null,r.a.createElement("div",null,"Latency: ",this.props.track.latency," ms"),r.a.createElement(fe.a,{value:this.props.track.latency,change:function(t){return e.updateLatency(t.target.value)},step:1,max:100,min:1,orientation:"horizontal",reversed:!1})),r.a.createElement(wh,{sequencerEngine:this.props.track.sequencerEngine}))}}]),t}(a.Component),Ph=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isEnabled",value:function(){return this.props.track.getMidiOutputs().has(this.props.output)}},{key:"onClickMidiOutput",value:function(){this.isEnabled()?this.props.track.deleteMidiOutput(this.props.output):this.props.track.addMidiOutput(this.props.output),this.setState(this.state)}},{key:"render",value:function(){var e=this;this.isEnabled();return r.a.createElement("div",{className:this.isEnabled()?"midi-option enabled":"midi-option",onClick:function(){return e.onClickMidiOutput()}},this.props.output.name)}}]),t}(a.Component),Th=[{value:"all",label:"All"},{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"},{value:5,label:"5"},{value:6,label:"6"},{value:7,label:"7"},{value:8,label:"8"},{value:9,label:"9"},{value:10,label:"10"},{value:11,label:"11"},{value:12,label:"12"}];function jh(e){for(var t=0;t<Th.length;t++)if(Th[t].value==e)return Th[t];return null}var xh=Ch;var Nh=Object(y.b)(function(e,t){var n=0;return t.track&&(n=t.track.chainNumber),{chainNumber:n}},function(e,t){return{setEffectsChainToShow:function(t,n,a){return e(Object(w.ob)(t,n,a))}}})(function(e){if(void 0===e.track)return r.a.createElement("div",null);var t=e.track.effectsChains;return r.a.createElement("div",{className:"effects-chain-chooser"},t.map(function(t,n){return r.a.createElement("div",{onClick:function(){return function(t){e.setEffectsChainToShow(e.track.subSequence.id,e.track.trackNumber,t)}(n)},className:e.chainNumber===n?"effects-chain-btn selected":"effects-chain-btn"},n+1)}),r.a.createElement("div",{className:"new-effects-chain-btn",onClick:function(){e.track.newEffectsChain()}},"+"),r.a.createElement(O,{condition:e.track&&e.track.effectsChains.length>1},r.a.createElement("div",{className:"new-effects-chain-btn",onClick:function(){e.track.deleteEffectsChain()}},"-")))}),qh=[{value:"Alternate Tuning",label:"Alternate Tuning"},{value:"Arpeggiator",label:"Arpeggiator"},{value:"Chord Rhythm",label:"Chord Rhythm"},{value:"Chord Sculptor",label:"Chord Sculptor"},{value:"Midi Delay",label:"Delay"},{value:"Harmony",label:"Harmony"},{value:"Parametizer",label:"Parametizer"},{value:"Tidal",label:"Tidal"},{value:"Timing",label:"Timing"},{value:"Midi Outputter",label:"Midi Outputter"},{value:"Warp",label:"Warp"}];var Mh=[{value:Js,label:"Roll"}];var Dh=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={showOptions:!0},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"handleChooseLiveEffect",value:function(e){var t=null;e===Js&&(t=new xi(this.props.track)),this.props.handleChooseLiveEffect(t)}},{key:"handleChooseMidiEffect",value:function(e){var t=null;"Arpeggiator"===e?t=new Lr(this.props.track):"Parametizer"===e?t=new Vr(this.props.track):"Harmony"===e?t=new Fr(this.props.track):"Timing"===e?t=new Br(this.props.track):"Midi Outputter"===e?t=new Ur(this.props.track):"Midi Interface"===e?t=new Kr(this.props.track):"Alternate Tuning"===e?t=new Qr(this.props.track):"Warp"===e?t=new Zr(this.props.track):"Midi Delay"===e?t=new Yr(this.props.track):"Chord Rhythm"===e?t=new Jr(this.props.track):"Chord Sculptor"===e?t=new Gr(this.props.track):"Tidal"===e&&(t=new os(this.props.track)),this.props.handleChooseMidiEffect(t)}},{key:"handleChooseEffect",value:function(e){this.props.send;var t=nu(e,this.props.sequencerEngine);this.props.handleChooseEffect(t)}},{key:"onClickShowOptions",value:function(){this.state.showOptions=!0,this.setState(this.state)}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"render",value:function(){var e=this;if(this.state.showOptions)return r.a.createElement("div",{className:"enabled effect choose-effects"},r.a.createElement("div",{className:"add-effect-type"},r.a.createElement(pp.a,{className:"delay-time-dropdown",options:tu,onChange:function(t){return e.handleChooseEffect(t.value)},placeholder:"Audio FX"})),r.a.createElement(O,{condition:void 0!==this.props.track},r.a.createElement("div",{className:"add-effect-type"},r.a.createElement(pp.a,{className:"delay-time-dropdown",options:qh,onChange:function(t){return e.handleChooseMidiEffect(t.value)},placeholder:"MIDI FX"})),r.a.createElement(O,{condition:!window.installation},r.a.createElement("div",{className:"add-effect-type"},r.a.createElement(pp.a,{className:"delay-time-dropdown",options:Mh,onChange:function(t){return e.handleChooseLiveEffect(t.value)},placeholder:"Live FX"})))));void 0===this.props.track||this.props.track.effectsChains;return r.a.createElement("div",{className:"effects-chooser-container"},r.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"ADD_EFFECTS_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onClickShowOptions()},className:this.props.addClassName},"+"),r.a.createElement(O,{condition:!window.installation},r.a.createElement(Nh,{track:this.props.track})))}}]),t}(a.Component),Ah=Object(y.b)(function(e,t){var n=0;return t.track&&(n=t.track.chainNumber),{chainNumber:n}},function(e,t){return{setContextualHelp:function(t){return e(Object(w.V)(t))},setEffectsChainToShow:function(t,n,a){return e(Object(w.ob)(t,n,a))}}})(Dh),Rh=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.instrument.getOscillator(this.props.selectedOscillator);this.props.instrument;return e.isInitialized()?r.a.createElement("div",null,r.a.createElement(Gl,{sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,instrument:e,name:"Pulse Width",parameter:e.pulseWidthParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:1,step:.01}),r.a.createElement(Gl,{sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,name:"Polyphony",parameter:e.polyphonyParameter,onParameterChanged:function(){return[]},isParameter:!0,min:1,max:16,step:1}),r.a.createElement(Gl,{sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,name:"Glide",parameter:e.portamentoParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:50,step:.1})):r.a.createElement("div",null)}}]),t}(a.Component);function Ih(e,t){for(var n in e)if(t[n]!==e[n])return!1;for(var a in t)if(t[a]!==e[a])return!1;return!0}var Lh=function(){function e(t){Object(o.a)(this,e),this.filter=t,this.results=void 0}return Object(c.a)(e,[{key:"isEqual",value:function(e){return Ih(this.filter.instrumentTypes,e.filter.instrumentTypes)&&Ih(this.filter.tags,e.filter.tags)}},{key:"getPaginatedResults",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return void 0===this.results?[]:this.results.length>e+t?this.results.slice(e,e+t):this.results.slice(e)}}]),e}(),Fh=R.a.presets,Vh=function(){function e(){Object(o.a)(this,e),this.queries=[]}return Object(c.a)(e,[{key:"clear",value:function(){this.queries=[]}},{key:"getPaginatedPresets",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a,r,s,i,o,c=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=c.length>2&&void 0!==c[2]?c[2]:10,r=c.length>3&&void 0!==c[3]?c[3]:0,t=Object(X.a)({},t),s=new Lh(t),void 0===(i=this.queries.find(function(e){return e.isEqual(s)}))){e.next=7;break}return e.abrupt("return",i.getPaginatedResults(n,a));case 7:return e.next=9,Fh.getPresets(t,r);case 9:return o=e.sent,s.results=o,this.queries.push(s),e.abrupt("return",s.getPaginatedResults(n,a));case 13:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),Bh=new Vh,Uh=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={presets:[],start:0,loading:!1,loadingCounter:0,probability:.5,crossbreedEffects:!0},n.getPresets(),n.onClickNext=n.onClickNext.bind(Object(p.a)(n)),n.onClickPrevious=n.onClickPrevious.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickNext",value:function(){this.state.start=this.state.start+10,this.getPresets()}},{key:"onClickPrevious",value:function(){this.state.start=Math.max(0,this.state.start-10),this.getPresets()}},{key:"startLoading",value:function(){var e=this;this.setState({loading:!0}),this.loadingTimer=setInterval(function(){e.setState({loadingCounter:(e.state.loadingCounter+1)%5})},200)}},{key:"stopLoading",value:function(){this.setState({loading:!1}),clearInterval(this.loadingTimer)}},{key:"getPresets",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t={instrumentTypes:{},tags:{}}).instrumentTypes[this.props.track.instrument.getInstrumentType()]=!0,e.next=4,Bh.getPaginatedPresets(t,this.state.start);case 4:n=e.sent,this.setState({presets:n});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onUpdateProbability",value:function(e){this.setState({probability:e/100})}},{key:"onClickPreset",value:function(){var e=Object(g.a)(v.a.mark(function e(t){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.startLoading(),e.next=3,this.props.track.mateWithPreset(t,this.state.probability,this.state.crossbreedEffects);case 3:this.stopLoading();case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getEffectsClassName",value:function(e){return this.state.crossbreedEffects===e?"crossbreed-option enabled":"crossbreed-option"}},{key:"onClickEffects",value:function(e){this.setState({crossbreedEffects:e})}},{key:"render",value:function(){for(var e=this,t="",n=0;n<this.state.loadingCounter;n++)t+=".";return r.a.createElement("div",{className:"fm-genetix"},r.a.createElement("div",{onClick:this.props.onClickBack,className:"back-button"},"Back"),r.a.createElement(O,{condition:this.state.loading},r.a.createElement("div",{className:"loading-spinner"},"Loading ",t," ")),r.a.createElement(O,{condition:!this.state.loading},r.a.createElement("div",{className:"crossbreed-options"},r.a.createElement("div",null,r.a.createElement("div",{className:"crossbreed-probability"},"Crossbreed Preset: ",100*this.state.probability,"%"),r.a.createElement(fe.a,{value:100*this.state.probability,change:function(t){return e.onUpdateProbability(t.target.value)},step:.01,max:100,min:0,orientation:"horizontal",reversed:!1})),r.a.createElement("div",null,"Crossbreed Effects:",r.a.createElement("span",{onClick:function(){return e.onClickEffects(!0)},className:this.getEffectsClassName(!0)},"Yes"),r.a.createElement("span",{onClick:function(){return e.onClickEffects(!1)},className:this.getEffectsClassName(!1)},"No"))),r.a.createElement("div",{className:"presets"},this.state.presets.map(function(t,n){return r.a.createElement("div",{onClick:function(){return e.onClickPreset(t)},className:n%2===0?"preset":"preset odd"},t.title)})),r.a.createElement("div",{className:"pagination-buttons"},r.a.createElement(O,{condition:this.state.start>0},r.a.createElement("div",{onClick:this.onClickPrevious,className:"pagination-button"},"PREVIOUS")),r.a.createElement("div",{onClick:this.onClickNext,className:"pagination-button"},"NEXT"))))}}]),t}(a.Component),Hh=[{value:function(){return"128m"},label:"128"},{value:function(){return"64m"},label:"64"},{value:function(){return"32m"},label:"32"},{value:function(){return"16m"},label:"16"},{value:function(){return"8m"},label:"8"},{value:function(){return"4m"},label:"4"},{value:function(){return"2m"},label:"2"},{value:function(){return"1m"},label:"1"},{value:function(){return"2n"},label:"1/2"},{value:function(){return"4n"},label:"1/4"},{value:function(){return"4n."},label:"1/4."},{value:function(){return"4t"},label:"1/4t"},{value:function(){return"8n"},label:"1/8"},{value:function(){return"8n."},label:"1/8."},{value:function(){return"8t"},label:"1/8t"},{value:function(){return"16n"},label:"1/16"},{value:function(){return"16t"},label:"1/16t"},{value:function(){return"32n"},label:"1/32"}];function Jh(e){e="function"===typeof e?e():e;var t=Hh.filter(function(t){return t.value()===e});return 0==t.length?Hh[0]:t[0]}var Gh=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onSelectLFOTime",value:function(e){this.props.lfo.lfoRate=e.value()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"lfo-rate-dropdown"},r.a.createElement("div",{className:"lfo-rate-label"},"Rate:"),r.a.createElement(pp.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:Hh,onChange:function(t){return e.onSelectLFOTime(t)},value:Jh(this.props.lfo.lfoRate),placeholder:"LFO"}),r.a.createElement("div",{className:"clear-fix"}))}}]),t}(a.Component),zh=[{value:"square",label:"Square"},{value:"sine",label:"Sine"},{value:"triangle",label:"Triangle"},{value:"sawtooth",label:"Sawtooth"}];function _h(e){for(var t=0;t<zh.length;t++)if(zh[t].value===e)return zh[t];return null}var Wh=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onSelectLFOShape",value:function(e){this.props.lfo.lfoType=e.value}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"osc-type-dropdown-container"},r.a.createElement(pp.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:zh,onChange:function(t){return e.onSelectLFOShape(t)},value:_h(this.props.lfo.lfoType),placeholder:"LFO"}),r.a.createElement("div",{className:"clear-fix"}))}}]),t}(a.Component),Kh=(n(271),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={selectedLFO:0},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getLFOOptions",value:function(){return[{value:0,label:"LFO 1"},{value:1,label:"LFO 2"},{value:2,label:"LFO 3"},{value:3,label:"LFO 4"}]}},{key:"getLFOOption",value:function(e){for(var t=this.getLFOOptions(),n=0;n<t.length;n++)if(t[n].value==e)return t[n];return null}},{key:"onSelectLFO",value:function(e){this.setState({selectedLFO:e.value})}},{key:"onChangeSynced",value:function(e){this.getLFO().isSynced="unsynced"===e,this.setState(this.state)}},{key:"getLFO",value:function(){return this.props.instrument.lfos[this.state.selectedLFO]}},{key:"render",value:function(){var e=this,t=this.getLFO();return r.a.createElement("div",{className:"instrument-subsection"},r.a.createElement("div",{className:"instrument-subsection-name lfo-subsection-name colored-lfo-name-"+this.state.selectedLFO},"LFO"),r.a.createElement("div",{className:"osc-type-dropdown-container"},r.a.createElement(pp.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.getLFOOptions(),onChange:function(t){return e.onSelectLFO(t)},value:this.getLFOOption(this.state.selectedLFO),placeholder:"LFO"})),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(Wh,{lfo:t}),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement("div",{className:"refined-checkbox-preferences"},r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",value:t.isSynced?"synced":"unsynced",checked:t.isSynced,onChange:function(t){return e.onChangeSynced(t.target.value)}}),"Synced")),t.isSynced?r.a.createElement(Gh,{lfo:t}):r.a.createElement(Gl,{effectNumber:0,name:"Rate",parameter:t.lfoRateParameter,onParameterChanged:function(){return[]},isParameter:!0,step:.1,min:0,max:32}),r.a.createElement(Gl,{effectNumber:0,name:"Min",parameter:t.lfoMinParameter,onParameterChanged:function(){return[]},isParameter:!0,min:-100,max:100,step:1}),r.a.createElement(Gl,{effectNumber:0,name:"Max",parameter:t.lfoMaxParameter,onParameterChanged:function(){return[]},isParameter:!0,min:-100,max:100,step:1}))}}]),t}(a.Component)),Yh=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"enableOscillator",value:function(){this.props.sequencerEngine.operationManager.dispatch(Gi(this.props.oscillator.enabledParameter,!0)),this.setState(this.state)}},{key:"disableOscillator",value:function(){this.props.sequencerEngine.operationManager.dispatch(Gi(this.props.oscillator.enabledParameter,!1)),this.setState(this.state)}},{key:"onClick",value:function(){this.props.oscillator.enabled?this.props.selectedOscillator===this.props.number?this.disableOscillator():this.props.onChooseOscillator(this.props.number):(this.enableOscillator(),this.props.onChooseOscillator(this.props.number))}},{key:"render",value:function(){var e=this,t=this.props.number===this.props.selectedOscillator?"oscillator-option selected":"oscillator-option";return this.props.enabled||(t+=" disabled"),r.a.createElement("div",{onClick:function(){return e.onClick()},className:t},this.props.number+1)}}]),t}(a.Component),Qh=Object(y.b)(function(e,t){var n=t.oscillator.enabledParameter;return{enabled:e.effects.effectParameters[n.id]}},null)(Yh),Xh=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.oscillator,t=e.partials;return r.a.createElement("div",{className:"harmonics-editor"},"Harmonics Editor",t.slice(0,16).map(function(t,n){return r.a.createElement(Zh,{oscillator:e,i:n})}))}}]),t}(a.Component),Zh=function(e){function t(e){var n;Object(o.a)(this,t);var a=(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).props.oscillator.partials[n.props.i];return n.state={value:a},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onChange",value:function(e){var t=Object(ge.a)(this.props.oscillator.partials);t[this.props.i]=e,this.props.oscillator.partials=t,this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.props.oscillator.partials[this.props.i];return r.a.createElement("div",{className:"partial-editor"},r.a.createElement("div",{className:"partial-number"},this.props.i+1),r.a.createElement(fe.a,{value:t,change:function(t){return e.onChange(t.target.value)},step:.01,max:8,min:0,orientation:"horizontal",reversed:!1}))}}]),t}(a.Component),$h=Xh,ed=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={showHarmonics:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"showHarmonics",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.setState({showHarmonics:e})}},{key:"getSelectedOscillatorType",value:function(){return this.props.oscillator.oscillatorType}},{key:"onSelectOscillatorType",value:function(e){var t="none"===e.value?void 0:e.value;this.props.sequencerEngine.operationManager.dispatch(Gi(this.props.oscillator.oscillatorTypeParameter,t)),this.setState(this.state)}},{key:"render",value:function(){var e,t=this,n=this.props.oscillator,a=this.props.instrument;return n.isInitialized()?this.state.showHarmonics&&"custom"===n.oscillatorType?r.a.createElement("div",{className:"oscillator-component"},r.a.createElement("div",{className:"clear-fix"}),r.a.createElement($h,{oscillator:n}),r.a.createElement("div",{onClick:function(){return t.showHarmonics(!1)},className:"harmonics-button"},"Done Editing")):r.a.createElement("div",{className:"oscillator-component"},r.a.createElement("div",{className:"osc-type-dropdown-container"},r.a.createElement(pp.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:td,onChange:function(e){return t.onSelectOscillatorType(e)},value:(e=this.getSelectedOscillatorType(),td.filter(function(t){return t.value===e})[0]),placeholder:"Osc. Type"})),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(Gl,{automation:this.props.automation,name:"Volume",parameter:n.oscillatorLevelParameter,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,isParameter:!0,min:-64,max:0,step:.1}),r.a.createElement(Gl,{automation:this.props.automation,name:"Frequency",sequencerEngine:this.props.sequencerEngine,parameter:n.oscillatorFrequencyParameter,onParameterChanged:function(){return a.releaseAll()},displayFunction:function(e){return bs.a.fromTranspose(e).toString()},isParameter:!0,min:-32,max:32,step:1}),r.a.createElement(Gl,{automation:this.props.automation,name:"Detune",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:n.detuneParameter,onParameterChanged:function(){return[]},isParameter:!0,min:-100,max:100,step:1}),r.a.createElement(O,{condition:"custom"===n.oscillatorType},r.a.createElement("div",{onClick:function(){return t.showHarmonics()},className:"harmonics-button"},"Edit Harmonics"))):r.a.createElement("div",null)}}]),t}(a.Component),td=[{value:"square",label:"Square"},{value:"sine",label:"Sine"},{value:"triangle",label:"Triangle"},{value:"sawtooth",label:"Sawtooth"},{value:"pwm",label:"PWM"},{value:"pulse",label:"Pulse"},{value:"custom",label:"Custom"}];var nd=Object(y.b)(function(e,t){return{type:t.oscillator.oscillatorType}},null)(ed),ad=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props.instrument,n=this.props.instrument.getOscillator(this.props.selectedOscillator);return r.a.createElement("div",{className:"oscillators-component"},r.a.createElement("div",{className:"oscillator-subsection-header"},r.a.createElement("div",{className:"instrument-subsection-name"},"Oscillator"),r.a.createElement("div",{className:"oscillator-options"},r.a.createElement(Qh,{sequencerEngine:this.props.sequencerEngine,selectedOscillator:this.props.selectedOscillator,oscillator:t.getOscillator(0),number:0,onChooseOscillator:function(t){return e.props.onChooseOscillator(t)}}),r.a.createElement(Qh,{sequencerEngine:this.props.sequencerEngine,selectedOscillator:this.props.selectedOscillator,oscillator:t.getOscillator(1),number:1,onChooseOscillator:function(t){return e.props.onChooseOscillator(t)}}),r.a.createElement(Qh,{sequencerEngine:this.props.sequencerEngine,selectedOscillator:this.props.selectedOscillator,oscillator:t.getOscillator(2),number:2,onChooseOscillator:function(t){return e.props.onChooseOscillator(t)}}),r.a.createElement(Qh,{sequencerEngine:this.props.sequencerEngine,selectedOscillator:this.props.selectedOscillator,oscillator:t.getOscillator(3),number:3,onChooseOscillator:function(t){return e.props.onChooseOscillator(t)}}))),r.a.createElement(nd,{sequencerEngine:this.props.sequencerEngine,oscillator:n,instrument:t}))}}]),t}(a.Component),rd=(a.Component,function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={updateRate:100,x:0,y:0},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.run()}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"run",value:function(){var e=this;this.timer=setInterval(function(){e.setState(e.state)},this.state.updateRate)}},{key:"startDragging",value:function(e){this.setState({dragging:e}),this.props.setSelectedPoint(e)}},{key:"stopDragging",value:function(e){this.setState({dragging:void 0})}},{key:"onMouseMove",value:function(e){var t=this.ref.getPointerPosition(),n=t.x,a=t.y;if(this.setState({x:n,y:a}),void 0!==this.state.dragging){var r=this.getTimeForXPosition(n,this.state.dragging);"ATTACK"===this.state.dragging?(this.props.envelope.attack=r,this.props.envelope.level=this.getLevelForYPosition(a)):"DECAY"===this.state.dragging?(this.props.envelope.decay=r,this.props.envelope.sustain=this.getSustainForYPosition(a)):"SUSTAIN"===this.state.dragging?this.props.envelope.sustain=this.getSustainForYPosition(a):"RELEASE"===this.state.dragging&&(this.props.envelope.release=r),this.props.onEnvelopeUpdated()}}},{key:"getGuideLines",value:function(){for(var e=[],t=0,n=0;n<=20;n++)e.push(r.a.createElement(b.Line,{points:[t,0,t,400],stroke:"#1f1f1f",strokeWidth:1})),t+=32.5;e.push(r.a.createElement(b.Line,{points:[0,100,650,100],stroke:"#1f1f1f",strokeWidth:1})),e.push(r.a.createElement(b.Line,{points:[0,300,650,300],stroke:"#1f1f1f",strokeWidth:1})),t=32.5;for(var a=this.props.zoom,s=0;s<20;s+=2)e.push(r.a.createElement(b.Text,{text:a+" ms",fill:"white",fontSize:6,fontFamily:"Arial",x:t+2,y:390})),t+=65,a+=2*this.props.zoom;return e}},{key:"getAttackCurve",value:function(){var e=this.getXPositionForTime(this.props.envelope.attack),t=this.getYForLevel();if("linear"===this.attackCurve)return r.a.createElement(b.Line,{points:[0,200,e,t],strokeWidth:2,stroke:"#6200EE"});if("exponential"===this.attackCurve)return this.getExponentialCurve(0,200,e,t,!0);var n=q.a.Envelope.Type[this.attackCurve];return this.getExplicitCurve(n.In,0,200,e,t,!1)}},{key:"getExplicitCurve",value:function(e,t,n,a,s,i){for(var o=(a-t)/e.length,c=[],u=0;u<e.length;u++){var l=i?this.getYForSustain(e[u]*this.props.envelope.sustain):this.getYForLevel(e[u]*this.level);c.push(t),c.push(l),t+=o}return r.a.createElement(b.Line,{points:c,strokeWidth:2,stroke:"#6200EE"})}},{key:"getDecayCurve",value:function(){if("linear"===this.decayCurve)return r.a.createElement(b.Line,{points:[this.attackX,this.getYForLevel(),this.decayX,this.sustainY],strokeWidth:2,stroke:"#6200EE"});if("exponential"===this.decayCurve)return this.getExponentialCurve(this.attackX,this.getYForLevel(),this.decayX,this.sustainY);var e=q.a.Envelope.Type[this.decayCurve];return this.getExplicitCurve(e.Out,this.attackX,this.getYForLevel(),this.decayX,this.sustainY)}},{key:"getSustainCurve",value:function(){return r.a.createElement(b.Line,{points:[this.decayX,this.sustainY,this.sustainX,this.sustainY],strokeWidth:2,stroke:"#6200EE"})}},{key:"getReleaseCurve",value:function(){if("linear"===this.releaseCurve)return r.a.createElement(b.Line,{points:[this.sustainX,this.sustainY,this.releaseX,200],strokeWidth:2,stroke:"#6200EE"});if("exponential"===this.releaseCurve)return this.getExponentialCurve(this.sustainX,this.sustainY,this.releaseX,200);var e=q.a.Envelope.Type[this.releaseCurve];return this.getExplicitCurve(e.Out,this.sustainX,this.sustainY,this.releaseX,200,!0)}},{key:"getExponentialCurve",value:function(e,t,n,a){var s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=(2*e+n)/3;s&&(i=(4*n+e)/5);var o=((t+a)/2+a)/2;return s&&(o=(t+a)/2),r.a.createElement(b.Line,{points:[e,t,i,o,n,a],tension:.3,strokeWidth:2,stroke:"#6200EE"})}},{key:"getAttackPoint",value:function(){var e=this,t="ATTACK"===this.props.selectedPoint?"yellow":"black";return r.a.createElement(b.Circle,{onMouseDown:function(t){return e.startDragging("ATTACK")},onMouseUp:function(t){return e.stopDragging("ATTACK")},x:this.attackX,y:this.getYForLevel(),radius:5,stroke:"yellow",fill:t})}},{key:"getDecayPoint",value:function(){var e=this,t="DECAY"===this.props.selectedPoint?"yellow":"black";return r.a.createElement(b.Circle,{onMouseDown:function(t){return e.startDragging("DECAY")},onMouseUp:function(t){return e.stopDragging("DECAY")},x:this.decayX,y:this.sustainY,radius:5,stroke:"yellow",fill:t})}},{key:"getSustainPoint",value:function(){var e=this,t="SUSTAIN"===this.props.selectedPoint?"yellow":"black";return r.a.createElement(b.Circle,{onMouseDown:function(t){return e.startDragging("SUSTAIN")},onMouseUp:function(t){return e.stopDragging("SUSTAIN")},x:this.sustainX,y:this.sustainY,radius:5,stroke:"yellow",fill:t})}},{key:"getReleasePoint",value:function(){var e=this,t="RELEASE"===this.props.selectedPoint?"yellow":"black";return r.a.createElement(b.Circle,{onMouseDown:function(t){return e.startDragging("RELEASE")},onMouseUp:function(t){return e.stopDragging("RELEASE")},x:this.releaseX,y:200,radius:5,stroke:"yellow",fill:t})}},{key:"getADSRPoints",value:function(){return[this.getAttackPoint(),this.getDecayPoint(),this.getSustainPoint(),this.getReleasePoint()]}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(b.Stage,{ref:function(t){return e.ref=t},width:650,height:400,onMouseLeave:function(){return e.stopDragging()},onMouseUp:function(t){return e.stopDragging()}},r.a.createElement(b.Layer,null,r.a.createElement(b.Rect,{onMouseMove:function(t){return e.onMouseMove(t)},onMouseUp:function(t){return e.stopDragging()},x:0,y:0,height:400,width:650,fill:"black"}),this.getGuideLines(),r.a.createElement(b.Line,{points:[0,200,650,200],strokeWidth:2,stroke:"red"}),this.getAttackCurve(),this.getDecayCurve(),this.getSustainCurve(),this.getReleaseCurve(),this.getADSRPoints(),r.a.createElement(b.Text,{text:this.state.x+","+this.state.y,fill:"white",fontSize:6,fontFamily:"Arial",x:30,y:300}))))}},{key:"getYForSustain",value:function(e){return 200-400*(e*=this.level)/2}},{key:"getYForLevel",value:function(){return 200-400*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.level)/2}},{key:"getLevelForYPosition",value:function(e){if(!this.props.showLevel)return 1;var t=2*(400-e)/400-1;return t>1?1:t<-1?0:t}},{key:"getSustainForYPosition",value:function(e){var t=2*(400-e)/400-1;return this.props.showLevel||(t=Math.abs(t)),(t/=this.level)>1?1:t<0?0:t}},{key:"getTimeForXPosition",value:function(e,t){return"DECAY"===t?e-=this.attackX:"SUSTAIN"===t?e-=this.decayX:"RELEASE"===t&&(e-=this.sustainX),Math.max(0,e/32.5*this.props.zoom)}},{key:"getXPositionForTime",value:function(e){return 32.5*e/this.props.zoom}},{key:"level",get:function(){return this.props.showLevel?this.props.envelope.level:1}},{key:"sustainY",get:function(){return 200-400*(this.props.envelope.sustain*this.level)/2}},{key:"attackX",get:function(){return this.getXPositionForTime(this.props.envelope.attack)}},{key:"decayX",get:function(){return this.getXPositionForTime(this.props.envelope.decay)+this.attackX}},{key:"sustainX",get:function(){return this.attackX+this.decayX+100}},{key:"releaseX",get:function(){return this.sustainX+this.getXPositionForTime(this.props.envelope.release)}},{key:"isSynthEnvelope",get:function(){return"PITCH"!==this.props.envelopeType}},{key:"attackCurve",get:function(){return this.props.envelope.attackCurve}},{key:"decayCurve",get:function(){return this.props.envelope.decayCurve}},{key:"sustainCurve",get:function(){return this.props.envelope.sustainCurve}},{key:"releaseCurve",get:function(){return this.props.envelope.releaseCurve}}]),t}(a.Component)),sd=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getOption",value:function(e){return this.getOptions().filter(function(t){return t.value===e})[0]}},{key:"getOptions",value:function(){var e=this,t=id;return"DECAY"===this.props.selectedPoint&&(t=id.filter(function(e){return"linear"===e.value||"exponential"===e.value})),t.map(function(t){return Object(X.a)({},t,{label:t.label+" "+e.props.selectedPoint.toLowerCase()})})}},{key:"onSelectOption",value:function(e){var t=e.value;"ATTACK"===this.props.selectedPoint?this.props.envelope.attackCurve=t:"DECAY"===this.props.selectedPoint?this.props.envelope.decayCurve=t:"RELEASE"===this.props.selectedPoint&&(this.props.envelope.releaseCurve=t),this.props.onUpdateEnvelopeCurve(e.value)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"envelope-curve-dropdown-container"},r.a.createElement(pp.a,{className:"envelope-curve-dropdown",controlClassName:"envelope-curve-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.getOptions(),onChange:function(t){return e.onSelectOption(t)},value:this.getOption(this.curve),placeholder:"Curve"}))}},{key:"envelope",get:function(){return"PITCH"===this.props.envelopeType?this.props.envelope.envelope.envelope:this.props.envelope.envelope}},{key:"curve",get:function(){var e=this.envelope;return"ATTACK"===this.props.selectedPoint?e.attackCurve:"DECAY"===this.props.selectedPoint?e.decayCurve:"RELEASE"===this.props.selectedPoint?e.releaseCurve:""}}]),t}(a.Component),id=[{value:"linear",label:"Linear"},{value:"exponential",label:"Exponential"},{value:"sine",label:"Sine"},{value:"cosine",label:"Cosine"},{value:"bounce",label:"Bounce"},{value:"ripple",label:"Ripple"},{value:"step",label:"Step"}],od=sd,cd=200,ud=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={zoom:cd,selectedPoint:"ATTACK"},n.onClickDone=n.onClickDone.bind(Object(p.a)(n)),n.onClickCancel=n.onClickCancel.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"updateZoom",value:function(e){this.setState({zoom:e.target.value})}},{key:"onClickDone",value:function(){this.props.hide()}},{key:"onClickCancel",value:function(){this.props.hide()}},{key:"onEnvelopeUpdated",value:function(){this.setState(this.state)}},{key:"setSelectedPoint",value:function(e){this.setState({selectedPoint:e})}},{key:"onUpdateEnvelopeCurve",value:function(e){this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.props.envelope,n=this.props.name||this.props.envelopeType+" Envelope";return r.a.createElement(D.a,{dialogClassName:"envelope-modal",show:this.props.show,onHide:this.onClickCancel},r.a.createElement(D.a.Header,{closeButton:!0},r.a.createElement(D.a.Title,null,n)),r.a.createElement(D.a.Body,null,r.a.createElement(rd,{onEnvelopeUpdated:function(){return e.onEnvelopeUpdated()},envelopeType:this.props.envelopeType,setSelectedPoint:function(t){return e.setSelectedPoint(t)},selectedPoint:this.state.selectedPoint,showLevel:this.props.showLevel,zoom:this.state.zoom,envelope:this.props.envelope}),r.a.createElement("div",{className:"envelope-parameters-container"},r.a.createElement("div",null,r.a.createElement("div",null,"Zoom: ",this.state.zoom," ms"),r.a.createElement(fe.a,{value:this.state.zoom,change:function(t){return e.updateZoom(t)},step:1,max:1e3,min:1,orientation:"horizontal",reversed:!1})),r.a.createElement("div",{className:"envelope-parameters"},r.a.createElement("div",null,r.a.createElement("span",{className:"envelope-parameter"},"Level:",r.a.createElement("span",{className:"envelope-value"},Math.round(100*t.level)/100)),r.a.createElement("span",{className:"envelope-parameter"},"Attack:",r.a.createElement("span",{className:"envelope-value"},Math.round(100*t.attack)/100)),r.a.createElement("span",{className:"envelope-parameter"},"Decay:",r.a.createElement("span",{className:"envelope-value"},Math.round(100*t.decay)/100)),r.a.createElement("span",{className:"envelope-parameter"},"Sustain:",r.a.createElement("span",{className:"envelope-value"},Math.round(100*t.sustain)/100)),r.a.createElement("span",{className:"envelope-parameter"},"Release:",r.a.createElement("span",{className:"envelope-value"},Math.round(100*t.release)/100))),r.a.createElement("div",null,r.a.createElement(od,{onUpdateEnvelopeCurve:function(t){return e.onUpdateEnvelopeCurve(t)},selectedPoint:this.state.selectedPoint,envelopeType:this.props.envelopeType,envelope:this.props.envelope}))))),r.a.createElement(D.a.Footer,null,r.a.createElement(A.b,{variant:"secondary",onClick:this.onClickDone},"Done"),r.a.createElement(A.b,{variant:"primary",onClick:this.onClickCancel},"Cancel")))}}]),t}(a.Component),ld=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={showEnvelopeModal:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"showEnvelopeModal",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.setState({showEnvelopeModal:e})}},{key:"render",value:function(){var e=this,t=this.props.envelope,n={envelopeType:this.props.envelopeType};return r.a.createElement("div",null,r.a.createElement(ud,{envelopeType:this.props.envelopeType,envelope:t,showLevel:this.props.showLevel,show:this.state.showEnvelopeModal,hide:function(){return e.showEnvelopeModal(!1)}}),r.a.createElement(O,{condition:this.props.showLevel},r.a.createElement(Gl,{automation:this.props.automation,name:"Level",parameter:t.levelParameter,automationContext:n,sequencerEngine:this.props.sequencerEngine,onParameterChanged:function(){return[]},lfoEnabled:!0,isParameter:!0,min:-1,max:1,step:.01})),r.a.createElement(Gl,{automation:this.props.automation,name:"Attack",parameter:t.attackParameter,automationContext:n,sequencerEngine:this.props.sequencerEngine,onParameterChanged:function(){return[]},lfoEnabled:!0,isParameter:!0,min:0,max:6e3,step:1}),r.a.createElement(Gl,{automation:this.props.automation,name:"Decay",automationContext:n,sequencerEngine:this.props.sequencerEngine,parameter:t.decayParameter,onParameterChanged:function(){return[]},isParameter:!0,lfoEnabled:!0,min:0,max:6e3,step:1}),r.a.createElement(Gl,{automation:this.props.automation,automationContext:n,name:"Sustain",parameter:t.sustainParameter,onParameterChanged:function(){return[]},isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,min:0,max:1,step:.01}),r.a.createElement(Gl,{automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,automationContext:n,name:"Release",parameter:t.releaseParameter,onParameterChanged:function(){return[]},lfoEnabled:!0,isParameter:!0,min:0,max:1e4,step:1}),r.a.createElement("div",{onClick:function(){return e.showEnvelopeModal()},className:"draw-envelope-modal-button"},"DRAW"))}}]),t}(a.Component),pd=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={selectedEnvelope:ac},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onSelectEnvelopeType",value:function(e){this.setState({selectedEnvelope:e.value})}},{key:"render",value:function(){var e=this,t=void 0,n=!0;return this.state.selectedEnvelope===ac?(n=!1,t=this.props.instrument.ampEnvelope):"FILTER"===this.state.selectedEnvelope?t=this.props.instrument.filterEnvelope:"FILTER_2"===this.state.selectedEnvelope?t=this.props.instrument.filterEnvelope2:"PITCH"===this.state.selectedEnvelope?t=this.props.instrument.pitchEnvelope:"MODULATION"===this.state.selectedEnvelope&&(n=!1,t=this.props.instrument.modulationEnvelope),r.a.createElement("div",{className:"envelopes-component"},r.a.createElement("div",{className:"instrument-subsection-name"},"Envelopes"),r.a.createElement("div",{className:"osc-type-dropdown-container"},r.a.createElement(pp.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.props.envelopeOptions,onChange:function(t){return e.onSelectEnvelopeType(t)},value:this.getEnvelopeOption(this.state.selectedEnvelope),placeholder:"Osc. Type"})),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(ld,{automation:this.props.automation,envelopeType:this.state.selectedEnvelope,sequencerEngine:this.props.sequencerEngine,showLevel:n,instrument:this.props.instrument,envelope:t}))}},{key:"getEnvelopeOption",value:function(e){return this.props.envelopeOptions.filter(function(t){return t.value===e})[0]}}]),t}(a.Component),hd=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.instrument,t={},n={};if(e.getInstrumentType()==Go)t={"Carrier Oscillator":e.carrierOscillator,"Modulator Oscillator":e.modulatorOscillator};else{var a=e.oscillatorNodes[0],s=e.oscillatorNodes[1],i=e.oscillatorNodes[2],o=e.oscillatorNodes[3];t={"Oscillator 1":a,"Oscillator 2":s,"Oscillator 3":i,"Oscillator 4":o};var c=e.ampEnvelope,u=e.filterEnvelope,l=e.pitchEnvelope;n={"Amp Envelope":c,"Filter Envelope":u,"Pitch Envelope":l}}return console.log("envelopes = "),console.log(n),r.a.createElement("div",null,r.a.createElement(dd,{name:"Synth",parameters:e.parameters}),Object.keys(t).map(function(e){return r.a.createElement(dd,{name:e,parameters:t[e].parameters})}),Object.keys(n).map(function(e){return r.a.createElement(dd,{name:e,parameters:n[e].parameters})}))}}]),t}(a.Component),dd=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.parameterMods;return 0===e.length?r.a.createElement("div",null):r.a.createElement("div",null,r.a.createElement("div",{className:"synth-mods-name"},this.props.name),e.map(function(e){return r.a.createElement(up,{parameterMod:e})}))}},{key:"parameterMods",get:function(){var e=[];return this.props.parameters.forEach(function(t){return e=e.concat(t.parameterMods)}),e}}]),t}(a.Component),fd=hd,md=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={showMods:!1,showGenetix:!1,selectedOscillator:0},n.onClickMods=n.onClickMods.bind(Object(p.a)(n)),n.onClickGenetix=n.onClickGenetix.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onChooseOscillator",value:function(e){this.setState({selectedOscillator:e})}},{key:"onClickGenetix",value:function(){this.setState({showGenetix:!this.state.showGenetix})}},{key:"onClickMods",value:function(){this.setState({showMods:!this.state.showMods})}},{key:"getOscillatorOptions",value:function(){return[{value:"square",label:"Square"},{value:"sine",label:"Sine"},{value:"triangle",label:"Triangle"},{value:"sawtooth",label:"Sawtooth"},{value:"pwm",label:"PWM"},{value:"pulse",label:"Pulse"}]}},{key:"getOscillatorOption",value:function(e){for(var t=this.getOscillatorOptions(),n=0;n<t.length;n++)if(t[n].value==e)return t[n];return null}},{key:"render",value:function(){var e=this,t=this.props.instrument;return r.a.createElement("div",{className:"instrument"},r.a.createElement(O,{condition:!this.state.showMods&&!this.state.showGenetix},r.a.createElement("div",{className:"clear-fix"}),r.a.createElement("div",{className:"instrument-section"},r.a.createElement("div",{className:"instrument-subsection"},r.a.createElement(ad,{selectedOscillator:this.state.selectedOscillator,onChooseOscillator:function(t){return e.onChooseOscillator(t)},sequencerEngine:this.props.sequencerEngine,instrument:t}))),r.a.createElement("div",{className:"instrument-section"},r.a.createElement("div",{className:"instrument-subsection"},r.a.createElement("div",{className:"instrument-subsection-name"},"Filter"),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(Gl,{automation:this.props.automation,name:"Cutoff",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:t.filterCutoffParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:1e4,step:1}),r.a.createElement(Gl,{automation:this.props.automation,name:"Q",sequencerEngine:this.props.sequencerEngine,parameter:t.filterQParameter,lfoEnabled:!0,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:9,step:1})),r.a.createElement("div",{className:"instrument-subsection"},r.a.createElement(Rh,{sequencerEngine:this.props.sequencerEngine,selectedOscillator:this.state.selectedOscillator,instrument:t}))),r.a.createElement("div",{className:"instrument-section"},r.a.createElement("div",{className:"instrument-subsection"},r.a.createElement(pd,{automation:this.props.automation,envelopeOptions:vd,sequencerEngine:this.props.sequencerEngine,instrument:t})))),r.a.createElement(O,{condition:this.state.showMods},r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(fd,{instrument:t})),r.a.createElement(O,{condition:this.state.showGenetix},r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(Uh,{onClickBack:function(){return e.onClickGenetix()},track:this.props.track,instrument:t})),r.a.createElement(O,{condition:!this.state.showGenetix},r.a.createElement("div",{onClick:this.onClickMods,className:"mods-button common-button pink-button small-button"},this.state.showMods?"BACK":"MODS"),r.a.createElement("div",{onClick:this.onClickGenetix,className:"mods-button common-button pink-button small-button"},"GENETIX")))}}]),t}(a.Component),vd=[{value:ac,label:"Amp"},{value:"FILTER",label:"Filter"},{value:"PITCH",label:"Pitch"}],gd=md;function bd(e){return e?.99*e.clientWidth:window.innerWidth-2}var yd=window.innerWidth,kd=130,Ed=new U.a,Sd=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={buffer:e.buffer,ticks:[],offset:0,endOffset:0},n.width=bd(n.props.div),n.height=e.height||kd,n.state.startX=n.convertSecondsToSpace(e.start,e.scale),n.state.endX=n.convertSecondsToSpace(e.end,e.scale),n.calculateTicks(void 0,void 0,void 0,!0),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"calculateTicks",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props.start,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.props.end,arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.props.scale,arguments.length>3&&void 0!==arguments[3]&&arguments[3]}},{key:"shouldComponentUpdate",value:function(e,t){if(this.width=bd(e.div),this.state.buffer!=e.buffer||this.props.scale!==e.scale||this.props.zoomedStartTime!==e.zoomedStartTime||this.props.start!==e.start||this.props.end!==e.end){this.state.buffer=e.buffer;var n=e.start,a=e.end;this.state.startX=this.convertSecondsToSpace(n,e.scale),this.state.endX=this.convertSecondsToSpace(a,e.scale),this.calculateTicks(n,a,e.scale)}if(this.props.transpose!==e.transpose||this.props.bpm!==e.bpm){var r=e.start,s=e.end;this.calculateTicks(r,s,e.scale)}return!0}},{key:"convertSpaceToSeconds",value:function(e){return this.state.buffer.duration*e/this.width}},{key:"convertSecondsToSpace",value:function(e){return e/this.state.buffer.duration*this.width}},{key:"render",value:function(){var e=this,t=[0,0,30,30,0,30],n=[0,this.height,-30,this.height,0,this.height-30],a=this.props.color||Ed.getColor(this.props.sliceNumber),s=this.state.startX,i=this.state.endX;return r.a.createElement(b.Group,null,this.props.isSelectedSlice?r.a.createElement(b.Rect,{x:s,y:0,width:i-s,opacity:i-s>yd/2?.1:.2,height:this.height,fill:a}):r.a.createElement(b.Rect,null),r.a.createElement(b.Line,{points:[this.state.startX,0,this.state.startX,this.height],strokeWidth:1,stroke:"red",opacity:.5,alpha:.5,fill:"red"}),r.a.createElement(b.Line,{onMouseDown:function(t){return e.props.onStartSliceStartedDragging(t.evt.clientX-e.state.startX)},onMouseUp:this.props.onStartSliceStroppedDragging,onKeyDown:function(t){return e.props.onKeyDown(t)},x:this.state.startX,y:0,style:{cursor:"pointer"},points:t,closed:!0,strokeWidth:1,stroke:this.props.color,fill:this.props.color}),r.a.createElement(b.Line,{points:[this.state.endX,0,this.state.endX,this.height],strokeWidth:1,stroke:"red",fill:"red"}),r.a.createElement(b.Line,{onMouseDown:function(t){return e.props.onEndSliceStartedDragging(t.evt.clientX-e.state.endX)},onMouseUp:this.props.onEndSliceStoppedDragging,x:this.state.endX,y:0,style:{cursor:"pointer"},points:n,closed:!0,strokeWidth:1,stroke:this.props.color,fill:this.props.color}),this.props.isSelectedSlice?r.a.createElement(b.Rect,{x:s,y:this.height-3,width:i-s,alpha:.2,height:3,fill:a}):r.a.createElement(b.Rect,null),this.props.isSelectedSlice?this.state.ticks.map(function(t){return r.a.createElement(b.Line,{x:t,y:0,style:{cursor:"pointer"},points:[t.x,e.height,t.x,e.height-t.height],closed:!0,opacity:20===t.height?"0.55":"0.4",strokeWidth:1,stroke:e.props.color,fill:e.props.color})}):r.a.createElement(b.Rect,null))}}]),t}(a.Component),Od=Object(y.b)(function(e,t){var n=e.effects.effectParameters[t.transposeParameter.id],a=e.tracks.sampleSlices[t.sampler.id][t.sliceNumber];return void 0===a?{}:{bpm:e.user.bpm,transpose:n,start:a.startTime-t.zoomedStartTime,end:a.endTime-t.zoomedStartTime}},null)(Sd),wd=function(){function e(t,n){Object(o.a)(this,e),console.log("initializing waveform cache"),this.width=t,this.height=n,this.idToWaveform={},this.reversedIdToWaveform={}}return Object(c.a)(e,[{key:"getWaveform",value:function(e,t){var n=this;return new Promise(function(a,r){e in n.idToWaveform?a(n.idToWaveform[e]):n.computeWaveformPoints(t,0,[],function(t){n.idToWaveform[e]=t,a(t)})})}},{key:"getReversedWaveform",value:function(e,t){var n=this;return new Promise(function(a,r){e in n.reversedIdToWaveform?a(n.reversedIdToWaveform[e]):n.computeWaveformPoints(t,0,[],function(t){n.reversedIdToWaveform[e]=t,a(t)})})}},{key:"computeWaveformPoints",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n,a,r){var s,i,o,c,u,l,p,h,d,f;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("computing waveforms!"),s=this.width/4,!((n+1)*s>this.width)){e.next=5;break}return r([]),e.abrupt("return");case 5:for(i=Math.floor(t.length/this.width),o=(o=t.getChannelData(0)).subarray(s*n*i,s*(n+1)*i),c=window.api.create_buffer(o.length),Math.min((n+1)*s,this.width),window.Module.HEAPF32.set(o,c>>2),window.api.getColoredWaveform(c,s,this.height,o.length,i,s*n),u=window.api.get_result_pointer(),l=new Uint16Array(window.Module.HEAP16.buffer,u,7*s),p=[],h=0;h<7*s;h+=7)d=[l[h+4],l[h+5],l[h+6]],p.push({x:l[h],y:l[h+1],width:l[h+2],height:l[h+3],rgb:d});f=this,window.api.destroy_buffer(c),setTimeout(function(){f.computeWaveformPoints(t,n+1,a.concat(p),function(e){r(p.concat(e))})},100);case 19:case"end":return e.stop()}},e,this)}));return function(t,n,a,r){return e.apply(this,arguments)}}()}]),e}(),Cd=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"convertSecondsToSpace",value:function(e){return e/this.props.buffer.duration*this.props.width}},{key:"render",value:function(){var e=this,t="#0062ff";return this.props.showingOnsets||(t="#000010"),this.props.sampler.onsets.map(function(n,a){return r.a.createElement(b.Rect,{x:e.convertSecondsToSpace(n/1e3-e.props.zoomedStartTime),y:0,width:e.isSelectedOnset(a)?e.getOnsetWidth(a):1,height:e.props.height,opacity:e.isSelectedOnset(a)?.4:1,fill:e.isSelectedOnset(a)?"red":t})})}},{key:"getOnsetWidth",value:function(e){var t=this.props.sampler.onsets;return e===t.length-1?this.convertSecondsToSpace(this.props.sampler.getDuration()-t[e]/1e3):this.convertSecondsToSpace((t[e+1]-t[e])/1e3)}},{key:"isSelectedOnset",value:function(e){return this.props.selectedOnsets.indexOf(e)>-1}}]),t}(a.Component),Pd=Object(y.b)(function(e,t){return{selectedOnsets:e.waveform.selectedOnsets[t.sampleId]||[]}},null)(Cd),Td=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClick",value:function(){this.props.track.warp(),this.setState(this.state),this.props.onWarp&&this.props.onWarp()}},{key:"isWarped",value:function(){return this.props.track.midiEffects.effects.filter(function(e){return"Warp"===e.name}).filter(function(e){return e.enabled}).length>0}},{key:"render",value:function(){var e=this,t=this.props.isWarped?"warp-button selected":"warp-button";return r.a.createElement("div",{onClick:function(){return e.onClick()},className:t},"Warp")}}]),t}(a.Component),jd=Object(y.b)(function(e,t){var n=t.track.subSequence.id;return{isWarped:e.tracks.trackWarps[n]&&e.tracks.trackWarps[n][t.track.trackNumber]}},null)(Td),xd=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={playTicks:{}},n.onTriggerSample=n.onTriggerSample.bind(Object(p.a)(n)),n.onReleaseSample=n.onReleaseSample.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener(oo,this.onTriggerSample),window.addEventListener(co,this.onReleaseSample)}},{key:"componentWillUnmount",value:function(){window.removeEventListener(oo,this.onTriggerSample),window.removeEventListener(co,this.onReleaseSample)}},{key:"onReleaseSample",value:function(e){var t=this;setTimeout(function(){Object.keys(t.state.playTicks).forEach(function(e){return clearInterval(e)}),t.setState({playTicks:{}})},e)}},{key:"onTriggerSample",value:function(e){var t=this;if(!(Object.keys(this.state.playTicks).length>=10)){var n=e.time,a=e.transpose,r=Math.pow(2,a/12);setTimeout(function(){var n=0,a=(new Date).getTime(),s=setInterval(function(){var i=(new Date).getTime();n=(i-a)/1e3;var o=t.state.playTicks;o[s]=t.props.convertSecondsToSpace(e.startTime+n*r),e.duration&&n>e.duration&&(clearInterval(s),delete o[s]),t.setState(t.state)},80),i=t.props.convertSecondsToSpace(e.startTime);t.state.playTicks[s]=i,t.setState(t.state)},n)}}},{key:"render",value:function(){var e=this;return Object.values(this.state.playTicks).map(function(t){return r.a.createElement(b.Rect,{x:t,y:0,width:2,height:e.props.height,fill:"rgb(35, 249, 111)"})})}}]),t}(a.Component),Nd=new U.a,qd=new wd(yd,kd),Md=function(e){function t(e){var n,a;Object(o.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,e))).state=(n={x:0,slicing:!1,dragging:!1,end:null,buffer:e.buffer,isPlaying:!1,pts:[],slices:e.slices,fetchedSlices:void 0},Object(_e.a)(n,"dragging",!1),Object(_e.a)(n,"selection",null),Object(_e.a)(n,"zoomedBuffer",void 0),Object(_e.a)(n,"zommedIn",!1),Object(_e.a)(n,"zoomedStartTime",0),Object(_e.a)(n,"zoomedScale",1),Object(_e.a)(n,"selectedRecording",a.props.track.selectedRecording),n),a.scale=1,a.width=bd(a.props.div),a.height=e.height||kd,qd.width!==bd(e.div)&&(qd=new wd(bd(e.div),a.height)),a.markersDragging=!1;new K.a(a.props.soundId);return a.state.start=a.convertSecondsToSpace(e.start)/2,a.state.startX=a.convertSecondsToSpace(e.start),a.state.end=a.convertSecondsToSpace(e.end)/2,a.state.endX=a.convertSecondsToSpace(e.end),a.props.isReversed?qd.getReversedWaveform(a.props.soundId,a.props.buffer).then(function(e){a.setState({pts:e})}):qd.getWaveform(a.props.soundId,a.props.buffer).then(function(e){a.setState({pts:e})}),a.convertSpaceToSeconds.bind(Object(p.a)(a)),a.computeWaveformPoints.bind(Object(p.a)(a)),a.onWheel=a.onWheel.bind(Object(p.a)(a)),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.hideButtons||window.addEventListener("mousewheel",this.onWheel,{passive:!1});var e=document.getElementsByClassName("sound-waveform")[0];this.setState({xBounds:e.getBoundingClientRect().x})}},{key:"componentWillUnmount",value:function(){this.props.hideButtons||window.removeEventListener("mousewheel",this.onWheel)}},{key:"shouldComponentUpdate",value:function(e){var t=this;return(qd.width!==e.width||bd(e.div))&&(qd=new wd(bd(e.div),this.height),this.width=e.width||bd(e.div)),this.props.isReversed==e.isReversed&&e.soundId===this.props.soundId&&e.track.selectedRecording===this.state.selectedRecording||(this.state.selectedRecording=e.track.selectedRecording,e.isReversed?qd.getReversedWaveform(e.soundId,e.buffer).then(function(e){t.setState({pts:e})}):qd.getWaveform(e.soundId,e.buffer).then(function(e){t.setState({pts:e})})),!0}},{key:"computeWaveformPoints",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n,a,r){var s,i,o,c,u,l,p,h,d,f,m;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.index++,s=this.index,i=this.width,!((n+1)*i>this.width)){e.next=6;break}return r([]),e.abrupt("return");case 6:if(o=Math.floor(t.length/this.width),c=(c=t.getChannelData(0)).subarray(i*n*o,i*(n+1)*o),u=window.api.create_buffer(c.length),Math.min((n+1)*i,this.width),window.Module.HEAPF32.set(c,u>>2),window.api.getColoredWaveform(u,i,this.height,c.length,o,i*n),l=window.api.get_result_pointer(),p=new Uint16Array(window.Module.HEAP16.buffer,l,7*i),h=[],!(s<this.index)){e.next=18;break}return e.abrupt("return");case 18:for(d=0;d<7*i;d+=7)f=[p[d+4],p[d+5],p[d+6]],h.push({x:p[d],y:p[d+1],width:p[d+2],height:p[d+3],rgb:f});if(m=this,!(s<this.index)){e.next=22;break}return e.abrupt("return");case 22:m.state.pts=a.concat(h),m.setState(m.state),window.api.destroy_buffer(u);case 25:case"end":return e.stop()}},e,this)}));return function(t,n,a,r){return e.apply(this,arguments)}}()},{key:"convertSpaceToSeconds",value:function(e){return(this.state.zoomedIn?this.state.zoomedBuffer:this.props.buffer).duration*e/this.width}},{key:"convertSecondsToSpace",value:function(e){return e/(this.state.zoomedIn?this.state.zoomedBuffer:this.props.buffer).duration*this.width}},{key:"newSlice",value:function(e){this.state.slicing&&(this.props.sampler.newSlice(this.convertSpaceToSeconds(e.evt.layerX)),this.state.slices=this.props.sampler.slices,this.state.slicing=!1,this.setState(this.state),this.props.onSelectSlice(this.state.slices.length-1))}},{key:"getSlices",value:function(){var e=this,t=this.props.sampler.slices.map(function(t,n){var a=t.getCopy();return a.startTime-=e.state.zoomedStartTime,a.endTime-=e.state.zoomedStartTime,a.i=n,a});t=t.filter(function(e){return e.startTime>=0});var n=-1;for(var a in t)if(t[a].i===this.props.selectedSlice){n=a;break}return-1===n?t:(n=t.splice(n,1)).concat(t)}},{key:"onClickShowOnsets",value:function(){this.props.setShowOnsets(!this.props.showingOnsets)}},{key:"onClickAddSlice",value:function(e){if(e.target.blur(),this.props.showingOnsets&&this.selectedOnsets.length>0){for(var t in this.selectedOnsets){var n=this.onsets[this.selectedOnsets[t]],a=this.onsets[this.selectedOnsets[t]+1];this.props.sampler.newSlice(n/1e3,a/1e3),this.state.slices=this.props.sampler.slices,this.props.onSelectSlice(this.state.slices.length-1)}return this.props.setSelectedOnsets([]),void this.props.setShowOnsets(!1)}if(null!==this.state.selection){var r=this.convertSpaceToSeconds(this.state.selection.start),s=this.convertSpaceToSeconds(this.state.selection.end);if(s-r<.01)return;this.props.sampler.newSlice(this.state.zoomedStartTime+r,s+this.state.zoomedStartTime),this.setState({selection:null,slices:this.props.sampler.slices}),this.props.onSelectSlice(this.state.slices.length-1)}}},{key:"onClickDeleteSlice",value:function(){this.props.sampler.deleteSlice(this.props.selectedSlice),this.setState(this.state)}},{key:"onClickAutoSlice",value:function(){var e=this;this.props.track.sample.noteSequence.notes.forEach(function(t){e.props.sampler.newSlice(t.startTime,t.endTime)}),this.setState(this.state)}},{key:"onClickLoadSlices",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n=this;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.props.decentralized){e.next=9;break}return t=new K.a(this.props.soundId),this.props.sampler.slices=[],this.setState(this.state),e.next=6,t.fetchSlices();case 6:e.sent.forEach(function(e){return n.props.sampler.newSlice(e.startTime,e.endTime)}),this.setState(this.state);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onClickSaveSlices",value:function(){if(this.props.decentralized){var e=this.props.sampler.slices.map(function(e){return Math.floor(1e3*e.startTime)}),t=this.props.sampler.slices.map(function(e){return Math.floor(1e3*e.endTime)});this.props.soundId;R.a.newSlices(this.props.soundId,e,t)}}},{key:"onMouseDown",value:function(e){var t=e.evt.layerX;if(!this.markersDragging){if(this.props.showingOnsets){for(var n=1e3*(this.state.zoomedStartTime+this.convertSpaceToSeconds(t)),a=-1,r=0;r<this.onsets.length;r++){this.onsets[r]<n&&(r===this.onsets.length-1?a=r:this.onsets[r+1]>n&&(a=r))}if(-1!==a){var s=this.selectedOnsets.indexOf(a);if(s>-1){var i=Object(ge.a)(this.selectedOnsets);i.splice(s,1),this.props.setSelectedOnsets(i)}else this.props.setSelectedOnsets([].concat(Object(ge.a)(this.selectedOnsets),[a]))}}this.state.dragging?this.setState({dragging:!1}):this.setState({selection:{start:t,end:t},dragging:!0})}}},{key:"onMouseMove",value:function(e){var t=e.evt.layerX;if(this.markersDragging)return t=Math.max(0,t-this.state.offset),void this.changeTheSlice(this.convertSpaceToSeconds(t)+this.state.zoomedStartTime);this.state.mouseX=e.evt.layerX,this.state.dragging&&this.setState({selection:{start:this.state.selection.start,end:e.evt.layerX}})}},{key:"changeTheSlice",value:function(e){var t=this.props.sampler.slices;if(void 0!==this.state.startSliceDragging){var n=t[this.state.startSliceDragging];if(e>n.endTime)return;this.props.sampler.slice(this.state.startSliceDragging,e,n.endTime)}else if(void 0!==this.state.endSliceDragging){var a=t[this.state.endSliceDragging];if(a.startTime>e)return;this.props.sampler.slice(this.state.endSliceDragging,a.startTime,e)}}},{key:"endDrag",value:function(e){if(this.markersDragging)return this.state.startSliceDragging=void 0,this.state.endSliceDragging=void 0,void(this.markersDragging=!1);this.state.dragging=!1}},{key:"scrollWaveform",value:function(e){e/=700*this.scale/this.duration;var t=this.state.zoomedStartTime||0;t+=e;var n=this.buffer.duration+this.state.zoomedStartTime;if(n+=e,!(t<0||n>this.duration)){var a=q.a.Master.context.sampleRate;this.state.zoomedStartTime=t;var r=T(this.props.buffer,t*a,n*a,q.a.Master.context);this.state.zoomedBuffer=r,this.setState(this.state),this.computeWaveformPoints(r,0,[],function(e){})}}},{key:"zoomIn",value:function(e,t){if((t*=2)<=2)this.zoomOut();else{var n=this.state.zoomedStartTime||0,a=this.duration/t,r=n+this.convertSpaceToSeconds(e)-a*e/this.width,s=r+a;if(r<0&&(r=0),!(s-r<.001)){var i=this.props.buffer;this.state.zoomedStartTime=r,this.state.zoomedScale=t,this.state.zoomedIn=!0;var o=q.a.Master.context.sampleRate,c=T(i,r*o,s*o,q.a.Master.context);this.state.zoomedBuffer=c,this.computeWaveformPoints(c,0,[],function(e){})}}}},{key:"zoomOut",value:function(){this.state.zoomedIn=!1,this.state.zoomedStartTime=0,this.state.zoomedBuffer=void 0,this.state.selection=null,this.computeWaveformPoints(this.props.buffer,0,[],function(e){})}},{key:"markerDraggingStarted",value:function(){this.markersDragging=!0,this.setState({selection:null,dragging:!1})}},{key:"markerDraggingEnded",value:function(){this.markersDragging=!1,this.setState({selection:null,dragging:!1})}},{key:"onClickSyncTempo",value:function(){var e=this.props.sampler;e.tempoSynced?e.unsyncTempo():e.syncTempo(q.a.Transport.bpm.value),document.activeElement.blur(),this.setState(this.state)}},{key:"onMouseOver",value:function(e){this.props.setContextualHelp("TRACK_WAVEFORM")}},{key:"onWheel",value:function(e){if(e.ctrlKey){e.preventDefault(),e.stopPropagation();var t=this.scale-.01*e.deltaY;t<=1&&(t=1),this.zoomIn(this.state.mouseX,t),this.scale=t}else{var n=e.deltaX;Math.abs(n)>0&&(e.preventDefault(),this.scrollWaveform(n))}}},{key:"onStartSliceStartedDragging",value:function(e,t){e-=this.state.xBounds,this.markersDragging=!0,this.props.onSelectSlice(t),this.state.offset=e,this.state.startSliceDragging=t}},{key:"onStartSliceStoppedDragging",value:function(e){this.markersDragging=!1,this.state.startSliceDragging=void 0}},{key:"onEndSliceStartedDragging",value:function(e,t){e-=this.state.xBounds,this.markersDragging=!0,this.props.onSelectSlice(t),this.state.endSliceDragging=t,this.state.offset=e}},{key:"onEndSliceStoppedDragging",value:function(e){this.markersDragging=!1,this.state.endSliceDragging=void 0}},{key:"onChangeOnsetThreshold",value:function(e){this.props.setOnsetThreshold(e),this.props.sampler.analyze(),this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.state.pts,n=null==this.state.selection?{start:0,end:0}:this.state.selection,a=this.state.zoomedIn?this.state.zoomedBuffer:this.props.buffer,s=this.getSlices()[this.props.selectedSlice],i=(void 0===s||this.convertSecondsToSpace(s.startTime),void 0===s||this.convertSecondsToSpace(s.endTime),void 0===s?"black":Nd.getColor(this.props.selectedSlice)),o=this.props.sampler.tempo,c=(this.props.sampler,r.a.createElement("div",{className:"sound-waveform details-view",onMouseOver:function(t){return e.onMouseOver(t)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)}},r.a.createElement(b.Stage,{onMouseDown:function(t){return e.onMouseDown(t)},onMouseUp:function(t){return e.endDrag(t)},onMouseMove:function(t){return e.onMouseMove(t)},onMouseLeave:function(t){return e.endDrag(t)},width:this.width+20,height:this.height},r.a.createElement(b.Layer,null,r.a.createElement(b.Rect,{onClick:function(t){return e.newSlice(t)},x:0,y:0,width:this.width,height:this.height,fill:"black"}),r.a.createElement(Pd,{height:this.height,width:this.width,buffer:a,showingOnsets:this.props.showingOnsets,zoomedStartTime:this.state.zoomedStartTime,sampleId:this.props.track.sample.getId(),sampler:this.props.sampler,onUpdate:function(){return e.setState(e.state)}}),this.markersDragging?r.a.createElement(b.Rect,null):r.a.createElement(b.Rect,{x:n.start,y:0,width:n.end-n.start,height:this.height,fill:"orange"})),r.a.createElement(b.Layer,null,t.map(function(e){return r.a.createElement(b.Rect,{x:e.x,y:e.y,width:e.width,height:e.height,fill:"rgb("+e.rgb[0]+","+e.rgb[1]+","+e.rgb[2]+")"})})),r.a.createElement(b.Layer,null,r.a.createElement(xd,{height:this.height,convertSecondsToSpace:function(t){return e.convertSecondsToSpace(t-e.state.zoomedStartTime)}})),r.a.createElement(b.Layer,null,this.getSlices().map(function(t,n){return r.a.createElement(Od,{key:"marker-"+n,height:e.height,div:e.props.div,transposeParameter:e.props.track.trackData.transposeParameter,scale:e.state.zoomedScale,onStartSliceStartedDragging:function(n){return e.onStartSliceStartedDragging(n,t.i)},onStartSliceStoppedDragging:function(){return e.onStartSliceStoppedDragging(t.i)},onEndSliceStartedDragging:function(n){return e.onEndSliceStartedDragging(n,t.i)},onEndSliceStoppedDragging:function(){return e.onEndSliceStoppedDragging(t.i)},onKeyDown:e.props.onKeyDown,isSelectedSlice:e.props.selectedSlice===t.i,buffer:a,onSelectSlice:function(){return e.props.onSelectSlice(t.i)},track:e.props.track,sliceNumber:t.i,sampler:e.props.sampler,zoomedStartTime:e.state.zoomedStartTime,color:e.props.color||Nd.getColor(t.i)})})))));return this.props.hideButtons?c:r.a.createElement("div",{className:"waveform-container"},c,r.a.createElement("div",{className:"common-button blue-button",onClick:function(t){return e.onClickAddSlice(t)}},this.selectedOnsets.length>0?"ADD SLICES":"ADD SLICE"),r.a.createElement("div",{className:"common-button blue-button",onClick:function(t){return e.onClickDeleteSlice(t)}},"DELETE SLICE ",r.a.createElement("div",{style:{backgroundColor:i},className:"dot"})),r.a.createElement("div",{onClick:function(){return e.onClickShowOnsets()},className:"common-button blue-button"},this.props.showingOnsets?"HIDE ONSETS":"SELECT ONSETS"),r.a.createElement(O,{condition:this.state.zoomedStartTime>0},r.a.createElement("div",{onClick:function(){return e.zoomOut()},className:"common-button blue-button"},"ZOOM OUT")),r.a.createElement(jd,{track:this.props.track,onWarp:function(){return e.setState(e.state)}}),r.a.createElement("div",{className:"sample-tempo"},null==o?"":"TEMPO: "+o),r.a.createElement(O,{condition:this.props.showingOnsets},r.a.createElement("div",{className:"onset-threshold-container"},r.a.createElement("div",null,"Onset Threshold: ",this.props.onsetThreshold," db"),r.a.createElement(fe.a,{value:this.props.onsetThreshold,change:function(t){return e.onChangeOnsetThreshold(t.target.value)},step:.01,max:6,min:-10,orientation:"horizontal",reversed:!1}))))}},{key:"duration",get:function(){return this.props.buffer.duration}},{key:"onsets",get:function(){return this.props.sampler.onsets}},{key:"selectedOnsets",get:function(){return this.props.track.sequencerEngine.store.getState().waveform.selectedOnsets[this.props.track.sample.getId()]||[]}},{key:"buffer",get:function(){return this.state.zoomedBuffer||this.props.buffer}}]),t}(a.Component),Dd=Object(y.b)(function(e){return{onsetThreshold:e.waveform.onsetThreshold,showingOnsets:e.waveform.showingOnsets}},function(e,t){return{setContextualHelp:function(t){return e(Object(w.V)(t))},setOnsetThreshold:function(t){return e(Object(w.cc)(t))},setSelectedOnsets:function(n){return e(Object(w.Pc)(t.track.sample.getId(),n))},setShowOnsets:function(t){return e(Object(w.sd)(t))}}})(Md),Ad=new U.a;var Rd=Object(y.b)(function(e,t){return{isOn:t.sampler.on||1===t.instrument.mixMode||t.isSelectedSampler}},function(e,t){return{setSampleDragging:function(t){return e(Object(w.Ac)(t))}}})(function(e){var t=e.sample;if(void 0===t)return r.a.createElement("div",null);var n={backgroundColor:Ad.getColorForHash(t.getId())},s=t.getThumbnail(),i=function(e){e.stopPropagation()},o=Object(a.useCallback)(function(n){e.setSampleDragging(t)},[t]),c="key-info";return e.isOn&&(c+=" on"),s?r.a.createElement("img",{draggable:!0,onDragStart:o,onDragOver:i,onClick:e.onClickSampler,className:c,src:s}):r.a.createElement("div",{draggable:!0,onDragStart:o,onDragOver:i,onClick:e.onClickSampler,style:n,className:c},e.i+1)});new U.a;var Id=Object(y.b)(function(e,t){return{isPlaying:e.keyboard.lastNotePlayed===t.transpose,mixMode:t.instrument.mixMode}},function(e,t){return{setSampleDragging:function(t){return e(Object(w.Ac)(t))}}})(function(e){var t=Object(a.useState)([]),n=Object(Z.a)(t,2),s=n[0],i=n[1],o="key";e.note.isBlackNote()?o+=" black":o+=" white";var c=e.note.getTranspose(),u=(s.map(function(e){return e.sample}),Object(a.useCallback)(function(t){t.stopPropagation(),e.sampleDragging&&(e.instrument.newSample(c,e.sampleDragging).then(function(e){i(e.samplers)}),e.setSampleDragging(void 0))},[e.sampleDragging,i])),l=Object(a.useCallback)(function(t){if(void 0===t){var n=s.find(function(e){return e.on});e.onClickSampler(n)}else t!==e.selectedSampler&&(e.onClickSampler(t),e.instrument.selectSampler(c,t))},[c,s,e.onClickSampler,e.selectedSampler,e.mixMode]);Object(a.useEffect)(function(){if(c in e.instrument.samplers){var t=e.instrument.samplers[c];i(t)}},[e.instrument.samplers[c]],e.selectedSampler);var p="key-container";return s.indexOf(e.selectedSampler)>-1&&void 0!==e.selectedSampler&&(p+=" selected"),e.isPlaying&&(p+=" last-played"),r.a.createElement("div",{className:p},r.a.createElement("div",{onClick:function(){return l()},onDrop:u,className:o}),s.map(function(t,n){return r.a.createElement(Rd,{i:n,key:"sample-thumb-"+n,isSelectedSampler:t===e.selectedSampler,sampler:t,instrument:e.instrument,onClickSampler:function(){return l(t)},sample:t.sample})}))});new U.a;function Ld(e){var t=bs.a.NOTES.map(function(t){return(t=t.getCopy()).octave=e.octave,t});return r.a.createElement("div",{className:"octave"},r.a.createElement("div",{className:"octave-label"},t[0].toString()),t.map(function(t){return r.a.createElement(Id,{key:t.toString(),selectedSampler:e.selectedSampler,onClickSampler:e.onClickSampler,sampleDragging:e.sampleDragging,octave:e.octave,transpose:t.getTranspose(),note:t,instrument:e.instrument})}))}var Fd=Object(a.memo)(function(e){var t=e.selectedSampler,n=e.onClickSampler,a=e.sampleDragging,s=e.instrument;return r.a.createElement("div",{className:"horizontal-piano-container"},r.a.createElement("div",{className:"horizontal-piano"},r.a.createElement(Ld,{selectedSampler:t,onClickSampler:n,octave:1,instrument:s,sampleDragging:a}),r.a.createElement(Ld,{selectedSampler:t,onClickSampler:n,octave:2,instrument:s,sampleDragging:a}),r.a.createElement(Ld,{selectedSampler:t,onClickSampler:n,octave:3,instrument:s,sampleDragging:a}),r.a.createElement(Ld,{selectedSampler:t,onClickSampler:n,octave:4,instrument:s,sampleDragging:a}),r.a.createElement(Ld,{selectedSampler:t,onClickSampler:n,octave:5,instrument:s,sampleDragging:a}),r.a.createElement(Ld,{selectedSampler:t,onClickSampler:n,octave:6,instrument:s,sampleDragging:a}),r.a.createElement(Ld,{selectedSampler:t,onClickSampler:n,octave:7,instrument:s,sampleDragging:a})))}),Vd=10;function Bd(e){function t(e){var t=e.getName();return void 0===t?"":t.length>=Vd?t.slice(0,Vd)+"...":t}function n(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.track;if(void 0!==n)return{value:n,label:n.trackNumber+1+". "+t(n)}}var a=e.className?e.className+" tracks-dropdown-container":"tracks-dropdown-container";return r.a.createElement("div",{className:a},r.a.createElement(pp.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:function(){var t=e.sequencerEngine.tracks.filter(function(t){return void 0===e.trackToSkip||t!==e.trackToSkip}).map(n);return[{label:"None",value:null}].concat(Object(ge.a)(t))}(),onChange:function(t){return e.onSelectTrack(t.value)},value:n(),placeholder:"Track"}))}function Ud(e){var t=e.sequencerEngine.lfosTrack.lfos.map(function(e){return e.lfo}),n=e.sequencerEngine.envelopes;return r.a.createElement("div",{className:"parameter-modulators"},r.a.createElement("div",{className:"lfo-buttons"},t.map(function(n){return r.a.createElement(Bl,{lfo:n,lfos:t,parameter:e.parameter})})),r.a.createElement("div",{className:"envelope-buttons"},n.map(function(t,a){return r.a.createElement(Hl,{parameter:e.parameter,envelope:t,envelopes:n})})))}var Hd=Object(a.memo)(function(e){var t=e.isExponential,n=e.name,s=e.min,i=e.max,o=e.round,c=e.parameter,u=e.value,l=e.sequencerEngine,p=Object(a.useState)(!1),h=Object(Z.a)(p,2),d=h[0],f=h[1],m=Object(a.useCallback)(function(){l&&f(!0)},[f]),v="";d&&(v=r.a.createElement(Ud,{sequencerEngine:l,parameter:c})),s=t?Math.cbrt(s):s,i=t?Math.cbrt(i):i;var g,b=t?Math.cbrt(u):u;return r.a.createElement("div",{className:"parameter-knob-container"},r.a.createElement(te.Knob,{size:40,angleOffset:220,angleRange:280,value:b,min:s,max:i,onChange:function(e){return n=e,document.activeElement.blur(),t&&(n=Math.pow(n,3)),o&&(n=Math.round(n)),void c.set(n);var n}},r.a.createElement(te.Arc,{arcWidth:3,color:"white",background:"#6c757a"}),r.a.createElement(te.Pointer,{width:3,height:11,radius:8,type:"rect",color:"white"})),r.a.createElement("div",{onClick:m,className:"knob-label"},n," : ",(g=u,Math.floor(10*g)/10)),v)});Object(y.b)(function(e,t){return void 0===t.parameter?{value:0}:{value:e.effects.effectParameters[t.parameter.id]}},null)(Hd);function Jd(e){var t=Object(a.useState)(void 0),n=Object(Z.a)(t,2),s=n[0],i=n[1],o=Object(a.useCallback)(function(t){e.instrument.interpolationMode=t.value,i(t.value)},[e.instrument]);return Object(a.useEffect)(function(){i(e.instrument.interpolationMode)},[]),r.a.createElement("div",{className:"interpolation-dropdown-container"},r.a.createElement("div",{className:"label"},"Interpolation:"),r.a.createElement(pp.a,{className:"interpolation-dropdown",controlClassName:"interpolation-control-dropdown",arrowClassName:"interpolation-arrow-dropdown",options:zd,onChange:o,value:Gd(s),placeholder:"Interpolation"}))}function Gd(e){return e===Oc?{value:Oc,label:"Closest"}:{value:wc,label:"Octave"}}var zd=[{value:Oc,label:"Closest"},{value:wc,label:"Octave"}];function _d(e){var t=Object(a.useState)(void 0),n=Object(Z.a)(t,2),s=n[0],i=n[1],o=Object(a.useCallback)(function(t){e.instrument.mixMode=t.value,i(t.value)},[e.instrument]);return Object(a.useEffect)(function(){i(e.instrument.mixMode)},[]),r.a.createElement("div",{className:"interpolation-dropdown-container"},r.a.createElement("div",{className:"label"},"Mode:"),r.a.createElement(pp.a,{className:"interpolation-dropdown",controlClassName:"interpolation-control-dropdown",arrowClassName:"interpolation-arrow-dropdown",options:Kd,onChange:o,value:Wd(s),placeholder:"Mode"}))}function Wd(e){return Kd.find(function(t){return t.value===e})}var Kd=[{value:1,label:"Mix"},{value:Cc,label:"Alternate"},{value:Pc,label:"Round Robin"}],Yd=Object(a.memo)(function(e){var t=e.name,n=e.parameter,a=e.value,s=e.onClick,i="parameter-button";e.isSelected&&(i+=" selected");var o;return r.a.createElement("div",{onClick:function(){return s(n)},className:i},r.a.createElement("div",{className:"parameter-name"},t),r.a.createElement("div",{className:"parameter-value"},(o=a,Math.floor(100*o)/100)))}),Qd=Object(y.b)(function(e,t){return void 0===t.parameter?{value:0}:{value:e.effects.effectParameters[t.parameter.parameter.id]}},null)(Yd),Xd=Object(y.b)(function(e,t){return void 0===t.parameter?{value:0}:{value:t.parameter.parameter.get()}},null)(function(e){var t=e.parameter.parameter,n=t.min,a=t.max,s=t.value;return s=Math.cbrt(s),void 0!==e.parameter.min&&(n=e.parameter.min),void 0!==e.parameter.max&&(a=e.parameter.max),r.a.createElement("div",{className:"simple-parameter-slider"},r.a.createElement(fe.a,{value:s,change:function(t){return e.onChange(t)},step:.01,max:Math.cbrt(a),min:Math.cbrt(n),orientation:"horizontal",reversed:!1}))}),Zd=function(e){function t(e){var n;Object(o.a)(this,t),n=Object(u.a)(this,Object(l.a)(t).call(this,e));var a=e.parameters,r=a[Object.keys(a)[0]];return n.state={selectedParameter:r},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){if(e.parameters!==this.props.parameters){var t=e.parameters,n=t[Object.keys(t)[0]];this.state.selectedParameter=n}return!0}},{key:"onSelect",value:function(e){this.setState({selectedParameter:e})}},{key:"onChangeValue",value:function(e){this.state.selectedParameter.parameter.set(Math.pow(e.target.value,3))}},{key:"render",value:function(){var e=this,t=this.props.parameters,n=Object.keys(t);return r.a.createElement("div",{className:"multiple-parameter-slider"},r.a.createElement("div",{className:"parameters"},n.map(function(n,a){return r.a.createElement(Qd,{key:"parameter-"+a,isSelected:t[n]===e.state.selectedParameter,onClick:function(t){return e.onSelect(t)},name:n,parameter:t[n]})})),r.a.createElement("div",{className:"slider-and-modulators"},r.a.createElement(Xd,{onChange:function(t){return e.onChangeValue(t)},parameter:this.state.selectedParameter}),r.a.createElement(Ud,{sequencerEngine:this.props.sequencerEngine,parameter:this.state.selectedParameter.parameter})))}}]),t}(a.Component);function $d(e){var t=Object(a.useState)(800),n=Object(Z.a)(t,2),s=n[0],i=n[1],o=Object(a.useState)(!1),c=Object(Z.a)(o,2),u=c[0],l=c[1],p=Object(a.useCallback)(Object(g.a)(v.a.mark(function t(){return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:l(!0),setTimeout(Object(g.a)(v.a.mark(function t(){return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.instrument.findLoop(void 0,.001,s);case 2:l(!1);case 3:case"end":return t.stop()}},t)})),50);case 2:case"end":return t.stop()}},t)})),[s,l]);return console.log("rendering isLoading = "+u),r.a.createElement("div",{className:"loop-finder"},r.a.createElement("div",{className:"samples-length-label"},"Length: ",s," - ",s+500," samples"),r.a.createElement(fe.a,{value:s,change:function(e){return i(e.target.value)},step:1,max:2e4,min:200,orientation:"horizontal",reversed:!1}),r.a.createElement("div",{onClick:function(){return p()},className:"loop-button"},u?r.a.createElement(V.a,{sizeUnit:"px",size:10,color:"#123abc",loading:u}):"New Loop"))}var ef=1,tf=2,nf=3,af=4,rf=5;function sf(e){var t=e.instrument,n=e.sequencerEngine,s=Object(a.useState)(ef),i=Object(Z.a)(s,2),o=i[0],c=i[1],u="";return u=o===ef?r.a.createElement(Zd,{sequencerEngine:n,parameters:{Atk:{parameter:t.ampAttackParameter},Dcy:{parameter:t.ampDecayParameter},Sus:{parameter:t.ampSustainParameter},Rel:{parameter:t.ampReleaseParameter}}}):o===nf?r.a.createElement(Zd,{sequencerEngine:n,parameters:{Strt:{parameter:t.loopStartParameter},Len:{parameter:t.loopLengthParameter},Smth:{parameter:t.smoothParameter}}}):o===tf?r.a.createElement(Zd,{sequencerEngine:n,parameters:{Gld:{parameter:t.glideParameter},Detu:{parameter:t.detuneParameter}}}):o===af?r.a.createElement($d,{instrument:t}):r.a.createElement(dp,{parameters:t.parameters}),r.a.createElement("div",{className:"top-parameter-container"},r.a.createElement("div",{className:"tab-options"},r.a.createElement(of,{option:ef,name:"ADSR",isSelected:o===ef,onClick:c}),r.a.createElement(of,{option:tf,name:"Pitch",isSelected:o===tf,onClick:c}),r.a.createElement(of,{option:nf,name:"Loop",isSelected:o===nf,onClick:c}),r.a.createElement(of,{option:af,name:"Find Loops",isSelected:o===af,onClick:c}),r.a.createElement(of,{option:rf,name:"Mods",isSelected:o===rf,onClick:c})),r.a.createElement("div",{className:"adsr-container"},u))}function of(e){var t="parameter-option";return e.isSelected&&(t+=" selected"),r.a.createElement("div",{onClick:function(){return e.onClick(e.option)},className:t},e.name)}var cf=new U.a;function uf(e){return void 0===e.sampler?r.a.createElement("div",null):r.a.createElement("div",{className:"sampler-parameters"},r.a.createElement("div",{className:"parameters-row"},r.a.createElement(Zd,{sequencerEngine:e.sequencerEngine,parameters:{Trspe:{parameter:e.sampler.transposeParameter},Detun:{parameter:e.sampler.detuneParameter},Vol:{parameter:e.sampler.volumeParameter}}})),r.a.createElement("div",{className:"loop-parameter"},r.a.createElement(Jp,{name:"Loop",parameter:e.sampler.loopParameter}),r.a.createElement("div",{className:"sample-name"},e.sampler.sample&&e.sampler.sample.name?(t=e.sampler.sample.name).length>=16?t.substring(0,16):t:""),r.a.createElement("div",{onClick:e.onDeleteSample,className:"sample-delete-button"},"Delete")));var t}var lf=Object(y.b)(function(e,t){var n=t.track.selectedSampler;return{sampleDragging:e.selector.sampleDragging,sampleSlices:n?e.tracks.sampleSlices[n.id]:void 0,presetDragging:e.presets.presetDragging}},function(e,t){return{setSampleDragging:function(t){return e(Object(w.Ac)(t))},setPresetDragging:function(t){return e(Object(w.sc)(t))}}})(function(e){var t=Object(a.useState)(void 0),n=Object(Z.a)(t,2),s=(n[0],n[1]),i=e.track.instrument;Object(a.useCallback)(function(e){i.connectToTrack(e),s(e)}),Object(a.useEffect)(function(){s(i.connectedTrack)},[i.connectedTrack]);var o=Object(a.useState)(e.track.selectedSampler),c=Object(Z.a)(o,2),u=c[0],l=c[1],p=Object(a.useState)(""),h=Object(Z.a)(p,2),d=h[0],f=h[1],m=Object(a.useCallback)(function(t){e.instrument.deleteSampler(u),f(""),l(void 0)},[u,l,e.instrument,f]),v=Object(a.useCallback)(function(t){void 0!==t&&(e.track.sample=t.sample,e.track.selectedSampler=t,u===t||l(t))},[u,l,e.track]);Object(a.useCallback)(function(){i.playSampler(u)},[u]),Object(a.useEffect)(function(){if(u&&u.baseBuffer&&e.track.sample){var t=cf.getColorForHash(u.sample.getId()),n=r.a.createElement("div",null,r.a.createElement(Dd,{color:t,div:document.getElementsByClassName("sampled-instrument")[0],track:e.track,height:80,fullWidth:!1,hideButtons:!0,selectedSlice:0,slices:u.slices,isReversed:u.isReversed(),sampler:u,decentralized:!0,soundId:u.sample.getId(),onKeyDown:function(){return[]},onSelectSlice:function(){return[]},buffer:u.baseBuffer.get()}));f(n)}},[u,f,e.sampleSlices,e.track]);var g=Object(a.useCallback)(function(t){t.stopPropagation(),e.sampleDragging?(e.instrument.newSample(void 0,e.sampleDragging).then(function(t){var n=t.sampler;e.track.sample=n.sample,e.track.selectedSampler=n,l(n)}),e.setSampleDragging(void 0)):e.presetDragging&&(e.track.auditionPreset(e.presetDragging),e.setPresetDragging(void 0))},[e.track,l,e.sampleDragging,e.presetDragging,e.setPresetDragging]);return r.a.createElement("div",{onDrop:g,className:"instrument sampled-instrument"},r.a.createElement("div",null,r.a.createElement(Fd,{onClickSampler:v,selectedSampler:u,track:e.track,sampleDragging:e.sampleDragging,instrument:i}),r.a.createElement("div",{className:"parameters-container"},r.a.createElement("div",{className:"pane"},r.a.createElement(sf,{sequencerEngine:e.sequencerEngine,instrument:e.instrument}),r.a.createElement(uf,{onDeleteSample:m,sequencerEngine:e.sequencerEngine,sampler:u})),r.a.createElement("div",{className:"advanced-controls"},r.a.createElement(Jd,{instrument:i}),r.a.createElement(_d,{instrument:i}),r.a.createElement(Jp,{name:"Monophonic",parameter:i.monophonicParameter}),r.a.createElement(Jp,{name:"Loop All",parameter:i.loopParameter}))),d))}),pf=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getSelectedOscillatorType",value:function(){return this.props.oscillator.oscillatorType}},{key:"onSelectOscillatorType",value:function(e){var t="none"===e.value?void 0:e.value;this.props.sequencerEngine.operationManager.dispatch(Gi(this.props.oscillator.oscillatorTypeParameter,t)),this.setState(this.state)}},{key:"render",value:function(){var e,t=this;return r.a.createElement("div",null,r.a.createElement("div",{className:"osc-type-dropdown-container"},r.a.createElement(pp.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:hf,onChange:function(e){return t.onSelectOscillatorType(e)},value:(e=this.getSelectedOscillatorType(),hf.filter(function(t){return t.value===e})[0]),placeholder:"Osc. Type"})))}}]),t}(a.Component),hf=[{value:"square",label:"Square"},{value:"sine",label:"Sine"},{value:"triangle",label:"Triangle"},{value:"sawtooth",label:"Sawtooth"},{value:"pwm",label:"PWM"},{value:"pulse",label:"Pulse"},{value:"fatsquare",label:"Fat Square"},{value:"fatsine",label:"Fat Sine"},{value:"fattriangle",label:"Fat Triangle"},{value:"fatsawtooth",label:"Fat Sawtooth"},{value:"fmsquare",label:"FM Square"},{value:"fmsine",label:"FM Sine"},{value:"fmtriangle",label:"FM Triangle"},{value:"fmsawtooth",label:"FM Sawtooth"}];var df=Object(y.b)(function(e,t){return{type:t.oscillator.oscillatorType}},null)(pf),ff=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickPartialCount",value:function(){this.props.oscillator.partialCountParameter.set((this.props.oscillator.partialCountParameter.get()+1)%16)}},{key:"render",value:function(){var e=this;this.props.oscillator;return r.a.createElement("div",{className:"partial-count-container"},r.a.createElement("div",{onClick:function(){return e.onClickPartialCount()},className:"partial-count"},this.props.value),r.a.createElement("div",null,"Partials"))}}]),t}(a.Component),mf=Object(y.b)(function(e,t){var n=t.oscillator.partialCountParameter;return{value:void 0===t.automation||void 0===t.automation.get(n)?e.effects.effectParameters[n.id]:t.automation.get(n).value}},null)(ff),vf=[2,4,6,8,10,12,14,16,18],gf=[200,400,600,800,1e3,1200,1400,1600,1800],bf=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={dragging:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"updateParameter",value:function(e,t){this.props.sequencerEngine.operationManager.dispatch(Gi(e,t))}},{key:"getHarmonicityX",value:function(e){return e/20*242}},{key:"getModulationIndexY",value:function(e){return 176-e/2e3*176}},{key:"getHelperLines",value:function(){return[r.a.createElement(b.Line,{closed:!1,points:[this.harmonicityX,0,this.harmonicityX,180],strokeWidth:1,stroke:"#0c46b2"}),r.a.createElement(b.Line,{closed:!1,points:[0,this.modulationIndexY,242,this.modulationIndexY],strokeWidth:1,stroke:"#0c46b2 "})]}},{key:"getHarmonicityLines",value:function(){var e=this;return vf.map(function(t){return r.a.createElement(b.Line,{closed:!1,points:[e.getHarmonicityX(t),0,e.getHarmonicityX(t),180],strokeWidth:1,stroke:"#1f1f1f"})})}},{key:"getModulationIndexLines",value:function(){var e=this;return gf.map(function(t){return r.a.createElement(b.Line,{closed:!1,points:[0,e.getModulationIndexY(t),242,e.getModulationIndexY(t)],strokeWidth:1,stroke:"#1f1f1f"})})}},{key:"onMouseMove",value:function(e){var t=e.evt.layerX,n=e.evt.layerY;this.state.dragging&&this.setXAndY(t,n)}},{key:"setXAndY",value:function(e,t){this.harmonicity=Math.floor(20*e/242*1e3)/1e3,this.modulationIndex=Math.max(0,Math.floor(2e6*(176-t)/176)/1e3),this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.props.instrument.carrierOscillator;return r.a.createElement("div",null,r.a.createElement(b.Stage,{onMouseMove:function(t){return e.onMouseMove(t)},onClick:function(t){return e.setXAndY(t.evt.layerX,t.evt.layerY)},onMouseLeave:function(t){return e.dragging=!1},width:242,height:180},r.a.createElement(b.Layer,null,r.a.createElement(b.Rect,{width:242,height:180,fill:"black"}),this.getHarmonicityLines(),this.getModulationIndexLines(),this.getHelperLines(),r.a.createElement(b.Circle,{onMouseDown:function(t){return e.dragging=!0},onMouseUp:function(t){return e.dragging=!1},x:this.harmonicityX,y:this.modulationIndexY,radius:8,fill:"#6d6bff",stroke:"#0c46b2",strokeWidth:1}))),r.a.createElement(Gl,{automation:this.props.automation,name:"Harmonicity",parameter:t.harmonicityParameter,lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,hideSlider:!0,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:20,step:.01}),r.a.createElement(Gl,{automation:this.props.automation,name:"Modulation Index",lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,hideSlider:!0,parameter:t.modulationIndexParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:1e3,step:1}))}},{key:"dragging",set:function(e){this.setState({dragging:e})}},{key:"harmonicity",set:function(e){this.updateParameter(this.props.instrument.carrierOscillator.harmonicityParameter,e)},get:function(){return this.props.harmonicity}},{key:"modulationIndex",set:function(e){this.updateParameter(this.props.instrument.carrierOscillator.modulationIndexParameter,e)},get:function(){return this.props.modulationIndex}},{key:"harmonicityX",get:function(){return this.getHarmonicityX(this.harmonicity)}},{key:"modulationIndexY",get:function(){return this.getModulationIndexY(this.modulationIndex)}}]),t}(a.Component),yf=Object(y.b)(function(e,t){var n=t.instrument.carrierOscillator.harmonicityParameter,a=void 0===t.automation||void 0===t.automation.get(n)?e.effects.effectParameters[n.id]:t.automation.get(n).value,r=t.instrument.carrierOscillator.modulationIndexParameter;return{harmonicity:a,modulationIndex:void 0===t.automation||void 0===t.automation.get(r)?e.effects.effectParameters[r.id]:t.automation.get(r).value}},null)(bf),kf=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.instrument.carrierOscillator,t=this.props.instrument.modulatorOscillator;return r.a.createElement("div",{className:"fm-parameters"},r.a.createElement("div",{className:"oscillator-types"},r.a.createElement("div",{className:"oscillator-type"},r.a.createElement(df,{sequencerEngine:this.props.sequencerEngine,oscillator:t}),r.a.createElement(mf,{oscillator:t})),r.a.createElement("div",{className:"mod-label"},"mods"),r.a.createElement("div",{className:"oscillator-type"},r.a.createElement(df,{sequencerEngine:this.props.sequencerEngine,oscillator:e}),r.a.createElement(mf,{oscillator:e}))),r.a.createElement(yf,{sequencerEngine:this.props.sequencerEngine,instrument:this.props.instrument}),r.a.createElement(Gl,{automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,name:"Frequency",parameter:e.oscillatorFrequencyParameter,onParameterChanged:function(){return e.releaseAll()},displayFunction:function(e){return bs.a.fromTranspose(e).toString()},isParameter:!0,min:-32,max:32,step:1}),r.a.createElement(Gl,{automation:this.props.automation,name:"Detune",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:e.detuneParameter,onParameterChanged:function(){return[]},isParameter:!0,min:-100,max:100,step:1}))}}]),t}(a.Component),Ef=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getSelectedOscillatorType",value:function(){return this.props.oscillator.oscillatorType}},{key:"onSelectOscillatorType",value:function(e){var t="none"===e.value?void 0:e.value;this.props.oscillator.oscillatorType=t,this.setState(this.state)}},{key:"render",value:function(){var e=this.props.oscillator;return r.a.createElement("div",{className:"oscillator-component"},r.a.createElement(Gl,{automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,name:"Polyphony",parameter:e.polyphonyParameter,onParameterChanged:function(){return[]},isParameter:!0,min:1,max:16,step:1}),r.a.createElement(Gl,{automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,name:"Glide",parameter:e.portamentoParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:50,step:.1}))}}]),t}(a.Component);var Sf=Ef,Of=(a.Component,[{value:"square",label:"Square"},{value:"sine",label:"Sine"},{value:"triangle",label:"Triangle"},{value:"sawtooth",label:"Sawtooth"},{value:"pwm",label:"PWM"},{value:"pulse",label:"Pulse"},{value:"fatsquare",label:"Fat Square"},{value:"fatsine",label:"Fat Sine"},{value:"fattriangle",label:"Fat Triangle"},{value:"fatsawtooth",label:"Fat Sawtooth"},{value:"fmsquare",label:"FM Square"},{value:"fmsine",label:"FM Sine"},{value:"fmtriangle",label:"FM Triangle"},{value:"fmsawtooth",label:"FM Sawtooth"}]);var wf=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={showMods:!1,showGenetix:!1},n.onClickMods=n.onClickMods.bind(Object(p.a)(n)),n.onClickGenetix=n.onClickGenetix.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickMods",value:function(){this.setState({showMods:!this.state.showMods})}},{key:"onClickGenetix",value:function(){this.setState({showGenetix:!this.state.showGenetix})}},{key:"render",value:function(){var e=this,t=this.props.instrument;return r.a.createElement("div",{className:"instrument fm-synth"},r.a.createElement(O,{condition:!this.state.showMods&&!this.state.showGenetix},r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(kf,{sequencerEngine:this.props.sequencerEngine,instrument:t}),r.a.createElement("div",{className:"instrument-section"},r.a.createElement("div",{className:"instrument-subsection"},r.a.createElement("div",{className:"instrument-subsection-name"},"Filter"),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(Gl,{automation:this.props.automation,name:"Cutoff",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:t.filterCutoffParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:1e4,step:1}),r.a.createElement(Gl,{automation:this.props.automation,name:"Q",sequencerEngine:this.props.sequencerEngine,parameter:t.filterQParameter,lfoEnabled:!0,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:9,step:1}),r.a.createElement(Gl,{automation:this.props.automation,name:"Noise Level",sequencerEngine:this.props.sequencerEngine,parameter:t.noiseVolumeParameter,lfoEnabled:!0,onParameterChanged:function(){return[]},unit:"db",isParameter:!0,min:-100,max:0,step:.1})),r.a.createElement("div",{className:"instrument-subsection"},r.a.createElement(Sf,{automation:this.props.automation,oscillator:t.carrierOscillator,sequencerEngine:this.props.sequencerEngine,instrument:t}))),r.a.createElement("div",{className:"instrument-section"},r.a.createElement("div",{className:"instrument-subsection"},r.a.createElement(pd,{automation:this.props.automation,envelopeOptions:Cf,sequencerEngine:this.props.sequencerEngine,instrument:t})))),r.a.createElement(O,{condition:this.state.showGenetix},r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(Uh,{onClickBack:function(){return e.onClickGenetix()},track:this.props.track,instrument:t})),r.a.createElement(O,{condition:this.state.showMods},r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(fd,{instrument:t})),r.a.createElement(O,{condition:!this.state.showGenetix},r.a.createElement("div",{onClick:this.onClickMods,className:"mods-button common-button pink-button small-button"},this.state.showMods?"BACK":"MODS"),r.a.createElement("div",{onClick:this.onClickGenetix,className:"mods-button common-button pink-button small-button"},"GENETIX")))}}]),t}(a.Component),Cf=[{value:ac,label:"Amp"},{value:"FILTER",label:"Filter"},{value:"FILTER_2",label:"Filter 2"},{value:"MODULATION",label:"Modulation"}],Pf=wf,Tf=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={showMods:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.instrument;return r.a.createElement("div",{className:"instrument"},r.a.createElement("div",{className:"instrument-name"},this.props.instrument.getName()),r.a.createElement(O,{condition:!this.state.showMods},r.a.createElement("div",{className:"clear-fix"}),r.a.createElement("div",{className:"instrument-section"},r.a.createElement("div",{className:"instrument-subsection"},r.a.createElement("div",{className:"instrument-subsection-name"},"Filter"),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(Gl,{effectNumber:0,name:"Frequency",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:e.frequencyParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:4e3,step:1}),r.a.createElement(Gl,{effectNumber:0,name:"Resonance",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:e.resonanceParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:4e3,step:1}),r.a.createElement(Gl,{effectNumber:0,name:"Harmonicity",sequencerEngine:this.props.sequencerEngine,parameter:e.harmonicityParameter,lfoEnabled:!0,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:200,step:1e-4}),r.a.createElement(Gl,{effectNumber:0,name:"Modulation Index",sequencerEngine:this.props.sequencerEngine,parameter:e.modulationIndexParameter,lfoEnabled:!0,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:20,step:1e-4}))),r.a.createElement("div",{className:"instrument-section"},r.a.createElement("div",{className:"instrument-subsection"},r.a.createElement("div",{className:"instrument-subsection-name"},"Amp/Filter Envelope"),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(Gl,{effectNumber:0,name:"Attack",parameter:e.attackParameter,sequencerEngine:this.props.sequencerEngine,onParameterChanged:function(){return[]},lfoEnabled:!0,isParameter:!0,min:0,max:6e3,step:1}),r.a.createElement(Gl,{effectNumber:0,name:"Decay",sequencerEngine:this.props.sequencerEngine,parameter:e.decayParameter,onParameterChanged:function(){return[]},isParameter:!0,lfoEnabled:!0,min:0,max:6e3,step:1}),r.a.createElement(Gl,{effectNumber:0,name:"Sustain",parameter:e.sustainParameter,onParameterChanged:function(){return[]},isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,min:0,max:1,step:.01}),r.a.createElement(Gl,{effectNumber:0,sequencerEngine:this.props.sequencerEngine,name:"Release",parameter:e.releaseParameter,onParameterChanged:function(){return[]},lfoEnabled:!0,isParameter:!0,min:0,max:1e4,step:1})))))}}]),t}(a.Component),jf=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getOscillatorOptions",value:function(){return[{value:"square",label:"Square"},{value:"sine",label:"Sine"},{value:"triangle",label:"Triangle"},{value:"sawtooth",label:"Sawtooth"},{value:"pwm",label:"PWM"},{value:"pulse",label:"Pulse"}]}},{key:"getOscillatorOption",value:function(e){for(var t=this.getOscillatorOptions(),n=0;n<t.length;n++)if(t[n].value==e)return t[n];return null}},{key:"getSelectedOscillatorType",value:function(){return this.props.instrument.oscillatorType}},{key:"onSelectOscillatorType",value:function(e){var t="none"===e.value?void 0:e.value;this.props.instrument.oscillatorType=t,this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.props.instrument;this.props.instrument.lfos[0];return r.a.createElement("div",{className:"instrument synth"},r.a.createElement("div",{className:"instrument-name"},this.props.instrument.getName()),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement("div",{className:"instrument-section"},r.a.createElement("div",{className:"instrument-subsection"},r.a.createElement("div",{className:"instrument-subsection-name"},"Oscillator"),r.a.createElement("div",{className:"osc-type-dropdown-container"},r.a.createElement(pp.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.getOscillatorOptions(),onChange:function(t){return e.onSelectOscillatorType(t)},value:this.getOscillatorOption(this.getSelectedOscillatorType()),placeholder:"Osc. Type"})),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(Gl,{name:"Frequency",automation:this.props.automation,parameter:t.oscillatorFrequencyParameter,onParameterChanged:function(){return t.releaseAll()},displayFunction:function(e){return bs.a.fromTranspose(e).toString()},isParameter:!0,min:-32,max:32,step:1}),r.a.createElement(Gl,{name:"Detune",lfoEnabled:!0,automation:this.props.automation,instrument:t,lfos:t.lfos,parameter:t.detuneParameter,onParameterChanged:function(){return[]},isParameter:!0,min:-100,max:100,step:1}),r.a.createElement(Gl,{lfoEnabled:!0,lfos:t.lfos,instrument:t,automation:this.props.automation,name:"Pulse Width",parameter:t.pulseWidthParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:1,step:.01}),r.a.createElement(Gl,{name:"Polyphony",automation:this.props.automation,parameter:t.polyphonyParameter,onParameterChanged:function(){return[]},isParameter:!0,min:1,max:16,step:1}),r.a.createElement(Gl,{name:"Glide",automation:this.props.automation,parameter:t.portamentoParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:50,step:.1})),r.a.createElement("div",{className:"instrument-subsection"},r.a.createElement("div",{className:"instrument-subsection-name"},"Filter"),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(Gl,{name:"Cutoff",lfoEnabled:!0,automation:this.props.automation,lfos:t.lfos,instrument:t,parameter:t.filterCutoffParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:1e4,step:1}),r.a.createElement(Gl,{name:"Q",lfoEnabled:!0,automation:this.props.automation,lfos:t.lfos,instrument:t,parameter:t.filterQParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:9,step:1}))),r.a.createElement("div",{className:"instrument-section"},r.a.createElement(Kh,{instrument:t}),r.a.createElement("div",{className:"instrument-subsection"},r.a.createElement("div",{className:"instrument-subsection-name"},"Amp Envelope"),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(Gl,{automation:this.props.automation,name:"Amp Attack",lfoEnabled:!0,lfos:t.lfos,instrument:t,parameter:t.ampAttackParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:6e3,step:1}),r.a.createElement(Gl,{automation:this.props.automation,name:"Amp Decay",lfoEnabled:!0,lfos:t.lfos,instrument:t,parameter:t.ampDecayParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:6e3,step:1}),r.a.createElement(Gl,{name:"Amp Sustain",automation:this.props.automation,lfoEnabled:!0,lfos:t.lfos,instrument:t,parameter:t.ampSustainParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:1,step:.01}),r.a.createElement(Gl,{name:"Amp Release",automation:this.props.automation,lfoEnabled:!0,lfos:t.lfos,instrument:t,parameter:t.ampReleaseParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:1e4,step:1}))),r.a.createElement("div",{className:"instrument-section"},r.a.createElement(xf,{automation:this.props.automation,instrument:t})))}}]),t}(a.Component),xf=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.instrument.filterEnvelope;return r.a.createElement("div",{className:"instrument-subsection"},r.a.createElement("div",{className:"instrument-subsection-name"},"Filter Envelope"),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(Gl,{name:"Frequency",parameter:e.baseFrequencyParameter,automation:this.props.automation,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:1e4,step:1}),r.a.createElement(Gl,{name:"Octaves",parameter:e.octavesParameter,automation:this.props.automation,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:8,step:.1}),r.a.createElement(Gl,{name:"Attack",parameter:e.attackParameter,automation:this.props.automation,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:8e3,step:1}),r.a.createElement(Gl,{name:"Decay",parameter:e.decayParameter,automation:this.props.automation,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:8e3,step:1}),r.a.createElement(Gl,{name:"Sustain",parameter:e.sustainParameter,automation:this.props.automation,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:1,step:.01}),r.a.createElement(Gl,{name:"Release",automation:this.props.automation,parameter:e.releaseParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:8e3,step:1}))}}]),t}(a.Component),Nf=jf,qf=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"handleOptionChange",value:function(e){console.log("handleOptionChange("+e+")"),this.props.effect.setSideChainedTrack(this.props.tracks[e],e)}},{key:"getSideChainedTrack",value:function(){var e=this.props.effect.connectedTrack;return void 0===e?0:this.props.tracks.indexOf(e)+1}},{key:"getOptions",value:function(){return this.props.sequencerEngine.tracks.map(function(e){return{label:"Track "+(e.trackNumber+1),value:e.trackNumber}})}},{key:"getOption",value:function(e){if(void 0!==e)return this.getOptions().filter(function(t){return t.value===e.trackNumber})[0]}},{key:"render",value:function(){var e=this;void 0!==this.props.automation||this.props.effect.isEnabled();return r.a.createElement("div",null,this.props.effect.isEnabled()?r.a.createElement("div",null,r.a.createElement("div",{className:"sidechain-container"},r.a.createElement("div",{className:"parameter-label"},"Sidechain: "),r.a.createElement(pp.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.getOptions(),onChange:function(t){return e.handleOptionChange(t.value)},value:this.getOption(this.props.effect.connectedTrack),placeholder:"None"})),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Smoothing",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,selectedParameter:this.props.selectedParameter,parameter:this.props.effect.smoothingParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:1e-4,max:2,min:1e-5}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Threshold",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,selectedParameter:this.props.selectedParameter,parameter:this.props.effect.thresholdParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.01,max:6,min:-120})):"")}}]),t}(a.Component),Mf=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=void 0!==this.automation?"enabled effect effect-automation":"effect enabled";return r.a.createElement("div",{className:t},r.a.createElement("div",{className:"effect-name"},"Pan"),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(fe.a,{value:this.props.panning,change:function(t){return e.props.onChangePanning(t.target.value)},step:.01,max:1,min:-1,orientation:"vertical",reversed:!1}))}}]),t}(a.Component);var Df=Object(y.b)(function(e,t){return{value:t.effect.type}},null)(function(e){var t=e.effect,n=e.value,s=[{label:"Lowpass",value:"lowpass"},{label:"Highpass",value:"highpass"},{label:"Bandpass",value:"bandpass"},{label:"Notch",value:"notch"},{label:"Peaking",value:"peaking"}],i=Object(a.useCallback)(function(e){t.type=e},[]);return r.a.createElement("div",{className:"filter-dropdown-container"},r.a.createElement("div",{className:"dropdown-label"},"Type: "),r.a.createElement(pp.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:s,onChange:function(e){return i(e.value)},value:function(e){return s.find(function(t){return t.value===e})}(n),placeholder:"Type"}))}),Af=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={filterEffect:e.filterEffect,refined:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.filterEffect=e.filterEffect,!0}},{key:"handleOptionChange",value:function(e){document.activeElement.blur(),"lowpass"===e.target.value?this.state.filterEffect.lowpass():this.state.filterEffect.hipass(),this.setState(this.state)}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.filterEffect.isEnabled()}},{key:"onChangeRefined",value:function(e){this.setState({refined:"refined"===e})}},{key:"render",value:function(){var e=this,t=(this.state.filterEffect.type,void 0!==this.props.automation||this.state.filterEffect.isEnabled(),this.state.refined?400:1e4);return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement(Df,{effect:this.props.filterEffect}),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(Gl,{customClassName:"wider-slider",effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,name:"Cutoff",lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,unit:"HZ",parameter:this.state.filterEffect.cutoffParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:1,max:t,min:20}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,name:"Q",lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,parameter:this.state.filterEffect.qParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:1,max:10,min:0}),r.a.createElement("div",{className:""},r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",value:this.state.refined?"unrefined":"refined",checked:this.state.refined,onChange:function(t){return e.onChangeRefined(t.target.value)}}),"Refine"))):"")}}]),t}(a.Component),Rf=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={filterEffect:e.filterEffect,frequency:e.filterEffect.getStoredLFOTime()},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.filterEffect=e.filterEffect,!0}},{key:"handleOptionChange",value:function(e){"lowpass"===e.target.value?this.state.filterEffect.lowpass():this.state.filterEffect.hipass(),this.setState(this.state)}},{key:"handleLFOTimeChange",value:function(e){this.state.frequency=e,this.state.filterEffect.setLFOTime(e()),this.setState(this.state)}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.filterEffect.isEnabled()}},{key:"render",value:function(){var e=this,t=this.state.filterEffect.getFilterType();this.state.filterEffect.getLFOTime(),void 0!==this.props.automation||this.state.filterEffect.isEnabled();return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement("form",null,r.a.createElement("div",{className:"radio"},r.a.createElement("label",null,r.a.createElement("input",{className:"filter-radio",type:"radio",value:"lowpass",checked:"lowpass"===t,onChange:function(t){return e.handleOptionChange(t)}}),"Lowpass"),r.a.createElement("label",null,r.a.createElement("input",{className:"filter-radio",type:"radio",value:"hipass",checked:"highpass"===t,onChange:function(t){return e.handleOptionChange(t)}}),"Hipass"),r.a.createElement(pp.a,{className:"delay-time-dropdown",options:If,onChange:function(t){return e.handleLFOTimeChange(t.value)},value:Lf(this.state.frequency),placeholder:"Delay Time"}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,name:"Cutoff",unit:"HZ",parameter:this.state.filterEffect.effectNode.baseFrequency,onParameterChanged:this.props.onParameterChanged,updateFunction:function(t){return e.state.filterEffect.effectNode.baseFrequency=t},getValue:function(){return e.state.filterEffect.effectNode.baseFrequency},step:5,max:1e4,min:10}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,name:"Octaves",parameter:this.state.filterEffect.effectNode.octaves,updateFunction:function(t){return e.state.filterEffect.effectNode.octaves=t},onParameterChanged:this.props.onParameterChanged,getValue:function(){return e.state.filterEffect.effectNode.octaves},step:.1,max:10,min:0}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,name:"Q",parameter:this.state.filterEffect.qParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:1,max:10,min:0})))):"")}}]),t}(a.Component),If=[{value:function(){return.03125*new q.a.Time("1m")},label:"4"},{value:function(){return.125*new q.a.Time("1m")},label:"2"},{value:function(){return.25*new q.a.Time("1m")},label:"1"},{value:function(){return.5*new q.a.Time("1m")},label:"1/2"},{value:function(){return.5*new q.a.Time("2m")},label:"1/4"},{value:function(){return 2*new q.a.Time("1m")},label:"1/8"},{value:function(){return 3*new q.a.Time("1m")},label:"1/8t"},{value:function(){return 4*new q.a.Time("1m")},label:"1/16"},{value:function(){return 6*new q.a.Time("1m")},label:"1/16t"},{value:function(){return 8*new q.a.Time("1m")},label:"1/32"}];function Lf(e){e="function"===typeof e?e():e;var t=If.filter(function(t){return t.value()===e});return 0==t.length?If[0]:t[0]}var Ff=Rf,Vf=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={reverbEffect:e.reverbEffect},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.reverbEffect=e.reverbEffect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.reverbEffect.isEnabled()}},{key:"render",value:function(){Math.round(10*this.state.reverbEffect.getRoomSize()),this.state.reverbEffect.getDampening(),this.state.reverbEffect.getWet(),void 0!==this.props.automation||this.state.reverbEffect.isEnabled();return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,name:"Room Size",parameter:this.state.reverbEffect.roomSizeParameter,lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.01,max:1,min:0}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,name:"Dampening",lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,parameter:this.state.reverbEffect.dampeningParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:100,max:8e3,min:0}),r.a.createElement(Up,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.state.reverbEffect})):"")}}]),t}(a.Component),Bf=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={reverbEffect:e.reverbEffect},n.getConvolverType(),n.getConvolverThumbnail(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.reverbEffect=e.reverbEffect,!0}},{key:"handleConvolverTypeChange",value:function(e){this.state.reverbEffect.setConvolverType(e),this.getConvolverType(),this.getConvolverThumbnail(),this.setState(this.state)}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.isEnabled}},{key:"getConvolverThumbnail",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.state.reverbEffect).convolverSample){e.next=7;break}return e.next=4,R.a.getVideoIdForSound(t.convolverSample);case 4:n=e.sent,a="https://img.youtube.com/vi/"+n+"/1.jpg",this.setState({thumbnail:a});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getConvolverType",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.state.reverbEffect).convolverSample){e.next=9;break}return e.next=4,R.a.getTitleForSound(t.convolverSample);case 4:n=e.sent,this.state.convolverType={label:n,value:t.convolverSample},this.setState(this.state),e.next=13;break;case 9:a=Uf.filter(function(e){return e.value===t.convolverType}),this.state.convolverType=a[0],this.state.thumbnail=void 0,this.setState(this.state);case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onDrop",value:function(){var e=Object(g.a)(v.a.mark(function e(t){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.props.sampleDragging){e.next=8;break}return t.stopPropagation(),this.props.reverbEffect.setConvolverSample(this.props.sampleDragging.getId()),e.next=5,this.getConvolverType();case 5:return e.next=7,this.getConvolverThumbnail();case 7:this.props.setSampleDragging(void 0);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;this.state.reverbEffect.getWet(),void 0!==this.props.automation||this.state.reverbEffect.isEnabled();return r.a.createElement("div",{onDrop:function(t){return e.onDrop(t)}},this.isEnabled()?r.a.createElement("div",null,r.a.createElement(pp.a,{className:"delay-time-dropdown",options:Uf,onChange:function(t){return e.handleConvolverTypeChange(t.value)},value:this.state.convolverType,placeholder:"Delay Time"}),r.a.createElement(O,{condition:this.state.thumbnail},r.a.createElement("img",{className:"convolver-thumbnail",src:this.state.thumbnail})),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Pitch",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,parameter:this.state.reverbEffect.pitchParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.1,max:24,min:-24}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Attack",unit:"%",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,parameter:this.state.reverbEffect.attackParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.1,max:100,min:0}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Release",unit:"%",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,parameter:this.state.reverbEffect.durationParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.1,max:100,min:0}),r.a.createElement(Up,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.state.reverbEffect})):"")}}]),t}(a.Component),Uf=[{value:"Giant Cave",label:"Giant Cave"},{value:"Hangar",label:"Airport Hangar"},{value:"Airport Terminal",label:"Airport Terminal"},{value:"Outdoor Blastoff",label:"Outdoor Blastoff"},{value:"Outdoor Stadium",label:"Outdoor Stadium"},{value:"Plate Large",label:"Plate Large"},{value:"Plate Medium",label:"Plate Medium"},{value:"Plate Small",label:"Plate Small"},{value:"Plate Super Dry",label:"Plate Super Dry"},{value:"Prime Long",label:"Prime Long"},{value:"Prime Medium",label:"Prime Medium"},{value:"Prime Short",label:"Prime Short"},{value:"Prime Extra Long",label:"Prime Extra Long"},{value:"Room Concert Hall",label:"Room Concert Hall"},{value:"Room Huge",label:"Room Huge"},{value:"Room Large",label:"Room Large"},{value:"Room Medium",label:"Room Medium"},{value:"Room Pool",label:"Room Pool"}],Hf=Object(y.b)(function(e,t){return{sampleDragging:e.selector.sampleDragging,isEnabled:t.reverbEffect.enabledParameter.get()}},function(e,t){return{setSampleDragging:function(t){return e(Object(w.Ac)(t))}}})(Bf),Jf=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={chorusEffect:e.chorusEffect},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.chorusEffect.isEnabled()}},{key:"render",value:function(){void 0!==this.props.automation||this.state.chorusEffect.isEnabled();return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Rate",selectedParameter:this.props.selectedParameter,parameter:this.state.chorusEffect.rateParameter,onParameterChanged:this.props.onParameterChanged,lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,isParameter:!0,step:.1,max:4,min:0}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Depth",selectedParameter:this.props.selectedParameter,parameter:this.state.chorusEffect.depthParameter,onParameterChanged:this.props.onParameterChanged,lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,isParameter:!0,step:.1,max:100,min:0}),r.a.createElement(Up,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.state.chorusEffect})):"")}}]),t}(a.Component),Gf=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={tremoloEffect:e.tremoloEffect},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.tremoloEffect=e.tremoloEffect,!0}},{key:"handleDepthChange",value:function(e){this.state.tremoloEffect.setDepth(e),this.setState(this.state)}},{key:"handleRateChange",value:function(e){this.state.tremoloEffect.setRate(e),this.setState(this.state)}},{key:"handleWetChange",value:function(e){this.state.tremoloEffect.setWet(e),this.setState(this.state)}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.tremoloEffect.isEnabled()}},{key:"render",value:function(){var e=this;Math.round(10*this.state.tremoloEffect.getRate()),this.state.tremoloEffect.getDepth(),this.state.tremoloEffect.getWet(),void 0!==this.props.automation||this.state.tremoloEffect.isEnabled();return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Rate",selectedParameter:this.props.selectedParameter,displayFunction:function(t){return Math.round(10*e.state.tremoloEffect.getRate())/10},lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,onParameterChanged:this.props.onParameterChanged,parameter:this.state.tremoloEffect.rateParameter,isParameter:!0,step:.1,max:16,min:0}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Depth",selectedParameter:this.props.selectedParameter,parameter:this.state.tremoloEffect.depthParameter,onParameterChanged:this.props.onParameterChanged,lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,isParameter:!0,step:.1,max:1,min:0}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Spread",selectedParameter:this.props.selectedParameter,parameter:this.state.tremoloEffect.spreadParameter,onParameterChanged:this.props.onParameterChanged,lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,isParameter:!0,step:1,max:360,min:0}),r.a.createElement(Up,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,onParameterChanged:this.props.onParameterChanged,effect:this.state.tremoloEffect})):"")}}]),t}(a.Component),zf=40;function _f(e,t,n,a,r){var s=document.getElementById(t).getBoundingClientRect(),i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,r=e/a,s=Math.pow(r,1.5);return t+(n-t)*s}(e.clientX-s.left,n,a,r);return isNaN(i)?-100:i}function Wf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(e-t)/(n-t)}(e,t,n,a);return a*Math.sqrt(r)}var Kf=Object(y.b)(function(e,t){return void 0===t.track?{}:{volume:t.track.volumeParameter.get()}},null)(function(e){var t=e.track,n=e.rackTrack,s=e.volume,i=e.id,o=e.onVolumeChange,c=e.min,u=void 0===c?-40:c,l=e.max,p=void 0===l?0:l,h=e.width,d=void 0===h?zf:h,f=e.display,m=(e.onVolumeChange2,Object(a.useState)(!1)),v=Object(Z.a)(m,2),g=v[0],b=v[1],y={width:Wf(s,u,p,d)},k=function(){return i||"volume-"+n.trackNumber+"-"+t.trackNumber},E=Object(a.useCallback)(function(e){e.stopPropagation();var n=_f(e,k(),u,p,d);o?o(n):t.volumeParameter.set(n,.01),b(!0)},[t,b]),S=Object(a.useCallback)(function(e){if(e.stopPropagation(),g){var n=_f(e,k(),u,p,d);o?o(n):t.volumeParameter.set(n)}},[t,g]),O=function(e){return Math.round(10*e)/10};return r.a.createElement("div",{id:k(),onClick:function(e){return e.stopPropagation()},onMouseUp:function(e){e.stopPropagation(),b(!1)},onMouseLeave:function(e){e.stopPropagation(),b(!1)},onMouseMove:S,onMouseDown:E,className:"volume-box"},r.a.createElement("div",{style:y,className:"volume-indicator"}),O(f?f(s):s)," db")});function Yf(e){var t=e.rackTrack,n=e.track,a=e.onSelect,s=e.isSelected,i=e.onDelete,o="track-slot";s&&(o+=" selected");var c=n.presetName||n.getName();return c.length>16&&(c=c.substring(0,16)+"..."),r.a.createElement("div",{onClick:a,className:o},r.a.createElement("div",{className:"sub-instrument-name"},c),r.a.createElement(Kf,{rackTrack:t,track:n}),r.a.createElement(O,{condition:s},r.a.createElement("div",{onClick:i,className:"delete-button"},"x")))}n(2329);function Qf(e){var t=e.sequencerEngine;return r.a.createElement(Sv.EffectsView,{hideLock:!0,store:t.store,sequencerEngine:t,onParameterChanged:function(e){return[]},onEffectsChange:function(){return e.updateEffects()},panning:0,onChangePanning:function(e){return console.log("panning changed = "+e)},sends:t.sends,tracks:[],track:e,send:void 0,group:void 0})}var Xf=Object(y.b)(function(e,t){return{instrumentTypeDragging:e.instruments.instrumentTypeDragging,presetDragging:e.presets.presetDragging,sampleDragging:e.selector.sampleDragging}},function(e,t){return{setInstrumentTypeDragging:function(t){return e(Object(w.Fb)(t))},setPresetDragging:function(t){return e(Object(w.sc)(t))},setSampleDragging:function(t){return e(Object(w.Ac)(t))}}})(function(e){var t=Object(a.useCallback)(function(t){t.stopPropagation(),e.instrumentTypeDragging?(e.newInstrument(e.instrumentTypeDragging),e.setInstrumentTypeDragging(void 0)):e.presetDragging?(e.newPreset(e.presetDragging),e.setPresetDragging(void 0)):e.sampleDragging&&(e.newSample(e.sampleDragging),e.setSampleDragging(void 0))},[e.instrumentTypeDragging,e.newInstrument,e.newPreset,e.newSample,e.presetDragging,e.sampleDragging]);return r.a.createElement("div",{onDragOver:function(e){return e.preventDefault()},onDrop:t,className:"drop-here"},r.a.createElement("span",null,"Drop inst, preset or sample here"))});function Zf(e){var t=e.track,n=Object(a.useState)(void 0),s=Object(Z.a)(n,2),i=s[0],o=s[1],c=Object(a.useState)(t.tracks),u=Object(Z.a)(c,2),l=u[0],p=u[1],h=Object(a.useState)(!1),d=Object(Z.a)(h,2),f=d[0],m=d[1],b=Object(a.useCallback)(function(e){var n=t.addInstrumentType(e);p(Object(ge.a)(t.tracks)),o(n)},[t,p,o]),y=Object(a.useCallback)(function(){var e=Object(g.a)(v.a.mark(function e(n){var a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.addPreset(n);case 2:a=e.sent,p(Object(ge.a)(t.tracks)),o(a);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[t,p,o]),k=Object(a.useCallback)(function(){var e=Object(g.a)(v.a.mark(function e(n){var a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.addSample(n);case 2:a=e.sent,p(Object(ge.a)(t.tracks)),o(a);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[t,p,o]),E=Object(a.useCallback)(function(){t.deleteInstrument(i),o(void 0),p(Object(ge.a)(t.tracks))},[t,p,o,i]),S=t.tracks.indexOf(i)>-1?Qf(i.track):"",O=Object(a.useCallback)(function(){var e=Object(g.a)(v.a.mark(function e(n){var a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getCopy();case 2:a=e.sent,t.addInstrument(a),o(void 0),p(Object(ge.a)(t.tracks));case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[p]),w=t.tracks.indexOf(i)>-1?function(e,t,n,a){var s=e.track.sequencerEngine,i=a?"toolbar-button selected":"toolbar-button";return r.a.createElement("div",null,r.a.createElement(Zd,{sequencerEngine:s,parameters:{Vol:{parameter:e.volumeParameter,min:-40,max:0}}}),r.a.createElement("div",{className:"toolbar"},r.a.createElement("div",{onClick:function(){return t(e)},className:"toolbar-button"},"Duplicate"),r.a.createElement("div",{onClick:function(){return n(!a)},className:i},"Mods")))}(i,O,m,f):"";return r.a.createElement("div",{className:"instrument instrument-rack"},r.a.createElement("div",{className:"instrument-rack-controller"},l.map(function(e){return r.a.createElement(Yf,{rackTrack:t,isSelected:i===e,onDelete:function(){return E()},onSelect:function(){return o(e===i?void 0:e)},track:e})}),w,f&&i?r.a.createElement(dp,{parameters:i.getAllParameters(),setShowMods:m,showMods:f}):"",r.a.createElement(Xf,{newInstrument:b,newPreset:y,newSample:k,track:t})),S)}var $f=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={delayEffect:e.delayEffect},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.delayEffect=e.delayEffect,!0}},{key:"handleOptionChange",value:function(e){this.setState(this.state)}},{key:"handleFeedbackChange",value:function(e){this.state.delayEffect.setFeedback(e),this.setState(this.state)}},{key:"handleDelayTimeChange",value:function(e){this.props.sequencerEngine.operationManager.dispatch(Gi(this.state.delayEffect.rateParameter,e.value)),this.setState(this.state)}},{key:"handleWetChange",value:function(e){this.state.delayEffect.setWet(e),this.setState(this.state)}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.delayEffect.isEnabled()}},{key:"onChangeSynced",value:function(e){document.activeElement.blur(),this.delay.isSynced="unsynced"===e,this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.state.delayEffect,n=(t.getFeedback(),t.rawDelayRate,t.isSynced);t.getWet(),void 0!==this.props.automation||t.isEnabled();return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement("div",{className:"refined-checkbox-preferences lfo-synced-checkbox"},r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",value:n?"synced":"unsynced",checked:n,onChange:function(t){return e.onChangeSynced(t.target.value)}}),"Synced")),n?r.a.createElement("div",{className:"lfo-rate-dropdown"},r.a.createElement("div",{className:"lfo-rate-label"},"Rate:"),r.a.createElement(pp.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:em,onChange:function(t){return e.handleDelayTimeChange(t)},value:tm(this.delay.rawDelayRate),placeholder:"Rate"}),r.a.createElement("div",{className:"clear-fix"})):r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Rate",parameter:this.state.delayEffect.rateParameter,onParameterChanged:this.props.onParameterChanged,sequencerEngine:this.props.sequencerEngine,isParameter:!0,lfoEnabled:!0,step:1,min:1,max:1e3}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Feedback",lfoEnabled:!0,selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,unit:"%",parameter:this.state.delayEffect.feedbackParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,displayFunction:function(e){return Math.floor(100*e)},step:.01,max:1,min:0}),r.a.createElement(Up,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.state.delayEffect})):"")}},{key:"delay",get:function(){return this.state.delayEffect}}]),t}(a.Component),em=[{value:"1n",label:"1"},{value:"2n",label:"1/2"},{value:"4n",label:"1/4"},{value:"4t",label:"1/4t"},{value:"8n",label:"1/8"},{value:"8n.",label:"1/8."},{value:"8t",label:"1/8t"},{value:"16n",label:"1/16"},{value:"16t",label:"1/16t"},{value:"32n",label:"1/32"}];function tm(e){var t=em.filter(function(t){return t.value===e});return 0==t.length?"16n":t[0]}var nm=Object(y.b)(function(e,t){return{rate:t.delayEffect.rateParameter.get(),isEnabled:t.delayEffect.isEnabled()}},null)($f),am=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={effect:e.effect},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){this.state.effect.compressorNode,this.state.effect.effectNode,void 0!==this.props.automation||this.state.effect.isEnabled();return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Gain",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:this.state.effect.gainParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.1,max:6,min:.1}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Threshold",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,selectedParameter:this.props.selectedParameter,parameter:this.state.effect.thresholdParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.1,max:8,min:-80}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Ratio",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,selectedParameter:this.props.selectedParameter,parameter:this.state.effect.ratioParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:20,min:1}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Knee",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,selectedParameter:this.props.selectedParameter,parameter:this.state.effect.kneeParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:40,min:0}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Attack",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,selectedParameter:this.props.selectedParameter,parameter:this.state.effect.attackParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.001,max:1,min:0}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Release",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:this.state.effect.releaseParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.001,max:1,min:.1})):"")}}]),t}(a.Component),rm=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={effect:e.effect},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){this.state.effect.compressorNode,this.state.effect.effectNode,void 0!==this.props.automation||this.state.effect.isEnabled();return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Order",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:this.state.effect.orderParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:1,max:100,min:1}),r.a.createElement(Up,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.state.effect})):"")}}]),t}(a.Component),sm=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={effect:e.effect},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){void 0!==this.props.automation||this.state.effect.isEnabled();return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Low",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.lowParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:10,min:-10}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Mid",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.midParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:10,min:-10}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"High",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.highParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:10,min:-10}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Low Frequency",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.lowFrequencyParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:10,max:400,min:0}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"High Frequency",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.highFrequencyParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:10,max:1e4,min:1e3})):"")}}]),t}(a.Component),im=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={effect:e.effect},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){var e,t,n,a,s,i,o,c;void 0!==this.props.automation||this.state.effect.isEnabled();return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement(Gl,(e={effectNumber:this.props.effectNumber,automation:this.props.automation,name:"31",unit:"db",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.gain31Parameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,sequencerEngine:this.props.sequencerEngine,step:.1,max:12,min:-12},Object(_e.a)(e,"isParameter",!0),Object(_e.a)(e,"lfoEnabled",!0),e)),r.a.createElement(Gl,(t={effectNumber:this.props.effectNumber,automation:this.props.automation,name:"63",sequencerEngine:this.props.sequencerEngine,unit:"db",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.gain63Parameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:12,min:-12},Object(_e.a)(t,"isParameter",!0),Object(_e.a)(t,"lfoEnabled",!0),t)),r.a.createElement(Gl,(n={effectNumber:this.props.effectNumber,automation:this.props.automation,name:"125",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.gain125Parameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,unit:"db",step:.1,max:12,min:-12,sequencerEngine:this.props.sequencerEngine},Object(_e.a)(n,"isParameter",!0),Object(_e.a)(n,"lfoEnabled",!0),n)),r.a.createElement(Gl,(a={effectNumber:this.props.effectNumber,automation:this.props.automation,name:"250",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.gain250Parameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,unit:"db",step:.1,max:12,min:-12,sequencerEngine:this.props.sequencerEngine},Object(_e.a)(a,"isParameter",!0),Object(_e.a)(a,"lfoEnabled",!0),a)),r.a.createElement(Gl,(s={effectNumber:this.props.effectNumber,automation:this.props.automation,name:"500",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,parameter:this.state.effect.gain500Parameter,onParameterChanged:this.props.onParameterChanged,unit:"db",isParameter:!0,step:.1,max:12,min:-12},Object(_e.a)(s,"isParameter",!0),Object(_e.a)(s,"lfoEnabled",!0),s)),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,name:"1k",unit:"db",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.gain1kParameter,onParameterChanged:this.props.onParameterChanged,lfoEnabled:!0,isParameter:!0,step:.1,max:12,min:-12}),r.a.createElement(Gl,(i={effectNumber:this.props.effectNumber,automation:this.props.automation,name:"2k",unit:"db",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,parameter:this.state.effect.gain2kParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:12,min:-12},Object(_e.a)(i,"isParameter",!0),Object(_e.a)(i,"lfoEnabled",!0),i)),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"4k",unit:"db",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.gain4kParameter,onParameterChanged:this.props.onParameterChanged,lfoEnabled:!0,isParameter:!0,step:.1,max:12,sequencerEngine:this.props.sequencerEngine,min:-12}),r.a.createElement(Gl,(o={effectNumber:this.props.effectNumber,automation:this.props.automation,name:"8k",unit:"db",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.gain8kParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:12,min:-12,sequencerEngine:this.props.sequencerEngine},Object(_e.a)(o,"isParameter",!0),Object(_e.a)(o,"lfoEnabled",!0),o)),r.a.createElement(Gl,(c={effectNumber:this.props.effectNumber,automation:this.props.automation,unit:"db",name:"16k",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.gain16kParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:12,min:-12,sequencerEngine:this.props.sequencerEngine},Object(_e.a)(c,"isParameter",!0),Object(_e.a)(c,"lfoEnabled",!0),c))):"")}}]),t}(a.Component),om=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"compressor-part"},r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Threshold",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,selectedParameter:this.props.selectedParameter,parameter:this.props.effect.thresholdParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.1,max:8,min:-80}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Ratio",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,selectedParameter:this.props.selectedParameter,parameter:this.props.effect.ratioParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:20,min:1}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Knee",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,selectedParameter:this.props.selectedParameter,parameter:this.props.effect.kneeParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:40,min:0}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Attack",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,selectedParameter:this.props.selectedParameter,parameter:this.props.effect.attackParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.001,max:1,min:0}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Release",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:this.props.effect.releaseParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.001,max:1,min:.1}))}}]),t}(a.Component),cm="LOW",um=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={selectedPart:cm},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"onSelectCompressor",value:function(e){e=e.value,this.setState({selectedPart:e})}},{key:"getCompressor",value:function(){var e=this;return this.props.effect.compressors.find(function(t){return t.name===e.state.selectedPart})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement("div",{className:"osc-type-dropdown-container"},r.a.createElement(pp.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:lm,onChange:function(t){return e.onSelectCompressor(t)},value:pm(this.state.selectedPart),placeholder:"LFO"})),r.a.createElement(om,{selectedParameter:this.props.selectedParameter,automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,onParameterChanged:this.props.onParameterChanged,effect:this.getCompressor(),effectNumber:this.props.effectNumber})):"")}}]),t}(a.Component),lm=[{value:"LOW",label:"Low"},{value:"MID",label:"Mid"},{value:"HIGH",label:"High"}];function pm(e){for(var t=0;t<lm.length;t++)if(lm[t].value==e)return lm[t];return null}var hm=um,dm=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={effect:e.effect},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){this.state.effect.compressorNode,this.state.effect.effectNode,void 0!==this.props.automation||this.state.effect.isEnabled();return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Rate",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:this.state.effect.rateParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.001,max:20,min:0}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Feedback",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:this.state.effect.feedbackParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.001,max:1,min:0}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Depth",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:this.state.effect.depthParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.01,max:1,min:0}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Wet",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:this.state.effect.wetParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.001,max:1,min:0})):"")}}]),t}(a.Component),fm=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={effect:e.effect},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){void 0!==this.props.automation||this.state.effect.isEnabled();return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Filter Cutoff",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.baseFrequencyParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:10,max:1e4,min:0}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Octave",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.octaveParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:10,min:0}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Q",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.qParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:1,max:10,min:0}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Sensitivity",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.sensitivityParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:1,max:3,min:-30}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Attack",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.attackParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:4,min:.1}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Release",selectedParameter:this.props.selectedParameter,parameter:this.state.effect.releaseParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:4,min:.1}),r.a.createElement(Up,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.state.effect})):"")}}]),t}(a.Component),mm=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={effect:e.effect},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){void 0!==this.props.automation||this.state.effect.isEnabled();return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Distortion",parameter:this.state.effect.distortionParameter,lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.01,max:1,min:0}),r.a.createElement(Up,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.state.effect})):"")}}]),t}(a.Component),vm=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={effect:e.effect},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Bits",sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,selectedParameter:this.props.selectedParameter,parameter:this.state.effect.bitsParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:1,max:8,min:1}),r.a.createElement(Up,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.state.effect})):"")}}]),t}(a.Component),gm=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={effect:e.effect},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){this.state.effect.compressorNode,this.state.effect.effectNode,void 0!==this.props.automation||this.state.effect.isEnabled();return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Drive",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:this.state.effect.driveParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.01,max:6,min:.01})):"")}}]),t}(a.Component),bm=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={effect:e.effect},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){void 0!==this.props.automation||this.state.effect.isEnabled();return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Pitch",parameter:this.state.effect.pitchParameter,lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.01,max:24,min:-24}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Window Size",parameter:this.state.effect.windowSizeParameter,lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.01,max:.2,min:.03}),r.a.createElement(Up,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.state.effect})):"")}}]),t}(a.Component),ym=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={effect:e.effect},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){void 0!==this.props.automation||this.state.effect.isEnabled();return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,name:"Panning",parameter:this.state.effect.panningParameter,lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.01,max:1,min:-1})):"")}}]),t}(a.Component),km={},Em={},Sm=[50,60,70,80,90,100,200,300,400,500,600,700,800,900,1e3,2e3,3e3,4e3,5e3,6e3,7e3,8e3,9e3,1e4],Om=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n.guideLines=n.getGuideLines(),n.fillCache(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.nextProps!==e.nextProps||JSON.stringify(this.props.equalizerPoints)!==JSON.stringify(e.equalizerPoints)}},{key:"fillCache",value:function(){for(var e=0;e<14e3;e++)this.getXPositionForFrequency(e);for(var t=0;t<650;t++)this.getFrequencyForXPosition(t)}},{key:"getFrequencyForXPosition",value:function(e){if(e in km)return km[e];var t=0,n=0,a=0;for(n=0;t<e;n++)t+=this.props.getWidth(n),a+=86;var r=this.props.getWidth(n),s=a-86+(e-(t-r))/r*86;return km[e]=s,s}},{key:"getXPositionForFrequency",value:function(e){if(e in Em)return Em[e];var t=0,n=0,a=0;for(t=0;a<e;t++)n+=this.props.getWidth(t),a+=86;return n-=this.props.getWidth(t),n+=(e-(a-86))/86*this.props.getWidth(t),Em[e]=n,n}},{key:"getGainYPosition",value:function(e){return 80-5*e}},{key:"getEQCurve",value:function(){for(var e=[],t=this.equalizerPoints.filter(function(e){return e.enabled}),n=0;n<620;n+=2){var a=this.getFrequencyForXPosition(n),s=0;for(var i in t)s+=t[i].frequencyToGain(a);e.push(n),e.push(this.getGainYPosition(s))}return r.a.createElement(b.Line,{closed:!1,strokeWidth:2,lineCap:"butt",lineJoin:"miter",tension:.91,points:e,stroke:"#6200EE"})}},{key:"getEqualizerPoints",value:function(){var e=this,t=this.equalizerPoints.filter(function(e){return e.enabled});return t.map(function(n,a){var s=t[a],i=e.getXPositionForFrequency(n.frequency);return r.a.createElement(b.Group,null,r.a.createElement(b.Circle,{onMouseDown:function(t){return e.startDraggingPoint(s)},onMouseUp:function(t){return e.stopDraggingPoint(s)},x:i,y:e.getGainYPosition(n.gain),radius:8,fill:e.props.selectedPoint===s?"yellow":"black",stroke:"yellow",strokeWidth:2}),r.a.createElement(b.Text,{onMouseDown:function(t){return e.startDraggingPoint(s)},onMouseUp:function(t){return e.stopDraggingPoint(s)},text:s.number,fill:e.props.selectedPoint===s?"black":"yellow",fontSize:10,fontFamily:"Arial",x:i-3,y:e.getGainYPosition(n.gain)-5}))})}},{key:"getGuideLines",value:function(){var e=this;return Sm.map(function(t){return e.getXPositionForFrequency(t)}).map(function(e){return r.a.createElement(b.Line,{key:"eq-guideline-"+e,points:[e,0,e,160],stroke:"#1f1f1f",strokeWidth:1,closed:!1})})}},{key:"startDraggingPoint",value:function(e){this.props.setSelectedPoint(e),this.setState({draggingPoint:e})}},{key:"stopDraggingPoint",value:function(e){this.setState({draggingPoint:void 0})}},{key:"onMouseMove",value:function(e){var t=e.evt.layerX,n=e.evt.layerY,a=parseInt(this.getFrequencyForXPosition(t));void 0!==this.state.draggingPoint&&(this.state.draggingPoint.frequency=a,this.state.draggingPoint.gain=(80-n)/5,this.setState(this.state))}},{key:"onMouseLeave",value:function(){this.setState({draggingPoint:void 0})}},{key:"render",value:function(){var e=this;return r.a.createElement(b.Group,{onMouseMove:function(t){return e.onMouseMove(t)},onMouseLeave:function(t){return e.onMouseLeave()}},r.a.createElement(b.Line,{closed:!0,strokeWidth:2,lineCap:"round",lineJoin:"round",points:[0,0,620,0,620,160,0,160],stroke:"black"}),this.guideLines,this.getEQCurve(),this.getEqualizerPoints())}},{key:"equalizerPoints",get:function(){return this.props.effect.equalizerPoints||[]}}]),t}(a.Component),wm=Object(y.b)(function(e,t){var n=t.effect.equalizerPoints,a={};for(var r in n){var s=n[r],i=s.frequencyParameter,o=s.gainParameter,c=s.qParameter,u=s.enabledParameter;a[r]={frequency:e.effects.effectParameters[i.id],gain:e.effects.effectParameters[o.id],enabled:e.effects.effectParameters[u.id],q:e.effects.effectParameters[c.id]}}return{equalizerPoints:a}},null)(Om);function Cm(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:256,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10;a=Math.log(a);var s=((r=Math.log(r))-a)/(n-t);return Math.exp(a+s*(e-t))}var Pm={},Tm=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={effect:e.effect,pts:[],updateRate:e.updateRate},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){return this.state.updateRate!==e.updateRate&&(this.state.updateRate=e.updateRate,clearInterval(this.timer),this.run()),!0}},{key:"componentDidMount",value:function(){this.run()}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"run",value:function(){var e=this;this.timer=setInterval(function(){if(e.props.sequencerEngine.playing){var t=Array.from(e.props.effect.getSpectrum());e.setState({pts:t})}},this.state.updateRate)}},{key:"getXPositionForFrequency",value:function(e){if(void 0!==Pm[e])return Pm[e];for(var t=0,n=0;n<e;n++)t+=this.props.getWidth(n);return Pm[e]=t,t}},{key:"getBucketRect",value:function(e,t){var n=Cm(e,-160,0,1,160);return r.a.createElement(b.Rect,{width:this.props.getWidth(t),height:-2*n,y:160,x:this.getXPositionForFrequency(t),fill:this.rainbow(t)})}},{key:"rainbow",value:function(e){return"hsl("+e+",100%,50%)"}},{key:"render",value:function(){var e=this;return this.state.pts.map(function(t,n){return e.getBucketRect(t,n)})}}]),t}(a.Component),jm=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.equalizerPoint,t=e.enabled?"equalizer-point-info":"equalizer-point-info disabled";return this.props.selected&&(t+=" selected"),r.a.createElement("div",{onClick:this.props.onClick,className:t},r.a.createElement("div",{className:"equalizer-point-number"},e.number))}}]),t}(a.Component),xm=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getOption",value:function(e){return Nm.filter(function(t){return t.value===e})[0]}},{key:"onSelectOption",value:function(e){this.props.onUpdateRateChanged(e.value)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"osc-type-dropdown-container"},r.a.createElement(pp.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:Nm,onChange:function(t){return e.onSelectOption(t)},value:this.getOption(this.props.updateRate),placeholder:"LFO"}))}}]),t}(a.Component),Nm=[{value:100,label:"Fastest"},{value:hn,label:"Fast"},{value:350,label:"Medium"},{value:1e3,label:"Slow"},{value:1e4,label:"Slowest"}],qm=xm,Mm={},Dm=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={effect:e.effect,pts:[],frequency:0,selectedPoint:e.effect.equalizerPoints[0]},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"handleOptionChange",value:function(e){this.setState(this.state)}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"onChangeSynced",value:function(e){document.activeElement.blur(),this.setState(this.state)}},{key:"getWidth",value:function(e){if(void 0!==Mm[e])return Mm[e];var t=void 0;return t=e<5?Cm(256-e,252,256,20,30):e<12?Cm(256-e,245,252,8,20):e<16?Cm(256-e,241,245,4,8):Cm(256-e,0,241,1,4),Mm[e]=t,t}},{key:"setSelectedPoint",value:function(e){this.setState({selectedPoint:e})}},{key:"onClickEqualizerPoint",value:function(e){if(this.state.selectedPoint!==e)e.enabled||(e.enabled=!0),this.setState({selectedPoint:e});else{e.enabled=!1;var t=void 0;for(var n in this.state.effect.equalizerPoints){var a=this.state.effect.equalizerPoints[n];if(a.enabled){t=a;break}}this.setState({selectedPoint:t})}}},{key:"onUpdateRateChanged",value:function(e){this.state.effect.updateRate=e,this.setState(this.state)}},{key:"render",value:function(){var e,t,n,a=this;this.props.automation;return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement("div",{className:"spectrum-container"},r.a.createElement(b.Stage,{width:620,height:160},r.a.createElement(b.Layer,null,r.a.createElement(b.Rect,{width:620,height:160,fill:"black"}),r.a.createElement(Tm,{updateRate:this.state.effect.updateRate,sequencerEngine:this.props.sequencerEngine,getWidth:function(e){return a.getWidth(e)},effect:this.state.effect})),r.a.createElement(b.Layer,null,r.a.createElement(b.Line,{closed:!1,points:[0,80,620,80],strokeWidth:2,stroke:"#1f1f1f"}),r.a.createElement(wm,{selectedPoint:this.state.selectedPoint,setSelectedPoint:function(e){return a.setSelectedPoint(e)},effect:this.props.effect,getWidth:function(e){return a.getWidth(e)},setDraggingPoint:function(e){return a.setState({draggingPoint:e})}})))),r.a.createElement("div",{className:"equalizer-parameters"},r.a.createElement("div",{className:"equalizer-points"},this.state.effect.equalizerPoints.map(function(e){return r.a.createElement(jm,{onClick:function(){return a.onClickEqualizerPoint(e)},selected:a.state.selectedPoint===e,equalizerPoint:e})}),r.a.createElement("div",{className:"eq8-update-rate-dropdown-container"},r.a.createElement(qm,{updateRate:this.state.effect.updateRate,onUpdateRateChanged:function(e){return a.onUpdateRateChanged(e)}}))),r.a.createElement("div",{className:"equalizer-sliders-container"},r.a.createElement(Gl,(e={effectNumber:this.props.effectNumber,automation:this.props.automation,unit:"hz",name:"Frequency",selectedParameter:this.props.selectedParameter,parameter:this.state.selectedPoint.frequencyParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.1,max:12e3,min:0,sequencerEngine:this.props.sequencerEngine},Object(_e.a)(e,"isParameter",!0),Object(_e.a)(e,"lfoEnabled",!0),e)),r.a.createElement(Gl,(t={effectNumber:this.props.effectNumber,automation:this.props.automation,unit:"db",onParameterChanged:this.props.onParameterChanged,name:"Gain",selectedParameter:this.props.selectedParameter,parameter:this.state.selectedPoint.gainParameter,isParameter:!0,step:.1,max:12,min:-12,sequencerEngine:this.props.sequencerEngine},Object(_e.a)(t,"isParameter",!0),Object(_e.a)(t,"lfoEnabled",!0),t)),r.a.createElement(Gl,(n={effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Q",selectedParameter:this.props.selectedParameter,parameter:this.state.selectedPoint.qParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.1,max:16,min:.1,sequencerEngine:this.props.sequencerEngine},Object(_e.a)(n,"isParameter",!0),Object(_e.a)(n,"lfoEnabled",!0),n))))):"")}}]),t}(a.Component),Am=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={effect:e.effect},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){void 0!==this.props.automation||this.state.effect.isEnabled();return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Width",selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,parameter:this.state.effect.widthParameter,isParameter:!0,onParameterChanged:this.props.onParameterChanged,step:.01,max:1,min:0}),r.a.createElement(Up,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.state.effect})):"")}}]),t}(a.Component),Rm=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.props.effect.isEnabled()}},{key:"render",value:function(){void 0!==this.props.automation||this.props.effect.isEnabled();return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Rate",parameter:this.props.effect.rateParameter,onParameterChanged:this.props.onParameterChanged,sequencerEngine:this.props.sequencerEngine,isParameter:!0,lfoEnabled:!0,step:1e-4,min:0,max:1}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Feedback",lfoEnabled:!0,selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,unit:"%",parameter:this.props.effect.feedbackParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,displayFunction:function(e){return Math.floor(100*e)},step:.01,max:1,min:0}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Saturation",lfoEnabled:!0,selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,parameter:this.props.effect.driveParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.01,max:6,min:.1}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Low",lfoEnabled:!0,selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,parameter:this.props.effect.lowEQParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.01,max:6,min:-40}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Mid",lfoEnabled:!0,selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,parameter:this.props.effect.midEQParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.01,max:6,min:-40}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"High",lfoEnabled:!0,selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,parameter:this.props.effect.highEQParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,step:.01,max:6,min:-40}),r.a.createElement(Up,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"")}}]),t}(a.Component),Im=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={delayEffect:e.effect},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.delayEffect=e.effect,!0}},{key:"handleOptionChange",value:function(e){this.setState(this.state)}},{key:"handleFeedbackChange",value:function(e){this.state.delayEffect.setFeedback(e),this.setState(this.state)}},{key:"handleDelayTimeChange",value:function(e){"LEFT"===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"LEFT")?this.state.delayEffect.leftDelay.rate=e.value:this.state.delayEffect.rightDelay.rate=e.value,this.setState(this.state)}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.delayEffect.isEnabled()}},{key:"onChangeSynced",value:function(e){document.activeElement.blur(),this.props.effect.isSynced="unsynced"===e,this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.props.effect,n=t.isSynced;void 0!==this.props.automation||t.isEnabled();return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement("div",{className:"refined-checkbox-preferences lfo-synced-checkbox"},r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",value:n?"synced":"unsynced",checked:n,onChange:function(t){return e.onChangeSynced(t.target.value)}}),"Synced")),n?r.a.createElement("div",null,r.a.createElement("div",{className:"lfo-rate-dropdown"},r.a.createElement("div",{className:"lfo-rate-label"},"Left Rate:"),r.a.createElement(pp.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:Lm,onChange:function(t){return e.handleDelayTimeChange(t,"LEFT")},value:Fm(this.props.effect.leftDelay.rawDelayRate),placeholder:"Rate"}),r.a.createElement("div",{className:"clear-fix"})),r.a.createElement("div",{className:"lfo-rate-dropdown"},r.a.createElement("div",{className:"lfo-rate-label"},"Right Rate:"),r.a.createElement(pp.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:Lm,onChange:function(t){return e.handleDelayTimeChange(t,"RIGHT")},value:Fm(this.props.effect.rightDelay.rawDelayRate),placeholder:"Rate"}),r.a.createElement("div",{className:"clear-fix"}))):r.a.createElement("div",null,r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Left Rate",parameter:this.state.delayEffect.leftDelay.rateParameter,onParameterChanged:this.props.onParameterChanged,sequencerEngine:this.props.sequencerEngine,isParameter:!0,lfoEnabled:!0,step:1,min:1,max:1e3}),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,name:"Right Rate",parameter:this.state.delayEffect.rightDelay.rateParameter,onParameterChanged:this.props.onParameterChanged,sequencerEngine:this.props.sequencerEngine,isParameter:!0,lfoEnabled:!0,step:1,min:1,max:1e3})),r.a.createElement(Gl,{effectNumber:this.props.effectNumber,automation:this.props.automation,name:"Feedback",lfoEnabled:!0,selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,unit:"%",parameter:this.state.delayEffect.feedbackParameter,onParameterChanged:this.props.onParameterChanged,isParameter:!0,displayFunction:function(e){return Math.floor(100*e)},step:.01,max:1,min:0}),r.a.createElement(Up,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onParameterChanged:this.props.onParameterChanged,effect:this.state.delayEffect})):"")}}]),t}(a.Component),Lm=[{value:"1n",label:"1"},{value:"2n",label:"1/2"},{value:"4n",label:"1/4"},{value:"4t",label:"1/4t"},{value:"8n",label:"1/8"},{value:"8n.",label:"1/8."},{value:"8t",label:"1/8t"},{value:"16n",label:"1/16"},{value:"16t",label:"1/16t"},{value:"32n",label:"1/32"}];function Fm(e){var t=Lm.filter(function(t){return t.value===e});return 0==t.length?"16n":t[0]}var Vm=Im,Bm=(a.Component,function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={showMods:!1,waveformData:[]},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onChangeSynced",value:function(e){document.activeElement.blur(),this.props.lfo.lfo.isSynced="unsynced"===e,console.log("isSynced is now = "+this.props.lfo.lfo.isSynced),this.setState(this.state)}},{key:"onClickModsButton",value:function(){this.setState({showMods:!this.state.showMods})}},{key:"isSelected",value:function(){return!this.props.hideSelection&&this.props.lfo.lfo.number===this.props.selectedLFO}},{key:"render",value:function(){var e=this,t=this.props.lfo.lfo,n=this.isSelected()?"lfo-component selected":"lfo-component";return r.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("LFO_COMPONENT")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.props.setSelectedLFO(t.number)},className:n},r.a.createElement("div",{className:"instrument-subsection-name lfo-subsection-name lfo-track-foreground-"+this.props.lfo.number},this.props.lfo.getName()),r.a.createElement(O,{condition:this.state.showMods},r.a.createElement(dp,{parameters:this.props.lfo.lfo.parameters})),r.a.createElement(O,{condition:!this.state.showMods},r.a.createElement(Wh,{lfo:t}),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement("div",{className:"refined-checkbox-preferences lfo-synced-checkbox"},r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",value:t.isSynced?"synced":"unsynced",checked:t.isSynced,onChange:function(t){return e.onChangeSynced(t.target.value)}}),"Synced")),t.isSynced?r.a.createElement(Gh,{lfo:t}):r.a.createElement(Gl,{effectNumber:0,name:"Rate",parameter:t.lfoRateParameter,onParameterChanged:function(){return[]},isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,step:.1,min:0,max:32}),r.a.createElement(Gl,{effectNumber:0,name:"Min",contextualHelp:"LFO_MIN_SLIDER",parameter:t.lfoMinParameter,sequencerEngine:this.props.sequencerEngine,onParameterChanged:function(){return[]},isParameter:!0,lfoEnabled:!0,min:-100,max:100,step:1}),r.a.createElement(Gl,{effectNumber:0,name:"Max",parameter:t.lfoMaxParameter,contextualHelp:"LFO_MAX_SLIDER",sequencerEngine:this.props.sequencerEngine,onParameterChanged:function(){return[]},lfoEnabled:!0,isParameter:!0,min:-100,max:100,step:1}),r.a.createElement(Gl,{effectNumber:0,name:"Phase",sequencerEngine:this.props.sequencerEngine,parameter:t.lfoPhaseParameter,onParameterChanged:function(){return[]},isParameter:!0,min:0,max:360,step:1})),r.a.createElement("div",{className:"mods-button",onClick:function(){return e.onClickModsButton()}},this.state.showMods?"BACK":"MODS"))}},{key:"meter",get:function(){return this.props.lfo.lfo.meter}}]),t}(a.Component)),Um=Object(y.b)(function(e){return{selectedLFO:e.sequencer.selectedLFO}},function(e,t){return{setContextualHelp:function(t){return e(Object(w.V)(t))},setSelectedLFO:function(t){return e(Object(w.Oc)(t))}}})(Bm),Hm=20,Jm=40,Gm="INPUT",zm="OUTPUT",_m=500,Wm=300;function Km(e,t,n){for(var a=0;Ym(e,t,n)&&a<40;)(e+=Jm)>=_m-Jm&&(e=Jm,(t=t+Hm+20)>=Wm-Hm&&(t=Hm+40)),a++;return{x:e,y:t}}function Ym(e,t,n){for(var a in n.effects){var r=n.effects[a],s=r.x,i=r.y;if(e>=s&&t>=i&&e<=s+Jm&&t<=i+Hm)return!0}return!1}var Qm=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onSelectTrack",value:function(e){for(var t in this.tracks)this.tracks[t].isConnectedToEnvelope(this.props.envelope)&&this.tracks[t].disconnectFromEnvelope(this.props.envelope);e.value.connectToEnvelope(this.props.envelope),this.setState(this.state)}},{key:"getTruncatedName",value:function(e){var t=e.getName();return void 0===t?"":t.length>=16?t.slice(0,16)+"...":t}},{key:"getOptions",value:function(){var e=this;return this.props.sequencerEngine.tracks.map(function(t){return{label:t.trackNumber+1+". "+e.getTruncatedName(t),value:t}})}},{key:"getSelectedOption",value:function(){var e=this;return this.getOptions().filter(function(t){return t.value.isConnectedToEnvelope(e.props.envelope)})[0]}},{key:"render",value:function(){var e=this,t=this.props.isSelected&&void 0===this.getSelectedOption()?"envelope-dropdown osc-type-dropdown-container selected":"envelope-dropdown osc-type-dropdown-container";return r.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("ENVELOPE_TRACK_DROPDOWN")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:t},r.a.createElement(pp.a,{controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.getOptions(),onChange:function(t){return e.onSelectTrack(t)},value:this.getSelectedOption(),placeholder:"Track"}),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement("div",{className:"pre-post-options"},r.a.createElement("div",{onClick:function(){return e.onClickMode("PRE_FX")},className:this.preFXClassName},"Pre-FX"),r.a.createElement("div",{onClick:function(){return e.onClickMode("POST_FX")},className:this.postFXClassName},"Post-FX")))}},{key:"onClickMode",value:function(e){var t=this.connectedTrack;void 0!==t&&(t.setEnvelopeMode(this.props.envelope,e),this.setState(this.state))}},{key:"tracks",get:function(){return this.props.sequencerEngine.tracks}},{key:"connectedTrack",get:function(){var e=this;return this.tracks.filter(function(t){return t.isConnectedToEnvelope(e.props.envelope)})[0]}},{key:"mode",get:function(){var e=this.connectedTrack;if(void 0!==e)return e.getEnvelopeMode(this.props.envelope)}},{key:"preFXClassName",get:function(){return void 0!==this.mode&&"POST_FX"!==this.mode?"pre-post-option selected":"pre-post-option"}},{key:"postFXClassName",get:function(){return void 0!==this.mode&&"PRE_FX"!==this.mode?"pre-post-option selected":"pre-post-option"}}]),t}(a.Component),Xm=Object(y.b)(function(e){return{tracks:e.tracks.trackSteps}},function(e,t){return{setContextualHelp:function(t){return e(Object(w.V)(t))}}})(Qm),Zm=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={showEnvelopeModal:!1,value:0},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.interval=setInterval(function(){e.isSelected()&&e.setState({value:e.props.envelopeTrack.envelope.envelope.value})},100)}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"showEnvelopeModal",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.setState({showEnvelopeModal:e})}},{key:"isSelected",value:function(){return!this.props.hideSelection&&this.props.selectedEnvelope===this.props.envelopeTrack.number}},{key:"render",value:function(){var e=this,t="instrument-subsection-name lfo-subsection-name lfo-track-foreground-"+this.props.envelopeTrack.number,n=this.props.envelopeTrack.envelope,a=this.isSelected(),s=a?"envelope-component selected":"envelope-component",i={width:100*this.state.value+"%"};return r.a.createElement("div",{onClick:function(){return e.props.setSelectedEnvelope(e.props.envelopeTrack.number)},onMouseOver:function(){return e.props.setContextualHelp("ENVELOPE_COMPONENT")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:s},r.a.createElement(ud,{envelopeType:"SYSTEM",name:this.props.envelopeTrack.name,envelope:n,showLevel:!1,show:this.state.showEnvelopeModal,hide:function(){return e.showEnvelopeModal(!1)}}),r.a.createElement("div",{className:t},this.props.envelopeTrack.name),r.a.createElement(Xm,{isSelected:a,sequencerEngine:this.props.sequencerEngine,envelope:n}),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(Gl,{effectNumber:0,name:"Attack",parameter:n.attackParameter,sequencerEngine:this.props.sequencerEngine,onParameterChanged:function(){return[]},lfoEnabled:!0,isParameter:!0,min:0,max:6e3,step:1}),r.a.createElement(Gl,{effectNumber:0,name:"Decay",sequencerEngine:this.props.sequencerEngine,parameter:n.decayParameter,onParameterChanged:function(){return[]},isParameter:!0,lfoEnabled:!0,min:0,max:6e3,step:1}),r.a.createElement(Gl,{effectNumber:0,name:"Sustain",parameter:n.sustainParameter,onParameterChanged:function(){return[]},isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,min:0,max:1,step:.01}),r.a.createElement(Gl,{effectNumber:0,sequencerEngine:this.props.sequencerEngine,name:"Release",parameter:n.releaseParameter,onParameterChanged:function(){return[]},lfoEnabled:!0,isParameter:!0,min:0,max:1e4,step:1}),r.a.createElement("div",{onClick:function(){return e.showEnvelopeModal()},className:"draw-envelope-modal-button"},"DRAW"),r.a.createElement("div",{className:"envelope-value-container"},r.a.createElement(O,{condition:this.isSelected()},r.a.createElement("div",{className:"envelope-value",style:i}))))}}]),t}(a.Component),$m=Object(y.b)(function(e){return{selectedEnvelope:e.sequencer.selectedEnvelope}},function(e){return{setSelectedEnvelope:function(t){return e(Object(w.Kc)(t))},setContextualHelp:function(t){return e(Object(w.V)(t))}}})(Zm);function ev(e){var t=e.edge,n=e.sequencerEngine;return r.a.createElement("div",null,r.a.createElement("div",null,"Edge Properties:"),r.a.createElement(Gl,{effectNumber:0,automation:void 0,name:"Gain",selectedParameter:void 0,sequencerEngine:n,lfoEnabled:!0,parameter:t.gainParameter,isParameter:!0,onParameterChanged:function(){return[]},step:.01,max:1,min:.01}))}var tv="#4f4d54",nv={INPUT:"Input for node",OUTPUT:"Output for node"};function av(e){var t=e.x,n=e.y,a=e.mode,s=e.parameter,i=a===Gm?"down":"up",o=nv[a];return s&&s.name&&(o=s.name+": "+s.get()),n=a===Gm?n-5:n+5,r.a.createElement(b.Label,{x:t,y:n},r.a.createElement(b.Tag,{fill:tv,pointerDirection:i,pointerHeight:20,pointerWidth:10}),r.a.createElement(b.Text,{fontSize:10,text:o,padding:5,fill:"white"}))}var rv=300;function sv(e){var t=e.x,n=e.y,s=e.number,i=e.mode,o=e.parameter,c=e.startDrawingEdge,u=(e.drawingEdge,e.effect),l=e.connectEdge,p=Object(a.useState)(!1),h=Object(Z.a)(p,2),d=h[0],f=h[1],m=Object(a.useState)(!1),v=Object(Z.a)(m,2),g=v[0],y=v[1],k=Object(a.useState)(null),E=Object(Z.a)(k,2),S=E[0],O=E[1];n=i===Gm?n:n+Hm;var w=Object(a.useCallback)(function(){f(!0),O(setTimeout(function(){y(!0)},rv))},[f,d,O,y]),C=Object(a.useCallback)(function(e){clearTimeout(S),y(!1),f(!1)},[f,y,S]),P=Object(a.useCallback)(function(){c(u,i,t+8*s,n)},[c,y,u,i,s,t,n]);return r.a.createElement(b.Group,null,r.a.createElement(b.Circle,{strokeWidth:d?2:0,stroke:d?"yellow":"black",x:t+8*s,onMouseDown:P,onMouseOver:d?function(){return[]}:w,onMouseLeave:C,onMouseUp:function(){return l(o||u,i)},y:n,radius:3,fill:"black"}),g?r.a.createElement(av,{parameter:o,mode:i,x:t+8*s,y:n}):r.a.createElement(b.Rect,{x:0,y:0,width:0,height:0}))}var iv=Object(a.memo)(function(e){var t=e.effect,n=e.x,a=e.y,s=(e.setDragging,e.connectEdge),i=e.startDrawingEdge,o=e.drawingEdge,c=(e.selectedEdge,e.setSelectedEdge,e.edges,[void 0]),u=[void 0];return t.parameters&&(u=[].concat(Object(ge.a)(u),Object(ge.a)(t.parameters.filter(function(e){return e.isAudioParamEnabled()})))).length>8&&(u=u.slice(0,8)),r.a.createElement(b.Group,null,u.map(function(e,c){return r.a.createElement(sv,{x:n,y:a,key:"intput-"+c,number:c+1,mode:Gm,parameter:e,effect:t,connectEdge:s,drawingEdge:o,startDrawingEdge:i})}),c.map(function(e,c){return r.a.createElement(sv,{key:"output-"+c,x:n,y:a,parameter:e,drawingEdge:o,number:c+1,mode:zm,connectEdge:s,startDrawingEdge:i,effect:t})}))}),ov=Object(y.b)(function(e,t){return void 0!==t.x?{}:{x:t.effect.x,y:t.effect.y}},null)(iv);function cv(e){return r.a.createElement("div",null,r.a.createElement(pp.a,{className:"effect-dropdown",options:tu,onChange:function(t){return function(t){var n=nu(t,e.sequencerEngine);e.handleChooseEffect(n)}(t.value)},placeholder:"Add FX"}))}function uv(e){var t=e.drawingEdge;if(void 0===t)return r.a.createElement(b.Rect,{x:0,y:0,width:0,height:0});var n=t.x1,a=t.y1,s=t.x2,i=t.y2;return r.a.createElement(b.Arrow,{pointerLength:6,pointerWidth:4,points:[n,a,s,i],fill:"red",strokeWidth:2,stroke:"red"})}var lv=new U.a;var pv=Object(y.b)(function(e,t){return t.modulator?{x2:t.edge.context.effect.x,y2:t.edge.context.effect.y}:{x1:t.effect.x,y1:t.effect.y,x2:t.edge.effect.x,y2:t.edge.effect.y}},null)(function(e){var t=e.effect,n=e.edge,s=e.setSelectedEdge,i=e.selected,o=e.modulator,c=Object(a.useState)(!1),u=Object(Z.a)(c,2),l=u[0],p=u[1],h=function(e,t){return void 0===e?{x1:void 0,y1:void 0,x2:void 0,y2:void 0}:{x1:5+(e.getType()===Jt?4+e.number:e.number)/9*500,y1:Hm,x2:function(e){if(void 0===e||void 0===e.context.effect.parameters)return 0;var t=e.context.effect.parameters.filter(function(e){return e.isAudioParamEnabled()}).indexOf(e);return e.context.effect.x+15+8*t}(t),y2:t.context.effect.y}}(o,n),d=h.x1,f=h.y1,m=h.x2,v=h.y2;o||(d=t.x+8,f=t.y+Hm,m=n.effect.x+8,v=n.effect.y);var g="#b942f5";o&&(g=o.getType()===Jt?"#3abcd6":"#3ad688");var y=i||l?"red":g,k=Object(a.useCallback)(function(){p(!0)},[p]),E=Object(a.useCallback)(function(){p(!1)},[p]),S=Object(a.useCallback)(function(){s(o?{modulator:o,edge:n}:n)},[s,n,o]);return l||o||i||(y=lv.brighten(y,.2+Math.pow(4,n.gainParameter.get())/4)),r.a.createElement(b.Group,null,r.a.createElement(b.Arrow,{onMouseOver:k,onMouseLeave:E,onMouseDown:S,pointerLength:6,pointerWidth:4,fill:y,points:[d,f,m,v],strokeWidth:2,stroke:y}))}),hv=Object(a.memo)(function(e){var t=e.edges,n=e.rack,a=e.setSelectedEdge,s=e.selectedEdge,i=t[-1]||[],o=[],c=function(e){var i=n.effects[e],c=t[i.id];if(void 0===c)return"continue";o=[].concat(Object(ge.a)(o),Object(ge.a)(c.map(function(e,t){return r.a.createElement(pv,{effect:i,key:"input-edge- "+t+"-"+i.id,edge:e,rack:n,setSelectedEdge:a,selected:s===e})})))};for(var u in n.effects)c(u);return r.a.createElement(b.Group,null,i.map(function(e,t){return r.a.createElement(pv,{key:"edge- "+t,effect:n.inputNode,edge:e,rack:n,setSelectedEdge:a,selected:s===e})}),o)});function dv(e){var t=e.lfoEdges,n=e.envelopeEdges,a=e.rack,s=e.setSelectedEdge,i=e.selectedEdge,o=[],c=function(e){var c=a.modulators[e],u="LFO"===c.getType()?t[c.number]:n[c.number];if(void 0===u)return"continue";o=[].concat(Object(ge.a)(o),Object(ge.a)(u.map(function(e){return r.a.createElement(pv,{key:c.getType()+"-"+c.number+"-edge-"+e.id,modulator:c,edge:e,setSelectedEdge:s,selected:!!i&&(i.modulator===c&&i.edge===e)})})))};for(var u in a.modulators)c(u);return r.a.createElement(b.Group,null,o)}var fv=Object(a.memo)(function(e){var t=e.numberOfModulators,n=e.number,s=(e.startDrawing,e.setDragging),i=e.connectEdge,o=e.startDrawingEdge,c=e.setSelectedNode,u=e.drawingEdge,l=e.width,p=(e.height,e.modulator),h=e.selected,d=1*(n+1)/(t+1)*l,f=p.getType()===Ht?"LFO "+p.number:"Env "+p.number,m=Object(a.useCallback)(function(){c(p)},[c,p]);return r.a.createElement(b.Group,null,r.a.createElement(b.Rect,{onMouseDown:m,fill:h?"red":"#4a4e4b",x:d,y:0,width:35,height:Hm}),r.a.createElement(b.Text,{onMouseDown:m,text:f,fill:"white",fontSize:10,fontFamily:"Arial",x:d+3,y:5}),r.a.createElement(sv,{x:d,y:0,number:1,mode:zm,effect:p,setDragging:s,connectEdge:i,drawingEdge:u,startDrawingEdge:o}))}),mv=(n(2330),Object(a.memo)(function(e){var t=e.effect,n=e.x,s=e.y,i=e.text,o=e.hasInput,c=e.hasOutput,u=e.setDragging,l=e.connectEdge,p=e.startDrawingEdge,h=e.drawingEdge,d=e.selected,f=e.selectedEdge,m=e.setSelectedEdge;e.edges;i||(i=t.name,o=!0,c=!0);var v=8+6*i.length,g=c?[void 0]:[],y=o?[void 0]:[],k=Object(a.useCallback)(function(e){u&&u({effect:t,x:e.evt.layerX-n,y:e.evt.layerY-s})},[u,n,s]),E=d?"red":"#4a4e4b";return r.a.createElement(b.Group,null,r.a.createElement(b.Rect,{onMouseDown:function(e){return k(e)},fill:E,x:n,y:s,width:v,height:Hm}),r.a.createElement(b.Text,{onMouseDown:function(e){return k(e)},text:i,fill:"white",fontSize:10,fontFamily:"Arial",x:n+3,y:s+5}),y.map(function(e,a){return r.a.createElement(sv,{x:n,y:s,key:"intput-"+a,number:a+1,mode:Gm,parameter:e,effect:t,connectEdge:l,drawingEdge:h,startDrawingEdge:p})}),g.map(function(e,a){return r.a.createElement(sv,{key:"output-"+a,x:n,y:s,parameter:e,setSelectedEdge:m,selectedEdge:f,drawingEdge:h,number:a+1,mode:zm,connectEdge:l,startDrawingEdge:p,effect:t})}))})),vv=Object(y.b)(function(e,t){return void 0!==t.x?{}:{x:t.effect.x,y:t.effect.y}},null)(mv),gv="#2b2d3c";var bv=Object(y.b)(function(e,t){return{isSelected:e.effects.selectedEffect===t.effect.id}},function(e,t){return{setNodePosition:function(n,a,r){return e(Object(w.nb)(t.effect.id,n,a,r))}}})(function(e){var t=e.effect,n=Object(a.useState)(void 0),s=Object(Z.a)(n,2),i=s[0],o=s[1],c=Object(a.useState)(void 0),u=Object(Z.a)(c,2),l=u[0],p=u[1],h=Object(a.useState)(void 0),d=Object(Z.a)(h,2),f=d[0],m=d[1],v=Object(a.useState)(t.effects),g=Object(Z.a)(v,2),y=g[0],k=g[1],E=Object(a.useState)(void 0),S=Object(Z.a)(E,2),O=S[0],w=S[1],C=Object(a.useState)(t.adjacencyLists),P=Object(Z.a)(C,2),T=P[0],j=P[1],x=Object(a.useState)(t.lfoAdjacencyLists),N=Object(Z.a)(x,2),q=N[0],M=N[1],D=Object(a.useState)(t.envelopeAdjacencyLists),A=Object(Z.a)(D,2),R=A[0],I=A[1],L=Object(a.useState)(t.modulators),F=Object(Z.a)(L,2),V=F[0],B=(F[1],Object(a.useCallback)(function(n){var a=100,r=200;i&&void 0===i.getType&&(a=i.x,r=i.y);var s=Km(a,r,t),c=s.x,u=s.y;console.log("adding effect=",n),t.addEffect(n),n.x=c,n.y=u,e.setNodePosition(n.id,c,u),o(n),k(Object(ge.a)(t.effects))},[k,o,i]));Object(a.useEffect)(function(){t.setSize(_m,Wm,Jm,Hm),k(Object(ge.a)(t.effects))},[k]),Object(a.useEffect)(function(){f&&o(f.effect)},[f,o,p]),Object(a.useEffect)(function(){return window.addEventListener("keydown",U),function(){return window.removeEventListener("keydown",U)}},[l,o,i,j,k,e.isSelected]);var U=Object(a.useCallback)(function(n){if("INPUT"!==n.target.tagName.toUpperCase()&&e.isSelected)if(n.stopPropagation(),"Backspace"===n.key)l?(t.deleteEdge(l),j(Object(X.a)({},t.adjacencyLists)),M(Object(X.a)({},t.lfoAdjacencyLists)),I(Object(X.a)({},t.envelopeAdjacencyLists))):i&&(t.deleteEffect(i),o(void 0),M(Object(X.a)({},t.lfoAdjacencyLists)),I(Object(X.a)({},t.envelopeAdjacencyLists)),j(Object(X.a)({},t.adjacencyLists)),k(Object(ge.a)(t.effects)));else if("d"===n.key&&n.metaKey&&(n.preventDefault(),n.stopPropagation(),i&&void 0===i.getType)){var a=i.getEffectCopy();a.id=Object(We.uuid)(),t.addEffect(a);var r=Km(i.x,i.y,t),s=r.x,c=r.y;a.x=s,a.y=c,k(Object(ge.a)(t.effects))}},[e.isSelected,l,o,i,j,k,M,I]);Object(a.useEffect)(function(){i&&p(void 0)},[i,p]),Object(a.useEffect)(function(){l&&o(void 0)},[l,o]);var H=Object(a.useCallback)(function(t){if(f){var n=t.evt.layerX-f.x,a=t.evt.layerY-f.y,r=f.effect;r.x=n,r.y=a,e.setNodePosition(r.id,n,a)}O&&w(Object(X.a)({},O,{x2:t.evt.layerX,y2:t.evt.layerY}))},[f,y,k,O,w]),J=Object(a.useCallback)(function(e){m(void 0),w(void 0)},[m,w]),G=Object(a.useCallback)(function(e,t,n,a){w({node:e,mode:t,x1:n,y1:a,x2:n,y2:a}),p(void 0)},[w,p]),z=Object(a.useCallback)(function(e,n){if(void 0!==O){if(n===Gm){if(O.mode===Gm)return;t.connectNodes(O.node,e)}else{if(O.mode===zm)return;t.connectNodes(e,O.node)}j(Object(X.a)({},t.adjacencyLists)),M(Object(X.a)({},t.lfoAdjacencyLists)),I(Object(X.a)({},t.envelopeAdjacencyLists))}},[O,j,I,M]),_="";if(i&&(_=i.getType?i.getType()===Ht?r.a.createElement(Um,{hideSelection:!0,sequencerEngine:e.sequencerEngine,lfo:i.context.lfoTrack}):r.a.createElement($m,{hideSelection:!0,sequencerEngine:e.sequencerEngine,envelopeTrack:i.context.envelopeTrack}):r.a.createElement(Sv.EffectComponent,{sequencerEngine:e.sequencerEngine,onDeleteEffect:function(){return[]},effect:i,track:e.track,send:e.send})),l)if(l.effect)_=r.a.createElement(ev,{edge:l,sequencerEngine:e.sequencerEngine});else if(l.modulator){var W=l.edge;_=r.a.createElement("div",null,r.a.createElement("div",null,"Parameter Mod Properties: "),r.a.createElement(dp,{parameters:[W]}))}return r.a.createElement("div",{className:"effect-rack"},r.a.createElement("div",{className:"rack-toolbar"},r.a.createElement(cv,{sequencerEngine:e.sequencerEngine,handleChooseEffect:B})),r.a.createElement("div",{className:"horizontal"},r.a.createElement("div",{className:"draw-component"},r.a.createElement(b.Stage,{width:_m,height:Wm,onMouseUp:J,onMouseMove:H},r.a.createElement(b.Layer,null,r.a.createElement(b.Rect,{x:0,y:0,width:_m,height:Wm,fill:gv}),r.a.createElement(dv,{envelopeEdges:R,lfoEdges:q,rack:t,setSelectedEdge:p,selectedEdge:l}),V.map(function(e,t){return r.a.createElement(fv,{number:t,width:_m,height:Wm,modulator:e,setDragging:m,setSelectedNode:o,selected:i===e,startDrawingEdge:G,drawingEdge:O,connectEdge:z,numberOfModulators:V.length})})),r.a.createElement(b.Layer,null,y.filter(function(e){return i===e}).map(function(e,n){return r.a.createElement(vv,{selected:!0,key:"node-"+e.id,setSelectedEdge:p,selectedEdge:l,setDragging:m,rack:t,startDrawingEdge:G,drawingEdge:O,connectEdge:z,edges:T[e.id],effect:e})})),r.a.createElement(b.Layer,null,y.filter(function(e){return i!==e}).map(function(e,n){return r.a.createElement(vv,{selected:!1,key:"node-"+e.id,setSelectedEdge:p,selectedEdge:l,setDragging:m,rack:t,startDrawingEdge:G,drawingEdge:O,connectEdge:z,edges:T[e.id],effect:e})}),r.a.createElement(hv,{edges:T,rack:t,setSelectedEdge:p,selectedEdge:l})),r.a.createElement(b.Layer,null,r.a.createElement(uv,{drawingEdge:O}),y.filter(function(e){return i===e}).map(function(e,n){return r.a.createElement(ov,{key:"node-"+e.id,setSelectedEdge:p,selectedEdge:l,rack:t,setDragging:m,startDrawingEdge:G,drawingEdge:O,connectEdge:z,edges:T[e.id],effect:e})})),r.a.createElement(b.Layer,null,y.filter(function(e){return i!==e}).map(function(e,n){return r.a.createElement(ov,{key:"node-"+e.id,setSelectedEdge:p,selectedEdge:l,rack:t,setDragging:m,startDrawingEdge:G,drawingEdge:O,connectEdge:z,edges:T[e.id],effect:e})}),r.a.createElement(vv,{hasOutput:!0,effect:t.inputNode,rack:t,text:"Input",x:0,startDrawingEdge:G,setSelectedEdge:p,selectedEdge:l,edges:T[-1],connectEdge:z,y:Wm/2-Hm/2}),r.a.createElement(vv,{hasInput:!0,text:"Output",startDrawingEdge:G,setSelectedEdge:p,selectedEdge:l,effect:t.outputNode,x:_m-Jm,connectEdge:z,y:Wm/2-Hm/2})))),_))}),yv=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={effect:e.effect},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.effect=e.effect,!0}},{key:"isEnabled",value:function(){return void 0!==this.props.automation||this.state.effect.isEnabled()}},{key:"render",value:function(){this.state.effect.compressorNode,this.state.effect.effectNode,void 0!==this.props.automation||this.state.effect.isEnabled();return r.a.createElement("div",null,this.isEnabled()?r.a.createElement("div",null,r.a.createElement(bv,{track:this.props.track,send:this.props.send,sequencerEngine:this.props.sequencerEngine,effect:this.state.effect})):"")}}]),t}(a.Component),kv=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return"Filter"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},track:this.props.track,group:this.props.group,send:this.props.send,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(Af,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,filterEffect:this.props.effect})):"Auto Filter"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{isTall:!0,effectNumber:this.props.effectNumber,onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,track:this.props.track,group:this.props.group,send:this.props.send,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(Ff,{track:this.track,sequencerEngine:this.props.sequencerEngine,effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,filterEffect:this.props.effect})):"Delay"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},effectNumber:this.props.effectNumber,onDeleteEffect:this.props.onDeleteEffect,track:this.props.track,send:this.props.send,group:this.props.group,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(nm,{effectNumber:this.props.effectNumber,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,delayEffect:this.props.effect})):"Tremolo"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},effectNumber:this.props.effectNumber,isTall:!0,onDeleteEffect:this.props.onDeleteEffect,track:this.props.track,send:this.props.send,group:this.props.group,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(Gf,{effectNumber:this.props.effectNumber,automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,tremoloEffect:this.props.effect})):"Chorus"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},effectNumber:this.props.effectNumber,onDeleteEffect:this.props.onDeleteEffect,track:this.props.track,send:this.props.send,group:this.props.group,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(Jf,{effectNumber:this.props.effectNumber,automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,chorusEffect:this.props.effect})):"Reverb"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,track:this.props.track,send:this.props.send,group:this.props.group,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(Vf,{effectNumber:this.props.effectNumber,automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,reverbEffect:this.props.effect})):"Convolver Reverb"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},effectNumber:this.props.effectNumber,onDeleteEffect:this.props.onDeleteEffect,track:this.props.track,send:this.props.send,group:this.props.group,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(Hf,Object.assign({},this.props,{effectNumber:this.props.effectNumber,automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,reverbEffect:this.props.effect}))):"Compressor"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},effectNumber:this.props.effectNumber,isTall:!0,onDeleteEffect:this.props.onDeleteEffect,send:this.props.send,track:this.props.track,group:this.props.group,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(am,{effectNumber:this.props.effectNumber,automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Distortion"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},effectNumber:this.props.effectNumber,onDeleteEffect:this.props.onDeleteEffect,send:this.props.send,track:this.props.track,group:this.props.group,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(mm,{sequencerEngine:this.props.sequencerEngine,effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"EQ 3"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},effectNumber:this.props.effectNumber,isTall:!0,onDeleteEffect:this.props.onDeleteEffect,send:this.props.send,track:this.props.track,group:this.props.group,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(sm,{sequencerEngine:this.props.sequencerEngine,effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"EQ 10"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},effectNumber:this.props.effectNumber,isTall:!0,onDeleteEffect:this.props.onDeleteEffect,send:this.props.send,track:this.props.track,group:this.props.group,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(im,{sequencerEngine:this.props.sequencerEngine,effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Bit Crusher"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,track:this.props.track,group:this.props.group,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(vm,{effectNumber:this.props.effectNumber,automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Ultra Phaser"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},isTall:!0,effectNumber:this.props.effectNumber,onDeleteEffect:this.props.onDeleteEffect,send:this.props.send,group:this.props.group,track:this.props.track,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(dm,{effectNumber:this.props.effectNumber,automation:this.props.automation,selectedParameter:this.props.selectedParameter,sequencerEngine:this.props.sequencerEngine,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Auto Wah"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},isTall:!0,track:this.props.track,effectNumber:this.props.effectNumber,onDeleteEffect:this.props.onDeleteEffect,send:this.props.send,group:this.props.group,effect:this.props.effect,automation:this.props.automation}),r.a.createElement(fm,{effectNumber:this.props.effectNumber,automation:this.props.automation,sequencerEngine:this.props.sequencerEngine,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Gate"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),r.a.createElement(qf,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Pitch Shift"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),r.a.createElement(bm,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Panner"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),r.a.createElement(ym,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"EQ8"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),r.a.createElement(Dm,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Chebyshev"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),r.a.createElement(rm,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Multiband Compressor"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),r.a.createElement(hm,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Stereo Widener"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),r.a.createElement(Am,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Saturator"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),r.a.createElement(gm,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Tape Delay"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),r.a.createElement(Rm,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Stereo Delay"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),r.a.createElement(Vm,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Oscilloscope"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),r.a.createElement(kh,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):"Effect Rack"===this.props.effect.name?r.a.createElement(mp,Object.assign({},this.props,{onToggle:function(){return e.setState(e.state)},onDeleteEffect:this.props.onDeleteEffect,effectNumber:this.props.effectNumber,effectClass:"rack",send:this.props.send,effect:this.props.effect,group:this.props.group,track:this.props.track,automation:this.props.automation}),r.a.createElement(yv,{effectNumber:this.props.effectNumber,tracks:this.props.tracks,sequencerEngine:this.props.sequencerEngine,automation:this.props.automation,selectedParameter:this.props.selectedParameter,onEffectsChange:this.props.onEffectsChange,onParameterChanged:this.props.onParameterChanged,effect:this.props.effect})):null}}]),t}(a.Component),Ev=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={selectedParameter:void 0},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"handleChooseMidiEffect",value:function(e){this.props.sequencerEngine.operationManager.dispatch(Ui(e,this.props.track,this.props.group,this.props.send)),this.setState(this.state)}},{key:"handleChooseLiveEffect",value:function(e){this.props.track.liveEffects.addEffect(e),this.setState(this.state)}},{key:"handleChooseEffect",value:function(e){e.enable(!0),this.props.sequencerEngine.operationManager.dispatch(Ui(e,this.props.track,this.props.group,this.props.send)),this.setState(this.state)}},{key:"onParameterChanged",value:function(e,t){void 0===this.props.track&&void 0===this.props.group&&void 0===this.props.send||(this.props.setSelectedEffect(t.id),this.props.onParameterChanged(e))}},{key:"onDeleteEffect",value:function(){this.setState(this.state)}},{key:"toggleLock",value:function(){this.props.track.togglePatternLock()}},{key:"onChangePanning",value:function(e){void 0!==this.props.track?this.props.track.setPanning(e):void 0!==this.props.group&&this.props.group.setPanning(e)}},{key:"render",value:function(){var e=this,t=void 0!==this.props.send?this.props.send.effects:void 0!==this.props.track?this.props.track.effects:this.props.group.effects;this.props.track&&(t=this.props.track.getEffects(this.props.chainNumber));var n=void 0!==this.props.send?this.props.send.getSendNodes():void 0!==this.props.track?this.props.track.getSendNodes():this.props.group.getSendNodes(),a=void 0!==this.props.track?this.props.track.midiEffects.effects:[],s=void 0!==this.props.track?this.props.track.liveEffects.effects:[],i=function(e){if(void 0!==e){if("MIDI"===e.getTrackType())return r.a.createElement(xh,{track:e});if("INSTRUMENT_RACK"===e.getTrackType())return r.a.createElement(Zf,{track:e});if("INSTRUMENT"===e.getTrackType()){var t=e.sequencerEngine,n=e.instrument.getInstrumentType();return n===Ho?r.a.createElement(Nf,{key:e.trackNumber+"-instrument",track:e,instrument:e.getInstrument()}):n===Jo?r.a.createElement(gd,{key:e.trackNumber+"-instrument",sequencerEngine:t,track:e,instrument:e.getInstrument()}):n===Go?r.a.createElement(Pf,{key:e.trackNumber+"-instrument",sequencerEngine:t,track:e,instrument:e.getInstrument()}):n===zo?r.a.createElement(Tf,{key:e.trackNumber+"-instrument",sequencerEngine:t,track:e,instrument:e.getInstrument()}):n===Uo?r.a.createElement(lf,{key:e.trackNumber+"-instrument",sequencerEngine:t,track:e,instrument:e.getInstrument()}):void 0}}}(this.props.track)||"";return this.props.isFrozen&&(i=""),r.a.createElement("div",{className:"effects-view"},i,s.map(function(t,n){return r.a.createElement(gh,{key:"live-effect-"+n,sequencerEngine:e.props.sequencerEngine,onDeleteEffect:function(){return e.onDeleteEffect()},effect:t,selectedParameter:e.state.selectedParameter,track:e.props.track,tracks:e.props.tracks,onParameterChanged:function(n){return e.onParameterChanged(n,t)},onEffectsChange:e.props.onEffectsChange})}),a.map(function(t,n){return r.a.createElement(ph,{key:"midi-effect-"+n,sequencerEngine:e.props.sequencerEngine,onDeleteEffect:function(){return e.onDeleteEffect()},effect:t,isMixCollapsed:e.props.isMixCollapsed,selectedParameter:e.state.selectedParameter,track:e.props.track,tracks:e.props.tracks,onParameterChanged:function(n){return e.onParameterChanged(n,t)},onEffectsChange:e.props.onEffectsChange})}),t.map(function(t,n){return r.a.createElement(kv,{sequencerEngine:e.props.sequencerEngine,key:"effect-"+n,onDeleteEffect:function(){return e.onDeleteEffect()},effect:t,isMixCollapsed:e.props.isMixCollapsed,selectedParameter:e.state.selectedParameter,track:e.props.track,group:e.props.group,send:e.props.send,tracks:e.props.tracks,onParameterChanged:function(n){return e.onParameterChanged(n,t)},onEffectsChange:e.props.onEffectsChange})}),r.a.createElement(Ah,{track:this.props.track,sequencerEngine:this.props.sequencerEngine,addClassName:"add-track-effects-button",handleChooseMidiEffect:function(t){return e.handleChooseMidiEffect(t)},handleChooseLiveEffect:function(t){return e.handleChooseLiveEffect(t)},handleChooseEffect:function(t){return e.handleChooseEffect(t)},store:this.props.store}),n.map(function(t,n){return r.a.createElement(Sh,{key:"track-send-"+n,track:e.props.track,sequencerEngine:e.props.sequencerEngine,sendNumber:n,send:e.props.sends.getSends()[n],sendNode:t})}),r.a.createElement(Mf,{panning:this.props.panning,onChangePanning:function(t){return e.onChangePanning(t)}}),r.a.createElement("div",{className:"effect-lock"},r.a.createElement(O,{condition:!this.props.hideLock},r.a.createElement(Fl,{patternLocked:this.props.patternLocked,toggleLock:function(){return e.toggleLock()}}))))}}]),t}(a.Component),Sv={EffectsView:Object(y.b)(function(e,t){var n=!1,a=!1;void 0!==t.track&&(n=((e.tracks.trackPatternLocks[t.track.subSequence.id]||{})[t.track.trackNumber]||{})[t.track.currentPattern]||!1,a=t.track.isFrozen);var r=0,s=void 0;void 0!==t.track?(r=e.tracks.trackPannings[t.track.trackNumber]||0,s=t.track.chainNumber):void 0!==t.group&&(r=e.tracks.groupPannings[t.group.groupNumber]||0);var i=t.track||t.group||t.send;return{isFrozen:a,patternLocked:n,panning:r,chainNumber:s,effects:i.effects,midiEffects:i.midiEffects&&i.midiEffects.effects}},function(e){return{setSelectedEffect:function(t){return e(Object(w.Jc)(t))}}})(Ev),EffectComponent:kv},Ov=(a.Component,function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"handleChooseEffect",value:function(e){var t=this.props.send,n=null;"Filter"===e?n=new un.FilterEffect(this.props.sequencerEngine):"Reverb"===e?n=new un.ReverbEffect(this.props.sequencerEngine):"Convolver Reverb"===e?n=new kn(this.props.sequencerEngine):"Delay"===e?n=new En(this.props.sequencerEngine):"Chorus"===e?n=new un.ChorusEffect(this.props.sequencerEngine):"Tremolo"===e?n=new un.TremoloEffect(this.props.sequencerEngine):"Auto Filter"===e?n=new un.AutoFilterEffect(this.props.sequencerEngine):"Compressor"===e?n=new Ln(this.props.sequencerEngine):"Distortion"===e?n=new Fn(this.props.sequencerEngine):"Bit Crusher"===e&&(n=new In(this.props.sequencerEngine)),n.toggle(),t.addEffect(n),this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.props.send.getEffects();return r.a.createElement("div",{className:"send-container"},r.a.createElement("div",{className:"send-name"},this.props.send.getName()),t.map(function(t){return r.a.createElement(wv,{onEffectsChange:function(){return e.props.send.onEffectsChange()},effect:t})}),r.a.createElement(Ah,{addClassName:"add-effects-button",handleChooseEffect:function(t){e.props.send.addEffect(t),e.setState(e.state)}}))}}]),t}(a.Component)),wv=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.effect,t="Filter"==e.getName(),n="Reverb"==e.getName(),a="Convolver Reverb"==e.getName(),s="Delay"==e.getName(),i="Chorus"==e.getName(),o="Tremolo"==e.getName(),c="AutoFilter"==e.getName();return t?r.a.createElement(Sv.FilterEffect,{onEffectsChange:this.props.onEffectsChange,filterEffect:e}):s?r.a.createElement(Sv.DelayEffect,{onEffectsChange:this.props.onEffectsChange,delayEffect:e}):n?r.a.createElement(Sv.ReverbEffect,{onEffectsChange:this.props.onEffectsChange,reverbEffect:e}):a?r.a.createElement(Sv.ConvolverReverbEffect,{onEffectsChange:this.props.onEffectsChange,reverbEffect:e}):i?r.a.createElement(Sv.ChorusEffect,{onEffectsChange:this.props.onEffectsChange,chorusEffect:e}):o?r.a.createElement(Sv.TremoloEffect,{onEffectsChange:this.props.onEffectsChange,tremoloEffect:e}):c?r.a.createElement(Sv.AutoFilterEffect,{onEffectsChange:this.props.onEffectsChange,tremoloEffect:e}):"Compressor"===e.getName()?r.a.createElement(Sv.CompressorEffect,{onEffectsChange:this.props.onEffectsChange,effect:e}):"Distortion"===e.getName()?r.a.createElement(Sv.DistortionEffect,{onEffectsChange:this.props.onEffectsChange,effect:e}):"Bit Crusher"===e.getName()?r.a.createElement(Sv.BitCrusherEffect,{onEffectsChange:this.props.onEffectsChange,effect:e}):r.a.createElement("div",null)}}]),t}(a.Component);function Cv(e){var t=Object(a.useState)(void 0),n=Object(Z.a)(t,2),s=n[0],i=n[1],o=Object(a.useState)(void 0),c=Object(Z.a)(o,2),u=(c[0],c[1]);Object(a.useEffect)(function(){i(e.track.chokes.choke),u(e.track.chokes.transposeMatch)},[e.track]);var l=Object(a.useCallback)(function(t){null===t&&(t=void 0),e.track.chokes.choke=t,i(t)},[e.track]);return r.a.createElement("div",{className:"chokes-and-matches"},r.a.createElement("div",{className:"choke"},r.a.createElement("div",{className:"choke-label"},"Choke:"),r.a.createElement(Bd,{track:s,trackToSkip:e.track,sequencerEngine:e.sequencerEngine,onSelectTrack:l})),r.a.createElement("div",{className:"transpose-match"}))}var Pv=new U.a,Tv=function(e){function t(e){var n;Object(o.a)(this,t),n=Object(u.a)(this,Object(l.a)(t).call(this,e));var a=e.sequencerEngine.tracks[e.selectedTrack];if(a){var r=a.trackData;n.state={selectedParameter:r.durationParameter,value:r.durationParameter.value}}else n.state={};return n.state.loading=!1,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onMouseUp",value:function(){this.props.setParametersToRecord([])}},{key:"getTrackData",value:function(e){var t=e.sequencerEngine.tracks[e.selectedTrack];if(void 0!==t)return t.trackData}},{key:"getThumbnail",value:function(){var e=void 0,t={};if(this.track.sample){if(void 0!==(e=this.track.sample.getThumbnail()))return r.a.createElement("img",{className:"mini-thumbnail",src:e});t.backgroundColor=Pv.getColorForHash(this.track.sample.getId())}else t.backgroundColor=Pv.getColorForHash(this.track.getName());return r.a.createElement("div",{className:"mini-thumbnail",style:t})}},{key:"shouldComponentUpdate",value:function(e){if(this.getTrackData(e)!==this.getTrackData(this.props)){var t=this.state.selectedParameter,n=this.getTrackData(e);if(void 0===t&&void 0!==n&&(t=n.durationParameter),void 0===n)return!0;"Duration"===t.name?this.state.selectedParameter=n.durationParameter:"Attack"===t.name?this.state.selectedParameter=n.attackParameter:"Release"===t.name?this.state.selectedParameter=n.releaseParameter:"Transpose"===t.name?this.state.selectedParameter=n.transposeParameter:"Velocity"===t.name?this.state.selectedParameter=n.velocityParameter:this.state.selectedParameter=n.durationParameter,this.state.value=this.state.selectedParameter.value}return!0}},{key:"chooseParameter",value:function(e){this.setState({selectedParameter:e,value:e.value})}},{key:"onUpdateParameter",value:function(e){this.state.selectedParameter.value=e,this.setState({value:e}),this.props.setParametersToRecord([this.state.selectedParameter])}},{key:"nextSample",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.next=3,this.track.auditionNext(!0);case 3:this.setState({loading:!1});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"previousSample",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.next=3,this.track.auditionPrevious();case 3:this.setState({loading:!1});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props,n=t.sequencerEngine.tracks[t.selectedTrack],a=this.state.selectedParameter;if(void 0===t.selectedTrack||void 0===n||void 0===a)return r.a.createElement("div",null);var s=n.trackData,i=function(e,t){return e===t.durationParameter?.01:e.min}(a,s),o=function(e,t){if(e===t.durationParameter)return 2;if(e===t.attackParameter)return 100;if(e===t.releaseParameter)return 400;return e.max}(a,s);return r.a.createElement("div",{onMouseLeave:function(){return e.onMouseUp()},onMouseUp:function(){return e.onMouseUp()},className:"track-quick-view"},r.a.createElement("div",{className:"name-component"},this.getThumbnail(),r.a.createElement("div",{className:"name-label"},this.track.getName()),r.a.createElement(V.a,{sizeUnit:"px",size:10,color:"#123abc",loading:this.state.loading}),r.a.createElement(O,{condition:"SAMPLER"===this.track.getTrackType()},r.a.createElement("div",{className:"sample-arrows"},r.a.createElement("i",{onClick:function(){return e.previousSample()},className:"left"}),r.a.createElement("i",{onClick:function(){return e.nextSample()},className:"right"})))),r.a.createElement("div",{className:"parameter-options"},r.a.createElement(xv,{onClick:function(){return e.chooseParameter(s.durationParameter)},selected:a===s.durationParameter,name:"Duration"}),r.a.createElement(xv,{onClick:function(){return e.chooseParameter(s.transposeParameter)},selected:a===s.transposeParameter,name:"Pitch"}),r.a.createElement(xv,{onClick:function(){return e.chooseParameter(s.attackParameter)},selected:a===s.attackParameter,name:"Attack"}),r.a.createElement(xv,{onClick:function(){return e.chooseParameter(s.releaseParameter)},selected:a===s.releaseParameter,name:"Release"}),r.a.createElement(xv,{onClick:function(){return e.chooseParameter(s.velocityParameter)},selected:a===s.velocityParameter,name:"Velocity"}),r.a.createElement(jv,{value:this.state.selectedParameter.value})),r.a.createElement("div",{onMouseLeave:function(){return e.onMouseUp()}},r.a.createElement(fe.a,{value:parseFloat(this.state.selectedParameter.value),change:function(t){return e.onUpdateParameter(t.target.value)},step:.01,max:o,min:i,orientation:"horizontal",reversed:!1})),this.props.installation?"":r.a.createElement(Cv,{sequencerEngine:this.props.sequencerEngine,track:n}))}},{key:"track",get:function(){return this.props.sequencerEngine.tracks[this.props.selectedTrack]}}]),t}(r.a.Component);function jv(e){return r.a.createElement("div",{className:"parameter-value"},e.value)}function xv(e){var t="parameter-option";return e.selected&&(t+=" selected"),r.a.createElement("div",{onClick:e.onClick,className:t},e.name)}var Nv=Object(y.b)(function(e,t){var n=t.sequencerEngine.engineId,a=e.sequencer.currentSubSequence[n];return{currentPattern:e.sequencer.currentPattern[a]||0,currentSubSequence:a}},function(e){return{setParametersToRecord:function(t){return e(Object(w.hc)(t))}}})(Tv),qv="SOUNDS",Mv=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).onClickOption=n.onClickOption.bind(Object(p.a)(n)),n.clear=n.clear.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"clear",value:function(){this.props.setSelectorMode(!1),this.props.setSidebarViewMode(qv)}},{key:"onClickOption",value:function(e){this.clear(),e===qv&&this.props.setSelectorMode(!0),this.props.setSidebarViewMode(e)}},{key:"getSelectedOption",value:function(){return this.props.sidebarViewMode}},{key:"render",value:function(){var e=this,t=this.getSelectedOption();return r.a.createElement("div",{className:"option-tabs"},r.a.createElement(Dv,{onMouseOver:function(){return e.props.setContextualHelp("ADD_SOUNDS_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClear:this.clear,onClick:this.onClickOption,hideUnderline:this.props.hideUnderline,option:qv,selectedOption:t,name:"SOUNDS"}),r.a.createElement(Dv,{onMouseOver:function(){return e.props.setContextualHelp("ADD_INSTRUMENTS_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClear:this.clear,onClick:this.onClickOption,hideUnderline:this.props.hideUnderline,option:"INSTRUMENTS",selectedOption:t,name:"INSTRUMENTS"}),r.a.createElement(Dv,{onMouseOver:function(){return e.props.setContextualHelp("ADD_PRESETS_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClear:this.clear,onClick:this.onClickOption,hideUnderline:this.props.hideUnderline,option:"PRESETS",selectedOption:t,name:"PRESETS"}),r.a.createElement(Dv,{onMouseOver:function(){return e.props.setContextualHelp("ADD_SEQUENCES_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClear:this.clear,onClick:this.onClickOption,hideUnderline:this.props.hideUnderline,option:"SEQUENCES",selectedOption:t,name:"PROJECTS"}))}}]),t}(a.Component),Dv=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isSelected",value:function(){return this.props.selectedOption===this.props.option}},{key:"onClick",value:function(){this.isSelected()?this.props.onClear():this.props.onClick(this.props.option)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{onMouseOver:this.props.onMouseOver,onMouseLeave:this.props.onMouseLeave,onClick:function(){return e.onClick()},className:this.isSelected()?"option-tab selected":"option-tab"},this.props.name,this.isSelected()&&!this.props.hideUnderline?r.a.createElement("div",{className:"option-tab-underline"}):"")}}]),t}(a.Component),Av=Object(y.b)(function(e){return{showSelectorMode:e.sequencer.showSelectorMode,sidebarViewMode:e.sequencer.sidebarViewMode}},function(e){return{setSelectorMode:function(t){return e(Object(w.bd)(t))},setSidebarViewMode:function(t){return e(Object(w.Gd)(t))},setContextualHelp:function(t){return e(Object(w.V)(t))}}})(Mv);var Rv=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={selectedOption:void 0},n.onClickDone=n.onClickDone.bind(Object(p.a)(n)),n.onClickCancel=n.onClickCancel.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickDone",value:function(){this.state.selectedOption&&this.state.selectedOption.value.convolverEffect.setConvolverSample(this.props.convolverSample),this.props.setShowConvolverModal(!1)}},{key:"onClickCancel",value:function(){this.props.setShowConvolverModal(!1)}},{key:"getOptions",value:function(){if(!this.props.show)return[];var e=[];for(var t in this.props.sequencerEngine.tracks){var n=this.props.sequencerEngine.tracks[t],a=n.effects.filter(function(e){return"Convolver Reverb"===e.name}),r=parseInt(t)+1;for(var s in a){var i=parseInt(s)+1;e.push({label:"Track "+r+" Convolver #"+i,value:{track:n,convolverEffect:a[s]}})}}for(var o in this.props.sequencerEngine.sends.sends){var c=this.props.sequencerEngine.sends.sends[o],u=c.effects.filter(function(e){return"Convolver Reverb"===e.name}),l=parseInt(o)+1;for(var p in u){var h=parseInt(p)+1;e.push({label:"Send "+l+" Convolver #"+h,value:{send:c,convolverEffect:u[p]}})}}return e}},{key:"getOption",value:function(e){if(void 0!==e)return this.getOptions().filter(function(t){return t.label===e.label})[0]}},{key:"onSelectOption",value:function(e){this.setState({selectedOption:e})}},{key:"render",value:function(){var e=this;return console.log("ConvolverModal.show = "+this.props.show),r.a.createElement(D.a,{dialogClassName:"preset-modal",show:this.props.show,onHide:this.onClickCancel},r.a.createElement(D.a.Header,{closeButton:!0},r.a.createElement(D.a.Title,null,"Convolver")),r.a.createElement(D.a.Body,null,"Choose which convolver reverb to set this sample to",r.a.createElement(pp.a,{className:"delay-time-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.getOptions(),onChange:function(t){return e.onSelectOption(t)},value:this.getOption(this.state.selectedOption),placeholder:"Choose convolver to apply"})),r.a.createElement(D.a.Footer,null,r.a.createElement(A.b,{variant:"secondary",onClick:this.onClickDone},"Done"),r.a.createElement(A.b,{variant:"primary",onClick:this.onClickCancel},"Cancel")))}}]),t}(a.Component),Iv=Object(y.b)(function(e){return{show:e.sequencer.showConvolverModal,convolverSample:e.sequencer.convolverSample}},function(e){return{setShowConvolverModal:function(t){return e(Object(w.jd)(t,void 0))}}})(Rv),Lv=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onSelectSortBy",value:function(e){this.props.setSearchSortBy(e),this.props.onFiltersChanged()}},{key:"getSamples",value:function(){return this.props.getSamples().filter(function(e){return void 0!==e.sample.getId()})}},{key:"render",value:function(){var e,t=this;return r.a.createElement("div",null,r.a.createElement("div",{className:"search-results-header"},"SEARCH RESULTS"),r.a.createElement("div",{className:"search-options"},r.a.createElement("div",{className:"page-size-chooser-container"},r.a.createElement(pp.a,{className:"page-size-chooser-dropdown",options:Bv,onChange:function(e){return t.props.onSelectPageSize(e.value)},value:(e=this.props.size,Bv.filter(function(t){return t.value===e})[0]),placeholder:"Select page size"})),r.a.createElement("div",{className:"page-size-chooser-container"},r.a.createElement(pp.a,{className:"page-size-chooser-dropdown",options:Fv,onChange:function(e){return t.onSelectSortBy(e.value)},value:Vv(this.props.sortBy),placeholder:"Select a resolution"})),r.a.createElement("div",{className:"filter-favorites-button"},r.a.createElement("div",{onClick:function(){return t.props.onClickFavorites()},className:this.props.filterFavorites?"heart favorited":"heart"}))),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement("div",{className:"pagination-pane"},r.a.createElement(O,{condition:this.props.start>0&&void 0!==this.props.total},r.a.createElement("div",{className:"field-pagination-button",onClick:function(){return t.props.previousResults()}},"Previous")),r.a.createElement(O,{condition:this.props.start<this.props.total-this.props.size},r.a.createElement("div",{className:"field-pagination-button",onClick:function(){return t.props.nextResults()}},"Next")),r.a.createElement(O,{condition:void 0!==this.props.total},r.a.createElement("div",{className:"field-pagination-button"},r.a.createElement("div",{className:"pagination-total"},"of ",this.totalString),r.a.createElement("div",{className:"pagination-start"},this.props.start," - ",this.props.start+this.props.size)))),r.a.createElement("div",{className:"search-results"},this.getSamples().map(function(e,n){return r.a.createElement(Q.Sound,{key:e.sample.getId(),i:n,onSoundIdChange:function(e){return[]},auditioning:void 0!==t.props.sampleAuditioning&&t.props.sampleAuditioning.getId()===e.sample.getId(),decentralized:t.props.decentralized,showLayerOption:void 0===t.props.hideLayer||0==t.props.hideLayer,sequencerEngine:t.props.sequencerEngine,onAudition:function(e){return t.props.onAudition(e)},onAddSample:function(e,n){return t.props.addSound(e,!1,n)},onLayerSample:function(e,n){return t.props.addSound(e,!0,n)},onClickThumbnail:function(e,n,a){return t.props.onClickThumbnail(e)},hideName:!0,onGetName:function(){return 5},audioUnit:e.audioUnit,chordSlices:e.slices,sample:e.sample})})))}},{key:"totalString",get:function(){return void 0===this.props.total?"many":this.props.total}}]),t}(a.Component),Fv=[{label:"Random",value:"RANDOM"},{label:"Most Popular",value:"MOST_POPULAR"},{label:"Most Recent",value:"MOST_RECENT"}];function Vv(e){return Fv.filter(function(t){return t.value===e})[0]}var Bv=[{label:"5",value:5},{label:"10",value:10},{label:"25",value:25}];var Uv=Object(y.b)(function(e){return{decentralized:e.sequencer.decentralized,countriesSelected:e.selector.countriesSelected,videosSelected:e.selector.videosSelected,stylesSelected:e.selector.stylesSelected,tagsSelected:e.selector.tagsSelected,showTags:e.selector.showTags,searchResultsSamples:e.selector.searchResultsSamples,chordSelected:e.selector.chordSelected,showChordFilter:e.selector.showChordFilter,showCountries:e.selector.showCountries,selectedChordSample:e.selector.selectedChordSample,sampleAuditioning:e.audition.sampleAuditioning,sortBy:e.selector.sortBy}},function(e){return{setSearchSortBy:function(t){return e(Object(w.Gc)(t))}}})(Lv),Hv=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return this.props.total<=0||this.props.total<=this.props.pageSize?r.a.createElement("div",null):r.a.createElement("div",{className:"pagination-pane"},r.a.createElement(O,{condition:this.props.start>0},r.a.createElement("div",{onClick:function(){return e.props.onClickPrevious()},className:"field-pagination-button"},"Previous")),r.a.createElement(O,{condition:this.props.start+this.props.pageSize<this.props.total},r.a.createElement("div",{onClick:function(){return e.props.onClickNext()},className:"field-pagination-button"},"Next")))}}]),t}(a.Component),Jv=30,Gv=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={loadedId:void 0,start:0,end:Jv,title:void 0,year:0,styles:[],tags:[],emptyVideos:0},n.counter=0,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"sleep",value:function(e){return new Promise(function(){var t=Object(g.a)(v.a.mark(function t(n,a){return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:setTimeout(function(){n()},e);case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"componentDidMount",value:function(){}},{key:"shouldComponentUpdate",value:function(e){return this.state.start>Object.keys(e.videosSelected).length&&(this.state.start=0),!0}},{key:"getDiscogs",value:function(e){var t=this.props.discogsSelected,n=Object.keys(t).filter(function(e){return"NONE"!==t[e].condition}).map(function(e){return{id:e,type:"DISCOGS"}}),a=Object.keys(t).filter(function(e){return"NONE"===t[e].condition}).map(function(e){return{id:e,type:"DISCOGS"}});return e?n:a}},{key:"getSelectedVideos",value:function(){var e=this.props.videosSelected,t=Object.keys(e).filter(function(t){return"NONE"!==e[t].condition}).map(function(e){return{id:e,type:"YOUTUBE"}});return[].concat(Object(ge.a)(this.getDiscogs(!0)),Object(ge.a)(t))}},{key:"getVideos",value:function(){var e=this.props.videosSelected,t=Object.keys(e).filter(function(t){return"NONE"!==e[t].condition}).map(function(e){return{id:e,type:"YOUTUBE"}});t=[].concat(Object(ge.a)(this.getDiscogs(!0)),Object(ge.a)(t));var n=Object.keys(e).filter(function(t){return"NONE"===e[t].condition}).map(function(e){return{id:e,type:"YOUTUBE"}});return n=[].concat(Object(ge.a)(this.getDiscogs(!1)),Object(ge.a)(n)),[].concat(Object(ge.a)(this.getDiscogs()),Object(ge.a)(t),Object(ge.a)(n)).length>this.state.end?n.slice(this.state.start,this.state.end-t.length):n.slice(this.state.start-t.length)}},{key:"onClickNext",value:function(){if(!(this.state.end>this.total)){var e=this.state.end+1,t=this.state.start,n=0;e-t>50&&(n=Math.max(0,e-50),t=e-50),this.setState({end:e,start:t,emptyVideos:n})}}},{key:"onClickPrevious",value:function(){var e=this.state.start,t=this.state.end;e-=1,t-=1;var n=Math.max(0,t-50);e<0?this.setState({start:Math.max(0,this.state.start-1)}):this.setState({start:e,end:t,emptyVideos:n})}},{key:"onClickVideo",value:function(e){var t="DISCOGS"===e.type?this.props.discogsSelected:this.props.videosSelected;"NONE"===t[e.id].condition?t[e.id].condition="OR":t[e.id].condition="NONE","DISCOGS"===e.type?this.props.setDiscogsSelected(t):this.props.setVideosSelected(t),this.props.onFiltersChanged()}},{key:"isSelected",value:function(e){return"YOUTUBE"===e.type?"NONE"!==this.props.videosSelected[e.id].condition:"NONE"!==this.props.discogsSelected[e.id].condition}},{key:"showInfoForVideo",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r,s,i;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t.id)!==this.state.loadedId){e.next=3;break}return e.abrupt("return");case 3:if(this.state.loadedId=n,"DISCOGS"!==t.type){e.next=21;break}return e.next=7,R.a.getCoverArtForDiscogs(n);case 7:return a=(a=e.sent).coverArtHash,this.state.thumbnail=B.a.getHashUrl(a),e.next=12,R.a.getSoundsWithDiscogs(n);case 12:return r=e.sent,this.state.numberOfSamples=r.length,e.t0=_v,e.next=17,R.a.getTitleForSound(r[0]);case 17:return e.t1=e.sent,this.state.title=(0,e.t0)(e.t1),this.setState(this.state),e.abrupt("return");case 21:return s=this.props.searcher.getVideoInfo(n),this.state.year=s.year,this.state.styles=Array.from(new Set(s.styles)),this.state.tags=Array.from(new Set(s.tags)),e.next=27,R.a.getSoundsWithVideo(n);case 27:return i=e.sent,this.state.numberOfSamples=i.length,e.t2=_v,e.next=32,R.a.getTitleForSound(i[0]);case 32:e.t3=e.sent,this.state.title=(0,e.t2)(e.t3),this.setState(this.state);case 35:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"hideInfoForVideo",value:function(){this.setState({title:void 0,loadedId:void 0,year:void 0,tags:[],style:[]})}},{key:"onScroll",value:function(e){(e=e.target).scrollWidth-e.offsetWidth<e.scrollLeft&&this.onClickNext(),e.scrollLeft<8*this.state.emptyVideos&&this.setState({start:0,end:Jv,emptyVideos:0})}},{key:"render",value:function(){var e=this;if(!this.props.showVideos)return r.a.createElement("div",null);var t=Object.keys(this.props.videosSelected).length,n=Array(this.state.emptyVideos).fill(0);return r.a.createElement("div",{className:"videos-filter"},r.a.createElement("div",{onScroll:function(t){return e.onScroll(t)},onMouseLeave:function(){return e.hideInfoForVideo()},className:"videos-container"},this.getSelectedVideos().map(function(n,a){return r.a.createElement(zv,{id:n.id,onMouseOver:function(){return e.showInfoForVideo(n)},isOdd:a%2==1,searcher:e.props.searcher,rank:e.props.videosSelected[n.id]?e.props.videosSelected[n.id].rank:1,numberVideos:t,selected:!0,onClick:function(){return e.onClickVideo(n)},option:n})})),r.a.createElement("div",{onScroll:function(t){return e.onScroll(t)},onMouseLeave:function(){return e.hideInfoForVideo()},className:"videos-container"},n.map(function(e){return r.a.createElement("div",{className:"empty-video"},"x ")}),this.getVideos().map(function(n,a){return r.a.createElement(zv,{id:n.id,onMouseOver:function(){return e.showInfoForVideo(n)},isOdd:a%2==1,searcher:e.props.searcher,rank:e.props.videosSelected[n.id]?e.props.videosSelected[n.id].rank:1,numberVideos:t,selected:e.isSelected(n),onClick:function(){return e.onClickVideo(n)},option:n})})),r.a.createElement(O,{condition:this.state.title},r.a.createElement("div",{className:"selected-video-info"},r.a.createElement("div",{className:"title-and-year"},r.a.createElement("div",{className:"video-title"},this.state.title),r.a.createElement(O,{condition:this.state.year},r.a.createElement("div",{className:"video-year"},this.state.year))),r.a.createElement("div",{className:"video-styles"},this.state.styles.map(function(e){return r.a.createElement(A.a,{color:"dark"},e)}),this.state.tags.map(function(e){return r.a.createElement(A.a,{color:"light"},e)})))))}},{key:"total",get:function(){return Object.keys(this.props.videosSelected).length}}]),t}(a.Component),zv=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n.getInfo(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){return e.option.id!==this.props.option.id&&this.getInfo(e.option),!0}},{key:"getInfo",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:this.props.option,n=t.id,"DISCOGS"!==t.type){e.next=10;break}return e.next=5,R.a.getCoverArtForDiscogs(n);case 5:return a=(a=e.sent).coverArtHash,this.state.thumbnail=B.a.getHashUrl(a),this.setState(this.state),e.abrupt("return");case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUrl",value:function(){return"DISCOGS"===this.props.option.type?this.state.thumbnail:"https://img.youtube.com/vi/"+this.props.option.id+"/1.jpg"}},{key:"getStyleForRank",value:function(e,t){return{opacity:Math.pow(.9,.5*e/t)}}},{key:"render",value:function(){var e=this.props.isOdd?"video-option-container odd":"video-option-container";return this.props.selected&&(e+=" selected"),r.a.createElement("div",{onMouseOver:this.props.onMouseOver,onMouseMove:this.props.onMouseOver,onMouseLeave:this.props.onMouseLeave,className:e},r.a.createElement("img",{style:this.getStyleForRank(this.props.rank,this.props.numberVideos),className:this.props.selected?"selected-video video-option":"video-option",onClick:this.props.onClick,src:this.getUrl()}))}}]),t}(a.Component);function _v(e){return(e=e.trim()).length<50?e:e.slice(0,50)+" ..."}var Wv=Object(y.b)(function(e){return{videosSelected:e.selector.videosSelected,discogsSelected:e.selector.discogsSelected,showVideos:e.selector.showVideos}},function(e){return{setVideosSelected:function(t){return e(Object(w.xe)(t))},setDiscogsSelected:function(t){return e(Object(w.ib)(t))}}})(Gv),Kv=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={start:0},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickNext",value:function(){this.setState({start:this.state.start+500})}},{key:"onClickPrevious",value:function(){this.setState({start:this.state.start-500})}},{key:"onClickTag",value:function(e){var t=Object(X.a)({},this.props.tagsSelected),n=this.props.store.getState().keyboard.isCommandDown;if("AND"===t[e].condition)t[e].condition="NONE";else if("OR"==t[e].condition)if(n)t[e].condition="NONE";else for(var a in t[e].condition="AND",t)t[a]&&"OR"==t[a].condition&&(t[a].condition="NONE");else t[e].condition=n?"OR":"AND";this.props.setTagsSelected(t),this.props.onFiltersChanged(),this.setState({start:0})}},{key:"hide",value:function(){this.setState({start:0}),this.props.onFiltersChanged(),this.props.hide()}},{key:"getTags",value:function(){var e=Object.keys(this.props.tagsSelected);return this.state.start+500<this.getTotal()?e.slice(this.state.start,this.state.start+500):this.state.start+500>=this.getTotal()?e.slice(this.state.start):e}},{key:"getTotal",value:function(){return Object.keys(this.props.tagsSelected).length}},{key:"getContextualHelpForCondition",value:function(e){return"NONE"===e?"SELECTOR_TAG_BUTTON":"OR"===e?"OR_TAG_BUTTON":"AND"===e?"AND_TAG_BUTTON":void 0}},{key:"render",value:function(){var e=this,t=this.getTags();return r.a.createElement("div",null,this.props.showTags?r.a.createElement("div",{className:"tags-pane"},r.a.createElement("div",{className:"tags-container"},t.map(function(t){return r.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp(e.getContextualHelpForCondition(e.props.tagsSelected[t].condition))},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},style:e.getStyleForRank(e.props.tagsSelected[t].rank,e.getTotal()),onClick:function(){return e.onClickTag(t)},className:"AND"==e.props.tagsSelected[t].condition?"tag selected and":"OR"==e.props.tagsSelected[t].condition?"tag selected or":"tag"}," ",t," ")})),r.a.createElement(Hv,{start:this.state.start,total:this.getTotal(),pageSize:500,onClickNext:function(){return e.onClickNext()},onClickPrevious:function(){return e.onClickPrevious()}})):"")}},{key:"getStyleForRank",value:function(e,t){return e<=.3?{opacity:.3}:{opacity:e}}}]),t}(a.Component),Yv=Object(y.b)(function(e){return{tagsSelected:e.selector.tagsSelected,showTags:e.selector.showTags}},function(e){return{setTagsSelected:function(t){return e(Object(w.Yd)(t))},setContextualHelp:function(t){return e(Object(w.V)(t))}}})(Kv),Qv=(n(2331),new ci),Xv=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={stack:[],tagStack:[],head:{}},n.loadHierarchy(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){return e.guildId!==this.props.guildId&&this.loadHierarchy(e.guildId),!0}},{key:"loadHierarchy",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r,s,i,o,c=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:this.props.guildId,e.next=3,Qv.getClassifications(t);case 3:for(r in n=e.sent,a={},n)for(s in a[r]=this.getParentOfTag(r,n),n[r])i=n[r][s],a[i]=r;this.tagToParent=a,o=this.traverse(null,a),this.setState({hierarchy:o}),this.setState({head:o});case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"traverse",value:function(e,t){var n={},a=Object.keys(t).sort();for(var r in a){var s=a[r];t[s]==e&&(n[s]=this.traverse(s,t))}return n}},{key:"getParentOfTag",value:function(e,t){for(var n in t){if(t[n].indexOf(e)>-1)return n}return null}},{key:"onClickTag",value:function(e){this.setState({stack:this.state.stack.concat([this.state.head]),tagStack:this.state.tagStack.concat([this.props.hierarchyRoot]),head:this.state.head[e]});var t=this.getFlattenedSubtree(e);this.props.setHierarchyTree(t),this.props.setHierarchyRoot(e),t.length<20&&this.onChoseTags(t)}},{key:"onChoseTags",value:function(e){var t={};e.forEach(function(n){return t[n]=1==e.length?{condition:"AND",rank:1}:{condition:"OR",rank:1}}),1==e.length?this.props.setShowTags(!0):this.props.setShowTags(!1),this.props.setTagsSelected(t),this.props.onFiltersChanged()}},{key:"getFlattenedSubtree",value:function(e){if(void 0===e)return[];var t=this.search(e,this.state.hierarchy);return[e].concat(this.flattenTree(t))}},{key:"flattenTree",value:function(e){var t=[];for(var n in e)t.push(n),t=t.concat(this.flattenTree(e[n]));return t}},{key:"search",value:function(e,t){var n=Object.values(t);if(e in t)return t[e];for(var a in n){var r=n[a],s=this.search(e,r);if(void 0!==s)return s}}},{key:"onClickUp",value:function(){if(this.unselectAllTags(),this.showTags(!1),this.state.stack.length>0){var e=this.state.stack.pop(),t=this.state.tagStack.pop();this.onClickTag(t),0===this.state.stack.length&&this.props.getTags(),this.state.head=e,this.setState(this.state)}}},{key:"unselectAllTags",value:function(){var e=Object(X.a)({},this.props.tagsSelected);for(var t in e)e[t].condition="NONE";this.props.setTagsSelected(e)}},{key:"showTags",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.props.setShowTags(e)}},{key:"render",value:function(){var e=this;return this.props.showYears||this.props.showStyles||this.props.showCountries||this.props.showVideos?r.a.createElement("div",null,r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(Yv,{hide:function(){return e.showFilters(!1)},store:this.props.store,onClickNext:function(){return e.props.onClickNextTags()},onClickPrevious:function(){return e.props.onClickPreviousTags()},onFiltersChanged:function(){return e.props.onFiltersChanged()}})):r.a.createElement("div",null,r.a.createElement("div",{className:"tags-hierarchy"},this.state.stack.length>0?r.a.createElement("div",{onClick:function(){return e.onClickUp()},className:"parent-tag"},this.props.hierarchyRoot):"",Object.keys(this.state.head).map(function(t){return r.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("SELECTOR_CATEGORY_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"tag",onClick:function(){return e.onClickTag(t)}},t.replace(e.props.hierarchyRoot,"").trim())})),r.a.createElement(Yv,{hide:function(){return e.showFilters(!1)},store:this.props.store,onClickNext:function(){return e.props.onClickNextTags()},onClickPrevious:function(){return e.props.onClickPreviousTags()},onFiltersChanged:function(){return e.props.onFiltersChanged()}}))}}]),t}(a.Component),Zv=Object(y.b)(function(e){return{hierarchyTree:e.selector.hierarchyTreeTags,hierarchyRoot:e.selector.hierarchyRoot,showTags:e.selector.showTags,showVideos:e.selector.showVideos,showStyles:e.selector.showStyles,showCountries:e.selector.showCountries,showYears:e.selector.showYears,tagsSelected:e.selector.tagsSelected,guildId:e.guilds.selectedGuild?e.guilds.selectedGuild.guildId:0}},function(e){return{setHierarchyTree:function(t){return e(Object(w.Eb)(t))},setHierarchyRoot:function(t){return e(Object(w.Db)(t))},setShowTags:function(t){return e(Object(w.Bd)(t))},setTagsSelected:function(t){return e(Object(w.Yd)(t))},setContextualHelp:function(t){return e(Object(w.V)(t))}}})(Xv),$v=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickCountry",value:function(e){var t=Object(X.a)({},this.props.countriesSelected);t[e].condition=!t[e].condition,this.props.setCountriesSelected(t),this.props.onFiltersChanged()}},{key:"hide",value:function(){this.props.setCountriesSelected({}),this.props.onFiltersChanged(),this.props.hide()}},{key:"render",value:function(){var e=this,t=Object.keys(this.props.countriesSelected);return r.a.createElement("div",null,this.props.showCountries?r.a.createElement("div",{className:"countries-pane"},r.a.createElement("div",{className:"filter-header"},"COUNTRIES"),r.a.createElement("div",{className:"tags-container"},t.map(function(n){return r.a.createElement("div",{style:e.getStyle(n.rank,t.length),onClick:function(){return e.onClickCountry(n)},className:e.props.countriesSelected[n].condition?"tag selected and":"tag"}," ",n," ")}))):"")}},{key:"getStyle",value:function(e,t){return{opacity:e}}}]),t}(a.Component),eg=Object(y.b)(function(e){return{countriesSelected:e.selector.countriesSelected,showCountries:e.selector.showCountries}},function(e){return{setCountriesSelected:function(t){return e(Object(w.W)(t))}}})($v),tg=n(40),ng=function(){function e(t){Object(o.a)(this,e),this.sequencerEngine=t,this.store=t.store,this.loadedSamples={},this.canceled=!1,this.sampleToSlices={},this.sampleToAudioUnit={},this.currentAudioUnit=void 0,this.cursor=0}return Object(c.a)(e,[{key:"setSelectedChord",value:function(e){var t=this.getChordAtIndex(e);this.store.dispatch(Object(w.Ic)(t)),void 0!==t&&(window.location.hash="sample-"+t.sampleHash)}},{key:"nextCursor",value:function(){return void 0===this.cursor?(this.cursor=0,this.setSelectedChord(0),!1):(this.cursor++,this.cursor>=this.length()?(this.cursor=this.length()-1,!0):(this.setSelectedChord(this.cursor),!1))}},{key:"previousCursor",value:function(){return this.cursor--,this.cursor<0?(this.cursor=0,!0):(this.setSelectedChord(this.cursor),!1)}},{key:"playCurrent",value:function(){this.setSelectedChord(this.cursor),this.playIndex(this.cursor)}},{key:"playNext",value:function(){this.playIndex(this.cursor+1)}},{key:"playPrevious",value:function(){this.playIndex(this.cursor-1)}},{key:"playIndex",value:function(e){var t=this.getChordAtIndex(e);if(void 0!==t){var n=this.sampleToAudioUnit[t.sampleHash];n.playSound(t.startTime),this.currentAudioUnit=n}}},{key:"getChordAtIndex",value:function(e){var t=0;for(var n in this.sampleToSlices){var a=this.sampleToSlices[n];for(var r in a){var s=a[r];if(t===e)return{sampleHash:n,startTime:s.startTime,endTime:s.endTime};t++}}}},{key:"stopCurrent",value:function(){void 0!==this.currentAudioUnit&&this.currentAudioUnit.stopSound()}},{key:"length",value:function(){var e=0;for(var t in this.sampleToSlices)e+=this.sampleToSlices[t].length;return e}},{key:"getSample",value:function(e){return this.loadedSamples[e]}},{key:"getSlices",value:function(e){return this.sampleToSlices[e]}},{key:"getAudioUnit",value:function(e){return this.sampleToAudioUnit[e]}},{key:"loadIds",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r,s=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=s.length>1&&void 0!==s[1]?s[1]:5,a=0;case 2:if(!(a<t.length)){e.next=10;break}return r=[],r=a+n>=t.length?t.slice(a):t.slice(a,a+n),e.next=7,this.loadIdsPart(r);case 7:a+=n,e.next=2;break;case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadIdsPart",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.store.dispatch(Object(w.Ec)([])),0,e.t0=v.a.keys(t);case 3:if((e.t1=e.t0()).done){e.next=19;break}if(n=e.t1.value,!this.canceled){e.next=7;break}return e.abrupt("break",19);case 7:return a=t[n],e.prev=8,e.next=11,this.loadId(a);case 11:return e.next=13,this.sleep(this.getSleepTime());case 13:e.next=17;break;case 15:e.prev=15,e.t2=e.catch(8);case 17:e.next=3;break;case 19:case"end":return e.stop()}},e,this,[[8,15]])}));return function(t){return e.apply(this,arguments)}}()},{key:"loadId",value:function(e){var t=this;return new Promise(function(){var n=Object(g.a)(v.a.mark(function n(a,r){var s,i,o;return v.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return s=new K.a(e),i=[s.fetchMetadata(),s.fetchGuild(),s.fetchTags()],o=!1,s.fetchAudio().then(function(){var e=Object(g.a)(v.a.mark(function e(n){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==n){e.next=2;break}return e.abrupt("return");case 2:t.loadAudioUnits(s),o=!0,a();case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){r()}),setTimeout(function(){o||a()},t.getTimeout()),n.next=7,Promise.all(i);case 7:s.fetchNoteSequence().then(function(){return t.loadChordSlices(s)}),t.addLoadedSample(s);case 9:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getTimeout",value:function(){return 0!==this.guildId||this.sequencerEngine.hasAtleastOneSequencerEnginePlaying()?250:50}},{key:"getSleepTime",value:function(){return 0!==this.guildId||this.sequencerEngine.hasAtleastOneSequencerEnginePlaying()?250:50}},{key:"sleep",value:function(e){return new Promise(function(t,n){setTimeout(function(){t()},e)})}},{key:"cancel",value:function(){B.a.cancel(),this.canceled=!0}},{key:"addLoadedSample",value:function(e){this.canceled||(this.loadedSamples[e.ipfsHash]=e,this.updateRedux())}},{key:"dispose",value:function(){for(var e in this.sampleToAudioUnit)this.sampleToAudioUnit[e].dispose();for(var t in this.loadedSamples)this.loadedSamples[t].dispose();this.sampleToSlices={},this.loadedSamples={},this.sampleToAudioUnit={}}},{key:"loadAudioUnits",value:function(e){if(!this.canceled){var t=new _(q.a.context);t.setBuffer(e.audioBuffer),this.sampleToAudioUnit[e.ipfsHash]=t,this.updateRedux()}}},{key:"updateRedux",value:function(){var e=this;if(!this.canceled){var t=Object.keys(this.loadedSamples).map(function(t){return e.getSample(t)}).map(function(t){return{sample:t,audioUnit:e.getAudioUnit(t.ipfsHash),slices:e.getSlices(t.ipfsHash)}});this.store.dispatch(Object(w.Ec)(t))}}},{key:"loadChordSlices",value:function(e){var t=this.store.getState().selector.chordSelected;if(void 0!==t){var n=e.noteSequence;if(void 0!==n){var a=(new W.a).getChordsFromSequence(n,t);this.sampleToSlices[e.ipfsHash]=a}}}},{key:"guildId",get:function(){var e=this.sequencerEngine.store.getState().guilds.selectedGuild;return e?e.guildId:0}},{key:"state",get:function(){return this.store.getState()}}]),e}();function ag(e){var t=Object(a.useState)(void 0),n=Object(Z.a)(t,2),s=n[0],i=n[1];Object(a.useEffect)(function(){if(void 0!==e.selectedVertex&&void 0!==e.selectedVertex.vertex)if(e.selectedVertex.vertex.toData){var t=new K.a(e.selectedVertex.vertex.toData);B.a.cancel(),t.load().then(function(e){var n=new _(q.a.context);n.setBuffer(t.audioBuffer),t.audioUnit=n,i(t)}).catch(function(e){})}else{var n=e.selectedVertex.vertex.fromData;"TAG"===e.selectedVertex.vertex.linkType?i(e.selectedVertex.vertex.fromData):R.a.getSequence(n).then(function(e){i(e)})}},[e.selectedVertex,i]);var o=Object(a.useCallback)(function(){s&&e.sequencerEngine.loadSequence(s.newSequence)},[s]);if(s){if(e.selectedVertex.vertex.toData&&s.ipfsHash)return r.a.createElement(Q.Sound,{onAddSample:function(t){return e.sequencerEngine.addSound(t)},onAudition:e.onAudition,hideLink:!0,key:"vertex-details-"+s.getId(),audioUnit:s.audioUnit,sample:s,sequencerEngine:e.sequencerEngine});if("SEQUENCE_USED_SOUND"===e.selectedVertex.vertex.linkType&&void 0!==s.title)return r.a.createElement("div",null,"Sequence: ",r.a.createElement("span",{className:"add-sequence-name",onClick:o},s.title));if("string"===typeof s)return r.a.createElement("div",null,"Tag: ",s)}return r.a.createElement("div",null)}function rg(e,t,n){return e=e.vertex,t<0?t=e.adjacent.length+t:t>=e.adjacent.length&&(t%=e.adjacent.length),function(e,t){return t.find(function(t){return t.vertex.fromData===e||t.vertex.toData===e})}(e.adjacent[t],n)}var sg=new U.a;function ig(e){var t=Object(a.useState)(!1),n=Object(Z.a)(t,2),s=n[0],i=(n[1],e.sequencerEngine,e.vertex.vertex),o=e.vertex.pt,c=(e.vertex.depth,i.parent,sg.getColorForHash(i.fromData||i.toData)),u=i.fromData?1:6;return(e.selected||s)&&(u*=2),e.selected||s||(c=sg.brighten(c,.8)),r.a.createElement(b.Circle,{onClick:e.onClick,x:o.x,y:o.y,stroke:c,opacity:s||e.selected?1:.5,strokeWidth:1,radius:u,fill:c})}var og=new U.a;function cg(e){e.sequencerEngine;var t=e.vertex.vertex,n=e.vertex.pt,a=t.parent,s=(og.getColorForHash(t.fromData||t.toData),og.brighten(og.getColorForHash(t.linkType),.5));if(e.selected&&(s="red"),a)return r.a.createElement(b.Line,{points:[n.x,n.y,a.pt.x,a.pt.y],stroke:s,strokeWidth:1,fill:s})}var ug=n(104);function lg(e,t,n,a,r,s){var i=e[0],o=function(e){var t={};for(var n in e){var a=e[n],r=a.fromData||a.toData;r in t?(t[r].adjacent=Array.from(new Set([].concat(Object(ge.a)(t[r].adjacent),Object(ge.a)(a.adjacent)))),a.adjacent=t[r].adjacent):t[r]=a}return t}(e);return function e(t,n,a,r,s,i,o,c,u){var l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};var p=arguments.length>10&&void 0!==arguments[10]?arguments[10]:new Set;var h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:r/10;var d=arguments.length>12&&void 0!==arguments[12]?arguments[12]:8;var f=arguments.length>13?arguments[13]:void 0;var m=arguments.length>14?arguments[14]:void 0;var v=arguments.length>15?arguments[15]:void 0;if(d<=0||p.size>=f||Object.keys(l).length>m)return[];if(t.fromData){if(p.has(t))return[];p.add(t)}var g=function(e,t,n,a,r,s,i,o,c){var u=function(e,t,n,a){return{x:(e+n)/2,y:(t+a)/2}}(n,a,r,s);u.x<0||u.y<0?u={x:Math.abs(u.x),y:Math.abs(u.y)}:(u.x>i||u.y>o)&&(u={x:u.x%i,y:u.y%o});if(isNaN(u.x)||isNaN(u.y))return;return{vertex:Object(X.a)({},e,{parent:t}),pt:u,depth:c}}(t,u,s,i,o,c,a,r,d);if(void 0===g)return[];var b=[g];var y=g.pt;var k=t.fromData||t.toData;l[k]&&(b=[]);l[k]=g.pt;var E=Math.min(f,t.adjacent.length);h=Math.floor(15*Math.sqrt(E));var S=2*h/E;for(var O in t.adjacent){var w=t.adjacent[O];if(void 0!==(w=pg(w,n,v))){var C=y.x-h+S*O,P=hg(C,y.x,y.y,h,O%2===0?1:-1),T=.5*h;b=[].concat(Object(ge.a)(b),Object(ge.a)(e(w,n,a,r,C-T/2,P-T/2,C+T/2,P+T/2,g,l,p,T,d-1,f*Math.cbrt(d),m,v)))}}return b}(i,e,t,n,0,0,t,n,void 0,{},new Set,void 0,a,r,s,o)}function pg(e,t,n){return n[e]}function hg(e,t,n,a){return(arguments.length>4&&void 0!==arguments[4]?arguments[4]:1)*Math.sqrt(a*a-Math.pow(e-t,2))+n}n(2332),new U.a;var dg=8,fg=Object(a.memo)(function(e){var t=e.store,n=e.show,s=e.sequencerEngine,i=e.sampleToExplore,o=e.onAudition,c=Object(a.useState)(void 0),u=Object(Z.a)(c,2),l=u[0],p=u[1],h=Object(a.useState)([]),d=Object(Z.a)(h,2),f=d[0],m=d[1],y=Object(a.useState)(void 0),k=Object(Z.a)(y,2),E=k[0],S=k[1],O=Object(a.useState)(void 0),w=Object(Z.a)(O,2),C=w[0],P=w[1],T=Object(a.useState)([]),j=Object(Z.a)(T,2),x=j[0],N=j[1],q=Object(a.useState)(3),M=Object(Z.a)(q,2),D=M[0],A=M[1],I=Object(a.useCallback)(function(){var e=Object(g.a)(v.a.mark(function e(n){var a,r;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=t.getState().selector.sampleDragging)){e.next=6;break}return e.next=4,R.a.xanadu.loadGraph2(ug.a,void 0,a.getId(),tg.k.GUILD_SAMPLES.options.address);case 4:r=e.sent,p(r);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[p]);Object(a.useEffect)(function(){i&&R.a.xanadu.loadGraph2(ug.a,void 0,i.getId()).then(function(){var e=Object(g.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=[],e.t1=Object(ge.a)(t),e.t2=ge.a,e.next=5,R.a.xanadu.loadGraph2("TAG",void 0,i.getId(),tg.k.GUILD_SAMPLES.options.address);case 5:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),t=e.t0.concat.call(e.t0,e.t1,e.t4),Xs(n=t.slice(1)),p([t[0]].concat(Object(ge.a)(n)));case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())},[i,p]),Object(a.useEffect)(function(){if(void 0!==l){(new Date).getTime();var e=lg(l,500,300,D,D%2==0?200:30,1200);(new Date).getTime();m(e)}},[l,m,D,S]),Object(a.useEffect)(function(){f[0]&&S(f[0])},[f,S]),Object(a.useEffect)(function(){return window.addEventListener("keydown",L),function(){return window.removeEventListener("keydown",L)}},[E,f,C,P,S]);var L=Object(a.useCallback)(function(e){e.stopPropagation(),function(e,t,n,a,r,s,i,o){if(void 0!==t){var c=n||t.parent;void 0===c&&(c=rg(t,0,s));var u=t.vertex.fromData||t.vertex.toData;if("ArrowRight"===e.key){if(c){for(var l=c.vertex.adjacent.indexOf(u),p=rg(c,l+1,s),h=0;void 0===p;)if(p=rg(c,l+ ++h+1,s),h>40)return;a(p)}}else if("ArrowUp"===e.key){for(var d=rg(t,0,s),f=1;(void 0===d||d.vertex===n)&&(d=rg(t,f,s),!(++f>40)););void 0!==d&&(r(t),a(d),o([].concat(Object(ge.a)(i),[t])))}else if("ArrowDown"===e.key)n&&(r(t),a(c));else if("ArrowLeft"===e.key&&c){for(var m=c.vertex.adjacent.indexOf(u),v=rg(c,m-1,s),g=0;void 0===v;)if(v=rg(c,m-++g-1,s),g>10)return;a(v)}}}(e,E,C,S,P,f,x,N)},[E,C,S,P,f,x,N]),F=Object(a.useCallback)(function(e){P(void 0),S(e)},[s,S,P]);if(!n)return r.a.createElement("div",null);E&&E.depth;var V=function(e){for(var t=[],n=Math.ceil(e.length/dg),a=0;a<dg;a++)t.push(e.slice(a*n,(a+1)*n));return t}(f);return r.a.createElement("div",{onDrop:I,className:"clear-fix space-explorer"},r.a.createElement("div",null,"Depth: ",D),r.a.createElement(fe.a,{value:parseFloat(D),change:function(e){return A(e.target.value)},step:1,max:10,min:1,orientation:"horizontal",reversed:!1}),r.a.createElement(b.Stage,{height:300,width:500},V.map(function(e){return r.a.createElement(b.FastLayer,null,e.filter(function(e){return e.vertex.parent}).filter(function(e){return!mg(e,E)}).map(function(e,t){return r.a.createElement(cg,{key:vg(e),selected:!1,selectedVertex:E,linkType:ug.a,vertex:e,sequencerEngine:s})}))}),V.map(function(e){return r.a.createElement(b.Layer,null,e.filter(function(e){return e.vertex.fromData}).map(function(e,t){return r.a.createElement(ig,{key:"unselected-"+t+(e.vertex.fromData||e.vertex.toData),selected:e===E,onClick:function(){return F(e)},linkType:ug.a,vertex:e,sequencerEngine:s})}),e.filter(function(e){return e.vertex.toData}).filter(function(e){return e!==E}).map(function(e,t){return r.a.createElement(ig,{selected:!1,key:"unselected-"+t+(e.vertex.fromData||e.vertex.toData),onClick:function(){return F(e)},linkType:ug.a,vertex:e,sequencerEngine:s})}))}),r.a.createElement(b.Layer,null,f.filter(function(e){return mg(e,E)}).filter(function(e){return e.vertex.parent}).map(function(e,t){return r.a.createElement(cg,{key:vg(e),selected:!0,selectedVertex:E,linkType:ug.a,vertex:e,sequencerEngine:s})}),f.filter(function(e){return e===E}).map(function(e,t){return r.a.createElement(ig,{selected:!0,key:"selected-"+t+(e.vertex.fromData||e.vertex.toData),onClick:function(){return F(e)},linkType:ug.a,vertex:e,sequencerEngine:s})}))),r.a.createElement(ag,{onAudition:o,selectedVertex:E,sequencerEngine:s}))});function mg(e,t){if(void 0===t)return!1;t=t.vertex;var n=(e=e.vertex).parent;return t===e||n&&t===n.vertex}function vg(e){var t=(e=e.vertex).parent;return t=t.vertex,"edge-"+e.linkType+"-"+(e.fromData||e.toData)+"-"+(t.fromData||t.toData)}var gg=Object(y.b)(function(e){return{sampleToExplore:e.selector.sampleToExplore}},null)(fg),bg=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onChangeYear",value:function(e){this.props.setYearSelected(e),this.props.onFiltersChanged()}},{key:"hide",value:function(){this.props.setYearSelected(void 0),this.props.onFiltersChanged(),this.props.hide()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,this.props.showYearSlider?r.a.createElement("div",{className:"year-pane"},r.a.createElement("div",{className:"year-slider-container"},r.a.createElement("div",{className:"filter-header"},"YEAR: ",this.props.yearSelected),r.a.createElement(fe.a,{value:void 0===this.props.yearSelected?0:this.props.yearSelected,change:function(t){return e.onChangeYear(t.target.value)},step:1,max:2018,min:1950,orientation:"horizontal",reversed:!1}))):"")}}]),t}(a.Component),yg=Object(y.b)(function(e){return{yearSelected:e.selector.yearSelected,showYearSlider:e.selector.showYearSlider}},function(e){return{setYearSelected:function(t){return e(Object(w.Be)(t))}}})(bg),kg=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return this.props.selecting?r.a.createElement(b.Rect,{x:this.props.startX,y:this.props.startY,fill:"orange",height:this.props.endY-this.props.startY,width:this.props.endX-this.props.startX}):r.a.createElement(b.Rect,{x:0,y:0,fill:"orange",height:0,width:0})}}]),t}(a.Component),Eg=new U.a,Sg=(a.Component,function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.points!==e.points||this.props.selectedPoints!==e.selectedPoints}},{key:"convertToPosition",value:function(e){return 500*e}},{key:"getFill",value:function(e){return this.props.selectedPoints.has(e.path)?"orange":Eg.getColorForHash(e.path)}},{key:"render",value:function(){var e=this;return r.a.createElement(b.Layer,null,this.props.points.map(function(t){return r.a.createElement(b.Circle,{key:t.path,x:e.convertToPosition(t.point[0]),opacity:.8,radius:2,fill:e.getFill(t),y:e.convertToPosition(t.point[1])})}))}}]),t}(a.Component)),Og=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).showTags=n.showTags.bind(Object(p.a)(n)),n.showYears=n.showYears.bind(Object(p.a)(n)),n.showCountries=n.showCountries.bind(Object(p.a)(n)),n.showStyles=n.showStyles.bind(Object(p.a)(n)),n.showDateSampled=n.showDateSampled.bind(Object(p.a)(n)),n.showVideos=n.showVideos.bind(Object(p.a)(n)),n.showSamples2D=n.showSamples2D.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getTagsColor",value:function(){return this.props.showTags?"light":"dark"}},{key:"getYearsColor",value:function(){return this.props.showYearSlider?"light":"dark"}},{key:"getStylesColor",value:function(){return this.props.showStyles?"light":"dark"}},{key:"getCountriesColor",value:function(){return this.props.showCountries?"light":"dark"}},{key:"getVideosColor",value:function(){return this.props.showVideos?"light":"dark"}},{key:"getDateSampledColor",value:function(){return this.props.showDateSampled?"light":"dark"}},{key:"getSamples2DColor",value:function(){return this.props.showSamples2D?"light":"dark"}},{key:"showTags",value:function(){this.props.showTags&&(this.props.setTagsSelected({}),this.props.onFiltersChanged()),this.props.setShowTags(!this.props.showTags)}},{key:"showYears",value:function(){this.props.showYearSlider&&(this.props.setYearSelected(void 0),this.props.onFiltersChanged()),this.props.setShowYearSlider(!this.props.showYearSlider)}},{key:"showStyles",value:function(){this.props.showStyles&&(this.props.setStylesSelected({}),this.props.onFiltersChanged()),this.props.setShowStyles(!this.props.showStyles),this.props.getStyles()}},{key:"showCountries",value:function(){this.props.showCountries&&(this.props.setCountriesSelected({}),this.props.onFiltersChanged()),this.props.setShowCountries(!this.props.showCountries),this.props.getCountries()}},{key:"showVideos",value:function(){this.props.showVideos&&(this.props.setVideosSelected({}),this.props.onFiltersChanged()),this.props.setShowVideos(!this.props.showVideos)}},{key:"showSamples2D",value:function(){this.props.showSamples2D&&this.props.onFiltersChanged(),this.props.loadIds([]),this.props.setTagsSelected({}),this.props.onFiltersChanged(),this.props.setShowSamples2D(!this.props.showSamples2D)}},{key:"showDateSampled",value:function(){this.props.setShowDateSampled(!this.props.showDateSampled),this.props.showDateSampled&&(this.props.setDateSampled(void 0),this.props.onFiltersChanged())}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(A.a,{className:"filter-option",onClick:this.showTags,color:this.getTagsColor()},"Tags"),r.a.createElement(A.a,{className:"filter-option",onClick:this.showVideos,color:this.getVideosColor()},"Cover Art"),r.a.createElement(A.a,{className:"filter-option",onClick:this.showYears,color:this.getYearsColor()},"Years"),r.a.createElement(A.a,{className:"filter-option",onClick:this.showStyles,color:this.getStylesColor()},"Styles"),r.a.createElement(A.a,{className:"filter-option",onClick:this.showCountries,color:this.getCountriesColor()},"Countries"),r.a.createElement(A.a,{className:"filter-option",onClick:this.showSamples2D,color:this.getSamples2DColor()},"Space"))}}]),t}(a.Component),wg=Object(y.b)(function(e){return{showTags:e.selector.showTags,showSamples2D:e.selector.showSamples2D,showYearSlider:e.selector.showYearSlider,showStyles:e.selector.showStyles,showCountries:e.selector.showCountries,showVideos:e.selector.showVideos,showChordFilter:e.selector.showChordFilter,showDateSampled:e.selector.showDateSampled}},function(e){var t;return t={setShowTags:function(t){return e(Object(w.Bd)(t))},setShowStyles:function(t){return e(Object(w.Ad)(t))},setShowCountries:function(t){return e(Object(w.kd)(t))},setShowChordFilter:function(t){return e(Object(w.id)(t))},setShowYearSlider:function(t){return e(Object(w.Ed)(t))},setShowVideos:function(t){return e(Object(w.Dd)(t))},setShowSamples2D:function(t){return e(Object(w.vd)(t))},setShowDateSampled:function(t){return e(Object(w.ld)(t))},setCountriesSelected:function(t){return e(Object(w.W)(t))},setStylesSelected:function(t){return e(Object(w.Td)(t))},setYearSelected:function(t){return e(Object(w.Be)(t))},setDateSampled:function(t){return e(Object(w.fb)(t))},setVideosSelected:function(t){return e(Object(w.xe)(t))}},Object(_e.a)(t,"setShowSamples2D",function(t){return e(Object(w.vd)(t))}),Object(_e.a)(t,"setTagsSelected",function(t){return e(Object(w.Yd)(t))}),t})(Og),Cg=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={start:0},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickStyle",value:function(e){var t=Object(X.a)({},this.props.stylesSelected);t[e].condition=!t[e].condition,this.props.setStylesSelected(t),this.props.onFiltersChanged(),this.setState({start:0})}},{key:"hide",value:function(){this.setState({start:0}),this.props.setStylesSelected({}),this.props.onFiltersChanged(),this.props.hide()}},{key:"onClickNext",value:function(){this.setState({start:this.state.start+1e3})}},{key:"getStyles",value:function(){var e=Object.keys(this.props.stylesSelected);return this.state.start+1e3<this.getTotal()?e.slice(this.state.start,this.state.start+1e3):this.state.start+1e3>=this.getTotal()?e.slice(this.state.start):e}},{key:"onClickPrevious",value:function(){this.setState({start:this.state.start-1e3})}},{key:"getTotal",value:function(){return Object.keys(this.props.stylesSelected).length}},{key:"render",value:function(){var e=this,t=this.getStyles();return r.a.createElement("div",null,this.props.showStyles?r.a.createElement("div",{className:"styles-pane"},r.a.createElement("div",{className:"filter-header"},"STYLES"),r.a.createElement("div",{className:"styles-container"},r.a.createElement(Hv,{start:this.state.start,total:this.getTotal(),pageSize:1e3,onClickNext:function(){return e.onClickNext()},onClickPrevious:function(){return e.onClickPrevious()}}),r.a.createElement("div",{className:"tags-container"},t.map(function(n){return r.a.createElement("div",{style:e.getStyleForRank(e.props.stylesSelected[n].rank,t.length),onClick:function(){return e.onClickStyle(n)},className:e.props.stylesSelected[n].condition?"tag selected and":"tag"}," ",n," ")})))):"")}},{key:"getStyleForRank",value:function(e,t){return{opacity:e}}}]),t}(a.Component),Pg=Object(y.b)(function(e){return{stylesSelected:e.selector.stylesSelected,showStyles:e.selector.showStyles}},function(e){return{setStylesSelected:function(t){return e(Object(w.Td)(t))}}})(Cg),Tg=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={noteValue:""},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onNoteChanged",value:function(e){this.setState({noteValue:e})}},{key:"onChangeChord",value:function(e){this.props.setChordSelected(e),this.props.onFiltersChanged()}},{key:"hide",value:function(){this.props.setChordSelected(void 0),this.props.onFiltersChanged(),this.props.hide()}},{key:"onKeyPress",value:function(e){if("Enter"===e.key){var t=this.getNotes();t.push(this.state.noteValue),this.setState({noteValue:""}),this.onChangeChord(t)}}},{key:"getNotes",value:function(){return void 0===this.props.chordSelected?[]:this.props.chordSelected}},{key:"render",value:function(){var e,t=this,n=this.getNotes();return r.a.createElement("div",null,this.props.showChordFilter?r.a.createElement("div",{className:"chord-pane"},r.a.createElement("div",{className:"chord-title"},"CHORD"),r.a.createElement("div",{className:"note-input-container"},r.a.createElement("input",(e={className:"chord-input",onKeyUp:function(e){return t.onKeyPress(e)},onChange:function(e){return t.onNoteChanged(e.target.value)},value:this.state.noteValue,placeholder:"Type note"},Object(_e.a)(e,"className","tags-input"),Object(_e.a)(e,"type","text"),e))),r.a.createElement("div",{className:"notes"},n.map(function(e){return r.a.createElement(A.a,{color:"light"},e)})),r.a.createElement("div",{onClick:function(){return t.hide()},className:"delete-button"},"x")):"")}}]),t}(a.Component),jg=Object(y.b)(function(e){return{chordSelected:e.selector.chordSelected,showChordFilter:e.selector.showChordFilter}},function(e){return{setChordSelected:function(t){return e(Object(w.M)(t))}}})(Tg),xg=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"handleMonthChange",value:function(e){this.props.setDateSampled(new Date(this.year,e.value,1)),this.props.onFiltersChanged()}},{key:"handleYearChange",value:function(e){this.props.setDateSampled(new Date(e.value,this.month,1)),this.props.onFiltersChanged()}},{key:"render",value:function(){var e,t=this;return r.a.createElement(O,{condition:this.props.showDateSampled},r.a.createElement("div",{className:"date-sampled-pane"},r.a.createElement("div",{className:"date-dropdown-container"},r.a.createElement("div",{className:"lfo-rate-label"},"Month:"),r.a.createElement(pp.a,{arrowClassName:"osc-type-arrow-dropdown",options:Mg,onChange:function(e){return t.handleMonthChange(e)},value:(e=this.month,Mg.filter(function(t){return t.value===e})[0]),placeholder:"Month"}),r.a.createElement("div",{className:"lfo-rate-label"},"Year:"),r.a.createElement(pp.a,{arrowClassName:"osc-type-arrow-dropdown",options:Ng,onChange:function(e){return t.handleYearChange(e)},value:qg(this.year),placeholder:"Year"}))))}},{key:"getStyle",value:function(e,t){return{opacity:e}}},{key:"month",get:function(){return(this.props.dateSampled||new Date).getMonth()}},{key:"year",get:function(){return(this.props.dateSampled||new Date).getFullYear()}}]),t}(a.Component),Ng=[{value:2018,label:"2018"},{value:2019,label:"2019"}];function qg(e){return Ng.filter(function(t){return t.value===e})[0]}var Mg=[{value:0,label:"January"},{value:1,label:"February"},{value:2,label:"March"},{value:3,label:"April"},{value:4,label:"May"},{value:5,label:"June"},{value:6,label:"July"},{value:7,label:"August"},{value:8,label:"September"},{value:9,label:"October"},{value:10,label:"November"},{value:11,label:"December"}];var Dg=Object(y.b)(function(e){return{dateSampled:e.selector.dateSampled,showDateSampled:e.selector.showDateSampled}},function(e){return{setDateSampled:function(t){return e(Object(w.fb)(t))}}})(xg),Ag=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={dropdownOpen:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"toggleDropdown",value:function(){this.setState({dropdownOpen:!this.state.dropdownOpen})}},{key:"showYearSlider",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.props.setShowYearSlider(e)}},{key:"showChords",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.props.setShowChordFilter(e)}},{key:"showCountries",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.props.setShowCountries(e),e&&this.props.getCountries()}},{key:"showStyles",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.props.setShowStyles(e),e&&this.props.getStyles()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",{className:"search-box-container"},this.props.children,r.a.createElement(wg,{getStyles:this.props.getStyles,loadIds:this.props.loadIds,onFiltersChanged:function(t){return e.props.onFiltersChanged(t)},getCountries:this.props.getCountries})),r.a.createElement("div",{className:"filter-dropdown-container"},r.a.createElement(A.c,{show:this.state.dropdownOpen,isOpen:this.state.dropdownOpen,toggle:function(){return e.toggleDropdown()}},r.a.createElement(A.f,{size:"sm",caret:!0,color:"primary"},"FILTERS"),r.a.createElement(A.e,null,r.a.createElement(A.d,{onClick:function(){return e.showYearSlider()},size:"sm"},"Year"),r.a.createElement(A.d,{onClick:function(){return e.showCountries()},size:"sm"},"Country"),r.a.createElement(A.d,{onClick:function(){return e.showStyles()},size:"sm"},"Style"),r.a.createElement(A.d,{onClick:function(){return e.showChords()},size:"sm"},"Chord")))),r.a.createElement("div",{className:"filters-container"},r.a.createElement(gg,{store:this.props.store,show:this.props.showSamples2D,onAudition:this.props.onAudition,sequencerEngine:this.props.sequencerEngine,loadIds:this.props.loadIds}),r.a.createElement(Dg,{onFiltersChanged:function(){return e.props.onFiltersChanged()}}),r.a.createElement(yg,{onChangeYear:this.props.onChangeYear,onFiltersChanged:function(){return e.props.onFiltersChanged()},year:this.props.year,hide:function(){return e.showYearSlider(!1)}}),r.a.createElement(eg,{hide:function(){return e.showCountries(!1)},onFiltersChanged:function(){return e.props.onFiltersChanged()},getCountries:function(){return e.props.getCountries()}}),r.a.createElement(Pg,{hide:function(){return e.showStyles(!1)},onFiltersChanged:function(){return e.props.onFiltersChanged()},getStyles:function(){return e.props.getStyles()}}),r.a.createElement(jg,{hide:function(){return e.showChords(!1)},onFiltersChanged:function(){return e.props.onFiltersChanged()}})))}}]),t}(a.Component),Rg=Object(y.b)(function(e){return{countriesSelected:e.selector.countriesSelected,showSamples2D:e.selector.showSamples2D}},function(e){return{setShowYearSlider:function(t){return e(Object(w.Ed)(t))},setShowCountries:function(t){return e(Object(w.kd)(t))},setShowChordFilter:function(t){return e(Object(w.id)(t))},setShowStyles:function(t){return e(Object(w.Ad)(t))}}})(Ag),Ig=(n(984),a.Component,function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{onClick:this.props.onChooseSequence,className:this.props.selected?"sequence selected":"sequence"},r.a.createElement("span",{className:"sequence-name"},this.props.sequence.name),r.a.createElement("div",{className:"sequence-date"},void 0!==this.props.sequence.data?this.props.sequence.date:""))}}]),t}(a.Component));n(2333);var Lg=5,Fg=function(e){function t(e){var n;return Object(o.a)(this,t),n=Object(u.a)(this,Object(l.a)(t).call(this,e)),console.log("selector constructed"),n.searchCounter=0,n.state={loadingIds:void 0,tagToRanking:{},tags:[],searchTerms:"",filterFavorites:!1,soundHashes:[],soundHashesToShow:[],size:Lg,total:void 0,styles:[],showCombine:!1,year:void 0,tagsStart:0,totalTags:0},n.nextResultsClicks=0,n.previousResultsClicks=0,n.searchSounds.bind(Object(p.a)(n)),n.getTopTags(),n.newChord=n.newChord.bind(Object(p.a)(n)),n.sameChord=n.sameChord.bind(Object(p.a)(n)),n.octaveUp=n.octaveUp.bind(Object(p.a)(n)),n.octaveDown=n.octaveDown.bind(Object(p.a)(n)),n.chordOff=n.chordOff.bind(Object(p.a)(n)),n.auditionNext=n.auditionNext.bind(Object(p.a)(n)),n.auditionPrevious=n.auditionPrevious.bind(Object(p.a)(n)),n.similarSounds=n.similarSounds.bind(Object(p.a)(n)),n.getTopVideos(),n.searchSounds(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){return e.guildId!==this.props.guildId&&this.clearSelector(e.guildId),!0}},{key:"componentDidMount",value:function(){this.addChordListeners()}},{key:"componentWillUnmount",value:function(){this.removeChordListeners(),this.sampleLoader&&this.sampleLoader.cancel(),this.sampleLoader&&this.sampleLoader.dispose()}},{key:"filtersChanged",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a=this,r=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(r.length>0&&void 0!==r[0])||r[0],this.props.setSearchResultsStart(0),this.state.loadingIds=void 0,this.state.total=0,this.setState(this.state),e.next=7,this.getSelectedFields();case 7:this.nextResultsClicks++,n=this.nextResultsClicks,setTimeout(function(){a.nextResultsClicks==n&&t&&a.searchSounds()},500),this.getTopTags(),this.getTopCountries(),this.getTopStyles(),this.getTopVideos();case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getSelectedFields",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.ethereumSearcher.selectedTags=this.getSelectedTags("AND"),this.props.ethereumSearcher.selectedOrTags=this.getSelectedTags("OR"),this.props.ethereumSearcher.selectedStyles=this.getSelectedStyles(),this.props.ethereumSearcher.year=this.getReduxState().selector.yearSelected,this.props.ethereumSearcher.selectedCountries=this.getSelectedCountries(),this.props.ethereumSearcher.selectedVideos=this.getSelectedVideos(),this.props.ethereumSearcher.selectedDiscogs=this.getSelectedDiscogs(),this.props.ethereumSearcher.fromDate=this.getDateSampled(),!this.props.sequencerEngine.store.getState().selector.dateSampled){e.next=13;break}return e.next=11,this.props.ethereumSearcher.filterByMonth(this.props.ethereumSearcher.fromDate);case 11:e.next=14;break;case 13:this.props.ethereumSearcher.clearFilterByMonth();case 14:this.props.ethereumSearcher.filterFavorites=this.state.filterFavorites,this.props.ethereumSearcher.chord=this.getReduxState().selector.chordSelected;case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getDateSampled",value:function(){var e=new Date;return e.setDate(e.getDate()-1),this.fromDate||e}},{key:"clearSelector",value:function(){var e=Object(g.a)(v.a.mark(function e(t){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("clear selector called"),e.next=3,this.searcher.getNewIndex(t);case 3:this.searcher.clearCache(),this.filtersChanged();case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getTopTags",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t=this;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSelectedFields();case 2:this.getSearcher().getTopTags(this.state.tagsStart,5e3).then(function(e){var n=t.props.tagsSelected,a={};for(var r in n)"NONE"!==n[r].condition&&(a[r]=n[r]);n=a,e.forEach(function(e){var a=e.value,r=e.rank;n[a]=void 0===t.props.tagsSelected[a]?{condition:"NONE",rank:r}:{condition:t.props.tagsSelected[a].condition,rank:r}}),t.props.setTagsSelected(n)});case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getTopCountries",value:function(){var e=this;this.getSelectedFields(),this.getSearcher().getTopCountries().then(function(t){var n={};t.forEach(function(t){var a=e.props.countriesSelected[t.value];n[t.value]=void 0===a?{condition:!1,rank:t.rank}:{condition:a.condition,rank:t.rank}}),e.props.setCountriesSelected(n)})}},{key:"getTopVideos",value:function(){var e=this;this.getSelectedFields();var t=this.getReduxState();this.getSearcher().getTopVideos().then(function(n){var a={};n.forEach(function(e){var n=t.selector.videosSelected[e.value];a[e.value]=void 0===n?{condition:"NONE",rank:e.rank}:{condition:n.condition,rank:e.rank}}),e.props.setVideosSelected(a)}),this.getSearcher().getTopDiscogs().then(function(n){var a={};n.forEach(function(e){var n=t.selector.discogsSelected[e.value];a[e.value]=void 0===n?{condition:"NONE",rank:e.rank}:{condition:n.condition,rank:e.rank}}),e.props.setDiscogsSelected(a)})}},{key:"getTopStyles",value:function(){var e=this;this.getSelectedFields();this.state.stylesSelected;this.getSearcher().getTopStyles().then(function(t){var n={};t.forEach(function(t){var a=e.props.stylesSelected[t.value];n[t.value]=void 0===a?{condition:!1,rank:t.rank}:{condition:a.condition,rank:t.rank}}),e.props.setStylesSelected(n)})}},{key:"onClickFavorites",value:function(){var e=this.state.filterFavorites;this.clearSounds(),this.state.filterFavorites=!e,this.nextResultsClicks++;this.nextResultsClicks;this.filtersChanged()}},{key:"getSearcher",value:function(){return this.props.decentralized?this.props.ethereumSearcher:this.searcher}},{key:"getReduxState",value:function(){return this.props.sequencerEngine.store.getState()}},{key:"getSelectedTags",value:function(e){var t=this.props.sequencerEngine.store.getState().selector.tagsSelected;return Object.keys(t).filter(function(n){return t[n].condition===e})}},{key:"getSelectedStyles",value:function(){var e=this.props.sequencerEngine.store.getState().selector.stylesSelected;return Object.keys(e).filter(function(t){return e[t].condition})}},{key:"getSelectedCountries",value:function(){var e=this.props.sequencerEngine.store.getState().selector.countriesSelected;return void 0===e?[]:Object.keys(e).filter(function(t){return e[t].condition})}},{key:"getSelectedVideos",value:function(){var e=this.props.sequencerEngine.store.getState().selector.videosSelected;return void 0===e?[]:Object.keys(e).filter(function(t){return"NONE"!==e[t].condition})}},{key:"getSelectedDiscogs",value:function(){var e=this.props.sequencerEngine.store.getState().selector.discogsSelected;return void 0===e?[]:Object.keys(e).filter(function(t){return"NONE"!==e[t].condition})}},{key:"clearSounds",value:function(){this.props.setSearchResultsSamples([]),void 0!==this.sampleLoader&&this.sampleLoader.cancel()}},{key:"searchSounds",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r,s,i,o,c=this;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.props.hideSearchResults){e.next=2;break}return e.abrupt("return");case 2:if(!this.state.showCombine){e.next=4;break}return e.abrupt("return");case 4:if(this.clearSounds(),this.similarSoundsQuery=void 0,this.getSelectedFields(),this.searchCounter++,t=this.searchCounter,!this.props.ethereumSearcher.empty()){e.next=20;break}return this.getSearcher().filterFavorites=this.state.filterFavorites,this.setState({selectedSounds:void 0}),e.next=14,this.getSearcher().getAllSounds(this.start,this.state.size);case 14:return n=e.sent,e.next=17,n.getResults(this.start,this.state.size);case 17:return a=e.sent,this.searchCounter===t?(void 0!==this.sampleLoader&&this.sampleLoader.dispose(),this.sampleLoader=new ng(this.props.sequencerEngine),this.sampleLoader.loadIds(a.sounds,this.state.size),Object.keys(this.props.videosSelected).filter(function(e){return"NONE"!==c.props.videosSelected[e]}),r=a.total,this.setState({soundHashes:a.sounds,total:r})):n.cancel(),e.abrupt("return");case 20:return e.next=22,this.getSearcher().getSounds(this.start,this.state.size);case 22:if(s=e.sent,i=s.getResults(this.start,this.state.size),this.searchCounter===t){e.next=27;break}return s.cancel(),e.abrupt("return");case 27:return this.state.soundHashes=i.sounds,this.sampleLoader&&this.sampleLoader.dispose(),this.sampleLoader=new ng(this.props.sequencerEngine),this.sampleLoader.loadIds(i.sounds,this.state.size),this.setState({selectedSounds:s.getAllSounds()}),this.setState({soundHashes:i.sounds,total:i.total}),e.next=35,s.getNext();case 35:o=e.sent;case 36:if(void 0===o){e.next=56;break}return e.next=39,s.getNext();case 39:if(o=e.sent,this.searchCounter==t){e.next=43;break}return s.cancel(),e.abrupt("break",56);case 43:if(this.setState({selectedSounds:s.getAllSounds()}),i=s.getResults(this.start,this.state.size),this.setState({total:i.total}),!(this.state.soundHashes.length<this.state.size)){e.next=54;break}if(!this.eq(this.state.soundHashes,i.sounds)){e.next=49;break}return e.abrupt("continue",36);case 49:this.state.soundHashes=i.sounds,this.sampleLoader&&this.sampleLoader.dispose(),this.sampleLoader=new ng(this.props.sequencerEngine),this.sampleLoader.loadIds(i.sounds,this.state.size),this.setState(this.state);case 54:e.next=36;break;case 56:if(i=s.getResults(this.start,this.state.size),this.setState({selectedSounds:s.getAllSounds()}),this.setState({total:i.total}),!(this.state.soundHashes.length<this.state.size)){e.next=67;break}if(!this.eq(this.state.soundHashes,i.sounds)){e.next=62;break}return e.abrupt("return");case 62:this.state.soundHashes=i.sounds,this.sampleLoader&&this.sampleLoader.dispose(),this.sampleLoader=new ng(this.props.sequencerEngine),this.sampleLoader.loadIds(i.sounds,this.state.size),this.setState(this.state);case 67:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loadIds",value:function(e){this.props.setSearchResultsStart(0),this.clearSounds(),this.similarSoundsQuery=new bi(this.props.sequencerEngine.store),this.similarSoundsQuery.setFinalResults(e),this.sampleLoader&&this.sampleLoader.dispose(),this.sampleLoader=new ng(this.props.sequencerEngine);var t=e.length;e=this.similarSoundsQuery.getResults(0,this.state.size).sounds,this.sampleLoader.loadIds(e,this.state.size),this.setState({start:0,loadingIds:e,soundHashes:e,total:t})}},{key:"loadPaginatedIds",value:function(){var e=this.state.loadingIds;e=e.length>this.start+this.state.size?e.slice(this.start,this.start+this.state.size):e.slice(this.start),this.similarSoundsQuery&&(e=this.similarSoundsQuery.getResults(this.start,this.state.size).sounds),this.sampleLoader&&this.sampleLoader.dispose(),this.sampleLoader=new ng(this.props.sequencerEngine),this.sampleLoader.loadIds(e,this.state.size),this.setState({soundHashes:e})}},{key:"eq",value:function(e,t){return e.every(function(e){return t.indexOf(e)>-1})&&t.every(function(t){return e.indexOf(t)>-1})}},{key:"nextResults",value:function(){var e=this;if(!(this.start+this.state.size>this.total)){this.props.setSearchResultsStart(this.start+this.state.size),this.setState(this.state),this.clearSounds(),this.nextResultsClicks++;var t=this.nextResultsClicks;setTimeout(function(){e.nextResultsClicks==t&&(e.state.loadingIds?e.loadPaginatedIds():e.searchSounds())},50)}}},{key:"previousResults",value:function(){var e=this;if(!(this.start-this.state.size<0)){this.clearSounds(),this.start-=this.state.size,this.setState(this.state),this.previousResultsClicks++;var t=this.previousResultsClicks;setTimeout(function(){e.previousResultsClicks==t&&(e.state.loadingIds?e.loadPaginatedIds():e.searchSounds())},50)}}},{key:"onClickNextTags",value:function(){this.state.tagsStart+=5e3,this.getTopTags()}},{key:"onClickPreviousTags",value:function(){this.state.tagsStart=this.state.tagsStart-5e3,this.getTopTags()}},{key:"onKeyPress",value:function(e){this.start=0,""===this.state.searchTerms?(this.state.soundIdsToShow=[],this.state.total=void 0,this.getTopTags(),this.props.setShowTags(!1)):(this.props.setShowTags(!0),this.freeTextSearch())}},{key:"freeTextSearch",value:function(){var e=this;if(this.props.decentralized){this.nextResultsClicks++;var t=this.nextResultsClicks;setTimeout(function(){if(e.nextResultsClicks==t){if(e.state.lastSearch===e.state.searchTerms)return;e.showSamples2D&&e.searchIn2D(),e.props.ethereumSearcher.freeTextSearch(e.state.searchTerms).then(function(t){e.state.lastSearch=e.state.searchTerms;var n,a,r={},s=t.TAG.length,i=1===s?"AND":"OR";if(t.TAG.forEach(function(e){return r[e.value]={condition:i,rank:e.rank}}),e.props.setTagsSelected(r),e.props.showStyles){var o={};t.STYLE.forEach(function(e){return o[e.value]={condition:i,rank:e.value}}),e.props.setStylesSelected(o),e.props.setShowStyles(!0)}1===s?e.filtersChanged():(e.clearSounds(),(n=e.state.searchTerms,a=e.props.guildId,new Promise(function(e,t){fetch("/textSearch/",{method:"POST",body:JSON.stringify({text:n,guildId:a}),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(t){e(t)}).catch(function(e){console.log(e)})})).then(function(t){return e.loadIds(t)}),e.setState({start:0,total:void 0}))})}},500)}}},{key:"onShowMoreTagsClicked",value:function(){this.props.setShowTags(!this.props.showTags)}},{key:"getSamples",value:function(){return void 0===this.sampleLoader?[]:this.props.searchResultsSamples}},{key:"sameChord",value:function(e){if(this.props.showChordFilter&&void 0!==this.sampleLoader)if(void 0!==this.sampleLoader)this.sampleLoader.playCurrent();else{var t=Array.from(e.chord).map(function(e){return bs.a.fromString(e).note});this.props.setChordSelected(t),this.filtersChanged()}}},{key:"newChord",value:function(e){if(this.props.showChordFilter&&this.props.showChordFilter){var t=Array.from(e.chord).map(function(e){return bs.a.fromString(e).note});this.props.setChordSelected(t),this.filtersChanged()}}},{key:"octaveUp",value:function(e){this.props.showChordFilter&&void 0!==this.sampleLoader&&(this.sampleLoader.nextCursor()?this.nextResults():this.sampleLoader.playCurrent())}},{key:"chordOff",value:function(e){this.props.showChordFilter&&void 0!==this.sampleLoader&&this.sampleLoader.stopCurrent()}},{key:"octaveDown",value:function(e){this.props.showChordFilter&&void 0!==this.sampleLoader&&(this.sampleLoader.previousCursor()?this.previousResults():this.sampleLoader.playCurrent())}},{key:"removeChordListeners",value:function(){window.removeEventListener("SAME_CHORD",this.sameChord),window.removeEventListener("NEW_CHORD",this.newChord),window.removeEventListener("OCTAVE_UP",this.octaveUp),window.removeEventListener("CHORD_OFF_EVENT",this.chordOff),window.removeEventListener("OCTAVE_DOWN",this.octaveDown),window.removeEventListener("AUDITION_NEXT_SAMPLE",this.auditionNext),window.removeEventListener("AUDITION_PREVIOUS_SAMPLE",this.auditionPrevious),window.removeEventListener("SIMILAR_SOUNDS",this.similarSounds)}},{key:"addChordListeners",value:function(){window.addEventListener("SAME_CHORD",this.sameChord),window.addEventListener("NEW_CHORD",this.newChord),window.addEventListener("OCTAVE_UP",this.octaveUp),window.addEventListener("CHORD_OFF_EVENT",this.chordOff),window.addEventListener("OCTAVE_DOWN",this.octaveDown),window.addEventListener("AUDITION_NEXT_SAMPLE",this.auditionNext),window.addEventListener("AUDITION_PREVIOUS_SAMPLE",this.auditionPrevious),window.addEventListener("SIMILAR_SOUNDS",this.similarSounds)}},{key:"similarSounds",value:function(){var e=this.props.sequencerEngine.store.getState().selector.similarSoundsToFind,t=R.a.samples2D.findSimilarSounds(e),n=new bi(this.props.sequencerEngine.store);n.setFinalResults(t),this.similarSoundsQuery=n,this.loadIds(n.getResults(0,this.state.size).sounds),this.setState({selectedSounds:t})}},{key:"auditionNext",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getAuditionedSampleIndex();if(console.log("audition next calaled with index="+t),void 0!==this.props.sampleAuditioning){void 0===t&&(t=-1);var n=this.getSamples();if(t+1>=n.length)this.nextResults();else{var a=n[t+1].sample;if(void 0===a.audioBuffer)return void this.auditionNext(void 0,t+1);this.onAudition(a)}}}},{key:"onAudition",value:function(e){var t=this,n=this.getSamples(),a=this.getAuditionedSampleIndex(e);this.props.onAudition(e),setTimeout(function(){if(void 0!==a){var e=n[a+1];if(e){var r=t.getReduxState().waveform.onsetThreshold;e.sample.analyze(t.props.sequencerEngine.aubio,r)}}},1e3)}},{key:"getAuditionedSampleIndex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props.sampleAuditioning;if(void 0===e)return-1;var t=this.getSamples(),n=void 0;for(var a in t)t[a].sample.getId()===e.getId()&&(n=parseInt(a));return n}},{key:"auditionPrevious",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getAuditionedSampleIndex();if(void 0!==this.props.sampleAuditioning){var n=this.getSamples();if(void 0===t&&(t=n.length),t-1<0)this.previousResults();else{var a=n[t-1].sample;if(void 0===a.audioBuffer)return void this.auditionPrevious(void 0,t-1);this.onAudition(a)}}}},{key:"addSound",value:function(e,t,n){var a=this.props.selectedChordSample;void 0!==a&&a.sampleHash===e.getId()&&(a.endTime=void 0,n=[a].concat(n)),this.props.onAddSound(e,t,n,a,this.props.chordSelected)}},{key:"onSelectPageSize",value:function(e){this.state.size=e,this.filtersChanged()}},{key:"onClickThumbnail",value:function(e){if(void 0!==e.videoId){var t={};t[e.videoId]="OR",this.props.setVideosSelected(t),this.filtersChanged()}}},{key:"showHierarchalTagSelector",value:function(){return!this.props.sequencerEngine.store.getState().selector.showSamples2D}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"selector-pane"},r.a.createElement(Iv,{sequencerEngine:this.props.sequencerEngine}),r.a.createElement(Rg,{selectedSounds:this.state.selectedSounds,onAudition:function(t){return e.onAudition(t)},store:this.props.sequencerEngine.store,onFiltersChanged:function(t){return e.filtersChanged(t)},loadIds:function(t){return e.loadIds(t)},getCountries:function(){return e.getTopCountries()},sequencerEngine:this.props.sequencerEngine,getStyles:function(){return e.getTopStyles()},year:this.state.year},r.a.createElement(A.h,{className:"selector-search"},r.a.createElement(A.g,{onChange:function(t){e.state.searchTerms=t.target.value,e.setState(e.state)},value:this.state.searchTerms,onKeyUp:function(t){return e.onKeyPress(t)},placeholder:"Search sounds",id:"search-input"}))),r.a.createElement(O,{condition:this.showHierarchalTagSelector()},r.a.createElement(Zv,{store:this.props.sequencerEngine.store,onFiltersChanged:function(){return e.filtersChanged()},onMoreButtonClicked:function(){return e.onShowMoreTagsClicked()},guildId:this.props.guildId,getTags:function(){return e.getTopTags()}})),r.a.createElement(Wv,{searcher:this.props.ethereumSearcher,getVideos:function(){return e.getTopVideos()},onFiltersChanged:function(){return e.filtersChanged()}}),this.props.hideSearchResults?"":r.a.createElement(Uv,{total:this.state.total,searcher:this.props.ethereumSearcher,start:this.start,size:this.state.size,filterFavorites:this.state.filterFavorites,onClickFavorites:function(){return e.onClickFavorites()},nextResults:function(){return e.nextResults()},previousResults:function(){return e.previousResults()},getSamples:function(){return e.getSamples()},onClickThumbnail:function(t){return e.onClickThumbnail(t)},addSound:function(t,n,a){return e.addSound(t,n,a)},onAudition:function(t){return e.onAudition(t)},sequencerEngine:this.props.sequencerEngine,onSelectPageSize:function(t){return e.onSelectPageSize(t)},onFiltersChanged:function(){return e.filtersChanged()}}))}},{key:"searchIn2D",value:function(){this.props.setShowSamples2D(!1)}},{key:"searcher",get:function(){return this.props.ethereumSearcher}},{key:"fromDate",get:function(){return this.props.sequencerEngine.store.getState().selector.dateSampled}},{key:"showSamples2D",get:function(){return this.getReduxState().selector.showSamples2D}},{key:"start",set:function(e){this.props.setSearchResultsStart(e)},get:function(){return this.props.sequencerEngine.store.getState().selector.searchResultsStart}},{key:"total",get:function(){return void 0===this.state.total?1e6:this.state.total}},{key:"totalString",get:function(){return void 0===this.state.total?"many":this.state.total}}]),t}(a.Component),Vg=Object(y.b)(function(e,t){return{decentralized:e.sequencer.decentralized,countriesSelected:e.selector.countriesSelected,videosSelected:e.selector.videosSelected,stylesSelected:e.selector.stylesSelected,discogsSelected:e.selector.discogsSelected,tagsSelected:e.selector.tagsSelected,showTags:e.selector.showTags,searchResultsSamples:e.selector.searchResultsSamples,chordSelected:e.selector.chordSelected,showChordFilter:e.selector.showChordFilter,showCountries:e.selector.showCountries,selectedChordSample:e.selector.selectedChordSample,sampleAuditioning:e.audition.sampleAuditioning,showConvolverModal:e.sequencer.showConvolverModal,start:e.selector.searchResultsStart,guildId:e.guilds.selectedGuild?e.guilds.selectedGuild.guildId:0,hideSearchResults:t.hideSearchResults||e.selector.showSamples2D}},function(e){return{setCountriesSelected:function(t){return e(Object(w.W)(t))},setVideosSelected:function(t){return e(Object(w.xe)(t))},setStylesSelected:function(t){return e(Object(w.Td)(t))},setTagsSelected:function(t){return e(Object(w.Yd)(t))},setShowTags:function(t){return e(Object(w.Bd)(t))},setShowStyles:function(t){return e(Object(w.Ad)(t))},setSearchResultsSamples:function(t){return e(Object(w.Ec)(t))},setChordSelected:function(t){return e(Object(w.M)(t))},setDiscogsSelected:function(t){return e(Object(w.ib)(t))},setSearchResultsStart:function(t){return e(Object(w.Fc)(t))},setShowSamples2D:function(t){return e(Object(w.vd)(t))}}})(Fg),Bg=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={sharingMode:!1,usersInGuilds:[],usersToShare:[],shareToAll:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickShare",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({sharingMode:!0});case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"executeShare",value:function(){if(this.state.shareToAll)this.props.ethereum.guilds.sharePresetWithAllGuilds(this.props.preset.id);else for(var e in this.state.usersToShare){var t=this.state.usersToShare[e].userId,n=this.props.preset.id;this.props.presets.sharePreset(n,t)}this.clear(),this.props.onClose()}},{key:"clear",value:function(){this.setState({sharingMode:!1,usersToShare:[],usersInGuilds:[],shareToAll:!1})}},{key:"onSelectUser",value:function(e){this.setState({usersToShare:this.state.usersToShare.concat([e])})}},{key:"getUserOptions",value:function(){var e=[];for(var t in this.state.usersInGuilds){var n=this.state.usersInGuilds[t];e.push({label:n.userName,value:n})}return e}},{key:"onClickNo",value:function(){this.clear(),this.props.onClose()}},{key:"onShareToAllCheckbox",value:function(e){this.setState({shareToAll:!this.state.shareToAll})}},{key:"render",value:function(){var e=this,t=void 0!==this.props.preset?this.props.preset.name:"";return this.state.sharingMode?r.a.createElement(D.a,{dialogClassName:"preset-modal",show:this.props.show,onHide:this.props.onClose},r.a.createElement(D.a.Header,{closeButton:!0},r.a.createElement(D.a.Title,null,t)),r.a.createElement(D.a.Body,null,r.a.createElement(pp.a,{className:"",options:this.getUserOptions(),onChange:function(t){return e.onSelectUser(t.value)},value:void 0,placeholder:"Share with users"}),this.state.usersToShare.map(function(e){return r.a.createElement(A.a,null,e.userName)}),r.a.createElement("form",null,r.a.createElement("div",{className:"refined-checkbox-preferences"},r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",value:"share",checked:this.state.shareToAll,onChange:function(t){return e.onShareToAllCheckbox(t.target.value)}}),"Share with all guild members")))),r.a.createElement(D.a.Footer,null,r.a.createElement(A.b,{variant:"secondary",onClick:function(){return e.executeShare()}},"Yes"),r.a.createElement(A.b,{variant:"primary",onClick:function(){return e.onClickNo()}},"No"))):r.a.createElement(D.a,{dialogClassName:"preset-modal",show:this.props.show,onHide:this.props.onClose},r.a.createElement(D.a.Header,{closeButton:!0},r.a.createElement(D.a.Title,null,t)),r.a.createElement(D.a.Body,null,"Do you want to replace this project's LFOs with this preset's LFOs?"),r.a.createElement(D.a.Footer,null,r.a.createElement(A.b,{variant:"secondary",onClick:this.props.onClickYes},"Yes"),r.a.createElement(A.b,{variant:"primary",onClick:this.props.onClickNo},"No"),r.a.createElement(A.b,{variant:"primary",onClick:function(){return e.onClickShare()}},"Share")))}}]),t}(a.Component),Ug=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object(o.a)(this,e),this.samples=n,this.tags=a,this.name=t,this.sampleToSlices=r,this.timestamp=void 0,this.isArchived=!1,this.id=void 0}return Object(c.a)(e,[{key:"getJson",value:function(){return{samples:this.samples,sampleToSlices:this.sampleToSlices,name:this.name,tags:this.tags,timestamp:void 0===this.timestamp?Math.floor(Date.now()):this.timestamp,isArchived:this.isArchived,id:this.id}}},{key:"fromJson",value:function(e){return"sampleToSlices"in e&&(this.sampleToSlices=e.sampleToSlices),"name"in e&&(this.name=e.name),"samples"in e&&(this.samples=e.samples),"tags"in e&&(this.tags=e.tags),"timestamp"in e&&(this.timestamp=new Date(e.timestamp)),"isArchived"in e&&(this.isArchived=e.isArchived),"id"in e&&(this.id=e.id),this}}]),e}(),Hg=new function e(){Object(o.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"}],name:"newSamplePack",outputs:[{name:"",type:"uint32"}],payable:!1,stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"",type:"address"},{indexed:!0,name:"",type:"uint32"}],name:"NewSamplePack",type:"event"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"tags",type:"bytes32[4]"}],name:"newSamplePackWithTags",outputs:[{name:"",type:"uint32"}],payable:!1,stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"",type:"uint32"},{indexed:!0,name:"",type:"bytes32"}],name:"SamplePackTagged",type:"event"},{constant:!1,inputs:[{name:"id",type:"uint32"},{name:"tags",type:"bytes32[4]"}],name:"tagSamplePack",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{constant:!1,inputs:[{name:"id",type:"uint32"},{name:"ipfsHash",type:"bytes32"}],name:"updateSamplePackSamples",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"getNumberOfSamplePacks",outputs:[{name:"",type:"uint32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"id",type:"uint32"}],name:"getSamplePackIpfsHash",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"}],this.contractAddress="0x1f4d647863b75171b40680f269d4c8cbf3ed50b7"},Jg="undefined"!==typeof window.web3?new ai.a(window.web3.currentProvider):new ai.a(new ai.a.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),Gg=function(){function e(){Object(o.a)(this,e),void 0!==Jg&&Jg.eth.net.isListening()&&(this.contract=new Jg.eth.Contract(Hg.abi,Hg.contractAddress),this.ethAddress=this.contract.options.address)}return Object(c.a)(e,[{key:"updateSamplePack",value:function(e,t){var n=this;return new Promise(function(){var a=Object(g.a)(v.a.mark(function a(r,s){var i,o;return v.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,B.a.addJson(t.getJson());case 2:return i=a.sent,a.next=5,Jg.eth.getAccounts();case 5:o=a.sent,n.contract.methods.updateSamplePackSamples(e,Object(ri.b)(i)).send({from:o[0]},function(e,t){e?s(e):r()});case 7:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"newSamplePack",value:function(e){var t=this;return new Promise(function(){var n=Object(g.a)(v.a.mark(function n(a,r){var s,i;return v.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,B.a.addJson(e.getJson());case 2:return s=n.sent,n.next=5,Jg.eth.getAccounts();case 5:i=n.sent,t.contract.methods.newSamplePack(Object(ri.b)(s)).send({from:i[0]},function(e,t){e?r(e):a()});case 7:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getAllSamplePacks",value:function(){var e=this;return new Promise(function(){var t=Object(g.a)(v.a.mark(function t(n,a){var r,s,i,o,c;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.contract.methods.getNumberOfSamplePacks().call();case 2:for(r=t.sent,s=[],i=function(t){s.push(new Promise(function(){var n=Object(g.a)(v.a.mark(function n(a,r){var s,i,o;return v.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.contract.methods.getSamplePackIpfsHash(t).call();case 2:return s=n.sent,n.next=5,B.a.getJson(Object(ri.a)(s));case 5:i=n.sent,(o=new Ug).id=t,a(o.fromJson(i));case 9:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}()))},o=1;o<=r;o++)i(o);return t.next=8,Promise.all(s);case 8:c=t.sent,n(c.filter(function(e){return!e.isArchived}).reverse());case 10:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}}]),e}(),zg=(n(985),new Gg),_g=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={samplePacks:[]},n.getSamplePacks(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getSamplePacks",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,zg.getAllSamplePacks();case 2:t=e.sent,this.setState({samplePacks:t});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onClickDelete",value:function(e){window.confirm("Are you sure you want to delete this sample pack?")&&(e.isArchived=!0,zg.updateSamplePack(e.id,e))}},{key:"render",value:function(){var e=this;return console.log("rendering the damn sample packs"),console.log(this.state.samplePacks),r.a.createElement("div",{className:"sample-packs-list"},this.state.samplePacks.map(function(t){return r.a.createElement(Wg,{showDeleteButton:e.props.showDeleteButton,onClick:function(){return e.props.onClickSamplePack(t)},onClickDelete:function(){return e.onClickDelete(t)},samplePack:t})}))}}]),t}(a.Component),Wg=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"sample-pack-item",onClick:function(){return e.props.onClick()}},r.a.createElement("span",{className:"sample-pack-name"},this.props.samplePack.name),void 0!==this.props.samplePack.timestamp?r.a.createElement("span",{className:"sample-pack-date"},this.props.samplePack.timestamp.toLocaleString()):"",this.props.samplePack.tags.map(function(e){return r.a.createElement(A.a,{color:"light"},e)}),this.props.showDeleteButton?r.a.createElement("div",{className:"delete-button",onClick:function(){return e.props.onClickDelete()}},"x"):"")}}]),t}(a.Component),Kg=_g,Yg=new U.a,Qg=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={sampleId:n.props.sampleId,isPlaying:!1},n.loadSample(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.sampleId!==e.sampleId?(console.log("detected a change, so releading!"),this.setState({sampleId:e.sampleId}),this.loadSample()):console.log("nothing changed!"),!0}},{key:"loadSample",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new K.a(this.props.sampleId)).slices=this.props.slices,e.next=4,t.fetchMetadata();case 4:return this.setState({sample:t}),e.next=7,t.fetchAudio();case 7:(n=new _).setBuffer(t.audioBuffer),this.setState({audioUnit:n});case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"playSound",value:function(){console.log("play sound called!"),void 0!==this.state.audioUnit&&(this.state.isPlaying?this.state.audioUnit.stopSound():void 0!==this.props.slices&&this.props.slices.length>0?this.state.audioUnit.playSound(this.props.slices[0].startTime):this.state.audioUnit.playSound(0),this.setState({isPlaying:!this.state.isPlaying}))}},{key:"onDragStart",value:function(e){this.props.dragSample(this.state.sample.getJson())}},{key:"onDragOver",value:function(e){}},{key:"onDrop",value:function(e){}},{key:"render",value:function(){var e=this,t="";if(void 0!==this.state.sample&&void 0!==this.state.sample.getThumbnail())t=r.a.createElement("img",{className:"palette-sample-thumbnail",src:this.state.sample.getThumbnail()});else if(void 0!==this.state.sample&&void 0===this.state.sample.getThumbnail()){var n={backgroundColor:Yg.getColor(this.props.i)};t=r.a.createElement("div",{style:n,className:"palette-sample-thumbnail"})}return r.a.createElement("div",{className:"palette-sample",onDragStart:function(t){return e.onDragStart(t)},onDragOver:function(t){return e.onDragOver(t)},onDrop:function(e){return[]},draggable:!0,onClick:function(){return e.playSound()}},void 0!==this.state.sample?t:"")}}]),t}(a.Component),Xg=Object(y.b)(null,function(e){return{dragSample:function(t){return e(Object(w.f)(t))}}})(Qg),Zg=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickDelete",value:function(){this.props.removeSamplePack(this.props.samplePack)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"palette-sample-pack"},r.a.createElement("div",null,r.a.createElement("span",{className:"palette-sample-pack-name"},this.props.samplePack.name),r.a.createElement("span",{onClick:function(){return e.onClickDelete()},className:"delete-button"},"x")),r.a.createElement("div",{className:"palette-sample-pack-samples"},this.props.samplePack.samples.map(function(t,n){return r.a.createElement(Xg,{key:t+n,sampleId:t,slices:e.props.samplePack.sampleToSlices[t],i:n})})))}}]),t}(a.Component),$g=Object(y.b)(null,function(e){return{removeSamplePack:function(t){return e(Object(w.l)(t))}}})(Zg),eb=(n(986),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={showSamplePacks:!0,showPalette:!0},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickPaletteButton",value:function(){this.setState({showPalette:!this.state.showPalette})}},{key:"onClickSamplePacksButton",value:function(){this.setState({showSamplePacks:!this.state.showSamplePacks})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"palette-container"},r.a.createElement("div",{onClick:function(){return e.onClickPaletteButton()},className:"palette-sub-header"},"YOUR PALETTE"),r.a.createElement("div",{className:"info-text"},"Drag to track"),this.state.showPalette?this.props.palette.map(function(e,t){return r.a.createElement($g,{key:e.id,samplePack:e})}):"",r.a.createElement("div",{onClick:function(){return e.onClickSamplePacksButton()},className:"palette-sub-header"},"SAMPLE PACKS"),this.state.showSamplePacks?r.a.createElement(Kg,{onClickSamplePack:function(t){return e.props.addSamplePack(t)}}):"")}}]),t}(a.Component)),tb=(Object(y.b)(function(e){return{palette:Object.values(e.palette).map(function(e){var t=new Ug;return t.fromJson(e),t})}},function(e){return{addSamplePack:function(t){return e(Object(w.a)(t))}}})(eb),function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickSynth",value:function(){this.props.sequencerEngine.addInstrumentTrack()}},{key:"onClickMultiSynth",value:function(){this.props.sequencerEngine.addMultiSynthTrack()}},{key:"onClickMultiSampler",value:function(){this.props.sequencerEngine.addSampledInstrumentTrack()}},{key:"onClickMetalSynth",value:function(){this.props.sequencerEngine.addMetalSynthTrack()}},{key:"onClickFMSynth",value:function(){this.props.sequencerEngine.addFMSynthTrack()}},{key:"onClickExternalInstrument",value:function(){this.props.sequencerEngine.addMidiTrack()}},{key:"onClickInstrumentRack",value:function(){this.props.sequencerEngine.addInstrumentRackTrack()}},{key:"onDragStart",value:function(e){void 0!==e&&this.props.setInstrumentTypeDragging(e)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"instruments-view"},r.a.createElement(nb,{type:Uo,onDragStart:function(t){return e.onDragStart(t)},onMouseOver:function(){return e.props.setContextualHelp("ADD_FM_SYNTH_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onClickMultiSampler()},name:"Sampled Instrument"}),r.a.createElement(nb,{onDragStart:function(t){return e.onDragStart(t)},type:Jo,onMouseOver:function(){return e.props.setContextualHelp("ADD_MULTI_SYNTH_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onClickMultiSynth()},name:"Multi Synth"}),r.a.createElement(nb,{type:Go,onDragStart:function(t){return e.onDragStart(t)},onMouseOver:function(){return e.props.setContextualHelp("ADD_FM_SYNTH_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onClickFMSynth()},name:"FM Synth"}),r.a.createElement(nb,{onDragStart:function(t){return e.onDragStart(t)},onMouseOver:function(){return e.props.setContextualHelp("ADD_EXTERNAL_INSTRUMENT_BUTTON")},onClick:function(){return e.onClickExternalInstrument()},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},name:"External Instrument"}),r.a.createElement(nb,{onDragStart:function(t){return e.onDragStart(t)},onMouseOver:function(){return e.props.setContextualHelp("ADD_EXTERNAL_INSTRUMENT_BUTTON")},onClick:function(){return e.onClickInstrumentRack()},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},name:"Instrument Rack"}))}}]),t}(a.Component)),nb=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{draggable:!0,onDragOver:function(e){return e.preventDefault()},onDragStart:function(){return e.props.onDragStart(e.props.type)},onMouseOver:this.props.onMouseOver,onMouseLeave:this.props.onMouseLeave,className:"instrument-option"},r.a.createElement("span",{onClick:this.props.onClick,className:"instrument-option-name"},this.props.name))}}]),t}(a.Component),ab=Object(y.b)(null,function(e){return{setContextualHelp:function(t){return e(Object(w.V)(t))},setInstrumentTypeDragging:function(t){return e(Object(w.Fb)(t))}}})(tb),rb="undefined"!==typeof window.web3?new ai.a(window.web3.currentProvider):new ai.a(new ai.a.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),sb=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n.getDate(),n.getName(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.sequence.id!==e.sequence.id&&this.getDate(e.sequence),this.props.showingEdits===e.showingEdits&&this.props.sequence.id===e.sequence.id||this.getName(e.sequence),!0}},{key:"getName",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:this.props.sequence,navigator.onLine){e.next=4;break}return this.setState({name:"offline"}),e.abrupt("return");case 4:return e.next=6,this.getUser(t);case 6:return n=e.sent,e.next=9,this.props.ethereum.users.getUserName(n);case 9:a=""===(a=e.sent)?n:a,this.setState({name:a});case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getDate",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:this.props.sequence,navigator.onLine){e.next=4;break}return this.setState({date:"offline"}),e.abrupt("return");case 4:return e.prev=4,e.next=7,rb.eth.getBlock(t.blockNumber);case 7:n=e.sent,a=new Date(1e3*n.timestamp).toLocaleString(),this.setState({date:a}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),this.setState({date:"unknown"});case 15:case"end":return e.stop()}},e,this,[[4,12]])}));return function(){return e.apply(this,arguments)}}()},{key:"getUser",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:this.props.sequence,e.next=3,this.props.getEditsForSequence(t);case 3:return n=e.sent,e.abrupt("return",this.props.showingEdits?t.user:n[n.length-1].user);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onClickName",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:this.props.sequence,e.next=3,this.getUser(t);case 3:n=e.sent,this.props.onClickName(n);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props.odd?"sample-pack-item odd":"sample-pack-item";return r.a.createElement("div",{className:t},r.a.createElement("div",{className:"sequence-name-and-user"},r.a.createElement("div",{className:"sample-pack-name",onClick:function(){return e.props.onClick()}},this.props.sequence.name),r.a.createElement("div",{onClick:function(){return e.onClickName()},className:"sample-pack-user-name"}," ",this.state.name)),r.a.createElement("span",{className:"sample-pack-date"},this.state.date),this.props.sequence.edits>0?r.a.createElement("span",{onClick:this.props.onClickEdits,className:"sample-pack-edits"},this.props.sequence.edits," edits"):"",r.a.createElement(O,{condition:this.props.sequence.publicKey},r.a.createElement("span",{className:"private-sequence"},"Private"),r.a.createElement("span",{className:"private-sequence share-sequence",onClick:this.props.shareSequence},"Share")))}}]),t}(a.Component),ib=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={usersInGuilds:[],usersToShare:[]},n.getMembers(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getMembers",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"executeShare",value:function(){for(var e in this.state.usersToShare){var t=this.state.usersToShare[e].userId,n=this.props.sequence;this.props.ethereum.crypto.shareSequence(n,t).catch(function(e){return window.alert("User has no public key, so we can't share with them. Try asking them to set a password")})}this.clear(),this.hide()}},{key:"clear",value:function(){this.setState({usersToShare:[]})}},{key:"onSelectUser",value:function(e){this.setState({usersToShare:this.state.usersToShare.concat([e])})}},{key:"getUserOptions",value:function(){var e=[];for(var t in this.state.usersInGuilds){var n=this.state.usersInGuilds[t];e.push({label:n.userName,value:n})}return e}},{key:"removeUser",value:function(e){var t=this.state.usersToShare.indexOf(e);this.state.usersToShare.splice(t,1),this.setState(this.state.usersToShare)}},{key:"onClickNo",value:function(){this.clear(),this.hide()}},{key:"hide",value:function(){this.props.setShowShareSequenceModal(void 0)}},{key:"render",value:function(){var e=this,t=void 0===this.props.sequence?"":this.props.sequence.name;return r.a.createElement(D.a,{dialogClassName:"preset-modal",show:this.props.show,onHide:function(){return e.hide()}},r.a.createElement(D.a.Header,{closeButton:!0},r.a.createElement(D.a.Title,null,'Share "',t,'"')),r.a.createElement(D.a.Body,null,r.a.createElement(pp.a,{className:"",options:this.getUserOptions(),onChange:function(t){return e.onSelectUser(t.value)},value:void 0,placeholder:"Choose users to share with"}),this.state.usersToShare.map(function(t){return r.a.createElement(A.a,{onClick:function(){return e.removeUser(t)}},t.userName)})),r.a.createElement(D.a.Footer,null,r.a.createElement(A.b,{variant:"secondary",onClick:function(){return e.executeShare()}},"Yes"),r.a.createElement(A.b,{variant:"primary",onClick:function(){return e.onClickNo()}},"No")))}}]),t}(a.Component),ob=Object(y.b)(null,function(e){return{setShowShareSequenceModal:function(t){return e(Object(w.yd)(t))}}})(ib),cb="undefined"!==typeof window.web3?new ai.a(window.web3.currentProvider):new ai.a(new ai.a.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),ub=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).getCounter=0,n.state={searchTerms:"",userToFilter:void 0,sequences:[],filteredSequences:[],sequencesToDisplay:[],rawSequences:[],start:0,total:0,showingEdits:!1,user:void 0,filterByUser:void 0===e.filterByUser||n.props.filterByUser},n.getSequences(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){return e.guildId!==this.props.guildId&&(console.log("guild changed to="+e.guildId),this.getSequences(e.guildId)),!0}},{key:"showEdits",value:function(e){e||(this.state.sequences=this.convertSequences(R.a.collapseAllSequences(this.state.rawSequences)),this.setState({showingEdits:!1,sequencesToDisplay:this.getSequencesToDisplay()}))}},{key:"filterSequencesByUser",value:function(e){this.state.userToFilter=e,this.state.start=0,this.state.searchTerms="",void 0!==e?(this.getUserName(e),this.setState({sequencesToDisplay:this.getSequencesToDisplay()})):this.setState({userNameToFilter:void 0,sequencesToDisplay:this.getSequencesToDisplay()})}},{key:"onClickEdits",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.getCounter++,e.next=3,this.getEditsForSequence(t);case 3:n=e.sent,this.setState({showingEdits:!0,sequences:this.convertSequences(n)}),this.state.sequences=this.convertSequences(n),this.state.searchTerms="",this.setState({sequencesToDisplay:this.getSequencesToDisplay()});case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onSearchTermsChanged",value:function(){var e=Object(g.a)(v.a.mark(function e(t){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.state.start=0,this.state.searchTerms=t.target.value,this.setState({sequencesToDisplay:this.getSequencesToDisplay()});case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"convertSequences",value:function(e){return e.filter(function(e){return void 0!==e.title}).map(function(e){return Object(X.a)({},e,{name:e.title,id:e.newSequence,user:e.user,blockNumber:e.blockNumber,edits:e.edits})})}},{key:"getSequences",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r,s,i,o=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:this.props.guildId,this.getCounter++,0===t){e.next=11;break}return e.next=5,R.a.guildSequences.getGuildSequences(t);case 5:n=e.sent,this.handleGetSequencesResults(n),console.log("sequences = "),console.log(n),e.next=30;break;case 11:if(a=this.getCounter,r=void 0,!this.state.filterByUser){e.next=17;break}return e.next=16,Ge.a.getAccount();case 16:r=e.sent;case 17:return s=new Le.a(R.a),e.next=20,s.executeQuery(r);case 20:i=[];case 21:if(void 0===i){e.next=30;break}return e.next=24,s.getNext();case 24:if(i=e.sent,this.getCounter===a){e.next=27;break}return e.abrupt("return");case 27:this.handleGetSequencesResults(s.results),e.next=21;break;case 30:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"handleGetSequencesResults",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({rawSequences:t}),t=R.a.collapseAllSequences(t),n=this.convertSequences(t),this.setState({sequences:n}),this.setState({sequencesToDisplay:this.getSequencesToDisplay()});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onChooseSequence",value:function(e,t){void 0===this.props.onLoad?(this.props.setLoadingSequence(e,!0),this.props.sequencerEngine.loadSequence(e)):this.props.onLoad(t)}},{key:"getSequencesToDisplay",value:function(){var e=this;if(0==this.state.sequences.length)return[];var t=this.state.sequences;return""!==this.state.searchTerms&&void 0===this.state.userToFilter?t=this.convertSequences(this.state.rawSequences).filter(function(t){return t.name.toLowerCase().includes(e.state.searchTerms.toLowerCase())}):void 0!==this.state.userToFilter&&""===this.state.searchTerms&&(t=this.convertSequences(this.state.rawSequences).filter(function(t){return t.user===e.state.userToFilter})),this.setState({total:t.length}),t.length>this.state.start+20?t.slice(this.state.start,this.state.start+20):t.slice(this.state.start)}},{key:"addDates",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=[],e.t0=v.a.keys(t);case 2:if((e.t1=e.t0()).done){e.next=11;break}return a=e.t1.value,r=t[a],e.next=7,cb.eth.getBlock(r.blockNumber);case 7:s=e.sent,n.push({name:r.name,id:r.id,user:r.user,date:new Date(1e3*s.timestamp)}),e.next=2;break;case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"onClickPrevious",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=0,this.state.start>=20&&(t=this.state.start-20),this.setState({start:t}),this.state.start=t,e.t0=this,e.next=7,this.getSequencesToDisplay();case 7:e.t1=e.sent,e.t2={sequencesToDisplay:e.t1},e.t0.setState.call(e.t0,e.t2);case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onClickNext",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.start+20,this.state.start=t,e.t0=this,e.next=5,this.getSequencesToDisplay();case 5:e.t1=e.sent,e.t2={sequencesToDisplay:e.t1},e.t0.setState.call(e.t0,e.t2);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUserName",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.a.users.getUserName(t);case 2:n=""===(n=e.sent)?t:n,this.setState({userNameToFilter:n});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getEditsForSequence",value:function(){var e=Object(g.a)(v.a.mark(function e(t){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.a.getEditsForSequence(t,this.state.rawSequences);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"shareSequence",value:function(e){this.props.setShowShareSequenceModal(e)}},{key:"onFilterByUserChanged",value:function(e){this.state.start=0,this.state.filterByUser="FILTER_BY_USER"===e.target.value,this.setState(this.state),this.getSequences()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"palette-container"},r.a.createElement(ob,{show:this.props.showShareModal,ethereum:R.a,sequence:this.props.showShareModal}),r.a.createElement(A.h,{className:"selector-search"},r.a.createElement(A.g,{onChange:function(t){return e.onSearchTermsChanged(t)},value:this.state.searchTerms,placeholder:"Search sequences",id:"search-input"})),this.state.showingEdits?r.a.createElement("div",{onClick:function(){return e.showEdits(!1)},className:"common-button pink-button"},"BACK"):"",this.state.userNameToFilter?r.a.createElement("div",{onClick:function(){return e.filterSequencesByUser(void 0)},className:"filtering-sequences-info"},"Clear filtering by user ",this.state.userNameToFilter," "):"",r.a.createElement("div",null,r.a.createElement("form",null,r.a.createElement("div",{className:"sequences radio"},r.a.createElement("label",null,r.a.createElement("input",{className:"sequences filter-radio",type:"radio",value:"FILTER_BY_USER",checked:this.state.filterByUser,onChange:function(t){return e.onFilterByUserChanged(t)}}),"My Sequences"),r.a.createElement("label",null,r.a.createElement("input",{className:"sequences filter-radio",type:"radio",value:"NO_FILTER_BY_USER",checked:!this.state.filterByUser,onChange:function(t){return e.onFilterByUserChanged(t)}}),"All")))),r.a.createElement("div",{className:"pagination-pane"},this.state.start>0?r.a.createElement("div",{className:"field-pagination-button",onClick:function(){return e.onClickPrevious()}},"PREVIOUS"):"",this.state.start+20<=this.state.total?r.a.createElement("div",{className:"field-pagination-button",onClick:function(){return e.onClickNext()}},"NEXT"):"",r.a.createElement("div",{className:"field-pagination-button"},this.state.start," - ",this.state.start+20," of ",this.state.total)),this.state.sequencesToDisplay.map(function(t,n){return r.a.createElement(sb,{odd:n%2===1,showingEdits:e.state.showingEdits,getEditsForSequence:function(t){return e.getEditsForSequence(t.id)},onClickName:function(t){return e.filterSequenceseByUser(t)},ethereum:R.a,key:"sequence-"+n,onClickEdits:function(){return e.onClickEdits(t.id)},shareSequence:function(){return e.shareSequence(t)},onClick:function(){return e.onChooseSequence(t.id,t)},sequence:t})}))}}]),t}(a.Component),lb=Object(y.b)(function(e){return{showShareModal:e.modals.showShareSequenceModal,guildId:e.guilds.selectedGuild?e.guilds.selectedGuild.guildId:0}},function(e){return{setLoadingSequence:function(t,n){return e(Object(w.Tb)(t,n))},setShowShareSequenceModal:function(t){return e(Object(w.yd)(t))}}})(ub),pb=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClick",value:function(){var e=(new Date).getTime();void 0!==this.lastDate&&e-this.lastDate<500&&this.props.onChooseItem(this.props.item),this.lastDate=e,this.props.setSelectedPreset(this.props.item)}},{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"onDragStart",value:function(e){this.props.setPresetDragging(this.props.item)}},{key:"render",value:function(){var e=this,t={paddingLeft:17*this.props.depth},n=this.props.selectedPreset===this.props.item?"folder-item selected":"folder-item";return r.a.createElement("div",{draggable:!0,onDragStart:function(t){return e.onDragStart()},onDragOver:function(t){return e.onDragOver(t)},onClick:function(){return e.onClick()},className:n,style:t},r.a.createElement("div",{onClick:function(){return e.props.onTestItem(e.props.item)},className:"item-icon"}),this.name)}},{key:"name",get:function(){return this.props.item.name.length>40?this.props.item.name.slice(0,40)+"...":this.props.item.name}}]),t}(a.Component),hb=Object(y.b)(function(e){return{selectedPreset:e.presets.selectedPreset}},function(e){return{setSelectedPreset:function(t){return e(Object(w.Tc)(t))},setPresetDragging:function(t){return e(Object(w.sc)(t))}}})(pb),db=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={collapsed:!0,nameValue:"",hovering:!1,loading:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickCollapsed",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stopPropagation(),n){e.next=7;break}if(!this.props.folder.isDynamic()||this.props.folder.isLoaded){e.next=7;break}return this.setState({loading:!0}),e.next=6,this.props.folder.load();case 6:this.setState({loading:!1});case 7:this.setState({collapsed:n}),this.onClickName();case 9:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getArrow",value:function(){var e=this;return this.state.collapsed?r.a.createElement("div",{onClick:function(t){return e.onClickCollapsed(t,!1)},className:"collapse-button"},r.a.createElement("div",{className:"arrow-right"})):r.a.createElement("div",{onClick:function(t){return e.onClickCollapsed(t,!0)},className:"collapse-button"},r.a.createElement("div",{className:"arrow-down",onClick:function(t){return e.onClickCollapsed(t,!0)}}))}},{key:"onDrop",value:function(e){e.stopPropagation(),this.setState({hovering:!1});var t=this.props.folderDragging,n=this.props.presetDragging;if(void 0!==t){if(this.props.setFolderDragging(void 0),this.props.folder===t)return;t.delete(),this.props.folder.addFolder(t)}else void 0!==n&&(n.parent.deleteItem(n),this.props.setPresetDragging(void 0),this.props.folder.addItem(n));this.props.onFoldersUpdated(),this.props.setHasChangesToFolders(!0)}},{key:"onClickName",value:function(){var e=(new Date).getTime();void 0!==this.lastDate&&e-this.lastDate<200&&this.props.onChooseFolder(this.props.folder),this.lastDate=e,this.props.selectedFolder===this.props.folder?this.props.setSelectedFolder(void 0):this.props.setSelectedFolder(this.props.folder)}},{key:"onInputType",value:function(e){this.setState({nameValue:e})}},{key:"onKeyDown",value:function(e){"Enter"===e.key&&(this.props.folder.name=this.state.nameValue,this.setState(this.state))}},{key:"getNameComponent",value:function(){var e=this,t=this.props.selectedFolder===this.props.folder&&this.props.folder.name?"folder-name selected":"folder-name";return this.state.hovering&&(t+=" hover"),r.a.createElement("div",{draggable:!0,onDragOver:function(t){return e.onDragOver(t)},onDragStart:function(t){return e.onDragStart(t)},onDragLeave:function(t){return e.onDragLeave(t)},className:t},this.getArrow(),r.a.createElement(O,{condition:this.props.folder.name},r.a.createElement("div",{className:"name-label",onClick:function(){return e.onClickName()}},this.props.folder.name)),r.a.createElement(O,{condition:void 0===this.props.folder.name},r.a.createElement("input",{value:this.state.nameValue,onChange:function(t){return e.onInputType(t.target.value)},onKeyDown:function(t){return e.onKeyDown(t)},ref:function(t){e.input=t},placeholder:"Type name of folder",className:"tag-input"})))}},{key:"onDragOver",value:function(e){e.preventDefault(),this.setState({hovering:!0})}},{key:"onDragLeave",value:function(e){this.setState({hovering:!1})}},{key:"onDragStart",value:function(e){this.props.setFolderDragging(this.props.folder)}},{key:"render",value:function(){var e=this,n=Object(ge.a)(this.props.folder.subFolders);n.sort(function(e,t){return void 0===e.name||void 0===t.name?0:e.name.localeCompare(t.name)});var a=Object(ge.a)(this.props.folder.items).filter(function(e){return void 0!==e.name});a.sort(function(e,t){return e.name.localeCompare(t.name)});var s=this.props.folder.depth<=1?0:1,i={paddingLeft:17*s};return 0===s&&(s=1),r.a.createElement("div",{onDrop:function(t){return e.onDrop(t)},className:"folder",style:i},this.getNameComponent(),r.a.createElement(O,{condition:!this.state.collapsed},n.map(function(n){return r.a.createElement(t,Object.assign({key:n.name},e.props,{folder:n}))})),r.a.createElement(V.a,{loading:this.state.loading,sizeUnit:"px",size:10,color:"#123abc"}),r.a.createElement(O,{condition:this.props.showItems&&!this.state.collapsed},a.map(function(t){return r.a.createElement(hb,{key:t.name,onChooseItem:e.props.onChooseItem,onTestItem:e.props.onTestItem,depth:s,item:t})})))}}]),t}(a.Component),fb=Object(y.b)(function(e){return{selectedFolder:e.presets.selectedFolder,folderDragging:e.presets.folderDragging,presetDragging:e.presets.presetDragging,name:void 0!==e.presets.selectedFolder?e.presets.selectedFolder.name:void 0}},function(e){return{setSelectedFolder:function(t){return e(Object(w.Lc)(t))},setFolderDragging:function(t){return e(Object(w.vb)(t))},setPresetDragging:function(t){return e(Object(w.sc)(t))},setHasChangesToFolders:function(t){return e(Object(w.Cb)(t))}}})(db),mb=(n(2334),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n.loadFolders(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"loadFolders",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(R.a.folders.isLoaded){e.next=4;break}return e.next=3,R.a.folders.loadFolders();case 3:this.setState(this.state);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onKeyUp",value:function(e){return console.log("on key up = "+e.key),e.stopPropagation(),"Delete"===e.key&&this.selectedFolder.delete(),!1}},{key:"render",value:function(){var e=this,t=R.a.folders.root.subFolders;return t.sort(function(e,t){return void 0===e.name||void 0===t.name?0:e.name.localeCompare(t.name)}),r.a.createElement("div",{className:"folders-container"},t.map(function(t,n){return r.a.createElement(fb,{key:t.name+"-",onFoldersUpdated:function(){return e.setState(e.state)},onChooseItem:e.props.onChooseItem,onChooseFolder:e.props.onChooseFolder,onTestItem:e.props.onTestItem,showItems:e.props.showItems,folder:t})}))}},{key:"selectedFolder",get:function(){return this.props.sequencerEngine.state.presets.selectedFolder}}]),t}(a.Component)),vb=Object(y.b)(function(e){return{}},null)(mb),gb=n(435);function bb(e){return""===e||void 0===e?"":"https://img.youtube.com/vi/"+e+"/1.jpg"}var yb=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={tagValue:"",tags:[]},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onKeyPress",value:function(e){"Enter"===e.key&&this.setState({tagValue:"",tags:this.state.tags.concat([this.state.tagValue])})}},{key:"onInputType",value:function(e){this.setState({tagValue:e})}},{key:"onClickTag",value:function(e){var t=this.state.tags.indexOf(e);t<-1||(this.state.tags.splice(t,1),this.setState({tags:this.state.tags}))}},{key:"shouldComponentUpdate",value:function(e){return e.preset.contentHash!==this.props.preset.contentHash&&(this.state.tags=[]),!0}},{key:"onClickDone",value:function(){this.state.tagValue.length>0&&(this.state.tags=this.state.tags.concat([this.state.tagValue])),this.props.onClickDone(this.state.tags)}},{key:"render",value:function(){var e=this,t=void 0!==this.props.preset?this.props.preset.name:"";return r.a.createElement(D.a,{dialogClassName:"preset-modal",show:this.props.show,onHide:this.props.onClickCancel},r.a.createElement(D.a.Header,{closeButton:!0},r.a.createElement(D.a.Title,null,t)),r.a.createElement(D.a.Body,null,r.a.createElement(A.g,{onKeyPress:function(t){return e.onKeyPress(t)},value:this.state.tagValue,onChange:function(t){return e.onInputType(t.target.value)},placeholder:"Enter tag name",className:"tag-input"}),this.state.tags.map(function(t){return r.a.createElement(A.a,{onClick:function(){return e.onClickTag(t)}},t)})),r.a.createElement(D.a.Footer,null,r.a.createElement(A.b,{variant:"secondary",onClick:function(){return e.onClickDone()}},"Done"),r.a.createElement(A.b,{variant:"primary",onClick:this.props.onClickCancel},"Cancel")))}}]),t}(a.Component),kb=("undefined"!==typeof window.web3?new ai.a(window.web3.currentProvider):new ai.a(new ai.a.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),new U.a),Eb=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={showTagModal:!1,dropdownOpen:!1,tags:[]},n.getName(),n.getTags(),n.getSampleHash(n.props.preset.contentHash),n.getInstrumentType(n.props.preset.contentHash),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){return e.preset.contentHash!==this.props.preset.contentHash&&(this.state.videoId=void 0,this.getDate(),this.getName(),this.getTags(e.preset),this.getSampleHash(e.preset.contentHash),this.getInstrumentType(e.preset.contentHash)),!0}},{key:"getInstrumentType",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.presets.getPresetInstrumentType(t);case 2:if(void 0!==(n=e.sent)){e.next=5;break}return e.abrupt("return");case 5:this.setState({instrumentType:n});case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSampleHash",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.presets.getPresetSampleHash(t);case 2:if(void 0!==(n=e.sent)){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,this.props.ethereum.getVideoIdForSound(n);case 7:a=e.sent,this.setState({videoId:a});case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getName",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:this.props.sequence,navigator.onLine){e.next=4;break}return this.setState({name:"offline"}),e.abrupt("return");case 4:return e.next=6,this.getUser(t);case 6:return n=e.sent,e.next=9,this.props.ethereum.users.getUserName(n);case 9:a=""===(a=e.sent)?n:a,this.setState({name:a});case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getDate",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.length>0&&void 0!==t[0]?t[0]:this.props.preset;case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUser",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:this.props.preset,e.abrupt("return",t.user);case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getTags",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:this.props.preset,e.next=3,this.props.presets.getTags(t.contentHash);case 3:n=e.sent,this.setState({tags:n});case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"addTag",value:function(){this.setState({showTagModal:!0})}},{key:"onDragStart",value:function(e){console.log("setting preset dragging",this.props.preset),this.props.setPresetDragging(this.props.preset)}},{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"doneTagging",value:function(e){this.setState({showTagModal:!1}),this.props.presets.tagPreset(this.props.preset.contentHash,e,this.props.preset.guildId),this.setState({tags:this.state.tags.concat(e)})}},{key:"cancelTagging",value:function(){this.setState({showTagModal:!1})}},{key:"render",value:function(){var e=this,t={},n=void 0;this.state.instrumentType&&(n=_o[this.state.instrumentType],t.backgroundColor=kb.getColorForHash(n));var a=this.props.odd?"sample-pack-item odd":"sample-pack-item";return r.a.createElement("div",{className:a},r.a.createElement(yb,{show:this.state.showTagModal,preset:this.props.preset,onClickCancel:function(){return e.cancelTagging()},onClickDone:function(t){return e.doneTagging(t)}}," "),r.a.createElement(O,{condition:this.state.videoId},r.a.createElement("img",{onDragOver:function(t){return e.onDragOver(t)},onDragStart:function(t){return e.onDragStart(t)},draggable:!0,src:bb(this.state.videoId),className:"preset-thumbnail"})),r.a.createElement(O,{condition:this.state.instrumentType&&void 0==this.state.videoId},r.a.createElement("div",{draggable:!0,onDragOver:function(t){return e.onDragOver(t)},onDragStart:function(t){return e.onDragStart(t)},style:t,className:"preset-thumbnail"},n)),r.a.createElement("div",{className:"sequence-name-and-user"},r.a.createElement("div",{className:"sample-pack-name",onMouseOver:function(){return e.props.setContextualHelp("ADD_PRESET_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.props.onClick()}},this.props.preset.name),r.a.createElement("div",{className:"user-name-and-date"},r.a.createElement("div",{className:"sample-pack-user-name"}," ",this.state.name," "))),r.a.createElement("div",{className:"presets-date-and-tags"},r.a.createElement("div",{className:"preset-tags"},this.state.tags.map(function(e,t){return r.a.createElement(A.a,{key:e+"-"+t,color:"dark"},e)}),this.getDropdown())))}},{key:"toggleDropdown",value:function(){this.setState({dropdownOpen:!this.state.dropdownOpen})}},{key:"getDropdown",value:function(){var e=this;return r.a.createElement(A.c,{className:"preset-dropdown",size:"sm",show:this.state.dropdownOpen,isOpen:this.state.dropdownOpen,toggle:function(){return e.toggleDropdown()}},r.a.createElement(A.b,{onClick:this.props.onClick,id:"caret",color:"secondary"},r.a.createElement("span",{className:"medium"},"+")),r.a.createElement(A.f,{size:"sm",caret:!0,color:"secondary"}),r.a.createElement(A.e,null,r.a.createElement(A.d,{onClick:this.props.onClick,size:"sm"},"ADD"),r.a.createElement(A.d,{onClick:function(){return e.addTag()},size:"sm"},"TAG"),r.a.createElement(A.d,{onClick:this.props.onMoveToFolder,size:"sm"},"MOVE FOLDER")))}}]),t}(a.Component),Sb=Object(y.b)(null,function(e){return{setContextualHelp:function(t){return e(Object(w.V)(t))},setPresetDragging:function(t){return e(Object(w.sc)(t))}}})(Eb),Ob=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickInstrumentType",value:function(e){this.props.onClickInstrumentType(e)}},{key:"render",value:function(){var e=this,t=Object.keys(this.props.tags);return t.sort(),r.a.createElement("div",{className:"presets-filter"},r.a.createElement("div",{className:"tags-hierarchy"},r.a.createElement(wb,{selectedInstrumentTypes:this.props.instrumentTypes,type:"EXTERNAL_INSTRUMENT",onClick:function(t){return e.onClickInstrumentType(t)}}),r.a.createElement(wb,{selectedInstrumentTypes:this.props.instrumentTypes,type:Go,onClick:function(t){return e.onClickInstrumentType(t)}}),r.a.createElement(wb,{selectedInstrumentTypes:this.props.instrumentTypes,type:Jo,onClick:function(t){return e.onClickInstrumentType(t)}}),r.a.createElement(wb,{selectedInstrumentTypes:this.props.instrumentTypes,type:"SAMPLER",onClick:function(t){return e.onClickInstrumentType(t)}}),r.a.createElement(wb,{selectedInstrumentTypes:this.props.instrumentTypes,type:Ho,onClick:function(t){return e.onClickInstrumentType(t)}})),r.a.createElement("div",{className:"tags-container"},t.map(function(t){return r.a.createElement(Cb,{selected:e.props.tags[t],onClick:function(t){return e.props.onClickTag(t)},tag:t})})))}}]),t}(a.Component),wb=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props.selectedInstrumentTypes[this.props.type]?"tag selected":"tag";return r.a.createElement("div",{className:t,onClick:function(){return e.props.onClick(e.props.type)}},_o[this.props.type])}}]),t}(a.Component),Cb=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props.selected?"tag selected":"tag";return r.a.createElement("div",{className:t,onClick:function(){return e.props.onClick(e.props.tag)}},this.props.tag)}}]),t}(a.Component),Pb=Ob,Tb=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n.onClickDone=n.onClickDone.bind(Object(p.a)(n)),n.onClickCancel=n.onClickCancel.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickDone",value:function(){this.props.onDone(this.props.selectedFolder)}},{key:"onClickCancel",value:function(){this.props.onDone(void 0)}},{key:"newFolder",value:function(){this.props.selectedFolder?this.props.setSelectedFolder(this.props.selectedFolder.newFolder()):this.props.setSelectedFolder(R.a.folders.root.newFolder()),this.props.setHasChangesToFolders(!0)}},{key:"deleteFolder",value:function(){this.props.selectedFolder&&(this.props.selectedFolder.delete(),this.props.setSelectedFolder(this.props.selectedFolder.parent),this.props.setHasChangesToFolders(!0))}},{key:"renameFolder",value:function(){if(this.props.selectedFolder){var e=this.props.selectedFolder;e.name=void 0,this.props.setSelectedFolder(void 0),this.props.setSelectedFolder(e),this.props.setHasChangesToFolders(!0)}}},{key:"render",value:function(){var e=this;return r.a.createElement(D.a,{dialogClassName:"folder-modal preset-modal",show:this.props.show,onHide:this.onClickCancel},r.a.createElement(D.a.Header,{closeButton:!0},r.a.createElement(D.a.Title,null,"Choose Folder")),r.a.createElement(D.a.Body,null,r.a.createElement(vb,{sequencerEngine:this.props.sequencerEngine,showItems:!0,onChooseFolder:function(e){return[]},onChooseItem:function(e){return[]}}),r.a.createElement("div",{className:"folder-actions"},r.a.createElement("div",{onClick:function(){return e.newFolder()},className:"small-button gray-button"},"New Folder"),r.a.createElement("div",{onClick:function(){return e.renameFolder()},className:"small-button gray-button"},"Rename Folder"),r.a.createElement("div",{onClick:function(){return e.deleteFolder()},className:"small-button gray-button"},"Delete Folder"))),r.a.createElement(D.a.Footer,null,r.a.createElement(A.b,{variant:"secondary",onClick:this.onClickDone},"Done"),r.a.createElement(A.b,{variant:"primary",onClick:this.onClickCancel},"Cancel")))}}]),t}(a.Component),jb=Object(y.b)(function(e){return{selectedFolder:e.presets.selectedFolder}},function(e){return{setSelectedFolder:function(t){return e(Object(w.Lc)(t))},setHasChangesToFolders:function(t){return e(Object(w.Cb)(t))}}})(Tb),xb=(n(2335),"LIST"),Nb=R.a.presets,qb=new Vh,Mb=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={start:0,total:0,presetsToDisplay:[],showModal:!1,presetToLoad:void 0,tags:{},instrumentTypes:{},presetToMoveToFolder:void 0,viewBy:xb},n.getPresets(),n.getTotalPresets(),n.getAllTags(),n.onClose=n.onClose.bind(Object(p.a)(n)),n.loadWithLFOs=n.loadWithLFOs.bind(Object(p.a)(n)),n.loadWithoutLFOs=n.loadWithoutLFOs.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.guildId!==e.guildId&&(qb.clear(),this.getPresets(0,e.guildId),this.getAllTags(e.guildId)),!0}},{key:"onSelectViewBy",value:function(e){this.setState({viewBy:e})}},{key:"onChoseFolder",value:function(e){if(void 0!==e){var t=new gb.a(this.state.presetToMoveToFolder.title,this.state.presetToMoveToFolder.contentHash);e.addItem(t),this.props.setHasChangesToFolders(!0),this.setState({presetToMoveToFolder:void 0})}else this.setState({presetToMoveToFolder:void 0})}},{key:"onMoveToFolder",value:function(e){this.setState({presetToMoveToFolder:e})}},{key:"onClickInstrumentType",value:function(e){e in this.state.instrumentTypes?this.state.instrumentTypes[e]=!this.state.instrumentTypes[e]:this.state.instrumentTypes[e]=!0,this.state.start=0,this.getPresets(),this.getAllTags(),this.setState(this.state)}},{key:"onNewFolder",value:function(){var e=this.props.selectedFolder||R.a.folders.root;this.props.setSelectedFolder(e.newFolder()),this.setState(this.state)}},{key:"backupPresets",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:B.a.getJson("QmRJKhPwvNfzupgqBsVxvTH27PiNEijtqcP78kqtFRqcru").then(function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r,s,i;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=v.a.keys(t);case 1:if((e.t1=e.t0()).done){e.next=19;break}if(n=e.t1.value,t[n],null===t[n].contentHash&&(t[n].contentHash=t[n].previousHash),null!==t[n].contentHash){e.next=7;break}return e.abrupt("continue",1);case 7:return e.next=9,B.a.getJson(t[n].contentHash);case 9:if(a=e.sent,void 0!==(r=a.trackParameters)){e.next=13;break}return e.abrupt("continue",1);case 13:s="SAMPLER",i=void 0,r.instrument?s=r.instrument.instrumentType:i=Object.keys(r.samplers)[0],Nb.newPreset(t[n].contentHash,t[n].title,i,s),e.next=1;break;case 19:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"onClose",value:function(){this.setState({showModal:!1})}},{key:"saveProjectAsPreset",value:function(){this.props.sequencerEngine.saveProjectAsPreset()}},{key:"loadWithLFOs",value:function(){var e=this;this.setState({showModal:!1}),this.state.presetToLoad?(console.log("presetToLoad = ",this.state.presetToLoad),this.props.sequencerEngine.loadPreset(this.state.presetToLoad,!0)):this.state.folderToLoad.getAllItems().forEach(function(t){return e.props.sequencerEngine.loadPreset(t.contentHash,!0)})}},{key:"loadWithoutLFOs",value:function(){var e=this;this.setState({showModal:!1}),this.state.presetToLoad?this.props.sequencerEngine.loadPreset(this.state.presetToLoad,!1):this.state.folderToLoad.getAllItems().forEach(function(t){return e.props.sequencerEngine.loadPreset(t.contentHash,!1)})}},{key:"getPresets",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r,s,i,o=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:this.state.start,n=o.length>1&&void 0!==o[1]?o[1]:this.props.guildId,a={instrumentTypes:Object(X.a)({},this.state.instrumentTypes),tags:Object(X.a)({},this.state.tags)},e.next=5,qb.getPaginatedPresets(a,t,20,n);case 5:r=e.sent,s=this.reduceResults(r),i=this.getPresetsToDisplay(r,s),this.setState({presetsToDisplay:i,start:t});case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"filterPresets",value:function(){var e=Object(g.a)(v.a.mark(function e(t){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isFilterEmpty()){e.next=2;break}return e.abrupt("return",t);case 2:return e.next=4,Nb.filterPresets(t,{instrumentTypes:this.state.instrumentTypes});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getFilter",value:function(){return{instrumentTypes:this.state.instrumentTypes,tags:this.state.tags}}},{key:"getPresetsToDisplay",value:function(e,t){var n=[];for(var a in e){var r=e[a];r.contentHash in t&&n.push(Object(X.a)({},r,{name:r.title,edits:t[r.contentHash].length-0}))}return n}},{key:"reduceResults",value:function(e){var t={};for(var n in e){var a=e[n];t[a.contentHash]=[a]}for(var r in e){var s=e[r],i=s.previousHash;null!==i&&(i in t&&(t[i].push(s),t[s.contentHash]=t[i],delete t[i]))}return t}},{key:"getTotalPresets",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Nb.getTotalPresets();case 2:n=e.sent,this.setState({total:n});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onClickNext",value:function(){var e=this.state.start+20;this.getPresets(e)}},{key:"onClickPrevious",value:function(){var e=this.state.start-20;this.getPresets(e)}},{key:"testPreset",value:function(e){}},{key:"onChoosePreset",value:function(e){this.setState({showModal:!0,presetToLoad:e})}},{key:"onChooseFolder",value:function(e){this.setState({showModal:!0,folderToLoad:e})}},{key:"getAllTags",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r=this,s=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:this.props.guildId,e.next=3,Nb.getAllTags(this.getFilter(),t);case 3:n=e.sent,a={},n.forEach(function(e){return a[e]=r.state.tags[e]||!1}),this.setState({tags:a});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onClickTag",value:function(e){var t=Object(X.a)({},this.state.tags);t[e]=!t[e],this.state.tags=t,this.state.start=0,this.getPresets(),t[e]||this.getAllTags(),this.setState({tags:t})}},{key:"searchPresets",value:function(){var e=this;Object.keys(this.state.tags).filter(function(t){return e.state.tags[t]})}},{key:"syncFolders",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.a.folders.syncFolders();case 2:this.props.setHasChangesToFolders(!1);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e,t=this;return r.a.createElement("div",{className:"palette-container"},r.a.createElement("div",{className:"preset-header-container"},r.a.createElement("div",{onClick:function(){return t.saveProjectAsPreset()},className:"save-project-preset-button common-button pink-button"},"SAVE PROJECT AS PRESET")),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement("div",{className:"preset-search-container"},r.a.createElement(Pb,{onClickTag:function(e){return t.onClickTag(e)},tags:this.state.tags,instrumentTypes:this.state.instrumentTypes,onClickInstrumentType:function(e){return t.onClickInstrumentType(e)}})),r.a.createElement(jb,{sequencerEngine:this.props.sequencerEngine,onDone:function(e){return t.onChoseFolder(e)},show:void 0!==this.state.presetToMoveToFolder}),r.a.createElement(Bg,{ethereum:R.a,presets:Nb,preset:this.state.presetToLoad,show:this.state.showModal,onClose:this.onClose,onClickYes:this.loadWithLFOs,onClickNo:this.loadWithoutLFOs}),r.a.createElement(O,{condition:this.props.hasChangesToFolders},r.a.createElement("div",{onClick:function(){return t.syncFolders()},className:" pink-button small-button"},"SAVE CHANGES")),r.a.createElement("div",{className:"page-size-chooser-container"},r.a.createElement(pp.a,{className:"page-size-chooser-dropdown",options:Db,onChange:function(e){return t.onSelectViewBy(e.value)},value:(e=this.state.viewBy,Db.filter(function(t){return t.value===e})[0]),placeholder:"Select a resolution"})),r.a.createElement(O,{condition:this.state.viewBy===xb},r.a.createElement(Hv,{start:this.state.start,total:this.state.total,pageSize:20,onClickNext:function(){return t.onClickNext()},onClickPrevious:function(){return t.onClickPrevious()}}),this.state.presetsToDisplay.map(function(e,n){return r.a.createElement(Sb,{odd:n%2===1,onClickName:function(e){return t.filterByUser(e)},ethereum:R.a,key:"preset-"+n,presets:Nb,onMoveToFolder:function(){return t.onMoveToFolder(e)},onClick:function(){return t.onChoosePreset(e)},preset:e})})),r.a.createElement(O,{condition:"FOLDERS"===this.state.viewBy},r.a.createElement("div",{className:"preset-folders"},r.a.createElement("div",{className:"header"},r.a.createElement("div",{onClick:function(){return t.onNewFolder()},className:"folder-button small-button gray-button"},"New Folder"),r.a.createElement("div",{className:"folder-button small-button gray-button"},"Rename"),r.a.createElement(O,{condition:this.props.hasChangesToFolders},r.a.createElement("div",{onClick:function(){return t.syncFolders()},className:" pink-button small-button"},"SAVE CHANGES"))),r.a.createElement(vb,{sequencerEngine:this.props.sequencerEngine,onTestItem:function(e){return t.testPreset(e)},onChooseItem:function(e){return t.onChoosePreset(e)},onChooseFolder:function(e){return t.onChooseFolder(e)},showItems:!0}))))}}]),t}(a.Component),Db=[{label:"List",value:xb},{label:"Folders",value:"FOLDERS"}];var Ab=Object(y.b)(function(e){return{guildId:e.guilds.selectedGuild?e.guilds.selectedGuild.guildId:0,hasChangesToFolders:e.presets.hasChangesToFolders,selectedFolder:e.presets.selectedFolder}},function(e){return{setHasChangesToFolders:function(t){return e(Object(w.Cb)(t))},setSelectedFolder:function(t){return e(Object(w.Lc)(t))}}})(Mb),Rb=n(62),Ib=tg.k.SEQUENCE_METADATA.options.address,Lb={},Fb={},Vb={},Bb=new(function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,[{key:"tagSequence",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a,r=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.length>2&&void 0!==r[2]?r[2]:0,e.abrupt("return",new Rb.a(tg.i,"tagSequence",[Object(ps.b)(t),Object(ps.a)(n),a]).execute());case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"starSequence",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:0,e.abrupt("return",new Rb.a(tg.i,"starSequence",[Object(ps.b)(t),n]).execute());case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"favoriteSequence",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:0,e.abrupt("return",new Rb.a(tg.i,"favoriteSequence",[Object(ps.b)(t),n]).execute());case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"unstarSequence",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:0,e.abrupt("return",new Rb.a(tg.i,"unstarSequence",[Object(ps.b)(t),n]).execute());case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"unfavoriteSequence",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:0,e.abrupt("return",new Rb.a(tg.i,"unfavoriteSequence",[Object(ps.b)(t),n]).execute());case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"isSequenceFavorited",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a,r,s,i;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=n.toLowerCase(),!((a=t+n)in Lb)){e.next=4;break}return e.abrupt("return",Lb[a]);case 4:return e.next=6,new ti.a(Ib).from(ei.L).select("ipfsHash").where("ipfsHash",t).where("user",n).executeQuery();case 6:return r=e.sent,e.next=9,new ti.a(Ib).from(ei.O).select("ipfsHash").where("ipfsHash",t).where("user",n).executeQuery();case 9:return s=e.sent,i=r.length-s.length,Lb[a]=i>0,e.abrupt("return",Lb[a]);case 13:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"isSequenceStarred",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in Fb)){e.next=2;break}return e.abrupt("return",Fb[t]);case 2:return e.next=4,new ti.a(Ib).from(ei.M).select("ipfsHash").where("ipfsHash",t).executeQuery();case 4:return n=e.sent,e.next=7,new ti.a(Ib).from(ei.P).select("ipfsHash").where("ipfsHash",t).executeQuery();case 7:return a=e.sent,Fb[t]=n.length-a.length>0,e.abrupt("return",Fb[t]);case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getTags",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in Vb)){e.next=2;break}return e.abrupt("return",Vb[t]);case 2:return e.next=4,new ti.a(Ib).from(ei.N).select("tag").where("ipfsHash",t).executeQuery();case 4:return n=e.sent,Vb[t]=n.map(function(e){return e.tag}),e.abrupt("return",Vb[t]);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getStarredSequences",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r,s,i,o,c=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c.length>0&&void 0!==c[0]?c[0]:0,e.next=3,new ti.a(Ib).from(ei.M).select("ipfsHash").where("guildId",0).executeQuery();case 3:return t=e.sent,e.next=6,new ti.a(Ib).from(ei.P).select("ipfsHash").where("guildId",0).executeQuery();case 6:for(r in n=e.sent,a={},t)(s=t[r]).ipfsHash in a||(a[s.ipfsHash]=0),a[s.ipfsHash]++;for(i in n)(o=n[i]).ipfsHash in a||(a[o.ipfsHash]=0),a[o.ipfsHash]--;return e.abrupt("return",Object.keys(a).filter(function(e){return a[e]>0}));case 11:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"getFavoritedSequences",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r,s,i,o,c,u,l=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.length>1&&void 0!==l[1]?l[1]:0,t=t.toLowerCase(),e.next=4,new ti.a(Ib).from(ei.L).select("ipfsHash").where("user",t).where("guildId",n).executeQuery();case 4:return a=e.sent,e.next=7,new ti.a(Ib).from(ei.O).select("ipfsHash").where("user",t).executeQuery();case 7:for(i in r=e.sent,s={},a)(o=a[i]).ipfsHash in s||(s[o.ipfsHash]=0),s[o.ipfsHash]++;for(c in r)(u=r[c]).ipfsHash in s||(s[u.ipfsHash]=0),s[u.ipfsHash]--;return e.abrupt("return",Object.keys(s).filter(function(e){return s[e]>0}));case 12:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getFavorites",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r,s,i,o,c,u,l,p,h,d;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new ti.a(Ib).from(ei.L).select("ipfsHash").select("user").where("ipfsHash",t).executeQuery();case 2:return n=e.sent,e.next=5,new ti.a(Ib).from(ei.O).select("ipfsHash").select("user").where("ipfsHash",t).executeQuery();case 5:for(i in a=e.sent,r={},s={},n)o=n[i],(c=n[i].user)in r||(r[c]=0,s[c]=[]),r[c]++,s[c].push(o);for(u in a)a[u],(l=a[u].user)in r||(r[l]=0),r[l]--;p=[],e.t0=v.a.keys(r);case 12:if((e.t1=e.t0()).done){e.next=20;break}if(h=e.t1.value,!(r[h]<=0)){e.next=16;break}return e.abrupt("continue",12);case 16:d=s[h],p.push(d[d.length-1]),e.next=12;break;case 20:return e.abrupt("return",p);case 21:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}]),e}());function Ub(e){return Hb.apply(this,arguments)}function Hb(){return(Hb=Object(g.a)(v.a.mark(function e(t){var n,a,r,s,i,o,c=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(c.length>1&&void 0!==c[1])||c[1],void 0!==t){e.next=3;break}return e.abrupt("return",void 0);case 3:return e.next=5,R.a.messaging.getMessages(t);case 5:return a=e.sent,e.next=8,R.a.tokenizedSequences.getNextSequences(t);case 8:return r=e.sent,e.next=11,R.a.tokenizedSequences.getPreviousSequences(t);case 11:return s=e.sent,e.next=14,Bb.getFavorites(t);case 14:return i=(i=e.sent).map(function(e){return Object(X.a)({},e,{isFavorite:!0})}),(o=n?[].concat(Object(ge.a)(r),Object(ge.a)(s),Object(ge.a)(i),Object(ge.a)(a)):[].concat(Object(ge.a)(a),Object(ge.a)(i))).sort(function(e,t){return t.blockNumber-e.blockNumber}),e.abrupt("return",o);case 19:case"end":return e.stop()}},e)}))).apply(this,arguments)}var Jb=n(437),Gb=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={commentText:"",commentSent:!1,notes:[],start:0,messageSent:void 0},n.getNotes(),n.watchForNotes(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"watchForNotes",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t=this;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.props.sequence.id){e.next=2;break}return e.abrupt("return");case 2:R.a.messaging.watchForNewMessages(this.props.sequence.id,this.props.userId,function(e){return t.onNewNote(e)});case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onNewNote",value:function(e){e.messageHash===this.state.messageSent&&this.setState({messageSent:void 0}),this.setState({notes:[e].concat(Object(ge.a)(this.state.notes))})}},{key:"getNotes",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ub(this.props.sequence.id);case 2:if(void 0!==(t=e.sent)){e.next=5;break}return e.abrupt("return");case 5:this.setState({notes:t});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"sendComment",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.sequence.id,n=this.props.userId,a=this.state.commentText,r=Jb.b,e.next=6,R.a.messaging.sendMessage(n,t,r,a);case 6:s=e.sent,this.setState({commentText:"",commentSent:!0,messageSent:s});case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"needsPagination",value:function(){return this.notes.length>10}},{key:"getPaginatedNotes",value:function(){return this.notes.length>this.state.start+10?this.notes.slice(this.state.start,this.state.start+10):this.notes.slice(this.state.start)}},{key:"getPagination",value:function(){return r.a.createElement("div",{className:"pagination"})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"comments-container"},r.a.createElement(O,{condition:Ge.a.isLoggedIn()},r.a.createElement(A.h,{className:"tag-sound-input"},r.a.createElement(A.g,{onChange:function(t){e.state.commentText=t.target.value,e.setState(e.state)},type:"textarea",value:this.state.commentText,placeholder:"Write a note",className:"comment-input-box"}),r.a.createElement(A.i,{addonType:"append"},r.a.createElement(A.b,{size:"sm",onClick:function(){return e.sendComment()},color:"secondary"},"Send")))),r.a.createElement(V.a,{sizeUnit:"px",size:10,color:"#f92360",loading:void 0!==this.state.messageSent}),this.state.notes.map(function(e,t){return r.a.createElement(zb,{odd:t%2==1,note:e})}),r.a.createElement("div",{onClick:this.props.onHide,className:"common-button hide-notes-button"},"Hide Notes"))}}]),t}(a.Component),zb=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={messageText:"",fromUser:e.note.fromUser,isFavorite:!1,date:""},n.getMessage(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.note!==e.note&&this.getMessage(e.note),!0}},{key:"getMessage",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r,s,i=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:this.props.note,n=t.fromUser?t.fromUser:t.user,e.next=4,R.a.users.getUserName(n);case 4:return void 0!==(a=e.sent)&&this.setState({fromUser:a}),e.next=8,R.a.getBlockDate(t.blockNumber);case 8:if(r=e.sent,this.setState({date:void 0===r?"":r.toLocaleString()}),!t.isPrevious){e.next=15;break}return this.setState({newSequence:t.newSequence,messageText:"Made an edit ("+t.title+")"}),e.abrupt("return");case 15:if(!t.newSequence){e.next=20;break}return this.setState({newSequence:t.newSequence,messageText:"Made an edit ("+t.title+")"}),e.abrupt("return");case 20:if(!t.isFavorite){e.next=23;break}return this.setState({isFavorite:!0,messageText:"Favorited"}),e.abrupt("return");case 23:return e.next=25,B.a.getJson(t.messageHash,!0);case 25:s=e.sent,this.setState({messageText:s.content});case 27:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onClickText",value:function(){this.state.newSequence&&window.open("/create/"+this.state.newSequence,"_blank").focus()}},{key:"onClickUser",value:function(){window.open("/user/"+this.state.fromUser,"_blank").focus()}},{key:"render",value:function(){var e=this,t="sequence-note-container";return this.props.odd&&(t+=" odd"),r.a.createElement("div",{className:t},r.a.createElement("div",{onClick:function(){return e.onClickUser()},className:"sequence-note-from"},this.state.fromUser,":"),r.a.createElement("div",{onClick:function(){return e.onClickText()},className:"sequence-note-text"},r.a.createElement(O,{condition:!this.state.isFavorite},this.state.messageText),r.a.createElement(O,{condition:this.state.isFavorite},r.a.createElement("div",{className:"heart favorited"}))),r.a.createElement("div",{className:"note-date"},this.state.date))}}]),t}(a.Component),_b=Gb,Wb=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n.getUserId(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getUserId",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,R.a.getUser();case 3:e.t1=e.sent,e.t2={userId:e.t1},e.t0.setState.call(e.t0,e.t2);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){if(void 0===this.state.userId)return r.a.createElement("div",null);var e={id:this.props.sequencerEngine.getSequenceId()};return r.a.createElement("div",null,r.a.createElement(_b,{userId:this.state.userId,sequence:e}))}}]),t}(a.Component),Kb=(new U.a,function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e="pad";return this.props.triggering&&(e+=" flashit"),this.props.mini&&(e+=" mini"),r.a.createElement("div",{style:this.getStyle(),className:e},this.props.value)}}]),t}(Yl)),Yb=Object(y.b)(function(e,t){var n=e.keyboard.padMappings[t.value],a=void 0===n?void 0:e.tracks.triggers[n.trackNumber];return{triggering:void 0!==a&&a[n.sliceNumber],keyMapping:n}},null)(Kb),Qb=(new U.a,[["C1","C#1","D1","D#1"],["G#0","A0","A#0","B0"],["E0","F0","F#0","G0"],["C0","C#0","D0","D#0"]]),Xb=function(e){function t(e){var n;Object(o.a)(this,t);var a=0;if((n=Object(u.a)(this,Object(l.a)(t).call(this,e))).props.lastMidiKeyMapped){var r=bs.a.fromString(n.props.lastMidiKeyMapped,!1);console.log("last midi key mapped = "+r),a=parseFloat(r.octave)}return n.state={octave:a},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickPrevious",value:function(){this.setState({octave:this.state.octave-1})}},{key:"onClickNext",value:function(){this.setState({octave:parseFloat(this.state.octave)+1})}},{key:"getPads",value:function(){var e=this,t=[].concat(Qb);return t=t.map(function(e){return e.map(function(e){return bs.a.fromString(e,!1)})}),console.log("get pads called with octave = "+this.state.octave),t.map(function(t){return t.forEach(function(t){return t.octave=parseFloat(t.octave)+parseFloat(e.state.octave)})}),t.map(function(e){return e.map(function(e){return e.toString()})})}},{key:"render",value:function(){var e=this,t=this.getPads(),n="pads ";return this.props.mini&&(n+=" mini"),r.a.createElement("div",{className:n},r.a.createElement("div",{className:"pads-row"},t[0].map(function(t){return r.a.createElement(Yb,{mini:e.props.mini,value:t,keyboardEngine:e.props.keyboardEngine,sequencerEngine:e.props.sequencerEngine,trackNumber:e.props.trackNumber})})),r.a.createElement("div",{className:"pads-row"},t[1].map(function(t){return r.a.createElement(Yb,{mini:e.props.mini,value:t,sequencerEngine:e.props.sequencerEngine,keyboardEngine:e.props.keyboardEngine,trackNumber:e.props.trackNumber})})),r.a.createElement("div",{className:"pads-row"},t[2].map(function(t){return r.a.createElement(Yb,{mini:e.props.mini,value:t,sequencerEngine:e.props.sequencerEngine,keyboardEngine:e.props.keyboardEngine,trackNumber:e.props.trackNumber})})),r.a.createElement("div",{className:"pads-row"},t[3].map(function(t){return r.a.createElement(Yb,{mini:e.props.mini,value:t,sequencerEngine:e.props.sequencerEngine,keyboardEngine:e.props.keyboardEngine,trackNumber:e.props.trackNumber})})),r.a.createElement("div",{className:"pads-pagination-container"},r.a.createElement("div",{onClick:function(){return e.onClickPrevious()},className:"pads-pagination-button"},"<"),r.a.createElement("div",{onClick:function(){return e.onClickNext()},className:"pads-pagination-button"},">")))}}]),t}(a.Component),Zb=Object(y.b)(function(e){return{lastMidiKeyMapped:e.keyboard.lastMidiKeyMapped}},null)(Xb),$b=(n(2336),R.a.presets),ey=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={dropdownOpen:!1,showPresetModal:!1},n.onClosePresetModal=n.onClosePresetModal.bind(Object(p.a)(n)),n.loadWithLFOs=n.loadWithLFOs.bind(Object(p.a)(n)),n.loadWithoutLFOs=n.loadWithoutLFOs.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"toggleDropdown",value:function(){this.setState({dropdownOpen:!this.state.dropdownOpen})}},{key:"addSound",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n,a,r,s){var i;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.sequencerEngine.tracks.length,n&&this.sequencerEngine.tracks.length>0?(i=null==this.sequencerEngine.cursor.track?0:this.sequencerEngine.cursor.track,this.sequencerEngine.addSound(t,i,void 0,s)):this.sequencerEngine.addSound(t,void 0,a,s);case 2:case"end":return e.stop()}},e,this)}));return function(t,n,a,r,s){return e.apply(this,arguments)}}()},{key:"auditionSound",value:function(e){var t=null==this.sequencerEngine.cursor.track?0:this.sequencerEngine.cursor.track;this.sequencerEngine.auditionSound(e,t),this.props.setSampleAuditioning(e)}},{key:"showSoundsSelectorView",value:function(){this.props.setSelectorMode(!0),this.props.setSidebarViewMode(qv)}},{key:"isShowingSoundsPane",value:function(){return!this.props.sidebarCollapsed&&(this.props.showSelectorMode||this.props.sidebarViewMode!==qv)}},{key:"showSequences",value:function(){this.props.setSidebarViewMode("SEQUENCES")}},{key:"showExternal",value:function(){this.props.setSidebarViewMode("EXTERNAL")}},{key:"showPresets",value:function(){this.props.setSidebarViewMode("PRESETS")}},{key:"onClickInstrumentsButton",value:function(){this.props.setSidebarViewMode("INSTRUMENTS")}},{key:"onClickAddAudioTrackButton",value:function(){this.sequencerEngine.addAudioTrack(),this.setState(this.state)}},{key:"toggleCollapse",value:function(){this.props.setSidebarCollapsed(!this.props.sidebarCollapsed)}},{key:"onChooseItem",value:function(e){this.setState({showPresetModal:!0,presetToLoad:e})}},{key:"onChooseFolder",value:function(e){this.setState({showPresetModal:!0,folderToLoad:e})}},{key:"onClosePresetModal",value:function(){this.setState({showPresetModal:!1})}},{key:"loadWithLFOs",value:function(){var e=this;this.setState({showPresetModal:!1}),this.state.presetToLoad?this.props.sequencerEngine.loadPreset(this.state.presetToLoad,!0):this.state.folderToLoad.getAllItems().forEach(function(t){return e.props.sequencerEngine.loadPreset(t,!0)})}},{key:"loadWithoutLFOs",value:function(){var e=this;this.setState({showPresetModal:!1}),this.state.presetToLoad?this.props.sequencerEngine.loadPreset(this.state.presetToLoad,!1):this.state.folderToLoad.getAllItems().forEach(function(t){return e.props.sequencerEngine.loadPreset(t,!1)})}},{key:"render",value:function(){var e=this,t=this.props.viewMode!==lo&&this.props.viewMode!==po,n="";this.props.sidebarViewMode===qv&&this.props.showSelectorMode&&(n=r.a.createElement(Vg,{ethereumSearcher:this.props.ethereumSearcher,sequencerEngine:this.sequencerEngine,onAudition:function(t){return e.auditionSound(t)},onAddSound:function(t,n,a,r,s){return e.addSound(t,n,a,r,s)}}));var a="";"INSTRUMENTS"===this.props.sidebarViewMode&&(a=r.a.createElement(ab,{sequencerEngine:this.sequencerEngine}));var s="";"SEQUENCES"===this.props.sidebarViewMode&&(s=r.a.createElement(lb,{sequencerEngine:this.sequencerEngine}));var i="";"PRESETS"===this.props.sidebarViewMode&&(i=r.a.createElement(Ab,{sequencerEngine:this.sequencerEngine}));var o="";"NOTES"===this.props.sidebarViewMode&&(o=r.a.createElement(Wb,{sequencerEngine:this.sequencerEngine}));var c=Math.ceil((window.innerHeight-300)/125),u=window.innerHeight>1001||this.sequencerEngine.tracks.length<c,l=this.isShowingSoundsPane()?-200:-500,p=this.isShowingSoundsPane()?40:-100;this.props.hidePresets&&(l=300,p=-400);var h=this.props.zIndexHack?"z-index-hack":" ",d=this.props.sidebarCollapsed?"sounds-pane collapsed":this.isShowingSoundsPane()?"sounds-pane":"hide sounds-pane";this.isShowingSoundsPane()&&this.props.hidePresets&&(u=!0);var f=r.a.createElement("div",{className:"sidebar-container"},r.a.createElement("div",{className:d},r.a.createElement("div",{className:"sidebar-header"},r.a.createElement("div",{onClick:function(){return e.toggleCollapse()},className:"collapse-toggle"},this.props.sidebarCollapsed?r.a.createElement("div",{className:"arrow-down"}):r.a.createElement("div",{className:"arrow-right"}))),r.a.createElement(O,{condition:!this.props.sidebarCollapsed},r.a.createElement(O,{condition:this.isShowingSoundsPane()},r.a.createElement("div",{className:"sound-toolbar"},r.a.createElement(Av,null))),r.a.createElement(O,{condition:!this.isShowingSoundsPane()},r.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("ADD_ALL_SOUNDS_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"sound-toolbar"},r.a.createElement(A.c,{show:this.state.dropdownOpen?"true":"false",isOpen:this.state.dropdownOpen,toggle:function(){return e.toggleDropdown()}},r.a.createElement(A.b,{onClick:function(){return e.showSoundsSelectorView()},id:"caret",color:"secondary"},r.a.createElement("span",{className:"huge"},"+")),r.a.createElement(A.f,{size:"sm",caret:!0,color:"secondary"}),r.a.createElement(A.e,null,r.a.createElement(A.d,{onClick:function(){return e.showSoundsSelectorView()},size:"sm"},"Sounds"),r.a.createElement(A.d,{onClick:function(){return e.onClickInstrumentsButton()},size:"sm"},"Instruments"),r.a.createElement(A.d,{onClick:function(){return e.onClickAddAudioTrackButton()},size:"sm"},"Audio Track"),r.a.createElement(A.d,{onClick:function(){return e.showPresets()},size:"sm"},"Presets"),r.a.createElement(A.d,{onClick:function(){return e.showSequences()},size:"sm"},"Sequences"))))),a,i,s,n,o,r.a.createElement(O,{condition:!this.isShowingSoundsPane()},r.a.createElement(Nv,{installation:this.props.hidePresets,selectedTrack:this.props.selectedTrack,sequencerEngine:this.sequencerEngine}),r.a.createElement(O,{condition:this.showMidiPads},r.a.createElement(Zb,{mini:!0,sequencerEngine:this.sequencerEngine,keyboardEngine:this.keyboardEngine})),r.a.createElement(Bg,{ethereum:R.a,presets:$b,preset:this.state.presetToLoad,show:this.state.showPresetModal,onClose:this.onClosePresetModal,onClickYes:this.loadWithLFOs,onClickNo:this.loadWithoutLFOs}),r.a.createElement(O,{condition:!this.props.hidePresets},r.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("PRESET_FOLDERS")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"preset-folders"},r.a.createElement(vb,{sequencerEngine:this.props.sequencerEngine,onTestItem:function(e){return[]},onChooseFolder:function(t){return e.onChooseFolder(t)},onChooseItem:function(t){return e.onChooseItem(t)},showItems:!0})))))));if(t||this.props.viewMode==po||this.props.isTrackFocused)return"";var m=this.props.sidebarCollapsed?"sidebar-holder-collapsed":this.isShowingSoundsPane()?"sidebar-holder-selector":"sidebar-holder";return r.a.createElement(Il.a,{className:h,stickyClassName:this.isShowingSoundsPane()?h:"sticky-keyboard "+h,holderProps:{id:m},disabled:u,mode:"bottom",positionRecheckInterval:20,boundaryElement:".main-area",hideOnBoundaryHit:!1,topOffset:l,bottomOffset:p},f)}},{key:"showMidiPads",get:function(){return void 0!==this.props.padMappings&&Object.keys(this.props.padMappings).length>0}},{key:"sequencerEngine",get:function(){return this.props.sequencerEngine}}]),t}(a.Component),ty=Object(y.b)(function(e){return{viewMode:e.sequencer.viewMode,showSelectorMode:e.sequencer.showSelectorMode,sidebarCollapsed:e.selector.sidebarCollapsed,sidebarViewMode:e.sequencer.sidebarViewMode,isTrackFocused:void 0!==e.sequencer.trackFocused,showPresets:e.sequencer.showPresets,zIndexHack:e.sequencer.zIndexHack,selectedTrack:e.mix.selectedTrack,padMappings:e.keyboard.padMappings}},function(e){return{setSamplePack:function(t){return e(Object(w.Bc)(t))},addSamplePack:function(t){return e(Object(w.a)(t))},setSelectorMode:function(t){return e(Object(w.bd)(t))},setSidebarViewMode:function(t){return e(Object(w.Gd)(t))},setSidebarCollapsed:function(t){return e(Object(w.Fd)(t))},setSampleAuditioning:function(t){return e(Object(w.zc)(t))},setContextualHelp:function(t){return e(Object(w.V)(t))}}})(ey),ny=n(440),ay=n.n(ny),ry=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={username:"",password:"",loginFailed:!1},n.onClickDone=n.onClickDone.bind(Object(p.a)(n)),n.onClickCancel=n.onClickCancel.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"handlePasswordChange",value:function(e){this.setState({password:e.target.value})}},{key:"onClickDone",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.props.signingUp){e.next=4;break}Ge.a.signUp(this.state.userName,this.state.password),e.next=10;break;case 4:return e.next=6,Ge.a.login(this.state.userName,this.state.password);case 6:if(e.sent){e.next=10;break}return this.setState({loginFailed:!0}),e.abrupt("return");case 10:this.setState({loginFailed:!1}),this.props.hide();case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onClickCancel",value:function(){this.props.hide()}},{key:"render",value:function(){var e=this;return r.a.createElement(D.a,{dialogClassName:"preset-modal",show:this.props.show,onHide:this.onClickCancel},r.a.createElement(D.a.Header,{closeButton:!0},r.a.createElement(D.a.Title,null,this.props.signingUp?"Sign Up":"Log In")),r.a.createElement(D.a.Body,null,r.a.createElement(O,{condition:this.state.loginFailed},"The username/password you entered was incorrect. Please try again."),r.a.createElement(A.h,null,r.a.createElement(A.g,{onChange:function(t){return e.setState({userName:t.target.value})},value:this.state.userName,placeholder:"Enter your username",className:"email-address-input"})),r.a.createElement(ay.a,{id:"password",name:"password",placeholder:"Enter password",value:this.state.password,onChange:this.handlePasswordChange.bind(this)})),r.a.createElement(D.a.Footer,null,r.a.createElement(A.b,{variant:"secondary",onClick:this.onClickDone},"Done"),r.a.createElement(A.b,{variant:"primary",onClick:this.onClickCancel},"Cancel")))}}]),t}(a.Component),sy=Object(y.b)(function(e){return{signingUp:e.sequencer.signingUp}},function(e){return{hide:function(t){return e(Object(w.qd)(!1))}}})(ry);function iy(e){window.addEventListener("dragenter",function(e){e.preventDefault(),e.dataTransfer.effectAllowed="none",e.dataTransfer.dropEffect="none"},!1),window.addEventListener("dragover",function(e){return e.preventDefault(),e.dataTransfer.effectAllowed="none",!1}),window.addEventListener("drop",function(){var t=Object(g.a)(v.a.mark(function t(n){var a;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),n.dataTransfer.effectAllowed="none",n.dataTransfer.dropEffect="none",n.dataTransfer.items)for(a=0;a<n.dataTransfer.items.length;a++)"file"===n.dataTransfer.items[a].kind&&oy(e,n.dataTransfer.items[a].getAsFile());else for(a=0;a<n.dataTransfer.files.length;a++);return t.abrupt("return",!1);case 5:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}function oy(e,t){var n=new FileReader;t.name.includes(".wav")?(n.readAsArrayBuffer(t),n.onloadend=Object(g.a)(v.a.mark(function a(){var r,s;return v.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,B.a.addArrayBuffer(n.result);case 2:return r=a.sent,s=new K.a(r),a.next=6,s.fetchAudio();case 6:s.name=t.name,e.recordingsToSave.push(s),e.addSound(s);case 9:case"end":return a.stop()}},a)}))):window.alert("Only accepts .wav files for now")}var cy=function(){function e(t,n,a,r,s){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;Object(o.a)(this,e),this.sliceNumber=0,this.recordedTriggers=n.map(function(e){return new Vo(e,0,a,r,s,i)}),this.transpose=t,this.tracks=n}return Object(c.a)(e,[{key:"record",value:function(e,t,n){var a=this;this.recordedTriggers.map(function(t,n){return t.record(e,a.tracks[n],a.transpose+a.tracks[n].trackData.transpose)})}}]),e}(),uy={a:0,w:1,s:2,e:3,d:4,f:5,t:6,g:7,y:8,h:9,u:10,j:11,k:12,o:13,l:14},ly=function(){function e(){Object(o.a)(this,e),this.octave=0}return Object(c.a)(e,[{key:"getTransposeForKey",value:function(e){var t=12*this.octave;return(e=e.toLowerCase())in uy?t+uy[e]:void 0}},{key:"upOctave",value:function(){this.octave<3&&this.octave++}},{key:"downOctave",value:function(){this.octave>-2&&this.octave--}}]),e}(),py=function(){function e(t,n){Object(o.a)(this,e),this.keyMappings={},this.midiMappings={},this.sequencerEngine=t,this.recordedMidiTriggers={},this.computerKeyboard=new ly,this.store=t.store}return Object(c.a)(e,[{key:"hasKeyMapping",value:function(e){return e in this.keyMappings}},{key:"deleteKeyMapping",value:function(e){delete this.keyMappings[e],this.sequencerEngine.store.dispatch(Object(w.Nb)(this.keyMappings))}},{key:"deleteTrack",value:function(e){this.keyMappings=this.deleteHelper(this.keyMappings,e),this.midiMappings=this.deleteMidiHelper(this.midiMappings,e),this.sequencerEngine.store.dispatch(Object(w.Nb)(this.keyMappings));var t=Object.keys(this.midiMappings)[0];this.sequencerEngine.store.dispatch(Object(w.dc)(this.midiMappings[t]))}},{key:"deleteMidiHelper",value:function(e,t){var n={};for(var a in e)n[a]=this.deleteHelper(e[a],t);return n}},{key:"deleteHelper",value:function(e,t){var n={};for(var a in e){var r=e[a];t>=r.trackNumber?n[a]=r:t<r.trackNumber&&(r.trackNumber--,n[a]=r)}return n}},{key:"hasMidiMappings",value:function(){return Object.keys(this.midiMappings).length>0}},{key:"onKeyDown",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;e=e.toLowerCase(),this.handleOctaves(e);var i=a?bs.a.fromString(e).getTranspose():this.computerKeyboard.getTransposeForKey(e),o=i%12;o<0&&(o=12+o),this.store.dispatch(Object(w.Qb)(i)),this.onNoteDown(e,i,t,n,r,a,s)}},{key:"onNoteDown",value:function(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(0!==this.sequencerEngine.tracks.length){var o=this.getToggledTracks(r,s);if(o.length>0){if(void 0===t)return;o.filter(function(e){return!e.rolling}).forEach(function(e){var n=new ot;n.copyFrom(e.trackData),n.slice=0,n.duration=null,n.transpose=t+e.trackData.transpose,n.velocity=i,e.midiEffects.liveInputTrigger(n)})}else e in this.keyMappings?this.keyMappings[e].trigger(this.sequencerEngine,n):t in this.keyMappings?this.keyMappings[t].trigger(this.sequencerEngine,n):r in this.midiMappings&&e.toUpperCase()in this.midiMappings[r]?this.midiMappings[r][e.toUpperCase()].trigger(this.sequencerEngine,n):void 0===r?this.alreadyMapped(this.sequencerEngine.cursor.track,0)||(this.map(e,this.sequencerEngine.cursor.track,0),this.onNoteDown(e,t,n,a,r)):this.sequencerEngine.midi.getInputMode(r)===Ms&&(this.alreadyMidiMapped(r,this.sequencerEngine.cursor.track,0)||(this.midiMap(r,e,this.sequencerEngine.cursor.track,0),this.onNoteDown(e,t,n,a,r)))}}},{key:"handleOctaves",value:function(e){"z"===e?this.computerKeyboard.downOctave():"x"===e&&this.computerKeyboard.upOctave()}},{key:"getToggledTracks",value:function(e,t){var n=this.sequencerEngine.tracks.filter(function(e){return e.isEnabled});for(var a in this.sequencerEngine.subSequences){var r=this.sequencerEngine.subSequences[a];r.isTrack&&r!==this.sequencerEngine.currentSubSequence&&(n=[].concat(Object(ge.a)(n),Object(ge.a)(r.tracks.filter(function(e){return e.isEnabled}))))}return n=this.sequencerEngine.midi.getInputMode(e)===Ms?[]:n.filter(function(n){return n.midiInputs.accepts(t,e)})}},{key:"recordHit",value:function(e,t,n,a,r,s){var i=this.getToggledTracks(r,t);if(!(i.length>0&&"KEYBOARD"===this.sequencerEngine.midi.getInputMode(r))){if(e in this.keyMappings){var o=this.keyMappings[e];return new Vo(this.sequencerEngine.tracks[o.trackNumber],o.sliceNumber,n,this.sequencerEngine,a)}if(r in this.midiMappings&&e in this.midiMappings[r]){o=this.midiMappings[r][e];return new Vo(this.sequencerEngine.tracks[o.trackNumber],o.sliceNumber,n,this.sequencerEngine,a)}return null}var c=t?bs.a.fromString(e).getTranspose():this.computerKeyboard.getTransposeForKey(e);if(void 0!==c)return new cy(c,i,n,this.sequencerEngine,a,s)}},{key:"getRecordedMidiTrigger",value:function(e,t,n){return new Vo(this.sequencerEngine.tracks[e.trackNumber],e.sliceNumber,t,this.sequencerEngine,n)}},{key:"alreadyMidiMapped",value:function(e,t,n){if(void 0===this.midiMappings[e])return!1;for(var a in this.midiMappings[e]){var r=this.midiMappings[e][a];if(r.trackNumber===t&&r.sliceNumber===n)return!0}return!1}},{key:"alreadyMapped",value:function(e,t){for(var n in this.keyMappings){var a=this.keyMappings[n];if(a.trackNumber===e&&a.sliceNumber===t)return!0}return!1}},{key:"map",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;void 0!==this.sequencerEngine.tracks[t]&&(this.keyMappings[e]=new hy(e,t,n),this.sequencerEngine.store.dispatch(Object(w.Nb)(this.keyMappings)))}},{key:"midiMap",value:function(e,t,n,a){t=t.toUpperCase();var r=new hy(t,n,a);e in this.midiMappings||(this.midiMappings[e]={}),this.midiMappings[e][t]=r;var s={};for(var i in this.midiMappings){var o=this.midiMappings[i];for(var c in o)s[c]=o[c]}this.midi.getInputMode(e)===Ms&&this.store.dispatch(Object(w.dc)(s)),this.store.dispatch(Object(w.Pb)(t))}},{key:"getMappings",value:function(){return this.keyMappings}},{key:"getMidiMappings",value:function(){return this.midiMappings}},{key:"deleteMappingsForTrack",value:function(e){for(var t in this.keyMappings)this.keyMappings[t].trackNumber===e&&delete this.keyMappings[t];for(var n in this.midiMappings){var a=this.midiMappings[n];for(var r in a)a[r].trackNumber==e&&delete a[r]}}},{key:"midi",get:function(){return this.sequencerEngine.midi}}]),e}(),hy=function(){function e(t,n,a){Object(o.a)(this,e),this.key=t,this.trackNumber=n,this.sliceNumber=a}return Object(c.a)(e,[{key:"trigger",value:function(e,t){if(!e.tracks[this.trackNumber].rolling){var n=e.tracks[this.trackNumber],a=new ot;a.copyFrom(n.trackData),a.slice=this.sliceNumber,a.duration=null,n.midiEffects.liveInputTrigger(a)}}}]),e}(),dy=py,fy=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={password:"",incorrectPassword:!1,needsToSetPassword:!1,userName:void 0},n.onClickDone=n.onClickDone.bind(Object(p.a)(n)),n.onClickCancel=n.onClickCancel.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){return e.show&&e.show!==this.props.show&&(this.getNeedsToSetPassword(),this.getUserName()),!0}},{key:"getUserName",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,Ge.a.getUserName();case 3:e.t1=e.sent,e.t2={userName:e.t1},e.t0.setState.call(e.t0,e.t2);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getNeedsToSetPassword",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.a.encryption.getPublicKey();case 2:t=e.sent,console.log("ethereum.getPublicKey() returned = "),console.log(t),t&&this.setState({needsToSetPassword:!0});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(e){return e.show!==this.props.show&&(console.log("password input = "),console.log(this.input.passwordInput),this.input.passwordInput.focus()),!0}},{key:"onClickDone",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.crypto.isCorrectPassword(this.state.password);case 2:if(e.sent){e.next=7;break}return this.setState({incorrectPassword:!0}),e.abrupt("return");case 7:this.setState({incorrectPassword:!1});case 8:this.props.setShowPasswordModal(!1),console.log("passwordModalCallback("+this.state.password+")"),this.props.passwordModalCallback(this.state.password);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onClickCancel",value:function(){this.props.passwordModalCallback(void 0),this.props.setShowPasswordModal(!1)}},{key:"handleChange",value:function(e){this.setState({password:e.target.value})}},{key:"onKeyDown",value:function(e){"Enter"===e.key&&this.onClickDone()}},{key:"render",value:function(){var e=this;return r.a.createElement(D.a,{dialogClassName:"preset-modal",show:this.props.show,onHide:function(){return e.props.setShowPasswordModal(!1)}},r.a.createElement(D.a.Body,null,r.a.createElement(O,{condition:this.state.incorrectPassword},r.a.createElement("div",{className:"incorrect-password"},"Incorrect password")),r.a.createElement(O,{condition:void 0!==this.state.userName},"Password required to access",r.a.createElement("div",{className:"password-user-name"},this.state.userName)),r.a.createElement(O,{condition:this.state.needsToSetPassword},"Create a password to be used to encrypt your projects. Remember the password you choose."),r.a.createElement("div",{className:"password-container"},r.a.createElement(ay.a,{id:"password",name:"password",placeholder:"Enter password",onKeyDown:function(t){return e.onKeyDown(t)},ref:function(t){return e.input=t},value:this.state.password,onChange:this.handleChange.bind(this)}))),r.a.createElement(D.a.Footer,null,r.a.createElement(A.b,{variant:"secondary",onClick:this.onClickDone},"Done"),r.a.createElement(A.b,{variant:"primary",onClick:this.onClickCancel},"Cancel")))}}]),t}(a.Component),my=Object(y.b)(function(e){return{show:e.sequencer.showPasswordModal,passwordModalCallback:e.sequencer.passwordModalCallback}},function(e){return{setShowPasswordModal:function(t){return e(Object(w.td)(t))}}})(fy),vy=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e="small_checkmark ";return this.props.className&&(e+=this.props.className),console.log("condition = "+this.props.condition),r.a.createElement(O,{condition:this.props.condition},r.a.createElement("span",{className:e},r.a.createElement("div",{className:"small_checkmark_stem"}),r.a.createElement("div",{className:"small_checkmark_kick"})))}}]),t}(a.Component),gy=(n(987),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={toggled:!1,guilds:[]},R.a.store=n.props.store,Ge.a.setStore(n.props.store),Ge.a.setEthereum(R.a),Ge.a.checkLogin(),n.getGuilds(),n.getUserName(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.userToken!==e.userToken&&(this.getGuilds(),this.getUserName()),!0}},{key:"getUserName",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ge.a.getUserName();case 2:t=e.sent,this.setState({userName:t});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getGuilds",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.a.guilds.getGuildsForUser();case 2:t=e.sent,console.log("got guilds for user = "),console.log(t),this.setState({guilds:t});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onClickLogIn",value:function(){this.props.setSigningUp(!1),this.props.setShowLogin(!0)}},{key:"onClickSignUp",value:function(){this.props.setSigningUp(!0),this.props.setShowLogin(!0)}},{key:"onClickLogout",value:function(){Ge.a.logout()}},{key:"onClickGuild",value:function(e){void 0!==e&&R.a.crypto.getPassword(),this.props.setSelectedGuild(e)}},{key:"toggle",value:function(){this.setState({toggled:!this.state.toggled})}},{key:"getSelectedGuild",value:function(){return this.props.selectedGuild?this.props.selectedGuild.name:this.state.userName}},{key:"goToGuildsPage",value:function(){window.location.href="/guilds"}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"guilds-menu"},r.a.createElement(my,{crypto:R.a.crypto,show:!0}),r.a.createElement(A.c,{className:"view-dropdown",show:this.state.toggled?"true":"false",isOpen:this.state.toggled,toggle:function(){return e.toggle()}},Ge.a.isLoggedIn()?r.a.createElement(A.f,{size:"sm",caret:!0,color:"primary"},r.a.createElement("div",{className:"not-recording-dot"}),r.a.createElement("span",{className:"guild-name"},this.getSelectedGuild())):r.a.createElement(A.f,{size:"sm",caret:!0,color:"primary"},r.a.createElement("div",{className:"not-recording-dot logged-out"}),"Log In"),r.a.createElement(A.e,null,r.a.createElement(O,{condition:!Ge.a.isLoggedIn()},r.a.createElement(A.d,{key:"",onClick:function(){return e.onClickLogIn()},size:"sm"},"Log In"),r.a.createElement(A.d,{key:"public",onClick:function(){return e.onClickSignUp()},size:"sm"},"Sign Up")),r.a.createElement(O,{condition:Ge.a.isLoggedIn()},r.a.createElement(A.d,{key:"public",className:"user-name-item",onClick:function(){return e.goToGuildsPage()},size:"sm"},r.a.createElement("div",{className:"not-recording-dot"})," ",r.a.createElement("span",{className:"guild-user-name"},this.state.userName)),r.a.createElement(A.d,{key:"public",onClick:function(){return e.onClickGuild(void 0)},size:"sm"},r.a.createElement("div",{className:"guild-dropdown-option"},r.a.createElement("div",null,"Public"),r.a.createElement(vy,{className:"guilds-checkmark",condition:void 0===this.props.selectedGuild}))),this.state.guilds.map(function(t){return r.a.createElement(A.d,{key:t.name,onClick:function(){return e.onClickGuild(t)},size:"sm"},r.a.createElement("div",{className:"guild-dropdown-option"},r.a.createElement("div",null,t.name),r.a.createElement(vy,{className:"guilds-checkmark",condition:e.props.selectedGuild===t})))}),r.a.createElement(A.d,{key:"logout",className:"logout-item",onClick:function(){return e.onClickLogout()},size:"sm"},"Log out")))))}}]),t}(a.Component)),by=Object(y.b)(function(e){return{selectedGuild:e.guilds.selectedGuild,userToken:e.sequencer.userToken}},function(e){return{setSelectedGuild:function(t){return e(Object(w.Nc)(t))},setShowLogin:function(t){return e(Object(w.qd)(t))},setSigningUp:function(t){return e(Object(w.Hd)(t))}}})(gy),yy=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return 0===this.props.numPending?r.a.createElement("div",null):r.a.createElement("div",{className:"pending-transactions"},"Syncing ",this.props.numPending," items",r.a.createElement(V.a,{sizeUnit:"px",size:8,color:"#6200ff",loading:!0}))}}]),t}(a.Component),ky=Object(y.b)(function(e,t){return{numPending:e.transactions.pendingTransactions.length}},null)(yy),Ey=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={clockDragging:!1,clockStartDragY:void 0,clockDragY:void 0},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClockMouseLeave",value:function(e){void 0!=this.seekTimer&&(clearInterval(this.seekTimer),this.seekTimer=void 0)}},{key:"onClockMouseDown",value:function(e){var t=this;this.state.clockStartDragY=e.clientY,this.seekTimer=setInterval(function(){if(void 0!==t.state.clockDragY){var e=t.state.clockStartDragY-t.state.clockDragY,n=t.props.sequencerEngine.trackStep+5*e;n<0&&(n=0),t.props.sequencerEngine.seekToTrackStep(n)}},50)}},{key:"onClockMouseUp",value:function(e){clearInterval(this.seekTimer),this.seekTimer=void 0}},{key:"onClockMouseMove",value:function(e){this.state.clockDragY=e.clientY}},{key:"render",value:function(){var e=this,t=Math.ceil(this.props.currentGlobalStep/32);t=isNaN(t)?1:t;var n=1+Math.floor(this.props.currentGlobalStep/8)%4,a=1+Math.floor(this.props.currentGlobalStep/2)%4,s="clock ";return this.props.clockTick&&(s+="percentage-"+this.props.clockTick),r.a.createElement("div",{className:s,onMouseLeave:function(t){return e.onClockMouseLeave(t)},onMouseDown:function(t){return e.onClockMouseDown(t)},onMouseUp:function(t){return e.onClockMouseUp(t)},onMouseMove:function(t){return e.onClockMouseMove(t)}},r.a.createElement("div",{className:"track-time"},t),r.a.createElement("div",{className:"divider"},"."),r.a.createElement("div",{className:"time"},n),r.a.createElement("div",{className:"divider"},"."),r.a.createElement("div",{className:"time"},a))}}]),t}(a.Component),Sy=Object(y.b)(function(e){var t=e.sequencer.sequencerEngine.getSequenceId();return{currentStep:e.sequencer.currentStep[t]||0,currentGlobalStep:e.sequencer.currentGlobalStep[t]||0,clockTick:e.clock.clockTick}},null)(Ey),Oy=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).operationManager=n.props.sequencerEngine.operationManager,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onDragStart",value:function(e){this.props.dragPattern(e)}},{key:"deletePattern",value:function(){0!==this.props.sequencerEngine.tracks.length&&this.operationManager.dispatch({type:"DELETE_PATTERN",payload:{patternNumber:this.props.sequencerEngine.tracks[0].currentPattern}})}},{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"onDrop",value:function(e){this.props.sequencerEngine.movePatternTo(this.props.patternDragging,e),this.setState(this.state)}},{key:"clickPattern",value:function(e){this.props.sequencerEngine.store.getState();this.props.sequencerEngine.switchToPattern(e),this.setState(this.state)}},{key:"render",value:function(){var e=this;if(this.props.sequencerEngine.currentSubSequence.isTrack)return r.a.createElement("div",null);for(var t=[],n=0;n<this.props.sequencerEngine.numberOfPatterns();n++)t.push(n);return r.a.createElement("div",{className:"patterns-container"},t.map(function(t){return r.a.createElement(wy,{key:t,setContextualHelp:function(t){return e.props.setContextualHelp(t)},patternNumber:t,currentPattern:e.props.currentPattern,patternColor:e.props.patternColors[t],patternToEditColor:e.props.patternToEditColor,onClickPattern:function(){return e.clickPattern(t)},onDragStart:function(n){return e.onDragStart(t)},onDragOver:function(t){return e.onDragOver(t)},onDrop:function(n){e.onDrop(t)}})}),r.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("NEW_PATTERN_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"new-pattern-btn",onClick:function(){return e.props.sequencerEngine.newPattern(!0)}},"+"),r.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("DELETE_PATTERN_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"delete-pattern-btn",onClick:function(){return e.deletePattern()}},"-"))}}]),t}(a.Component),wy=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t="pattern-box";this.props.currentPattern==this.props.patternNumber?void 0!==this.props.patternColor?t+=" background-"+this.props.patternColor:t+=" current-pattern":void 0!==this.props.patternColor&&(t+=" foreground-"+this.props.patternColor),this.props.patternNumber==this.props.patternToEditColor&&(t+=" editing-color");var n=this.props.currentPattern===this.props.patternNumber?"CURRENT_PATTERN_BUTTON":"PATTERN_BUTTON";return r.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp(n)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onDragStart:this.props.onDragStart,onDragOver:this.props.onDragOver,onDrop:this.props.onDrop,draggable:!0,className:t,onClick:this.props.onClickPattern},this.props.patternNumber+1)}}]),t}(a.Component),Cy=Object(y.b)(function(e,t){var n=t.sequencerEngine.engineId,a=e.sequencer.currentSubSequence[n],r=e.sequencer.currentPattern[a]||0,s=e.sequencer.isPlaying[n]||0;return{midiMapMode:e.midi.midiMapMode,isCompactMode:e.sequencer.isCompactMode,resolution:e.sequencer.resolution,detailsView:e.sequencer.detailsView,decentralized:e.sequencer.decentralized,currentPattern:r,viewMode:e.sequencer.viewMode,numberOfPatterns:e.sequencer.numberOfPatterns[a]||1,samplePack:e.sequencer.samplePack,patternDragging:e.sequencer.patternDragging,isRecordingMix:e.mix.isRecordingMix,isPlayingMix:e.mix.isPlayingMix,isPlaying:s,patternToEditColor:e.toolbar.patternToEditColor,patternColors:e.toolbar.patternColors,trackRolling:e.sequencer.trackRolling,sequenceRolling:e.sequencer.sequenceRolling}},function(e){return{dragPattern:function(t){return e(Object(w.e)(t))},setContextualHelp:function(t){return e(Object(w.V)(t))}}})(Oy),Py=["A","B","C","D","E","F","G","H"],Ty=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"chooseSubSequence",value:function(e){"SOUND_DETAILS_VIEW"!==this.props.viewMode&&"MULTI_DETAILS_VIEW"!==this.props.viewMode||this.props.setViewMode(lo),this.props.sequencerEngine.switchToSubSequence(e)}},{key:"newSubSequence",value:function(){"SOUND_DETAILS_VIEW"!==this.props.viewMode&&"MULTI_DETAILS_VIEW"!==this.props.viewMode||this.props.setViewMode(lo),this.props.sequencerEngine.newSubSequence()}},{key:"deleteSubSequence",value:function(){window.confirm("Are you sure you want to delete this SUB SEQUENCE?")&&this.props.sequencerEngine.deleteSubSequence()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"sub-sequences-container"},this.props.subSequences.filter(function(t){return!e.props.sequencerEngine.getSubSequence(t).isTrack}).map(function(t,n){return r.a.createElement("div",{key:Py[n],onClick:function(){return e.chooseSubSequence(t)},className:t===e.props.currentSubSequence?"sub-sequence selected":"sub-sequence"},Py[n])}),r.a.createElement("div",{onClick:function(){return e.newSubSequence()},className:"new-sub-sequence"},"+"),r.a.createElement("div",{onClick:function(){return e.deleteSubSequence()},className:"delete-sub-sequence"},"-"))}}]),t}(a.Component),jy=Object(y.b)(function(e,t){var n=t.sequencerEngine.engineId;return{subSequences:e.sequencer.subSequences[n]||[],currentSubSequence:e.sequencer.currentSubSequence[n],viewMode:e.sequencer.viewMode}},function(e){return{setViewMode:function(t){return e(Object(w.ye)(t))}}})(Ty);function xy(e){var t=e.sequencerEngine,n=t.getAllRecordingsToSave().length;return 0===n?r.a.createElement("div",null):r.a.createElement("div",{className:"save-recordings"},"You have ",n," new sounds to",r.a.createElement("span",{onClick:function(){return t.saveAnyNewRecordings(0)},className:"save-recordings-button"},"save"),".")}a.Component;var Ny=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={sequenceHash:void 0,creatingLink:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getLink",value:function(){return"https://zequencer.io/create/"+this.state.sequenceHash}},{key:"copyLink",value:function(){var e=this,t=this.linkInput;t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),this.setState({copied:!0}),setTimeout(function(){return e.setState({copied:!1})},1e3)}},{key:"createLink",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({creatingLink:!0}),e.next=3,this.props.sequencerEngine.save(void 0,Ju,!1);case 3:t=e.sent,this.setState({sequenceHash:t,creatingLink:!1});case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(O,{condition:void 0===this.state.sequenceHash},r.a.createElement("div",{onClick:function(){return e.createLink()},className:"link-button"},"Create Public Link")),r.a.createElement(O,{condition:void 0!==this.state.sequenceHash},r.a.createElement("div",null,"Link: ",r.a.createElement("input",{type:"text",value:this.getLink(),id:"linkInput",ref:function(t){e.linkInput=t}})),r.a.createElement("div",{onClick:function(){return e.copyLink()},className:"small-button pink-button"},"Copy Link"),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(O,{condition:this.state.copied},r.a.createElement("div",{className:"copied-info"},"Copied to clipboard!"))))}}]),t}(a.Component),qy=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;if(0===this.props.guildOptions.length&&!this.props.showPublic)return r.a.createElement("div",{className:"guild-options-container"},"You are not a part of any guilds yet. To create one, go ",r.a.createElement("a",{href:"/guilds"},"here"),".");return r.a.createElement("div",{className:"guild-options-container"},"Only members of selected guild will have access",r.a.createElement("div",{className:"guild-options"},r.a.createElement(O,{condition:this.props.showPublic},r.a.createElement(My,{guild:{guildId:0,name:"Public"},onClick:function(){return e.props.onSelectGuild(void 0)},isSelected:void 0===this.props.selectedGuild})),this.props.guildOptions.map(function(t){return r.a.createElement(My,{guild:t,onClick:function(){return e.props.onSelectGuild(t)},isSelected:e.isSelected(t)})})))}},{key:"isSelected",value:function(e){return void 0===this.props.selectedGuild?0===e.id:this.props.selectedGuild.guildId===e.guildId}}]),t}(a.Component),My=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e="guild-option";return this.props.isSelected&&(e+=" selected"),r.a.createElement("div",{onClick:this.props.onClick,className:e},this.props.guild.name)}}]),t}(a.Component),Dy=qy,Ay=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"ethereum-explanation"},r.a.createElement("div",{className:"basic-explanation"},"It costs 1 token to save a project, publicly. Projects saved publicly can be viewed by anyone."),r.a.createElement(O,{condition:this.props.advanced},"Think of them as stake in the platform, which is run as a cooperative."))}}]),t}(a.Component),Ry=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"metamask-instructions"},"To post projects for others to find, follow these steps:",r.a.createElement("ul",null,r.a.createElement("li",null,"First install the ",r.a.createElement("a",{href:"https://chrome.google.com/webstore/detail/metamask/nkbihfbeogaeaoehlefnkodbefgpgknn"},"Metamask")," chrome plug-in."),r.a.createElement("li",null," Create a new account on your Metamask wallet."),r.a.createElement("li",null,' Click on the orange Metamask icon (top-right corner) and switch the network from "Main Ethereum Network" to "Ropsten Test Network".'),r.a.createElement("li",null,"Get some free Ether for  your new account by going ",r.a.createElement("a",{href:"https://faucet.metamask.io/"},"here"),', and clicking "request 1 ether from faucet".')))}}]),t}(a.Component),Iy=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={nameValue:"",numTokens:1,saveOption:Ju,metamaskInstalled:!1,showBuying:!1,sequenceHash:void 0,copied:!1,selectedGuild:void 0,guildOptions:[]},n.input=void 0,n.onClickDone=n.onClickDone.bind(Object(p.a)(n)),n.onClickCancel=n.onClickCancel.bind(Object(p.a)(n)),n.onClickBuy=n.onClickBuy.bind(Object(p.a)(n)),n.onClickConfirmBuy=n.onClickConfirmBuy.bind(Object(p.a)(n)),R.a.tokenizedSequences.callback=function(){return n.onBalanceUpdated()},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){return e.show&&e.show!==this.props.show&&(R.a.tokenizedSequences.watchBalance(),this.getUser(),this.getBalance(),this.getPrice(),this.getGuilds()),e.show||e.show===this.props.show||(this.state.sequenceHash=void 0,this.state.copied=!1),!0}},{key:"getGuilds",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.a.guilds.getGuildsForUser();case 2:t=e.sent,void 0!==this.props.selectedGuild&&this.setState({saveOption:Gu}),this.setState({selectedGuild:this.props.selectedGuild||t[0],guildOptions:t});case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getPrice",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n=this;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.a.tokenizedSequences.getPrice();case 2:t=(t=e.sent)*Math.pow(10,3)/Math.pow(10,18),this.setState({price:t}),f.a.get("https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=ethereum").then(function(e){e=e.data;var t=parseFloat(e[0].current_price);n.setState({ethPrice:t})}).catch(function(e){console.log("error getting price = "),console.log(e)});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onClickConfirmBuy",value:function(){this.onClickDone()}},{key:"onClickBuy",value:function(){this.setState({showBuying:!0})}},{key:"onBalanceUpdated",value:function(){this.setState({onPurchased:!1}),this.getBalance()}},{key:"getBalance",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.a.tokenizedSequences.getBalance();case 2:t=e.sent,this.state.balance=t||0,this.state.showBuying=0===t,this.setState({balance:t||0,showBuying:0===t});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUser",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ge.a.getAccount();case 2:t=e.sent,this.setState({metamaskInstalled:void 0!==t});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(e){return this.props.show!=e.show&&this.input&&this.input.focus(),!0}},{key:"onClickDone",value:function(){this.state.showBuying?(R.a.tokenizedSequences.buyTokens(parseInt(this.state.numTokens)),this.setState({onPurchased:!0,showBuying:!1})):(console.log("on save called with selected guild = "),this.props.onSave(this.state.nameValue,this.state.saveOption,this.state.selectedGuild))}},{key:"onClickCancel",value:function(){this.state.showBuying?this.setState({showBuying:!1}):this.props.onHide()}},{key:"onInputType",value:function(e){this.setState({nameValue:e})}},{key:"handleCheckboxChange",value:function(e){console.log("handleCheckboxChange("+e+")"),console.log(e.target),this.setState({saveOption:e.target.name})}},{key:"onTokenType",value:function(e){""===e&&this.setState({numTokens:0}),Object($e.a)(e)&&this.setState({numTokens:e})}},{key:"onSelectGuild",value:function(e){this.setState({selectedGuild:e})}},{key:"render",value:function(){var e=this;return this.state.metamaskInstalled?this.state.showBuying?r.a.createElement(D.a,{dialogClassName:"preset-modal",show:this.props.show,onHide:this.onClickCancel},r.a.createElement(D.a.Header,{closeButton:!0},r.a.createElement(D.a.Title,null,"Buy Tokens")),r.a.createElement(D.a.Body,null,r.a.createElement("div",{className:"input-wrapper"},r.a.createElement("input",{value:this.state.numTokens,onChange:function(t){return e.onTokenType(t.target.value)},ref:function(t){e.input=t},placeholder:"Enter how many tokens to buy",className:"tag-input"})),r.a.createElement("div",{className:"price"},"Price:",r.a.createElement("span",{className:"price-eth-wrapper"},r.a.createElement("span",{className:"price-eth"},function(e){if(Math.abs(e)<1){var t=parseInt(e.toString().split("e-")[1]);t&&(e*=Math.pow(10,t-1),e="0."+new Array(t).join("0")+e.toString().substring(2))}else{var t=parseInt(e.toString().split("+")[1]);t>20&&(t-=20,e/=Math.pow(10,t),e+=new Array(t+1).join("0"))}return e}(this.state.numTokens*this.state.price)),"ETH"),r.a.createElement("span",{className:"price-dollars-wrapper"},r.a.createElement("span",{className:"price-dollars"},this.state.numTokens*this.state.price*this.state.ethPrice),"USD$")),r.a.createElement("span",{onClick:this.onClickConfirmBuy,className:"buy-action"},"Buy"),r.a.createElement(Ay,{advanced:!0})),r.a.createElement(D.a.Footer,null,r.a.createElement(A.b,{variant:"secondary",onClick:this.onClickDone},"Buy"),r.a.createElement(A.b,{variant:"primary",onClick:this.onClickCancel},"Cancel"))):r.a.createElement(D.a,{dialogClassName:"preset-modal",show:this.props.show,onHide:this.onClickCancel},r.a.createElement(D.a.Header,{closeButton:!0},r.a.createElement(D.a.Title,null,"Save Project")),r.a.createElement(D.a.Body,null,r.a.createElement("input",{value:this.state.nameValue,onChange:function(t){return e.onInputType(t.target.value)},ref:function(t){e.input=t},placeholder:"Type name of project",className:"tag-input"}),r.a.createElement("form",null,r.a.createElement("input",{name:Ju,type:"checkbox",checked:this.state.saveOption===Ju,onChange:function(t){return e.handleCheckboxChange(t)}}),r.a.createElement("label",{onMouseOver:function(){return e.props.setContextualHelp("PUBLIC_SAVE")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)}},"Public"),r.a.createElement("input",{name:Gu,type:"checkbox",checked:this.state.saveOption===Gu,onChange:function(t){return e.handleCheckboxChange(t)}}),r.a.createElement("label",{onMouseOver:function(){return e.props.setContextualHelp("PUBLIC_SAVE")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)}},"Guild"),r.a.createElement("input",{name:"PRIVATE",value:"PRIVATE",type:"checkbox",checked:"PRIVATE"===this.state.saveOption,onChange:function(t){return e.handleCheckboxChange(t)}}),r.a.createElement("label",{onMouseOver:function(){return e.props.setContextualHelp("PRIVATE_SAVE")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)}},"Private")),r.a.createElement(O,{condition:!this.state.metamaskInstalled},r.a.createElement(Ry,null)),r.a.createElement(O,{condition:void 0!==this.state.balance&&this.state.saveOption===Ju},r.a.createElement("div",{className:"balance-info"},r.a.createElement("div",{className:"balance"},"Balance: ",this.state.balance," tokens",r.a.createElement("span",{onClick:this.onClickBuy,className:"buy-action go-to-buy"},"Buy")),r.a.createElement("div",null,"Cost: 1 token"),r.a.createElement(O,{condition:this.state.onPurchased},r.a.createElement("span",{className:"waiting-for-tokens"},"Waiting for token purchase to go through..."),r.a.createElement(V.a,{sizeUnit:"px",size:10,color:"#62ffa1",loading:this.state.onPurchased}))),r.a.createElement(Ay,null)),r.a.createElement(xy,{sequencerEngine:this.props.sequencerEngine}),r.a.createElement(O,{condition:this.state.saveOption===Ju},r.a.createElement(Ny,{sequencerEngine:this.props.sequencerEngine})),r.a.createElement(O,{condition:this.state.saveOption===Gu},r.a.createElement(Dy,{onSelectGuild:function(t){return e.onSelectGuild(t)},selectedGuild:this.state.selectedGuild,guildOptions:this.state.guildOptions}))),r.a.createElement(D.a.Footer,null,r.a.createElement(A.b,{variant:"secondary",onClick:this.onClickDone},"Save"),r.a.createElement(A.b,{variant:"primary",onClick:this.onClickCancel},"Cancel"))):r.a.createElement(D.a,{dialogClassName:"preset-modal save-modal",show:this.props.show,onHide:this.onClickCancel},r.a.createElement(D.a.Header,{closeButton:!0},r.a.createElement(D.a.Title,null,"Save Sequence")),r.a.createElement(D.a.Body,null,r.a.createElement("div",{className:"no-metamask"},"Log in to save your song to your account."),r.a.createElement(Ny,{sequencerEngine:this.props.sequencerEngine})),r.a.createElement(D.a.Footer,null,r.a.createElement(A.b,{variant:"secondary",onClick:this.onClickCancel},"Done")))}}]),t}(a.Component);var Ly=Object(y.b)(function(e){return{selectedGuild:e.guilds.selectedGuild}},function(e){return{setContextualHelp:function(t){return e(Object(w.V)(t))}}})(Iy),Fy=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onPlayMixClicked",value:function(e){this.props.setIsPlayingMix(!this.props.isPlaying),this.props.sequencerEngine.schedulePlay(),document.activeElement.blur()}},{key:"onClickRecordMixButton",value:function(){if(this.props.installation){var e=!this.props.isRecordingMix;this.props.sequencerEngine.recording(e)}else this.props.setIsRecordingMix(!this.props.isRecordingMix)}},{key:"onClickStop",value:function(){this.props.sequencerEngine.stop(),this.props.setArrangementMouseX(void 0)}},{key:"render",value:function(){var e=this,t="playpause ";return this.props.playScheduled&&(t+=" flashit"),r.a.createElement("div",{className:"mix-buttons"},r.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("PLAY_MIX_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:t},r.a.createElement("input",{onChange:function(t){return e.onPlayMixClicked(t)},checked:!this.props.isPlayingMix&&!this.props.isPlaying,type:"checkbox",value:!this.props.isPlayingMix&&!this.props.isPlaying,id:"playpause",name:"check"}),r.a.createElement("label",{className:this.props.isPlayingMix?"mix":"",htmlFor:"playpause",tabIndex:1})),r.a.createElement("div",{onClick:function(){return e.onClickStop()},className:"stop-button"}),r.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("RECORD_MIX_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onClickRecordMixButton()},className:this.props.isRecordingMix?"recording-dot":"not-recording-dot"}),r.a.createElement("img",{onMouseOver:function(){return e.props.setContextualHelp("AUTOMATION_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onClickLooping()},className:"loop-icon",src:this.getLoopIcon()}))}},{key:"getLoopIcon",value:function(){return this.props.looping?"/arrow-loop-looping.png":"/arrow-loop.png"}},{key:"onClickLooping",value:function(){this.props.sequencerEngine.restartAllMixes(!this.props.looping),this.props.setLooping(!this.props.looping)}},{key:"getLoopClass",value:function(){return this.props.looping?"loop-icon looping":"loop-icon"}},{key:"onClickAutomationMode",value:function(){"PLAY"===this.props.automationMode?this.props.setProjectAutomationMode("RECORD"):"RECORD"===this.props.automationMode&&this.props.setProjectAutomationMode("PLAY")}},{key:"getAutomationIcon",value:function(){return"RECORD"===this.props.automationMode?"/automation-icon-enabled.png":"/automation-icon-disabled.png"}}]),t}(a.Component),Vy=Object(y.b)(function(e,t){var n=t.sequencerEngine.getSequenceId(),a=e.sequencer.isPlaying[n]||0;return{isRecordingMix:t.installation?e.sequencer.isRecording:e.mix.isRecordingMix,isPlayingMix:e.mix.isPlayingMix,isPlaying:a,automationMode:e.sequencer.automationMode,playScheduled:e.clock.playScheduled,looping:e.arrangement.looping}},function(e){return{setIsPlayingMix:function(t){return e(Object(w.Ib)(t))},setIsRecordingMix:function(t){return e(Object(w.Lb)(t))},setProjectAutomationMode:function(t){return e(Object(w.tc)(t))},setContextualHelp:function(t){return e(Object(w.V)(t))},setLooping:function(t){return e(Object(w.A)(t))},setArrangementMouseX:function(t){return e(Object(w.B)(t))}}})(Fy),By=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).onClickColor=n.onClickColor.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickColor",value:function(e){console.log("pattern to edit color = "+this.props.patternToEditColor),this.props.setPatternColor(this.props.patternToEditColor,e)}},{key:"onClickDone",value:function(){this.props.setPatternToEditColor(void 0)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"sub-toolbar"},r.a.createElement("div",{className:"color-picker"},r.a.createElement(Uy,{patternColor:this.props.patternColor,color:"white",onClickColor:this.onClickColor}),r.a.createElement(Uy,{patternColor:this.props.patternColor,color:"red",onClickColor:this.onClickColor}),r.a.createElement(Uy,{patternColor:this.props.patternColor,color:"orange",onClickColor:this.onClickColor}),r.a.createElement(Uy,{patternColor:this.props.patternColor,color:"yellow",onClickColor:this.onClickColor}),r.a.createElement(Uy,{patternColor:this.props.patternColor,color:"green",onClickColor:this.onClickColor}),r.a.createElement(Uy,{patternColor:this.props.patternColor,color:"blue",onClickColor:this.onClickColor}),r.a.createElement(Uy,{patternColor:this.props.patternColor,color:"purple",onClickColor:this.onClickColor})),r.a.createElement("div",{className:"done-button",onClick:function(){return e.onClickDone()}},"DONE"))}}]),t}(a.Component),Uy=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t="color-option background-"+this.props.color;return this.props.patternColor===this.props.color&&(t+=" selected"),r.a.createElement("div",{onClick:function(){return e.props.onClickColor(e.props.color)},className:t})}}]),t}(a.Component),Hy=Object(y.b)(function(e){return{patternToEditColor:e.toolbar.patternToEditColor,patternColor:e.toolbar.patternColors[e.toolbar.patternToEditColor]}},function(e){return{setPatternToEditColor:function(t){return e(Object(w.kc)(t))},setPatternColor:function(t,n){return e(Object(w.jc)(t,n))}}})(By);var Jy=[{value:new ht(4,!1),label:"1/4"},{value:new ht(4,!0),label:"1/4t"},{value:new ht(8,!1),label:"1/8"},{value:new ht(8,!0),label:"1/8t"},{value:new ht(16,!1),label:"1/16"},{value:new ht(16,!0),label:"1/16t"},{value:new ht(32,!1),label:"1/32"},{value:new ht(32,!0),label:"1/32t"}];function Gy(e){for(var t=0;t<Jy.length;t++)if(Jy[t].value.resolution==e.resolution&&Jy[t].value.isTriplet==e.isTriplet)return Jy[t];return null}var zy=Object(y.b)(function(e){return{resolution:e.sequencer.resolution}},function(e){return{setContextualHelp:function(t){return e(Object(w.V)(t))}}})(function(e){return r.a.createElement("div",{onMouseOver:function(){return e.setContextualHelp(C)},onMouseLeave:function(){return e.setContextualHelp(void 0)}},r.a.createElement(pp.a,{className:"resolution-dropdown",options:Jy,onChange:function(t){return n=t.value,e.sequencerEngine.resolution=n,void(e.sequencerEngine.tracks.length>0&&e.sequencerEngine.select(e.sequencerEngine.cursor.track,0));var n},value:Gy(e.resolution),placeholder:"Select a resolution"}))}),_y=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClick",value:function(){"DISCONNECTED"===this.props.connectionStatus&&this.props.sequencerEngine.clockSync.retry()}},{key:"render",value:function(){var e=this;if("NONE"===this.props.connectionStatus)return r.a.createElement("div",null);var t="";t="WAITING"===this.props.connectionStatus?"Waiting for peer to connect":"DISCONNECTED"===this.props.connectionStatus?"Disconnected (click to retry)":"Synced with "+this.props.connectedUserName;var n="WAITING"===this.props.connectionStatus?" flashit":"";return r.a.createElement("div",{onClick:function(){return e.onClick()},className:"connection-status "+this.props.connectionStatus+n},t," ",r.a.createElement("div",{className:"clock-type"},this.props.clockType))}}]),t}(a.Component),Wy=Object(y.b)(function(e){return{connectedUserName:e.clock.connectedUserName,connectionStatus:e.clock.connectionStatus,clockType:e.sequencer.clockType}},null)(_y),Ky=(n(988),new Gg,function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={dropdownOpen:!1,showSaveModal:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"goToMixer",value:function(){this.props.setViewMode(po)}},{key:"goToArrangement",value:function(){this.props.setViewMode("ARRANGEMENT_VIEW")}},{key:"goToSequencer",value:function(){this.props.setViewMode(lo)}},{key:"goToPreferences",value:function(){this.props.setViewMode("PREFERENCES_VIEW")}},{key:"goToHome",value:function(){void 0!==this.props.onGoBack?this.props.onGoBack():window.location.href="/user/"}},{key:"toggleViewDropdown",value:function(){this.props.setZIndexHack(!this.state.dropdownOpen),this.setState({dropdownOpen:!this.state.dropdownOpen})}},{key:"duplicateTrack",value:function(){this.sequencerEngine.duplicateTrack(this.props.selectedTrack)}},{key:"onSave",value:function(e,t,n){this.hideSaveModal(),this.props.sequencerEngine.save(e,t,!0,n)}},{key:"hideSaveModal",value:function(){this.setState({showSaveModal:!1})}},{key:"save",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({showSaveModal:!0});case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onSelectResolution",value:function(e){this.props.sequencerEngine.resolution=e,this.props.sequencerEngine.select(this.props.sequencerEngine.cursor.track,0),this.setState(this.state)}},{key:"clickPattern",value:function(e){var t=this.props.sequencerEngine.store.getState();t.keyboard.isCommandDown?this.props.setPatternToEditColor(e):(this.props.sequencerEngine.switchToPattern(e),void 0!==t.toolbar.patternToEditColor&&this.props.setPatternToEditColor(e),this.setState(this.state))}},{key:"onDragStart",value:function(e){this.props.dragPattern(e)}},{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"onDrop",value:function(e){this.props.sequencerEngine.movePatternTo(this.props.patternDragging,e),this.setState(this.state)}},{key:"onPlayMixClicked",value:function(){}},{key:"onClickRecordMixButton",value:function(){}},{key:"onCompactClicked",value:function(){this.props.setCompactMode(!this.props.isCompactMode)}},{key:"onNewClicked",value:function(){window.confirm("Are you sure you want to clear this sequence (and lose any work)?")&&this.props.sequencerEngine.newSequence()}},{key:"getView",value:function(){return this.props.viewMode===lo?"SEQUENCER":this.props.viewMode===po?"MIXER":"PREFERENCES_VIEW"===this.props.viewMode?"PREFERENCES":"ARRANGEMENT_VIEW"===this.props.viewMode?"ARRANGEMENT":"VIEW"}},{key:"onStartSequenceRolling",value:function(){this.props.sequencerEngine.sequenceRolling=!0}},{key:"onStopSequenceRolling",value:function(){this.props.sequencerEngine.sequenceRolling=!1}},{key:"render",value:function(){for(var e=this,t=[],n=0;n<this.props.sequencerEngine.numberOfPatterns();n++)t.push(n);var a=-1;for(var s in this.props.sequencerEngine.tracks){var i=this.props.sequencerEngine.tracks[s].pattern.length();a<i&&(a=i)}return-1==a&&(a=32),r.a.createElement("div",{className:"top-toolbar"},r.a.createElement(Ly,{sequencerEngine:this.props.sequencerEngine,onSave:function(t,n,a){return e.onSave(t,n,a)},onHide:function(){return e.hideSaveModal()},show:this.state.showSaveModal}),r.a.createElement("div",{className:"main-toolbar"},r.a.createElement(zy,{sequencerEngine:this.props.sequencerEngine}),r.a.createElement(Cy,{sequencerEngine:this.props.sequencerEngine}),r.a.createElement("div",null,r.a.createElement(jy,{sequencerEngine:this.props.sequencerEngine}),r.a.createElement(Sy,{sequencerEngine:this.props.sequencerEngine})),r.a.createElement(Vy,{sequencerEngine:this.props.sequencerEngine}),r.a.createElement(Wy,{sequencerEngine:this.props.sequencerEngine}),this.props.trackRolling?r.a.createElement("div",{onMouseDown:function(){return e.onStartSequenceRolling()},onMouseUp:function(){return e.onStopSequenceRolling()},className:this.props.sequenceRolling?"roll-button rolling":"roll-button"},"ROLL"):"","OFF"!==this.props.midiMapMode?r.a.createElement("div",{className:"roll-button"},this.props.midiMapMode===qs?"MIDI MAP":"DELETE MIDI MAP"):"",r.a.createElement(O,{condition:this.props.viMode},r.a.createElement("div",{className:"roll-button command-button"},"COMMAND")),r.a.createElement("div",{className:"save-container"},r.a.createElement(O,{condition:this.props.onGoBack},r.a.createElement("div",{onClick:this.props.onGoBack,className:"go-back-button"},"BACK")),r.a.createElement("span",{onMouseOver:function(){return e.props.setContextualHelp("GUILDS_SELECTOR")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)}},r.a.createElement(ky,{store:this.props.sequencerEngine.store}),r.a.createElement(by,{store:this.props.sequencerEngine.store})),r.a.createElement("span",{onMouseOver:function(){return e.props.setContextualHelp("VIEW_DROPDOWN")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)}},r.a.createElement(A.c,{className:"view-dropdown",show:this.state.dropdownOpen?"true":"false",isOpen:this.state.dropdownOpen,toggle:function(){return e.toggleViewDropdown()}},r.a.createElement(A.f,{size:"sm",caret:!0,color:"primary"},this.getView()),r.a.createElement(A.e,null,r.a.createElement(A.d,{onClick:function(){return e.goToSequencer()},size:"sm"},"Sequencer"),r.a.createElement(A.d,{onClick:function(){return e.goToArrangement()},size:"sm"},"Arranger"),r.a.createElement(A.d,{onClick:function(){return e.goToMixer()},size:"sm"},"Mixer"),r.a.createElement(A.d,{onClick:function(){return e.goToPreferences()},size:"sm"},"Preferences"),r.a.createElement(A.d,{onClick:function(){return e.goToHome()},size:"sm"},"Profile")))),r.a.createElement("div",{className:"light-blue-button common-button",onClick:function(){return e.onNewClicked()}},"NEW"),r.a.createElement("div",{className:"pink-button common-button",onClick:function(){return e.save()}},"SAVE"))),r.a.createElement(O,{condition:void 0!==this.props.patternToEditColor},r.a.createElement(Hy,{sequencerEngine:this.props.sequencerEngine})))}}]),t}(a.Component));new ht(4,!1),new ht(4,!0),new ht(8,!1),new ht(8,!0),new ht(16,!1),new ht(16,!0),new ht(32,!1),new ht(32,!0);var Yy=Object(y.b)(function(e){var t=e.sequencer.sequencerEngine.getSequenceId(),n=e.sequencer.isPlaying[t]||0;return{midiMapMode:e.midi.midiMapMode,isCompactMode:e.sequencer.isCompactMode,resolution:e.sequencer.resolution,sequencerEngine:e.sequencer.sequencerEngine,detailsView:e.sequencer.detailsView,decentralized:e.sequencer.decentralized,viewMode:e.sequencer.viewMode,numberOfPatterns:e.sequencer.numberOfPatterns,samplePack:e.sequencer.samplePack,patternDragging:e.sequencer.patternDragging,isRecordingMix:e.mix.isRecordingMix,isPlayingMix:e.mix.isPlayingMix,isPlaying:n,patternToEditColor:e.toolbar.patternToEditColor,patternColors:e.toolbar.patternColors,trackRolling:e.sequencer.trackRolling,sequenceRolling:e.sequencer.sequenceRolling,viMode:e.commands.viMode}},function(e){return{setResolution:function(t){return e(Object(w.xc)(t))},setViewMode:function(t){return e(Object(w.ye)(t))},dragPattern:function(t){return e(Object(w.e)(t))},setIsPlayingMix:function(t){return e(Object(w.Ib)(t))},setPatternToEditColor:function(t){return e(Object(w.kc)(t))},setIsRecordingMix:function(t){return e(Object(w.Lb)(t))},setCompactMode:function(t){return e(Object(w.S)(t))},setZIndexHack:function(t){return e(Object(w.De)(t))},setContextualHelp:function(t){return e(Object(w.V)(t))}}})(Ky),Qy=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={options:[]},n.getOptions(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getOptions",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==navigator.mediaDevices){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,navigator.mediaDevices.enumerateDevices();case 4:t=e.sent,console.log("devices = "),console.log(t),n=t.filter(function(e){return"audioinput"===e.kind}).map(function(e){return{label:e.label,value:e.deviceId}}),void 0!==this.props.deviceId||(a=this.props.defaultInput||"default",(r=t.filter(function(e){return e.label.includes(a)})).length>0&&void 0===this.props.audioInputSource&&this.onChangeInput(r[0].deviceId)),this.setState({options:n});case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOption",value:function(e){return void 0===e&&(e="default"),console.log("getOption("+e+")"),this.state.options.filter(function(t){return t.value===e})[0]}},{key:"onChangeInput",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({audio:{deviceId:t,echoCancellation:!1}});case 2:n=e.sent,localStorage.setItem("deviceId",t),this.props.onChooseAudio(n,t);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props.defaultClassName||"audio-input-chooser";return r.a.createElement("div",{className:t},r.a.createElement(pp.a,{className:"audio-input-chooser-dropdown",controlClassName:"audio-input-chooser-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.state.options,onChange:function(t){return e.onChangeInput(t.value)},value:this.getOption(this.props.deviceId),placeholder:"Audio Input"}))}}]),t}(a.Component),Xy=Object(y.b)(function(e){return{audioInputSource:e.sequencer.audioInputSource}},function(e){return{}})(Qy),Zy=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickUser",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("SYNCED"!==this.props.connectionStatus){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,R.a.users.getUserId(t);case 4:n=e.sent,this.props.sequencerEngine.clockSync.setClockType("SLAVE"),this.props.sequencerEngine.clockSync.syncToUser(n);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onSelectClockType",value:function(e){this.props.sequencerEngine.clockSync.setClockType(e.value)}},{key:"render",value:function(){var e,t=this;return r.a.createElement("div",{className:"clock-type-container"},r.a.createElement("div",{className:"sub-header"},"Clock Syncing"),r.a.createElement("div",null,"Clock Type"),r.a.createElement(pp.a,{className:"audio-input-chooser-dropdown",controlClassName:"audio-input-chooser-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:$y,onChange:function(e){return t.onSelectClockType(e)},value:(e=this.props.clockType,$y.filter(function(t){return t.value===e})[0]),placeholder:"Osc. Type"}),r.a.createElement("div",{className:"available-users"},"People available to connect:",this.props.availableUsers.map(function(e){return r.a.createElement("div",{onClick:function(){return t.onClickUser(e)},className:t.getClassName(e)},e,r.a.createElement(O,{condition:"SYNCED"===t.props.connectionStatus},r.a.createElement("div",{className:"user-status"},"CONNECTED")))})))}},{key:"getClassName",value:function(e){return e===this.props.connectedUserName?"available-user selected":"available-user"}}]),t}(a.Component),$y=[{value:"NONE",label:"None"},{value:ds,label:"Master"},{value:"SLAVE",label:"Slave"}];var ek=Object(y.b)(function(e){return{clockType:e.sequencer.clockType,availableUsers:e.sequencer.clockType===ds?[]:e.clock.availableUsers,connectedUserName:e.clock.connectedUserName,connectionStatus:e.clock.connectionStatus}},function(e){return{}})(Zy),tk=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"details-banner"},r.a.createElement("div",{className:"banner-back-button",onClick:this.props.onClickBack},"BACK"),r.a.createElement("div",{className:"banner-heading"},this.props.headerText))}}]),t}(a.Component),nk=(n(576),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},console.log(e.midiEngine),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentWillUnmount",value:function(){this.props.sequencerEngine.clockSync.stopListening()}},{key:"onLatencyChanged",value:function(e){Object($e.a)(e)&&this.props.setLatency(e)}},{key:"componentDidMount",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("preferences component did mount"),this.props.sequencerEngine.clockSync.startListening(),e.next=4,this.props.midiEngine.loadAvailableDevices();case 4:this.props.sequencerEngine.channelMixer.updateChannelCount(),this.setState(this.state);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"syncChanged",value:function(){this.setState(this.state)}},{key:"isMultiChannelRecording",value:function(){return!this.props.channelMixer.stereoConnected}},{key:"switchOutputs",value:function(e){this.props.channelMixer.switchOutputs(e),this.setState(this.state)}},{key:"onChooseAudio",value:function(e,t){console.log("onChooseAudio called"),this.props.sequencerEngine.audioInputManager.newInputSource(e,t),this.setState(this.state)}},{key:"render",value:function(){var e,t=this;return console.log("render in PreferencesView called with multi channel = "+this.isMultiChannelRecording()),r.a.createElement("div",{className:"preferences-view"},r.a.createElement(Yy,{onGoBack:this.props.onGoBack,alreadyLoaded:this.props.alreadyLoaded}),r.a.createElement(tk,{headerText:"Preferences",onClickBack:function(){return t.props.setViewMode(lo)}}),r.a.createElement("div",{className:"preferences-flex"},r.a.createElement("div",{className:"midi-preferences panel"},r.a.createElement("div",{className:"midi-preferences-subsection"},r.a.createElement("div",{className:"sub-header"},"MIDI"),r.a.createElement("div",{className:"inputs-heading"},"INPUTS"),this.props.midiEngine.getInputs().map(function(e){return r.a.createElement(ak,{syncChanged:function(){return t.syncChanged()},input:e,midiEngine:t.props.midiEngine})})),r.a.createElement("div",{className:"midi-preferences-subsection"},r.a.createElement("div",{className:"outputs-heading"},"OUTPUTS"),this.props.midiEngine.getOutputs().map(function(e){return r.a.createElement(rk,{output:e,midiEngine:t.props.midiEngine})}))),r.a.createElement("div",{className:"audio-preferences panel"},r.a.createElement("div",{className:"sub-header"},"AUDIO"),r.a.createElement(Xy,{deviceId:this.props.sequencerEngine.audioInputManager.deviceId,defaultClassName:"preferences-audio-chooser",onChooseAudio:function(e,n){return t.onChooseAudio(e,n)}}),r.a.createElement(sk,{isMultiChannelOutput:this.isMultiChannelRecording(),numberOfChannels:this.props.channelMixer.numberOfChannels(),onClick:function(e){return t.switchOutputs(e)}}),r.a.createElement("div",{className:"latency-container"},r.a.createElement("div",null,"Latency (ms)"),r.a.createElement("input",(e={className:"chord-input",onChange:function(e){return t.onLatencyChanged(e.target.value)},value:this.props.latency,placeholder:"Latency"},Object(_e.a)(e,"className","tags-input"),Object(_e.a)(e,"type","text"),e))),r.a.createElement(ek,{sequencerEngine:this.props.sequencerEngine}))))}}]),t}(a.Component)),ak=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickSynced",value:function(){this.props.midiEngine.isInputSynced(this.props.input)?(console.log("unsyncing "+this.props.input),this.props.midiEngine.unsyncInput(this.props.input)):this.props.midiEngine.syncInput(this.props.input),this.props.syncChanged(),this.setState(this.state)}},{key:"onClickTracked",value:function(){this.props.midiEngine.isInputTracked(this.props.input)?this.props.midiEngine.untrackInput(this.props.input):this.props.midiEngine.trackInput(this.props.input),this.setState(this.state)}},{key:"onClickKeys",value:function(){this.props.midiEngine.setInputMode(this.props.input,"KEYBOARD"),this.setState(this.state)}},{key:"onClickPads",value:function(){this.props.midiEngine.setInputMode(this.props.input,Ms),this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.props.midiEngine.isInputSynced(this.props.input),n=this.props.midiEngine.isInputTracked(this.props.input),a=this.props.midiEngine.getInputMode(this.props.input.name);return console.log("tracked = "+n),r.a.createElement("div",{className:"midi-input"},r.a.createElement("div",{className:"midi-name"},this.props.input.name),r.a.createElement("div",{className:"midi-options"},r.a.createElement("div",{onClick:function(){return e.onClickTracked()},className:n?"midi-option enabled":"midi-option"},"TRACK"),r.a.createElement("div",{onClick:function(){return e.onClickSynced()},className:t?"midi-option enabled":"midi-option"},"SYNC"),r.a.createElement("div",{onClick:function(){return e.onClickKeys()},className:"KEYBOARD"===a?"midi-option enabled":"midi-option"},"KEYS"),r.a.createElement("div",{onClick:function(){return e.onClickPads()},className:a==Ms?"midi-option enabled":"midi-option"},"PADS")))}}]),t}(a.Component),rk=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickSync",value:function(){console.log("onClickSync called with props otput = "),console.log(this.props.output),this.props.midiEngine.syncOutput(this.props.output),this.setState(this.state)}},{key:"onClickTracked",value:function(){this.props.midiEngine.isOutputTracked(this.props.output)?this.props.midiEngine.untrackOutput(this.props.output):this.props.midiEngine.trackOutput(this.props.output),this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.props.midiEngine.isOutputTracked(this.props.output),n=this.props.midiEngine.systemOutput===this.props.output;return r.a.createElement("div",{className:"midi-output"},r.a.createElement("div",{className:"midi-name"},this.props.output.name),r.a.createElement("div",{className:"midi-options"},r.a.createElement("div",{onClick:function(){return e.onClickTracked()},className:t?"midi-option enabled":"midi-option"},"TRACK"),r.a.createElement("div",{onClick:function(){return e.onClickSync()},className:n?"midi-option enabled":"midi-option"},"SYNC")))}}]),t}(a.Component),sk=(a.Component,function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClick",value:function(){this.props.onClick(!this.props.decentralized),this.setState(this.state)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{onClick:function(){return e.props.onClick(!e.props.isMultiChannelOutput)},className:"audio-outputs-option"},this.props.isMultiChannelOutput?"MULTI CHANNEL OUTPUT ":"SINGLE OUTPUT ","(",this.props.numberOfChannels," channels)")}}]),t}(a.Component)),ik=Object(y.b)(function(e){return{decentralized:e.sequencer.decentralized,latency:e.sequencer.latency}},function(e){return{setViewMode:function(t){return e(Object(w.ye)(t))},setDecentralized:function(t){return e(Object(w.gb)(t))},setLatency:function(t){return e(Object(w.Rb)(t))}}})(nk),ok=[1,2,4,8,16,32,64],ck=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n.onClickDone=n.onClickDone.bind(Object(p.a)(n)),n.onClickCancel=n.onClickCancel.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickDone",value:function(){this.props.setShowSequenceModal(!1)}},{key:"onClickCancel",value:function(){this.props.setShowSequenceModal(!1)}},{key:"onClickResample",value:function(){this.props.sequencerEngine.masterResampler.prepare(),this.props.setResampleMaster(!0)}},{key:"isResampling",value:function(){return this.props.isResampling||this.props.resampleMaster}},{key:"getResamplingText",value:function(){return this.props.isResampling?"Resampling...":this.props.resampleMaster?"Waiting to resample...":""}},{key:"doubleTrackLength",value:function(){this.props.sequencerEngine.tracks.map(function(e){return e.doubleTrackLength()})}},{key:"halfTrackLength",value:function(){this.props.sequencerEngine.tracks.map(function(e){return e.halfTrackLength()})}},{key:"onClickShowGroups",value:function(){this.props.setShowGroups(!this.props.showGroups)}},{key:"clearPattern",value:function(){this.props.sequencerEngine.clearSequence()}},{key:"onClickResampleDuration",value:function(){if(64===this.props.resampleDuration)this.props.setResampleDuration(1);else{var e=ok.indexOf(this.props.resampleDuration);this.props.setResampleDuration(ok[e+1])}}},{key:"render",value:function(){var e=this;return r.a.createElement(D.a,{dialogClassName:"preset-modal",show:this.props.show,onHide:this.onClickCancel},r.a.createElement(D.a.Header,{closeButton:!0},r.a.createElement(D.a.Title,null,"Pattern Actions")),r.a.createElement(D.a.Body,null,r.a.createElement("div",{className:"sequence-action"},r.a.createElement("div",{className:"sequence-action-name"},"Pattern Length:"),r.a.createElement("div",{draggable:!1,onClick:function(){return e.doubleTrackLength()},className:"add-steps-button"},"+"),r.a.createElement("div",{draggable:!1,onClick:function(){return e.halfTrackLength()},className:"remove-steps-button"},"-")),r.a.createElement("div",{className:"sequence-action"},r.a.createElement("div",{onClick:function(){return e.clearPattern()},className:"clear-pattern-button common-button pink-button"},"Clear Pattern")),r.a.createElement("div",{className:"sequence-action"},r.a.createElement("div",{onClick:function(){return e.onClickShowGroups()},className:"clear-pattern-button common-button pink-button"},this.props.showGroups?"Show Tracks":"Show Groups")),r.a.createElement("div",{className:"resample-action"},r.a.createElement("div",{draggable:!1,onClick:function(){return e.onClickResample()},className:"transcribe-button"},"RESAMPLE"),r.a.createElement("div",{draggable:!1,onClick:function(){return e.onClickResampleDuration()},className:"resample-duration-button"},this.props.resampleDuration," x"),r.a.createElement(O,{condition:this.isResampling()},this.getResamplingText()),r.a.createElement(V.a,{sizeUnit:"px",size:10,color:"#123abc",loading:this.isResampling()}))),r.a.createElement(D.a.Footer,null,r.a.createElement(A.b,{variant:"secondary",onClick:this.onClickDone},"Done"),r.a.createElement(A.b,{variant:"primary",onClick:this.onClickCancel},"Cancel")))}}]),t}(a.Component),uk=Object(y.b)(function(e){return{show:e.sequencer.showSequenceModal,resampleMaster:e.sequencer.resampleMaster,isResampling:e.tracks.isResampling,resampleDuration:e.tracks.resampleDuration,showGroups:e.sequencer.showGroups}},function(e){return{setShowSequenceModal:function(t){return e(Object(w.wd)(t))},setResampleMaster:function(t){return e(Object(w.wc)(t))},setShowGroups:function(t){return e(Object(w.nd)(t))},setResampleDuration:function(t){return e(Object(w.vc)(t))}}})(ck),lk=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getOptions",value:function(){var e=[];return this.props.track.getRecordings().forEach(function(t,n){return e.push({value:n,label:n+1})}),e}},{key:"getRecordingOption",value:function(e){for(var t=this.getOptions(),n=0;n<t.length;n++)if(t[n].value==e)return t[n];return null}},{key:"getSelectedRecording",value:function(){return this.props.value}},{key:"onSelectRecording",value:function(e){this.props.track.setSelectedRecording(e.value),this.setState(this.state),this.props.onRecordingChanged()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"recordings-dropdown-container"},r.a.createElement("div",{className:""},"RECORDING"),r.a.createElement(pp.a,{className:"audio-input-dropdown",controlClassName:"audio-input-control-dropdown",arrowClassName:"audio-input-arrow-dropdown",placeholderClassName:"recordings-dropdown-placeholder",options:this.getOptions(),onChange:function(t){return e.onSelectRecording(t)},value:this.getRecordingOption(this.getSelectedRecording()),placeholder:"Recording"}))}}]),t}(a.Component),pk=Object(y.b)(function(e,t){return{value:t.track.trackData.selectedRecording}},null)(lk),hk=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n.onClickDone=n.onClickDone.bind(Object(p.a)(n)),n.onClickCancel=n.onClickCancel.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickDone",value:function(){this.props.setShowModsModal(!1)}},{key:"onClickCancel",value:function(){this.props.setShowModsModal(!1)}},{key:"render",value:function(){return r.a.createElement(D.a,{dialogClassName:"preset-modal",show:this.props.show,onHide:this.onClickCancel},r.a.createElement(D.a.Header,{closeButton:!0},r.a.createElement(D.a.Title,null,"Track Mods")),r.a.createElement(D.a.Body,null,r.a.createElement(dp,{parameters:this.props.parameters})),r.a.createElement(D.a.Footer,null,r.a.createElement(A.b,{variant:"secondary",onClick:this.onClickDone},"Done"),r.a.createElement(A.b,{variant:"primary",onClick:this.onClickCancel},"Cancel")))}}]),t}(a.Component),dk=Object(y.b)(function(e){return{show:e.sequencer.showModsModal}},function(e){return{setShowModsModal:function(t){return e(Object(w.rd)(t))}}})(hk),fk=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n.state.name=e.name,n.state.videoId=e.videoId,n.state.soundId=e.soundId,n.state.waveforms=1,n.state.start=0,n.sampler=e.sampler,console.log("sampelr = "),console.log(e.sampler),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.sampler.baseBuffer.get();return r.a.createElement(Dd,{track:this.props.track,fullWidth:!0,selectedSlice:this.props.selectedSlice,slices:this.props.sampler.slices,isReversed:this.props.sampler.isReversed(),sampler:this.props.sampler,decentralized:this.props.decentralized,soundId:this.props.soundId,onKeyDown:this.props.onKeyDown,onSelectSlice:this.props.onSelectSlice,buffer:e})}}]),t}(a.Component),mk=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).sample=new K.a(n.props.soundId),n.loadTags(n.props.soundId),n.state={name:"",showAddTag:!1,id:n.props.soundId},n.setState(n.state),n.loadName.bind(Object(p.a)(n)),n.showAddTag.bind(Object(p.a)(n)),n.loadTags.bind(Object(p.a)(n)),n.addTag.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"showAddTag",value:function(){this.state.showAddTag=!0,this.setState(this.state)}},{key:"loadTags",value:function(e){this.setState({tags:this.sample.tags})}},{key:"addTag",value:function(){var e=this._tag;R.a.tagSample(this.props.soundId,e),this.setState({showAddTag:!1,tags:this.state.tags.concat(e)})}},{key:"onSoundIdChange",value:function(e,t){this.state.id=t,this.setState(this.state),this.props.history.push("/sound/"+t)}},{key:"loadName",value:function(e){this.state.name=e,this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this,n=this.state.id;if(void 0!==this.state.slices){console.log(this.props.selectedSlice),console.log(this.state.slices);var a=this.state.slices.filter(function(t){return e.props.selectedSlice.startTime===t.startTime&&e.props.selectedSlice.endTime===t.endTime});console.log("found selected slice tags = "),console.log(a),a.length>0&&a.map(function(e){return e.tag})}return console.log("id = "+n),r.a.createElement("div",{className:"tag-editor"},r.a.createElement("div",null,r.a.createElement("span",{className:"tag-editor-header"},"TAGS: "),r.a.createElement(A.j,null,this.state.name),null!=this.state.tags?this.state.tags.map(function(e){return r.a.createElement(A.a,{color:"light"},e)}):""),r.a.createElement("div",{className:"tags"},r.a.createElement(A.b,{className:"add-tag-button",size:"sm",color:"secondary",onClick:function(){return t.showAddTag()}},"Add Tag"),this.state.showAddTag?r.a.createElement(A.h,{className:"tag-sound-input"},r.a.createElement(A.g,{onChange:function(t){return e._tag=t.target.value},placeholder:"Add tag",className:"tag-sound-input-box"}),r.a.createElement(A.i,{addonType:"append"},r.a.createElement(A.b,{onClick:function(){return e.addTag()},color:"secondary"},"Add"))):""))}}]),t}(a.Component),vk=(n(2337),new U.a),gk=function(e){function t(e){var n;Object(o.a)(this,t);var a=void 0===(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).props.showParameters||n.props.showParameters;return n.state={extracting:!1,selectedSlice:0,selectedMidiSlice:0,samplerNumber:n.props.samplerNumber||0,showParameters:a,refined:n.parametersHasDecimals(),focused:!1},n.props.track.getTrackType()===zn&&(n.linkMidi(),document.addEventListener("keydown",function(e){return n.onKeyDown(e)})),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"parametersHasDecimals",value:function(){return this.props.track.trackData.duration%1!==0||this.props.track.trackData.transpose%1!==0}},{key:"onGatedChange",value:function(e){document.activeElement.blur(),this.props.track.gated="gated"===e.target.value,this.setState(this.state)}},{key:"onChangeDuration",value:function(e){if(this.props.sequencerEngine.isRecording){var t=this.props.sequencerEngine.getCurrentStep();this.props.track.getStep(t).duration=parseFloat(e),this.props.track.trackData.duration=parseFloat(e)}else this.props.track.trackData.duration=parseFloat(e)}},{key:"onChangeTranspose",value:function(e){if(this.props.sequencerEngine.isRecording){var t=this.props.sequencerEngine.getCurrentStep();this.props.track.getStep(t).transpose=parseFloat(e),this.props.track.trackData.transpose=parseFloat(e)}else this.props.track.trackData.transpose=parseFloat(e)}},{key:"onChangeChop",value:function(e){if(this.props.sequencerEngine.isRecording){var t=this.props.sequencerEngine.getCurrentStep();this.props.track.getStep(t).duration=parseFloat(e),this.props.track.trackData.chop=parseInt(e)}else this.props.track.trackData.chop=parseInt(e)}},{key:"onChangeVelocity",value:function(e){var t=this.props.track.trackData;if(t.velocity=parseFloat(e),this.props.sequencerEngine.isRecording){var n=this.props.sequencerEngine.getCurrentStep();t=this.props.track.getStep(n)}t.velocity=parseFloat(e)}},{key:"onChangeAttack",value:function(e){var t=this.props.track.trackData;if(t.attack=parseFloat(e),this.props.sequencerEngine.isRecording){var n=this.props.sequencerEngine.getCurrentStep();t=this.props.track.getStep(n)}t.attack=parseFloat(e)}},{key:"onChangeRelease",value:function(e){var t=this.props.track.trackData;if(t.release=parseFloat(e),this.props.sequencerEngine.isRecording){var n=this.props.sequencerEngine.getCurrentStep();t=this.props.track.getStep(n)}t.release=parseFloat(e)}},{key:"onChangePitchAttack",value:function(e){var t=this.props.track.trackData;if(t.pitchAttack=parseFloat(e),this.props.sequencerEngine.isRecording){var n=this.props.sequencerEngine.getCurrentStep();t=this.props.track.getStep(n)}t.pitchAttack=parseFloat(e)}},{key:"onChangePitchDecay",value:function(e){var t=this.props.track.trackData;if(t.pitchDecay=parseFloat(e),this.props.sequencerEngine.isRecording){var n=this.props.sequencerEngine.getCurrentStep();t=this.props.track.getStep(n)}t.pitchDecay=parseFloat(e)}},{key:"onChangePitchSustain",value:function(e){var t=this.props.track.trackData;if(t.pitchSustain=parseFloat(e),this.props.sequencerEngine.isRecording){var n=this.props.sequencerEngine.getCurrentStep();t=this.props.track.getStep(n)}t.pitchSustain=parseFloat(e)}},{key:"onChangePitchRelease",value:function(e){var t=this.props.track.trackData;if(t.pitchRelease=parseFloat(e),this.props.sequencerEngine.isRecording){var n=this.props.sequencerEngine.getCurrentStep();t=this.props.track.getStep(n)}t.pitchRelease=parseFloat(e)}},{key:"onChangeOffset",value:function(e){this.props.track.getSampler().offset=e}},{key:"onSelectSlice",value:function(e){void 0!==e?this.props.setContextualHelp("DETAIL_VIEW_HAS_SELECTED_SLICE"):this.props.setContextualHelp(void 0),this.setState({selectedMidiSlice:e,selectedSlice:e})}},{key:"linkMidi",value:function(){var e=this;this.props.midiEngine.addNoteOnListener(function(t,n){null==e.state.selectedMidiSlice||e.props.track.isEnabled||(console.log("midi mapping calling"),e.props.keyboardEngine.midiMap(t,n,e.props.trackNumber,e.state.selectedMidiSlice),e.props.sequencerEngine.keyboardHelper.onNoteDown(n,!0,t),e.state.selectedMidiSlice=null,e.setState(e.state))})}},{key:"onKeyDown",value:function(e){var t=e.key;if("Tab"===t){return!0}null!=this.state.selectedMidiSlice&&t.match(/^[a-z]+$/)&&(this.state.focused||(this.props.keyboardEngine.hasKeyMapping(t)||this.props.keyboardEngine.map(t,this.props.trackNumber,this.state.selectedMidiSlice),this.state.selectedMidiSlice=null,this.setState(this.state)))}},{key:"onChangeRefined",value:function(e){document.activeElement.blur(),this.state.refined=!this.state.refined,this.setState(this.state)}},{key:"onChangeReversed",value:function(e){document.activeElement.blur(),this.props.track.trackData.reverse=!this.props.track.trackData.reverse,this.props.track.reverse(!this.isReversed()),this.setState(this.state)}},{key:"isReversed",value:function(){return this.props.track.isReversed()}},{key:"onFocus",value:function(){this.setState({focused:!0})}},{key:"onBlur",value:function(){this.setState({focused:!1})}},{key:"onChangeName",value:function(e){this.props.track.name=e.target.value,this.setState(this.state)}},{key:"savePreset",value:function(){this.props.sequencerEngine.saveTrackPreset(this.props.trackNumber)}},{key:"updatePreset",value:function(){this.props.sequencerEngine.updateTrackPreset(this.props.trackNumber)}},{key:"extractStems",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({extracting:!0}),e.next=3,this.props.track.extractStems();case 3:this.props.setViewMode(this.props.parentView);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"extractGroove",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.props.track.extractGroove(),this.props.setViewMode(this.props.parentView);case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;if(void 0==this.props.track)return r.a.createElement("div",null);var t=this.props.track,n="",a=void 0,s={},i=this.props.track.trackData;if(this.props.track.getTrackType()!==_n){void 0===this.state.selectedSlice||this.props.track.getSampler(this.state.samplerNumber).slices[this.state.selectedSlice],this.props.track.getSampler(this.state.samplerNumber).tempo;a=t.getSampler(this.state.samplerNumber);var o=this.props.track.soundIds[this.state.samplerNumber];void 0!==t.selectedRecording&&(a=t.getSelectedRecordingSampler(),o=t.getSelectedRecordingSoundId()),s["background-image"]="linear-gradient("+vk.brighten(vk.getColorForHash(o),.12)+", "+vk.brighten(vk.getColorForHash(o),.1)+")",s.borderColor=vk.brighten(vk.getColorForHash(o),.65),n=r.a.createElement(fk,{onSoundIdChange:function(e){return[]},onClickThumbnail:function(e){return[]},onGetName:function(){return[]},name:this.props.track.name,track:this.props.track,sampler:a,onSelectSlice:function(t){return e.onSelectSlice(t)},onKeyDown:function(t){return e.props.onKeyDown(t)},selectedSlice:this.state.selectedSlice,videoId:this.props.track.videoId,soundId:o})}var c=this.state.refined?.01:1,u=this.state.refined?.01:1,l=this.state.refined?2:64,p=this.props.track.getName(this.props.samplerNumber);return r.a.createElement("div",null,r.a.createElement(Yy,{onGoBack:this.props.onGoBack,alreadyLoaded:this.props.alreadyLoaded}),r.a.createElement(tk,{onClickBack:function(){e.props.setViewMode(e.props.parentView),void 0!==e.props.onClickBack&&e.props.onClickBack()},headerText:p}),r.a.createElement(dk,{parameters:this.props.track.trackData.parameters}),n,r.a.createElement(O,{condition:!this.state.extracting},r.a.createElement("div",{onClick:function(){return e.extractStems()},className:"common-button magenta-button"},"EXTRACT STEMS"),r.a.createElement(O,{condition:this.props.showingOnsets},r.a.createElement("div",{onClick:function(){return e.extractGroove()},className:"common-button magenta-button"},"EXTRACT GROOVE"))),r.a.createElement(O,{condition:this.state.extracting},r.a.createElement("div",{className:"extracting-stems"},"Extracting stems... ")),r.a.createElement(V.a,{sizeUnit:"px",size:10,color:"#123abc",loading:this.state.extracting}),this.state.showParameters?r.a.createElement("div",{style:s,onMouseOver:function(){return e.props.setContextualHelp("TRACK_PARAMETERS")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"sound-parameters sound-parameters-full panel"},r.a.createElement("form",null,r.a.createElement("div",{className:"radio"},r.a.createElement("label",null,r.a.createElement("input",{className:"filter-radio",type:"radio",value:"gated",checked:t.gated,onChange:function(t){return e.onGatedChange(t)}}),"Gated"),r.a.createElement("label",null,r.a.createElement("input",{className:"filter-radio",type:"radio",value:"ungated",checked:!t.gated,onChange:function(t){return e.onGatedChange(t)}}),"Ungated"))),r.a.createElement("form",null,r.a.createElement("div",{className:"refined-checkbox-preferences"},r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",value:"reversed",checked:this.props.track.isReversed(),onChange:function(t){return e.onChangeReversed(t.target.value)}}),"Reversed"))),"AUDIO"===this.props.track.getTrackType()?r.a.createElement(pk,{track:this.props.track,onRecordingChanged:function(){return e.setState(e.state)}}):"",r.a.createElement("div",{className:"amp-envelopes"},r.a.createElement(Gl,{effectNumber:0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,min:u,max:l,step:c,isParameter:!0,parameter:i.durationParameter,name:"DURATION"}),r.a.createElement(Gl,{effectNumber:0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,min:1,max:32,isParameter:!0,parameter:i.chopParameter,name:"CHOP"}),r.a.createElement(Gl,{min:-23,max:23,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,isParameter:!0,parameter:i.transposeParameter,refined:this.state.refined,name:"TRANSPOSE"}),r.a.createElement(Gl,{min:0,max:1,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,refined:this.state.refined,isParameter:!0,step:.1,parameter:i.velocityParameter,name:"VELOCITY"}),r.a.createElement(Gl,{min:0,max:2e3,step:1,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,refined:this.state.refined,isParameter:!0,parameter:i.attackParameter,unit:"ms",name:"AMP ATTACK"}),r.a.createElement(Gl,{min:0,max:8e3,refined:this.state.refined,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,isParameter:!0,parameter:i.releaseParameter,unit:"ms",name:"AMP RELEASE"})),r.a.createElement("div",{className:"pitch-envelopes"},r.a.createElement(Gl,{min:0,max:100,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,refined:this.state.refined,isParameter:!0,step:.1,unit:"%",parameter:i.startParameter,name:"START"}),r.a.createElement(Gl,{min:0,max:2e3,step:1,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,refined:this.state.refined,parameter:i.pitchAttackParameter,unit:"ms",name:"PITCH ATTACK"}),r.a.createElement(Gl,{min:.01,max:8e3,refined:this.state.refined,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,isParameter:!0,parameter:i.pitchDecayParameter,unit:"ms",name:"PITCH DECAY"}),r.a.createElement(Gl,{min:-10,max:10,isParameter:!0,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,refined:this.state.refined,step:.01,parameter:i.pitchSustainParameter,name:"PITCH SUSTAIN"}),r.a.createElement(Gl,{min:.01,max:8e3,refined:this.state.refined,sequencerEngine:this.props.sequencerEngine,lfoEnabled:!0,isParameter:!0,parameter:i.pitchReleaseParameter,unit:"ms",name:"PITCH RELEASE"})),r.a.createElement("form",null,r.a.createElement("div",{className:"refined-checkbox-preferences"},r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",value:"refined",checked:this.state.refined,onChange:function(t){return e.onChangeRefined(t.target.value)}}),"Refine"))),r.a.createElement("div",{onClick:function(){return e.props.setShowModsModal(!0)},className:"mods-button common-button pink-button small-button"},"MODS")):"",void 0!==a?r.a.createElement("div",{style:s,className:"keyboard-tag-pane panel"},this.props.keyboardEngine.hasMidiMappings()?r.a.createElement(Zb,{trackNumber:this.props.trackNumber,sequencerEngine:this.props.sequencerEngine,keyboardEngine:this.props.keyboardEngine}):r.a.createElement($l,{trackNumber:this.props.trackNumber,selectedSlice:this.state.selectedSlice,sequencerEngine:this.props.sequencerEngine,keyboardEngine:this.props.keyboardEngine}),r.a.createElement(mk,{selectedSlice:void 0,soundId:this.props.track.soundIds[this.state.samplerNumber]})):"")}}]),t}(a.Component),bk=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={value:n.props.defaultValue},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onChange",value:function(e){this.state.value=e,this.props.change(e),this.setState(this.state)}},{key:"render",value:function(){var e=this,t=!0===this.props.refinedMode?.01:void 0!=this.props.step?this.props.step:this.props.max>1?1:.1;return r.a.createElement("div",{className:"sound-parameter"},r.a.createElement("div",{className:"sound-parameter-name"},this.props.name,": ",this.state.value," ",void 0!==this.props.unit?this.props.unit:""),r.a.createElement(fe.a,{value:this.state.value,change:function(t){return e.onChange(t.target.value)},step:t,max:this.props.max,min:this.props.min,orientation:"horizontal",reversed:!1}))}}]),t}(a.Component),yk={DetailsView:Object(y.b)(function(e){return{showingOnsets:e.waveform.showingOnsets}},function(e){return{setViewMode:function(t){return e(Object(w.ye)(t))},setShowModsModal:function(t){return e(Object(w.rd)(t))},setContextualHelp:function(t){return e(Object(w.V)(t))}}})(gk),Parameter:bk},kk=(n(331),function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"expandToTracks",value:function(){this.props.track.expandRecordedTracks()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"recordings-view"},r.a.createElement("div",{className:"recordings-header sub-header"},"Recordings"),r.a.createElement(A.b,{className:"expand-to-tracks-button",onClick:function(){return e.expandToTracks()},color:"secondary"},"Expand"),this.props.track.soundIds.map(function(t,n){return r.a.createElement(Ek,{track:e.props.track,recording:e.props.track.samplers[t],recordingNumber:n,soundId:t})}))}}]),t}(a.Component)),Ek=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={playing:!0},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onPlayChanged",value:function(e){this.props.track.toggleRecording(this.props.soundId),this.setState(this.state)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"recording"},r.a.createElement("div",{className:"playpause"},r.a.createElement("input",{onChange:function(t){return e.onPlayChanged(t)},checked:!this.props.track.isRecordingPlaying(this.props.soundId),type:"checkbox",value:!this.props.track.isRecordingPlaying(this.props.soundId),id:"playpause"+this.props.recordingNumber,name:"check"}),r.a.createElement("label",{htmlFor:"playpause"+this.props.recordingNumber,tabIndex:1})),"Recording ",this.props.recordingNumber+1)}}]),t}(a.Component),Sk=kk,Ok=function(e){function t(e){var n;Object(o.a)(this,t);void 0===(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).props.track.midiChannel||n.props.track.midiChannel;return n.state={refined:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onChangeDuration",value:function(e){this.props.track.trackData.duration=parseFloat(e),this.setState(this.state)}},{key:"onChangeChop",value:function(e){this.props.track.trackData.chop=parseInt(e),this.setState(this.state)}},{key:"onChangeTranspose",value:function(e){this.props.track.trackData.transpose=parseInt(e),this.setState(this.state)}},{key:"onChangeRefined",value:function(e){this.state.refined="refined"===e,this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.state.refined?.1:1,n=this.state.refined?.2:1,a=this.state.refined?2:64;this.state.enabled;return r.a.createElement("div",null,r.a.createElement("div",{className:"header"},"Midi Track Details"),r.a.createElement("div",{className:"back-button",onClick:function(){return e.props.setViewMode(lo)}},"Go Back"),r.a.createElement("div",{className:"parameters"},r.a.createElement("div",{className:"sub-header"},"Parameters"),r.a.createElement(yk.Parameter,{change:function(t){return e.onChangeDuration(t)},min:n,max:a,step:t,defaultValue:this.props.track.trackData.duration,name:"DURATION"}),r.a.createElement(yk.Parameter,{change:function(t){return e.onChangeChop(t)},min:1,max:32,defaultValue:this.props.track.trackData.chop,name:"CHOP"}),r.a.createElement(yk.Parameter,{change:function(t){return e.onChangeTranspose(t)},min:-42,max:42,defaultValue:this.props.track.trackData.transpose,name:"TRANSPOSE"}),r.a.createElement("form",null,r.a.createElement("div",{className:"refined-checkbox-preferences"},r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",value:"refined",checked:this.state.refined,onChange:function(t){return e.onChangeRefined(t.target.value)}}),"Refine")))),r.a.createElement(Sk,{sequencerEngine:this.props.sequencerEngine,track:this.props.track}))}}]),t}(a.Component),wk=(a.Component,a.Component,function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isEnabled",value:function(){return this.props.isAll?this.props.track.isAllMidiInputsEnabled():this.props.track.getMidiInputs().has(this.props.input)}},{key:"onClickMidiInput",value:function(){this.isEnabled()?this.props.isAll?this.props.track.setAllMidiInputsEnabled(!1):this.props.track.deleteMidiInput(this.props.input):this.props.isAll?this.props.track.setAllMidiInputsEnabled(!0):this.props.track.addMidiInput(this.props.input),this.props.midiInputsChanged(),this.setState(this.state)}},{key:"render",value:function(){var e=this;this.isEnabled();return r.a.createElement("div",{className:this.isEnabled()?"midi-option enabled":"midi-option",onClick:function(){return e.onClickMidiInput()}},this.props.isAll?"ALL":this.props.input.name)}}]),t}(a.Component)),Ck=Object(y.b)(null,function(e){return{setViewMode:function(t){return e(Object(w.ye)(t))}}})(Ok),Pk=function(e,t){return{type:Ca,payload:{event:e,duration:t}}},Tk=function(e,t){return{type:ka,payload:{event:e,duration:t}}},jk=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{type:Ea,payload:{event:e,inPlace:t}}},xk=function(e,t){return{type:Sa,payload:{event:e,subEvent:t}}},Nk=function(e,t){return{type:Oa,payload:{event:e,resolution:t}}},qk=function(e,t){return{type:wa,payload:{event:e,pattern:t}}},Mk=function(e,t,n,a){return{type:Ta,payload:{step:e,selection:t,eventType:n,track:a}}},Dk=function(e,t){return{type:xa,payload:{selection:e,eventType:t}}},Ak=function(e,t,n){return{type:Na,payload:{track:e,pattern:t,startStep:n}}},Rk=function(e,t,n){return{type:qa,payload:{track:e,pattern:t,step:n}}},Ik=function(e,t,n){return{type:Ma,payload:{track:e,pattern:t,step:n}}},Lk=function(e,t){return{type:Da,payload:{track:e,pattern:t}}},Fk=new U.a,Vk=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={selected:!1,resizing:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"onRightMouseDown",value:function(e){(this.props.type!==Mt||this.props.event.value)&&(e.preventDefault(),e.stopPropagation(),this.props.onRightMouseDown())}},{key:"onLeftMouseDown",value:function(e){(this.props.type!==Mt||this.props.event.value)&&(e.preventDefault(),e.stopPropagation(),this.props.onLeftMouseDown())}},{key:"onSelect",value:function(e){(this.props.type!==Mt||this.props.event.value)&&(e.stopPropagation(),this.props.onSelect(e))}},{key:"getText",value:function(){return this.props.type===Ot?this.props.value+1:this.props.type===Mt?this.props.value+" ":void 0}},{key:"getAdditionalStyling",value:function(e){return this.props.type===Mt&&(this.props.event.value||(e.opacity=.001)),e}},{key:"onDragStart",value:function(e){(this.props.type!==Mt||this.props.event.value)&&this.props.onDragStart(e)}},{key:"hasEdges",value:function(){return!(this.props.type===Mt&&!this.props.event.value)}},{key:"render",value:function(){var e,t=this,n=void 0===this.props.duration?64:this.props.duration;if(this.props.isRoll){var a=this.props.event.resolution;e=void 0===a?Fk.getColor(13):Fk.getColor(a.resolution)}else{var s=Math.pow(this.props.subSequence.id+window.a,window.b)+"-"+Math.pow(this.props.value+window.c,window.d);e=Fk.getColorForHash(s,window.brightness)}var i={},o={width:tr(n,this.props.resolution,this.props.xScale)-2,backgroundColor:e};i=this.getAdditionalStyling(i);var c=this.props.isSelected?"pattern selected":"pattern";this.props.isLast&&(c+=" last"),i.width=tr(n,this.props.resolution,this.props.xScale);var u={width:o.width,maxWidth:this.props.maxWidth||o.width};return this.props.isSelected&&e&&(i.border="solid 1px "+Fk.brighten(e,1.5),u.backgroundColor=Fk.brighten(e,.4)),this.props.smallPattern&&(c+=" small-pattern"),r.a.createElement("div",{className:c,onMouseUp:function(e){return t.props.onMouseUp(e)},style:i},r.a.createElement("div",{style:o,onMouseDown:function(e){return t.onSelect(e)},className:"pattern-top"},r.a.createElement(O,{condition:this.hasEdges()},r.a.createElement("div",{onMouseDown:function(e){return t.onLeftMouseDown(e)},onMouseUp:function(e){return t.props.onMouseUp(e)},className:"left-edge"})),r.a.createElement("div",{className:"pattern-number"},this.getText()),r.a.createElement(O,{condition:this.hasEdges()},r.a.createElement("div",{onMouseDown:function(e){return t.onRightMouseDown(e)},onMouseUp:function(e){return t.props.onMouseUp(e)},className:"right-edge"}))),r.a.createElement("div",{style:u,className:"pattern-rest"},r.a.createElement("div",{className:"center"})))}}]),t}(a.Component),Bk=Object(y.b)(function(e,t){var n=e.arrangement.selectedEvents;return{isSelected:void 0!==n&&void 0!==n[t.event.id],duration:t.event.duration,value:t.event.value,xScale:e.arrangement.xScale}},null)(Vk);var Uk=Object(y.b)(function(e,t){return{duration:t.event.duration,subEventsLength:t.event.subEvents.length,xScale:e.arrangement.xScale}},null)(function(e){var t=e.event;if(!t.value){var n={width:tr(e.duration,e.resolution,e.xScale),opacity:.001};return r.a.createElement("div",{className:"empty-roll-event",style:n},r.a.createElement("div",{style:n}))}t.step;var a=tr(t.duration,e.resolution,e.xScale),s={width:a},i=e.event.getSubEvents();return r.a.createElement("div",{style:s,className:"roll-event step-"+e.event.step},i.map(function(t,n){return r.a.createElement(Bk,{subSequence:It,maxWidth:a,key:t.id,eventKey:"roll-"+Math.pow(t.value+4,8),type:Mt,isRoll:!0,resolution:e.resolution,isLast:n===i.length-1,isFirst:0===n,onDragStart:function(e){return[]},onSelect:function(n){e.onSelect(e.event,t,n)},onMouseUp:function(n){return e.onMouseUp(t)},onRightMouseUp:function(n){return e.onRightMouseUp(e.event,t)},onRightMouseDown:function(n){return e.onRightMouseDown(e.event,t)},onLeftMouseUp:function(n){return e.onLeftMouseUp(e.event,t)},onLeftMouseDown:function(n){return e.onLeftMouseDown(e.event,t)},mixSession:e.mixSession,sequencerEngine:e.sequencerEngine,event:t})}))}),Hk=1,Jk=2,Gk={1:300,2:225},zk=36,_k=24;function Wk(e,t){return t*zk*e/2}function Kk(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e=(e-n)/((arguments.length>3&&void 0!==arguments[3]?arguments[3]:1)-n),0===n&&(e=Math.sqrt(e)),Math.max(10,t-e*t)}function Yk(e,t){return 2*e/(zk*t)}function Qk(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=(t-e)/t;return 0===n&&(r=Math.pow(r,2)),Math.max(n,n+r*(a-n))}var Xk=function(){var e=Object(g.a)(v.a.mark(function e(t,n,a,r){var s,i,o,c,u;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=n.track.sequencerEngine.operationManager,i=Yk(t.evt.offsetX,n.xScale),o=n.selectedParameter.automation.getValueAtStep(i),e.next=5,s.dispatch(_i(n.selectedParameter.automation,i,o,Object(We.uuid)()));case 5:return c=e.sent,u=c.point,a(u),r(void 0),e.abrupt("return",u);case 10:case"end":return e.stop()}},e)}));return function(t,n,a,r){return e.apply(this,arguments)}}(),Zk=function(e,t,n){n({step:Yk(e.evt.offsetX,t.xScale),value:Qk(e.evt.offsetY,t.height,t.selectedParameter.min,t.selectedParameter.max)})},$k="#4f4d54";function eE(e){var t=e.value,n=e.x,a=e.y;return t=Math.round(1e3*t)/1e3,r.a.createElement(b.Label,{x:n,y:a},r.a.createElement(b.Tag,{opacity:.6,fill:$k,pointerDirection:"down",pointerHeight:20,pointerWidth:10}),r.a.createElement(b.Text,{fontSize:10,text:t,padding:5,fill:"white"}))}function tE(e){var t=Object(a.useState)(!1),n=Object(Z.a)(t,2),s=n[0],i=n[1],o=Object(a.useCallback)(function(t){i(!0),e.onMouseOver()},[e.onMouseOver,i]),c=Object(a.useCallback)(function(e){i(!1)},[i]);if(void 0===e.selectedParameter)return[];var u=Wk(e.automation.step,e.xScale),l=Kk(e.automation.value,e.height,e.selectedParameter.min,e.selectedParameter.max),p=s?"blue":"black",h=s?"blue":"red",d=s?4:3;return r.a.createElement(b.Group,null,r.a.createElement(b.Circle,{onMouseDown:e.onMouseDown,onMouseUp:e.onMouseUp,onMouseOver:o,onMouseLeave:c,x:u,y:l,radius:d,fill:p,strokeWidth:2,stroke:h}),e.isDragging||s?r.a.createElement(eE,{x:u,y:l,value:e.automation.value}):[])}var nE=function(e,t,n){if(void 0===t.selectedParameter)return[];var a=[];if(0===n.length){var r=t.selectedParameter.get();"string"===typeof r&&(r=new q.a.Time(r).toSeconds()),a=[0,Kk(r,t.height,t.selectedParameter.min,t.selectedParameter.max)]}else a=[0,Kk(n[0].value,t.height,t.selectedParameter.min,t.selectedParameter.max)];for(var s in n)a.push(Wk(n[s].step,t.xScale)),a.push(Kk(n[s].value,t.height,t.selectedParameter.min,t.selectedParameter.max));a[a.length-2];var i=a[a.length-1];return a.push(e),a.push(i),a};function aE(e){if(void 0===e.guidePoint||void 0===e.parameter||void 0!==e.pointDragging)return r.a.createElement(b.Rect,{x:0,y:0,width:0,height:0});var t=Wk(e.guidePoint.step,e.xScale),n=Kk(e.guidePoint.value,e.height,e.parameter.min,e.parameter.max);return r.a.createElement(b.Group,null,r.a.createElement(b.Circle,{onMouseDown:e.onClick,x:t,y:n,radius:4,fill:"#5802d9",stroke:"#5802d9",strokeWidth:2}))}function rE(e){return r.a.createElement(b.Group,null,r.a.createElement(b.Line,{closed:!1,onMouseOver:e.onMouseOverLine,onMouseMove:e.onMouseOverLine,onMouseLeave:function(){return e.setGuidePoint(void 0)},strokeWidth:2,points:e.linePoints,fill:"yellow",stroke:"red"}),r.a.createElement(b.Line,{closed:!1,onMouseOver:e.onMouseOverLine,onMouseMove:e.onMouseOverLine,strokeWidth:16,points:e.linePoints,opacity:0,alpha:0,fill:"yellow",stroke:"red"}))}var sE=Object(y.b)(function(e,t){var n=e.automation.trackParameter[t.track.id];return{numEffects:t.track.effects.length,height:e.arrangement.bottomHeight-62,selectedDevice:e.automation.trackDevice[t.track.id],selectedParameter:n,automation:n&&n.automation,automations:n&&e.automation.parameterAutomations[n.id]}},null)(function(e){var t=e.track.sequencerEngine.operationManager,n=Object(a.useState)(void 0),s=Object(Z.a)(n,2),i=s[0],o=s[1],c=Object(a.useState)(void 0),u=Object(Z.a)(c,2),l=(u[0],u[1]),p=Object(a.useState)(void 0),h=Object(Z.a)(p,2),d=h[0],f=h[1],m=Object(a.useState)(void 0),y=Object(Z.a)(m,2),k=y[0],E=y[1],S=Object(a.useState)(e.automation?e.automation.automations:[]),O=Object(Z.a)(S,2),w=O[0],C=O[1],P=Wk(e.track.pattern.length(),e.xScale),T=nE(P,e,w);Object(a.useEffect)(function(){e.automation&&C(e.automations||[])},[e.automations,C]);var j=Object(a.useCallback)(function(t){Zk(t,e,o)},[o,e.selectedParameter,e.xScale]),x=Object(a.useCallback)(function(){var t=Object(g.a)(v.a.mark(function t(n){var a;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Xk(n,e,l,o);case 2:a=t.sent,E(a),f(!0),C(Object(ge.a)(e.selectedParameter.automations));case 6:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),[e.xScale,e.selectedParameter,l,o,C,f,E]),N=Object(a.useCallback)(function(n){if(k){var a=n.evt.offsetX,r=n.evt.offsetY,s=Yk(a,e.xScale),i=Qk(r,e.height,e.selectedParameter.min,e.selectedParameter.max);t.dispatch(Wi(e.automation,k,s,i)),f(!0),C(Object(ge.a)(e.automation.automations))}},[k,e.automation,e.xScale,e.selectedParameter,e.height,C,f]),q=Object(a.useCallback)(function(){E(void 0),f(!1)},[E,f]),M=Object(a.useCallback)(function(){d||(t.dispatch(Ki(e.automation,k)),C(Object(ge.a)(e.selectedParameter.automations)))},[d,k,e.selectedParameter,e.automation,C]);return r.a.createElement("div",{style:{width:P},onMouseUp:q,onMouseLeave:q,className:"parameter-automation"},r.a.createElement(b.Stage,{width:P,height:e.height,onMouseMove:N},r.a.createElement(b.Layer,null,r.a.createElement(b.Rect,{opacity:0,x:0,y:0,height:e.height,width:P,fill:"black"}),r.a.createElement(rE,{onMouseOverLine:j,setGuidePoint:o,linePoints:T}),r.a.createElement(aE,{parameter:e.selectedParameter,pointDragging:k,xScale:e.xScale,height:e.height,guidePoint:i,onClick:x}),w.map(function(t){return r.a.createElement(tE,{key:"automation-"+t.step,onMouseOver:function(){return o(void 0)},onMouseUp:M,isDragging:t===k,onMouseDown:function(){return E(t)},automation:t,height:e.height,xScale:e.xScale,selectedParameter:e.selectedParameter})}))))}),iE=36,oE=30,cE=24;var uE=Object(y.b)(function(e,t){return{selection:e.keyboard.pianoRollSelection,notes:e.keyboard.notes}},null)(function(e){if(void 0===e.selection||1===e.selection.numNotes&&1===e.selection.numSteps)return r.a.createElement("div",null);var t=e.xScale*iE,n=cE*e.scale,a=(e.notes[0].getTranspose()-e.selection.transpose)*n,s=e.selection.stepNumber*t,i=e.selection.numNotes*n,o=e.selection.numSteps*t,c={left:s,top:a+oE,height:i,width:o};return r.a.createElement("div",{style:c,className:"piano-roll-selection"})});function lE(e){var t=Object(a.useState)(!1),n=Object(Z.a)(t,2),s=n[0],i=n[1],o={height:_k*e.scale},c="C"===e.note.note?"note-blank-side note-c":"note-blank-side",u=e.note.isBlackNote()?"black-note note-name":"white-note note-name";s&&(u+=" triggering");var l=Object(a.useCallback)(function(t){s&&(e.track.midiEffects.liveInputRelease(e.note.getTranspose(),0),i(!1))},[i,e.note,e.track]),p=Object(a.useCallback)(function(t){t.stopPropagation();var n=e.track,a=new ot;a.copyFrom(n.trackData),a.transpose=e.note.getTranspose(),a.slice=0,a.duration=null,n.midiEffects.liveInputTrigger(a),i(!0)},[i,e.note,e.track]),h=Object(a.useCallback)(function(t){t.stopPropagation(),e.track.midiEffects.liveInputRelease(e.note.getTranspose(),0),i(!1)},[i,e.note,e.track]);return r.a.createElement("div",{style:o,draggable:!1,onMouseOver:function(){return e.onMouseOver(e.note)},onMouseDown:function(t){return e.onMouseDown(t)},onMouseMove:function(t){return e.onMouseMove(t)},onMouseUp:function(t){return e.onMouseUp(t)},className:"note-side-info"},r.a.createElement("div",{className:c},r.a.createElement(O,{condition:"C"===e.note.note},e.note.toString())),r.a.createElement("div",{onMouseDown:p,onMouseUp:h,onMouseLeave:l,className:u}))}var pE=Object(y.b)(function(e,t){return{cursor:e.keyboard.cursor}},null)(function(e){if(void 0===e.cursor)return r.a.createElement("div",null);var t={left:Math.max(0,zk*e.xScale*e.cursor-1),height:e.height};return r.a.createElement("div",{style:t,className:"piano-roll-cursor flashit"})}),hE=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e="";e+=this.props.isCurrentStep?" current-step ":"",this.props.stepNumber%4===0&&(e+=" bar");var t={width:36*this.props.xScale,minWidth:36*this.props.xScale,height:this.props.height};return Math.floor(this.props.stepNumber/4)%2==1&&(e+=" odd"),r.a.createElement("div",{style:t,className:e+" time-grid-step"},r.a.createElement(O,{condition:this.props.stepNumber%4===0},this.props.stepNumber%4===0?this.props.stepNumber/16+1:""))}}]),t}(a.Component),dE=Object(y.b)(function(e,t){t.sequencerEngine.getSequenceId();var n=e.sequencer.resolution;if(void 0!==t.track.pattern.startStep)return{resolution:n,isCurrentStep:jo.baseResolution.transformStepAtResolution2(t.stepNumber,n)===t.sequencerEngine.trackStep-t.track.pattern.startStep};var a=Math.floor((t.sequencerEngine.lastTrackStep||0)/(jo.baseResolution.numSteps()/e.sequencer.resolution.numSteps()));return{isCurrentStep:(a%=t.stepsLength)===t.stepNumber,resolution:n}},function(e,t){return{}})(hE),fE=32;var mE=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).mouseDown=!1,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onMouseDown",value:function(e){this.mouseDown=!0,this.dragStartY=e.pageY}},{key:"onMouseUp",value:function(e){this.mouseDown=!1,this.dragStartY=void 0}},{key:"onMouseMove",value:function(e){if(this.mouseDown){this.dragY=e.pageY;var t=this.dragY-this.dragStartY;this.props.zoomHorizontally(t)}}},{key:"render",value:function(){var e=this;if(void 0===this.props.track.pattern)return r.a.createElement("div",null);var t=this.props.track.getStepsAtResolution(this.props.resolution),n={width:36*this.props.xScale*this.props.track.pattern.length(this.props.resolution)};return r.a.createElement("div",{style:n,onMouseLeave:function(t){return e.onMouseUp(t)},onMouseMove:function(t){return e.onMouseMove(t)},onMouseDown:function(t){return e.onMouseDown(t)},onMouseUp:function(t){return e.onMouseUp(t)},draggable:!1,className:"piano-roll-time-row"},t.map(function(t,n){return r.a.createElement(dE,{key:"piano-time-"+n,track:e.props.track,isLooping:e.props.isLooping,height:e.props.height,sequencerEngine:e.props.sequencerEngine,xScale:e.props.xScale,stepsLength:e.props.stepsLength,stepNumber:n})}))}},{key:"isAlternateColor",value:function(e,t,n){return Math.ceil((e+1)/t)%2!=0}},{key:"width",get:function(){return 36*this.props.resolution.resolution/16}}]),t}(a.Component),vE=Object(y.b)(function(e,t){t.sequencerEngine.getSequenceId();var n=e.tracks.trackSteps[t.track.subSequence.isTrack?t.track.subSequence.id:t.track.trackNumber];return{resolution:e.sequencer.resolution,stepsLength:void 0===n?32:n.length}},function(e,t){return{}})(mE),gE=new ht(16,!1),bE=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n.operationManager=n.props.sequencerEngine.operationManager,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getStepNumber",value:function(){return this.props.stepNumber}},{key:"onMouseUp",value:function(e){if(e.preventDefault(),this.getState().keyboard.isMouseDown){var t=this.getStep(),n=this.props.sequencerEngine.store.getState();if(this.getState().keyboard.isDraggingDuration);else if(void 0!==n.keyboard.pianoRollSelection&&n.keyboard.pianoRollSelection.numNotes>1&&n.keyboard.pianoRollSelection.numNotes>1){var a=this.props.track.getEasyPattern().getSelectedPianoRollSteps(n.keyboard.pianoRollSelection,this.resolution);this.props.setSelectedPianoRollSteps(a),this.props.setPianoRollSelection(void 0)}else if(void 0===t||void 0!==this.getState().keyboard.stepDataDragging&&t.id===this.getState().keyboard.stepDataDragging.id||!t.on){if((t!==this.getState().keyboard.stepToCopy||void 0===t||!t.on)&&void 0===this.getState().keyboard.stepDataDragging){var r=new ot;r.on=!0,r.transpose=this.note.getTranspose(),this.operationManager.dispatch(Ai(this.props.track,r,this.getStepNumber(),this.resolution)),this.props.track.updateSteps(),this.props.setPianoRollSelection(void 0),this.props.setSelectedPianoRollSteps(void 0)}}else this.deleteStep(),this.props.track.updateSteps();this.props.mouseDown(!1),this.props.setStepToCopy(void 0),this.props.setIsDraggingDuration(!1),this.props.setStepDataDragging(void 0),this.props.setTransposeDragging(void 0)}}},{key:"dragStepDuration",value:function(){this.props.setIsDraggingDuration(!0)}},{key:"deleteStep",value:function(){this.operationManager.dispatch(Ri(this.props.track,this.getStep(),this.getStepNumber(),this.resolution)),this.props.track.updateSteps()}},{key:"getStep",value:function(){var e=this.props.track.getEasyPattern().getStepWithTranspose(this.getStepNumber(),this.resolution,this.note.getTranspose());return void 0===e?new ot:e}},{key:"onMouseDown",value:function(e){e.preventDefault(),this.props.mouseDown(!0),this.props.setDragStepTranspose(this.note.getTranspose()),this.props.setStepToCopy(this.getStep()),this.props.setTransposeDragging(this.note.getTranspose()),console.log("set step dragging"),this.props.setStepDragging(this.getStepNumber());this.getStep(),this.props.sequencerEngine.store.getState();this.props.setPianoRollSelection(this.getStepNumber(),this.note.getTranspose(),1,1)}},{key:"getOffset",value:function(e){return e.clientX-this.left-62}},{key:"onMouseOver",value:function(e){e.stopPropagation();var t=this.getOffset(e),n=this.props.sequencerEngine.store.getState(),a=n.keyboard.isMouseDown,r=n.keyboard.isCommandDown;this.note.getTranspose();if(void 0!==this.getState().keyboard.stepToCopy||r){this.resolution;var s=n.keyboard.pianoRollSelection;!a||r||this.getState().keyboard.isDraggingDuration||void 0!==s?a&&!this.getState().keyboard.isDraggingDuration?this.updateSelection():a&&this.getState().keyboard.isDraggingDuration&&this.updateDuration():(void 0!==n.keyboard.selectedPianoRollSteps&&n.keyboard.selectedPianoRollSteps.length>1?this.moveSelection(t):this.moveSelection(t,[n.keyboard.stepToCopy]),this.props.setStepDataDragging(n.keyboard.stepToCopy))}}},{key:"getState",value:function(){return this.props.sequencerEngine.store.getState()}},{key:"updateDuration",value:function(){var e=1+this.getStepNumber()-this.getState().keyboard.stepDragging,t=gE.transformStepAtResolution2(e,this.resolution),n=this.props.track.trackData.transpose==this.note.getTranspose(),a=this.getState().keyboard.stepToCopy.getStepDataForTranspose(this.note.getTranspose(),n);if(void 0!==a){var r=t/(null===a.duration?this.props.track.trackData.duration:a.duration);a.duration=t,this.resolution.isTriplet&&this.props.track.pattern.syncBuckets(this.resolution.isTriplet);var s=this.props.sequencerEngine.store.getState();if(void 0!==s.keyboard.selectedPianoRollSteps&&r!==1/0){var i=this.props.track.trackData.duration;s.keyboard.selectedPianoRollSteps.filter(function(e){return e!==a}).forEach(function(e){return e.duration=null!==e.duration?e.duration*r:i*r})}this.props.track.updateSteps()}}},{key:"isSelectedStep",value:function(){return void 0!==this.props.selectedPianoRollSteps&&this.props.selectedPianoRollSteps.indexOf(this.getStep().id)>-1}},{key:"render",value:function(){var e=this,t=this.props.isAlternateColor?"alternate ":"";return t+=this.props.isSelection?" selection ":"",t+=" off grid-step",r.a.createElement("div",{onMouseDown:function(t){return e.onMouseDown(t)},onMouseUp:function(t){return e.onMouseUp(t)},onMouseOver:function(t){return e.onMouseOver(t)},draggable:!1,className:t})}},{key:"note",get:function(){return this.getState().keyboard.notes[this.props.noteIndex]||bs.a.NOTES[0]}},{key:"resolution",get:function(){return this.props.sequencerEngine.store.getState().sequencer.resolution}},{key:"left",get:function(){return 36*this.props.stepNumber}}]),t}(a.Component),yE=(Object(y.b)(null,function(e,t){return{mouseDown:function(t){return e(Object(w.j)(t))},dragToggle:function(t){return e(Object(w.h)(t))},setStepDragging:function(t){return e(Object(w.Nd)(t))},setStepToCopy:function(t){return e(Object(w.Qd)(t))},setTransposeDragging:function(t){return e(Object(w.se)(t))},setDragStepTranspose:function(t){return e(Object(w.g)(t))},setIsDraggingDuration:function(t){return e(Object(w.Gb)(t))},setStepDataDragging:function(t){return e(Object(w.Md)(t))},setPianoRollSelection:function(t,n,a,r){return e(Object(w.qc)(t,n,a,r))},setSelectedPianoRollSteps:function(t){return e(Object(w.Sc)(t))},setPianoRollDragOffset:function(t){return e(Object(w.nc)(t))}}})(bE),new ht(16,!1),jo.baseResolution),kE=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={offset:void 0},n.operationManager=n.props.sequencerEngine.operationManager,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"deleteStep",value:function(){this.operationManager.dispatch(Vi(this.props.track,[this.props.stepData])),this.props.track.updateSteps(),this.props.setSelectedPianoRollSteps(void 0)}},{key:"onMouseDown",value:function(e){e.stopPropagation(),e.preventDefault(),this.props.setPianoRollDragOffset(this.getOffset(e)),this.props.mouseDown(!0),this.props.setDragStepTranspose(this.note.getTranspose()),this.props.setStepToCopy(this.props.stepData),this.props.setTransposeDragging(this.note.getTranspose());var t=this.props.stepData;void 0===this.props.selectedPianoRollSteps||this.props.selectedPianoRollSteps.some(function(e){return e.id===t.id})||this.props.setSelectedPianoRollSteps(void 0)}},{key:"getState",value:function(){return this.props.sequencerEngine.store.getState()}},{key:"onMouseUp",value:function(e){e.stopPropagation(),e.preventDefault();var t=this.props.stepData,n=this.props.sequencerEngine.store.getState();if(n.keyboard.isDraggingDuration);else if(void 0!==n.keyboard.pianoRollSelection&&n.keyboard.pianoRollSelection.numNotes>1&&n.keyboard.pianoRollSelection.numNotes>1){var a=this.props.track.getEasyPattern().getSelectedPianoRollSteps(n.keyboard.pianoRollSelection,this.props.resolution);this.props.setSelectedPianoRollSteps(a),this.props.setPianoRollSelection(void 0)}else void 0===n.keyboard.pianoRollSelection&&(this.isSelectedStep()?void 0!==n.keyboard.stepDataDragging&&t.id===n.keyboard.stepDataDragging.id||(this.deleteStep(),this.props.setSelectedPianoRollSteps(void 0),this.props.track.updateSteps()):(this.props.setSelectedPianoRollSteps([this.props.stepData]),this.props.setPianoRollSelection(void 0)));this.props.mouseDown(!1),this.props.setStepToCopy(void 0),this.props.setIsDraggingDuration(!1),this.props.setStepDataDragging(void 0),this.props.setTransposeDragging(void 0)}},{key:"dragStepDuration",value:function(){this.props.setIsDraggingDuration(!0),this.props.setStepAndDataDragging(parseFloat(this.props.stepNumber)+parseFloat(this.props.position),this.getState().keyboard.stepToCopy)}},{key:"isSelectedStep",value:function(){return void 0!==this.props.selectedPianoRollSteps&&this.props.selectedPianoRollSteps.indexOf(this.props.stepData)>-1}},{key:"moveSteps",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[this.props.stepData],n=this.getOffset(e)/(zk*this.props.xScale),a=this.props.position;n+=parseFloat(a);var r=this.getState().keyboard.dragOffset||0;r/=zk*this.props.xScale,r+=parseFloat(a);var s=parseFloat(n)-parseFloat(r);if(!(Math.abs(s)>1.5)){var i={stepDifference:yE.transformStepAtResolution2(s,this.props.resolution),transposeDifference:0};Math.abs(i.stepDifference)<=.01||Math.abs(i.stepDifference)>=.5||this.operationManager.dispatch(Fi(this.props.track,t,i,yE,!0))}}},{key:"getStepNumber",value:function(e){return(this.scrollLeft+e.pageX-56)/(zk*this.props.xScale)}},{key:"getOffset",value:function(e){return this.scrollLeft+e.pageX-this.getLeft()-62}},{key:"onMouseMove",value:function(e){e.stopPropagation();var t=this.getState(),n=t.keyboard.isMouseDown,a=t.keyboard.pianoRollSelection,r=t.keyboard.isCommandDown;if(!n||r||t.keyboard.isDraggingDuration||void 0!==a){if(n&&this.getState().keyboard.isDraggingDuration){var s=this.getOffset(e)/this.width;this.updateDuration(s+.1)}}else{var i=this.getStepNumber(e);this.props.setStepAndDataDragging(i,t.keyboard.stepToCopy),void 0!==t.keyboard.selectedPianoRollSteps&&t.keyboard.selectedPianoRollSteps.length>1?this.moveSteps(e,t.keyboard.selectedPianoRollSteps):this.moveSteps(e)}}},{key:"updateDuration",value:function(e){var t=this;e=Math.max(.1,e);var n=this.getState().keyboard.stepToCopy.getStepDataForTranspose(this.note.getTranspose(),!0);if(void 0!==n){var a=e/n.duration;this.operationManager.dispatch(Bi(this.props.track,n,n.durationParameter,e));var r=this.getState();if(void 0!==r.keyboard.selectedPianoRollSteps){if(a!==1/0){var s=this.props.track.trackData.duration;r.keyboard.selectedPianoRollSteps.filter(function(e){return e!==n}).forEach(function(e){return t.operationManager.dispatch(Bi(t.props.track,e,e.durationParameter,Math.max(.1,null!==e.duration?e.duration*a:s*a)))})}this.props.track.updateSteps()}this.setState(this.state)}}},{key:"getLeft",value:function(){var e=this.props.position*zk*this.props.xScale;return this.props.stepNumber*zk*this.props.xScale+e}},{key:"onMouseLeave",value:function(){}},{key:"getWidthOfStep",value:function(){return this.width*this.props.stepData.duration}},{key:"render",value:function(){var e=this,t=this.props.isAlternateColor?"alternate ":"";t+=this.isSelectedStep()?" selected ":"";var n={left:this.getLeft(),height:this.props.height,width:this.getWidthOfStep(),backgroundColor:this.props.color};return r.a.createElement("div",{draggable:!1,onMouseMove:function(t){return e.onMouseMove(t)},onMouseLeave:function(t){return e.onMouseLeave()},onMouseDown:function(t){return e.onMouseDown(t)},onMouseUp:function(t){return e.onMouseUp(t)},style:n,className:t+" grid-step toggled-grid-step on"},this.props.on?r.a.createElement("div",{draggable:!1,onMouseDown:function(){return e.dragStepDuration()},className:"right-edge"}):"")}},{key:"scrollLeft",get:function(){if(this.props.parentClassName){var e=this.parentElement||document.getElementsByClassName(this.props.parentClassName)[0];return void 0===this.parentElement&&(this.parentElement=e),e.scrollLeft}return 0}},{key:"width",get:function(){return this.props.xScale*zk*this.props.resolution.resolution/16}},{key:"note",get:function(){return this.getState().keyboard.notes[this.props.noteIndex]||bs.a.NOTES[0]}}]),t}(a.Component),EE=Object(y.b)(null,function(e,t){return{mouseDown:function(t){return e(Object(w.j)(t))},dragToggle:function(t){return e(Object(w.h)(t))},setStepDragging:function(t){return e(Object(w.Nd)(t))},setStepToCopy:function(t){return e(Object(w.Qd)(t))},setTransposeDragging:function(t){return e(Object(w.se)(t))},setDragStepTranspose:function(t){return e(Object(w.g)(t))},setIsDraggingDuration:function(t){return e(Object(w.Gb)(t))},setStepDataDragging:function(t){return e(Object(w.Md)(t))},setStepAndDataDragging:function(t,n){return e(Object(w.Ld)(t,n))},setPianoRollSelection:function(t,n,a,r){return e(Object(w.qc)(t,n,a,r))},setSelectedPianoRollSteps:function(t){return e(Object(w.Sc)(t))},setPianoRollDragOffset:function(t){return e(Object(w.nc)(t))}}})(kE),SE=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isEqual",value:function(e,t){if(void 0===e&&void 0!==t)return!1;if(void 0===t&&void 0!==e)return!1;if(void 0===e&&void 0===t)return!0;if("object"===typeof e){if(Object.keys(e).length!==Object.keys(t).length)return!1}else if(e.length!==t.length)return!1;for(var n in e)if(e[n]!==t[n])return!1;return!0}},{key:"shouldComponentUpdate",value:function(e){return e.track!==this.props.track||!(this.props.currentPattern==e.currentPattern&&this.isEqual(e.rowSteps,this.props.rowSteps)&&this.props.xScale===e.xScale&&this.props.selectedPianoRollSteps===e.selectedPianoRollSteps&&this.isEqual(e.rowDurations,this.props.rowDurations)&&this.isEqual(e.rowPositions,this.props.rowPositions)&&this.props.resolution===e.resolution)}},{key:"render",value:function(){var e=this,t=this.props.rowSteps||{};return r.a.createElement("div",{className:"toggled-piano-roll-steps-container"},Object.keys(t).map(function(t,n){var a=e.getStep(t);return r.a.createElement(EE,{key:"piano-grid-"+n,height:e.props.height,xScale:e.props.xScale,position:e.props.rowPositions[t],sequencerEngine:e.props.sequencerEngine,resolution:e.props.resolution,parentClassName:e.props.parentClassName,color:e.props.color,track:e.props.track,on:!0,selectedPianoRollSteps:e.props.selectedPianoRollSteps,stepData:a,duration:a.duration,stepNumber:t,noteIndex:e.props.noteIndex})}))}},{key:"getStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.note,n=this.props.track.getEasyPattern().getStepWithTranspose(e,this.props.resolution,t.getTranspose());return void 0===n?new ot:n}},{key:"note",get:function(){return this.props.sequencerEngine.store.getState().keyboard.notes[this.props.noteIndex]||bs.a.NOTES[0]}}]),t}(a.Component),OE=Object(y.b)(function(e,t){e.tracks.trackSteps[t.track.subSequence.isTrack?t.track.subSequence.id:t.track.trackNumber];var n=void 0===e.keyboard.notes[t.noteIndex]?0:e.keyboard.notes[t.noteIndex].getTranspose(),a=e.tracks.trackPianoRollSteps[t.track.subSequence.isTrack?t.track.subSequence.id:t.track.trackNumber],r=e.tracks.trackPianoRollPositions[t.track.subSequence.isTrack?t.track.subSequence.id:t.track.trackNumber],s=e.tracks.trackPianoRollDurations[t.track.subSequence.isTrack?t.track.subSequence.id:t.track.trackNumber];return{selectedPianoRollSteps:e.keyboard.selectedPianoRollSteps,rowSteps:a?a[n]:void 0,rowPositions:r?r[n]:void 0,rowDurations:s?s[n]:void 0,resolution:e.sequencer.resolution,currentPattern:void 0===a?void 0:t.sequencerEngine.currentPattern}},null)(SE),wE=new ht(16,!1),CE=jo.baseResolution,PE=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).operationManager=n.props.sequencerEngine.operationManager,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getState",value:function(){return this.props.sequencerEngine.store.getState()}},{key:"isEqual",value:function(e,t){if(void 0===e&&void 0!==t)return!1;if(void 0===t&&void 0!==e)return!1;if(void 0===e&&void 0===t)return!0;if("object"===typeof e){if(Object.keys(e).length!==Object.keys(t).length)return!1}else if(e.length!==t.length)return!1;for(var n in e)if(e[n]!==t[n])return!1;return!0}},{key:"shouldComponentUpdate",value:function(e){return e.track!==this.props.track||(e.stepsLength!==this.props.stepsLength||e.height!==this.props.height||e.xScale!==this.props.xScale||!this.isEqual(e.selection,this.props.selection))}},{key:"onMouseUp",value:function(e){if(e.preventDefault(),this.getState().keyboard.isMouseDown){var t=this.getStep(e),n=this.props.sequencerEngine.store.getState();if(this.getState().keyboard.isDraggingDuration);else if(void 0!==n.keyboard.pianoRollSelection&&n.keyboard.pianoRollSelection.numNotes>1&&n.keyboard.pianoRollSelection.numNotes>1){var a=this.props.track.getEasyPattern().getSelectedPianoRollSteps(n.keyboard.pianoRollSelection,this.resolution);this.props.setSelectedPianoRollSteps(a),this.props.setPianoRollSelection(void 0)}else if(void 0===t||void 0!==this.getState().keyboard.stepDataDragging&&t.id===this.getState().keyboard.stepDataDragging.id||!t.on){if(this.cursor!==Math.floor(this.getStepNumber(e))){var r=Math.floor(this.getStepNumber(e));this.props.setPianoRollCursor(r),this.props.sequencerEngine.cursor.setStep(r,this.props.resolution),this.props.setArrangementMouseX(void 0),this.props.setPianoRollSelection(void 0)}else if((t!==this.getState().keyboard.stepToCopy||void 0===t||!t.on)&&void 0===this.getState().keyboard.stepDataDragging){var s=new ot;s.on=!0,s.transpose=this.note.getTranspose(),this.operationManager.dispatch(Ai(this.props.track,s,Math.floor(this.getStepNumber(e)),this.resolution)),this.props.setSelectedPianoRollSteps(void 0),this.props.setPianoRollSelection(void 0),this.props.setPianoRollCursor(void 0),this.props.track.updateSteps()}}else this.deleteStep(e),this.props.track.updateSteps();this.props.mouseDown(!1),this.props.setStepToCopy(void 0),this.props.setIsDraggingDuration(!1),this.props.setStepDataDragging(void 0),this.props.setTransposeDragging(void 0)}}},{key:"onMouseDown",value:function(e){e.preventDefault(),this.props.mouseDown(!0),this.props.setDragStepTranspose(this.note.getTranspose()),this.props.setStepToCopy(this.getStep(e)),this.props.setTransposeDragging(this.note.getTranspose()),this.props.setStepDragging(this.getStepNumber(e));this.getStep(e),this.props.sequencerEngine.store.getState();this.props.setPianoRollSelection(this.getStepNumber(e),this.note.getTranspose(),1,1)}},{key:"getStepNumber",value:function(e){return(this.scrollLeft+e.pageX-56)/(zk*this.props.xScale)}},{key:"getOffset",value:function(e){return this.scrollLeft+e.pageX-this.getLeft(e)-62}},{key:"getLeft",value:function(e){return this.getStepNumber(e)*zk*this.props.xScale}},{key:"onMouseOver",value:function(e){var t=e.pageX,n=(this.scrollLeft,this.props.sequencerEngine.store.getState()),a=n.keyboard.isMouseDown,r=n.keyboard.isCommandDown;this.note.getTranspose();if(void 0!==this.getState().keyboard.stepToCopy||r){this.resolution;var s=n.keyboard.pianoRollSelection;!a||r||this.getState().keyboard.isDraggingDuration||void 0!==s?a&&!this.getState().keyboard.isDraggingDuration?this.updateSelection(e):a&&this.getState().keyboard.isDraggingDuration&&this.updateDuration(e):(void 0!==n.keyboard.selectedPianoRollSteps&&n.keyboard.selectedPianoRollSteps.length>1?this.moveSelection(t):this.moveSelection(t,[n.keyboard.stepToCopy]),this.props.setStepDataDragging(n.keyboard.stepToCopy))}}},{key:"updateDuration",value:function(e){var t=this,n=this.getOffset(e)/(zk*this.props.xScale)+this.getStepNumber(e)-this.getState().keyboard.stepDragging,a=Math.max(.1,wE.transformStepAtResolution2(n,this.resolution)),r=(this.props.track.trackData.transpose,this.note.getTranspose(),this.getState().keyboard.stepToCopy);if(void 0!==r){var s=a/(null===r.duration?this.props.track.trackData.duration:r.duration);this.operationManager.dispatch(Bi(this.props.track,r,r.durationParameter,a)),this.resolution.isTriplet&&this.props.track.pattern.syncBuckets(this.resolution.isTriplet);var i=this.props.sequencerEngine.store.getState();if(void 0!==i.keyboard.selectedPianoRollSteps&&s!==1/0){var o=this.props.track.trackData.duration;i.keyboard.selectedPianoRollSteps.filter(function(e){return e!==r}).forEach(function(e){return t.operationManager.dispatch(Bi(t.props.track,e,e.durationParameter,Math.max(.1,null!==e.duration?e.duration*s:o*s)))})}this.props.track.updateSteps()}}},{key:"getStep",value:function(e){var t=this.props.track.getEasyPattern(),n=this.getStepNumber(e);if(n>0)return new ot;var a=t.getStepWithTranspose(n,this.resolution,this.note.getTranspose());return void 0===a?new ot:a}},{key:"moveSelection",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getState().keyboard.selectedPianoRollSteps,n=(this.props.track.getEasyPattern(),this.getTransformation(e));if(!(Math.abs(n.stepDifference)<=.01&&0===n.transposeDifference)){this.operationManager.dispatch(Fi(this.props.track,t,n,CE,!0));var a=this.getStepNumber({pageX:e});this.props.setStepDragging(a),this.props.setTransposeDragging(this.note.getTranspose())}}},{key:"getTransformation",value:function(e){var t=this.props.sequencerEngine.store.getState(),n=this.getStepNumber({pageX:e})-t.keyboard.stepDragging,a=void 0===t.keyboard.transposeDragging?this.props.track.trackData.transpose:t.keyboard.transposeDragging,r=this.note.getTranspose()-a;return{stepDifference:CE.transformStepAtResolution2(n,this.props.resolution),transposeDifference:r}}},{key:"updateSelection",value:function(e){var t=this.props.sequencerEngine.store.getState(),n=this.note.getTranspose(),a=t.keyboard.pianoRollSelection;if(void 0!==a){var r=this.getStepNumber(e);this.props.setPianoRollSelection(a.stepNumber,a.transpose,1+r-a.stepNumber,1+a.transpose-n)}}},{key:"moveStep",value:function(e){var t=this.note.getTranspose();this.props.track.getEasyPattern().deleteStep(this.getState().keyboard.stepToCopy),this.operationManager.dispatch(Ri(this.props.track,this.getState().keyboard.stepToCopy,this.getState().keyboard.stepDragging,this.resolution)),this.getState().keyboard.stepToCopy.transpose=t,this.operationManager.dispatch(Ai(this.props.track,this.getState().keyboard.stepToCopy,this.getStepNumber({pageX:e}),this.resolution))}},{key:"deleteStep",value:function(e){this.operationManager.dispatch(Ri(this.props.track,this.getStep(e),this.getStepNumber(e),this.resolution)),this.props.setSelectedPianoRollSteps(void 0),this.props.track.updateSteps()}},{key:"render",value:function(){var e=this;this.props.scale,parseInt(this.props.resolution.numSteps());return r.a.createElement("div",{onMouseDown:function(t){return e.onMouseDown(t)},onMouseUp:function(t){return e.onMouseUp(t)},onMouseMove:function(t){return e.onMouseOver(t)},className:"grid-steps-container"},r.a.createElement(OE,{color:this.props.color,stepsLength:this.props.stepsLength,parentClassName:this.props.parentClassName,noteIndex:this.props.noteIndex,xScale:this.props.xScale,sequencerEngine:this.props.sequencerEngine,height:this.props.height,track:this.props.track}))}},{key:"isStepInSelection",value:function(e,t){return void 0!==e&&(t>=e.stepNumber&&t<e.stepNumber+e.numSteps)}},{key:"isAlternateColor",value:function(e,t,n){return Math.ceil((e+1)/t)%2!=0}},{key:"resolution",get:function(){return this.props.resolution}},{key:"note",get:function(){return this.getState().keyboard.notes[this.props.noteIndex]||bs.a.NOTES[0]}},{key:"cursor",get:function(){return this.getState().keyboard.cursor}},{key:"scrollLeft",get:function(){if(this.props.parentClassName){var e=this.parentElement||document.getElementsByClassName(this.props.parentClassName)[0];return void 0===this.parentElement&&(this.parentElement=e),e.scrollLeft}return 0}}]),t}(a.Component);function TE(e,t){if(void 0!==e)return t<=e.transpose&&t>e.transpose-e.numNotes?e:void 0}var jE=Object(y.b)(function(e,t){var n=e.tracks.trackSteps[t.track.subSequence.isTrack?t.track.subSequence.id:t.track.trackNumber],a=e.keyboard.notes[t.noteIndex],r=void 0===a?0:a.getTranspose();return{resolution:e.sequencer.resolution,stepsLength:void 0===n?16:n.length,selection:TE(e.keyboard.pianoRollSelection,r)}},function(e,t){return{mouseDown:function(t){return e(Object(w.j)(t))},dragToggle:function(t){return e(Object(w.h)(t))},setStepDragging:function(t){return e(Object(w.Nd)(t))},setStepToCopy:function(t){return e(Object(w.Qd)(t))},setTransposeDragging:function(t){return e(Object(w.se)(t))},setDragStepTranspose:function(t){return e(Object(w.g)(t))},setIsDraggingDuration:function(t){return e(Object(w.Gb)(t))},setStepDataDragging:function(t){return e(Object(w.Md)(t))},setPianoRollSelection:function(t,n,a,r){return e(Object(w.qc)(t,n,a,r))},setSelectedPianoRollSteps:function(t){return e(Object(w.Sc)(t))},setPianoRollDragOffset:function(t){return e(Object(w.nc)(t))},setPianoRollCursor:function(t){return e(Object(w.mc)(t))},setArrangementMouseX:function(t){return e(Object(w.B)(t))}}})(PE),xE=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={triggering:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onMouseLeave",value:function(e){this.state.triggering&&(this.triggerRelease(e),this.setState({triggering:!1}))}},{key:"triggerAttack",value:function(e){e.stopPropagation();var t=this.props.track,n=new ot;n.copyFrom(t.trackData),n.transpose=this.transpose,n.slice=this.sliceNumber,n.duration=null,t.midiEffects.liveInputTrigger(n),this.setState({triggering:!0})}},{key:"triggerRelease",value:function(e){e.stopPropagation(),this.props.track.midiEffects.liveInputRelease(this.transpose,0),this.setState({triggering:!1})}},{key:"render",value:function(){var e=_k*this.props.scale;if(void 0===this.props.track.pattern)return r.a.createElement("div",null);var t={height:e,width:zk*this.props.xScale*this.props.track.pattern.length(this.props.resolution)},n="piano-roll-row";n+=this.props.note.isBlackNote()?" black":"";this.props.note.note,this.props.note.isBlackNote();return this.state.triggering&&" triggering",r.a.createElement("div",{draggable:!1,style:t,className:n},r.a.createElement(jE,{height:e,color:this.props.color,parentClassName:this.props.parentClassName,sequencerEngine:this.props.sequencerEngine,track:this.props.track,xScale:this.props.xScale,noteIndex:this.props.noteIndex}))}},{key:"transpose",get:function(){return this.props.note.getTranspose()}}]),t}(a.Component),NE=Object(y.b)(null,null)(xE),qE=jo.baseResolution,ME=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getOptions",value:function(){for(var e=2*this.value,t=(this.props.resolution.resolution,[]);e>1;)t.push({label:e,value:e}),e-=4;return t}},{key:"getOptionFromValue",value:function(e){for(var t=this.getOptions(),n=0;n<t.length;n++)if(t[n].value==e)return t[n];return null}},{key:"onChangeLength",value:function(e,t){e=qE.transformStepAtResolution2(e,this.props.resolution),this.props.track.pattern.changeLength(e),this.props.track.updateSteps(),this.setState(this.state)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"track-length-container"},r.a.createElement("div",{className:"length-label"},"LENGTH"),r.a.createElement(pp.a,{className:"osc-type-dropdown",controlClassName:"osc-type-control-dropdown",arrowClassName:"osc-type-arrow-dropdown",options:this.getOptions(),onChange:function(t,n){return e.onChangeLength(t.value,n)},value:this.getOptionFromValue(this.value),placeholder:"Length"}))}},{key:"value",get:function(){return this.props.track.pattern.length(this.props.resolution)}}]),t}(a.Component),DE=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={transcribing:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"transcribeButton",value:function(){var e=this;this.setState({transcribing:!0,loadingText:"Transcribing to MIDI..."}),setTimeout(function(){e.props.sequencerEngine.transcribeIntoMidi(e.props.track).then(function(){e.setState({transcribing:!1}),e.props.setTrackFocused(e.props.sequencerEngine.tracks.length-1)})},100)}},{key:"hasTracksToResample",value:function(){return void 0!==this.props.tracksToResample&&this.props.tracksToResample.length>0}},{key:"isTranscribing",value:function(){return void 0!==this.state.transcribing&&this.state.transcribing}},{key:"isLoading",value:function(){return this.isTranscribing()}},{key:"getLoadingText",value:function(){return this.isTranscribing()?"Transcribing to MIDI... ":this.hasTracksToResample()?"Waiting to resample... ":this.props.isResampling?"Resampling... ":void 0}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(e),this.props.setContextualHelp(t)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"piano-roll-toolbar"},r.a.createElement(O,{condition:this.props.track.getTrackType()===zn},r.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"TRANSCRIBE")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},draggable:!1,onClick:function(){return e.transcribeButton()},className:"transcribe-button"},"TRANSCRIBE")),r.a.createElement(O,{condition:this.isLoading()},this.getLoadingText()),r.a.createElement(V.a,{sizeUnit:"px",size:10,color:"#123abc",loading:this.isLoading()}),r.a.createElement(ME,{onChange:this.props.onChangeLength,resolution:this.props.resolution,track:this.props.track}))}}]),t}(a.Component),AE=Object(y.b)(function(e,t){return{tracksToResample:e.tracks.tracksToResample,isResampling:e.tracks.isResampling,resampleDuration:e.tracks.resampleDuration,resolution:e.sequencer.resolution}},function(e,t){return{setTracksToResample:function(t){return e(Object(w.re)(t))},setTrackFocused:function(t){return e(Object(w.de)(t))},setResampleDuration:function(t){return e(Object(w.vc)(t))},setContextualHelp:function(t){return e(Object(w.V)(t))}}})(DE),RE=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getStart",value:function(){return void 0!==this.props.paginationStart?this.props.paginationStart:this.props.start}},{key:"getEnd",value:function(){return void 0!==this.props.paginationEnd?this.props.paginationEnd:this.props.end}},{key:"onClickPreviousPage",value:function(){this.props.setPianoRollPagination(this.getStart()-fE,this.getEnd()-fE)}},{key:"onClickNextPage",value:function(){this.props.setPianoRollPagination(this.getStart()+fE,this.getEnd()+fE)}},{key:"onClickUnlock",value:function(){this.props.setPianoRollPagination(void 0,void 0)}},{key:"render",value:function(){var e,t,n=this;return r.a.createElement("div",{className:"pagination-buttons"},r.a.createElement("div",{className:"page-info"},(t=this.getStart(),1+Math.floor(t/32))," / ",(e=this.props.stepsLength)<fE?1:Math.floor(e/32)),void 0!==this.props.paginationStart?r.a.createElement("div",{className:"unlock-button",onClick:function(){return n.onClickUnlock()}},"UNLOCK"):"",function(e){return e-fE>=0}(this.getStart())?r.a.createElement("div",{onClick:function(){return n.onClickPreviousPage()},className:"previous-page-button"},"PREVIOUS"):"",function(e,t){return e+fE<=t}(this.getEnd(),this.props.stepsLength)?r.a.createElement("div",{onClick:function(){return n.onClickNextPage()},className:"next-page-button"},"NEXT"):"")}}]),t}(a.Component),IE=(Object(y.b)(function(e,t){var n=e.tracks.trackSteps[t.track.trackNumber],a=t.sequencerEngine.getSequenceId(),r=Math.floor((e.sequencer.currentStep[a]||0)/(jo.baseResolution.numSteps()/e.sequencer.resolution.numSteps()));r=void 0===n?0:r%n.length;var s=void 0===n?0:function(e,t){var n=0,a=t;return e%fE==0?(n=e,a=e+fE):(n=32*Math.floor(e/32),a=32*(Math.floor(e/32)+1)),a>=t&&(a=t),{start:n,end:a}}(r,n.length);return{stepsLength:void 0==n?16:n.length,paginationStart:void 0===e.keyboard.pianoRollPagination?void 0:e.keyboard.pianoRollPagination.start,paginationEnd:void 0===e.keyboard.pianoRollPagination?void 0:e.keyboard.pianoRollPagination.end,start:s.start,end:s.end}},function(e,t){return{setPianoRollPagination:function(t,n){return e(Object(w.pc)(t,n))}}})(RE),n(2338),{}),LE=.35,FE=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={loading:!1,notes:[],overZoom:!1,xScale:Math.max(LE,n.getMinXScale())},n.scale=.5,n.note=n.getInitialNote(),n.updateNotes(),n.lastKeyDownEvent=void 0,n.operationManager=n.props.sequencerEngine.operationManager,n.onKeyDown=n.onKeyDown.bind(Object(p.a)(n)),n.onKeyUp=n.onKeyUp.bind(Object(p.a)(n)),n.onWheel=n.onWheel.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getInitialNote",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,t=0,n=0;if(void 0===e.track.pattern)return bs.a.NOTES[0];for(var a in e.pattern.stepBucketsMatrix){var r=e.pattern.stepBucketsMatrix[a];for(var s in r.steps){t+=r.steps[s].transpose,n++}}if(0===n)return bs.a.NOTES[0];var i=Math.floor(t/n);return bs.a.fromTranspose(i)}},{key:"shouldComponentUpdate",value:function(e){return e.stepsLength!==this.props.stepsLength&&(this.state.xScale=Math.max(LE,this.getMinXScale(e))),void 0!==e.mouseX&&e.mouseX!==this.props.mouseX&&this.updateCursorFromArrangement(e),(e.bottomHeight!==this.props.bottomHeight||e.track!==this.props.track||!e.isPlayingMix&&e.pattern!==this.props.pattern&&void 0!==e.track)&&(this.note=this.getInitialNote(e),this.updateNotes(e)),!0}},{key:"updateNotes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,t=[],n=void 0===this.noteIndex?Math.floor(this.getNumNotes(e)/2):Math.floor(this.noteIndex/this.scale),a=this.state.zoomedNote,r=Math.floor(this.state.zoomedNoteRatio*this.getNumNotes(e)),s=void 0===a?this.note.addTranspose(n):a.addTranspose(r);(s.getTranspose()>=92||s.getTranspose()-this.getNumNotes(e)<-36)&&(s=bs.a.fromTranspose(-36+this.getNumNotes(e)));for(var i=0;i<this.getNumNotes(e);i++)t.push(s.addTranspose(-1*i));this.props.setPianoRollNotes(t)}},{key:"componentDidMount",value:function(){if(window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),window.addEventListener("mousewheel",this.onWheel,{passive:!1}),void 0!==this.props.mouseX)this.updateCursorFromArrangement()}},{key:"updateCursorFromArrangement",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,t=this.props.sequencerEngine.store.getState(),n=Us(e.mouseX,e.resolution,void 0,t.arrangement.xScale)/2;if(void 0!==e.track.pattern.startStep&&(n-=e.resolution.transformStepAtResolution2(e.track.pattern.startStep,jo.baseResolution)),!(n>=e.pattern.length()/2||n<0)){this.props.setPianoRollCursor(n);var a=55+36*n*this.state.xScale;return document.getElementsByClassName("piano-roll-wrapper")[0].scrollLeft=a-200,n}}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp),window.removeEventListener("mousewheel",this.onWheel),this.props.installation||this.props.track.getEasyPattern().update()}},{key:"onKeyUp",value:function(e){"Space"!==e.key&&(void 0,delete IE[e.keyCode],91==e.keyCode&&(IE={}))}},{key:"onKeyDown",value:function(e){if("Space"!==e.key){if(IE[e.keyCode])return"a"!==e.key||!e.metaKey||(e.preventDefault(),!1);if(IE[e.keyCode]=!0,e,"Backspace"===e.key)this.deleteSelectedSteps();else if("a"===e.key){if(e.metaKey)return this.hasSelection()?this.unselectSteps():this.selectAllSteps(),e.preventDefault(),!1}else if("c"===e.key){if(e.metaKey)return this.copySteps(),e.preventDefault(),!1}else if("v"===e.key&&e.metaKey)return this.pasteSteps(),e.preventDefault(),!1}}},{key:"getSelectedSteps",value:function(){return this.props.sequencerEngine.store.getState().keyboard.selectedPianoRollSteps}},{key:"hasSelection",value:function(){var e=this.getSelectedSteps();return void 0!==e&&e.length>0}},{key:"unselectSteps",value:function(){this.props.setSelectedPianoRollSteps(void 0)}},{key:"selectAllSteps",value:function(){var e=this.props.track.getEasyPattern().getAllSteps();this.props.setSelectedPianoRollSteps(e)}},{key:"copySteps",value:function(){this.props.setStepsToCopy(this.getSelectedSteps()),this.props.setEasyPatternToCopy(this.props.track.getEasyPattern())}},{key:"pasteSteps",value:function(){var e=this.props.sequencerEngine.store.getState();this.props.track.getEasyPattern().pasteSteps(e.keyboard.stepsToCopy,void 0===this.cursor?void 0:{stepNumber:this.cursor},e.keyboard.easyPatternToCopy,e.sequencer.resolution),this.props.track.updateSteps()}},{key:"deleteSelectedSteps",value:function(){void 0!==this.selectedPianoRollSteps&&(this.operationManager.dispatch(Vi(this.props.track,this.selectedPianoRollSteps)),this.props.track.updateSteps(),this.props.setSelectedPianoRollSteps(void 0))}},{key:"getNumNotes",value:function(){var e=17*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props).bottomHeight/460;return Math.max(Math.ceil(e/this.scale),1)}},{key:"onMouseDown",value:function(e,t,n){this.mouseDown=!0,this.dragStartY=e.pageY,void 0===this.dragStartX&&(this.dragStartX=e.pageX),this.setState({zoomedNote:t,zoomedNoteRatio:n/this.getNumNotes()})}},{key:"onMouseUp",value:function(e){this.mouseDown=!1,this.dragStartX=void 0}},{key:"scrollVertically",value:function(e){var t=this.props.notes[0].getTranspose();if(!(this.props.notes[this.props.notes.length-1].getTranspose()+e<-36)&&!(t+e>92)){var n=this.props.notes.map(function(t){return t.addTranspose(e)});this.note=this.props.notes[0],this.props.setPianoRollNotes(n)}}},{key:"onMouseMove",value:function(e){if(this.mouseDown){this.dragY=e.pageY;var t=this.dragY-this.dragStartY,n=Math.floor(t/this.scale/60);Math.abs(n)>=1&&this.scrollVertically(n);var a=e.pageX-this.dragStartX;if(Math.abs(a)<=2)return;this.scale+=a/50,this.scale<=.4&&(this.scale=.4),this.scale>=2&&(this.scale=2),this.updateNotes()}}},{key:"onMouseLeave",value:function(e){this.props.mouseDown(!1),this.mouseDown=!1,clearInterval(this.octaveTimer);var t=this.props.sequencerEngine.store.getState();if(void 0!==t.keyboard.pianoRollSelection){var n=this.props.track.getEasyPattern().getSelectedPianoRollSteps(t.keyboard.pianoRollSelection,this.props.resolution);this.props.setSelectedPianoRollSteps(n),this.props.setPianoRollSelection(void 0)}}},{key:"onWheel",value:function(e){if(this.mouseOverPianoRoll){if(e.ctrlKey)e.preventDefault(),e.stopPropagation(),this.scale-=.01*e.deltaY,this.scale<=.4&&(this.scale=.4),this.updateNotes();else{if(Math.abs(e.wheelDeltaX)>=5&&Math.abs(e.wheelDeltaY)<=10)return!1;e.preventDefault(),e.stopPropagation();var t=e.wheelDeltaY/this.scale/40;t=t<0?Math.ceil(t):Math.floor(t),this.scrollVertically(t)}return!1}}},{key:"getMinXScale",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,t=(window.innerWidth-80)/(36*e.stepsLength);return Math.max(LE,t)}},{key:"zoomHorizontally",value:function(e){var t=this.state.xScale+e/50;t<this.getMinXScale()||t>this.maxXScale||this.setState({xScale:t})}},{key:"onMouseOverNote",value:function(e,t){this.mouseDown||(this.note=e,this.noteIndex=t)}},{key:"onChangeLength",value:function(){this.setState({xScale:this.minXScale})}},{key:"onMouseOverPianoRoll",value:function(e){this.mouseOverPianoRoll=e}},{key:"render",value:function(){var e=this;if(void 0===this.props.track.pattern)return r.a.createElement("div",null);var t={height:_k*this.props.scale+50};return r.a.createElement("div",{draggable:!1,className:"piano-roll-container"},r.a.createElement(O,{condition:!this.props.hideToolbar},r.a.createElement(AE,{sequencerEngine:this.props.sequencerEngine,track:this.props.track})),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement("div",{onMouseOver:function(t){return e.onMouseOverPianoRoll(!0)},onMouseLeave:function(t){return e.onMouseOverPianoRoll(!1)},className:"whole-wrapper"},r.a.createElement("div",{className:"notes-side-panel"},this.props.notes.map(function(t,n){return r.a.createElement(lE,{scale:e.scale,onMouseOver:function(t){return e.onMouseOverNote(t,n)},onMouseDown:function(a){return e.onMouseDown(a,t,n)},onMouseUp:function(t){return e.onMouseUp(t)},onMouseMove:function(t){return e.onMouseMove(t)},note:t,track:e.props.track})})),r.a.createElement("div",{style:t,draggable:!1,onMouseUp:function(){return e.onMouseUp()},onMouseLeave:function(){return e.onMouseLeave()},className:"piano-roll-wrapper"},r.a.createElement(vE,{height:this.props.bottomHeight,isLooping:this.props.isLooping,zoomHorizontally:function(t){return e.zoomHorizontally(t)},xScale:this.state.xScale,resolution:this.props.resolution,track:this.props.track,sequencerEngine:this.props.sequencerEngine}),r.a.createElement(pE,{height:this.props.bottomHeight-20,xScale:this.state.xScale,scale:this.scale}),r.a.createElement(uE,{xScale:this.state.xScale,scale:this.scale}),this.props.notes.map(function(t,n){return r.a.createElement(NE,{xScale:e.state.xScale,key:"note-"+n,noteIndex:n,color:e.props.color,scale:e.scale,parentClassName:"piano-roll-wrapper",onMouseOver:function(t){return e.onMouseOverNote(t,n)},resolution:e.props.resolution,onMouseDown:function(a){return e.onMouseDown(a,t,n)},onMouseUp:function(t){return e.onMouseUp(t)},onMouseMove:function(t){return e.onMouseMove(t)},sequencerEngine:e.props.sequencerEngine,track:e.props.track,note:t})}),this.props.showAutomation?r.a.createElement(sE,{sequencerEngine:this.props.sequencerEngine,xScale:this.state.xScale,track:this.props.track}):"")))}},{key:"cursor",get:function(){return this.props.sequencerEngine.store.getState().keyboard.cursor}},{key:"selectedPianoRollSteps",get:function(){return this.props.sequencerEngine.store.getState().keyboard.selectedPianoRollSteps}},{key:"maxScale",get:function(){return 3}}]),t}(a.Component),VE=Object(y.b)(function(e,t){var n=void 0===t.track?void 0:e.tracks.trackSteps[t.track.subSequence.isTrack?t.track.subSequence.id:t.track.trackNumber];return{stepsLength:void 0===n?16:n.length,resolution:e.sequencer.resolution,tracksToResample:e.tracks.tracksToResample,notes:e.keyboard.notes,mouseX:e.arrangement.mouseX,bottomHeight:"ARRANGEMENT_VIEW"===e.sequencer.viewMode||t.installation?e.arrangement.bottomHeight:550,pattern:t.track?t.track.pattern:void 0,isPlayingMix:e.mix.isPlayingMix,showAutomation:e.automation.show}},function(e,t){return{mouseDown:function(t){return e(Object(w.j)(t))},setTrackFocused:function(t){return e(Object(w.de)(t))},setSelectedPianoRollSteps:function(t){return e(Object(w.Sc)(t))},setPianoRollSelection:function(t,n,a,r){return e(Object(w.qc)(t,n,a,r))},setStepsToCopy:function(t){return e(Object(w.Sd)(t))},setEasyPatternToCopy:function(t){return e(Object(w.jb)(t))},setTracksToResample:function(t){return e(Object(w.re)(t))},setPianoRollNotes:function(t){return e(Object(w.oc)(t))},setPianoRollCursor:function(t){return e(Object(w.mc)(t))},setSelectorMode:function(t){return e(Object(w.bd)(t))},setSidebarViewMode:function(t){return e(Object(w.Gd)(t))},setArrangementPatternDragging:function(t){return e(Object(w.C)(t))}}})(FE);var BE=Object(y.b)(function(e,t){t.sequencerEngine.engineId;return{bottomHeight:e.arrangement.bottomHeight,bottomMode:e.arrangement.bottomMode,selectedRows:e.arrangement.selectedRows}},function(e){return{setArrangementBottomResizing:function(t){return e(Object(w.x)(t))}}})(function(e){var t={height:e.bottomHeight},n=Object(a.useCallback)(function(){e.setArrangementBottomResizing(!1)},[e.setArrangementBottomResizing]),s=e.selectedRows[0],i="";if(s){var o=e.sequencerEngine.getSubSequence(s);if(o&&1===o.tracks.length){var c=o.tracks[0];i=e.bottomMode===Jk?Qf(c):r.a.createElement(VE,{parentClassName:"arrangement-bottom-container",isLooping:!1,sequencerEngine:e.sequencerEngine,hideToolbar:!0,track:c})}}return Object(a.useEffect)(function(){e.bottomMode},[e.bottomMode,s]),r.a.createElement("div",{onMouseUp:n,style:t,className:"arrangement-bottom-container"},i)}),UE=300,HE=50;var JE=Object(y.b)(null,function(e){return{setArrangementBottomResizing:function(t){return e(Object(w.x)(t))},setArrangementBottomHeight:function(t){return e(Object(w.v)(t))}}})(function(e){var t=Object(a.useState)(void 0),n=Object(Z.a)(t,2),s=n[0],i=n[1],o=Object(a.useCallback)(function(t){e.setArrangementBottomResizing(!0);var n=(new Date).getTime();void 0!==s&&n-s<=UE&&(e.sequencerEngine.store.getState().arrangement.bottomHeight<=HE?e.setArrangementBottomHeight(Gk[Hk]):e.setArrangementBottomHeight(0)),i(n)},[s,i]);return r.a.createElement("div",{onMouseDown:o,className:"arrangement-resizing-edge"})});function GE(e){var t=e.root,n=Object(a.useState)(t.subFolders),s=Object(Z.a)(n,2),i=s[0],o=s[1];Object(a.useEffect)(function(){e.root.isLoaded||e.root.load().then(function(){return o(Object(ge.a)(e.root.subFolders))})},[e.root]);var c=function(t){console.log("choose item ",t);var n=t.fromData;e.sequencerEngine.loadSampleFromSequence(t.getId(),n)},u=function(e){console.log("choose folder ",e)},l=function(e){},p=Object(ge.a)(i);return p.length>500&&(p=i.slice(0,500)),r.a.createElement("div",{className:"folders-container xanadu-folders"},p.map(function(e){return r.a.createElement(fb,{key:e.name,onFoldersUpdated:function(){return[]},onChooseItem:c,onChooseFolder:u,onTestItem:l,showItems:!0,folder:e})}))}var zE=30,_E="PRESETS",WE="SEQUENCES";var KE=Object(y.b)(function(e,t){return{mode:e.arrangement.browserMode}},null)(function(e){var t=Object(a.useState)(!1),n=Object(Z.a)(t,2),s=n[0],i=n[1],o=Object(a.useState)(""),c=Object(Z.a)(o,2),u=(c[0],c[1]),l=Object(a.useState)(_E),p=Object(Z.a)(l,2),h=p[0],d=p[1],f=Object(a.useCallback)(function(){i(!s)},[i,s]),m={};return s&&(m.minWidth=zE,m.width=zE),Object(a.useCallback)(function(e){u(e.target.value)},[u]),Object(a.useCallback)(function(e){d(e)},[d]),r.a.createElement("div",{style:m,className:"side-browser-container"},r.a.createElement("div",{className:"sidebar-header"},r.a.createElement("div",{onClick:function(){return f()},className:"collapse-toggle"},s?r.a.createElement("div",{className:"arrow-down"}):r.a.createElement("div",{className:"arrow-right"}))),r.a.createElement(O,{condition:!s},r.a.createElement(O,{condition:h===_E},r.a.createElement("div",{className:"preset-folders"},r.a.createElement(vb,{sequencerEngine:e.sequencerEngine,onTestItem:function(e){return[]},onChooseFolder:function(e){return[]},onChooseItem:function(t){return function(t){e.sequencerEngine.loadPresetAsSubSequence(t)}(t)},showItems:!0}))),r.a.createElement(O,{condition:h===WE},r.a.createElement("div",{className:"preset-folders"},r.a.createElement(GE,{sequencerEngine:e.sequencerEngine,root:R.a.xanadu.linkFolder})))))}),YE={2:new ht(4,!1),3:new ht(4,!0),4:new ht(8,!1),5:new ht(8,!0),6:new ht(16,!1),7:new ht(16,!0),8:new ht(32,!1),9:new ht(32,!0)};function QE(e,t){var n=e.key;n>0&&n<=9&&function(e,t){if(function(e){return function(e){return e.state.arrangement.selectedRows}(e).indexOf(It.id)>-1}(t)){var n=XE(t,It.id);for(var a in n){var r=n[a];t.mix.dispatch(Nk(r,YE[e]))}return}for(var s in t.subSequences){var i=t.subSequences[s],o=XE(t,i.id);for(var c in o){var u=o[c];t.mix.dispatch(qk(u,e-1))}}}(parseInt(n),t)}function XE(e,t){return e.state.arrangement.selectedEvents||[]}function ZE(e){var t=e.rowSelections;return tS(t)?{selectedEvents:e.selectedEvents}:{rowSelections:t}}function $E(e,t){return t===It.id?e.mix:e.getSubSequence(t).mix}function eS(e,t){return e.state.arrangement.automationTypeToShow[t]}function tS(e){for(var t in e)if(e[t].end>e[t].start)return!1;return!0}function nS(e){var t=e.state.arrangement.selectedRows[0];if(void 0!==t)return e.getSubSequence(t)}function aS(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16;return!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?t*Math.round(e/t):t*Math.floor(e/t)}var rS="RIGHT",sS="LEFT";function iS(e){return{marginLeft:tr(e.selectionStart,e.resolution,e.xScale),width:tr(e.selectionEnd-e.selectionStart,e.resolution,e.xScale)}}var oS=Object(y.b)(function(e){var t=e.arrangement.selection;return{selectionStart:void 0!==t?t.start:void 0,selectionEnd:void 0!==t?t.end:void 0,loopSelected:e.arrangement.loopSelected,resolution:sr,xScale:e.arrangement.xScale}},function(e){return{setArrangementRowSelections:function(t){return e(Object(w.F)(t))},setArrangementSelection:function(t,n){return e(Object(w.H)(t,n))},setArrangementLoopSelected:function(t){return e(Object(w.z)(t))}}})(function(e){var t=Object(a.useState)(!1),n=Object(Z.a)(t,2),s=n[0],i=n[1],o=Object(a.useState)(void 0),c=Object(Z.a)(o,2),u=c[0],l=c[1],p=Object(a.useState)(void 0),h=Object(Z.a)(p,2),d=h[0],f=h[1],m=Object(a.useState)(!1),v=Object(Z.a)(m,2),g=v[0],b=v[1],y=Object(a.useCallback)(function(t){t.stopPropagation(),i(!0),b(!1);var n=Us(E(t),e.resolution,void 0,e.xScale)-e.selectionStart;l(n)},[i,b,s,e.selectionStart,e.resolution,l,e.xScale]),k=Object(a.useCallback)(function(t){g||(e.setArrangementLoopSelected(!e.loopSelected),e.loopSelected?w():C(e.selectionStart,e.selectionEnd))},[g,e.loopSelected]),E=Object(a.useCallback)(function(t){return e.arrangementContainer?e.arrangementContainer.scrollLeft+t.pageX:t.pageX},[e.arrangementContainer]),S=Object(a.useCallback)(function(e){i(!1),l(void 0),f(void 0),b(!1)},[i,l,b]),O=Object(a.useCallback)(function(t){if(s){var n=Us(E(t),e.resolution,void 0,e.xScale)-u;if(n<0)return;var a=n+(e.selectionEnd-e.selectionStart),r=aS(n),i=aS(a);e.setArrangementSelection(r,i),e.loopSelected&&C(r,i),b(!0)}else if(d===sS){var o=aS(Us(E(t),e.resolution,void 0,e.xScale));if(o>=e.selectionEnd)return;e.setArrangementSelection(o,e.selectionEnd),e.loopSelected&&C(o,e.selectionEnd),b(!0)}else if(d===rS){var c=aS(Us(E(t),e.resolution,void 0,e.xScale));if(c<=e.selectionStart)return;e.setArrangementSelection(e.selectionStart,c),b(!0),e.loopSelected&&C(e.selectionStart,c)}},[e.selectionStart,b,e.selectionEnd,s,e.loopSelected,e.xScale,e.resolution,u,d]),w=function(){e.setArrangementRowSelections({})},C=function(t,n){var a={start:t,end:n},r={};for(var s in r[It.id]=a,e.sequencerEngine.subSequences)r[e.sequencerEngine.subSequences[s].id]=a;e.setArrangementRowSelections(r)},P=Object(a.useCallback)(function(e,t){f(t)},[f]),T=e.loopSelected?"selection looping":"selection";return r.a.createElement("div",{onMouseUp:S,onMouseMove:O,className:"selection-container"},r.a.createElement("div",null,r.a.createElement("div",{style:iS(e),className:T},r.a.createElement("div",{onMouseDown:function(e){return P(e,sS)},className:"triangle-right"}),r.a.createElement("div",{onMouseDown:y,onMouseUp:k,className:"middle"}),r.a.createElement("div",{onMouseDown:function(e){return P(e,rS)},className:"triangle-left"}))),function(e){var t={left:tr(e.selectionStart,e.resolution,e.xScale),width:tr(e.selectionEnd-e.selectionStart,e.resolution,e.xScale)},n="absolute-selection";return e.loopSelected&&(n+=" looping"),r.a.createElement("div",{className:n,style:t})}(e))});var cS=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onMouseDown",value:function(e){this.mouseDown=!0,this.dragStartY=e.pageY}},{key:"onMouseUp",value:function(e){this.mouseDown=!1,this.dragStartY=void 0}},{key:"onMouseMove",value:function(e){if(this.mouseDown){this.dragY=e.pageY;var t=this.dragY-this.dragStartY,n=this.props.xScale+t/10;t<0&&(n=this.props.xScale+1/(t/3)),n<.15||n>3||this.props.setArrangementXScale(n)}}},{key:"render",value:function(){var e=this,t=new Array(this.props.totalLength);t.fill(0);var n=tr(16,this.props.resolution,this.props.xScale),a="time-row";return this.props.constantHeight&&(a+=" bottom"),r.a.createElement("div",{onMouseLeave:function(t){return e.onMouseUp(t)},onMouseMove:function(t){return e.onMouseMove(t)},onMouseDown:function(t){return e.onMouseDown(t)},onMouseUp:function(t){return e.onMouseUp(t)},className:a},t.map(function(t,a){return r.a.createElement(uS,{xScale:e.props.xScale,barWidth:n,selectionStart:e.props.selectionStart,selectionEnd:e.props.selectionEnd,constantHeight:e.props.constantHeight,sequencerEngine:e.props.sequencerEngine,resolution:e.props.resolution,number:a})}))}},{key:"cursorStep",get:function(){return this.props.sequencerEngine.state.arrangement.cursorStep}}]),t}(a.Component),uS=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.number*(8/this.props.resolution),t={minWidth:this.props.barWidth},n={};this.props.xScale<=.8&&(n.opacity=.4),n.height=this.props.constantHeight?20:120*(this.props.sequencerEngine.subSequences.length+1);var a={height:n.height};return this.props.xScale<=.5&&this.props.number%4!==0&&(a.opacity=.5),r.a.createElement("div",{style:t,className:"bar"},r.a.createElement("div",{style:a,className:"first-beat"},r.a.createElement(O,{condition:this.props.xScale>.6||e%4===0},1+e)),r.a.createElement("div",{style:n,className:"beat"}),r.a.createElement("div",{style:n,className:"beat"}),r.a.createElement("div",{style:n,className:"beat"}))}}]),t}(a.Component),lS=Object(y.b)(function(e,t){return{numSubSequences:t.sequencerEngine.subSequences.length,xScale:e.arrangement.xScale,totalLength:e.arrangement.totalLength}},function(e,t){return{setArrangementXScale:function(t){return e(Object(w.I)(t))},setArrangementMouseX:function(t){return e(Object(w.B)(t))},setArrangementCursorStep:function(t){return e(Object(w.y)(t))}}})(cS),pS=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=new Array(this.numberOfBars);t.fill(0);var n=tr(1,this.props.resolution,this.props.xScale);return r.a.createElement("div",{className:"time-background"},t.map(function(t,a){return r.a.createElement(hS,{barWidth:n,selectionStart:e.props.selectionStart,selectionEnd:e.props.selectionEnd,resolution:e.props.resolution,number:a})}))}},{key:"numberOfBars",get:function(){return 100}}]),t}(a.Component),hS=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){this.props.number,this.props.resolution;var e={width:this.props.barWidth};return r.a.createElement("div",{style:e,className:"bar"},r.a.createElement("div",{className:"beat"}),r.a.createElement("div",{className:"beat"}),r.a.createElement("div",{className:"beat"}),r.a.createElement("div",{className:"last-beat"}))}}]),t}(a.Component),dS=(Object(y.b)(function(e,t){return{xScale:e.arrangement.xScale}},function(e,t){t.subSequence.id;return{setArrangementXScale:function(t){return e(Object(w.I)(t))}}})(pS),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).unlockedScroll=!1,n.unlockScroll=n.unlockScroll.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"unlockScroll",value:function(){this.unlockedScroll=!0}},{key:"componentDidMount",value:function(){window.addEventListener("mousewheel",this.unlockScroll),this.arrangementContainer=document.getElementsByClassName("arrangement-container")[0]}},{key:"componentWillUnmount",value:function(){window.removeEventListener("mousewheel",this.unlockScroll)}},{key:"getX",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props;return tr(e.isPlaying?e.step:e.cursorStep,e.resolution,e.xScale)}},{key:"shouldComponentUpdate",value:function(e){e.isPlaying!==this.props.isPlaying&&e.isPlaying&&(this.unlockedScroll=!1);var t=this.arrangementContainer?this.arrangementContainer.scrollLeft:0;if(e.step!==this.props.step||e.xScale!==this.props.xScale){var n=this.getX(e);if(!this.props.isPlaying&&(n>window.innerWidth-400||n<t))this.arrangementContainer.scrollLeft=n-200;else if((n>window.innerWidth-400||n<t||!this.props.resolution.equals(e.resolution))&&!this.unlockedScroll){var a=this.getX(e)-100;this.arrangementContainer.scrollLeft=a,this.unlockedScroll=!1}}return!0}},{key:"render",value:function(){var e={left:this.getX()};return this.props.isPlaying||(e.display="none"),r.a.createElement("div",{style:e,className:"clock-ticker"})}}]),t}(a.Component)),fS=Object(y.b)(function(e){var t=e.sequencer.sequencerEngine.getSequenceId(),n=e.sequencer.isPlaying[t]||0;return{step:n?e.sequencer.sequencerEngine.trackStep:0,cursorStep:e.arrangement.cursorStep,resolution:sr,isRecordingMix:e.mix.isRecordingMix,isPlaying:n,xScale:e.arrangement.xScale}},null)(dS),mS=Object($r.a)([function(e,t){return t.subSequence.id},function(e,t){return e.arrangement.selectedRows}],function(e,t){return t.indexOf(e)>-1});var vS=Object(y.b)(function(e,t){return{mouseX:e.arrangement.mouseX,cursorStep:e.arrangement.cursorStep,resolution:sr,isSelected:mS(e,t),xScale:e.arrangement.xScale}},null)(function(e){var t={left:tr(e.cursorStep,e.resolution,e.xScale)};return void 0!==e.mouseX&&e.isSelected||(t.display="none"),r.a.createElement("div",{className:"flashit mouse-helper",style:t})});function gS(){return document.getElementsByClassName("arrangement-container")[0].scrollLeft}var bS=Object(a.memo)(function(e){var t=e.resolution,n=e.stepNumber,a=e.length,s=(e.track,e.stepData),i=e.trackColor,o=e.width,c=void 0===o?448:o,u=e.height,l=void 0===u?40:u,p=e.pattern;if(void 0===s){var h=p.getAllOnStepAtResolutionAtAnyPosition(n,t);if(0===h.length)return r.a.createElement("div",null);s=h[0]}var d=l/2,f={left:c*n/a,width:s.duration*c/a,top:d-s.transpose/2};s.on&&(f.backgroundColor=i);var m=s.on?"on":"off";return r.a.createElement("div",{className:m,style:f})}),yS=new U.a;var kS=Object(y.b)(function(e,t){var n=e.tracks.trackPatternSteps[t.track.subSequence.id]||{},a=e.arrangement.selectedEvents,r=void 0!==a&&a[Rt]===t.pattern,s=e.arrangement.patternStartSteps[t.track.subSequence.id];return{isSelected:r,resolution:sr,steps:n[t.patternNumber],xScale:e.arrangement.xScale,startStep:s?s[t.pattern.id]:0}},function(e){return{setSelectedEvents:function(t){return e(Object(w.Hc)(t))},setArrangementMode:function(t){return e(Object(w.w)(t))},setPatternDragging:function(t,n){return e(Object(w.C)(t,n))},setPatternResizing:function(t,n){return e(Object(w.D)(t,n))},setArrangementMouseX:function(t){return e(Object(w.B)(t))},setArrangementCursorStep:function(t){return e(Object(w.y)(t))}}})(function(e){var t=e.pattern.length(e.resolution),n=void 0===e.steps?[]:e.steps.map(function(e,t){return{stepNumber:t,on:e}}).filter(function(e){return e.on}),s=Object(a.useCallback)(function(t){t.stopPropagation();var n=tr(e.startStep,e.resolution,e.xScale),a=t.pageX+gS()-n-nr;e.setPatternDragging(e.pattern,a);var r={};r[Rt]=e.pattern,e.setSelectedEvents(r),e.track.switchToPattern(e.patternNumber),e.track.updateSteps(!0),e.sequencerEngine.state.arrangement.bottomMode!==Hk&&e.isSelected&&e.setArrangementMode(Hk),e.setArrangementMouseX(void 0),e.setArrangementCursorStep(void 0)},[e.setArrangementMode,e.startStep,e.patternNumber,e.setPatternDragging,e.isSelected,e.pattern,e.xScale]),i=Object(a.useCallback)(function(t){t.stopPropagation(),e.setPatternDragging(void 0),e.setPatternResizing(void 0)},[e.setPatternDragging],e.setPatternResizing),o=Object(a.useCallback)(function(t,n){t.stopPropagation(),e.setPatternResizing(e.pattern,n)},[e.setPatternResizing,e.pattern]),c={backgroundColor:yS.getColorForHash(e.track.presetName||e.track.getName())};c.width=tr(e.pattern.length(),e.resolution,e.xScale);var u={width:c.width,left:tr(e.startStep,e.resolution,e.xScale)};return u.border="1px solid "+yS.brighten(c.backgroundColor,.3),e.isSelected&&(u.border="1px solid "+c.backgroundColor,u.backgroundColor=yS.brighten(c.backgroundColor,.3),u.opacity=.7),c.width-=1,r.a.createElement("div",{onMouseUp:function(){return e.setPatternDragging(void 0)},style:u,className:"mini-piano-roll-wrapper"},r.a.createElement("div",{onMouseDown:s,onMouseUp:i,style:c,className:"mini-piano-roll-header"},r.a.createElement("div",{onMouseDown:function(e){return o(e,rr)},className:"left-edge"}),r.a.createElement("div",{className:"middle"}),r.a.createElement("div",{onMouseDown:function(e){return o(e,ar)},className:"right-edge"})),r.a.createElement("div",{className:"mini-piano-roll steps-map"},n.map(function(n,a){return r.a.createElement(bS,{pattern:e.pattern,width:t*tr(2,e.resolution,e.xScale),height:60,key:"mini-step-"+a+"-"+n.stepNumber,trackColor:"#00ff14",length:t,track:e.track,stepNumber:n.stepNumber,resolution:e.resolution,stepData:n.step})})))});new U.a;var ES=Object(y.b)(function(e,t){return{numPatterns:t.track.patterns.length}},function(e){return{setArrangementMode:function(t){return e(Object(w.w)(t))}}})(function(e){var t=Object(a.useCallback)(function(t){if(e.sequencerEngine.state.arrangement.patternDragging){t.stopPropagation();var n=e.sequencerEngine.state.arrangement.patternDragging,a=n.patternDragging,r=n.offsetX,s=Us(t.pageX+gS()-r,e.resolution,void 0,e.xScale);ur(void 0,Ak(e.track,a,s))}},[e.xScale]);return r.a.createElement("div",{onMouseMove:t},e.track.patterns.filter(function(e,t){return t>=1}).map(function(t,n){return r.a.createElement(kS,{key:"pattern-"+t.id,sequencerEngine:e.sequencerEngine,pattern:t,track:e.track,patternNumber:n+1})}))});var SS=Object(y.b)(function(e,t){var n=e.arrangement.rowSelections[t.subSequence.id];return{start:void 0===n?0:n.start,end:void 0===n?0:n.end,resolution:sr,xScale:e.arrangement.xScale}},null)(function(e){var t={left:tr(e.start,e.resolution,e.xScale),width:tr(e.end-e.start,e.resolution,e.xScale)};return r.a.createElement("div",{style:t,className:"row-selection"})}),OS=42,wS=42;function CS(e,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1)*(t.resolution/8)*100*e/32}function PS(e){return OS-e*wS}function TS(e){return Math.max(0,Math.min(1,(OS-e)/wS))}var jS=Object(a.memo)(function(e){var t=e.onMouseDown,n=e.highlightPoint,a=e.unhighlightPoint,s=e.onMouseUp,i=e.step,o=e.resolution,c=e.xScale,u=e.volume,l=e.isHighlighted;return r.a.createElement(b.Circle,{onMouseDown:t,onMouseOver:n,onMouseLeave:a,onMouseUp:s,x:CS(i,o,c),y:PS(u),radius:2,fill:l?"blue":"black",stroke:l?"blue":"red",strokeWidth:2})}),xS=Object(y.b)(function(e,t){return{step:t.event.step,volume:t.event.volume,resolution:sr,xScale:e.arrangement.xScale}},null)(jS);function NS(e){return void 0===e.guidePoint?r.a.createElement(b.Rect,{x:0,y:0,width:0,height:0}):r.a.createElement(b.Circle,{onMouseLeave:e.onMouseLeave,onMouseDown:e.onClick,x:CS(e.guidePoint.step,e.resolution,e.xScale),y:PS(e.guidePoint.value),radius:2,fill:"blue",stroke:"blue",strokeWidth:2})}var qS=Object(y.b)(function(e,t){var n=e.arrangement.mixEvents[t.subSequence.id],a=void 0!==n?n[t.eventType]:void 0,r=e.mix.subSequenceFades[t.subSequence.id];return{events:a,volume:e.mix.isPlayingMix?void 0:void 0===r?1:r,resolution:sr,xScale:e.arrangement.xScale}},function(e){return{setArrangementMouseX:function(t){return e(Object(w.B)(t))},clearSelection:function(){return e(Object(w.F)({}))},setArrangementCursorStep:function(t){return e(Object(w.y)(t))}}})(function(e){var t=Object(a.useState)(void 0),n=Object(Z.a)(t,2),s=n[0],i=n[1],o=Object(a.useState)(void 0),c=Object(Z.a)(o,2),u=c[0],l=c[1],p=Object(a.useState)(void 0),h=Object(Z.a)(p,2),d=h[0],f=h[1],m=Object(a.useState)(!1),v=Object(Z.a)(m,2),g=v[0],y=v[1],k=function(t){var n=e.sequencerEngine.store.getState(),a=Us(t.evt.offsetX,e.resolution,0,n.arrangement.xScale);if(!isNaN(a)){var r=TS(t.evt.offsetY),s=new at(e.subSequence,r);s.step=a,e.subSequence.mix.insertEvent(s,1),i(void 0),l(s),y(!0),e.clearSelection()}},E=Object(a.useCallback)(function(t){if(void 0!==u){var n=e.sequencerEngine.store.getState(),a=Us(t.evt.offsetX,e.resolution,0,n.arrangement.xScale),r=TS(t.evt.offsetY);console.log("value dragged from offset=%s to value=%s",t.evt.offsetY,r),u.step=a,u.value=r,e.subSequence.volumeAutomationMix.updateRedux(e.subSequence,e.sequencerEngine),i(void 0),y(!0),e.setArrangementMouseX(void 0),e.setArrangementCursorStep(void 0),e.clearSelection()}},[u,e.events,e.resolution]),S=Object(a.useCallback)(function(t){var n=e.sequencerEngine.store.getState(),a=Us(t.evt.offsetX,e.resolution,0,n.arrangement.xScale),r=TS(t.evt.offsetY);i({step:a,value:r})},[i,e.resolution]),O=Object(a.useCallback)(function(e){f(e),i(void 0)},[i,f]),w=Object(a.useCallback)(function(e){l(void 0),f(void 0),i(void 0),y(!1)},[l,f,i]),C=Object(a.useCallback)(function(t){g||e.subSequence.volumeAutomationMix.deleteEvent(t),w()},[g]),P=e.events||[],T=CS(e.subSequence.mix.length+1e3,e.resolution,e.xScale);return r.a.createElement("div",{className:"linear-automation-container"},r.a.createElement(b.Stage,{width:T,height:OS,onMouseLeave:w,onMouseMove:E,onMouseUp:w},r.a.createElement(b.Layer,null,r.a.createElement(b.Rect,{x:0,y:0,width:T,height:OS,opacity:0,fill:"black"})),function(){var t=e.events||[],n=[];for(var a in(0===t.length||t[0].step>1)&&(n=[0,PS(function(){var t=e.sequencerEngine.store.getState().mix.subSequenceFades[e.subSequence.id];return void 0===t?1:t}())]),t)n.push(CS(t[a].step,e.resolution,e.xScale)),n.push(PS(t[a].volume));var r=n[n.length-2],s=n[n.length-1];return n.push(r+2e4),n.push(s),[n]}().map(function(e){return r.a.createElement(b.Layer,null,r.a.createElement(b.Line,{onMouseMove:function(e){return S(e)},onMouseOver:function(e){return S(e)},onMouseDown:function(e){return k(e)},closed:!1,alpha:0,opacity:0,strokeWidth:16,points:e,stroke:"black"}),r.a.createElement(b.Line,{onMouseMove:function(e){return S(e)},onMouseOver:function(e){return S(e)},onMouseDown:function(e){return k(e)},closed:!1,strokeWidth:2,points:e,stroke:"red"}))}),r.a.createElement(b.Layer,null,r.a.createElement(NS,{resolution:e.resolution,onMouseLeave:function(){return i(void 0)},xScale:e.xScale,guidePoint:s,onClick:k}),P.map(function(e,t){return r.a.createElement(xS,{key:"automation-"+e.id,highlightPoint:function(){return O(e)},unhighlightPoint:function(){return f(void 0)},isHighlighted:e===d||e===u,onMouseDown:function(){return l(e)},onMouseUp:function(){return C(e)},event:e})}))))});var MS=[{value:Ot,label:"Pattern"},{value:At,label:"Volume"}];function DS(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ot;return MS.find(function(t){return t.value===e})}var AS=Object(y.b)(function(e,t){return{automationTypeToShow:e.arrangement.automationTypeToShow[t.subSequence.id]}},null)(function(e){return r.a.createElement(pp.a,{className:"automation-type-dropdown",controlClassName:"automation-type-control-dropdown",arrowClassName:"automation-type-arrow-dropdown",options:MS,onChange:function(t){return n=t.value,void e.subSequence.setAutomationToShow(n);var n},value:DS(e.automationTypeToShow),placeholder:"Rate"})}),RS=new U.a,IS=["A","B","C","D","E","F","G","H"],LS=18;var FS=Object(y.b)(function(e,t){var n=e.mix.subSequenceFades[t.subSequence.id],a=(e.tracks.trackIsEnabled[t.subSequence.id]||{})[0];return{isSelected:mS(e,t),volume:void 0===n?1:n,muted:e.mix.subSequenceMuted[t.subSequence.id],isEnabled:void 0!==a&&a}},function(e,t){t.subSequence.id;return{setSelectedRows:function(t){return e(Object(w.G)(t))},setArrangementMode:function(t){return e(Object(w.w)(t))},clearSelectedArrangementEvents:function(){return e(Object(w.Hc)(void 0))}}})(function(e){var t=function(e){e.stopPropagation()},n="pattern-info sub-sequence";e.isSelected&&(n+=" selected");var a=1===e.subSequence.tracks.length?e.subSequence.tracks[0].presetName||e.subSequence.tracks[0].getName():IS[e.i];void 0!==a&&a.length>=LS&&(a=a.substring(0,LS));var s=e.subSequence.isTrack?"sub-sequence-name is-track":"sub-sequence-name",i={};if(e.subSequence.isTrack&&e.isSelected){var o=e.subSequence.tracks[0],c=o.presetName||o.getName();i={backgroundColor:RS.getColorForHash(c)}}return r.a.createElement("div",{onClick:function(){e.setSelectedRows([e.subSequence.id]),e.sequencerEngine.switchToSubSequence(e.subSequence.id,!1),1===e.subSequence.tracks.length?(e.subSequence.tracks[0].updateSteps(),e.setArrangementMode(Jk)):e.setArrangementMode(void 0),e.clearSelectedArrangementEvents()},onMouseMove:t,onDragStart:t,className:n},r.a.createElement("div",{style:i,className:s},a),r.a.createElement("div",{className:"panel-rest"},r.a.createElement("div",{className:"option-and-label"},r.a.createElement(AS,{subSequence:e.subSequence})),r.a.createElement("div",{className:"track-controls-container"},r.a.createElement(Kf,{width:60,min:0,max:1,display:function(e){return le(e,0,1,6,-60)},id:e.subSequence.id+"-volume",onVolumeChange:function(t){e.subSequence.fade=t},volume:e.volume}),r.a.createElement(O,{condition:e.subSequence.isTrack},r.a.createElement("div",{onClick:function(){e.subSequence.tracks[0].toggleEnabled()},className:e.isEnabled?"midi-recording-button on":"midi-recording-button off"},r.a.createElement("span",{className:"black plain-dot"}))))))}),VS=32;function BS(e){return e.getState().arrangement.cursorStep}var US=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n.resizingSelection=!1,window.a=2,window.b=8,window.c=4,window.d=7,n.onRowMouseUp=n.onRowMouseUp.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.arrangementContainer=document.getElementsByClassName("arrangement-container")[0]}},{key:"onDragPatternEvent",value:function(e,t){if(e.stopPropagation(),0!==t.patternNumber){var n=Us(e.pageX+this.scrollLeft,this.props.resolution,void 0,this.props.xScale);this.setState({patternEventDragging:t,draggingDiff:n-t.step})}}},{key:"onEdgeMouseDown",value:function(e,t){this.resizing=e,this.direction=t}},{key:"onRowMouseUp",value:function(){var e=(new Date).getTime();this.lastClickTime&&e-this.lastClickTime<=200&&function(e,t){t.getState().sequencer.resolution;var n=BS(t),a=new nt(0);a.step=n,e.dispatch(Pk(a,VS)),t.dispatch(Object(w.Hc)([a]))}(this.mix,this.props.sequencerEngine.store),this.lastClickTime=e,this.resizingSelection=!1}},{key:"onMouseUp",value:function(e){this.resizing=void 0,this.direction=void 0,this.props.onMouseUp()}},{key:"onMouseMove",value:function(e){var t=Us(e.pageX+this.scrollLeft,this.props.resolution,void 0,this.props.xScale);t-=t%(32/this.props.resolution.resolution);var n=Math.floor(t);if(this.resizing){this.resizing.step,this.resizing.duration;if(this.direction===ar){var a=this.mix.getNextEvent(this.resizing);if(a){var r=this.mix.getNextEvent(a);r?n<r.step&&this.resizing.step<n&&(a.step=n,this.mix.updateAllTypeRedux()):this.resizing.step<n&&(a.step=n,this.mix.updateAllTypeRedux())}}else{var s=this.mix.getPreviousEvent(this.resizing),i=this.mix.getNextEvent(this.resizing);(void 0===s||n>s.step)&&(void 0===i||n<i.step)&&(this.resizing.step=n,this.mix.updateAllTypeRedux())}this.props.isSelected||this.selectRow()}else if(this.resizingSelection){var o=this.getState().arrangement.rowSelections[this.props.subSequence.id];if(void 0!==o){o.end=t;var c={};c[this.props.subSequence.id]=o,this.props.setArrangementRowSelections(c)}}else if(this.patternResizing){var u=this.patternResizing;ur(function(e,t,n){return{type:Aa,payload:{pattern:e,direction:t,resizedStep:n}}}(u.pattern,u.direction,n))}}},{key:"onMouseLeave",value:function(){this.resizing=void 0}},{key:"onDrop",value:function(e){var t=Us(e.pageX+this.scrollLeft,this.props.resolution,void 0,this.props.xScale);if(t=aS(t,this.props.resolution),void 0!==this.props.patternDragging){var n=new nt(this.props.patternDragging);t-=t%(32/this.props.resolution.resolution),n.step=t,this.mix.insertEvent(n,32),this.props.dragPattern(void 0)}else if(void 0!==this.state.patternEventDragging){var a=this.state.patternEventDragging;this.mix.deleteEvent(a),t-=this.state.draggingDiff,t-=t%(32/this.props.resolution.resolution),a.step=t,this.mix.insertEvent(a,a.duration),this.setState({patternEventDragging:void 0})}}},{key:"onSelect",value:function(e){var t=Object(X.a)({},this.selectedEvents)||{};if(this.isSelected(e))return delete t[e.id],this.props.setSelectedEvents(t),void this.props.setArrangementRowSelections({});this.props.setArrangementRowSelections({}),(t={})[e.id]=e,this.props.setSelectedEvents(t)}},{key:"isSelected",value:function(e){return void 0!==this.selectedEvents&&void 0!==this.selectedEvents[e.id]}},{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"getState",value:function(){return this.props.sequencerEngine.store.getState()}},{key:"selectRow",value:function(){this.props.setSelectedRows([this.props.subSequence.id]),this.props.sequencerEngine.switchToSubSequence(this.props.subSequence.id,!1)}},{key:"onMouseDown",value:function(e){var t=Us(e.pageX+this.scrollLeft,this.props.resolution,void 0,this.props.xScale);this.resizingSelection=!0;var n={};n[this.props.subSequence.id]={start:t,end:t},this.props.setArrangementRowSelections(n),this.selectRow()}},{key:"getEventComponents",value:function(){var e=this;if(this.props.subSequence.isTrack)return r.a.createElement(ES,{track:this.props.subSequence.tracks[0],xScale:this.props.xScale,resolution:this.props.resolution,sequencerEngine:this.props.sequencerEngine,subSequence:this.props.subSequence});var t=this.patternSwitchEvents||[],n=!1;return this.props.automationTypeToShow===At&&(n=!0),t.map(function(a,s){return r.a.createElement(Bk,{smallPattern:n,key:e.props.subSequence.id+"-"+s,type:Ot,resolution:e.props.resolution,subSequence:e.props.subSequence,isLast:s===t.length-1,isFirst:0===s,onDragStart:function(t){return e.onDragPatternEvent(t,a)},onSelect:function(){return e.onSelect(a)},onRightMouseDown:function(t){return e.onEdgeMouseDown(a,ar)},onMouseUp:function(t){return e.onMouseUp(t)},onMouseLeave:function(t){return e.onMouseLeave(t)},onLeftMouseDown:function(t){return e.onEdgeMouseDown(a,rr)},sequencerEngine:e.props.sequencerEngine,event:a})})}},{key:"render",value:function(){var e=this,t="";void 0!==this.props.automationTypeToShow&&this.props.automationTypeToShow!==Ot&&(t=r.a.createElement(qS,{eventType:this.props.automationTypeToShow,sequencerEngine:this.props.sequencerEngine,subSequence:this.props.subSequence}));var n="pattern-row";this.props.isSelected&&(n+=" selected");this.props.automationTypeToShow===At&&(!0,n+=" automation");var a={width:tr(16*this.props.totalLength,this.props.resolution,this.props.xScale)};return n+=" "+this.props.subSequence.id,r.a.createElement("div",{style:a,onClick:function(){return e.selectRow()},onDrop:function(t){return e.onDrop(t)},onDragOver:function(t){return e.onDragOver(t)},onMouseDown:function(t){return e.onMouseDown(t)},onMouseUp:this.onRowMouseUp,onMouseMove:function(t){return e.onMouseMove(t)},onMouseLeave:function(t){return e.onMouseLeave()},className:n},r.a.createElement(SS,{subSequence:this.props.subSequence}),r.a.createElement(vS,{subSequence:this.props.subSequence}),r.a.createElement("div",{className:"patterns-arrangement-container"},this.getEventComponents()),t)}},{key:"scrollLeft",get:function(){return this.arrangementContainer.scrollLeft}},{key:"mix",get:function(){return this.props.subSequence.mix}},{key:"selectedEvents",get:function(){return this.getState().arrangement.selectedEvents}},{key:"patternSwitchEvents",get:function(){var e=this.getState().arrangement.mixEvents[this.props.subSequence.id];return void 0!==e?e[Ot]:void 0}},{key:"patternResizing",get:function(){return this.getState().arrangement.patternResizing}}]),t}(a.Component),HS=Object(y.b)(function(e,t){var n=e.arrangement.mixEvents[t.subSequence.id],a=void 0!==n?n[Ot]:void 0;return{eventsLength:void 0===a?0:a.length,patternDragging:e.sequencer.patternDragging,resolution:sr,automationTypeToShow:e.arrangement.automationTypeToShow[t.subSequence.id],isSelected:mS(e,t),xScale:e.arrangement.xScale,totalLength:e.arrangement.totalLength}},function(e,t){t.subSequence.id;return{dragPattern:function(t){return e(Object(w.e)(t))},setSelectedRows:function(t){return e(Object(w.G)(t))},setSelectedEvents:function(t){return e(Object(w.Hc)(t))},setArrangementRowSelections:function(t){return e(Object(w.F)(t))}}})(US);n(2339);var JS=Object(y.b)(function(e,t){var n=t.sequencerEngine.engineId;return{isRollSelected:mS(e,t),subSequences:e.sequencer.subSequences[n]}},null)(function(e){var t=Object(a.useState)(!1),n=Object(Z.a)(t,2),s=n[0],i=n[1],o="pattern-info";return e.isRollSelected&&(o+=" selected"),r.a.createElement("div",{className:"side-panel-container"},r.a.createElement(A.c,{className:"view-dropdown",show:s?"true":"false",isOpen:s,toggle:function(){return i(!s)}},r.a.createElement(A.f,{size:"sm",caret:!0,color:"primary"},"Actions"),r.a.createElement(A.e,null,r.a.createElement(A.d,{onClick:function(){e.sequencerEngine.mix.clear(),e.sequencerEngine.subSequences.forEach(function(e){return e.mix.clear()})},size:"sm"},"New Mix"))),e.sequencerEngine.subSequences.filter(function(e){return!e.isTrack}).map(function(t,n){return r.a.createElement(FS,{i:n,sequencerEngine:e.sequencerEngine,subSequence:t})}),e.sequencerEngine.subSequences.filter(function(e){return e.isTrack}).map(function(t,n){return r.a.createElement(FS,{i:n,sequencerEngine:e.sequencerEngine,subSequence:t})}),r.a.createElement("div",{className:o},r.a.createElement("div",{className:"sub-sequence-name"},"ROLL")))}),GS=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).resizingSelection=!1,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getMouseX",value:function(e){return e.pageX+this.arrangementComponent.scrollLeft}},{key:"onDragPatternEvent",value:function(e,t){}},{key:"onSelect",value:function(e,t,n){if(this.isSelected(t))this.props.setSelectedEvents(void 0);else{this.props.setArrangementRowSelections({});var a={};a[t.id]=t,this.props.setSelectedEvents(a)}this.rollDragOffset=this.getStepFromMouseEvent(n)-e.step,this.rollDragging=e}},{key:"isSelected",value:function(e){return void 0!==this.selectedEvents&&void 0!==this.selectedEvents[e.id]}},{key:"onMouseUp",value:function(e){if(void 0===e){var t=(new Date).getTime();void 0!==this.lastClickTime&&t-this.lastClickTime<250&&function(e,t){var n=t.getState().sequencer.resolution,a=BS(t),r=new St(!0,n);r.step=a,e.dispatch(Tk(r,64/n.resolution)),t.dispatch(Object(w.Hc)([r.initialSubEvent]))}(this.mix,this.props.sequencerEngine.store),this.lastClickTime=t}this.resizing=void 0,this.resizingSubEvent=void 0,this.resizingSelection=!1,this.rollDragging=void 0,this.rollDragOffset=void 0}},{key:"getStepFromMouseEvent",value:function(e){e.pageX,this.arrangementContainer.scrollLeft;return Us(e.pageX+this.arrangementContainer.scrollLeft,this.props.resolution,void 0,this.xScale)}},{key:"onMouseMove",value:function(e){if(this.resizing||this.rollDragging||this.resizingSelection){e.pageX,this.arrangementContainer.scrollLeft;var t=Us(e.pageX+this.arrangementContainer.scrollLeft,this.props.resolution,void 0,this.xScale),n=t;if(t-=t%(32/this.props.resolution.resolution),this.rollDragging){var a=aS(n-this.rollDragOffset,64/this.props.resolution.resolution);this.mix.dispatch((o=this.rollDragging,{type:Pa,payload:{event:o,newStep:a}}))}else if(this.resizing){var r=t-(this.resizingSubEvent.step+this.resizingSubEvent.duration);"RIGHT"===this.direction?this.isRightEventInBounds(t,this.resizing,this.resizingSubEvent)&&this.isRightSubEventInBounds(t,this.resizing,this.resizingSubEvent)?this.mix.resizeSequenceRoll(this.resizing,this.resizingSubEvent,"RIGHT",Math.floor(r)):(this.resizing=void 0,this.resizingSubEvent=void 0):this.isLeftEventInBounds(t,this.resizing)&&this.isLeftSubEventInBounds(t,this.resizing,this.resizingSubEvent)?this.mix.resizeSequenceRoll(this.resizing,this.resizingSubEvent,"LEFT",Math.floor(t)):(this.resizing=void 0,this.resizingSubEvent=void 0)}else if(this.resizingSelection){var s=this.getState().arrangement.rowSelections[It.id];if(void 0!==s){s.end=t;var i={};i[It.id]=s,this.props.setArrangementRowSelections(i)}}}var o}},{key:"isLeftEventInBounds",value:function(e,t){var n=this.mix.getPreviousEvent(t),a=this.mix.getNextEvent(t);return(void 0===n||e>n.step)&&(void 0===a||e<a.step)}},{key:"isLeftSubEventInBounds",value:function(e,t,n){var a=t.getPreviousSubEvent(n),r=t.getNextSubEvent(n);return(void 0===a||e>a.step)&&(void 0===r||e<r.step)}},{key:"isRightEventInBounds",value:function(e,t,n){var a=this.mix.getNextEvent(t);this.mix.getPreviousEvent(t);if(a){var r=this.mix.getNextEvent(a);if(void 0===r||e<r.step)return!0}return!1}},{key:"isRightSubEventInBounds",value:function(e,t,n){if(e<n.step)return!1;var a=t.getNextSubEvent(n);t.getPreviousSubEvent(n);if(void 0===a)return!0;var r=t.getNextSubEvent(a);return void 0===r||e<r.step}},{key:"onMouseDown",value:function(e,t,n){this.resizing=e,this.resizingSubEvent=t,this.direction=n}},{key:"selectRow",value:function(){this.props.setSelectedRows([It.id]),this.props.setArrangementMode(void 0)}},{key:"getState",value:function(){return this.props.sequencerEngine.store.getState()}},{key:"onSelectionMouseDown",value:function(e){var t=this.getStepFromMouseEvent(e);this.resizingSelection=!0;var n={};n[It.id]={start:t,end:t},this.props.setArrangementRowSelections(n)}},{key:"render",value:function(){var e=this,t=this.getState().arrangement.mixEvents[It.id],n=t&&t[Mt]||[],a="pattern-row rolls-row";this.props.isSelected&&(a+=" selected");var s={width:tr(16*this.props.totalLength,this.props.resolution,this.props.xScale)};return r.a.createElement("div",{style:s,onClick:function(){return e.selectRow()},onMouseMove:function(t){return e.onMouseMove(t)},onMouseDown:function(t){return e.onSelectionMouseDown(t)},onMouseUp:function(t){return e.onMouseUp(void 0)},onMouseLeave:function(t){return e.onMouseUp(t)},className:a},r.a.createElement(SS,{subSequence:It}),r.a.createElement(vS,{subSequence:It}),n.filter(function(e){return void 0!==e}).map(function(t,a){var s;return r.a.createElement(Uk,(s={key:t.id,type:Mt,mixSession:e.props.mixSession,resolution:e.props.resolution,isLast:a===n.length-1,isFirst:0===a,onDragStart:function(n){return e.onDragPatternEvent(n,t)},onSelect:function(t,n,a){return e.onSelect(t,n,a)},onMouseUp:function(n){return e.onMouseUp(t)},onRightMouseUp:function(t,n){return e.onMouseUp(t,n)},onRightMouseDown:function(t,n){return e.onMouseDown(t,n,"RIGHT")},onLeftMouseUp:function(t,n){return e.onMouseUp(t,n)},onLeftMouseDown:function(t,n){return e.onMouseDown(t,n,"LEFT")}},Object(_e.a)(s,"mixSession",e.props.mixSession),Object(_e.a)(s,"sequencerEngine",e.props.sequencerEngine),Object(_e.a)(s,"event",t),s))}))}},{key:"arrangementContainer",get:function(){return this.savedArrangementContainer?this.savedArrangementContainer:(this.savedArrangementContainer=document.getElementsByClassName("arrangement-container")[0],this.savedArrangementContainer)}},{key:"selectedEvents",get:function(){return this.getState().arrangement.selectedEvents}},{key:"xScale",get:function(){return this.props.sequencerEngine.store.getState().arrangement.xScale}},{key:"scrollLeft",get:function(){return this.arrangementContainer.scrollLeft}},{key:"mix",get:function(){return this.props.sequencerEngine.mix}}]),t}(a.Component),zS=Object(y.b)(function(e,t){var n=e.arrangement.mixEvents[It.id],a=n?n[Mt]:[];return{isSelected:mS(e,t),numEvents:void 0===a?0:a.length,resolution:sr,totalLength:e.arrangement.totalLength,xScale:e.arrangement.xScale}},function(e,t){return{setSelectedRows:function(t){return e(Object(w.G)(t))},setSelectedEvents:function(t){return e(Object(w.Hc)(t))},setArrangementRowSelections:function(t){return e(Object(w.F)(t))},setArrangementMode:function(t){return e(Object(w.w)(t))}}})(GS),_S=Object(a.memo)(function(e){var t=e.onMouseDown,n=e.onMouseUp,a=e.onMouseMove,s=e.sequencerEngine,i=e.resolution,o=e.arrangementContainer,c=e.mixSession,u={height:130*(1+s.subSequences.length)};return r.a.createElement("div",{style:u,className:"arrangement-container",onMouseDown:function(e){return t(e)},onMouseLeave:function(){return n()},onMouseMove:function(e){return a(e)},onMouseUp:function(e){return n(e)}},r.a.createElement("div",{className:"viewport-wrapper"},r.a.createElement(fS,null),r.a.createElement(lS,{sequencerEngine:s,selectionStart:void 0,selectionEnd:void 0,resolution:i}),r.a.createElement(oS,{arrangementContainer:o,sequencerEngine:s}),r.a.createElement("div",{className:"sub-sequence-container"},s.subSequences.filter(function(e){return!e.isTrack}).map(function(e,t){return r.a.createElement(HS,{key:"sub-arrangement-"+e.id+"-"+t,i:t,sequencerEngine:s,onMouseUp:function(e){return n(e)},subSequence:e})}),s.subSequences.filter(function(e){return e.isTrack}).map(function(e,t){return r.a.createElement(HS,{key:"sub-arrangement-"+e.id,sequencerEngine:s,onMouseUp:function(e){return n(e)},subSequence:e})})),r.a.createElement(zS,{mixSession:c,subSequence:It,sequencerEngine:s}),r.a.createElement(lS,{sequencerEngine:s,constantHeight:!0,selectionStart:void 0,selectionEnd:void 0,resolution:i}),r.a.createElement("div",{className:"arrangement-rest"})))}),WS=(n(2344),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={arrangementContainer:void 0},window.brightness=120,n.idToEvent={},n.onKeyDown=n.onKeyDown.bind(Object(p.a)(n)),n.savedArrangementContainer=void 0,n.copyRing={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.onKeyDown),this.props.sequencerEngine.resolution=sr,this.updateTrackSteps()}},{key:"updateTrackSteps",value:function(){this.props.sequencerEngine.subSequences.filter(function(e){return e.isTrack}).forEach(function(e){return e.tracks[0].updateSteps()})}},{key:"componentWillUnmount",value:function(){this.props.sequencerEngine.resolution=sr,window.removeEventListener("keydown",this.onKeyDown)}},{key:"onKeyDown",value:function(e,t){"Backspace"===e.key&&this.delete(),QE(e,this.props.sequencerEngine),e.key>0&&e.key,"c"===e.key&&e.metaKey&&this.copy(),"v"===e.key&&e.metaKey&&this.paste(),"d"===e.key&&e.metaKey&&(e.stopPropagation(),this.duplicate()),"e"===e.key&&e.metaKey&&(e.preventDefault(),e.stopPropagation(),this.splitPattern())}},{key:"onLeftMouseDown",value:function(e,t){this.resizing=e,this.resizingSubEvent=e,this.direction="LEFT"}},{key:"onRightMouseDown",value:function(e,t){this.resizing=e,this.resizingSubEvent=e,this.direction="RIGHT"}},{key:"onMouseLeave",value:function(){this.props.setArrangementMouseX(void 0),this.props.setArrangementCursorStep(void 0),this.resizing=void 0}},{key:"onMouseDown",value:function(e){var t=void 0===e||this.resizing?void 0:e.pageX+this.arrangementContainer.scrollLeft,n=aS(Us(t,this.props.resolution,void 0,this.props.xScale),16/this.props.resolution*4,!1);void 0!==n&&(this.props.setArrangementCursorStep(n),this.props.setArrangementMouseX(t))}},{key:"onMouseUp",value:function(e){this.selecting&&this.updateSelectedPatterns();var t=void 0===e||this.resizing?void 0:e.pageX+this.arrangementContainer.scrollLeft,n=aS(Us(t,this.props.resolution,void 0,this.props.xScale),16/this.props.resolution*4,!1);if(void 0!==(t=nr+tr(n,this.props.resolution,this.xScale))&&n===this.cursorStep&&e.pageY>38&&e.pageY<65){this.props.sequencerEngine.playing;var a=this.getQuantizedStepFromPosition(t);this.props.sequencerEngine.seekToTrackStep(a)}this.resizing=void 0,this.resizingSubEvent=void 0,this.selecting=!1,this.props.setArrangementPatternDragging(void 0)}},{key:"getQuantizedStepFromPosition",value:function(e){var t=Us(e,this.props.resolution,this.props.xScale);return t-=t%(32/this.props.resolution.resolution)}},{key:"onMouseMove",value:function(e){if(this.resizing){e.pageX,this.arrangementContainer.scrollLeft;var t=Us(e.pageX+this.arrangementContainer.scrollLeft,this.props.resolution);t-=t%(32/this.props.resolution.resolution);var n=this.resizingSubEvent?t-(this.resizingSubEvent.step+this.resizingSubEvent.duration):t-(this.resizing.step+this.resizing.duration);this.resizing.getType()===Ot?"RIGHT"===this.direction?this.mixSession.resizeEvent(this.resizing,Math.floor(n)):(this.resizing.step=Math.floor(t),this.mixSession.updateAllTypeRedux()):this.resizing.getType()===Mt&&("RIGHT"===this.direction?this.mixSession.resizeSequenceRoll(this.resizing,this.resizingSubEvent,"RIGHT",Math.floor(n)):this.mixSession.resizeSequenceRoll(this.resizing,this.resizingSubEvent,"LEFT",Math.floor(t)))}}},{key:"updateAllTypeRedux",value:function(){this.mixSession.updateAllTypeRedux()}},{key:"getState",value:function(){return this.props.sequencerEngine.store.getState().arrangement}},{key:"getSelectionStart",value:function(){return void 0===this.getState().selection?void 0:this.getState().selection.start}},{key:"getSelectionEnd",value:function(){return void 0===this.getState().selection?void 0:this.getState().selection.end}},{key:"updateSelectedPatterns",value:function(){var e=this.getSelectionStart(),t=this.getSelectionEnd(),n=[];for(var a in this.props.patternSwitchEvents){var r=this.props.patternSwitchEvents[a];r.step>=e&&r.step+r.duration<=t&&n.push(r)}}},{key:"isSelectedEvent",value:function(e,t){return!1}},{key:"copy",value:function(){this.copyRing=ZE(this.getState())}},{key:"duplicate",value:function(){!function(e){var t=ZE(e.state.arrangement);if(void 0!==t.rowSelections)for(var n in t.rowSelections){var a=$E(e,n=parseInt(n)),r=void 0;eS(e,n)===At&&1===Object.keys(t.rowSelections).length&&(r=At),a.dispatch(Dk(t.rowSelections[n],r))}if(void 0!==t.selectedEvents)for(var s in t.selectedEvents)if((s=parseInt(s))===Rt){var i=nS(e);if(i.isTrack){var o=i.tracks[0];ur(void 0,Lk(o,t.selectedEvents[s]))}}}(this.props.sequencerEngine)}},{key:"paste",value:function(){!function(e,t){var n=function(e){return e.state.arrangement.cursorStep}(e);if(void 0!==n){if(t.rowSelections)for(var a in t.rowSelections){var r=$E(e,a=parseInt(a)),s=void 0;eS(e,a)===At&&1===Object.keys(t.rowSelections).length&&(s=At);var i=nS(e),o=void 0;i&&i.isTrack&&(o=i.tracks[0]),r.dispatch(Mk(n,t.rowSelections[a],s,o))}if(t.selectedEvents)for(var c in t.selectedEvents)if((c=parseInt(c))===Rt){var u=nS(e);if(u.isTrack){var l=u.tracks[0];ur(void 0,Ik(l,t.selectedEvents[c],n))}}}}(this.props.sequencerEngine,this.copyRing)}},{key:"splitPattern",value:function(){var e=this.cursorStep;for(var t in this.selectedRows){var n=this.selectedRows[t],a=this.props.sequencerEngine.getSubSequence(n);if(a.isTrack){var r=a.tracks[0].patterns.find(function(t){return t.overlapsStep(e)});if(void 0!==r)return console.log("pattern found = ",r,r.startStep),ur(void 0,Rk(r.track,r,e)),void this.onMouseLeave()}}}},{key:"getMix",value:function(e){return e===It.id?this.props.sequencerEngine.mix:this.props.sequencerEngine.getSubSequence(e).mix}},{key:"getSelectedEvents",value:function(){return this.getState().selectedEvents}},{key:"getRowSelections",value:function(){return this.getState().rowSelections}},{key:"delete",value:function(){var e=this.getRowSelections();if(tS(e)){var t,n=this.getSelectedEvents();if(void 0!==this.selectedRows&&0!==this.selectedRows.length){if(void 0===n){if(this.getState().bottomMode===Hk)return;return this.props.sequencerEngine.deleteSubSequence(this.selectedRows[0]),this.updateTrackSteps(),void this.props.setSelectedRows([])}var a=this.selectedRows[0];for(var r in n){var s=parseInt(r),i=n[r];if(s!==Rt){var o=this.getMix(parseInt(a));void 0!==i.parentEvent?o.dispatch(xk(i.parentEvent,i)):o.dispatch(jk(i,!0))}else this.deletePattern(i)}this.props.clearSelectedArrangementEvents()}}else for(var c in e)this.getMix(parseInt(c)).dispatch((t=e[c],{type:ja,payload:{selection:t}}))}},{key:"deletePattern",value:function(e){if(void 0===this.props.sequencerEngine.store.getState().keyboard.selectedPianoRollSteps){var t=e.track,n=t.patterns.indexOf(e);t.deletePattern(n),this.props.sequencerEngine.switchToPattern(0),t.updateSteps(),this.props.setSelectedRows([])}}},{key:"onMouseMoveResize",value:function(e){if(this.getState().isBottomResizing){var t=window.innerHeight-e.pageY;this.props.setArrangementBottomHeight(t-5)}}},{key:"onGlobalMouseUp",value:function(){this.props.setArrangementBottomResizing(!1),this.props.setArrangementPatternResizing(void 0)}},{key:"render",value:function(){var e=this,t={height:window.innerHeight-this.props.bottomHeight-50};return r.a.createElement("div",{onMouseUp:function(t){return e.onGlobalMouseUp()},onMouseMove:function(t){return e.onMouseMoveResize(t)},className:"arrangement-view"},r.a.createElement("div",{className:"arrangement-column"},r.a.createElement("div",{style:t,className:"full-arrangement-container"},r.a.createElement(JS,{updateAllTypeRedux:function(){return e.updateAllTypeRedux()},subSequence:It,sequencerEngine:this.props.sequencerEngine}),r.a.createElement(_S,{onMouseDown:function(t){return e.onMouseDown(t)},onMouseLeave:function(){return e.onMouseLeave()},onMouseMove:function(t){return e.onMouseMove(t)},mixSession:this.mixSession,arrangementContainer:this.state.arrangementContainer,resolution:this.props.resolution,onDragStart:function(t,n){return e.onDragPatternEvent(t,n)},onSelect:function(e,t){return[]},onMouseUp:function(t,n){return e.onMouseUp(t,n)},onRightMouseDown:function(t,n){return e.onRightMouseDown(t,n)},onLeftMouseDown:function(t,n){return e.onLeftMouseDown(t,n)},sequencerEngine:this.props.sequencerEngine}),r.a.createElement(KE,{sequencerEngine:this.props.sequencerEngine})),r.a.createElement(JE,null),r.a.createElement(BE,{sequencerEngine:this.props.sequencerEngine})))}},{key:"arrangementContainer",get:function(){return this.savedArrangementContainer?this.savedArrangementContainer:(this.savedArrangementContainer=document.getElementsByClassName("arrangement-container")[0],this.setState({arrangementContainer:this.savedArrangementContainer}),this.savedArrangementContainer)}},{key:"xScale",get:function(){return this.getState().xScale}},{key:"cursorStep",get:function(){return this.getState().cursorStep}},{key:"selectedRows",get:function(){return this.getState().selectedRows}},{key:"mixSession",get:function(){return this.props.sequencerEngine.mix}},{key:"mix",get:function(){return this.props.sequencerEngine.mixSession.mix}},{key:"bottomBarWidth",get:function(){return 225}}]),t}(a.Component)),KS=Object(y.b)(function(e,t){var n=t.sequencerEngine.engineId;return{resolution:sr,xScale:e.arrangement.xScale,subSequences:e.sequencer.subSequences[n]||[],bottomHeight:e.arrangement.bottomHeight}},function(e){return{playMix:function(){return e(Object(w.Ib)(!0))},setArrangementMouseX:function(t){return e(Object(w.B)(t))},setSelectedRows:function(t){return e(Object(w.G)(t))},clearSelectedArrangementEvents:function(){return e(Object(w.Hc)(void 0))},setArrangementBottomResizing:function(t){return e(Object(w.x)(t))},setArrangementBottomHeight:function(t){return e(Object(w.v)(t))},setArrangementCursorStep:function(t){return e(Object(w.y)(t))},setArrangementPatternDragging:function(t){return e(Object(w.C)(t))},setArrangementPatternResizing:function(t){return e(Object(w.D)(t))}}})(WS),YS=(n(989),300),QS=50,XS=function(e){return e&&{label:e.name,value:e}},ZS=function(e){return e&&{label:e.name,value:e}},$S=function(e){var t=e.parameters;return t.sort(function(e,t){return t.automations.length-e.automations.length}),t.filter(function(e){return e.automatable})};var eO=Object(y.b)(function(e,t){return t.track?{numEffects:t.track.effects.length,selectedDevice:e.automation.trackDevice[t.track.id],subDevice:e.automation.trackSubDevice[t.track.id],selectedParameter:e.automation.trackParameter[t.track.id],showAutomation:e.automation.show}:{}},function(e,t){return{setTrackAutomationParameter:function(n){return e(Object(w.be)(t.track.id,n))},setTrackAutomationDevice:function(n){return e(Object(w.ae)(t.track.id,n))},setTrackAutomationSubDevice:function(n){return e(Object(w.ce)(t.track.id,n))},setArrangementBottomResizing:function(t){return e(Object(w.x)(t))},setArrangementBottomHeight:function(t){return e(Object(w.v)(t))},setShowAutomation:function(t){return e(Object(w.hd)(t))}}})(function(e){var t=e.track,n=e.selectedDevice,s=e.subDevice,i=e.selectedParameter,o=[],c=[];for(var u in t.instrument&&o.push({value:t.instrument,label:t.instrument.name}),o=[].concat(Object(ge.a)(o),Object(ge.a)(t.effects.map(function(e){return XS(e)}))),e.sequencerEngine.lfos){var l=e.sequencerEngine.lfos[u].lfo;o.push({value:l,label:l.name})}var p=[];for(var h in n&&(p=s&&n.getSubDevices?$S(s).map(function(e){return ZS(e)}):$S(n).map(function(e){return ZS(e)}),n.getSubDevices&&(c=n.getSubDevices())),p)p[h].value.automations.length>0&&(p[h].className="has-automations");var d,f=Object(a.useState)(void 0),m=Object(Z.a)(f,2),v=m[0],g=m[1],b=Object(a.useCallback)(function(t){e.setArrangementBottomResizing(!0);var n=(new Date).getTime();void 0!==v&&n-v<=YS&&(e.sequencerEngine.store.getState().arrangement.bottomHeight<=QS?e.setArrangementBottomHeight(Gk[Hk]):e.setArrangementBottomHeight(25)),g(n)},[v,g]),y=Object(a.useCallback)(function(t){if(e.setTrackAutomationDevice(t),t.getSubDevices){var n=t.getSubDevices()[0].value;e.setTrackAutomationSubDevice(n),t=n}var a=$S(t);if(i){var r=a.find(function(e){return e.name===i.name});if(r)return void e.setTrackAutomationParameter(r)}e.setTrackAutomationParameter(a[0])},[i,e.setTrackAutomationParameter,e.setTrackAutomationSubDevice,e.setTrackAutomationDevice]),k=Object(a.useCallback)(function(t){e.setTrackAutomationSubDevice(t);var n=$S(t);if(i){var a=n.find(function(e){return e.name===i.name});if(a)return void e.setTrackAutomationParameter(a)}e.setTrackAutomationParameter(n[0])},[i]),E=e.showAutomation?"/automation-icon-enabled.png":"/automation-icon-disabled.png",S=e.showAutomation?"dropdowns":"dropdowns disabled";return r.a.createElement("div",{className:"automation-toolbar"},r.a.createElement("div",{className:S},r.a.createElement(pp.a,{onMouseDown:function(e){return e.stopPropagation()},options:o,onChange:function(e){return y(e.value)},value:XS(n),placeholder:"Device"}),c.length>0?r.a.createElement(pp.a,{onMouseDown:function(e){return e.stopPropagation()},options:c,onChange:function(e){return k(e.value)},value:(d=s,c.find(function(e){return e.value===d})),placeholder:"Sub Device"}):"",r.a.createElement(pp.a,{onMouseDown:function(e){return e.stopPropagation()},options:p,onChange:function(t){return e.setTrackAutomationParameter(t.value)},value:ZS(i),placeholder:"Parameter"})),r.a.createElement("img",{className:"automation-icon",src:E,onClick:function(){return e.setShowAutomation(!e.showAutomation)}}),r.a.createElement("div",{onMouseDown:b,onMouseUp:function(){return e.setArrangementBottomResizing(!1)},className:"toolbar-resizer"}))});var tO=Object(y.b)(null,function(e,t){return{setAnnotationDragging:function(t){return e(Object(w.t)(t))}}})(function(e){var t=e.annotation,n=e.color,s=e.onDelete,i=e.setAnnotationDragging,o=Object(a.useState)(t.text),c=Object(Z.a)(o,2),u=c[0],l=c[1],p=Object(a.useCallback)(function(e){e.stopPropagation(),t.text=e.target.value,l(e.target.value)},[l]),h={left:t.x,top:t.y,backgroundColor:n},d={backgroundColor:n},f=Object(a.useCallback)(function(e){i(t)},[i]);return r.a.createElement("div",{style:h,className:"annotation"},r.a.createElement("div",{onMouseDown:f,className:"draggable-header"},r.a.createElement("div",{className:"delete-button",onClick:s},"x")),r.a.createElement(A.g,{style:d,onChange:p,type:"textarea",value:u,placeholder:"Write a note",className:"annotation-text"}))});function nO(e){var t=e.track,n=e.sequencerEngine;return r.a.createElement(Kf,{track:t,rackTrack:{trackNumber:0},width:55,min:-50,onVolumeChange:function(e){return n.operationManager.dispatch(zi(t,e))}})}var aO=Object(y.b)(function(e,t){var n=t.sequencerEngine.getSequenceId();return{currentStep:(e.sequencer.currentGlobalStep[n]||0)%t.track.length}},null)(function(e){var t={left:448*e.currentStep/e.track.length};return r.a.createElement("div",{className:"play-tick",style:t})}),rO=128;function sO(e){var t="part";e.i===e.partNumber&&(t+=" current-part");return r.a.createElement("div",{onClick:function(){return function(){e.sequencerEngine.cursor.step=e.i*rO;var t=e.sequencerEngine.trackStep;e.sequencerEngine.seekToTrackStep(t%rO+e.i*rO,!1)}()},className:t})}var iO=Object(y.b)(function(e,t){var n=t.sequencerEngine.getSequenceId(),a=(e.sequencer.currentGlobalStep[n],e.tracks.trackSteps[t.track.trackNumber]);t.track.length;return{resolution:e.sequencer.resolution,steps:a}},null)(function(e){var t=e.track.pattern.length(e.resolution),n=(Array(t).fill(0),e.track.getStepsAtResolution(e.resolution).map(function(e,t){return{step:e,stepNumber:t}}).filter(function(e){return e.step.on})),a=Math.ceil(e.track.length/rO),s=Array(a).fill(0);return r.a.createElement("div",{className:"steps-map"},s.map(function(t,n){return r.a.createElement(sO,{i:n,track:e.track,sequencerEngine:e.sequencerEngine,partNumber:e.partNumber})}),n.map(function(n){return r.a.createElement(bS,{key:n.step.id,trackColor:e.trackColor,pattern:e.track.pattern,length:t,stepNumber:n.stepNumber,resolution:e.resolution,stepData:n.step})}),r.a.createElement(aO,{track:e.track,sequencerEngine:e.sequencerEngine}))}),oO=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e={marginLeft:28*this.props.currentStep};return r.a.createElement("div",{className:"steps-row-bottom"},void 0!==this.props.currentStep?r.a.createElement("div",{style:e,className:"current-step-box"}):"")}}]),t}(a.Component),cO=Object(y.b)(function(e,t){var n=t.sequencerEngine.getSequenceId(),a=Math.floor((e.sequencer.currentGlobalStep[n]||0)/(jo.baseResolution.numSteps()/e.sequencer.resolution.numSteps()));a%=t.stepsLength;var r=t.chunk*t.stepsInRow,s=(t.chunk+1)*t.stepsInRow;return{currentStep:a>=r&&a<s?a%t.stepsInRow:void 0}},null)(oO);function uO(e){return parseInt(e.numSteps())/4}n(2345),n(990);var lO=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={showMoreParameters:!1,refined:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"hasMidiFX",value:function(){return this.props.track.midiEffects.effects.length>0}},{key:"hasInstrument",value:function(){return void 0!==this.props.track.instrument}},{key:"onClickMore",value:function(){this.setState({showMoreParameters:!this.state.showMoreParameters})}},{key:"shouldBeRefined",value:function(){return this.props.stepData.duration%1!==0||this.props.stepData.transpose%1!==0}},{key:"onChangeRefined",value:function(e){var t="refined"===e;document.activeElement.blur(),this.setState({refined:t})}},{key:"onChangeDuration",value:function(e){this.props.sequencerEngine.operationManager.dispatch(Bi(this.props.track,this.props.stepData,this.props.stepData.durationParameter,e)),this.setState(this.state)}},{key:"onChangeChop",value:function(e){this.props.sequencerEngine.operationManager.dispatch(Bi(this.props.track,this.props.stepData,this.props.stepData.chopParameter,e)),this.state.chop=e,this.setState(this.state)}},{key:"onChangeParameter",value:function(e,t){this.props.sequencerEngine.operationManager.dispatch(Bi(this.props.track,this.props.stepData,e,t))}},{key:"onChangeChopDuration",value:function(e){this.props.stepData.chopDuration=e,this.state.chopDuration=e,this.setState(this.state)}},{key:"onChangeTranspose",value:function(e){this.props.sequencerEngine.operationManager.dispatch(Bi(this.props.track,this.props.stepData,this.props.stepData.transposeParameter,e)),this.state.transpose=e,this.setState(this.state)}},{key:"onChangeReversed",value:function(e,t){this.props.stepData.reverse=!t.reverse,document.activeElement.blur(),this.setState(this.state)}},{key:"onChangeVelocity",value:function(e){this.props.sequencerEngine.operationManager.dispatch(Bi(this.props.track,this.props.stepData,this.props.stepData.velocityParameter,e)),this.state.velocity=e,this.setState(this.state)}},{key:"onChangeSlice",value:function(e){this.props.sequencerEngine.operationManager.dispatch(Bi(this.props.track,this.props.stepData,this.props.stepData.sliceParameter,e)),this.state.slice=e,this.setState(this.state)}},{key:"onClickFX",value:function(){this.effects.length>0&&this.props.setShowStepOptions("AUDIO_FX",0)}},{key:"onClickInstrument",value:function(){return this.props.setShowStepOptions("INSTRUMENT",0)}},{key:"onClickMidiFX",value:function(){this.props.setShowStepOptions("MIDI_FX",0)}},{key:"onClickNextFX",value:function(){var e="MIDI_FX"===this.showOption?this.midiFX:this.effects;if(e.length>0){var t=(this.effectToShow+1)%e.length;this.props.setShowStepOptions(this.showOption,t)}}},{key:"onClickBack",value:function(){this.props.setShowStepOptions(void 0)}},{key:"onChangePanning",value:function(e){this.props.stepData.panning=e,this.props.onUpdateStepData(this.props.stepData),this.state.panning=e,this.setState(this.state)}},{key:"getParametersToShow",value:function(e){var t=this,n=this.state.refined?.01:1,a=this.state.refined?2:64,s=this.props.isMidi?bs.a.middleC.transpose(e.transpose).toString():e.transpose,i=this.state.refined?.01:1;if(this.state.showMoreParameters)return r.a.createElement("div",null,r.a.createElement(pO,{label:"Attack",labelValue:e.attack,value:e.attack,min:0,step:1,max:4e3,onChange:function(e){return t.onChangeParameter(t.props.stepData.attackParameter,e)}}),r.a.createElement(pO,{label:"Release",labelValue:e.release,value:e.release,min:0,step:1,max:6e3,onChange:function(e){return t.onChangeParameter(t.props.stepData.releaseParameter,e)}}),r.a.createElement(pO,{label:"Pitch Attack",labelValue:e.pitchAttack,value:e.pitchAttack,min:0,step:1,max:6e3,onChange:function(e){return t.onChangeParameter(t.props.stepData.pitchAttackParameter,e)}}),r.a.createElement(pO,{label:"Pitch Decay",labelValue:e.pitchDecay,value:e.pitchDecay,min:0,step:1,max:6e3,onChange:function(e){return t.onChangeParameter(t.props.stepData.pitchDecayParameter,e)}}),r.a.createElement(pO,{label:"Pitch Sustain",labelValue:e.pitchSustain,value:e.pitchSustain,min:-10,step:.01,max:10,onChange:function(e){return t.onChangeParameter(t.props.stepData.pitchSustainParameter,e)}}),r.a.createElement(pO,{label:"Pitch Release",labelValue:e.pitchRelease,value:e.pitchRelease,min:0,step:1,max:8e3,onChange:function(e){return t.onChangeParameter(t.props.stepData.pitchReleaseParameter,e)}}));var o=null===e.panning?this.props.track.getPanning():e.panning;return r.a.createElement("div",null,r.a.createElement(pO,{label:"Duration",labelValue:e.duration,value:e.duration,min:n,step:i,max:a,onChange:function(e){return t.onChangeDuration(e)}}," "),r.a.createElement(pO,{label:"Chop",labelValue:e.chop,value:e.chop,min:1,step:1,max:64,onChange:function(e){return t.onChangeChop(e)}}," "),r.a.createElement(pO,{label:"Slice",labelValue:e.slice,value:e.slice,min:0,step:1,max:this.props.slices-1,onChange:function(e){return t.onChangeSlice(e)}}," "),r.a.createElement(pO,{label:"Transpose",labelValue:s,value:e.transpose,min:-23,max:23,step:1,onChange:function(e){return t.onChangeTranspose(e)}}," "),r.a.createElement(pO,{label:"Velocity",labelValue:e.velocity,value:e.velocity,min:0,max:1,step:.1,onChange:function(e){return t.onChangeVelocity(e)}}," "),r.a.createElement(pO,{label:"Panning",labelValue:o,value:o,min:-1,max:1,step:.1,onChange:function(e){return t.onChangePanning(e)}}," "))}},{key:"getCheckboxes",value:function(e){var t=this;return r.a.createElement("div",null,r.a.createElement("div",{className:"reverse-parameter"},r.a.createElement("form",null,r.a.createElement("div",{className:"refined-checkbox"},r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",value:"reversed",checked:e.reverse,onChange:function(n){return t.onChangeReversed(n.target.value,e)}}),"Reverse")))),r.a.createElement("div",{className:"refined-parameter"},r.a.createElement("form",null,r.a.createElement("div",{className:"refined-checkbox"},r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",value:"refined",checked:this.state.refined,onChange:function(e){return t.onChangeRefined(e.target.value)}}),"Refine")))))}},{key:"effectExists",value:function(e){return"MIDI_FX"===this.showOption?void 0!==this.midiFX[e]:void 0!==this.effects[e]}},{key:"render",value:function(){var e=this,t=this.props.track.getStepDataForStep(this.props.stepData,!0);return"INSTRUMENT"===this.showOption&&this.hasInstrument()||"MIDI_FX"===this.showOption&&this.hasMidiFX()||"AUDIO_FX"===this.showOption&&this.effects.length>0?r.a.createElement("div",null,this.getEffectOrInstrument(),r.a.createElement("div",{className:"effects-parameters-button-container"},r.a.createElement(O,{condition:"AUDIO_FX"===this.showOption||"MIDI_FX"===this.state.showOption},r.a.createElement("div",{onClick:function(){return e.onClickNextFX()},className:"small-button pink-button float-right"},"NEXT")),r.a.createElement("div",{onClick:function(){return e.onClickBack()},className:"small-button pink-button float-right"},"BACK"))):r.a.createElement("div",null,this.getParametersToShow(t),this.getCheckboxes(t),r.a.createElement("div",{className:"effects-parameters-button-container"},this.effects.length>0?r.a.createElement("div",{onClick:function(){return e.onClickFX()},className:"small-button pink-button float-right"},"FX"):"",this.hasMidiFX()?r.a.createElement("div",{onClick:function(){return e.onClickMidiFX()},className:"small-button pink-button float-right"},"MIDI FX"):"",r.a.createElement(O,{condition:this.hasInstrument()},r.a.createElement("div",{onClick:function(){return e.onClickInstrument()},className:"small-button pink-button float-right"},"INSTRUMENT")),r.a.createElement("div",{onClick:function(){return e.onClickMore()},className:"small-button pink-button float-right"},this.state.showMoreParameters?"BACK":"MORE")))}},{key:"getEffectOrInstrument",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.effectToShow,n="MIDI_FX"===this.showOption?this.props.track.midiEffects.effects[t]:this.effects[t];if("MIDI_FX"===this.showOption&&this.effectExists(t))return r.a.createElement(ph,{onEffectsChange:function(){return e.props.track.updateEffects()},sequencerEngine:this.props.sequencerEngine,effect:n,track:this.props.track,effectNumber:t,automation:this.props.stepData.effectAutomations});if("AUDIO_FX"===this.showOption&&this.effectExists(t))return r.a.createElement(Sv.EffectComponent,{onEffectsChange:function(){return e.props.track.updateEffects()},sequencerEngine:this.props.sequencerEngine,effect:n,track:this.props.track,effectNumber:t,automation:this.props.stepData.effectAutomations});if("INSTRUMENT"===this.showOption&&this.hasInstrument()){var a=this.props.track.instrument.getInstrumentType();if(a===Ho)return r.a.createElement(Nf,{track:this.props.track,automation:this.props.stepData.effectAutomations,instrument:this.props.track.getInstrument()});if(a===Jo)return r.a.createElement(gd,{sequencerEngine:this.props.sequencerEngine,track:this.props.track,automation:this.props.stepData.effectAutomations,instrument:this.props.track.getInstrument()});if(a===Go)return r.a.createElement(Pf,{sequencerEngine:this.props.sequencerEngine,track:this.props.track,automation:this.props.stepData.effectAutomations,instrument:this.props.track.getInstrument()});if(a===zo)return r.a.createElement(Tf,{sequencerEngine:this.props.sequencerEngine,automation:this.props.stepData.effectAutomations,track:this.props.track,instrument:this.props.track.getInstrument()})}return""}},{key:"effectToShow",get:function(){return void 0===this.props.showStepOptions?void 0:this.props.showStepOptions.effect}},{key:"showOption",get:function(){return void 0===this.props.showStepOptions?void 0:this.props.showStepOptions.option}},{key:"effects",get:function(){return this.props.track.effectsChains[this.props.effectsChain].effects}},{key:"midiFX",get:function(){return this.props.track.midiEffects.effects}}]),t}(a.Component),pO=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.value!==e.value||this.props.step!==e.step}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"step-parameter"},r.a.createElement("div",{className:"parameter-label"},this.props.label,": ",this.props.labelValue," "),r.a.createElement(fe.a,{value:this.props.value,change:function(t){return e.props.onChange(t.target.value)},step:this.props.step,max:this.props.max,min:this.props.min,orientation:"horizontal",reversed:!1}))}}]),t}(a.Component),hO=Object(y.b)(function(e,t){var n=t.track.trackNumber;return{effectsChain:e.tracks.trackEffectsChain[n]||0,showStepOptions:e.steps.showStepOptions}},function(e){return{setShowStepOptions:function(t,n){return e(Object(w.zd)(t,n))}}})(lO),dO=new U.a,fO=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"brighten",value:function(e,t){var n=Math.min(255,Math.floor(parseInt(e.slice(1,3),16)*t)),a=Math.min(255,Math.floor(parseInt(e.slice(3,5),16)*t)),r=Math.min(255,Math.floor(parseInt(e.slice(5),16)*t));return n=n.toString(16),a=a.toString(16),r=r.toString(16),1===n.length&&(n="0"+n),1===a.length&&(a="0"+a),1===r.length&&(r="0"+r),"#"+n+a+r}},{key:"render",value:function(){var e={};if(this.props.fill){e={backgroundColor:this.brighten(dO.getColorForHash(this.props.sampleId),.3)}}var t="fill ";return this.props.isCurrentStep&&(t+=" current-step"),this.props.isCursor&&(t+=" cursor"),this.props.on&&(t+=" on"),r.a.createElement("div",{style:e,className:t})}}]),t}(a.Component),mO=new U.a,vO=new ht(16,!1),gO=new ot,bO=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n.id=n.props.sample&&n.props.sample.getId()?n.props.sample.getId():n.props.track.getName(),n.id||(n.id="fuck"),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props;return e.showParameters!==t.showParameters||e.on!==t.on||e.isCursor!==t.isCursor||e.show!==t.show||e.selectedSteps!==t.selectedSteps||e.stepsSelection!==t.stepsSelection||e.fill!==t.fill}},{key:"getState",value:function(){return this.props.sequencerEngine.store.getState()}},{key:"componentDidUpdate",value:function(e){if(this.props.isCursor&&this.props.isCursor!==e.isCursor){var t=document.getElementsByClassName("cursor")[0];if(!function(e){var t=e.getBoundingClientRect(),n=t.top,a=t.bottom;return n>=40&&a<=window.innerHeight-100}(t)){var n=t.getBoundingClientRect().y;window.scroll(0,n+300)}}}},{key:"onMouseUp",value:function(e){if(!this.props.isGroup){this.props.setSingleStepToDrag(void 0),this.props.setIsDraggingDuration(!1),this.props.setStepToCopy(void 0);var t=this.props.sequencerEngine.store.getState();(this.isCommandDown||t.steps.stepNumberDraggedTo!==this.props.stepNumber)&&t.steps.stepNumberDraggingFrom===this.props.stepNumber?(this.props.onClick(),this.props.setStepNumberDraggedTo(void 0),this.setState(this.state)):this.props.setStepNumberDraggedTo(void 0)}}},{key:"onMouseDown",value:function(){this.props.showParameters||(this.props.mouseDown(!0),this.props.selectStep&&this.props.selectStep(),this.props.isGroup||(this.isSelected()?this.props.setStepNumberDraggingFrom(this.props.stepNumber):!this.isCommandDown&&this.props.on?(this.props.setSelectedSteps(void 0),this.props.setSingleStepToDrag(this.stepData),this.props.setStepNumberDraggingFrom(this.props.stepNumber)):(this.props.setSelectedSteps(void 0),this.props.setStepsSelection(this.props.trackNumber,this.props.stepNumber,this.props.stepNumber)),this.props.setStepNumberDraggingFrom(this.props.stepNumber)))}},{key:"onMouseOver",value:function(e){if(e.stopPropagation(),this.props.setContextualHelp("STEP"),!this.props.showParameters){var t=this.props.sequencerEngine.store.getState();if(t.keyboard.isDraggingDuration&&t.keyboard.isMouseDown)this.updateDuration();else if(void 0===t.steps.stepNumberDraggingFrom||void 0===t.steps.selectedSteps&&!t.steps.singleStepToDrag){if(void 0!==this.props.stepsSelection){var n=this.props.stepsSelection;this.props.stepNumber>=n.fromStep?this.props.setStepsSelection(this.props.trackNumber,n.fromStep,this.props.stepNumber):this.props.setStepsSelection(this.props.trackNumber,this.props.stepNumber,n.toStep)}}else{var a=this.getTransformation(t.steps.stepNumberDraggingFrom),r=void 0!==t.steps.selectedSteps?t.steps.selectedSteps.steps:[t.steps.singleStepToDrag];this.props.sequencerEngine.operationManager.dispatch(Fi(this.props.sequencerEngine.tracks[this.props.trackNumber],r,a,this.props.resolution)),this.props.setStepNumberDraggingFrom(this.props.stepNumber),this.props.setStepNumberDraggedTo(this.props.stepNumber),this.props.selectStep()}}}},{key:"getState",value:function(){return this.props.sequencerEngine.store.getState()}},{key:"updateDuration",value:function(){var e=this,t=1+this.props.stepNumber-this.getState().keyboard.stepDragging,n=vO.transformStepAtResolution2(t,this.props.resolution),a=this.getState().keyboard.stepToCopy;null===a.duration?this.props.track.trackData.duration:a.duration;this.props.selectedSteps?this.props.selectedSteps.steps.forEach(function(t){return e.updateStepDuration(t,n)}):this.updateStepDuration(a,n)}},{key:"updateStepDuration",value:function(e,t){null===e.duration?this.props.track.trackData.duration:e.duration;this.props.sequencerEngine.operationManager.dispatch(Bi(this.props.sequencerEngine.tracks[this.props.trackNumber],e,e.durationParameter,Math.max(.1,t)))}},{key:"getTransformation",value:function(e){return{stepDifference:this.props.stepNumber-e,transposeDifference:0}}},{key:"isSelection",value:function(){var e=this.props.stepsSelection;return void 0!==e&&(this.props.stepNumber>=e.fromStep&&this.props.stepNumber<=e.toStep)}},{key:"isSelected",value:function(){var e=this;return!(void 0===this.props.selectedSteps||!this.props.on||this.props.showParameters)&&this.props.selectedSteps.steps.filter(function(t){return t.id===e.stepData.id}).length>0}},{key:"dragStepDuration",value:function(e){e.stopPropagation(),this.isSelected()||this.props.setSelectedSteps(void 0),this.props.setIsDraggingDuration(!0),console.log("drag step durations set step dragging = ",this.props.stepNumber),this.props.setStepDragging(this.props.stepNumber),this.props.setStepToCopy(this.stepData),this.props.mouseDown(!0)}},{key:"getRGB",value:function(e){return{r:Math.floor(parseInt(e.slice(1,3),16)),g:Math.floor(parseInt(e.slice(3,5),16)),b:Math.floor(parseInt(e.slice(5),16))}}},{key:"getBrightness",value:function(e){var t=this.getRGB(e);return.299*t.r+.587*t.g+.114*t.b}},{key:"brighten",value:function(e,t){var n=Math.min(255,Math.floor(parseInt(e.slice(1,3),16)*t)),a=Math.min(255,Math.floor(parseInt(e.slice(3,5),16)*t)),r=Math.min(255,Math.floor(parseInt(e.slice(5),16)*t));return n=n.toString(16),a=a.toString(16),r=r.toString(16),1===n.length&&(n="0"+n),1===a.length&&(a="0"+a),1===r.length&&(r="0"+r),"#"+n+a+r}},{key:"render",value:function(){var e=this,t=(this.props.isAlternateColor,{});if(!this.props.showParameters&&this.props.on){var n=.7*this.props.velocity+.3;t.opacity=n}this.props.isAlternateColor;var a="step ";this.props.on?(a+="on ",t.backgroundColor=this.color):a+="off ",this.props.isAlternateColor&&(a+=" alternate "),this.isSelected()?a+=" selected ":this.props.isCurrentStep&&this.props.isCursor?a+=" cursor ":this.props.isCurrentStep?a+=" current-step ":this.props.isCursor&&(a+=" cursor "),this.props.viMode&&(a+=" vi-mode");this.props.fill&&this.fillColor,this.props.on&&(t.borderBottomColor=mO.getColor(this.props.slice),t.borderBottomWidth="5px"),this.props.showParameters||(a+=" not-expanded"),a+=this.isSelection()?" selection ":"";var s=uO(this.props.resolution);return s>2&&this.props.stepNumber%s===0&&(a+=" beat-division"),r.a.createElement("div",{className:"step-container"},r.a.createElement("div",{key:this.props.stepNumber,onMouseDown:function(){return e.onMouseDown()},onMouseOver:function(t){return e.onMouseOver(t)},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onMouseUp:function(t){return e.onMouseUp(t)},style:t,className:a},this.props.showParameters?r.a.createElement(hO,{sequencerEngine:this.props.sequencerEngine,track:this.props.track,isMidi:this.props.isMidi,onUpdateStepData:function(t){e.props.onUpdateStepData(t),e.setState(e.state)},onUpdateStepDuration:this.props.onUpdateStepDuration,slices:this.props.slices,stepData:this.stepData}):"",r.a.createElement(O,{condition:this.props.on},r.a.createElement("div",{draggable:!1,onMouseDown:function(t){return e.dragStepDuration(t)},className:"right-edge"}))),r.a.createElement(fO,{sampleId:this.id,on:this.props.on,fill:this.props.fill,isCurrentStep:this.props.isCurrentStep,isCursor:this.props.isCursor}))}},{key:"color",get:function(){this.id=this.props.sample&&this.props.sample.getId()?this.props.sample.getId():this.props.track.getName(),this.id||(this.id="fuck");var e=this.props.isAlternateColor?1:1.2;mO.getColorForHash(this.id);return this.brighten(mO.getColorForHash(this.id),e)}},{key:"isCommandDown",get:function(){return this.props.sequencerEngine.store.getState().keyboard.isCommandDown}},{key:"stepData",get:function(){var e=this.props.sequencerEngine.store.getState().tracks.trackStepIds[this.props.trackNumber],t=e&&e[this.props.stepNumber];return void 0!==t&&t.on||(t=gO),t}}]),t}(a.Component);var yO=Object(y.b)(null,function(e){return{mouseDown:function(t){return e(Object(w.j)(t))},dragToggle:function(t){return e(Object(w.h)(t))},setContextualHelp:function(t){return e(Object(w.V)(t))},setStepToCopy:function(t){return e(Object(w.Qd)(t))},setStepDragging:function(t){return e(Object(w.Nd)(t))},setSingleStepToDrag:function(t){return e(Object(w.Jd)(t))},setStepsSelection:function(t,n,a){return e(Object(w.Rd)(t,n,a))},setStepNumberDraggingFrom:function(t){return e(Object(w.Pd)(t))},setStepNumberDraggedTo:function(t){return e(Object(w.Od)(t))},setIsDraggingDuration:function(t){return e(Object(w.Gb)(t))},setSelectedSteps:function(t,n,a){return e(Object(w.Zc)(t,n,a))}}})(bO);function kO(e,t){var n=t.transformStepAtResolution2(e.pattern.length(),new ht(32,!1));n=Math.floor(n);for(var a=new Array(n).fill(0),r=t.isTriplet?12:16,s=a.length/r,i=[],o=0;o<s;o++){var c=o*r,u=c+r;i.push(a.slice(c,u))}return i}function EO(e){return e.isTriplet?12:16}var SO=new ot,OO=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onMouseLeave",value:function(){this.props.updateSelectedSteps(),this.props.setStepsSelection(void 0),this.props.setStepNumberDraggedTo(void 0)}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"onClickStep",value:function(e){this.props.onClick(e)}},{key:"isAlternateColor",value:function(e,t,n){return Math.ceil((e+1)/t)%2!=0}},{key:"onClickLock",value:function(){this.props.trackData.togglePatternLock(),this.setState(this.state)}},{key:"record",value:function(){this.props.trackPreparingToRecord(this.props.trackNumber,!0),this.props.sequencerEngine.recordTrack(this.props.trackNumber),this.setState(this.state)}},{key:"getStepsRowClassName",value:function(e){var t="steps-row";return Math.floor(e/4)%2===1&&(t+=" odd"),t}},{key:"isCursor",value:function(e){return this.props.cursorStep===e}},{key:"isOn",value:function(e){return this.props.steps&&this.props.steps[e]}},{key:"isViMode",value:function(e){return this.props.viMode&&this.isCursor(e)}},{key:"getStepData",value:function(e){var t=this.props.stepDatas&&this.props.stepDatas[e];return void 0!==t&&t.on||(t=SO),t}},{key:"getVelocity",value:function(e){return this.getStepData(e).velocity}},{key:"getSlice",value:function(e){return this.getStepData(e).slice}},{key:"isFilled",value:function(e){return this.props.fills&&this.props.fills[e]}},{key:"getState",value:function(){return this.props.sequencerEngine.store.getState()}},{key:"showParameters",value:function(e){return this.getState().cursor.track===this.props.trackNumber&&this.props.sequencerEngine.getSelectedStep()===e&&this.getState().cursor.show}},{key:"render",value:function(){var e=this,t=((new Date).getTime(),EO(this.props.resolution)),n=kO(this.props.track,this.props.resolution),a=0;if(this.length>128){a=Math.floor(this.props.partNumber*n.length/this.props.numberParts);var s=Math.floor((this.props.partNumber+1)*n.length/this.props.numberParts);n=n.filter(function(e,t){return t>=a&&t<s})}var i=uO(this.props.resolution),o=this.props.track.numberOfSlices(),c=this.props.isTrackRecording,u=this.props.isTrackPreparingToRecord,l=this.props.isCompactMode?"track-footer-container compact":"track-footer-container",p="dot";c?p="recording-dot":u&&(p="preparing-dot");var h="";this.length>128&&(h=r.a.createElement(iO,{partNumber:this.props.partNumber,trackColor:this.props.trackColor,track:this.props.trackData,sequencerEngine:this.props.sequencerEngine}));(new Date).getTime();return r.a.createElement("div",{onMouseLeave:function(){return e.onMouseLeave()},className:"steps-container"},h,n.map(function(n,s){return r.a.createElement("div",{key:"steps-row-chunk- "+s},r.a.createElement("div",{className:e.getStepsRowClassName(s)},n.map(function(n,c){var u,l=t*(a+s)+c;return r.a.createElement(yO,(u={sample:e.props.sample,key:"key-"+(t*(s+a)+c)+"."+e.props.trackNumber,isCursor:e.isCursor(l),on:e.isOn(l),fill:e.isFilled(l),showParameters:e.showParameters(l),selectedSteps:e.props.selectedSteps,stepsSelection:e.props.stepsSelection,slice:e.getSlice(l),velocity:e.getVelocity(l),sequencerEngine:e.props.sequencerEngine,effectToShow:e.state.effectToShow,isMidi:e.props.isMidiTrack,resolution:e.props.resolution,trackNumber:e.props.trackNumber},Object(_e.a)(u,"resolution",e.props.resolution),Object(_e.a)(u,"stepNumber",l),Object(_e.a)(u,"selectStep",function(){return e.props.selectStep(t*(a+s)+c)}),Object(_e.a)(u,"stepsLength",e.props.stepsLength),Object(_e.a)(u,"show",e.props.show),Object(_e.a)(u,"trackData",e.props.track),Object(_e.a)(u,"onUpdateStepDuration",function(n){return e.props.onUpdateStepDuration(t*(a+s)+c,n)}),Object(_e.a)(u,"onUpdateStepData",function(n){return e.props.onUpdateStepData(n,t*(a+s)+c)}),Object(_e.a)(u,"isAlternateColor",e.isAlternateColor(c,i,e.props.resolution)),Object(_e.a)(u,"slices",o),Object(_e.a)(u,"track",e.props.track),Object(_e.a)(u,"onClick",function(){return e.onClickStep(t*(a+s)+c)}),u))})),r.a.createElement(cO,{sequencerEngine:e.props.sequencerEngine,track:e.props.track,stepsLength:e.props.stepsLength,stepsInRow:t,chunk:a+s}))}),r.a.createElement("div",null,this.props.track.isRecordable()?r.a.createElement("div",{className:"record-audio-button"},r.a.createElement("span",{onClick:function(){return e.record()},className:p})):"",r.a.createElement(O,{condition:!this.props.isCompactMode},r.a.createElement("div",null,r.a.createElement("div",{className:l},r.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"TRACK_ADD_STEPS_BUTTON")},onMouseLeave:function(t){return e.props.setContextualHelp(void 0)},onClick:this.props.onClickAddSteps,className:"add-steps-button"},"+"),r.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"TRACK_REMOVE_STEPS_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:this.props.onClickRemoveSteps,className:"remove-steps-button"},"-")),r.a.createElement(Fl,{toggleLock:function(){return e.onClickLock()},patternLocked:this.props.patternLocked})))))}},{key:"length",get:function(){return this.props.trackData.length}}]),t}(a.Component),wO=Object(y.b)(function(e,t){var n,a=t.sequencerEngine.getSequenceId(),r=(e.sequencer.currentStep[a],e.sequencer.currentGlobalStep[a]||0),s=(e.tracks.trackSteps[t.trackData.subSequence.isTrack?t.trackData.subSequence.id:t.trackNumber],e.tracks.trackPatternLocks[t.trackData.subSequence.id]),i=!1;if(s){var o=s[t.trackNumber];o&&(i=o[t.trackData.currentPattern])}var c=void 0,u=void 0;if(t.track.length>128){c=Math.floor(r%t.trackData.length/128),u=t.track.length/128;var l=e.mix.selectedTrack==t.trackNumber,p=t.sequencerEngine.cursor.getStep();l&&!t.sequencerEngine.playing&&(c=Math.floor(p/128))}var h=e.steps.stepsSelection,d=e.steps.selectedSteps;return n={partNumber:c,numberParts:u,resolution:e.sequencer.resolution,samples:e.samples,isTrackRecording:e.sequencer.tracksRecording[t.trackNumber],isTrackPreparingToRecord:e.sequencer.tracksPreparingToRecord[t.trackNumber],stepsLength:t.track.pattern.length(e.sequencer.resolution),isSelectedTrack:e.mix.selectedTrack===t.trackNumber,selectedSteps:e.steps.selectedSteps,patternLocked:i,isCompactMode:e.sequencer.isCompactMode,cursorStep:e.mix.selectedTrack!==t.trackNumber||t.show?-1:e.mix.selectedStep,fills:e.tracks.trackFills[t.trackNumber],stepDatas:e.tracks.trackStepIds[t.trackNumber]},Object(_e.a)(n,"selectedSteps",void 0!==d&&d.trackNumber===t.trackNumber?d:void 0),Object(_e.a)(n,"stepsSelection",void 0!==h&&h.trackNumber===t.trackNumber?h:void 0),Object(_e.a)(n,"viMode",e.commands.viMode),Object(_e.a)(n,"steps",e.tracks.trackSteps[t.trackNumber]),Object(_e.a)(n,"cursorShow",e.mix.selectedTrack===t.trackNumber&&t.sequencerEngine.cursor.show),n},function(e,t){return{mouseDown:function(t){return e(Object(w.j)(t))},hideAllEffects:function(t){return e(Object(w.i)())},setTrackFocused:function(){return e(Object(w.de)(t.trackNumber))},setTrackToFreeze:function(){return e(Object(w.oe)(t.trackData.subSequence.id,t.trackNumber))},setTrackUnfocused:function(){return e(Object(w.de)(void 0))},setSelectedPianoRollSteps:function(t){return e(Object(w.Sc)(t))},setStepsSelection:function(t){return e(Object(w.Rd)(t))},setSelectorMode:function(t){return e(Object(w.bd)(t))},setSimilarSoundsToFind:function(t){return e(Object(w.Id)(t))},setSidebarCollapsed:function(t){return e(Object(w.Fd)(t))},setSelectedSteps:function(t,n,a){return e(Object(w.Zc)(t,n,a))},setStepNumberDraggingFrom:function(t){return e(Object(w.Pd)(t))},setStepNumberDraggedTo:function(t){return e(Object(w.Od)(t))},setContextualHelp:function(t){return e(Object(w.V)(t))}}})(OO),CO=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getProgress",value:function(){var e=this.props.currentGlobalStep%this.props.track.pattern.length()/this.props.track.pattern.length(),t=[];if(this.props.isPlaying||this.props.isPreparingToFreeze||this.props.isResampling)for(var n=0;n<16;n++)e>1*n/16&&t.push(n);return r.a.createElement("div",{className:"frozen-progress"},t.map(function(e){return r.a.createElement("div",{className:"progress-part"})}))}},{key:"expandSample",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.track.sample.getCopy();case 2:t=e.sent,this.props.sequencerEngine.addSound(t);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(e){this.props.setPlaying(!this.props.isPlaying)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",{className:"frozen-container"},r.a.createElement(O,{condition:this.props.showPlayButton},r.a.createElement(ae,{play:function(t){return e.play(t)},isPlaying:this.props.isPlaying})),r.a.createElement(O,{condition:!this.props.showPlayButton},r.a.createElement("div",{className:"freezing-label"},"Freezing")),this.getProgress()),r.a.createElement(O,{condition:this.props.showPlayButton},r.a.createElement("div",{onClick:function(){return e.expandSample()},className:"expand-sample"},"Expand")))}}]),t}(a.Component),PO=Object(y.b)(function(e,t){var n=e.sequencer.sequencerEngine.getSequenceId();e.sequencer.currentStep[n];return{currentGlobalStep:e.sequencer.currentGlobalStep[n]||0,isPlaying:(e.tracks.frozenTracksPlaying[t.track.subSequence.id]||{})[t.track.trackNumber],isPreparingToFreeze:e.tracks.trackToFreeze&&e.tracks.trackToFreeze.trackNumber===t.track.trackNumber,isResampling:e.tracks.isResampling}},function(e,t){return{setPlaying:function(n){return e(Object(w.wb)(t.track.subSequence.id,t.track.trackNumber,n))}}})(CO),TO=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={nameValue:"",isEffects:!1,guildOptions:[],saveOption:Ju,selectedGuild:void 0,guildIds:[]},n.input=void 0,n.onClickDone=n.onClickDone.bind(Object(p.a)(n)),n.onClickCancel=n.onClickCancel.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getPresetGuilds",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getPresetGuilds"),t=this.props.sequencerEngine.tracks[this.props.trackNumber],e.next=4,t.getGuildIds();case 4:n=e.sent,console.log("get preset guilds returned = ",n),this.setState({guildIds:n});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"shouldComponentUpdate",value:function(e){return e.show&&this.props.show!=e.show&&(this.getGuilds(),this.input&&this.input.focus(),this.getPresetGuilds()),!0}},{key:"getGuilds",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.a.guilds.getGuildsForUser();case 2:t=e.sent,void 0!==this.props.selectedGuild&&this.setState({saveOption:Gu}),this.setState({selectedGuild:this.props.selectedGuild,guildOptions:t});case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onSelectGuild",value:function(e){this.setState({selectedGuild:e})}},{key:"onClickDone",value:function(){this.props.sequencerEngine.saveTrackPreset(this.props.trackNumber,this.state.nameValue,this.state.isEffects,void 0===this.state.selectedGuild?0:this.state.selectedGuild.guildId),this.props.onHide()}},{key:"onClickCancel",value:function(){this.props.onHide()}},{key:"onInputType",value:function(e){this.setState({nameValue:e})}},{key:"handleCheckboxChange",value:function(e){this.setState({isEffects:"track"!==e.target.name})}},{key:"render",value:function(){var e=this;return r.a.createElement(D.a,{dialogClassName:"preset-modal",show:this.props.show,onHide:this.onClickCancel},r.a.createElement(D.a.Header,{closeButton:!0},r.a.createElement(D.a.Title,null,"Save Preset")),r.a.createElement(D.a.Body,null,r.a.createElement("input",{value:this.state.nameValue,onChange:function(t){return e.onInputType(t.target.value)},ref:function(t){e.input=t},placeholder:"Type name of preset",className:"tag-input"}),r.a.createElement("form",null,r.a.createElement("input",{name:"track",type:"checkbox",checked:!this.state.isEffects,onChange:function(t){return e.handleCheckboxChange(t)}}),r.a.createElement("label",null,"Track"),r.a.createElement("input",{name:"effects",type:"checkbox",checked:this.state.isEffects,onChange:function(t){return e.handleCheckboxChange(t)}}),r.a.createElement("label",null,"Effects")),r.a.createElement(Dy,{showPublic:!0,onSelectGuild:function(t){return e.onSelectGuild(t)},selectedGuild:this.state.selectedGuild,guildOptions:this.state.guildOptions})),r.a.createElement(D.a.Footer,null,r.a.createElement(A.b,{variant:"secondary",onClick:this.onClickDone},"Save"),r.a.createElement(A.b,{variant:"primary",onClick:this.onClickCancel},"Cancel")))}}]),t}(a.Component),jO=Object(y.b)(function(e){return{selectedGuild:e.guilds.selectedGuild}},function(e){return{setContextualHelp:function(t){return e(Object(w.V)(t))}}})(TO),xO=n(199),NO=(n(2346),function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getOptions",value:function(){var e=this.props.midiEngine,t=[{label:"All",value:{type:eo}},{label:"Computer Keyboard",value:{type:"COMPUTER_KEYBOARD"}}],n=e.getInputs().map(function(e){return{label:e.name,value:{type:"CUSTOM",input:e}}});return t.concat(n)}},{key:"getSelectedOption",value:function(){var e=this.props.midiInputs;return this.getOptions().filter(function(t){return t.value.type===e.type&&("CUSTOM"!==e.type||e.accepts(!1,t.value.input.name))})[0]}},{key:"onSelect",value:function(e){"CUSTOM"===e.value.type?this.props.midiInputs.addMidiInput(e.value.input):this.props.midiInputs.setType(e.value.type)}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"TRACK_MIDI_DROPDOWN")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:"midi-input-dropdown-container"},r.a.createElement(pp.a,{className:"midi-input-dropdown",controlClassName:"midi-input-control-dropdown",arrowClassName:"audio-input-arrow-dropdown",options:this.getOptions(),onChange:function(t){return e.onSelect(t)},value:this.getSelectedOption(),placeholder:"Input"}))}}]),t}(a.Component)),qO=Object(y.b)(null,function(e,t){return{setContextualHelp:function(t){return e(Object(w.V)(t))}}})(NO),MO=(a.Component,n(2347),new U.a),DO=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={editingName:!1,addingTag:!1,nameValue:"",tagValue:""},n.onClickName=n.onClickName.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickAddTag",value:function(){this.setState({tagValue:"",addingTag:!0})}},{key:"getTagClass",value:function(e){return this.props.track.sample.highlightedTags[e]?"track-tag highlighted":"track-tag"}},{key:"onClickTag",value:function(e){this.props.track.sample.highlightedTags[e]=!this.props.track.sample.highlightedTags[e],this.setState(this.state)}},{key:"onClickName",value:function(){this.props.track.sample.isResampled&&!this.state.editing&&this.setState({nameValue:this.props.track.sample.name,editingName:!0})}},{key:"truncateName",value:function(e){return void 0===e||null===e?null:(e.length>40?e.substring(0,40)+"...":e).trim()}},{key:"onNameKeyDown",value:function(e){"Enter"===e.key&&(this.props.track.sample.name=this.state.nameValue,this.setState({editingName:!1}))}},{key:"onTagKeyDown",value:function(e){"Enter"===e.key&&(console.log("tag value = "+this.state.tagValue),this.props.track.sample.tags.push(this.state.tagValue),this.setState({addingTag:!1}))}},{key:"render",value:function(){var e=this,t=this.props.track.sample,n={},a={};return this.props.isSelected?n.backgroundColor=this.props.borderColor:a.backgroundColor=MO.brighten(this.props.trackColor,.5),r.a.createElement("div",{style:n,className:"track-header"},r.a.createElement("div",{onClick:this.onClickName,style:a,className:"track-name-view"},r.a.createElement(O,{condition:this.state.editingName},r.a.createElement("input",{className:"resample-name-input",onKeyDown:function(t){return e.onNameKeyDown(t)},type:"text",nameValue:this.state.nameValue,onChange:function(t){return e.setState({nameValue:t.target.value})}})),r.a.createElement(O,{condition:!this.state.editingName},this.truncateName(this.props.track.presetName||this.props.track.getName()))),r.a.createElement("div",{className:"track-tags"},r.a.createElement(O,{condition:!window.installation},r.a.createElement(O,{condition:this.state.addingTag},r.a.createElement("input",{className:"resample-name-input sample-tag-input",onKeyDown:function(t){return e.onTagKeyDown(t)},type:"text",placeholder:"Type tag",nameValue:this.state.tagValue,onChange:function(t){return e.setState({tagValue:t.target.value})}})),r.a.createElement(O,{condition:!this.state.addingTag},r.a.createElement("div",{onClick:function(){return e.onClickAddTag()},className:"add-sample-tag-button"},"+"))),void 0===t||void 0===t.tags?"":t.tags.map(function(t){return r.a.createElement("div",{onClick:function(){return e.onClickTag(t)},key:t,className:e.getTagClass(t)},t)})),r.a.createElement("div",{onClick:this.props.onClickDelete,className:"delete-button delete-track-button"},"x"))}}]),t}(a.Component),AO=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={height:0,referenceHeight:n.fromDecibel(0)},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"fromDecibel",value:function(e){return.8*Math.pow(10,e/20)*58}},{key:"componentDidMount",value:function(){var e=this;this.timer=setInterval(function(){var t=e.props.meter.getLevel();e.setState({isRed:t>0,height:Math.min(60,e.fromDecibel(t))})},100)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"render",value:function(){var e={height:this.state.height},t={height:this.state.referenceHeight},n="track-meter-value";return this.state.isRed&&(n+=" is-red"),r.a.createElement("div",{className:"track-meter"},r.a.createElement("div",{className:n,style:e}),r.a.createElement("div",{className:"track-meter-reference",style:t}))}}]),t}(a.Component),RO=(n(991),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onToggleClicked",value:function(){this.props.trackData.toggleEnabled(),this.setState(this.state)}},{key:"onMuteClicked",value:function(){var e,t;this.props.sequencerEngine.operationManager.dispatch((e=this.props.trackData,t=!this.props.muted,{type:"UPDATE_TRACK_MUTE",payload:{track:e,mute:t}})),this.setState(this.state)}},{key:"onSoloClicked",value:function(){this.props.trackData.solo(!this.props.solo)}},{key:"onChangeVolume",value:function(e){}},{key:"onChangeVolume",value:function(e){void 0!==e&&(e=parseFloat(e),this.props.trackData.setVolume(e),this.setState(this.state))}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(e),this.props.setContextualHelp(t)}},{key:"render",value:function(){var e=this,t=1==this.props.triggering?" flashit ":"",n=this.props.muted?t+"mute-button muted":t+"mute-button";return this.props.isCompactMode&&(n+=" compact"),r.a.createElement("div",{className:"track-controls"},r.a.createElement("div",{className:"volume-container"},r.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"TRACK_MUTE_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:n,onClick:function(){return e.onMuteClicked()}},this.props.trackNumber+1),r.a.createElement("div",{onClick:function(){return e.onSoloClicked()},onMouseOver:function(t){return e.setContextualHelp(t,"TRACK_SOLO_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:this.props.solo?"track-solo-button on":"track-solo-button off"},"S"),r.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"TRACK_RECORD_ARM_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onToggleClicked()},className:this.props.isEnabled?"midi-recording-button on":"midi-recording-button off"},r.a.createElement("span",{className:"black plain-dot"}))),r.a.createElement(O,{condition:!this.props.isCompactMode},this.props.isSelectedTrack?r.a.createElement(AO,{meter:this.props.trackData.trackMeter}):r.a.createElement("div",{className:"ghost-meter"})))}}]),t}(a.Component)),IO=Object(y.b)(function(e,t){var n=e.tracks.trackVolumes[t.trackNumber],a=e.tracks.trackMutes[t.trackNumber],r=e.tracks.trackSolos[t.trackNumber],s=(e.tracks.trackIsEnabled[t.trackData.subSequence.id]||{})[t.trackNumber],i=e.tracks.triggers[t.trackNumber];return{triggering:void 0!==i&&Object.keys(i).some(function(e){return!0===i[e]}),volume:void 0===n?0:n,muted:void 0!==a&&a,solo:void 0!==r&&r,isEnabled:void 0!==s&&s,isCompactMode:e.sequencer.isCompactMode}},function(e,t){return{setContextualHelp:function(t){return e(Object(w.V)(t))}}})(RO),LO=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getEventX",value:function(){this.props.event.time;var e=this.props.event.step;return this.props.width*(e/this.props.length)}},{key:"getValue",value:function(){var e=this.props.event.getValue();return console.log("value = "+e),e}},{key:"render",value:function(){return r.a.createElement(b.Group,null,r.a.createElement(b.Rect,{x:this.getEventX(),y:this.getValue(),height:2,width:2,fill:"white"}))}}]),t}(a.Component),FO=(n(2348),a.Component,new U.a),VO=function(e){function t(e){var n;Object(o.a)(this,t);(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).effects.every(function(e){return!e.isEnabled()});return n.state={selectedStep:0,recording:!1,soundId:e.soundId,showSavePresetModal:!1},void 0!==n.props.name&&(n.state.name=n.props.name,n.state.videoId=""),n.sample=new K.a(e.soundId),n.props.soundId in n.props.samples&&n.sample.fromJson(n.props.samples[n.props.soundId]),n.ref=r.a.createRef(),n.lastClick=void 0,n.selectStep=n.selectStep.bind(Object(p.a)(n)),n.onEffectsChange=n.onEffectsChange.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"selectStep",value:function(e){this.props.sequencerEngine.select(this.props.trackData,e)}},{key:"onEffectsChange",value:function(){this.props.trackData.updateEffects()}},{key:"onClickShowEffects",value:function(){this.props.setShowEffects(!this.props.showEffects)}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"shouldComponentUpdate",value:function(e){return void 0===this.sample.name&&this.props.soundId in e.samples&&void 0!==e.samples[e.soundId]&&this.sample.fromJson(e.samples[e.soundId]),this.props.soundId!=e.soundId&&void 0!==e.samples[e.soundId]&&this.sample.fromJson(e.samples[e.soundId]),!0}},{key:"onClickStep",value:function(e){this.props.onClick(e)}},{key:"toggleHide",value:function(){this.state.hideTrack=!this.state.hideTrack,this.setState(this.state)}},{key:"record",value:function(){this.props.trackPreparingToRecord(this.props.trackNumber,!0),this.props.sequencerEngine.recordTrack(this.props.trackNumber),this.setState(this.state)}},{key:"onAnnotationsMouseMove",value:function(e){var t=this.props.sequencerEngine.store.getState().tracks.annotationDragging;if(t){var n=this.ref.current.getBoundingClientRect(),a=e.clientX-n.left,r=e.clientY-n.top;t.x=a,t.y=r,this.setState(this.state)}}},{key:"onAnnotationsMouseUp",value:function(e){if(this.props.sequencerEngine.store.getState().keyboard.isCommandDown){var t=e.target.getBoundingClientRect(),n=e.clientX-t.left,a=e.clientY-t.top;this.props.track.newAnnotation(n,a),this.setState(this.state)}this.props.setAnnotationDragging(void 0)}},{key:"onMouseUp",value:function(e){this.props.mouseDown(!1),this.updateSelectedSteps(),this.props.setStepsSelection(void 0),this.props.setStepNumberDraggingFrom(void 0)}},{key:"deleteAnnotation",value:function(e){this.props.track.deleteAnnotation(e),this.setState(this.state)}},{key:"updateSelectedSteps",value:function(){var e=this.props.sequencerEngine.store.getState().steps.stepsSelection;if(void 0!==e&&e.toStep-e.fromStep>0){var t=this.props.trackData.getEasyPattern().getSelectedSteps(e,this.props.resolution);this.props.setSelectedSteps(this.props.trackNumber,this.props.trackData.currentPattern,t)}}},{key:"onClickFocus",value:function(){this.props.disablePianoRoll||(this.props.isTrackFocused?(this.props.setTrackUnfocused(),this.props.setSelectedPianoRollSteps(void 0)):this.props.setTrackFocused())}},{key:"doneAudition",value:function(){this.props.trackData.completeAudition(),this.setState(this.state)}},{key:"cancelAudition",value:function(){this.props.trackData.cancelAudition(),this.setState(this.state)}},{key:"onClickTrack",value:function(){void 0!==this.lastClick&&((new Date).getTime(),this.lastClick),this.lastClick=(new Date).getTime(),this.props.setSelectedEffect(void 0),this.props.isSelectedTrack||this.props.sequencerEngine.selectTrack(this.props.trackData.trackNumber)}},{key:"savePreset",value:function(){this.setState({showSavePresetModal:!0})}},{key:"hideSavePresetModal",value:function(){this.setState({showSavePresetModal:!1})}},{key:"onDrop",value:function(){var e=Object(g.a)(v.a.mark(function e(t){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.props.sampleDragging?(t.stopPropagation(),this.props.sequencerEngine.auditionSound(this.props.sampleDragging,this.props.trackNumber),this.props.setSampleDragging(void 0)):this.props.presetDragging&&(t.stopPropagation(),this.props.sequencerEngine.auditionPreset(this.props.presetDragging,this.props.trackNumber),this.props.setPresetDragging(void 0));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"freezeTrack",value:function(){this.props.isTrackFrozen?this.props.trackData.unfreeze():(this.props.hideAllEffects(),this.props.setTrackToFreeze())}},{key:"duplicateTrack",value:function(){this.props.sequencerEngine.duplicateTrack(this.props.trackNumber)}},{key:"similarSounds",value:function(){this.props.setSimilarSoundsToFind(this.props.trackData.sample.getId()),this.props.setSelectorMode(!0),this.props.setSidebarCollapsed(!1),window.dispatchEvent(new Event("SIMILAR_SOUNDS"))}},{key:"getFrozenButton",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return r.a.createElement(PO,{sequencerEngine:this.props.sequencerEngine,showPlayButton:e,track:this.props.track})}},{key:"deleteLocks",value:function(){this.props.trackData.deletePatternLocks()}},{key:"render",value:function(){var e=this;this.state.soundId!=this.props.soundId&&(this.state.soundId=this.props.soundId);var t=this.props.isCompactMode?"effects-section compact":"effects-section",n=this.props.isCompactMode?"track-icons-container compact":"track-icons-container",a=this.props.track,s=void 0!==this.sample&&void 0!==this.sample.getId()?this.sample.getId():this.props.track.getName(),i=FO.brighten("#082435",.5),o=FO.brighten(void 0===s?i:FO.getColorForHash(s),.65);if(!this.props.isTrackFocused&&this.props.isSelectedTrack&&(i=FO.brighten(FO.getColorForHash(void 0===s?i:s),.65)),this.state.hideTrack)return r.a.createElement("div",{className:"track"},r.a.createElement("div",{onClick:function(){return e.toggleHide()},className:"effects-section show-track"},"SHOW TRACK"));if(this.props.isTrackFocused)return r.a.createElement("div",{className:"track"},r.a.createElement(tk,{headerText:this.props.trackData.getName(),onClickBack:function(){return e.props.setTrackUnfocused()}}),r.a.createElement(eO,{track:a,sequencerEngine:this.props.sequencerEngine}),r.a.createElement(VE,{color:o,isLooping:!0,sequencerEngine:this.props.sequencerEngine,track:this.props.trackData}));var c,u="track";void 0===s&&(s="");var l={borderColor:FO.brighten("#082435",.5)};return!this.props.isTrackFocused&&this.props.isSelectedTrack?(u+=" selected",l.borderColor=i,l.backgroundImage="linear-gradient("+FO.brighten(FO.getColorForHash(s),.12)+", "+FO.brighten(FO.getColorForHash(s),.1)+")"):l.backgroundColor=FO.brighten(FO.getColorForHash(s),.025),this.props.isCompactMode&&(u+=" compact"),r.a.createElement("div",null,r.a.createElement(jO,{sequencerEngine:this.props.sequencerEngine,trackNumber:this.props.trackNumber,show:this.state.showSavePresetModal,onHide:function(){return e.hideSavePresetModal()}}),r.a.createElement(xO.a,{id:"track-context-"+this.props.trackNumber},r.a.createElement(xO.c,{data:{foo:"bar"},onClick:function(){return e.savePreset()}},"Save Preset"),r.a.createElement(xO.c,{data:{foo:"bar"},onClick:function(){return e.freezeTrack()}},this.props.isTrackFrozen?"Unfreeze":"Freeze"),r.a.createElement(xO.c,{data:{foo:"bar"},onClick:function(){return e.duplicateTrack()}},"Duplicate"),r.a.createElement(xO.c,{data:{foo:"bar"},onClick:function(){return e.deleteLocks()}},"Delete Locks")),r.a.createElement(xO.b,{holdToDisplay:-1,id:"track-context-"+this.props.trackNumber},r.a.createElement("div",{onDrop:function(t){return e.onDrop(t)},key:"track-"+this.props.trackNumber,style:l,onMouseUp:function(t){return e.onMouseUp(t)},onClick:function(){return e.onClickTrack()},className:u},r.a.createElement(DO,{isSelected:this.props.isSelectedTrack,borderColor:i,trackColor:o,onClickDelete:this.props.onClickDelete,track:this.props.trackData,sequencerEngine:this.props.sequencerEngine}),r.a.createElement("div",{className:"track-inner"},r.a.createElement("a",{name:"track-"+(this.props.trackNumber+1)}),r.a.createElement("div",{className:"unselected youtube-container"},r.a.createElement(z,{track:this.props.track,showTags:!this.props.isCompactMode,hideName:!0,name:this.props.trackData.getName(),sample:this.sample,onClickName:function(){return[]},onClickThumbnail:function(){return e.props.onClickName()},videoId:this.props.trackData.videoId},r.a.createElement(O,{condition:!this.props.isCompactMode},r.a.createElement(qO,{midiInputs:a.midiInputs,midiEngine:this.props.sequencerEngine.midi})),"AUDIO"===this.props.track.getTrackType()||"MIDI"===this.props.track.getTrackType()?r.a.createElement(BO,{track:this.props.track}):"",this.props.track.getTrackType()!==zn||this.props.isCompactMode?"":r.a.createElement(jd,{track:this.props.track}),r.a.createElement(nO,{sequencerEngine:this.props.sequencerEngine,track:this.props.track}))),r.a.createElement(IO,{sequencerEngine:this.props.sequencerEngine,isSelectedTrack:this.props.isSelectedTrack,installation:this.props.installation,trackNumber:this.props.trackNumber,trackData:this.props.trackData}),this.props.showEffects?r.a.createElement(Sv.EffectsView,(c={sequencerEngine:this.props.sequencerEngine,onEffectsChange:this.onEffectsChange,installation:!0},Object(_e.a)(c,"sequencerEngine",this.props.sequencerEngine),Object(_e.a)(c,"store",this.props.sequencerEngine.store),Object(_e.a)(c,"tracks",this.props.sequencerEngine.tracks),Object(_e.a)(c,"onParameterChanged",function(e){return[]}),Object(_e.a)(c,"sends",this.props.sends),Object(_e.a)(c,"track",this.props.trackData),c)):this.props.isTrackFrozen?this.getFrozenButton():this.props.isPreparingToFreeze||this.props.isResampling?this.getFrozenButton(!1):r.a.createElement(wO,Object.assign({},this.props,{selectStep:this.selectStep,trackColor:o,sample:this.sample,onUpdateStepData:this.props.onUpdateStepData,updateSelectedSteps:function(){return e.updateSelectedSteps()},track:this.props.track})),r.a.createElement("div",{onMouseUp:function(t){return e.onAnnotationsMouseUp(t)},onMouseMove:function(t){return e.onAnnotationsMouseMove(t)},ref:this.ref,className:this.props.isCompactMode?"track-right-buttons compact":"track-right-buttons"},this.props.track.annotations.map(function(t){return r.a.createElement(tO,{annotation:t,color:o,onDelete:function(){return e.deleteAnnotation(t)}})}),r.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"TRACK_EFFECTS_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onClickShowEffects()},className:t},this.state.showEffects?"BACK":"FX"),r.a.createElement("div",{className:n},r.a.createElement("img",{onMouseOver:function(t){return e.setContextualHelp(t,"TRACK_PIANO_ROLL_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onClickFocus()},className:"piano-roll-button",src:"/piano-icon.png"}))),this.props.trackData.isAuditioning()?r.a.createElement("div",{className:"audition-buttons"},r.a.createElement("div",{className:"audition-buttons-title"},"AUDITIONING"),r.a.createElement("div",{onClick:function(){return e.doneAudition()},className:"pink-button common-button"},"DONE"),r.a.createElement("div",{onClick:function(){return e.cancelAudition()},className:"pink-button common-button"},"CANCEL")):""))))}},{key:"isAlternateColor",value:function(e,t,n){return Math.ceil((e+1)/t)%2!=0}},{key:"effects",get:function(){return this.props.trackData.effectsChains[0].effects}}]),t}(a.Component),BO=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getOptions",value:function(){var e=[{value:"none",label:"None"}];return void 0!==this.props.track.audioInputManager&&this.props.track.audioInputManager.getInputChannels().forEach(function(t){return e.push({value:t,label:t})}),e}},{key:"getChannelOption",value:function(e){for(var t=this.getOptions(),n=0;n<t.length;n++)if(t[n].value==e)return t[n];return null}},{key:"getSelectedChannel",value:function(){return this.props.track.audioInputChannel}},{key:"onSelectChannel",value:function(e){var t="none"===e.value?void 0:e.value;this.props.track.setAudioInput(t),this.setState(this.state)}},{key:"render",value:function(){var e=this;this.props.track.audioInputManager;return r.a.createElement("div",{className:"audio-input-dropdown-container"},r.a.createElement(pp.a,{className:"audio-input-dropdown",controlClassName:"audio-input-control-dropdown",arrowClassName:"audio-input-arrow-dropdown",options:this.getOptions(),onChange:function(t){return e.onSelectChannel(t)},value:this.getChannelOption(this.getSelectedChannel()),placeholder:"Input"}))}}]),t}(a.Component),UO=(a.Component,Object(y.b)(function(e,t){var n=t.sequencerEngine.getSequenceId(),a=(e.sequencer.currentStep[n],e.sequencer.currentGlobalStep[n],e.tracks.trackSteps[t.trackData.subSequence.isTrack?t.trackData.subSequence.id:t.trackNumber],((e.tracks.trackPatternLocks[t.trackData.subSequence.id]||{})[t.trackNumber]||{})[t.trackData.currentPattern],(e.tracks.tracksFrozen[t.trackData.subSequence.id]||{})[t.trackNumber]);return{resolution:e.sequencer.resolution,isTrackFrozen:a,isPreparingToFreeze:e.tracks.trackToFreeze&&e.tracks.trackToFreeze.trackNumber===t.track.trackNumber,isResampling:e.tracks.isResampling===t.track.trackNumber,samples:e.samples,isSelectedTrack:e.mix.selectedTrack===t.trackNumber,isTrackFocused:e.sequencer.trackFocused===t.trackNumber,isCompactMode:e.sequencer.isCompactMode,showAutomations:"RECORD"===e.sequencer.automationMode,sampleDragging:e.selector.sampleDragging,presetDragging:e.presets.presetDragging,showEffects:e.tracks.showTrackEffects[t.trackNumber]}},function(e,t){return{mouseDown:function(t){return e(Object(w.j)(t))},hideAllEffects:function(t){return e(Object(w.i)())},setTrackFocused:function(){return e(Object(w.de)(t.trackNumber))},setTrackToFreeze:function(){return e(Object(w.oe)(t.trackData.subSequence.id,t.trackNumber))},setTrackUnfocused:function(){return e(Object(w.de)(void 0))},trackPreparingToRecord:function(t,n){return e(Object(w.Ge)(t,n))},setSelectedPianoRollSteps:function(t){return e(Object(w.Sc)(t))},setStepsSelection:function(t){return e(Object(w.Rd)(t))},setSelectedEffect:function(t){return e(Object(w.Jc)(t))},setSelectorMode:function(t){return e(Object(w.bd)(t))},setSimilarSoundsToFind:function(t){return e(Object(w.Id)(t))},setSidebarCollapsed:function(t){return e(Object(w.Fd)(t))},setSelectedSteps:function(t,n,a){return e(Object(w.Zc)(t,n,a))},setStepNumberDraggingFrom:function(t){return e(Object(w.Pd)(t))},setShowEffects:function(n){return e(Object(w.Cd)(t.trackNumber,n))},setContextualHelp:function(t){return e(Object(w.V)(t))},setStepNumberDraggedTo:function(t){return e(Object(w.Od)(t))},setSampleDragging:function(t){return e(Object(w.Ac)(t))},setPresetDragging:function(t){return e(Object(w.sc)(t))},setAnnotationDragging:function(t){return e(Object(w.t)(t))}}})(VO)),HO=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;this.props.trackData.getTrackType(),this.props.trackData;return r.a.createElement(UO,{sequencerEngine:this.props.sequencerEngine,selectStep:function(t){return e.props.selectStep(t)},cursor:this.props.cursor,soundId:this.props.soundId,selectedParameterStep:this.props.selectedParameterStep,onEffectsChange:this.props.onEffectsChange,onLoadTrackUrl:this.props.onLoadTrackUrl,volume:this.props.volume,trackData:this.props.trackData,track:this.props.trackData,onUpdateStepData:this.props.onUpdateStepData,muted:this.props.muted,onClickTrack:this.props.onClickTrack,sends:this.props.sends,onClickName:this.props.onClickName,onChangeVolume:this.props.onChangeVolume,installation:!0,steps:this.props.steps,disablePianoRoll:this.props.disablePianoRoll,trackNumber:this.props.trackNumber,onClickDelete:this.props.onClickDelete,onUpdateStepDuration:this.props.onUpdateStepDuration,onClickAddSteps:this.props.onClickAddSteps,onClickRemoveSteps:this.props.onClickRemoveSteps,onClick:this.props.onClick})}}]),t}(a.Component);n(577);var JO=Object(y.b)(function(e,t){return{effectDragging:e.sequencer.effectDragging,isSelected:e.effects.selectedSendEffect===t.effect}},function(e,t){return{dragEffect:function(t){return e(Object(w.d)(t))},setSelectedSendEffect:function(t){return e(Object(w.Wc)(t))}}})(function(e){var t=Object(a.useCallback)(function(t){e.dragEffect({effectNumber:e.effectNumber})},[e.effectNumber]),n=Object(a.useCallback)(function(t){if(void 0!==e.effectDragging){var n=e.effectDragging.effectNumber;e.moveEffectTo(n,e.effectNumber)}},[e.effectNumber,e.effectDragging]),s=Object(a.useCallback)(function(t){e.setSelectedSendEffect(e.isSelected?void 0:e.effect)},[e.isSelected,e.effect]),i="send-effect";return e.isSelected&&(i+=" selected"),r.a.createElement("div",{onClick:s,onDragOver:function(e){e.preventDefault()},onDrop:n,onDragStart:t,draggable:!0,className:i},e.effect.name)});function GO(e){var t=Object(a.useState)(void 0),n=Object(Z.a)(t,2),s=(n[0],n[1]),i=e.send.effects,o=Object(a.useCallback)(function(t){var n=nu(t.value,e.sequencerEngine);return n.enable(!0),n.wetParameter&&n.wetParameter.set(1),e.send.addEffect(n),s(t.value),!1},[s,e.sequencerEngine]),c=Object(a.useCallback)(function(t,n){e.send.moveEffectTo(t,n),s({from:t,to:n})},[s,e.send]);return r.a.createElement("div",{className:"send"},r.a.createElement("div",{className:"send-name"},e.send.name),i.map(function(e,t){return r.a.createElement(JO,{moveEffectTo:c,effectNumber:t,effect:e})}),r.a.createElement(pp.a,{className:"send-effects-dropdown",options:tu,onChange:o,placeholder:"FX"}))}var zO=Object(y.b)(function(e,t){return{selectedEffect:e.effects.selectedSendEffect}},function(e,t){return{setSelectedSendEffect:function(t){return e(Object(w.Wc)(t))}}})(function(e){var t=Object(a.useState)(e.sequencerEngine.sends.sends),n=Object(Z.a)(t,2),s=n[0],i=n[1],o=Object(a.useCallback)(function(){e.setSelectedSendEffect(void 0)},[]),c="";if(e.selectedEffect){var u=s.find(function(t){return t.effects.indexOf(e.selectedEffect)>-1});c=r.a.createElement(Sv.EffectComponent,{sequencerEngine:e.sequencerEngine,onDeleteEffect:function(){return o()},effect:e.selectedEffect,send:u})}var l=Object(a.useCallback)(function(){e.sequencerEngine.sends.createNewSend(),i(Object(ge.a)(e.sequencerEngine.sends.sends))},[i]);return r.a.createElement("div",{className:"track sends"},r.a.createElement("div",{className:"track-header"},r.a.createElement("div",{className:"track-name-view"},"Sends")),r.a.createElement("div",{className:"sends-container"},s.map(function(t){return r.a.createElement(GO,{sequencerEngine:e.sequencerEngine,send:t})}),c,r.a.createElement("div",{onClick:l,className:"new-send-button"},"New Send")))}),_O=new U.a,WO=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getName",value:function(){var e=this.props.selectedTrack.getName();return void 0===e?"":e.length>20?e.slice(0,20)+"...":e}},{key:"render",value:function(){var e=this,t=this.props.group.tracks,n=80/t.length;return r.a.createElement("div",{className:"group-thumbnail-container"},r.a.createElement("div",{className:"group-thumbnail"},t.map(function(t){return r.a.createElement(KO,{isSelected:e.props.group.tracks.length>1&&t==e.props.selectedTrack,onClick:function(){return e.props.onSelectTrack(t)},width:n,track:t})})),void 0!==this.props.selectedTrack?r.a.createElement("div",{className:"youtube-name"},this.getName()):"",r.a.createElement(O,{condition:this.tags.length>0},r.a.createElement("div",{className:"tags-container"},this.tags.map(function(e){return r.a.createElement(A.a,{color:"dark"},e)}))))}},{key:"tags",get:function(){return this.props.selectedTrack&&void 0!==this.props.selectedTrack.sample?this.props.selectedTrack.sample.tags:this.props.group.tags}}]),t}(a.Component),KO=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getColor",value:function(){var e=this.props.track;return e.getTrackType()===zn?_O.getColorForHash(e.sample.getId()):_O.getcolorForHash(e.getName())}},{key:"render",value:function(){var e=this.props.track,t={width:this.props.width},n=this.props.isSelected?"selected group-part-wrapper":"group-part-wrapper";if(e.getTrackType()===zn){var a=e.sample;if(a.videoId){var s=bb(a.videoId);return r.a.createElement("div",{className:n+" group-part-wrapper"},r.a.createElement("img",{className:"group-part-thumbnail",onClick:this.props.onClick,src:s,style:t}),r.a.createElement("div",{className:"part-footer",style:{backgroundColor:this.getColor()}}))}return t.backgroundColor=_O.getColorForHash(a.getId()),r.a.createElement("div",{className:n,onClick:this.props.onClick,style:t})}return t.backgroundColor=_O.getColorForHash(e.getName()),r.a.createElement("div",{className:n,onClick:this.props.onClick,style:t})}}]),t}(a.Component),YO=WO,QO=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onMuteClicked",value:function(){this.props.group.mute(!this.props.muted),this.setState(this.state)}},{key:"onSoloClicked",value:function(){this.props.group.solo=!this.props.group.solo,this.setState(this.state)}},{key:"onChangeVolume",value:function(e){void 0!==e&&(e=parseFloat(e),this.props.group.setVolume(e),this.setState(this.state))}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(e),this.props.setContextualHelp(t)}},{key:"render",value:function(){var e=this,t=1==this.props.triggering?" flashit ":"",n=this.props.muted?t+"mute-button muted":t+"mute-button";return this.props.isCompactMode&&(n+=" compact"),r.a.createElement("div",{className:"track-controls"},r.a.createElement("div",{className:"volume-container"},r.a.createElement(O,{condition:!this.props.isCompactMode},r.a.createElement(fe.a,{value:this.props.group.volume,change:function(t){return e.onChangeVolume(t.target.value)},step:.1,max:128,min:0,orientation:"vertical",reversed:!0})),r.a.createElement("div",{onMouseOver:function(t){return e.setContextualHelp(t,"TRACK_MUTE_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:n,onClick:function(){return e.onMuteClicked()}},this.props.groupNumber+1),r.a.createElement("div",{onClick:function(){return e.onSoloClicked()},onMouseOver:function(t){return e.setContextualHelp(t,"TRACK_SOLO_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},className:this.props.group.solo?"track-solo-button on":"track-solo-button off"},"S")))}}]),t}(a.Component),XO=Object(y.b)(function(e,t){var n=t.group.volume,a=t.group.muted;return{triggering:!1,volume:void 0===n?0:n,muted:void 0!==a&&a,solo:!1,isCompactMode:e.sequencer.isCompactMode}},function(e,t){return{setContextualHelp:function(t){return e(Object(w.V)(t))}}})(QO),ZO=(n(2349),new U.a),$O=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={selectedTrack:void 0},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onSelectTrack",value:function(e){this.selectedTrack!==e?this.setState({selectedTrack:e}):this.setState({selectedTrack:void 0})}},{key:"onClickShowEffects",value:function(){this.props.setShowEffects(!this.props.showEffects)}},{key:"setContextualHelp",value:function(e,t){e.stopPropagation(),this.props.setContextualHelp(t)}},{key:"onClickStep",value:function(e,t,n){e===this.props.selectedParameterStep&&this.props.cursor.show||(n.on?this.props.onClickStep(e,t):(t=this.selectedTrack||t,this.props.onClickStep(e,t)))}},{key:"onClickLock",value:function(){}},{key:"onClickGroup",value:function(){}},{key:"renderFills",value:function(){this.setState(this.state)}},{key:"savePreset",value:function(){this.props.sequencerEngine.saveTrackPreset(this.props.trackNumber)}},{key:"deleteTrack",value:function(){this.props.onClickDelete()}},{key:"duplicateTrack",value:function(){this.props.sequencerEngine.duplicateTrack(this.props.trackNumber)}},{key:"mergeSteps",value:function(e,t,n){for(var a in t)for(var r in t[a]){var s=t[a][r];s.step.on&&void 0!==e[a]&&void 0!==e[a][r]&&(e[a][r]={track:n,step:s.step,stepNumber:s.stepNumber})}return e}},{key:"getStepsLength",value:function(e){var t=0;for(var n in e)t+=e[n].length;return t}},{key:"printSteps",value:function(e){var t=[];for(var n in e)for(var a in e[n])t.push(e[n][a].stepNumber);console.log(t)}},{key:"normalizeStepsLength",value:function(e){var t=0;for(var n in e)for(var a in e[n])e[n][a]={step:e[n][a],stepNumber:t++};var r=EO(this.props.resolution);for(e[0].length;e[0].length<r&&this.getStepsLength(e)<this.props.stepsLength;)e[0]=e[0].concat(e[0]);for(;this.getStepsLength(e)<this.props.stepsLength;)e=e.concat(e);return e}},{key:"getSteps",value:function(){var e=void 0;for(var t in this.tracks){var n=this.tracks[t],a=kO(n,this.props.resolution);if(a=this.normalizeStepsLength(a),void 0===e){for(var r in a)for(var s in a[r])a[r][s]={track:n,step:a[r][s].step,stepNumber:a[r][s].stepNumber};e=a}else e=this.mergeSteps(e,a,n)}return e}},{key:"getColor",value:function(){var e=this.selectedTrack||this.tracks[0];return e.getTrackType()===zn?ZO.getColorForHash(e.sample.getId()):ZO.getColorForHash(e.getName())}},{key:"onClickAddSteps",value:function(){this.selectedTrack?this.selectedTrack.doubleTrackLength():this.props.group.tracks.forEach(function(e){return e.doubleTrackLength()})}},{key:"onClickRemoveSteps",value:function(){this.selectedTrack?this.selectedTrack.halfTrackLength():this.props.group.tracks.forEach(function(e){return e.halfTrackLength()})}},{key:"render",value:function(){var e,t=this,n=this.props.isCompactMode?"effects-section compact":"effects-section",a=this.props.isCompactMode?"track-footer-container compact":"track-footer-container",s=(this.props.isCompactMode,this.getSteps()),i=EO(this.props.resolution),o=uO(this.props.resolution),c={};return this.props.selectedGroup===this.props.group&&(c.borderColor=ZO.brighten(this.getColor(),.7)),r.a.createElement("div",null,r.a.createElement("div",{style:c,onClick:function(){return t.props.setSelectedGroup(t.props.group)},onMouseOver:function(e){return t.setContextualHelp(e,"TRACK")},onMouseLeave:function(){return t.props.setContextualHelp(void 0)},className:"group-component",key:"group-"+this.props.groupNumber},r.a.createElement("a",{name:"group-"+(this.props.groupNumber+1)}),r.a.createElement("div",{className:"unselected youtube-container"},r.a.createElement(YO,{selectedTrack:this.selectedTrack,onSelectTrack:function(e){return t.onSelectTrack(e)},group:this.props.group})),r.a.createElement(O,{condition:void 0!==this.selectedTrack},r.a.createElement(IO,{trackNumber:this.selectedTrack?this.selectedTrack.trackNumber:0,trackData:this.selectedTrack})),r.a.createElement(O,{condition:void 0===this.selectedTrack},r.a.createElement(XO,{groupNumber:this.props.groupNumber,group:this.props.group})),r.a.createElement(O,{condition:this.props.showEffects},r.a.createElement(Sv.EffectsView,(e={sequencerEngine:this.props.sequencerEngine,onEffectsChange:this.props.onEffectsChange},Object(_e.a)(e,"sequencerEngine",this.props.sequencerEngine),Object(_e.a)(e,"store",this.props.sequencerEngine.store),Object(_e.a)(e,"tracks",this.props.sequencerEngine.tracks),Object(_e.a)(e,"onParameterChanged",function(e){return[]}),Object(_e.a)(e,"panning",this.props.panning),Object(_e.a)(e,"onChangePanning",this.props.onChangePanning),Object(_e.a)(e,"sends",this.props.sends),Object(_e.a)(e,"track",this.selectedTrack),Object(_e.a)(e,"group",this.selectedTrack?void 0:this.props.group),e))),r.a.createElement(O,{condition:!this.props.showEffects},r.a.createElement("div",{className:"steps-container"},s.map(function(e,n){return r.a.createElement("div",{className:"steps-row"},e.map(function(e,a){return r.a.createElement(yO,{sample:e.track.sample,renderFills:function(){return t.renderFills()},sequencerEngine:t.props.sequencerEngine,effectToShow:t.state.effectToShow,onEffectToShowChanged:function(e){return t.onEffectToShowChanged(e)},isMidi:t.props.isMidiTrack,trackNumber:e.track.trackNumber,resolution:t.props.resolution,rawStepNumber:i*n+a,stepNumber:e.stepNumber,isGroup:!0,stepsLength:t.props.stepsLength,show:t.props.show,showParameters:t.props.selectedParameterStep==i*n+a&&t.props.showParameters,trackData:e.track,onUpdateStepDuration:function(r){return t.props.onUpdateStepDuration(e.track,i*n+a,r)},onUpdateStepData:function(r){return t.props.onUpdateStepData(e.track,r,i*n+a)},isAlternateColor:t.isAlternateColor(a,o,t.props.resolution),slices:0,track:e.track,onClick:function(){return t.onClickStep(e.stepNumber,e.track,e.step)}})}))}),r.a.createElement("div",null,r.a.createElement("div",{className:a},r.a.createElement("div",{onMouseOver:function(e){return t.setContextualHelp(e,"TRACK_ADD_STEPS_BUTTON")},onMouseLeave:function(e){return t.props.setContextualHelp(void 0)},onClick:function(){return t.onClickAddSteps()},className:"add-steps-button"},"+"),r.a.createElement("div",{onMouseOver:function(e){return t.setContextualHelp(e,"TRACK_REMOVE_STEPS_BUTTON")},onMouseLeave:function(){return t.props.setContextualHelp(void 0)},onClick:function(){return t.onClickRemoveSteps()},className:"remove-steps-button"},"-"))))),r.a.createElement("div",{className:this.props.isCompactMode?"track-right-buttons compact":"track-right-buttons"},r.a.createElement(O,{condition:!this.props.isTrackFocused},r.a.createElement("div",{onMouseOver:function(e){return t.setContextualHelp(e,"TRACK_EFFECTS_BUTTON")},onMouseLeave:function(){return t.props.setContextualHelp(void 0)},onClick:function(){return t.onClickShowEffects()},className:n},this.state.showEffects?"BACK":"FX")))))}},{key:"isAlternateColor",value:function(e,t,n){return Math.ceil((e+1)/t)%2!=0}},{key:"selectedTrack",get:function(){return 1===this.tracks.length?this.tracks[0]:this.state.selectedTrack}},{key:"tracks",get:function(){return this.state.selectedTrack?[this.state.selectedTrack]:this.props.group.tracks}}]),t}(a.Component),ew=Object(y.b)(function(e,t){var n=-1,a=0;for(var r in t.group.tracks){var s=t.group.tracks[r],i=e.tracks.trackSteps[s.trackNumber];for(var o in i)a+=i[o]*(o+1);var c=i.length;c>n&&(n=c)}e.tracks.trackPatternLocks[t.trackNumber];return{selectedGroup:e.mix.selectedGroup,stepSum:a,resolution:e.sequencer.resolution,stepsLength:n,patternLocked:!1,isCompactMode:e.sequencer.isCompactMode,showEffects:e.tracks.showTrackEffects[t.groupNumber],showParameters:e.cursor.show}},function(e,t){return{mouseDown:function(t){return e(Object(w.j)(t))},setTrackFocused:function(){return e(Object(w.de)(t.trackNumber))},setTrackUnfocused:function(){return e(Object(w.de)(void 0))},trackPreparingToRecord:function(t,n){return e(Object(w.Ge)(t,n))},setSelectedPianoRollSteps:function(t){return e(Object(w.Sc)(t))},setStepsSelection:function(t){return e(Object(w.Rd)(t))},setSelectedSteps:function(t,n,a){return e(Object(w.Zc)(t,n,a))},setStepNumberDraggingFrom:function(t){return e(Object(w.Pd)(t))},setShowEffects:function(n){return e(Object(w.Cd)(t.groupNumber,n))},setContextualHelp:function(t){return e(Object(w.V)(t))},setSelectedGroup:function(t){return e(Object(w.Mc)(t))}}})($O),tw=function(){function e(t,n){Object(o.a)(this,e),this.sequencerEngine=t,this.disableTab=n,this.installation=n,this.store=t.store,this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.effectToCopy=void 0,this.checkMetaKey()}return Object(c.a)(e,[{key:"checkMetaKey",value:function(){var e=this;setInterval(function(){void 0!==e.lastMetaPressedTime&&((new Date).getTime()-e.lastMetaPressedTime>=5e3&&e.dispatch(Object(w.P)(!1)))},1e3)}},{key:"onKeyUp",value:function(e){"Meta"===e.key||"Alt"===e.key?(this.lastMetaPressedTime=void 0,this.dispatch(Object(w.P)(!1))):"`"===e.key?this.sequencerEngine.sequenceRolling=!1:"Space"===e.key||Object($e.a)(e.key)||this.sequencerEngine.keyboardHelper.onKeyUp(e)}},{key:"onKeyDown",value:function(e){if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName){var t=e.target===window.document.body;if(this.viMode&&!e.metaKey&&!e.ctrlKey){if("Escape"===e.key)return void this.dispatch(Object(w.we)(!1));if(this.scripting.viCommand(e.key),Object($e.a)(e.key))return}if("Space"!==e.key){if(!this.viMode&&e.key>="a"&&e.key<="z"&&!e.metaKey&&!e.ctrlKey)return this.sequencerEngine.keyboardHelper.onAlphabetKeyDown(e,this.cursor.track),!0;if(this.installation||("/"!==e.key&&":"!==e.key&&"+"!==e.key||(this.cursor.show=!1,this.state.commands.commandInput.focus()),"x"===e.key&&e.metaKey&&(this.state.commands.commandInput.focus(),this.dispatch(Object(w.R)("M-x")))),"n"===e.key&&e.ctrlKey)return e.preventDefault(),this.selectedTrack.auditionNext(!0),!0;if("p"===e.key&&e.ctrlKey)return e.preventDefault(),this.selectedTrack.auditionPrevious(!0),!0;if("Escape"===e.key&&this.dispatch(Object(w.we)(!this.viMode)),"g"===e.key&&e.metaKey)return e.preventDefault(),this.dispatch(Object(w.nd)(!this.showGroups)),!0;if("z"===e.key&&e.metaKey)return e.preventDefault(),e.shiftKey?this.sequencerEngine.operationManager.redo():this.sequencerEngine.operationManager.undo(),!0;if("k"===e.key&&e.metaKey)return this.midiMapMode===qs?this.dispatch(Object(w.Xb)("OFF")):this.dispatch(Object(w.Xb)(qs)),!0;if("j"===e.key&&e.metaKey)return"DELETE"===this.midiMapMode?this.dispatch(Object(w.Xb)("OFF")):this.dispatch(Object(w.Xb)("DELETE")),!0;if("d"===e.key&&e.metaKey){if(void 0!==this.selectedEffect&&"Effect Rack"===this.selectedEffect.name)return;return e.preventDefault(),e.stopPropagation(),this.viewMode===lo&&this.sequencerEngine.duplicateTrack(this.sequencerEngine.cursor.track),!1}if("a"===e.key&&e.metaKey&&!this.installation)return e.preventDefault(),this.selectAllTrackSteps(),!1;if("e"===e.key&&e.metaKey){var n=this.selectedTrack;n.showEffects(!this.state.tracks.showTrackEffects[n.trackNumber])}if(Object($e.a)(e.key)){if(t)return void this.onNumberKeyDown(e)}else if("="===e.key)this.sequencerEngine.switchToNextPattern();else if("+"===e.key);else if("-"===e.key)this.sequencerEngine.switchToPreviousPattern();else if("]"===e.key)this.dispatch(Object(w.wd)(!0));else if("c"===e.key&&e.metaKey)this.copy();else if("v"===e.key&&e.metaKey)this.paste();else if("Backspace"==e.key)this.deleteSelectedSteps();else if("`"==e.key)this.sequencerEngine.isSequenceRolling||(this.sequencerEngine.sequenceRolling=!0);else if("\\"==e.key||"h"==e.key&&e.ctrlKey)this.dispatch(Object(w.bd)(!1)),this.dispatch(Object(w.od)(!1)),this.dispatch(Object(w.ud)(!1)),this.dispatch(Object(w.xd)(!1)),this.dispatch(Object(w.i)(!1)),"\\"===e.key&&this.dispatch(Object(w.S)(!this.isCompactMode));else if("."==e.key)this.record();else if("/"==e.key);else if("Meta"===e.key||"Alt"===e.key)this.onMetaKeyDown();else if("Tab"!==e.key||this.disableTab)if("'"===e.key)this.onClickRollingMode();else if("Shift"===e.key&&t)this.onShiftKeyDown();else if("ArrowRight"==e.key&&t)this.onArrowRight(e);else if("ArrowLeft"==e.key&&t)this.onArrowLeft(e);else{if("ArrowUp"==e.key&&t)return this.onArrowUp(e);if("ArrowDown"==e.key&&t)return this.onArrowDown(e);"Enter"==e.key&&t&&this.onEnterKeyDown()}else e.preventDefault(),void 0!==this.trackFocused?(this.dispatch(Object(w.de)(void 0)),this.dispatch(Object(w.ye)(lo))):this.viewMode===lo?(this.dispatch(Object(w.ye)(po)),this.dispatch(Object(w.we)(!1))):(this.dispatch(Object(w.ye)(lo)),this.dispatch(Object(w.we)(!1)))}}}},{key:"onNumberKeyDown",value:function(e){var t=parseInt(e.key);if("ARRANGEMENT_VIEW"!==this.viewMode||this.isPlayingMix)if(this.sequencerEngine.rolling){if(t>=2&&t<=9){var n=YE[t];null!==n&&(this.sequencerEngine.resolution=n)}}else if(void 0!==this.cursor.track&&void 0!==this.cursor.step&&this.cursor.show){var a=t,r=32*this.sequencerEngine.getSelectedStep()/this.resolution.resolution;this.sequencerEngine.tracks[this.cursor.track].selectSlice(r,a)}else{var s=t;this.sequencerEngine.switchToPattern(s-1)}}},{key:"onMetaKeyDown",value:function(){this.dispatch(Object(w.P)(!0)),this.lastMetaPressedTime=(new Date).getTime()}},{key:"selectAllTrackSteps",value:function(){if(void 0===this.trackFocused){var e=this.sequencerEngine.tracks[this.cursor.track];if(void 0!==e){var t=e.currentPattern,n=this.getSelectedSteps();if(void 0===n||n.trackNumber!==e.trackNumber||n.patternNumber!==t){var a=e.getEasyPattern().getAllSteps();this.dispatch(Object(w.Zc)(this.cursor.track,e.currentPattern,a))}else this.dispatch(Object(w.Zc)(void 0))}}}},{key:"copy",value:function(){this.selectedEffect?this.effectToCopy=this.selectedEffect:this.copySteps()}},{key:"paste",value:function(){if(void 0!==this.effectToCopy&&void 0!==this.selectedTrack&&this.selectedTrack.isEffectsShowing()){var e=this.effectToCopy.isMidiEffect()?this.effectToCopy.getCopy(this.selectedTrack):this.effectToCopy.getEffectCopy();this.effectToCopy.isMidiEffect()?this.selectedTrack.midiEffects.addEffect(e):this.selectedTrack.effectsChain.addEffect(e),this.sequencerEngine.update()}else this.pasteSteps()}},{key:"copySteps",value:function(){var e=this.getSelectedSteps();if(void 0!==e){this.dispatch(Object(w.Sd)(e.steps));var t=this.sequencerEngine.tracks[e.trackNumber];this.dispatch(Object(w.jb)(t.getEasyPattern()))}}},{key:"pasteSteps",value:function(){if(void 0!==this.state.keyboard.stepsToCopy){var e=void 0!==this.state.steps.stepsSelection?this.state.steps.stepsSelection.fromStep:this.cursor.getStep(this.resolution),t=this.sequencerEngine.tracks[this.cursor.track],n=t.getEasyPattern().pasteSteps(this.state.keyboard.stepsToCopy,{stepNumber:e},this.state.keyboard.easyPatternToCopy,this.state.sequencer.resolution);t.updateSteps(),this.dispatch(Object(w.Zc)(t.trackNumber,t.currentPattern,n)),this.dispatch(Object(w.Od)(e))}}},{key:"record",value:function(){var e=!this.isRecording;this.dispatch(Object(w.Jb)(e)),this.sequencerEngine.recording(e)}},{key:"getSelectedSteps",value:function(){return this.sequencerEngine.store.getState().steps.selectedSteps}},{key:"deleteSelectedSteps",value:function(){var e=this.sequencerEngine.store.getState();if(void 0===this.trackFocused){var t=e.steps.selectedSteps;if(void 0!==t){var n=this.sequencerEngine.tracks[t.trackNumber];this.sequencerEngine.operationManager.dispatch(Vi(n,t.steps)),this.store.dispatch(Object(w.Zc)(void 0))}}}},{key:"onShiftKeyDown",value:function(){this.cursor.show=!this.cursor.show}},{key:"onArrowRight",value:function(e){e.preventDefault(),this.showSamples2D&&this.isShowingSoundsPane()||(this.viewMode!==po?this.cursor.track in this.sequencerEngine.tracks&&this.sequencerEngine.right():this.sequencerEngine.switchToNextSubSequence())}},{key:"onArrowLeft",value:function(e){e.preventDefault(),this.showSamples2D&&this.isShowingSoundsPane()||(this.viewMode!==po?this.sequencerEngine.left():this.sequencerEngine.switchToPreviousSubSequence())}},{key:"onArrowUp",value:function(e){if(e.preventDefault(),!this.showSamples2D||!this.isShowingSoundsPane()){if(this.viewMode!==po)return this.sampleAuditioning?window.dispatchEvent(new Event("AUDITION_PREVIOUS_SAMPLE")):(this.sequencerEngine.up(),this.onSelectTrack(this.cursor.track)),!0;this.sequencerEngine.switchToPreviousPattern()}}},{key:"onArrowDown",value:function(e){if(e.preventDefault(),!this.showSamples2D||!this.isShowingSoundsPane()){if(this.viewMode!==po){if(this.sampleAuditioning)window.dispatchEvent(new Event("AUDITION_NEXT_SAMPLE"));else{this.sequencerEngine.tracks.length;this.sequencerEngine.down(),this.onSelectTrack(this.cursor.track)}return!0}this.sequencerEngine.switchToNextPattern()}}},{key:"onClickRollingMode",value:function(){this.dispatch(Object(w.le)(!this.trackRolling)),this.dispatch(Object(w.we)(!1)),this.sequencerEngine.rollingManager.clear()}},{key:"onEnterKeyDown",value:function(){this.cursor.track>=0&&this.cursor.track<this.sequencerEngine.tracks.length&&this.sequencerEngine.getSelectedStep()>=0&&this.onClickStep(this.cursor.track,this.sequencerEngine.getSelectedStep())}},{key:"onClickStep",value:function(e,t){void 0===this.sequencerEngine.store.getState().steps.selectedSteps&&(this.sequencerEngine.operationManager.dispatch(Li(this.sequencerEngine.tracks[e],t,this.resolution)),this.sequencerEngine.select(e,t),this.cursor.track=e)}},{key:"dispatch",value:function(e){this.store.dispatch(e)}},{key:"onSelectTrack",value:function(e){this.sequencerEngine.cursor.track=e}},{key:"isShowingSoundsPane",value:function(){return!this.state.selector.sidebarCollapsed&&(this.state.sequencer.showSelectorMode||this.state.sequencer.sidebarViewMode!==qv)}},{key:"state",get:function(){return this.store.getState()}},{key:"selectedEffect",get:function(){if(void 0!==this.state.effects.selectedEffect)return this.sequencerEngine.selectedEffect}},{key:"midiMapMode",get:function(){return this.state.midi.midiMapMode}},{key:"viewMode",get:function(){return this.state.sequencer.viewMode}},{key:"alternateViewMode",get:function(){return this.state.sequencer.alternateViewMode}},{key:"showGroups",get:function(){return this.state.sequencer.showGroups}},{key:"isCompactMode",get:function(){return this.state.sequencer.isCompactMode}},{key:"cursor",get:function(){return this.sequencerEngine.cursor}},{key:"resolution",get:function(){return this.state.sequencer.resolution}},{key:"sampleAuditioning",get:function(){return this.state.audition.sampleAuditioning}},{key:"trackRolling",get:function(){return this.state.sequencer.trackRolling}},{key:"isRecording",get:function(){return this.state.sequencer.isRecording}},{key:"selectedTrack",get:function(){return this.sequencerEngine.tracks[this.cursor.track]}},{key:"scripting",get:function(){return this.sequencerEngine.scripting}},{key:"viMode",get:function(){return this.viewMode===lo&&this.state.commands.viMode}},{key:"trackFocused",get:function(){return this.state.sequencer.trackFocused}},{key:"isPlayingMix",get:function(){return this.state.mix.isPlayingMix}},{key:"showSamples2D",get:function(){return this.state.selector.showSamples2D}}]),e}(),nw=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickLFOThumbnail",value:function(){this.props.setShowEnvelopes(!1),this.props.setShowLFOs(!this.props.showLFOs)}},{key:"onClickEnvelopeThumbnail",value:function(){this.props.setShowLFOs(!1),this.props.setShowEnvelopes(!this.props.showEnvelopes)}},{key:"onClickLock",value:function(){this.props.showLFOs?this.props.lfosTrack.togglePatternLocked():this.props.showEnvelopes&&this.props.envelopesTrack.togglePatternLocked()}},{key:"render",value:function(){var e=this,t=this.props.isMixView?"track flex lfos-track mix-view":"track flex lfos-track",n=this.props.showLFOs?"lfo-thumbnail selected":"lfo-thumbnail",a=this.props.showEnvelopes?"lfo-thumbnail selected":"lfo-thumbnail";return r.a.createElement("div",{key:"lfo-tracks",onClick:function(){return[]},className:t},r.a.createElement("a",{name:"lfos"}),r.a.createElement("a",{name:"envelopes"}),r.a.createElement("div",{className:"unselected youtube-container"},r.a.createElement("div",{className:"lfo-envelope-button-container"},r.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("LFOS_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onClickLFOThumbnail()},className:n},"LFO"),r.a.createElement("div",{onMouseOver:function(){return e.props.setContextualHelp("ENVELOPES_BUTTON")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)},onClick:function(){return e.onClickEnvelopeThumbnail()},className:a},"ENV"))),r.a.createElement(O,{condition:this.props.showLFOs},r.a.createElement("div",{className:"lfo-effects-view"},this.props.lfosTrack.lfos.map(function(t){return r.a.createElement(Um,{sequencerEngine:e.props.sequencerEngine,lfo:t})}))),r.a.createElement(O,{condition:this.props.showEnvelopes},r.a.createElement("div",{className:"lfo-effects-view"},this.props.envelopesTrack.envelopes.map(function(t){return r.a.createElement($m,{sequencerEngine:e.props.sequencerEngine,envelopeTrack:t})}))),r.a.createElement(O,{condition:this.props.showLFOs||this.props.showEnvelopes},r.a.createElement("div",{className:"lock-button-container"},r.a.createElement("img",{onClick:function(){return e.onClickLock()},className:"lock-button",src:this.patternLocked?"/closed-padlock.png":"/opened-padlock.png"}))))}},{key:"patternLocked",get:function(){return this.props.showLFOs?this.props.lfoPatternLocked:!!this.props.showEnvelopes&&this.props.envelopePatternLocked}}]),t}(a.Component),aw=Object(y.b)(function(e,t){var n=(e.tracks.envelopePatternLocks[t.envelopesTrack.subSequence.id]||{})[t.sequencerEngine.currentPattern],a=(e.tracks.lfoPatternLocks[t.lfosTrack.subSequence.id]||{})[t.sequencerEngine.currentPattern];return{showLFOs:e.sequencer.showLFOs,showEnvelopes:e.sequencer.showEnvelopes,lfoPatternLocked:a,envelopePatternLocked:n}},function(e){return{setShowEnvelopes:function(t){return e(Object(w.md)(t))},setShowLFOs:function(t){return e(Object(w.pd)(t))},setContextualHelp:function(t){return e(Object(w.V)(t))}}})(nw),rw="LFOS",sw=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClick",value:function(e,t){this.props.setMixViewMode(e),void 0!==t&&this.props.sequencerEngine.switchToSubSequence(t)}},{key:"render",value:function(){var e=this,t=this.props.sequencerEngine.subSequences.map(function(e){return e.id});return r.a.createElement("div",{className:"mix-tab"},t.map(function(t){return r.a.createElement(iw,{onClick:function(){return e.onClick("SUBSEQUENCE",t)},isCurrent:e.props.currentSubSequence===t,selected:"SUBSEQUENCE"===e.props.mixViewMode&&e.props.currentSubSequence===t,name:e.props.sequencerEngine.getSubSequenceName(t)})}),r.a.createElement(iw,{onClick:function(){return e.onClick("ALL")},selected:"ALL"===this.props.mixViewMode,name:"ALL"}))}}]),t}(r.a.Component);function iw(e){var t="mix-tab-option";return e.selected&&(t+=" selected"),e.isCurrent&&(t+=" current"),r.a.createElement("div",{onClick:e.onClick,className:t},e.name)}var ow=Object(y.b)(function(e,t){return{currentSubSequence:e.sequencer.currentSubSequence[t.sequencerEngine.engineId],mixViewMode:e.mix.mixViewMode}},function(e){return{setMixViewMode:function(t){return e(Object(w.Zb)(t))}}})(sw),cw=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getClassName",value:function(e){var t=Math.floor(this.props.currentStep/2)%16,n="";return n=this.props.stepNumber===t?"current-step step":this.props.stepNumber<t?"previous-step step":"step",this.props.toggled&&this.props.stepNumber!==t&&(n+=" toggled"),n}},{key:"render",value:function(){return r.a.createElement("div",{onClick:this.props.onClick,className:this.getClassName()})}}]),t}(a.Component),uw=Object(y.b)(function(e,t){return{toggled:e.steps.masterStepToggles[t.stepNumber]}},null)(cw),lw=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickStep",value:function(e){var t=this.props.masterStepToggles;t[e]=!t[e],this.props.setMasterStepToggles(t)}},{key:"render",value:function(){var e=this,t=Array(16).fill(0);return r.a.createElement("div",{className:"steps-visualizer"},t.map(function(t,n){return r.a.createElement(uw,{onClick:function(){return e.onClickStep(n)},stepNumber:n,currentStep:e.props.stepNumber})}))}}]),t}(a.Component),pw=Object(y.b)(function(e,t){var n=t.sequencerEngine.getSequenceId();return{stepNumber:e.sequencer.currentGlobalStep[n]||0,masterStepToggles:e.steps.masterStepToggles}},function(e){return{setMasterStepToggles:function(t){return e(Object(w.Ub)(t))}}})(lw),hw=new U.a,dw=hw.getColor(1);var fw=Object(y.b)(function(e,t){return{muted:t.track.muted}},null)(function(e){var t=Object(a.useState)(0),n=Object(Z.a)(t,2),s=n[0],i=n[1],o=Object(a.useState)(0),c=Object(Z.a)(o,2),u=c[0],l=c[1],p=Object(a.useState)({}),h=Object(Z.a)(p,2),d=h[0],f=h[1],m=Object(a.useState)({}),v=Object(Z.a)(m,2),g=v[0],b=v[1],y=Object(a.useCallback)(function(){e.track.mute(!e.track.muted)},[e.track]),k=Object(a.useCallback)(function(t){t.trackNumber===e.track.trackNumber&&setTimeout(function(){i((new Date).getTime()+t.duration+50);var e=1-t.sliceStartTime/t.sliceDuration,n=Object(X.a)({},g);n.borderBottomColor=hw.brighten(dw,e),b(n),setTimeout(E,1e3*t.duration)},t.time)},[e.track,e.currentSubSequenceId,g]),E=Object(a.useCallback)(function(t){void 0!==t&&t.trackNumber!==e.track.trackNumber||l((new Date).getTime())},[e.track]),S=function(){window.removeEventListener(oo,k),window.removeEventListener(co,E)};Object(a.useEffect)(function(){return window.addEventListener(oo,k),window.addEventListener(co,E),S},[]);var w=e.track.sample,C=void 0===w?void 0:w.getThumbnail();Object(a.useEffect)(function(){var t={},n=void 0;if(void 0===C){var a=w&&void 0!==w.getId()?w.getId():e.track.getName();n=hw.getColorForHash(a),t.backgroundColor=n}e.muted?t.opacity=.2:t.opacity=1,f(t)},[e.track,e.muted]);var P="track-visualizer";return s>u&&(P+=" triggering"),r.a.createElement("div",{onClick:function(){return y()},style:Object(X.a)({},d,g),className:P},r.a.createElement(O,{condition:void 0!==C},r.a.createElement("img",{src:C})))});var mw=Object(y.b)(function(e,t){return{currentSubSequence:e.sequencer.currentSubSequence[t.sequencerEngine.engineId]}},null)(function(e){var t=e.sequencerEngine.tracks;return r.a.createElement("div",{className:"tracks-visualizer"},t.map(function(t){return r.a.createElement(fw,{currentSubSequenceId:e.currentSubSequence,track:t})}))});function vw(e,t){var n=Array.from(e).filter(function(e){return t.has(e)});return new Set(n)}var gw=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isToggled",value:function(){return this.props.track.isEnabled}},{key:"onToggleClicked",value:function(){this.props.track.toggleEnabled(),this.setState(this.state)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{onClick:function(){return e.onToggleClicked()},className:this.isToggled()?"toggled track-toggle-button":"track-toggle-button"})}}]),t}(a.Component),bw=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onMuteClicked",value:function(){this.props.track.mute(!this.props.muted),this.setState(this.state)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{onClick:function(){return e.onMuteClicked()},className:this.props.muted?"muted track-mute-button":"track-mute-button"})}}]),t}(a.Component),yw=Object(y.b)(function(e,t){return{muted:e.tracks.trackMutes[t.track.trackNumber]}},null)(bw),kw=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isGroupMuted",value:function(){return this.props.group.muted}},{key:"onGroupMuteClicked",value:function(){this.props.group.mute(!this.props.group.muted),this.setState(this.state)}},{key:"onTrackMuteClicked",value:function(){var e=this.props.group.tracks[0];e.mute(!e.muted),this.setState(this.state)}},{key:"isTrackMuted",value:function(){return this.props.group.tracks[0].muted}},{key:"render",value:function(){var e=this;return 1==this.props.group.tracks.length?r.a.createElement("div",{className:"group-top-buttons"},r.a.createElement("div",{className:"toggle-buttons-container"},r.a.createElement(gw,{track:this.props.group.tracks[0]})),r.a.createElement("div",{onClick:function(){return e.onTrackMuteClicked()},className:this.props.muted?"muted group-mute-button":"group-mute-button"})):r.a.createElement("div",{className:"group-top-buttons"},r.a.createElement("div",{onClick:function(){return e.onGroupMuteClicked()},className:this.props.muted?"muted small-group-mute-button":"small-group-mute-button"}),r.a.createElement("div",{className:"toggle-buttons-container"},this.props.group.tracks.map(function(e){return r.a.createElement(gw,{track:e})})),r.a.createElement("div",{className:"track-mute-buttons-container"},this.props.group.tracks.map(function(e){return r.a.createElement(yw,{track:e})})))}}]),t}(a.Component),Ew=Object(y.b)(function(e,t){var n=e.tracks.groupMutes[t.group.groupNumber];return 1==t.group.tracks.length&&(n=e.tracks.trackMutes[t.group.tracks[0].trackNumber]),{muted:n}},null)(kw);var Sw=0,Ow=new U.a,ww=new Set(["hi-hat","kick","snare","clap","crash","ride","breaks","tom"]);var Cw=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={height:0},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.height!==t.height||(this.props.selectedTrack!==e.selectedTrack||(this.props.renders!==e.renders||this.props.track!==e.track))}},{key:"componentDidMount",value:function(){var e=this;this.timer=setInterval(function(){e.setState({height:Math.min(60+e.props.track.trackMeter.getLevel(),100)})},100)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"onDragStart",value:function(e){this.props.onDraggingTrack(this.props.track)}},{key:"onDrop",value:function(e,t){void 0!==this.props.trackDragging&&this.props.trackDragging.group!==this.props.group&&(this.props.groups.addToGroup(this.props.trackDragging,this.props.group),this.props.onGroupsChanged())}},{key:"getNameToShow",value:function(){if(void 0!==this.props.track.sample){var e=this.props.track.sample.tags.filter(function(e){return ww.has(e)})[0];if(e)return e}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:14;return void 0===e||null===e?"":(e.length>t?e.substring(0,t)+"...":e).trim()}(this.props.track.getName())}},{key:"render",value:function(){var e=this,t={height:this.state.height},n={},a=void 0;if(void 0===this.thumbnail){var s=this.props.track.sample&&void 0!==this.props.track.sample.getId()?this.props.track.sample.getId():this.props.track.getName();a=Ow.getColorForHash(s),n.backgroundColor=a}var i=void 0!==this.props.selectedTrack&&this.props.selectedTrack!==this.props.track.trackNumber;i&&this.props.isSelectedGroup&&(n.opacity=.5);var o=this.props.selectedTrack===this.props.track.trackNumber,c=t;c["background-color"]="hsl("+240*(Sw+=5)/512+",100%,50%)";var u={};a&&(u.backgroundColor=Ow.brighten(a,1.2));var l=this.getNameToShow();return 3===this.props.numParts?l=l.slice(0,2):this.props.numParts>3&&(l=l.slice(0,1)),r.a.createElement("div",{onDragStart:function(t){return e.onDragStart(t)},onDragOver:function(t){return e.onDragOver(t)},onDrop:function(t){e.onDrop(t)},draggable:!0,style:n,className:o?"thumbnail-part-container selected-track":i?"thumbnail-part-container":"thumbnail-part-container selected",onClick:function(){return e.props.onClickTrack(e.props.track)}},r.a.createElement("div",{style:c,className:i?"blank-thumbnail thumbnail-part unselected":"blank-thumbnail thumbnail-part"},void 0!==this.thumbnail?r.a.createElement("img",{onError:function(){return e.setState({thumbnail:void 0})},src:this.thumbnail,className:i?"draggable droppable thumbnail-part unselected":"draggable droppable thumbnail-part"}):""),void 0===this.thumbnail?r.a.createElement("div",{style:u,className:"group-part-name"},l):"")}},{key:"thumbnail",get:function(){var e=this.props.track.sample;if(void 0!==e)return e.getThumbnail()}}]),t}(a.Component),Pw=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickTrack",value:function(e){this.props.selectedTrack===e.trackNumber&&this.props.group.tracks.length>1?this.props.onSelectTrack(void 0):this.props.onSelectTrack(e)}},{key:"render",value:function(){var e=this,t=this.props.group,n=100/t.tracks.length;return r.a.createElement("div",null,r.a.createElement(Ew,{partWidth:n,group:t}),r.a.createElement("div",{className:"group-thumbnail"},t.tracks.map(function(a){return r.a.createElement(Cw,{key:"group-thumbnail-track-"+a.trackNumber,onDraggingTrack:e.props.onDraggingTrack,trackDragging:e.props.trackDragging,onGroupsChanged:e.props.onGroupsChanged,renders:e.props.renders,groups:e.props.groups,onClickTrack:function(t){return e.onClickTrack(t)},numParts:t.tracks.length,isSelectedGroup:e.props.isSelectedGroup,selectedTrack:e.props.selectedTrack,track:a,partWidth:n,group:t})})))}}]),t}(a.Component);function Tw(e){var t=e.channel.channelMixer,n=Object(a.useState)(jw(e.channel)),s=Object(Z.a)(n,2),i=s[0],o=s[1],c=Object(a.useCallback)(function(n){t.switchChannelOutput(e.channel.outputNode,n.left,n.right),e.channel.outputs=[n.left,n.right],o(jw(e.channel))},[e.channel,o]);return r.a.createElement("div",{className:"outputs-container"},r.a.createElement(pp.a,{className:"channel-dropdown",controlClassName:"channel-control-dropdown",arrowClassName:"channel-arrow-dropdown",options:xw(t),onChange:function(e){return c(e.value)},value:i,placeholder:"Rate"}))}function jw(e){var t=e.outputs[0],n=e.outputs[1];return{label:void 0!==n?t+1+"/"+(n+1):t+1,value:{left:t,right:n}}}function xw(e){for(var t=[],n=0;n<e.channelCount;n+=2)t.push({label:n+1+"/"+(n+2),value:{left:n,right:n+1}});for(var a=0;a<e.channelCount;a++)t.push({label:a+1,value:{left:a}});return t}var Nw=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={groups:e.groups},n.state={volume:n.getVolume(),pattern:e.pattern},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isSelectedGroup",value:function(){return this.props.group.tracks.indexOf(this.selectedTrack)>-1||this.props.group===this.props.selectedGroup}},{key:"getSelectedTrackInGroup",value:function(){return 1==this.props.group.tracks.length?this.props.group.tracks[0]:this.props.group.tracks.indexOf(this.selectedTrack)>-1?this.selectedTrack:void 0}},{key:"shouldComponentUpdate",value:function(e,t){return this.state.pattern!=e.pattern?(this.state.pattern=e.pattern,!0):this.props.isSelected!==e.isSelected||this.props.group!==e.group||this.props.renders!==e.renders||this.props.trackDragging!==e.trackDragging||this.props.selectedTrack!==e.selectedTrack||this.state.selectedGroup!==e.selectedGroup||e.volume!=this.getVolume()}},{key:"getVolume",value:function(){var e=this.getSelectedTrackInGroup();return 1==this.props.group.tracks.length?this.props.group.tracks[0].getVolume()-15:void 0===e?this.props.group.volume:e.getVolume()-15}},{key:"onSelectTrack",value:function(e){void 0!==e?(this.props.cursor.track=e.trackNumber,this.props.sequencerEngine.selectTrack(e.trackNumber)):this.props.setSelectedTrack(void 0),this.props.setSelectedGroup(this.props.group)}},{key:"onChangeVolume",value:function(e){var t=this.getSelectedTrackInGroup();1!=this.props.group.tracks.length&&void 0===t?(this.onSelectTrack(void 0),this.props.setSelectedGroup(this.props.group),this.props.group.setVolume(e)):(e<-38&&(e=-200),t.setVolume(e+15),this.onSelectTrack(t)),this.setState({volume:e})}},{key:"getTags",value:function(){var e=[],t=this.getSelectedTrackInGroup();return(e=void 0===t?[]:void 0!==t.sample?function(e){var t=[];for(var n in e){var a=e[n];for(var r in e){var s=e[r];if(s!==a&&vw(new Set(a.split(" ")),new Set(s.split(" "))).size>1){t.push(a);break}}}for(var i in e=new Set(e),t)e.delete(t[i]);return Array.from(e)}(t.sample.tags):[t.getName()]).length>6&&e.splice(0,6),e}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:this.isSelectedGroup()?"group selected with-tracks":"group with-tracks"},r.a.createElement("div",{className:"volume-slider-container"},r.a.createElement(fe.a,{handle:"square",value:this.props.volume,change:function(t){return e.onChangeVolume(t.target.value)},step:.1,max:128,min:0,orientation:"vertical",reversed:!0})),this.props.channelMixer.stereoConnected?"":r.a.createElement(Tw,{channel:this.props.group}),r.a.createElement(Pw,{onDraggingTrack:this.props.onDraggingTrack,trackDragging:this.props.trackDragging,renders:this.props.renders,groups:this.props.groups,onGroupsChanged:this.props.onGroupsChanged,isSelectedGroup:this.isSelectedGroup(),selectedTrack:this.props.selectedTrack,onSelectTrack:function(t){return e.onSelectTrack(t)},group:this.props.group}),r.a.createElement("div",{className:"tags-container"},this.getTags().map(function(e){return r.a.createElement(A.a,{size:"sm",color:"dark"},e)})))}},{key:"selectedTrack",get:function(){return this.props.sequencerEngine.tracks[this.props.selectedTrack]}}]),t}(a.Component),qw=Object(y.b)(function(e,t){var n=void 0,a=t.sequencerEngine.tracks[e.mix.selectedTrack];1==t.group.tracks.length?n=t.group.tracks[0].trackNumber:t.group.tracks.indexOf(a)>-1&&(n=e.mix.selectedTrack);return{volume:1==t.group.tracks.length?t.group.tracks[0].getVolume()-15:void 0===n?e.tracks.groupVolumes[t.group.groupNumber]:e.tracks.trackVolumes[n]-15,selectedGroup:e.mix.selectedGroup,selectedTrack:e.mix.selectedTrack}},function(e){return{setSelectedTrack:function(t){return e(Object(w.ad)(t))},setSelectedGroup:function(t){return e(Object(w.Mc)(t))}}})(Nw),Mw=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"onDrop",value:function(e){void 0!==this.props.trackDragging&&this.props.trackDragging.group!==this.props.group&&(this.props.groups.newGroup(this.props.trackDragging),this.props.onGroupsChanged())}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"group"},r.a.createElement("div",{onDragOver:function(t){return e.onDragOver(t)},onDrop:function(t){e.onDrop(t)},draggable:!0,className:"new-group-box"},"NEW GROUP"))}}]),t}(a.Component),Dw=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={renders:0},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onDraggingTrack",value:function(e){this.setState({trackDragging:e,renders:this.state.renders+2})}},{key:"onGroupsChanged",value:function(){this.setState({renders:this.state.renders+2})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"groups-component"},this.groups.groups.map(function(t){return r.a.createElement(qw,{sequencerEngine:e.props.sequencerEngine,trackDragging:e.state.trackDragging,renders:e.state.renders,onGroupsChanged:function(){return e.onGroupsChanged()},cursor:e.props.sequencerEngine.cursor,groups:e.groups,onDraggingTrack:function(t){return e.onDraggingTrack(t)},pattern:e.props.sequencerEngine.currentPattern,channelMixer:e.props.sequencerEngine.channelMixer,group:t})}),r.a.createElement(Mw,{onGroupsChanged:function(){return e.onGroupsChanged()},groups:this.groups,trackDragging:this.state.trackDragging}))}},{key:"groups",get:function(){return this.props.sequencerEngine.groups}}]),t}(a.Component),Aw=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={minSelected:!1,maxSelected:!1,isMouseDown:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onMouseDown",value:function(){}},{key:"onMouseUp",value:function(){this.props.setParametersToRecord([])}},{key:"getEffectsTrackIf",value:function(e){var t=this.props.sequencerEngine.sends.sends;return"IS_TRACK"===e?this.props.selectedTrack:"IS_GROUP"==e&&-1==t.indexOf(this.props.selectedGroup)?this.props.selectedGroup:"IS_SEND"==e&&t.indexOf(this.props.selectedGroup)>-1?this.props.selectedGroup:void 0}},{key:"getParameterLocks",value:function(){return void 0===this.props.sequencerEngine.parameterLocks[this.props.id]?[]:this.props.sequencerEngine.parameterLocks[this.props.id].parameterLocks}},{key:"onChange",value:function(e){if(this.state.minSelected)void 0!==this.state.selectedParameter&&(this.state.selectedParameter.min=this.state.selectedParameter.normalizeOriginal(e),this.state.selectedParameter.set(this.state.selectedParameter.min),this.props.setMultiParameterSliderValue(this.props.id,e));else if(this.state.maxSelected)void 0!==this.state.selectedParameter&&(this.state.selectedParameter.max=this.state.selectedParameter.normalizeOriginal(e),this.state.selectedParameter.set(this.state.selectedParameter.max),this.props.setMultiParameterSliderValue(this.props.id,e));else{var t=this.getParameterLocks().map(function(e){return e.parameter});t.forEach(function(t){return t.normalizedSet(e)}),this.props.setMultiParameterSliderValue(this.props.id,e),this.props.setParametersToRecord(t)}}},{key:"onAdd",value:function(){if(void 0!==this.props.selectedParameter){var e=void 0!==this.getEffectsTrackIf("IS_GROUP")?this.getEffectsTrackIf("IS_GROUP").groupNumber:void 0,t=void 0!==this.getEffectsTrackIf("IS_TRACK")?this.getEffectsTrackIf("IS_TRACK").trackNumber:void 0,n=void 0!==this.getEffectsTrackIf("IS_SEND")?this.getEffectsTrackIf("IS_SEND").sendNumber:void 0,a=this.props.selectedEffect;this.props.sequencerEngine.parameterLocks[this.props.id].addParameterLock(t,e,n,a,this.props.selectedParameter),this.setState(this.state)}}},{key:"onDeleteParameterLock",value:function(e){this.props.sequencerEngine.parameterLocks[this.props.id].deleteParameterLock(e)}},{key:"onClickParameterLock",value:function(e){if(this.state.selectedParameter===e.parameter)this.setState({selectedParameter:void 0});else{if(void 0!==e.trackNumber){var t=this.props.sequencerEngine.tracks[e.trackNumber];this.props.setSelectedTrack(t.trackNumber),this.props.setSelectedGroup(void 0)}else if(void 0!==e.groupNumber)this.props.setSelectedTrack(void 0),this.props.setSelectedGroup(this.props.sequencerEngine.groups.groups[e.groupNumber]);else if(void 0!==e.sendNumber){var n=this.props.sequencerEngine.sends.sends[e.sendNumber];this.props.setSelectedTrack(void 0),this.props.setSelectedGroup(n)}this.setState({selectedParameter:e.parameter})}}},{key:"onClickMin",value:function(){this.setState({minSelected:!this.state.minSelected,maxSelected:!1})}},{key:"onClickMax",value:function(){this.setState({maxSelected:!this.state.maxSelected,minSelected:!1})}},{key:"formatNumber",value:function(e){return e<=1?e:Math.floor(e)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{onMouseDown:function(){return e.onMouseDown()},onMouseLeave:function(){return e.onMouseUp()},onMouseUp:function(){return e.onMouseUp()},className:"multi-parameter-slider-container"},r.a.createElement("div",{className:"ranged-slider-container"},r.a.createElement("div",{onClick:function(){return e.onClickMin()},className:this.state.minSelected?"selected min-label":"min-label"},void 0!==this.state.selectedParameter?this.formatNumber(this.state.selectedParameter.min):"MIN"),r.a.createElement("div",{className:"slider-container"},r.a.createElement(fe.a,{handle:"square",value:this.props.value,change:function(t){return e.onChange(t.target.value)},step:.01,max:1,min:0,orientation:"horizontal",reversed:!1})),r.a.createElement("div",{onClick:function(){return e.onClickMax()},className:this.state.maxSelected?"selected max-label":"max-label"},void 0!==this.state.selectedParameter?this.formatNumber(this.state.selectedParameter.max):"MAX")),r.a.createElement("div",{className:"parameters-container"},r.a.createElement("div",{className:"parameters-title"},"PARAMETERS"),r.a.createElement("div",{onClick:function(){return e.onAdd()},className:void 0!==this.props.flashing?"flashit add-parameter-button":"add-parameter-button"},"+"),r.a.createElement("div",{className:"parameters-list"},this.getParameterLocks().map(function(t){return r.a.createElement(Rw,{onDelete:function(){return e.onDeleteParameterLock(t)},onClick:function(){return e.onClickParameterLock(t)},isSelected:e.state.selectedParameter===t.parameter,parameter:t.parameter})}))))}}]),t}(a.Component),Rw=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:this.props.isSelected?"selected parameter-lock":"parameter-lock",onClick:this.props.onClick},void 0!==this.props.parameter.effectName?r.a.createElement("div",null,this.props.parameter.effectName," - ",this.props.parameter.name,r.a.createElement("div",{className:"delete-button",onClick:this.props.onDelete},"x")):r.a.createElement("div",null,this.props.parameter.name,r.a.createElement("div",{className:"delete-button",onClick:this.props.onDelete},"x")))}}]),t}(a.Component),Iw=(Object(y.b)(function(e,t){return{selectedParameter:e.mix.selectedParameter,flashing:e.mix.selectedParameterFlashing,selectedEffect:e.effects.selectedEffect,selectedTrack:e.mix.selectedTrack,selectedGroup:e.mix.selectedGroup,value:e.mix.multiParameterSliderValues[t.id]||0}},function(e){return{setSelectedTrack:function(t){return e(Object(w.ad)(t))},setSelectedGroup:function(t){return e(Object(w.Mc)(t))},setParametersToRecord:function(t){return e(Object(w.hc)(t))},setMultiParameterSliderValue:function(t,n){return e(Object(w.ac)(t,n))}}})(Aw),function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"sub-sequence-chooser"})}}]),t}(a.Component)),Lw=(Object(y.b)(function(e,t){return{}},null)(Iw),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={option:rw},n.onClickOption=n.onClickOption.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickOption",value:function(e){this.props.setMixViewMode(e)}},{key:"onClickThumbnail",value:function(){this.props.setShowLFOs(!this.props.showLFOs)}},{key:"onClickLock",value:function(){this.props.lfosTrack.togglePatternLocked()}},{key:"render",value:function(){this.props.isMixView;return r.a.createElement("div",null)}}]),t}(a.Component)),Fw=(a.Component,Object(y.b)(function(e,t){return{mixViewMode:e.mix.mixViewMode,showLFOs:e.sequencer.showLFOs,patternLocked:e.tracks.lfoPatternLocks[t.sequencerEngine.currentPattern]}},function(e){return{setShowLFOs:function(t){return e(Object(w.pd)(t))},setMixViewMode:function(t){return e(Object(w.Zb)(t))}}})(Lw)),Vw=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickOption",value:function(e){this.props.setEffectsPaneOption(e)}},{key:"render",value:function(){var e=this;return"HIDE"==this.props.option?r.a.createElement("div",{className:"effects-pane-sidebar"},r.a.createElement("div",{onClick:function(){return e.onClickOption("EFFECTS")},className:"sidebar-option"},"SHOW")):r.a.createElement("div",{className:"effects-pane-sidebar"},r.a.createElement("div",{onClick:function(){return e.onClickOption("HIDE")},className:"sidebar-option"},"HIDE"),r.a.createElement("div",{onClick:function(){return e.onClickOption("TRACK")},className:"TRACK"==this.props.option?"selected sidebar-option":"sidebar-option"},"TRACK"),r.a.createElement("div",{onClick:function(){return e.onClickOption("EFFECTS")},className:"EFFECTS"==this.props.option?"selected sidebar-option":"sidebar-option"},"EFFECTS"))}}]),t}(a.Component),Bw=Object(y.b)(function(e,t){return{option:e.mix.effectsPaneOption}},function(e){return{setEffectsPaneOption:function(t){return e(Object(w.qb)(t))}}})(Vw),Uw=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getParameters",value:function(){if(void 0===this.props.track)return[];var e=this.props.track.trackData;return[[e.durationParameter,e.transposeParameter,e.chopParameter],[e.velocityParameter,e.attackParameter,e.releaseParameter],[e.pitchAttackParameter,e.pitchDecayParameter,e.pitchSustainParameter,e.pitchReleaseParameter]]}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"track-parameters"},this.getParameters().map(function(t){return r.a.createElement(Hw,{sequencerEngine:e.props.sequencerEngine,parameters:t})}))}}]),t}(a.Component),Hw=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"parameters-box"},this.props.parameters.map(function(t){return r.a.createElement(Gw,{sequencerEngine:e.props.sequencerEngine,parameter:t})}))}}]),t}(a.Component),Jw=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onChange",value:function(e){var t=this;this.props.setSelectedParameter(this.props.parameter),this.props.setSelectedParameterFlashing(this.props.parameter),setTimeout(function(){t.props.setSelectedParameterFlashing(void 0)},3e3)}},{key:"render",value:function(){var e=this,t=this.props.parameter.originalMax-this.props.parameter.originalMin<=20?.01:1,n=this.props.isSelected;return r.a.createElement("div",{className:n?"selected parameter":"parameter"},r.a.createElement(Gl,{name:this.props.parameter.name,parameter:this.props.parameter,isParameter:!0,lfoEnabled:!0,sequencerEngine:this.props.sequencerEngine,value:this.props.value,onParameterChanged:function(t){return e.onChange()},step:t,max:this.props.parameter.originalMax,min:this.props.parameter.originalMin,orientation:"horizontal",reversed:!1}))}}]),t}(a.Component),Gw=Object(y.b)(function(e,t){var n=t.parameter.id;return{value:e.effects.effectParameters[n],isSelected:e.mix.selectedParameter===t.parameter}},function(e){return{setSelectedParameter:function(t){return e(Object(w.Qc)(t))},setSelectedParameterFlashing:function(t){return e(Object(w.Rc)(t))}}})(Jw),zw=Object(y.b)(null,null)(Uw),_w=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getEffectsTrack",value:function(){return void 0!==this.props.selectedGroup?this.props.selectedGroup:this.props.sequencerEngine.tracks[this.props.selectedTrack]}},{key:"getEffectsTrackIf",value:function(e){var t=this.props.sequencerEngine.sends.sends;return"IS_TRACK"===e?"number"===typeof this.props.selectedTrack?this.props.sequencerEngine.tracks[this.props.selectedTrack]:this.props.selectedTrack:"IS_GROUP"==e&&-1==t.indexOf(this.props.selectedGroup)?this.props.selectedGroup:"IS_SEND"==e&&t.indexOf(this.props.selectedGroup)>-1?this.props.selectedGroup:void 0}},{key:"onEffectsChange",value:function(){var e=this.getEffectsTrack();void 0!==e&&e.updateEffects()}},{key:"render",value:function(){var e=this;return"TRACK"===this.props.effectsPaneOption?r.a.createElement("div",{className:"effects-pane"},r.a.createElement(Bw,null),r.a.createElement(zw,{sequencerEngine:this.props.sequencerEngine,track:this.props.sequencerEngine.tracks[this.props.selectedTrack]})):this.props.hide?r.a.createElement("div",{className:"effects-pane hide"},r.a.createElement(Bw,null)):r.a.createElement("div",{className:"effects-pane"},r.a.createElement(Bw,null),void 0!==this.getEffectsTrack("IS_TRACK")||void 0!==this.getEffectsTrack("IS_SEND")||this.getEffectsTrack("IS_GROUP")?r.a.createElement(Sv.EffectsView,{store:this.props.sequencerEngine.store,sequencerEngine:this.props.sequencerEngine,onParameterChanged:function(t){return e.props.onParameterChanged(t)},onEffectsChange:function(){return e.onEffectsChange()},panning:0,onChangePanning:function(e){return console.log("panning changed = "+e)},sends:this.props.sequencerEngine.sends,isMixCollapsed:!0,tracks:this.props.sequencerEngine.tracks,track:this.getEffectsTrackIf("IS_TRACK"),send:this.getEffectsTrackIf("IS_SEND"),group:this.getEffectsTrackIf("IS_GROUP")}):"")}}]),t}(a.Component),Ww=Object(y.b)(function(e,t){return{selectedGroup:e.mix.selectedGroup,selectedTrack:e.mix.selectedTrack,effectsPaneOption:e.mix.effectsPaneOption,currentSubSequence:e.sequencer.currentSubSequence[t.sequencerEngine.engineId]}},null)(_w),Kw=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onSendMuteClicked",value:function(){this.props.send.mute(!this.props.send.muted),this.props.setSendMuted(this.props.send.sendNumber,this.props.send.muted),this.setState(this.state)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"group-top-buttons"},r.a.createElement("div",{onClick:function(){return e.onSendMuteClicked()},className:this.props.muted?"muted group-mute-button":"group-mute-button"}))}}]),t}(a.Component),Yw=Object(y.b)(function(e,t){return{muted:e.tracks.sendMutes[t.send.sendNumber]}},function(e){return{setSendMuted:function(t,n){return e(Object(w.cd)(t,n))}}})(Kw),Qw=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(Yw,{partWidth:100,send:this.props.send}),r.a.createElement("div",{className:"group-thumbnail"}))}}]),t}(a.Component),Xw=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"isSelected",value:function(){return this.props.send==this.props.selectedGroup}},{key:"onChangeVolume",value:function(e){this.props.send.setVolume(e),this.props.setSelectedGroup(this.props.send),this.props.setSelectedTrack(void 0)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:this.isSelected()?"group selected":"group"},r.a.createElement("div",{className:"volume-slider-container"},r.a.createElement(fe.a,{handle:"square",value:this.props.volume,change:function(t){return e.onChangeVolume(t.target.value)},step:.1,max:3,min:-40,orientation:"vertical",reversed:!0})),this.props.channelMixer.stereoConnected?"":r.a.createElement(Tw,{channel:this.props.send}),r.a.createElement(Qw,{send:this.props.send}),r.a.createElement("div",{className:"send-name"},"SEND ",this.props.send.name))}}]),t}(a.Component),Zw=Object(y.b)(function(e,t){return{selectedGroup:e.mix.selectedGroup,volume:t.send.getVolume()}},function(e,t){return{setSelectedGroup:function(t){return e(Object(w.Mc)(t))},setSelectedTrack:function(t){return e(Object(w.ad)(t))}}})(Xw),$w=["A","B","C","D","E","F","G","H","I","J","K"],eC=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onChangeVolume",value:function(e){this.props.subSequence.fade=e,this.props.currentSubSequence!==this.props.subSequence.id&&this.props.sequencerEngine.switchToSubSequence(this.props.subSequence.id)}},{key:"onClickMute",value:function(){this.props.subSequence.mute=!this.props.muted}},{key:"render",value:function(){var e=this,t="sub-sequence-fader";return this.props.currentSubSequence===this.props.subSequence.id&&(t+=" selected"),r.a.createElement("div",{key:"sub-sequence-fader-"+this.props.subSequence.id,className:t},r.a.createElement("div",null,this.patterns.map(function(t,n){return r.a.createElement(tC,{key:"pattern-"+n,subSequence:e.props.subSequence,sequencerEngine:e.props.sequencerEngine,isCurrent:n===e.props.currentPattern,pattern:n})})),r.a.createElement("div",{className:"sub-sequence-fader-and-info"},r.a.createElement("div",{className:"sub-sequence-fader-empty"}),r.a.createElement("div",{className:"volume-slider-container"},r.a.createElement(fe.a,{handle:"square",value:this.props.volume,change:function(t){return e.onChangeVolume(t.target.value)},step:.01,max:1,min:0,orientation:"vertical",reversed:!0})),r.a.createElement("div",{onClick:function(){return e.onClickMute()},className:this.props.muted?"sub-sequence-info muted":"sub-sequence-info"},$w[this.props.i])))}},{key:"patterns",get:function(){var e=this.props.subSequence.tracks[0];return void 0===e?[]:e.patterns}}]),t}(a.Component),tC=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t="sub-sequence-pattern";return this.props.isCurrent&&(t+=" current"),r.a.createElement("div",{onClick:function(){return e.switchToPattern()},className:t},this.props.pattern+1)}},{key:"switchToPattern",value:function(){this.props.sequencerEngine.switchToPattern(this.props.pattern,!1,this.props.subSequence),this.props.sequencerEngine.switchToSubSequence(this.props.subSequence.id)}}]),t}(a.Component),nC=Object(y.b)(function(e,t){var n=e.mix.subSequenceFades[t.subSequence.id],a=t.sequencerEngine.engineId;return{volume:void 0===n?1:n,muted:e.mix.subSequenceMuted[t.subSequence.id],currentPattern:e.sequencer.currentPattern[t.subSequence.id]||0,currentSubSequence:e.sequencer.currentSubSequence[a]}},null)(eC),aC=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"global-mix-container"},r.a.createElement("div",{className:"sub-sequences-mix-container"},this.props.sequencerEngine.subSequences.filter(function(e){return!e.isTrack}).map(function(t,n){return r.a.createElement(nC,{key:"sub-mix-"+n,sequencerEngine:e.props.sequencerEngine,i:n,subSequence:t})})))}}]),t}(a.Component),rC=(n(2350),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={selectedGroup:void 0,renders:0,pattern:e.sequencerEngine.currentPattern},n.sequencerEngine=e.sequencerEngine,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickPlayStop",value:function(){this.sequencerEngine.play(),this.setState(this.state)}},{key:"onParameterChanged",value:function(e){var t=this;this.props.setSelectedParameter(e),this.props.setSelectedParameterFlashing(e),setTimeout(function(){t.props.setSelectedParameterFlashing(void 0)},3e3)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"mix-view"},r.a.createElement(O,{condition:this.props.sequencerEngine.tracks.length>0},r.a.createElement(ow,{sequencerEngine:this.props.sequencerEngine}),r.a.createElement(Fw,{isMixView:!0,sequencerEngine:this.props.sequencerEngine,lfosTrack:this.props.sequencerEngine.lfosTrack})),r.a.createElement(pw,{sequencerEngine:this.props.sequencerEngine}),r.a.createElement(O,{condition:"ALL"===this.props.mixViewMode},r.a.createElement(mw,{sequencerEngine:this.props.sequencerEngine})),r.a.createElement("div",{className:this.hide?"channel-mixer lower":"channel-mixer"},r.a.createElement("div",{className:"channel-mixer-parts"},r.a.createElement("div",{className:"groups-container"},r.a.createElement(O,{condition:"ALL"!==this.props.mixViewMode},r.a.createElement(Dw,{sequencerEngine:this.sequencerEngine})),r.a.createElement(O,{condition:"ALL"===this.props.mixViewMode},r.a.createElement(aC,{sequencerEngine:this.props.sequencerEngine}))),r.a.createElement("div",{className:"mix-sends"},this.sequencerEngine.sends.sends.map(function(t){return r.a.createElement(Zw,{channelMixer:e.sequencerEngine.channelMixer,send:t})})))),r.a.createElement(O,{condition:"ALL"!==this.props.mixViewMode},r.a.createElement(Ww,{hide:this.hide,sequencerEngine:this.sequencerEngine,onParameterChanged:function(t){return e.onParameterChanged(t)}})))}},{key:"groups",get:function(){return this.sequencerEngine.groups}},{key:"hide",get:function(){return"HIDE"===this.props.effectsPaneOption||"ALL"===this.props.mixViewMode}}]),t}(a.Component)),sC=Object(y.b)(function(e,t){return{effectsPaneOption:e.mix.effectsPaneOption,currentSubSequence:e.sequencer.currentSubSequence[t.sequencerEngine.engineId],mixViewMode:e.mix.mixViewMode}},function(e){return{setSelectedTrack:function(t){return e(Object(w.ad)(t))},setSelectedGroup:function(t){return e(Object(w.Mc)(t))},setSelectedParameter:function(t){return e(Object(w.Qc)(t))},setSelectedParameterFlashing:function(t){return e(Object(w.Rc)(t))}}})(rC),iC=function(e){function t(e){var n;Object(o.a)(this,t),n=Object(u.a)(this,Object(l.a)(t).call(this,e));var a=Object(p.a)(n);return n.sequencerEngine=e.sequencerEngine,n.props.sequencerEngine.setUpdateCallback(function(e){return a.update(e)}),e.alreadyLoaded||(null==e.sequenceId?n.sequencerEngine.loadNewSequence():n.sequencerEngine.loadSequence(e.sequenceId)),n.state={edits:0,cursor:n.sequencerEngine.cursor,mixMode:!1,sequenceId:e.sequenceId},n.keyListener=new tw(n.sequencerEngine,n.props.installation),n.keyListener.disableTab=n.props.disableTab,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"update",value:function(e){void 0!==e&&e!=this.state.sequenceId&&(this.props.history&&(this.props.installation?this.props.history.push("/nime/"+e):this.props.history.push("/create/"+e)),this.state.sequenceId=e),this.setState(this.state)}},{key:"play",value:function(){this.isCommandDown?this.sequencerEngine.recordingMix=!1:this.sequencerEngine.recordingMix=!0,this.sequencerEngine.schedulePlay()}},{key:"record",value:function(){var e=!this.props.isRecording;this.props.setIsRecording(e),this.sequencerEngine.recording(e)}},{key:"toggleQuantize",value:function(){this.props.setQuantized(!this.props.quantized)}},{key:"componentDidMount",value:function(){this.bindKeys()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.keyListener.onKeyDown),window.removeEventListener("keyup",this.keyListener.onKeyUp)}},{key:"bindKeys",value:function(){var e=this;window.addEventListener("keydown",this.keyListener.onKeyDown),window.onkeydown=function(t){if(32==t.keyCode&&t.target==window.document.body)return("ARRANGEMENT_VIEW"===e.props.viewMode||e.sequencerEngine.state.arrangement.looping)&&e.props.setIsPlayingMix(!e.props.sequencerEngine.playing),e.play(),!1},window.addEventListener("keyup",this.keyListener.onKeyUp)}},{key:"onClick",value:function(e,t){this.isCommandDown?this.onShowParametersForTrackAndStep(e,t):(this.state.stepShowing==t&&!this.state.cursor.show||this.state.stepShowing!=t||e!=this.state.trackShowing)&&this.onClickStep(e,t)}},{key:"onClickGroupStep",value:function(e,t,n){console.log("onClickGroupStep = "+e+", "+t+")"),this.isCommandDown?this.onShowParametersForGroupAndStep(e,t):(this.props.sequencerEngine.operationManager.dispatch(Li(this.props.sequencerEngine.tracks[n],t,this.resolution)),this.sequencerEngine.selectGroupStep(e,t),this.setState(this.state))}},{key:"onClickStep",value:function(e,t){this.props.sequencerEngine.operationManager.dispatch(Li(this.props.sequencerEngine.tracks[e],t,this.resolution)),this.props.setSelectedSteps(void 0),this.sequencerEngine.select(e,t),this.state.cursor.track=e,this.state.edits++}},{key:"selectStep",value:function(e,t){this.sequencerEngine.select(e,t)}},{key:"onUpdateStepDuration",value:function(e,t,n){console.log("onUpdateStepDuration("+e+","+t+","+n+")"),Object($e.a)(n)&&(this.sequencerEngine.tracks[e].updateStepDuration(t,n,this.resolution),this.setState(this.state))}},{key:"onClickAddSteps",value:function(e){this.sequencerEngine.doubleTrackLength(e),this.setState(this.state)}},{key:"onClickRemoveSteps",value:function(e){this.sequencerEngine.halfTrackLength(e),this.setState(this.state)}},{key:"onMute",value:function(e){this.sequencerEngine.tracks[e].isMuted=!this.sequencerEngine.tracks[e].isMuted,this.setState(this.state)}},{key:"onClickDeleteTrack",value:function(e){this.props.keyboardEngine.deleteMappingsForTrack(e),this.sequencerEngine.deleteTrack(e),this.props.setTrackUnfocused(),this.setState(this.state)}},{key:"onShowParametersForGroupAndStep",value:function(e,t){this.state.cursor.group==e&&this.state.stepShowing==t?this.state.cursor.show=!this.state.cursor.show:this.state.cursor.show=!0,this.sequencerEngine.selectGroupStep(e,t),this.setState(this.state)}},{key:"onShowParametersForTrackAndStep",value:function(e,t){this.state.cursor.track==e&&this.state.stepShowing==t?(this.state.cursor.show=!this.state.cursor.show,this.sequencerEngine.tracks[e].stepUnselected(t)):this.state.cursor.show=!0,this.sequencerEngine.select(e,t),this.setState(this.state)}},{key:"runScript",value:function(){window.prompt("Type your script");this.setState(this.state),document.activeElement.blur()}},{key:"onClickTrack",value:function(e){}},{key:"onClickRollingMode",value:function(){this.props.setTrackRolling(!this.props.trackRolling),this.sequencerEngine.rollingManager.clear(),this.setState(this.state)}},{key:"onUpdateStepData",value:function(e,t,n){this.sequencerEngine.tracks[t].updateStepData(e,n,this.resolution)}},{key:"goToDetailsView",value:function(e){var t=this.sequencerEngine.tracks[e];if(void 0!==t)if(this.props.setSelectorMode(!1),"MIDI"==t.getTrackType()||t.getTrackType()==_n)this.props.setDetailsView(e),this.props.setViewMode("SOUND_DETAILS_VIEW");else if(this.sequencerEngine.isLoaded(e)){this.props.setDetailsView(e),this.sequencerEngine.tracks[e].getSamplers().length>1?this.props.setViewMode("MULTI_DETAILS_VIEW"):this.props.setViewMode("SOUND_DETAILS_VIEW")}}},{key:"onDrop",value:function(e){if(void 0!==this.props.sampleDragging){var t=this.props.sampleDragging;this.props.onAddSound(t,!1,t.slices),this.props.dragSample(void 0)}}},{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"onSelectGroup",value:function(e){this.state.cursor.group=e}},{key:"render",value:function(){var e=this;if(this.state.stepShowing=this.sequencerEngine.getSelectedStep(),this.state.trackShowing=this.state.cursor.track,this.props.hideSequencer)return r.a.createElement("div",null);var t=this.props.viewMode!==lo?"full-view":void 0!==this.props.trackFocused?"tracks-container focused":this.props.stretchTracks?"tracks-container showing-selector":"tracks-container";if(this.isShowingSoundsPane()&&(t+=" showing-selector"),this.props.viewMode===po)return r.a.createElement("div",{dropabble:"true",onDragOver:function(t){return e.onDragOver(t)},onDrop:function(t){return e.onDrop(t)},id:"#start",className:t},r.a.createElement(sC,{sequencerEngine:this.sequencerEngine}));if(this.props.showGroups){var n=this.props.sequencerEngine.groups.groups;return r.a.createElement("div",{dropabble:"true",onDragOver:function(t){return e.onDragOver(t)},onDrop:function(t){return e.onDrop(t)},id:"#start",className:t},r.a.createElement(aw,{sequencerEngine:this.props.sequencerEngine,envelopesTrack:this.props.sequencerEngine.envelopesTrack,lfosTrack:this.props.sequencerEngine.lfosTrack}),n.map(function(t){return r.a.createElement(ew,{sequencerEngine:e.props.sequencerEngine,group:t,sends:e.sequencerEngine.sends,cursor:e.state.cursor,onUpdateStepDuration:function(t,n,a){return e.onUpdateStepDuration(t.trackNumber,n,a)},onUpdateStepData:function(t,n,a){return e.onUpdateStepData(n,t.trackNumber,a)},selectedParameterStep:e.state.cursor.group==t.groupNumber?e.sequencerEngine.getSelectedStep():-1,onClickStep:function(n,a){return e.onClickGroupStep(t.groupNumber,n,a.trackNumber)},groupNumber:t.groupNumber})}))}return r.a.createElement("div",{dropabble:"true",onDragOver:function(t){return e.onDragOver(t)},onDrop:function(t){return e.onDrop(t)},id:"#start",className:t},r.a.createElement("div",null,r.a.createElement(O,{condition:!this.props.hideModulators&&void 0===this.props.trackFocused&&this.props.sequencerEngine.tracks.length>0&&!this.props.hideLFOsTrack},r.a.createElement(aw,{sequencerEngine:this.props.sequencerEngine,envelopesTrack:this.props.sequencerEngine.envelopesTrack,lfosTrack:this.props.sequencerEngine.lfosTrack})),this.sequencerEngine.tracks.filter(function(t){return void 0===e.props.trackFocused||e.props.trackFocused===t.trackNumber}).map(function(t,n){return r.a.createElement(HO,{key:"t-"+t.subSequence.id+"-"+t.trackNumber,disablePianoRoll:e.props.disablePianoRoll,installation:e.props.installation,sequencerEngine:e.sequencerEngine,soundId:t.getMainSoundId(),cursor:e.state.cursor,onLoadTrackUrl:function(e){return t.onLoadTrackUrl(e)},trackData:t,onClickTrack:function(){return e.onClickTrack(t.trackNumber)},sends:e.sequencerEngine.sends,onClickName:function(){return e.goToDetailsView(t.trackNumber)},trackNumber:t.trackNumber,onClickDelete:function(){return e.onClickDeleteTrack(t.trackNumber)},onClickAddSteps:function(){return e.onClickAddSteps(t.trackNumber)},onClickRemoveSteps:function(){return e.onClickRemoveSteps(t.trackNumber)},onClick:function(n){return e.onClick(t.trackNumber,n)}})}),r.a.createElement(O,{condition:!this.props.installation&&void 0===this.props.trackFocused&&this.props.sequencerEngine.tracks.length>0},r.a.createElement(zO,{sequencerEngine:this.sequencerEngine}))))}},{key:"isShowingSoundsPane",value:function(){return!this.props.sidebarCollapsed&&(this.props.showSelectorMode||this.props.sidebarViewMode!==qv)}},{key:"resolution",get:function(){return this.props.sequencerEngine.store.getState().sequencer.resolution}},{key:"isCommandDown",get:function(){return this.sequencerEngine.store.getState().keyboard.isCommandDown}},{key:"midiMapMode",get:function(){return this.sequencerEngine.store.getState().midi.midiMapMode}}]),t}(a.Component),oC=Object(y.b)(function(e,t){var n,a=(n={showGroups:e.sequencer.showGroups,viewMode:e.sequencer.viewMode,decentralized:e.sequencer.decentralized,sampleDragging:e.sequencer.sampleDragging,quantized:e.sequencer.quantized,isRecording:e.sequencer.isRecording,trackFocused:e.sequencer.trackFocused,sampleAuditioning:e.audition.sampleAuditioning,isCompactMode:e.sequencer.isCompactMode,trackRolling:e.sequencer.trackRolling},Object(_e.a)(n,"showGroups",e.sequencer.showGroups),Object(_e.a)(n,"currentSubSequence",e.sequencer.currentSubSequence[t.sequencerEngine.engineId]),Object(_e.a)(n,"showSelectorMode",e.sequencer.showSelectorMode),Object(_e.a)(n,"sidebarCollapsed",e.selector.sidebarCollapsed),Object(_e.a)(n,"sidebarViewMode",e.sequencer.sidebarViewMode),n);return t.alreadyLoaded||(a.sequencerEngine=e.sequencer.sequencerEngine),a},function(e){return{setMidiMapMode:function(t){return e(Object(w.Xb)(t))},setResolution:function(t){return e(Object(w.xc)(t))},setViewMode:function(t){return e(Object(w.ye)(t))},dragSample:function(t){return e(Object(w.f)(t))},setDetailsView:function(t){return e(Object(w.hb)(t))},startTriggerTrack:function(t){return e(Object(w.Ee)(t))},setIsPlayingMix:function(t){return e(Object(w.Ib)(t))},stopTriggerTrack:function(t){return e(Object(w.Fe)(t))},setQuantized:function(t){return e(Object(w.uc)(t))},setIsRecording:function(t){return e(Object(w.Jb)(t))},setCommandDown:function(t){return e(Object(w.P)(t))},setErasingAutomation:function(t){return e(Object(w.sb)(t))},setTrackUnfocused:function(){return e(Object(w.de)(void 0))},setSelectorMode:function(t){return e(Object(w.bd)(t))},setStepsToCopy:function(t){return e(Object(w.Sd)(t))},setCompactMode:function(t){return e(Object(w.S)(t))},setEasyPatternToCopy:function(t){return e(Object(w.jb)(t))},setShowSequenceModal:function(t){return e(Object(w.wd)(t))},setTrackRolling:function(t){return e(Object(w.le)(t))},setShowPresets:function(t){return e(Object(w.ud)(t))},setShowInstruments:function(t){return e(Object(w.od)(t))},setShowSequences:function(t){return e(Object(w.xd)(t))},hideAllEffects:function(){return e(Object(w.i)())},setShowGroups:function(t){return e(Object(w.nd)(t))},setSelectedSteps:function(t,n,a){return e(Object(w.Zc)(t,n,a))}}})(iC),cC=function(){function e(t){Object(o.a)(this,e),this.soundId=t,this.sample=new K.a(t),this.videoId=null,this.name=null}return Object(c.a)(e,[{key:"isLoaded",value:function(){return null!=this.name}},{key:"loadSoundDetails",value:function(e){var t=this,n=this;this.sample.fetchMetadata().then(function(a){t.videoId=a.videoId,t.name=a.name,e(n)})}}]),e}(),uC=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onGatedChange",value:function(e){this.props.track.gated="gated"===e.target.value,this.setState(this.state)}},{key:"onChangeDuration",value:function(e){this.props.track.trackData.duration=parseInt(e)}},{key:"onChangeTranspose",value:function(e){this.props.track.trackData.transpose=parseInt(e)}},{key:"onChangeChop",value:function(e){this.props.track.trackData.chop=parseInt(e)}},{key:"onChangeVelocity",value:function(e){this.props.track.trackData.velocity=parseFloat(e)}},{key:"onChangeAttack",value:function(e){this.props.track.trackData.attack=parseFloat(e)}},{key:"onChangeRelease",value:function(e){this.props.track.trackData.release=parseFloat(e)}},{key:"onChangePitchAttack",value:function(e){this.props.track.trackData.pitchAttack=parseFloat(e)}},{key:"onChangePitchDecay",value:function(e){this.props.track.trackData.pitchDecay=parseFloat(e)}},{key:"onChangePitchRelease",value:function(e){this.props.track.trackData.pitchRelease=parseFloat(e)}},{key:"render",value:function(){var e=this,t=this.props.track,n=t.trackData;return r.a.createElement("div",{className:"sound-parameters"},r.a.createElement("div",{className:"sound-parameters-heading"},"Sound Parameters"),r.a.createElement("div",{className:"sound-parameters-full"},r.a.createElement("form",null,r.a.createElement("div",{className:"radio"},r.a.createElement("label",null,r.a.createElement("input",{className:"filter-radio",type:"radio",value:"gated",checked:t.gated,onChange:function(t){return e.onGatedChange(t)}}),"Gated"),r.a.createElement("label",null,r.a.createElement("input",{className:"filter-radio",type:"radio",value:"ungated",checked:!t.gated,onChange:function(t){return e.onGatedChange(t)}}),"Ungated"))),r.a.createElement(lC,{change:function(t){return e.onChangeDuration(t)},min:1,max:64,defaultValue:n.duration,name:"DURATION"}),r.a.createElement(lC,{change:function(t){return e.onChangeChop(t)},min:1,max:32,defaultValue:n.chop,name:"CHOP"}),r.a.createElement(lC,{change:function(t){return e.onChangeTranspose(t)},min:-32,max:32,defaultValue:n.transpose,name:"TRANSPOSE"})),r.a.createElement("div",{className:"sound-parameters-full"},r.a.createElement(lC,{change:function(t){return e.onChangeVelocity(t)},min:0,max:1,defaultValue:n.velocity,name:"VELOCITYy"}),r.a.createElement(lC,{change:function(t){return e.onChangeAttack(t)},min:0,max:4e3,defaultValue:n.attack,name:"AMP ATTACK"}," "),r.a.createElement(lC,{change:function(t){return e.onChangeRelease(t)},min:0,max:1e4,defaultValue:n.release,name:"AMP RELEASE"})),r.a.createElement("div",{className:"sound-parameters-full"},r.a.createElement(lC,{change:function(t){return e.onChangePitchAttack(t)},min:.01,max:2e3,defaultValue:n.pitchAttack,name:"PITCH ATTACK"}),r.a.createElement(lC,{change:function(t){return e.onChangeAttack(t)},min:.01,max:4e3,defaultValue:n.pitchDecay,name:"PITCH DECAY"}," "),r.a.createElement(lC,{change:function(t){return e.onChangeRelease(t)},min:.01,max:2e3,defaultValue:n.pitchRelease,name:"PITCH RELEASE"})))}}]),t}(a.Component),lC=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={value:n.props.defaultValue},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onChange",value:function(e){this.state.value=e,this.props.change(e),this.setState(this.state)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"sound-parameter"},r.a.createElement("div",{className:"sound-parameter-name"},this.props.name,": ",this.state.value),r.a.createElement(fe.a,{value:this.state.value,change:function(t){return e.onChange(t.target.value)},step:this.props.max>1?1:.1,max:this.props.max,min:this.props.min,orientation:"horizontal",reversed:!1}))}}]),t}(a.Component),pC=uC,hC=function(e){function t(e){var n;return Object(o.a)(this,t),n=Object(u.a)(this,Object(l.a)(t).call(this,e)),console.log("constructor MultiDetailsView called"),n.state={sounds:e.track.soundIds.map(function(e){return new cC(e)}),track:e.track,showSoundDetails:!1,soundId:void 0,selectedSampler:void 0},n.state.sounds.map(function(e){return e.loadSoundDetails(function(){return n.update()})}),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"update",value:function(){this.setState(this.state)}},{key:"returnToMultiView",value:function(){this.state.selectedSampler=void 0,this.setState(this.state)}},{key:"goToSound",value:function(e){console.log("go to sound selecting = "+e),this.state.selectedSampler=e,this.setState(this.state)}},{key:"getVolume",value:function(e){if(void 0!==this.getSampler(e))return this.getSampler(e).getVolume()}},{key:"onChangeVolume",value:function(e,t){void 0!==this.getSampler(e)&&(this.getSampler(e).setVolume(t),this.setState(this.state))}},{key:"onChangeTranspose",value:function(e,t){void 0!==this.getSampler(e)&&(this.getSampler(e).transpose+=t,this.setState(this.state))}},{key:"onChangeOffset",value:function(e,t){void 0!==this.getSampler(e)&&(this.getSampler(e).offset+=t,this.setState(this.state))}},{key:"getSampler",value:function(e){return this.state.track.getSampler(e)}},{key:"onClickDelete",value:function(e){this.state.track.deleteSound(e);for(var t=-1,n=0;n<this.state.sounds.length;n++)this.state.sounds[n].soundId==e&&(t=n);console.log("deeting "+t),t>-1&&(console.log("deleting i="+t),this.state.sounds.splice(t,1)),console.log(this.state.sounds),this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this.state.sounds.filter(function(e){return e.isLoaded});return void 0!==this.state.selectedSampler?r.a.createElement(yk.DetailsView,{keyboardEngine:this.props.keyboardEngine,sequencerEngine:this.props.sequencerEngine,midiEngine:this.props.midiEngine,resolution:this.props.resolution,track:this.props.track,trackNumber:this.props.trackNumber,samplerNumber:this.state.selectedSampler,parentView:"MULTI_DETAILS_VIEW",onClickBack:function(){return e.returnToMultiView()},showParameters:!1}):r.a.createElement("div",null,r.a.createElement(tk,{onClickBack:function(){e.props.setViewMode(e.props.parentView),void 0!==e.props.onClickBack&&e.props.onClickBack()},headerText:this.props.track.getName()}),r.a.createElement(pC,{track:this.props.track}),r.a.createElement("div",{className:"clear-fix"}),t.map(function(t,n){return r.a.createElement("div",{className:"full-mixer"},r.a.createElement("div",{className:"mixer-sound"},r.a.createElement(fe.a,{value:e.getVolume(n),change:function(t){return e.onChangeVolume(n,t.target.value)},step:.1,max:0,min:-40,orientation:"vertical",reversed:!0}),r.a.createElement(z,{onClickThumbnail:function(){return e.goToSound(n)},sample:t.sample,showDelete:!0,isMuted:!1,soundId:t.soundId,onClickDelete:function(){return e.onClickDelete(t.soundId)},videoId:t.videoId}),r.a.createElement("div",{className:"transpose-parameter"},r.a.createElement("div",{className:"transpose-button",onClick:function(){return e.onChangeTranspose(n,-1)}},"-"),r.a.createElement("div",{className:"transpose-value"},e.getSampler(n).transpose),r.a.createElement("div",{className:"transpose-button",onClick:function(){return e.onChangeTranspose(n,1)}},"+")),r.a.createElement("div",{className:"tranpose-label"},"TRANPOSE"),r.a.createElement("div",{className:"offset-parameter"},r.a.createElement("div",{className:"offset-button",onClick:function(){return e.onChangeOffset(n,-1)}},"-"),r.a.createElement("div",{className:"offset-value"},e.getSampler(n).offset),r.a.createElement("div",{className:"offset-button",onClick:function(){return e.onChangeOffset(n,1)}},"+")),r.a.createElement("div",{className:"offset-label"},"OFFSET")))}))}}]),t}(a.Component),dC=Object(y.b)(function(e){return{viewMode:e.sequencer.viewMode}},function(e){return{setViewMode:function(t){return e(Object(w.ye)(t))}}})(hC),fC=(n(578),n(579),n(992),n(332),n(333),n(993),new U.a,function(e){function t(e){var n;Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).ethereumCache=new ol(e.store),Ge.a.setStore(e.store),Ge.a.setEthereum(R.a),Ge.a.checkLogin(),R.a.guilds.initGuilds(),R.a.cache=n.ethereumCache,R.a.cache.loadIndex(),void 0===e.sequencerEngine&&e.fastCreate&&q.a.setContext(new AudioContext({sampleRate:$}));var a=void 0!==e.sequencerEngine?e.sequencerEngine.getSequenceId():void 0!=e.match.params.sequenceId?e.match.params.sequenceId:null;return n.state={showPalette:!1,soundIds:null,sequenceId:a,resolution:new ht(16,!1),scriptingFocused:!1,selectedTrack:0,dropdownOpen:!1},R.a.store=n.props.store,R.a.crypto.store=n.props.store,void 0!==n.props.sequencerEngine?(n.sequencerEngine=n.props.sequencerEngine,n.sequencerEngine.tracks.forEach(function(e){return e.updateSteps()})):n.sequencerEngine=new pl(n.props.store),window.sequencerEngine=n.sequencerEngine,n.props.setSequencerEngine(n.sequencerEngine),n.scripting=new Dl(n.sequencerEngine),n.sequencerEngine.setScripting(n.scripting),n.keyboardEngine=new dy(n.sequencerEngine),n.sequencerEngine.connectToKeyboardEngine(n.keyboardEngine),n.ethereumSearcher=new Pi(n.ethereumCache,n.sequencerEngine),n.sequencerEngine.ethereumCache=n.ethereumCache,iy(n.sequencerEngine),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("beforeunload",function(e){return e.returnValue="Please dont leave",e})}},{key:"onSelectTrack",value:function(e){this.sequencerEngine.cursor.track=e}},{key:"focusScripting",value:function(){this.setState({scriptingFocused:!0}),this.setState({scriptingFocused:!1})}},{key:"hideSoundsPane",value:function(){this.props.setSampleAuditioning(void 0),this.props.setSelectorMode(!1),this.props.setShowPresets(!1),this.props.setShowInstruments(!1),this.props.setShowSequences(!1),this.setState({showPalette:!1})}},{key:"showPalette",value:function(){this.setState({showPalette:!0})}},{key:"onScriptingInputSet",value:function(e){this.scriptingInput=e}},{key:"toggleDropdown",value:function(){this.setState({dropdownOpen:!this.state.dropdownOpen})}},{key:"onMouseUp",value:function(){this.props.isDragToggled&&this.props.mouseDown(!1)}},{key:"showSoundsPane",value:function(){return this.props.showSequences||this.props.showInstruments||this.props.showSelectorMode||this.props.showPresets||this.state.showPalette}},{key:"render",value:function(){var e=this,t=this.sequencerEngine.getSelectedTrack(),n=this.props.viewMode!==lo&&this.props.viewMode!==po,a=void 0!==t&&"MIDI"===t.getTrackType(),s="";"SCRIPTING_VIEW"===this.props.viewMode?s=r.a.createElement(ip,{scripting:this.scripting}):"SOUND_DETAILS_VIEW"===this.props.viewMode&&a?s=r.a.createElement(Ck,{track:this.sequencerEngine.tracks[this.sequencerEngine.cursor.track],sequencerEngine:this.sequencerEngine,audioInputManager:this.sequencerEngine.audioInputManager,midiEngine:this.sequencerEngine.midi}):"PREFERENCES_VIEW"===this.props.viewMode?s=r.a.createElement(ik,{onGoBack:this.props.onGoBack,alreadyLoaded:void 0!==this.props.sequencerEngine,channelMixer:this.sequencerEngine.channelMixer,sequencerEngine:this.sequencerEngine,midiEngine:this.sequencerEngine.midi}):"SOUND_DETAILS_VIEW"===this.props.viewMode?s=r.a.createElement(yk.DetailsView,{alreadyLoaded:void 0!==this.props.sequencerEngine,onGoBack:this.props.onGoBack,keyboardEngine:this.keyboardEngine,midiEngine:this.sequencerEngine.midi,trackNumber:this.sequencerEngine.cursor.track,resolution:this.state.resolution,parentView:lo,sequencerEngine:this.sequencerEngine,bpm:this.sequencerEngine.bpm,track:t||this.sequencerEngine.tracks[0]}):"MULTI_DETAILS_VIEW"===this.props.viewMode?s=r.a.createElement(dC,{sequencerEngine:this.sequencerEngine,keyboardEngine:this.keyboardEngine,parentView:lo,resolution:this.state.resolution,midiEngine:this.sequencerEngine.midi,trackNumber:this.sequencerEngine.cursor.track,track:t}):"ARRANGEMENT_VIEW"===this.props.viewMode&&(s=r.a.createElement(KS,{sequencerEngine:this.sequencerEngine}));var i="";this.props.viewMode!==po&&"ARRANGEMENT_VIEW"!==this.props.viewMode&&(i=r.a.createElement(ap,{sequencerEngine:this.sequencerEngine,onSetInput:function(t){return e.onScriptingInputSet(t)},update:function(){return e.setState(e.state)},showScriptingView:function(){return e.showScriptingView()},scripting:this.scripting,scriptingFocused:this.state.scriptingFocused}));var o=Object.keys(this.props.loadingSequence).some(function(t){return e.props.loadingSequence[t]}),c="ARRANGEMENT_VIEW"===this.props.viewMode?"scroll-area arrange":"scroll-area";return r.a.createElement("div",{onMouseUp:function(){return e.onMouseUp()},onKeyDown:this.onKeyDown,className:this.props.isTrackFocused?"sequencer-container focused":"sequencer-container"},r.a.createElement(sy,{show:this.props.showLogin}),r.a.createElement(uk,{sequencerEngine:this.sequencerEngine}),r.a.createElement("div",{className:c},this.props.viewMode==po||this.props.viewMode==lo||"ARRANGEMENT_VIEW"==this.props.viewMode?r.a.createElement(Il.a,{stickyClassName:"toolbar-sticky",className:"",mode:"top",boundaryElement:".main-area",hideOnBoundaryHit:!1,topOffset:-25,bottomOffset:0},r.a.createElement(Yy,{onGoBack:this.props.onGoBack,alreadyLoaded:void 0!==this.props.sequencerEngine})):"",s,r.a.createElement("div",{className:"main-area"},o?r.a.createElement("div",{className:"loading-sequence-info"},"LOADING SEQUENCE ...",r.a.createElement(V.a,{sizeUnit:"px",size:10,color:"#42f4f1",loading:o})):"",r.a.createElement(oC,{alreadyLoaded:void 0!==this.props.sequencerEngine,sequencerEngine:this.sequencerEngine,scriptingInput:this.scriptingInput,soundIds:this.state.soundIds,sequenceId:this.state.sequenceId,selectedTrack:this.sequencerEngine.cursor.track,stretchTracks:this.showSoundsPane(),history:this.props.history,onSelectTrack:function(t){return e.onSelectTrack(t)},keyboardEngine:this.keyboardEngine,focusScripting:function(){return e.focusScripting()},onAddSound:function(t,n,a,r){return e.addSound(t,n,a,r)},hideSequencer:n}),r.a.createElement(ty,{sequencerEngine:this.sequencerEngine,ethereumSearcher:this.ethereumSearcher}))),i)}}]),t}(a.Component)),mC=Object(y.b)(function(e){return{viewMode:e.sequencer.viewMode,detailsView:e.sequencer.detailsView,showSelectorMode:e.sequencer.showSelectorMode,decentralized:e.sequencer.decentralized,isDragToggled:e.sequencer.isDragToggled,isTrackFocused:void 0!==e.sequencer.trackFocused,loadingSequence:e.sequencer.loadingSequence,showSequences:e.sequencer.showSequences,showInstruments:e.sequencer.showInstruments,showPresets:e.sequencer.showPresets,zIndexHack:e.sequencer.zIndexHack,showLogin:e.sequencer.showLogin}},function(e){return{setSequencerEngine:function(t){return e(Object(w.gd)(t))},mouseDown:function(t){return e(Object(w.j)(t))},setSelectorMode:function(t){return e(Object(w.bd)(t))},setShowPresets:function(t){return e(Object(w.ud)(t))},setShowInstruments:function(t){return e(Object(w.od)(t))},setShowSequences:function(t){return e(Object(w.xd)(t))}}})(fC),vC=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).play=n.play.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"play",value:function(){if(this.isPlaying()){for(var e in this.props.isPlaying)if(this.props.isPlaying[e])for(var t in this.props.tracks)this.props.tracks[t].id===e&&this.props.multiSequencerEngine.play(this.props.tracks[t])}else this.props.multiSequencerEngine.play(this.props.tracks[0])}},{key:"isPlaying",value:function(){var e=this;return Object.keys(this.props.isPlaying).filter(function(t){return e.props.isPlaying[t]}).length>0}},{key:"onChangeBPM",value:function(e){this.props.multiSequencerEngine.updateBpm(e)}},{key:"render",value:function(){var e=this;return 0===this.props.tracks.length?r.a.createElement("div",null):r.a.createElement("div",{className:"mix-player-pane"},r.a.createElement("div",{className:"mix-controls-container"},r.a.createElement(ae,{play:this.play,isPlaying:this.isPlaying()}),r.a.createElement("div",{className:"bpm-container"},r.a.createElement("div",{className:"bpm-label"},"BPM: ",this.props.bpm),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement("div",{className:"spotlight-fader"},r.a.createElement(fe.a,{value:this.props.bpm,change:function(t){return e.onChangeBPM(t.target.value)},step:1,className:"spotlight-fader",max:250,min:1,orientation:"horizontal",reversed:!1})))),r.a.createElement("div",null,this.props.children))}}]),t}(a.Component),gC=Object(y.b)(function(e,t){return{isPlaying:e.sequencer.isPlaying,viewMode:e.user.viewMode,currentMix:e.user.currentMix,loadedTracks:e.user.loadedTracks,bpm:e.user.bpm}},void 0)(vC),bC={filterStars:!1,filterFavorites:!1,userToFilter:void 0};function yC(){return(yC=Object(g.a)(v.a.mark(function e(t,n){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=n,e.next=3,R.a.users.getUserName(t);case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}var kC=function(e){var t=e.filter||Object(X.a)({},bC),n=Object(a.useState)(void 0),s=Object(Z.a)(n,2),i=s[0],o=s[1],c=Object(a.useCallback)(function(){e.onFilterChanged(Object(X.a)({},t,{filterStars:!t.filterStars}))},[t,e.onFilterChanged]),u=Object(a.useCallback)(function(){e.onFilterChanged(Object(X.a)({},t,{filterFavorites:!t.filterFavorites}))},[t,e.onFilterChanged]),l=Object(a.useCallback)(function(){e.onFilterChanged(Object(X.a)({},t,{userToFilter:void 0}))},[t,e.onFilterChanged]);return Object(a.useEffect)(function(){t.userToFilter?function(e,t){yC.apply(this,arguments)}(t.userToFilter,o):o(void 0)},[t]),r.a.createElement("div",{className:"tracks-filter"},r.a.createElement("div",{onClick:c,className:t.filterStars?"star starred":"star"},r.a.createElement("span",null,"\u2606")),r.a.createElement("div",{onClick:u,className:t.filterFavorites?"heart favorited":"heart"}),r.a.createElement(O,{condition:void 0!==i},r.a.createElement("div",{onClick:l,className:"user-to-filter"},i)))},EC=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={text:""},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onInputType",value:function(e){this.setState({text:e})}},{key:"onTag",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Bb.tagSequence(this.props.sequence.id,this.state.text);case 2:this.setState({text:""});case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"track-tagger"},r.a.createElement(A.h,null,r.a.createElement(A.g,{onChange:function(t){return e.onInputType(t.target.value)},value:this.state.text,placeholder:"Type tag",className:"sequence-tag-input"}),r.a.createElement(A.i,{addonType:"append"},r.a.createElement(A.b,{onClick:function(){return e.onTag()},color:"secondary"},"Tag"))))}}]),t}(a.Component),SC=0,OC=function(){function e(){Object(o.a)(this,e),this.id=SC++,this.name=void 0,this.tracks=[],this.bpm=void 0}return Object(c.a)(e,[{key:"deleteTrack",value:function(e){var t=this.tracks.indexOf(e);this.tracks.splice(t,1)}},{key:"fromJson",value:function(e){if(void 0!==e)return"name"in e&&(this.name=e.name),"tracks"in e&&(this.tracks=e.tracks),"bpm"in e&&(this.bpm=e.bpm),"id"in e&&(this.id=e.id),this}},{key:"getJson",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t={name:this.name,tracks:this.tracks,bpm:this.bpm};return e&&(t.id=this.id),t}}]),e}(),wC=["A","B","C","D","E","F","G","H"],CC=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"switchPattern",value:function(e){this.props.sequencerEngine.switchToPattern(e)}},{key:"chooseSubSequence",value:function(e){this.props.sequencerEngine.switchToSubSequence(e)}},{key:"getSubSequencesComponent",value:function(){var e=this;return r.a.createElement("div",{className:"sub-sequence-buttons"},this.props.subSequences.map(function(t,n){return r.a.createElement("div",{key:wC[n],onClick:function(){return e.chooseSubSequence(t)},className:t===e.props.currentSubSequence?"sub-sequence selected":"sub-sequence"},wC[n])}))}},{key:"render",value:function(){var e=this;return void 0===this.props.sequencerEngine.tracks[0]?this.getSubSequencesComponent():r.a.createElement("div",null,r.a.createElement("div",{className:"pattern-buttons"},this.props.sequencerEngine.tracks[0].patterns.map(function(t,n){return r.a.createElement("div",{onClick:function(){return e.switchPattern(n)},className:e.props.currentPattern===n?"current pattern-button":"pattern-button"},n+1)})),this.getSubSequencesComponent())}}]),t}(a.Component),PC=Object(y.b)(function(e,t){var n=t.sequencerEngine.engineId,a=t.sequencerEngine.currentSubSequence.id;return{currentPattern:e.sequencer.currentPattern[a]||0,subSequenceId:a,subSequences:e.sequencer.subSequences[n]||[],currentSubSequence:e.sequencer.currentSubSequence[n]}},null)(CC),TC=new U.a,jC=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={sequence:n.props.sequence,userName:void 0,showComments:!1,showTagger:!1,numNotes:void 0},n.loadDate(),n.loadUser(),n.loadNumNotes(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"loadNumNotes",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ub(this.props.sequence.id,!1);case 2:if(void 0!==(t=e.sent)){e.next=5;break}return e.abrupt("return");case 5:this.setState({numNotes:t.length});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loadUser",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.ethereum.users.getUserName(this.props.sequence.user);case 2:t=e.sent,this.setState({userName:t});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loadDate",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:this.props.sequence,e.next=3,this.props.ethereum.web3.eth.getBlock(t.blockNumber);case 3:n=e.sent,a=new Date(1e3*n.timestamp).toLocaleString(),this.setState({date:a});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onClickDelete",value:function(){this.props.isPlayable?this.props.unloadTrack():(void 0!==this.props.sequencerEngine&&this.props.sequencerEngine.dispose(),this.props.onClickDelete())}},{key:"onClickTrackName",value:function(){this.props.isPlayable||(void 0!==this.props.sequencerEngine?this.props.unloadTrack():this.props.loadTrack())}},{key:"onChangeVolume",value:function(e){this.props.sequencerEngine.setMasterVolume(e),this.setState(this.state)}},{key:"isLoaded",value:function(){return!!this.props.isPlayable&&(void 0!==this.props.loadingSequence&&!this.props.loadingSequence[this.state.sequence.id]&&void 0!==this.props.sequencerEngine)}},{key:"onClickEdit",value:function(){this.props.onEditSequence(this.props.sequencerEngine)}},{key:"onClickComment",value:function(){this.setState({showComments:!0})}},{key:"onClickTag",value:function(){this.setState({showTagger:!0})}},{key:"getSequenceName",value:function(){return this.state.sequence?this.state.sequence.name:""}},{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"onDragStart",value:function(e){"SPOTLIGHT"!==this.props.viewMode&&"MIXES"!==this.props.viewMode||this.isLoaded()?e.preventDefault():this.props.setDraggingSpotlightTrack(this.props.sequence)}},{key:"onDrop",value:function(e){if("SPOTLIGHT"!==this.props.viewMode&&"MIXES"!==this.props.viewMode||this.isLoaded())e.preventDefault();else{var t=Object(ge.a)(this.props.tracks),n=t.map(function(e){return e.id}).indexOf(this.props.draggingSpotlightTrack.id);if(!(n<0)){if(t=zt(n,this.props.i,t),"SPOTLIGHT"===this.props.viewMode)this.props.setSpotlightTracks(Object.keys(t).map(function(e){return t[e]}));else{var a=(new OC).fromJson(this.props.currentMix);a.tracks=Object.values(t),this.props.setCurrentUserMix(a.getJson())}this.props.setUserHasEditsToSave(!0)}}}},{key:"render",value:function(){var e=this,t=void 0!==this.props.sequencerEngine&&(void 0===this.props.loadingSequence||this.props.loadingSequence[this.state.sequence.id]),n={};return this.props.isEditing&&(n.backgroundColor=TC.brighten(TC.getColorForHash(this.props.sequence.id),1)),r.a.createElement("div",{onDragStart:function(t){return e.onDragStart(t)},onDragOver:function(t){return e.onDragOver(t)},onDrop:function(t){return e.onDrop(t)},draggable:!0,style:n,className:this.isLoaded()?"loaded spotlight-track":"spotlight-track"},this.props.isEditing||this.isLoaded()?r.a.createElement("div",{onClick:function(){return e.onClickDelete()},className:"delete-button"},"x"):"",r.a.createElement("div",{className:"volume-pane"},this.isLoaded()?r.a.createElement(fe.a,{value:this.props.masterVolume,change:function(t){return e.onChangeVolume(t.target.value)},step:.1,className:"spotlight-fader",max:6,min:-40,orientation:"vertical",reversed:!0}):""),r.a.createElement("div",{className:"track-pane"},r.a.createElement("div",{onClick:function(){return e.onClickTrackName()},className:"track-name"},this.getSequenceName()),this.isLoaded()?r.a.createElement(ae,{play:this.props.play,isPlaying:this.props.isPlaying,sequencerEngine:this.props.sequencerEngine}):"",r.a.createElement("div",{className:"clear-fix"}),r.a.createElement("div",{className:"date-and-name"},r.a.createElement("div",{className:"track-user-name"},this.state.userName),r.a.createElement("div",{className:"track-date"},this.state.date?this.state.date:"")),r.a.createElement(V.a,{sizeUnit:"px",size:10,color:"#42f4f1",loading:t}),this.isLoaded()?r.a.createElement(PC,{currentPattern:this.props.currentPattern,sequencerEngine:this.props.sequencerEngine}):""),r.a.createElement(O,{condition:this.isLoaded()&&!this.state.showComments},r.a.createElement("div",{onClick:function(){return e.onClickEdit()},className:"edit-button red-button common-button"},"Edit"),r.a.createElement("div",{onClick:function(){return e.onClickTag()},className:"edit-button green-button common-button"},"Tag"),r.a.createElement("div",{onClick:function(){return e.onClickComment()},className:"edit-button green-button common-button"},this.state.numNotes?this.state.numNotes+" Notes":"Notes")),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(O,{condition:this.state.showComments},r.a.createElement(_b,{onHide:function(){return e.setState({showComments:!1})},userId:this.props.userId,sequence:this.props.sequence})),r.a.createElement(O,{condition:this.state.showTagger},r.a.createElement(EC,{onHide:function(){return e.setState({showComments:!1})},sequence:this.props.sequence})))}}]),t}(a.Component),xC=Object(y.b)(function(e,t){return{masterVolume:e.sequencer.masterVolumes[t.sequence.id],currentMix:e.user.currentMix}},function(e){return{setSpotlightTracks:function(t){return e(Object(w.Kd)(t))},setUserHasEditsToSave:function(t){return e(Object(w.te)(t))},setCurrentUserMix:function(t){return e(Object(w.bb)(t))}}})(jC),NC=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={draggingSpotlightTrack:void 0},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"play",value:function(e){this.props.multiSequencerEngine.play(e)}},{key:"unloadTrack",value:function(e){this.props.unloadTrack(e)}},{key:"loadTrack",value:function(e){this.props.loadTrack(e)}},{key:"getSequencerEngine",value:function(e){return this.props.multiSequencerEngine.getSequencerEngine(e)}},{key:"setDraggingSpotlightTrack",value:function(e){this.setState({draggingSpotlightTrack:e})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"user-tracks"},this.props.tracks.map(function(t,n){return r.a.createElement(xC,{isPlayable:e.props.isPlayable,play:function(){return e.play(t)},i:n,viewMode:e.props.viewMode,tracks:e.props.tracks,isEditing:e.props.isEditing,ethereum:e.props.ethereum,setDraggingSpotlightTrack:function(t){return e.setDraggingSpotlightTrack(t)},draggingSpotlightTrack:e.state.draggingSpotlightTrack,isPlaying:e.props.isPlaying[t.id],unloadTrack:function(){return e.unloadTrack(t.id)},loadTrack:function(){return e.loadTrack(t.id)},key:"sequence-"+t.id,onEditSequence:e.props.onEditSequence,sequencerEngine:e.getSequencerEngine(t.id),userId:e.props.userId,onClickDelete:function(){return e.props.onDeleteTrack(t)},loadingSequence:e.props.loadingSequence,store:e.props.store,sequence:t})}))}}]),t}(a.Component),qC=Object(y.b)(function(e,t){return{isPlaying:e.sequencer.isPlaying,loadingSequence:e.sequencer.loadingSequence,loadedTracks:e.user.loadedTracks,viewMode:e.user.viewMode}},function(e){return{setIsPlaying:function(t,n){return e(Object(w.Hb)(t,n))}}})(NC),MC=(n(2351),function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickSequencer",value:function(){window.location="/create/"}},{key:"onClickSampler",value:function(){"DISCOVER"!==this.props.view&&(window.location="/discover/")}},{key:"onClickExplore",value:function(){"EXPLORE"!==this.props.view&&(window.location="/explore/")}},{key:"onClickLogo",value:function(){window.location="/"}},{key:"render",value:function(){var e=this,t=this.props.view||"",n="DISCOVER"===t?"navigator-button selected":"navigator-button",a="EXPLORE"===t?"navigator-button selected":"navigator-button";return r.a.createElement("div",{className:"navigator"},r.a.createElement(sy,{show:this.props.showLogin}),r.a.createElement("div",{onClick:function(){return e.onClickLogo()},className:"universal-sequences-logo "+t},"ZEQUENCER"),r.a.createElement("div",{onClick:function(){return e.onClickSequencer()},className:"navigator-button"},"CREATE"),r.a.createElement("div",{onClick:function(){return e.onClickExplore()},className:a},"EXPLORE"),r.a.createElement("div",{onClick:function(){return e.onClickSampler()},className:n},"SAMPLE"),r.a.createElement("div",{className:"guilds-menu-container"},r.a.createElement(ky,{store:this.props.store}),r.a.createElement(by,{store:this.props.store})))}}]),t}(a.Component)),DC=Object(y.b)(function(e){return{showLogin:e.sequencer.showLogin}},null)(MC);var AC=R.a.web3,RC={};function IC(){return(IC=Object(g.a)(v.a.mark(function e(t,n){var a,r,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in RC)){e.next=4;break}n(RC[t]),e.next=11;break;case 4:return e.next=6,AC.eth.getBlock(t);case 6:a=e.sent,r=new Date(1e3*a.timestamp),s=r.toISOString().slice(0,10),RC[t]=s,n(s);case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}function LC(e,t){return void 0!==e&&void 0!==t&&e.toLowerCase()===t.toLowerCase()}function FC(){return(FC=Object(g.a)(v.a.mark(function e(t,n,a){var r,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ge.a.getAccount();case 2:return r=e.sent,e.next=5,Bb.isSequenceStarred(t.id);case 5:((s=e.sent)||LC(r,t.user))&&n(!0),s&&console.log("track.id = "+t.id+" is starred"),a(s);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function VC(){return(VC=Object(g.a)(v.a.mark(function e(t,n){var a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ge.a.getAccount();case 2:if(void 0!==(a=e.sent)){e.next=5;break}return e.abrupt("return");case 5:return e.t0=n,e.next=8,Bb.isSequenceFavorited(t,a);case 8:e.t1=e.sent,(0,e.t0)(e.t1);case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}var BC=function(e){var t=Object(a.useState)(""),n=Object(Z.a)(t,2),s=n[0],i=n[1],o=Object(a.useState)([]),c=Object(Z.a)(o,2),u=c[0],l=c[1],p=Object(a.useState)(!1),h=Object(Z.a)(p,2),d=h[0],f=h[1],m=Object(a.useState)(!1),b=Object(Z.a)(m,2),y=b[0],k=b[1],E=Object(a.useState)(!1),S=Object(Z.a)(E,2),w=S[0],C=S[1];function P(){return(P=Object(g.a)(v.a.mark(function t(){var n;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Bb.getTags(e.track.id);case 2:n=t.sent,l(n);case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}function T(){return(T=Object(g.a)(v.a.mark(function t(n){return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n.stopPropagation(),Ge.a.isLoggedIn()){t.next=3;break}return t.abrupt("return");case 3:d?(Bb.unfavoriteSequence(e.track.id,e.guildId),f(!1)):(Bb.favoriteSequence(e.track.id,e.guildId),f(!0));case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}function j(){return(j=Object(g.a)(v.a.mark(function t(n){return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n.stopPropagation(),t.next=3,Ge.a.getAccount();case 3:if(LC(t.sent,e.track.user)){t.next=6;break}return t.abrupt("return");case 6:y?(Bb.unstarSequence(e.track.id,e.guildId),k(!1)):(Bb.starSequence(e.track.id,e.guildId),k(!0),C(!0));case 7:case"end":return t.stop()}},t)}))).apply(this,arguments)}Object(a.useEffect)(function(){!function(){P.apply(this,arguments)}(),function(e,t){VC.apply(this,arguments)}(e.track.id,f),function(e,t,n){FC.apply(this,arguments)}(e.track,C,k)},[e.track.blockNumber,k,C,e.track]);var x=Object(a.useCallback)(function(){""===s&&function(e,t){IC.apply(this,arguments)}(e.track.blockNumber,i)},[s,i,e.track]);return r.a.createElement("div",{onClick:e.onClickTrack,onMouseOver:x,className:"track"},r.a.createElement("div",{className:"track-main-info"},r.a.createElement("div",{className:"track-name"},e.track.title),r.a.createElement("div",{className:"track-info"},r.a.createElement(O,{condition:""!==s},r.a.createElement("div",{className:"track-date"},s)),r.a.createElement(O,{condition:w},r.a.createElement("div",{onClick:function(e){return j.apply(this,arguments)},className:y?"star starred":"star"},r.a.createElement("span",null,"\u2606")))),r.a.createElement("div",{onClick:function(e){return T.apply(this,arguments)},className:d?"heart favorited":"heart"}),r.a.createElement("div",{className:"track-collaborators"},e.track.collaborators.map(function(t){return r.a.createElement("div",{onClick:function(n){return function(t,n){t.stopPropagation(),e.onClickAuthor(n)}(n,t.userId)},className:"track-author"},t.userName)}))),r.a.createElement("div",{className:"track-metadata"},r.a.createElement("div",{className:"track-tags"},u.map(function(e){return r.a.createElement("div",{className:"track-tag"},e)})),r.a.createElement("div",{className:"favorite-and-star"})))},UC=(n(2352),0),HC=400,JC=50;function GC(){return(GC=Object(g.a)(v.a.mark(function e(t,n,a){var r,s,i,o;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],void 0!==t){e.next=3;break}return e.abrupt("return");case 3:if(!t.filterStars){e.next=8;break}return e.next=6,Bb.getStarredSequences(a);case 6:s=e.sent,r=s;case 8:if(!t.filterFavorites){e.next=17;break}return e.next=11,Ge.a.getAccount();case 11:if(void 0===(i=e.sent)){e.next=17;break}return e.next=15,Bb.getFavoritedSequences(i,a);case 15:o=e.sent,r=[].concat(Object(ge.a)(r),Object(ge.a)(o));case 17:n(r);case 18:case"end":return e.stop()}},e)}))).apply(this,arguments)}var zC=Object(y.b)(function(e){return{guildId:e.guilds.selectedGuild?e.guilds.selectedGuild.guildId:0}},null)(function(e){var t=Object(a.useState)([]),n=Object(Z.a)(t,2),s=n[0],i=n[1],o=Object(a.useState)(""),c=Object(Z.a)(o,2),u=c[0],l=c[1],p=Object(a.useState)(JC),h=Object(Z.a)(p,2),d=h[0],f=h[1],m=Object(a.useState)(!1),v=Object(Z.a)(m,2),g=v[0],b=v[1],y=Object(a.useState)([]),k=Object(Z.a)(y,2),E=k[0],S=k[1],O=Object(a.useState)(void 0),w=Object(Z.a)(O,2),C=w[0],P=w[1],T=Object(a.useCallback)(function(e){var t=++UC;b(!0),l(e),setTimeout(function(){t==UC&&b(!1)},250)},[e.allTracks,d]),j=Object(a.useCallback)(function(){var t=document.getElementById("tracks-list-container");g||e.isEditing||t.getBoundingClientRect().bottom<=window.innerHeight&&(b(!0),setTimeout(function(){f(d+JC),b(!1)},HC))},[d,u,g,e.allTracks,e.isEditing]);function x(){document.getElementsByClassName("projects")[0].removeEventListener("scroll",j)}return Object(a.useEffect)(function(){return document.getElementsByClassName("projects")[0].addEventListener("scroll",j),x},[j]),Object(a.useEffect)(function(){g||i(function(e,t,n,a,r){return a=new Set(a),""===n?e.filter(function(e){return 0===a.size||a.has(e.id)}).filter(function(e){return void 0===r||r.toLowerCase()===e.user.toLowerCase()}).slice(0,t):(n=n.toLowerCase(),e.filter(function(e){return void 0!==e.name}).filter(function(e){return void 0!==e.userName}).filter(function(e){return e.name.toLowerCase().includes(n)||e.userName.toLowerCase().includes(n)}).filter(function(e){return 0===a.size||a.has(e.id)}).filter(function(e){return void 0===r||r.toLowerCase()===e.user.toLowerCase()}).slice(0,t))}(e.allTracks,d,u,E,C))},[e.allTracks,u,d,g,E,C]),Object(a.useEffect)(function(){f(JC),function(e,t,n){GC.apply(this,arguments)}(e.filter,S,e.guildId),P(void 0===e.filter?void 0:e.filter.userToFilter)},[e.filter,e.guildId]),r.a.createElement("div",{id:"tracks-list-container",className:"tracks-list"},r.a.createElement("input",{id:"project-searcher",placeholder:"Search for project",type:"text",onChange:function(e){return T(e.target.value)},value:u}),r.a.createElement("div",{className:"table-header"},r.a.createElement("div",{className:"table-name"},"Name"),r.a.createElement("div",{className:"table-collaborators"},"Collaborators")),r.a.createElement("div",{className:"tracks-container"},s.map(function(t,n){return r.a.createElement(BC,{onClickTrack:function(){return e.onClickTrack(t)},onClickAuthor:function(t){return e.onClickAuthor(t)},key:"track-"+t.id+"-"+n,guildId:e.guildId,track:t})})),r.a.createElement(V.a,{sizeUnit:"px",size:30,color:"#123abc",loading:g}))}),_C={};function WC(e){var t="show-option";return e.show&&(t+=" show"),r.a.createElement("div",{onClick:function(){return e.onChange(!e.show)},className:t},e.name)}function KC(){return(KC=Object(g.a)(v.a.mark(function e(t,n){var a,r,s,i,o,c;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==n){e.next=21;break}return a=new Le.a,e.next=4,a.executeQuery();case 4:return r=e.sent,e.next=7,r.getNext();case 7:s=e.sent,i=[];case 9:if(!s){e.next=19;break}return e.next=12,YC(r.results);case 12:return i=e.sent,t(i),e.next=16,r.getNext();case 16:s=e.sent,e.next=9;break;case 19:e.next=28;break;case 21:return e.next=23,R.a.guildSequences.getGuildSequences(n);case 23:return o=e.sent,e.next=26,YC(o);case 26:c=e.sent,t(c);case 28:case"end":return e.stop()}},e)}))).apply(this,arguments)}function YC(e){return QC.apply(this,arguments)}function QC(){return(QC=Object(g.a)(v.a.mark(function e(t){var n,a,r,s,i;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=Fe(t).map(function(e){return Object(X.a)({},e,{name:e.title,id:e.newSequence})}),a=Array.from(new Set(n.map(function(e){return e.user}))),r={},e.t0=v.a.keys(a);case 4:if((e.t1=e.t0()).done){e.next=17;break}if(s=e.t1.value,!((i=a[s])in _C)){e.next=11;break}r[i]=_C[i],e.next=15;break;case 11:return e.next=13,R.a.users.getUserName(i);case 13:r[i]=e.sent,_C[i]=r[i];case 15:e.next=4;break;case 17:return e.abrupt("return",n.map(function(e){return Object(X.a)({},e,{userName:r[e.user],collaborators:e.collaborators.map(function(e){return{userId:e,userName:r[e]}})})}));case 18:case"end":return e.stop()}},e)}))).apply(this,arguments)}var XC=Object(y.b)(function(e){return{guildId:e.guilds.selectedGuild?e.guilds.selectedGuild.guildId:0}},null)(function(e){var t=Object(a.useState)([]),n=Object(Z.a)(t,2),s=n[0],i=n[1],o=Object(a.useState)(!1),c=Object(Z.a)(o,2),u=c[0],l=c[1],p=Object(a.useState)(!0),h=Object(Z.a)(p,2),d=h[0],f=h[1],m=Object(a.useState)([]),b=Object(Z.a)(m,2),y=b[0],k=b[1],E=Object(a.useState)(void 0),S=Object(Z.a)(E,2),w=S[0],C=S[1],P=Object(a.useState)(void 0),T=Object(Z.a)(P,2),j=T[0],x=T[1],N=Object(a.useState)(void 0),q=Object(Z.a)(N,2),M=q[0],D=q[1],A=Object(a.useState)(void 0),I=Object(Z.a)(A,2),L=I[0],F=I[1];function V(){return(V=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.a.getUser();case 2:t=e.sent,D(t);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}var B=Object(a.useCallback)(function(e){w.unloadTrack(e);var t=y.filter(function(t){return e!==t.id});k(t)},[y,k]);Object(a.useEffect)(function(){R.a.crypto.store=e.store,R.a.guilds.initGuilds(),Je.setSampleRate($);var t=new Al(e.store);window.sequencerEngine=t,t.ethereum=R.a,C(t),function(){V.apply(this,arguments)}()},[]),Object(a.useEffect)(function(){!function(e,t){KC.apply(this,arguments)}(i,e.guildId)},[e.guildId]);var U="";j&&(U=r.a.createElement(mC,{onGoBack:function(){return x(void 0)},store:e.store,sequencerEngine:j}));var H="";if(d){var J={height:window.innerHeight-150};H=r.a.createElement("div",{style:J,className:"projects"},r.a.createElement(kC,{filter:L,onFilterChanged:function(e){return F(e)}}),r.a.createElement(zC,{allTracks:s,isEditing:j,filter:L,onClickAuthor:function(e){return function(e){F(Object(X.a)({},L,{userToFilter:e}))}(e)},onClickTrack:function(e){w.loadTrack(e.id),k(y.concat(e))}}))}return r.a.createElement("div",null,U,r.a.createElement("div",{className:j?"explore hidden":"explore"},r.a.createElement(DC,{view:"EXPLORE",store:e.store}),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement("div",{className:"show-options"},r.a.createElement(WC,{name:"Projects",onChange:f,show:d}),r.a.createElement(WC,{name:"Mixer",onChange:l,show:u})),r.a.createElement("div",{className:"explore-inner"},H,r.a.createElement(gC,{isEditing:!0,multiSequencerEngine:w,tracks:y},r.a.createElement(O,{condition:u},r.a.createElement(Ie,{tracks:y,multiSequencerEngine:w})),r.a.createElement(O,{condition:d},r.a.createElement(qC,{isPlayable:!0,multiSequencerEngine:w,userId:M,tracks:y,loadTrack:void 0,unloadTrack:B,isEditing:!0,ethereum:R.a,onEditSequence:function(e){x(e)},onDeleteTrack:function(e){var t=y.indexOf(e);t>-1&&(console.log("splicing out loaded track"),y.splice(t,1),k(y))},store:e.store}))))))}),ZC=function(e){var t=e.name,n=e.children;return r.a.createElement("div",{className:"dashboard-module"},r.a.createElement("div",{className:"module-name"},t),r.a.createElement("div",{className:"inner-module"},n))},$C=Object(y.b)(function(e,t){return{actionsRemaining:e.installation.actionsRemaining,timeRemaining:e.installation.timeRemaining}},null)(function(e){var t=e.actionsRemaining<0?"submit-button disabled":"submit-button";return e.timeRemaining>0?r.a.createElement("div",{className:"actions"},r.a.createElement("div",{className:"actions-remaining"},e.timeRemaining/1e3),r.a.createElement("div",{className:"actions-text"},"seconds left")):r.a.createElement("div",{className:"actions"},r.a.createElement("div",{className:"actions-remaining"},e.actionsRemaining),r.a.createElement("div",{className:"actions-text"},"remaining"),r.a.createElement("div",{onClick:function(){e.sequencerEngine.operationManager.roomActionsManager.submitActions()},className:t},"Submit"))}),eP=function(e){return r.a.createElement("div",{className:"sequencer-module"},r.a.createElement(Vy,{sequencerEngine:e.sequencerEngine}),"Gate",r.a.createElement(pw,{sequencerEngine:e.sequencerEngine}))},tP=function(e){return r.a.createElement("div",{className:"rules-module"},r.a.createElement("div",{className:"rule"},"Add/Drag/Remove steps"),r.a.createElement("div",{className:"rule"},"Automate filter"))},nP=function(e){return r.a.createElement("div",{className:"room-module"},r.a.createElement("div",{className:"people-online"},"2"),r.a.createElement("div",{className:"people-text"},"people online"))};function aP(e,t,n,a,r){var s=document.getElementById(t).getBoundingClientRect(),i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,r=(a-e)/a,s=Math.pow(r,1.5);return t+(n-t)*s}(e.clientY-s.top,n,a,r);return isNaN(i)?-100:i}var rP=Object(y.b)(function(e,t){return void 0===t.track?{}:{volume:t.track.volumeParameter.get(),isSelectedTrack:e.mix.selectedTrack===t.track.trackNumber}},null)(function(e){var t=e.track,n=e.volume,s=e.min,i=void 0===s?-50:s,o=e.max,c=void 0===o?0:o,u=e.height,l=void 0===u?80:u,p=e.isSelectedTrack,h=Object(a.useState)(!1),d=Object(Z.a)(h,2),f=d[0],m=d[1],v=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-40,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(e-t)/(n-t)}(e,t,n,a);return a*Math.sqrt(r)}(n,i,c,l),g={height:v,top:l-v},b=function(){return"volume-"+t.trackNumber},y=Object(a.useCallback)(function(e){e.stopPropagation();var n=aP(e,b(),i,c,l);t.volumeParameter.set(n,.01),m(!0)},[t,m]),k=Object(a.useCallback)(function(e){if(e.stopPropagation(),f){var n=aP(e,b(),i,c,l);t.volumeParameter.set(n)}},[t,f]),E=t.getName();t.sample&&t.sample.tags&&(E=t.sample.tags[0]);var S=p?"track-mixer-volume selected":"track-mixer-volume";return r.a.createElement("div",{id:b(),onMouseUp:function(e){e.stopPropagation(),m(!1)},onMouseLeave:function(e){e.stopPropagation(),m(!1)},onMouseMove:k,onMouseDown:y,className:S},r.a.createElement("div",{className:"track-volume-name"},E),r.a.createElement("div",{style:g,className:"volume-indicator"}))}),sP=function(e){return r.a.createElement("div",{className:"mixer-module"},e.sequencerEngine.tracks.map(function(e){return r.a.createElement(rP,{track:e})}))},iP=(n(2353),function(e){return r.a.createElement("div",{className:"sequencer-dashboard"},r.a.createElement(ZC,{name:"Actions"},r.a.createElement($C,{sequencerEngine:e.sequencerEngine})),r.a.createElement(ZC,{name:"Rules"},r.a.createElement(tP,null)),r.a.createElement(ZC,{name:"Sequencer"},r.a.createElement(eP,{sequencerEngine:e.sequencerEngine})),r.a.createElement(ZC,{name:"Mixer"},r.a.createElement(sP,{sequencerEngine:e.sequencerEngine})),r.a.createElement(ZC,{name:"Room"},r.a.createElement(nP,null)))});var oP=Object(y.b)(function(e,t){t.sequencerEngine.engineId;var n=!1;return e.sequencer.sidebarCollapsed?n=!1:(t.sequencerEngine.tracks&&0===t.sequencerEngine.tracks.length||e.sequencer.showSelectorMode||e.sequencer.sidebarViewMode!==qv)&&(n=!0),{numTracks:t.sequencerEngine.tracks&&t.sequencerEngine.tracks.length,bottomHeight:e.arrangement.bottomHeight,bottomMode:e.arrangement.bottomMode,selectedRows:e.arrangement.selectedRows,selectedTrack:e.mix.selectedTrack,hide:n}},function(e){return{setArrangementBottomResizing:function(t){return e(Object(w.x)(t))}}})(function(e){var t={height:e.bottomHeight},n=Object(a.useCallback)(function(){e.setArrangementBottomResizing(!1)},[e.setArrangementBottomResizing]),s="",i="";if(e.hide)return r.a.createElement("div",null);if(void 0!==e.selectedTrack&&e.sequencerEngine.tracks){var o=e.sequencerEngine.tracks[e.selectedTrack];o&&(i=r.a.createElement(eO,{track:o,sequencerEngine:e.sequencerEngine}),e.bottomHeight>25&&(s=r.a.createElement(VE,{parentClassName:"arrangement-bottom-container",isLooping:!1,installation:!0,sequencerEngine:e.sequencerEngine,hideToolbar:!0,track:o})))}return r.a.createElement("div",{onMouseUp:n,style:t,className:"arrangement-bottom-container"},i,s)});function cP(e){var t=e.sequencerEngine;return r.a.createElement("div",{className:"bpm-component"},"BPM: ",t.bpmParameter.get())}new Gg;var uP=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={dropdownOpen:!1,showSaveModal:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"goToMixer",value:function(){this.props.setViewMode(po)}},{key:"goToArrangement",value:function(){this.props.setViewMode("ARRANGEMENT_VIEW")}},{key:"goToSequencer",value:function(){this.props.setViewMode(lo)}},{key:"goToPreferences",value:function(){this.props.setViewMode("PREFERENCES_VIEW")}},{key:"goToHome",value:function(){void 0!==this.props.onGoBack?this.props.onGoBack():window.location.href="/user/"}},{key:"toggleViewDropdown",value:function(){this.props.setZIndexHack(!this.state.dropdownOpen),this.setState({dropdownOpen:!this.state.dropdownOpen})}},{key:"duplicateTrack",value:function(){this.sequencerEngine.duplicateTrack(this.props.selectedTrack)}},{key:"onSave",value:function(e,t,n){this.hideSaveModal(),this.props.sequencerEngine.save(e,t,!0,n)}},{key:"hideSaveModal",value:function(){this.setState({showSaveModal:!1})}},{key:"save",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({showSaveModal:!0});case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onSelectResolution",value:function(e){this.props.sequencerEngine.resolution=e,this.props.sequencerEngine.select(this.props.sequencerEngine.cursor.track,0),this.setState(this.state)}},{key:"clickPattern",value:function(e){var t=this.props.sequencerEngine.store.getState();t.keyboard.isCommandDown?this.props.setPatternToEditColor(e):(this.props.sequencerEngine.switchToPattern(e),void 0!==t.toolbar.patternToEditColor&&this.props.setPatternToEditColor(e),this.setState(this.state))}},{key:"onDragStart",value:function(e){this.props.dragPattern(e)}},{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"onDrop",value:function(e){this.props.sequencerEngine.movePatternTo(this.props.patternDragging,e),this.setState(this.state)}},{key:"onPlayMixClicked",value:function(){}},{key:"onClickRecordMixButton",value:function(){}},{key:"onCompactClicked",value:function(){this.props.setCompactMode(!this.props.isCompactMode)}},{key:"onNewClicked",value:function(){window.confirm("Are you sure you want to clear this sequence (and lose any work)?")&&this.props.sequencerEngine.newSequence()}},{key:"getView",value:function(){return this.props.viewMode===lo?"SEQUENCER":this.props.viewMode===po?"MIXER":"PREFERENCES_VIEW"===this.props.viewMode?"PREFERENCES":"ARRANGEMENT_VIEW"===this.props.viewMode?"ARRANGEMENT":"VIEW"}},{key:"onStartSequenceRolling",value:function(){this.props.sequencerEngine.sequenceRolling=!0}},{key:"onStopSequenceRolling",value:function(){this.props.sequencerEngine.sequenceRolling=!1}},{key:"render",value:function(){for(var e=this,t=[],n=0;n<this.props.sequencerEngine.numberOfPatterns();n++)t.push(n);var a=-1;for(var s in this.props.sequencerEngine.tracks){var i=this.props.sequencerEngine.tracks[s].pattern.length();a<i&&(a=i)}return-1==a&&(a=32),r.a.createElement("div",{className:"top-toolbar"},r.a.createElement(Ly,{sequencerEngine:this.props.sequencerEngine,onSave:function(t,n,a){return e.onSave(t,n,a)},onHide:function(){return e.hideSaveModal()},show:this.state.showSaveModal}),r.a.createElement("div",{className:"main-toolbar"},r.a.createElement(zy,{sequencerEngine:this.props.sequencerEngine}),r.a.createElement(Cy,{sequencerEngine:this.props.sequencerEngine}),r.a.createElement("div",null,r.a.createElement(cP,{sequencerEngine:this.props.sequencerEngine}),r.a.createElement(Sy,{sequencerEngine:this.props.sequencerEngine})),r.a.createElement(Vy,{installation:!0,sequencerEngine:this.props.sequencerEngine}),r.a.createElement(Wy,{sequencerEngine:this.props.sequencerEngine}),this.props.trackRolling?r.a.createElement("div",{onMouseDown:function(){return e.onStartSequenceRolling()},onMouseUp:function(){return e.onStopSequenceRolling()},className:this.props.sequenceRolling?"roll-button rolling":"roll-button"},"ROLL"):"","OFF"!==this.props.midiMapMode?r.a.createElement("div",{className:"roll-button"},this.props.midiMapMode===qs?"MIDI MAP":"DELETE MIDI MAP"):"",r.a.createElement(O,{condition:this.props.viMode},r.a.createElement("div",{className:"roll-button command-button"},"COMMAND")),r.a.createElement("div",{className:"save-container"},r.a.createElement(O,{condition:this.props.onGoBack},r.a.createElement("div",{onClick:this.props.onGoBack,className:"go-back-button"},"BACK")),r.a.createElement("span",{onMouseOver:function(){return e.props.setContextualHelp("GUILDS_SELECTOR")},onMouseLeave:function(){return e.props.setContextualHelp(void 0)}},r.a.createElement(ky,{store:this.props.sequencerEngine.store}),r.a.createElement(by,{store:this.props.sequencerEngine.store})),r.a.createElement("div",{className:"light-blue-button common-button",onClick:function(){return e.onNewClicked()}},"NEW"),r.a.createElement("div",{className:"pink-button common-button",onClick:function(){return e.save()}},"SAVE"))),r.a.createElement(O,{condition:void 0!==this.props.patternToEditColor},r.a.createElement(Hy,{sequencerEngine:this.props.sequencerEngine})))}}]),t}(a.Component);new ht(4,!1),new ht(4,!0),new ht(8,!1),new ht(8,!0),new ht(16,!1),new ht(16,!0),new ht(32,!1),new ht(32,!0);Object(y.b)(function(e){var t=e.sequencer.sequencerEngine.getSequenceId(),n=e.sequencer.isPlaying[t]||0;return{midiMapMode:e.midi.midiMapMode,isCompactMode:e.sequencer.isCompactMode,resolution:e.sequencer.resolution,sequencerEngine:e.sequencer.sequencerEngine,detailsView:e.sequencer.detailsView,decentralized:e.sequencer.decentralized,viewMode:e.sequencer.viewMode,numberOfPatterns:e.sequencer.numberOfPatterns,samplePack:e.sequencer.samplePack,patternDragging:e.sequencer.patternDragging,isRecordingMix:e.mix.isRecordingMix,isPlayingMix:e.mix.isPlayingMix,isPlaying:n,patternToEditColor:e.toolbar.patternToEditColor,patternColors:e.toolbar.patternColors,trackRolling:e.sequencer.trackRolling,sequenceRolling:e.sequencer.sequenceRolling,viMode:e.commands.viMode}},function(e){return{setResolution:function(t){return e(Object(w.xc)(t))},setViewMode:function(t){return e(Object(w.ye)(t))},dragPattern:function(t){return e(Object(w.e)(t))},setIsPlayingMix:function(t){return e(Object(w.Ib)(t))},setPatternToEditColor:function(t){return e(Object(w.kc)(t))},setIsRecordingMix:function(t){return e(Object(w.Lb)(t))},setCompactMode:function(t){return e(Object(w.S)(t))},setZIndexHack:function(t){return e(Object(w.De)(t))},setContextualHelp:function(t){return e(Object(w.V)(t))}}})(uP),n(2354),new U.a;var lP=function(e){function t(e){var n;Object(o.a)(this,t),n=Object(u.a)(this,Object(l.a)(t).call(this,e)),window.installation=!0,n.ethereumCache=new ol(e.store),n.store=e.store,Ge.a.setStore(e.store),Ge.a.setEthereum(R.a),Ge.a.checkLogin(),R.a.guilds.initGuilds(),R.a.cache=n.ethereumCache,R.a.cache.loadIndex(),q.a.setContext(new AudioContext({sampleRate:ee}));var a=void 0!==e.sequencerEngine?e.sequencerEngine.getSequenceId():void 0!=e.match.params.sequenceId?e.match.params.sequenceId:null;return n.state={showPalette:!1,soundIds:null,sequenceId:a,resolution:new ht(16,!1),scriptingFocused:!1,selectedTrack:0,dropdownOpen:!1},R.a.store=n.props.store,R.a.crypto.store=n.props.store,void 0!==n.props.sequencerEngine?(n.sequencerEngine=n.props.sequencerEngine,n.sequencerEngine.tracks.forEach(function(e){return e.updateSteps()})):n.sequencerEngine=new pl(n.props.store),window.sequencerEngine=n.sequencerEngine,n.props.setSequencerEngine(n.sequencerEngine),n.scripting=new Dl(n.sequencerEngine),n.sequencerEngine.setScripting(n.scripting),n.keyboardEngine=new dy(n.sequencerEngine),n.sequencerEngine.connectToKeyboardEngine(n.keyboardEngine),n.ethereumSearcher=new Pi(n.ethereumCache,n.sequencerEngine),n.sequencerEngine.ethereumCache=n.ethereumCache,iy(n.sequencerEngine),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("beforeunload",function(e){return e.returnValue="Please dont leave",e})}},{key:"onSelectTrack",value:function(e){this.sequencerEngine.cursor.track=e}},{key:"focusScripting",value:function(){this.setState({scriptingFocused:!0}),this.setState({scriptingFocused:!1})}},{key:"onMouseMoveResize",value:function(e){if(this.store.getState().arrangement.isBottomResizing){var t=window.innerHeight-e.pageY;this.props.setArrangementBottomHeight(t-5)}}},{key:"hideSoundsPane",value:function(){this.props.setSampleAuditioning(void 0),this.props.setSelectorMode(!1),this.props.setShowPresets(!1),this.props.setShowInstruments(!1),this.props.setShowSequences(!1),this.setState({showPalette:!1})}},{key:"showPalette",value:function(){this.setState({showPalette:!0})}},{key:"onScriptingInputSet",value:function(e){this.scriptingInput=e}},{key:"toggleDropdown",value:function(){this.setState({dropdownOpen:!this.state.dropdownOpen})}},{key:"onMouseUp",value:function(){this.props.isDragToggled&&this.props.mouseDown(!1),this.store.getState().arrangement.isBottomResizing&&this.props.setArrangementBottomResizing(!1)}},{key:"showSoundsPane",value:function(){return this.props.showSequences||this.props.showInstruments||this.props.showSelectorMode||this.props.showPresets||this.state.showPalette}},{key:"render",value:function(){var e=this,t=this.sequencerEngine.getSelectedTrack(),n=this.props.viewMode!==lo&&this.props.viewMode!==po,a=void 0!==t&&"MIDI"===t.getTrackType(),s="";"SCRIPTING_VIEW"===this.props.viewMode?s=r.a.createElement(ip,{scripting:this.scripting}):"SOUND_DETAILS_VIEW"===this.props.viewMode&&a?s=r.a.createElement(Ck,{track:this.sequencerEngine.tracks[this.sequencerEngine.cursor.track],sequencerEngine:this.sequencerEngine,audioInputManager:this.sequencerEngine.audioInputManager,midiEngine:this.sequencerEngine.midi}):"PREFERENCES_VIEW"===this.props.viewMode?s=r.a.createElement(ik,{onGoBack:this.props.onGoBack,alreadyLoaded:void 0!==this.props.sequencerEngine,channelMixer:this.sequencerEngine.channelMixer,sequencerEngine:this.sequencerEngine,midiEngine:this.sequencerEngine.midi}):"SOUND_DETAILS_VIEW"===this.props.viewMode?s=r.a.createElement(yk.DetailsView,{alreadyLoaded:void 0!==this.props.sequencerEngine,onGoBack:this.props.onGoBack,keyboardEngine:this.keyboardEngine,midiEngine:this.sequencerEngine.midi,trackNumber:this.sequencerEngine.cursor.track,resolution:this.state.resolution,parentView:lo,sequencerEngine:this.sequencerEngine,bpm:this.sequencerEngine.bpm,track:t||this.sequencerEngine.tracks[0]}):"MULTI_DETAILS_VIEW"===this.props.viewMode?s=r.a.createElement(dC,{sequencerEngine:this.sequencerEngine,keyboardEngine:this.keyboardEngine,parentView:lo,resolution:this.state.resolution,midiEngine:this.sequencerEngine.midi,trackNumber:this.sequencerEngine.cursor.track,track:t}):"ARRANGEMENT_VIEW"===this.props.viewMode&&(s=r.a.createElement(KS,{sequencerEngine:this.sequencerEngine}));this.props.viewMode!==po&&"ARRANGEMENT_VIEW"!==this.props.viewMode&&r.a.createElement(ap,{sequencerEngine:this.sequencerEngine,onSetInput:function(t){return e.onScriptingInputSet(t)},update:function(){return e.setState(e.state)},showScriptingView:function(){return e.showScriptingView()},scripting:this.scripting,scriptingFocused:this.state.scriptingFocused});var i=Object.keys(this.props.loadingSequence).some(function(t){return e.props.loadingSequence[t]}),o="ARRANGEMENT_VIEW"===this.props.viewMode?"scroll-area arrange":"scroll-area";return r.a.createElement("div",{onMouseMove:function(t){return e.onMouseMoveResize(t)},onMouseUp:function(){return e.onMouseUp()},onKeyDown:this.onKeyDown,className:this.props.isTrackFocused?"sequencer-container focused":"sequencer-container installation"},r.a.createElement(sy,{show:this.props.showLogin}),r.a.createElement(uk,{sequencerEngine:this.sequencerEngine}),r.a.createElement("div",{className:o},r.a.createElement(iP,{sequencerEngine:this.sequencerEngine}),s,r.a.createElement("div",{className:"main-area"},i?r.a.createElement("div",{className:"loading-sequence-info"},"LOADING SEQUENCE ...",r.a.createElement(V.a,{sizeUnit:"px",size:10,color:"#42f4f1",loading:i})):"",r.a.createElement(oC,{alreadyLoaded:void 0!==this.props.sequencerEngine,hideModulators:!0,installation:!0,sequencerEngine:this.sequencerEngine,scriptingInput:this.scriptingInput,soundIds:this.state.soundIds,sequenceId:this.state.sequenceId,selectedTrack:this.sequencerEngine.cursor.track,stretchTracks:this.showSoundsPane(),history:this.props.history,onSelectTrack:function(t){return e.onSelectTrack(t)},keyboardEngine:this.keyboardEngine,focusScripting:function(){return e.focusScripting()},onAddSound:function(t,n,a,r){return e.addSound(t,n,a,r)},hideSequencer:n}))),r.a.createElement(oP,{sequencerEngine:this.sequencerEngine}))}}]),t}(a.Component),pP=Object(y.b)(function(e){return{viewMode:e.sequencer.viewMode,detailsView:e.sequencer.detailsView,showSelectorMode:e.sequencer.showSelectorMode,decentralized:e.sequencer.decentralized,isDragToggled:e.sequencer.isDragToggled,isTrackFocused:void 0!==e.sequencer.trackFocused,loadingSequence:e.sequencer.loadingSequence,showSequences:e.sequencer.showSequences,showInstruments:e.sequencer.showInstruments,showPresets:e.sequencer.showPresets,zIndexHack:e.sequencer.zIndexHack,showLogin:e.sequencer.showLogin}},function(e){return{setArrangementBottomHeight:function(t){return e(Object(w.v)(t))},setArrangementBottomResizing:function(t){return e(Object(w.x)(t))},setSequencerEngine:function(t){return e(Object(w.gd)(t))},mouseDown:function(t){return e(Object(w.j)(t))},setSelectorMode:function(t){return e(Object(w.bd)(t))},setShowPresets:function(t){return e(Object(w.ud)(t))},setShowInstruments:function(t){return e(Object(w.od)(t))},setShowSequences:function(t){return e(Object(w.xd)(t))}}})(lP),hP=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e="potential-member ";return this.props.isSelected&&(e+="selected"),r.a.createElement("div",{onClick:this.props.onClick,className:e},r.a.createElement("div",{className:"user-name"},this.props.userName),r.a.createElement("div",{className:"user-id"},this.props.userId))}}]),t}(a.Component),dP=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={addingMember:!1,users:[]},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"editGuildName",value:function(){this.props.onNameChange(this.props.guild.name)}},{key:"addMember",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e&&this.getPotentialUsers(),this.setState({addingMember:e})}},{key:"getPotentialUsers",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Le.a(R.a,!1),e.next=3,t.executeQuery();case 3:return e.next=5,t.getNext();case 5:if(e.t0=e.sent,e.t1=void 0,e.t0===e.t1){e.next=16;break}return e.t2=this,e.next=11,this.getUsersFromResults(t.results);case 11:e.t3=e.sent,e.t4={users:e.t3},e.t2.setState.call(e.t2,e.t4),e.next=3;break;case 16:return e.t5=this,e.next=19,this.getUsersFromResults(t.results);case 19:e.t6=e.sent,e.t7={users:e.t6},e.t5.setState.call(e.t5,e.t7);case 22:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUsersFromResults",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r,s,i,o;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(a in n=new Set,t)n.add(t[a].user);new Set(this.props.guild.members.map(function(e){return e.userId.trim().toUpperCase()})),n=Array.from(n),r={},e.t0=v.a.keys(n);case 6:if((e.t1=e.t0()).done){e.next=15;break}return s=e.t1.value,i=n[s].trim(),e.next=11,R.a.users.getUserName(i);case 11:o=e.sent,r[i]=o,e.next=6;break;case 15:return e.abrupt("return",r);case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props.guild;return r.a.createElement("div",{className:"guild-details"},r.a.createElement("div",{className:"details-header"},r.a.createElement(O,{condition:this.props.isEditingName},r.a.createElement(A.h,{className:"guild-name-input-group"},r.a.createElement(A.g,{onChange:function(t){return e.props.onNameChange(t.target.value)},value:this.props.name,placeholder:"Type name for guild",id:"guild-name-input"}))),r.a.createElement(O,{condition:!this.props.isEditingName},r.a.createElement("div",{onClick:function(){return e.editGuildName()},className:"guild-name"},t.name)),r.a.createElement("div",{className:"make-default-button"},"Make Default Guild")),this.getAddMemberFlow(),this.getShowMembersFlow())}},{key:"getAddMemberFlow",value:function(){var e=this;return this.state.addingMember?r.a.createElement("div",null,r.a.createElement("div",{className:"add-members-header"},"Add member"),Object.keys(this.state.users).map(function(t){return r.a.createElement(hP,{isSelected:e.props.usersSelected.has(t),onClick:function(){return e.props.selectUser(t)},userId:t,userName:e.state.users[t]})})):r.a.createElement("div",null)}},{key:"getShowMembersFlow",value:function(){var e=this;return this.state.addingMember?r.a.createElement("div",null):r.a.createElement("div",null,r.a.createElement("div",{className:"members-heading"},r.a.createElement("div",null,"Members"),r.a.createElement("div",{onClick:function(){return e.addMember()},className:"add-member-button"},"+")),r.a.createElement("div",{className:"guild-members"},this.props.guild.members.map(function(e){return r.a.createElement(fP,{member:e})})))}}]),t}(a.Component),fP=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"guild-member"},this.props.member.userName)}}]),t}(a.Component),mP=dP,vP=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{onClick:this.props.onClickGuild,className:"guild-item"},r.a.createElement("div",{className:"guild-name"},this.props.guild.name),r.a.createElement("div",{className:"members-count"},this.props.guild.members.length," members"))}}]),t}(a.Component),gP=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"guilds-list"},this.props.guilds.map(function(t){return r.a.createElement(vP,{onClickGuild:function(){return e.props.onClickGuild(t)},guild:t})}))}}]),t}(a.Component),bP=(a.Component,function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={requests:{}},n.fetchRequests(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"fetchRequests",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r,s,i,o;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.ethereum.guilds.getNewMemberRequests();case 2:t=e.sent,n={},e.t0=v.a.keys(t);case 5:if((e.t1=e.t0()).done){e.next=18;break}return a=e.t1.value,r=t[a].guildId,s=t[a].requester,e.next=11,this.props.ethereum.users.getUserName(s);case 11:return i=e.sent,e.next=14,this.props.ethereum.guilds.getGuildName(r);case 14:o=e.sent,n[r]={guildName:o,userName:i,blockNumber:t[a].blockNumber},e.next=5;break;case 18:this.setState({requests:n});case 19:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"removeRequest",value:function(e){var t={};for(var n in this.state.requests)n!==e&&(t[n]=this.state.requests[n]);this.setState({requests:t})}},{key:"removeProposal",value:function(e){var t=Object(ge.a)(this.state.proposals);t.splice(e,1),this.setState({proposals:t})}},{key:"render",value:function(){var e=this;return 0===Object.keys(this.state.requests).length?r.a.createElement("div",null):r.a.createElement("div",{className:"link-requests"},r.a.createElement("div",{className:"requests-header"},"Actions to Take"),Object.keys(this.state.requests).map(function(t){return r.a.createElement(yP,{onAccept:function(n){return e.removeRequest(t)},onReject:function(n){return e.removeRequest(t)},ethereum:e.props.ethereum,guildId:t,guildName:e.state.requests[t].guildName,blockNumber:e.state.requests[t].blockNumber,userName:e.state.requests[t].userName})}))}}]),t}(a.Component)),yP=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={date:""},n.fetchDate(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"fetchDate",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.ethereum.web3.eth.getBlock(this.props.blockNumber);case 2:t=e.sent,n=new Date(1e3*t.timestamp).toLocaleString(),this.setState({date:n});case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"accept",value:function(){this.props.ethereum.guilds.acceptRequestToAddToGuild(this.props.guildId),this.props.onAccept()}},{key:"reject",value:function(){this.props.ethereum.guilds.rejectRequestToAddToGuild(this.props.guildId),this.props.onReject()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"new-member-request"},r.a.createElement("div",{className:"user-field"},r.a.createElement("a",{className:"user-hyperlink",href:"/user/"+this.props.userName},this.props.userName)),r.a.createElement("div",{className:"action-description"},"requested to add you to ",this.props.guildName),r.a.createElement("span",{className:"action-date"},this.state.date),r.a.createElement("div",{className:"action-btns"},r.a.createElement("div",{onClick:function(){return e.accept()},className:"common-button pink-button"},"ACCEPT"),r.a.createElement("div",{onClick:function(){return e.reject()},className:"common-button pink-button"},"REJECT")))}}]),t}(a.Component),kP=bP,EP=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(A.h,{className:"guild-name-input-group"},r.a.createElement(A.g,{onChange:function(t){return e.props.onNameChange(t.target.value)},value:this.props.name,placeholder:"Type name for guild",id:"guild-name-input"})),r.a.createElement("div",{className:"passphrase-label"},"Encrypted with passphrase"),r.a.createElement(A.h,{className:"guild-name-input-group"},r.a.createElement(A.g,{onChange:function(t){return e.props.onPassphraseChange(t.target.value)},value:this.props.passphrase,placeholder:"Type passphrase for guild",id:"passphrase-input"})))}}]),t}(a.Component),SP=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={editingGuild:void 0,editingName:!1,guilds:[],waitingForNewGuild:!1,creatingNewGuild:!1,name:"",passphrase:"",usersSelected:new Set},n.onNameChange=n.onNameChange.bind(Object(p.a)(n)),n.onPassphraseChange=n.onPassphraseChange.bind(Object(p.a)(n)),n.onClickGuild=n.onClickGuild.bind(Object(p.a)(n)),n.getGuilds(),R.a.guilds.newGuildCallback=function(){return n.getGuilds()},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){return e.userToken!==this.props.userToken&&this.getGuilds(),!0}},{key:"selectUser",value:function(e){this.state.usersSelected.has(e)?this.state.usersSelected.delete(e):this.state.usersSelected.add(e),this.setState(this.state)}},{key:"onNameChange",value:function(e){this.setState({name:e,editingName:!0})}},{key:"doneEditing",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.state.editingName&&this.state.editingGuild&&this.state.editingGuild.name!==this.state.name&&(this.state.editingGuild.name=this.state.name,R.a.guilds.setGuildName(this.state.editingGuild.guildId,this.state.name)),this.state.usersSelected.size>0&&(t=this.state.editingGuild.guildId,this.state.usersSelected.forEach(function(){var e=Object(g.a)(v.a.mark(function e(n){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.a.guilds.requestToAddMember(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())),this.setState({editingGuild:void 0,editingName:!1});case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onClickGuild",value:function(e){this.setState({name:"",editingGuild:e})}},{key:"onPassphraseChange",value:function(e){this.setState({passphrase:e})}},{key:"createNewGuild",value:function(e,t){R.a.guilds.newGuild(e,t),this.setState({waitingForNewGuild:!0})}},{key:"onClickNewGuild",value:function(e){e||this.createNewGuild(this.state.name,this.state.passphrase),this.setState({creatingNewGuild:e})}},{key:"getGuilds",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.a.guilds.getGuildsForUser();case 2:t=e.sent,e.t0=v.a.keys(t);case 4:if((e.t1=e.t0()).done){e.next=13;break}return n=e.t1.value,a=t[n],e.next=9,R.a.guilds.getUsersInGuild(a.guildId);case 9:r=e.sent,a.members=r,e.next=4;break;case 13:this.setState({waitingForNewGuild:!1,guilds:t});case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return this.state.editingGuild?r.a.createElement("div",{className:"content-view"},r.a.createElement("div",{className:"inner-content-view"},r.a.createElement(mP,{selectUser:function(t){return e.selectUser(t)},usersSelected:this.state.usersSelected,name:this.state.name,isEditingName:this.state.editingName,onNameChange:function(t){return e.onNameChange(t)},guild:this.state.editingGuild,onFinishEditing:function(){return e.onClickGuild(void 0)}})),r.a.createElement("div",{onClick:function(){return e.doneEditing()},className:"add-guilds-button"},r.a.createElement("div",{className:"button-text"},this.state.usersSelected.size>0?"Add Members to Guild":"Done"))):r.a.createElement("div",{className:"content-view"},r.a.createElement(sy,{show:this.props.showLogin}),r.a.createElement("div",{className:"inner-content-view"},r.a.createElement("div",{className:"sub-header"},r.a.createElement("div",null,this.state.creatingNewGuild?"Create New Guild":"Guilds")),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(O,{condition:this.state.waitingForNewGuild},r.a.createElement("div",{className:"creating-new-guild"},"Creating new guild"),r.a.createElement(V.a,{sizeUnit:"px",size:10,color:"#123abc",loading:this.state.waitingForNewGuild})),r.a.createElement(O,{condition:this.state.creatingNewGuild},r.a.createElement(EP,{onPassphraseChange:this.onPassphraseChange,onNameChange:this.onNameChange,passphrase:this.state.passphrase,name:this.state.name})),r.a.createElement(O,{condition:!this.state.creatingNewGuild},r.a.createElement(gP,{onClickGuild:function(t){return e.onClickGuild(t)},guilds:this.state.guilds}),r.a.createElement(kP,{ethereum:R.a}))),r.a.createElement("div",{onClick:function(){return e.onClickNewGuild(!e.state.creatingNewGuild)},className:"add-guilds-button"},r.a.createElement(O,{condition:this.state.creatingNewGuild},r.a.createElement("div",{className:"button-text"},"Done")),r.a.createElement(O,{condition:!this.state.creatingNewGuild},r.a.createElement("div",{className:"big-plus"},"+"),r.a.createElement("div",{className:"button-text"},"New Guild"))))}}]),t}(a.Component),OP=Object(y.b)(function(e){return{showLogin:e.sequencer.showLogin,userToken:e.sequencer.userToken}},null)(SP),wP=function(e){function t(e){var n;return Object(o.a)(this,t),n=Object(u.a)(this,Object(l.a)(t).call(this,e)),Ge.a.setStore(n.props.store),R.a.store=n.props.store,Ge.a.setEthereum(R.a),Ge.a.checkLogin(),R.a.guilds.initGuilds(),R.a.crypto.store=n.props.store,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"guilds-page"},r.a.createElement(my,{crypto:R.a.crypto,show:!0}),r.a.createElement(DC,{store:this.props.store}),r.a.createElement(OP,{store:this.props.store}))}}]),t}(a.Component),CP=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,"Track")}}]),t}(a.Component),PP=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,"Metamask is a Chrome plug-in that will let you save your work on Zequencer to Ethereum.",r.a.createElement("div",{className:"how-to-step"},"1. First install the ",r.a.createElement("a",{href:"https://chrome.google.com/webstore/detail/metamask/nkbihfbeogaeaoehlefnkodbefgpgknn"},"Metamask")," chrome plug-in."),r.a.createElement("div",{className:"how-to-step"},"2. Create a new account on your Metamask wallet, following the instructions ",r.a.createElement("a",{href:"https://blog.wetrust.io/how-to-install-and-use-metamask-7210720ca047"},"here"),"."),r.a.createElement("div",{className:"how-to-step"},'3. Click on the orange Metamask icon on the Chrome toolbar and switch the network from "Main Ethereum Network" to "Ropsten Test Network".'),r.a.createElement("div",{className:"how-to-step"},"4. Get some free Ether for your new account by going ",r.a.createElement("a",{href:"https://faucet.metamask.io/"},"here"),', and clicking "request 1 ether from faucet".'))}}]),t}(a.Component),TP=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={value:"",pendingChange:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"chooseUserName",value:function(){R.a.users.setUserName(this.state.value),this.props.onComplete(this.state.value)}},{key:"onKeyPress",value:function(e){}},{key:"render",value:function(){var e=this;return R.a.isMetamaskInstalled()?r.a.createElement("div",{onClick:function(e){return e.stopPropagation()}},r.a.createElement(A.h,{className:"tag-sound-input"},r.a.createElement(A.g,{onChange:function(t){e.state.value=t.target.value,e.setState(e.state)},value:this.state.value,onKeyUp:function(t){return e.onKeyPress(t)},placeholder:"Choose a user name",className:"user-name-input"}),r.a.createElement(A.i,{addonType:"append"},r.a.createElement(A.b,{size:"sm",onClick:function(){return e.chooseUserName()},color:"secondary"},"Done")))):r.a.createElement("div",null,"First install metamask.")}}]),t}(a.Component),jP=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={showingMetamask:!1,showingUserName:!1,showingTrack:!1,showingSample:!1},n.isUserNameChosen(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"toggleMetamask",value:function(){this.setState({showingMetamask:!this.state.showingMetamask})}},{key:"toggleUserName",value:function(){this.setState({showingUserName:!this.state.showingUserName})}},{key:"toggleTrack",value:function(){this.setState({showingTrack:!this.state.showingTrack})}},{key:"toggleSample",value:function(){this.setState({showingSample:!this.state.showingSample})}},{key:"getMetamaskHowTo",value:function(){return r.a.createElement(PP,null)}},{key:"getUserNameHowTo",value:function(){var e=this;return r.a.createElement(TP,{onComplete:function(t){return e.onCompleteUserName(t)}})}},{key:"getTrackHowTo",value:function(){return r.a.createElement(CP,null)}},{key:"getSampleHowTo",value:function(){return r.a.createElement("div",null,"Metamask")}},{key:"isMetamaskInstalled",value:function(){return R.a.isMetamaskInstalled()}},{key:"isUserNameChosen",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.a.users.getUserName();case 2:t=e.sent,this.setState({userName:t});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onCompleteUserName",value:function(e){console.log("on complete called = "+e),this.setState({userName:e})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"getting-started"},r.a.createElement(xP,{show:this.state.showingMetamask,toggle:function(){return e.toggleMetamask()},isCompleted:this.isMetamaskInstalled(),howTo:this.getMetamaskHowTo()},"Install Metamask to talk to Ethereum"),r.a.createElement(xP,Object(_e.a)({show:this.state.showingUserName,toggle:function(){return e.toggleUserName()},howTo:this.getUserNameHowTo(),isCompleted:void 0!==this.state.userName},"howTo",this.getUserNameHowTo()),this.state.userName?"Choose a username: "+this.state.userName:"Choose a username"),r.a.createElement(xP,{show:this.state.showingTrack,toggle:function(){return e.toggleTrack()},howTo:this.getTrackHowTo()},"Create your first track"),r.a.createElement(xP,{show:this.state.showingSound,toggle:function(){return e.toggleSound()},howTo:this.getSampleHowTo()},"Sample your first sound"))}}]),t}(a.Component),xP=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e="onboarding-step";return this.props.show&&(e+=" showing-how-to"),r.a.createElement("div",{onClick:this.props.toggle,className:e},r.a.createElement("div",{className:"step-checkmark"},r.a.createElement(O,{condition:this.props.isCompleted},r.a.createElement("span",{className:"checkmark"},r.a.createElement("div",{className:"checkmark_stem"}),r.a.createElement("div",{className:"checkmark_kick"})))),r.a.createElement("div",{className:"step-info"},r.a.createElement(O,{condition:!this.props.show},this.props.children),r.a.createElement(O,{condition:this.props.show},r.a.createElement("div",{className:"how-to"},this.props.howTo))))}}]),t}(a.Component),NP=jP,qP=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("div",{className:"mission"},"Zequencer is an advanced audio sequencer and effects-engine that runs right in your browser."),r.a.createElement("div",{className:"capabilities"},r.a.createElement("div",{className:"box"},r.a.createElement("div",{className:"info"},"Easily collect and annotate sounds."),r.a.createElement("div",{className:"info bottom"},"Track the origin of every sample.")),r.a.createElement("div",{className:"box"},r.a.createElement("div",{className:"info"},"Create and share songs for others to dub and remix."),r.a.createElement("div",{className:"info bottom"},"Make bangers with people around the ",r.a.createElement("a",{href:"/explore"},"world.")))),r.a.createElement("div",{className:"collective"},"Add to the collective knowledge of music makers, world-wide."),r.a.createElement("div",{className:"horizontal-divider"}),r.a.createElement("div",{className:"decentralized"},"Zequencer runs on the ",r.a.createElement("a",{href:"http://ethereum.org"},"Ethereum")," blockchain and ",r.a.createElement("a",{href:"https://ipfs.io/"},"IPFS")," to protect this living archive."),r.a.createElement("div",{className:"capabilities"},r.a.createElement("div",{className:"box"},r.a.createElement("div",{className:"info"},"Own your data."),r.a.createElement("div",{className:"info bottom"},"Create encrypted guilds for just your friends.")),r.a.createElement("div",{className:"box"},r.a.createElement("div",{className:"info"},"Compensate creators fairly and automatically."),r.a.createElement("div",{className:"info bottom"},"Sample ethically."))),r.a.createElement("div",{className:"capabilities"},r.a.createElement("div",{className:"box"},r.a.createElement("div",{className:"info"},"Run your own node to fortify the archive."))),r.a.createElement("div",{className:"try-it-now"},r.a.createElement("a",{href:"/create"},"Start Now")))}}]),t}(a.Component),MP="ABOUT",DP="HELP",AP=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"landing-navigator"},r.a.createElement(RP,{name:"About",selectedOption:this.props.selectedOption,option:MP,onClickOption:function(){return e.props.onClickOption(MP)}}),r.a.createElement(RP,{name:"Documentation",selectedOption:this.props.selectedOption,option:DP,onClickOption:function(){return e.props.onClickOption(DP)}}))}}]),t}(a.Component),RP=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t="option";return this.props.selectedOption===this.props.option&&(t+=" selected"),r.a.createElement("div",{onClick:function(){return e.props.onClickOption(e.props.option)},className:t},this.props.name)}}]),t}(a.Component),IP=AP,LP=new ol,FP=function(e){function t(e){var n;return Object(o.a)(this,t),n=Object(u.a)(this,Object(l.a)(t).call(this,e)),R.a.cache=LP,R.a.cache.loadIndex(),n.ethereumSearcher=new Pi(LP,n.props.sequencerEngine),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("p",null,"Zequencer contains a community-built sample library."),r.a.createElement("p",null,"To view it, ",r.a.createElement("b",null,"click")," the big + button at the top right of the sequencer page."),r.a.createElement("div",{className:"selector-container"},r.a.createElement(Vg,{ethereumSearcher:this.ethereumSearcher,sequencerEngine:this.props.sequencerEngine,onAudition:function(){return[]},onAddSound:function(){return[]}})),r.a.createElement("p",{className:"sub-header"},"Search"),r.a.createElement("p",null,"The search box lets you search for samples by name or tag. If there are multiple tags matching your search, click on the tag you want to filter by."),r.a.createElement("p",{className:"sub-header"},"Filters"),r.a.createElement("p",null,"Every sample contains metadata (such as tags), which helps you filter your search results."),r.a.createElement("p",null,"The little buttons below the search bar lets you filter by these different types of metadata."),r.a.createElement(wg,{getCountries:function(){return[]},getStyles:function(){return[]},onFiltersChanged:function(){return[]}}),r.a.createElement("p",null,"Clicking on the ",r.a.createElement("b",null,"tags")," button, for example, shows you all the tags. You can then click a combination of tags to search by."),r.a.createElement("p",{className:"sub-header"},"Types of Metadata"),r.a.createElement("p",null,r.a.createElement("b",null,"Tags")," are user-generated, however some metadata types come directly from the sample source."),r.a.createElement("p",null,r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("b",null,"Cover Art"),": Filter by the album where the sample was found."),r.a.createElement("li",null,r.a.createElement("b",null,"Year"),": Filter by the year of the sample."),r.a.createElement("li",null,r.a.createElement("b",null,"Style"),": Filter by the style/genre of the sample (determined from discogs.org)."),r.a.createElement("li",null,r.a.createElement("b",null,"Country"),": Filter by the country of the sample (determined from discogs.org). Note: this is often the country of the label, unfortunately."))),r.a.createElement("p",{className:"sub-header"},"Hierarchical Tags"),r.a.createElement("p",null,'Some of the most-used tags are organized by category. For example, clicking on "Drum Machines" shows you drum machine manufacturers.'),r.a.createElement("p",null,r.a.createElement(Zv,{getTags:function(){return[]},onFiltersChanged:function(){return[]}})),r.a.createElement("p",{className:"sub-header"},"Search Results"),r.a.createElement("p",null,"As you change the filters, matching sounds will appear in the search results."),r.a.createElement("p",null,"Click and hold the waveform to hear the sample."),r.a.createElement("p",null,"To ",r.a.createElement("b",null,"add a sound to your project"),", click the thumbnail or the",r.a.createElement("b",null,"+")," button."),r.a.createElement("p",null,"To ",r.a.createElement("b",null,"replace the sample in an existing track")," in your project, drag the thumbnail of the sound you want into the track you want to replace."),r.a.createElement("p",null,r.a.createElement("b",null,"Drag")," a selecton of the sample and then add it to the project, to add just the selected region to your project."))}}]),t}(a.Component),VP=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"play",value:function(){this.props.sequencerEngine.play()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(oC,{disablePianoRoll:!0,disableTab:!0,alreadyLoaded:void 0!==this.props.sequencerEngine,scriptingInput:this.scriptingInput,hideLFOsTrack:!0,sequencerEngine:this.props.sequencerEngine,selectedTrack:this.props.sequencerEngine.cursor.track,stretchTracks:!1,history:this.props.history,onSelectTrack:function(t){return e.onSelectTrack(t)},keyboardEngine:this.keyboardEngine,focusScripting:function(){return e.focusScripting()},onAddSound:function(e,t,n,a){return[]},hideSequencer:!1}),r.a.createElement("div",{className:"play-container"},r.a.createElement(ae,{isPlaying:this.props.isPlaying,play:function(){return e.play()}}),r.a.createElement(tp,null)))}}]),t}(a.Component),BP=Object(y.b)(function(e,t){var n=t.sequencerEngine.getSequenceId();return{isPlaying:e.sequencer.isPlaying[n]||!1,resolution:e.sequencer.resolution}},void 0)(VP),UP=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"track-documentation"},r.a.createElement("p",null,"The track component is responsible for sequencing a sound or instrument. By default, 16 steps are shown, one for each 1/16th step in a bar."),r.a.createElement(BP,{sequencerEngine:this.props.sequencerEngine}),r.a.createElement("p",{className:"sub-header"},"Step Basics"),r.a.createElement("p",null,r.a.createElement("b",null,"Click")," on a step to toggle it on or off. Toggled steps are triggered by the sequencer, when the sequencer is playing."),r.a.createElement("p",null,r.a.createElement("b",null,"Command+Click")," or ",r.a.createElement("b",null,"Alt+Click")," a step to bring up parameters for that step. "),r.a.createElement("p",null,"The blinking step is called the ",r.a.createElement("b",null,"cursor"),". You can move it using arrow-keys."),r.a.createElement("p",null,"The ",r.a.createElement("b",null,"shift")," key hides the parameters at the ",r.a.createElement("b",null,"cursor"),". The ",r.a.createElement("b",null,"enter")," key toggles the step at the ",r.a.createElement("b",null,"cursor"),"."),r.a.createElement("p",null,"The ",r.a.createElement("b",null,"spacebar")," starts/stops the sequencer."),r.a.createElement("p",null,"The red line underneath the step indicates where in the sequence it is playing."),r.a.createElement("p",{className:"sub-header"},"Step Parameters"),r.a.createElement("p",null,"The step parameters you can control are the following:",r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("b",null,"Duration"),": the length of the trigger (unit is 1/16th notes)."),r.a.createElement("li",null,r.a.createElement("b",null,"Chop"),": How many times within the duration it will re-trigger."),r.a.createElement("li",null,r.a.createElement("b",null,"Velocity"),": Volume of the trigger."),r.a.createElement("li",null,r.a.createElement("b",null,"Transpose"),": The pitch of the trigger. Note that higher and lower transposes will trigger the sample faster and slower, respectively. Transpose 0 is C3."),r.a.createElement("li",null,r.a.createElement("b",null,"Slice"),": what slice in the sample to trigger."),r.a.createElement("li",null,r.a.createElement("b",null,"Panning"),": the stereo-panning from left-to-right to trigger at."))),r.a.createElement("p",{className:"sub-header"},"Changing Step Duration"),r.a.createElement("p",null,r.a.createElement("b",null,"Drag")," the right edge of a toggled step to alter it's duration."),r.a.createElement("p",null,"As you alter the duration, notice the change of color behind the steps. This visualizes the durations of the steps."),r.a.createElement("p",{className:"sub-header"},"Changing the Length of a Track"),r.a.createElement("p",null,"The red ",r.a.createElement("b",null,"+")," and ",r.a.createElement("b",null,"-")," buttons below the steps double and half the number of steps in the track, respectively."),r.a.createElement("p",{className:"sub-header"},"Moving, Copying and Pasting Steps"),r.a.createElement("p",null,"Select multiple steps by by dragging through the steps you wish to select. Once steps are selected you can:",r.a.createElement("ul",null,r.a.createElement("li",null,"Move them around."),r.a.createElement("li",null,"Copy and paste them (via ",r.a.createElement("b",null,"CMD+c")," and ",r.a.createElement("b",null,"CMD+v"),")"),r.a.createElement("li",null,"Delete them (via the ",r.a.createElement("b",null,"delete")," key)"))),r.a.createElement("p",null,"Move a single step by simply ",r.a.createElement("b",null,"dragging")," it."),r.a.createElement("p",null,r.a.createElement("b",null,"Command+A")," or ",r.a.createElement("b",null,"Alt+A")," selects every step on the selected track."))}}]),t}(a.Component),HP=Object(y.b)(function(e,t){return{}},void 0)(UP),JP=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={selectedSlice:0},void 0!==n.props.sequencerEngine.subSequences[1]&&n.props.sequencerEngine.switchToSubSequence(n.props.sequencerEngine.subSequences[1].id),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentWillUnmount",value:function(){this.props.sequencerEngine.switchToSubSequence(this.props.sequencerEngine.subSequences[0].id)}},{key:"onSelectSlice",value:function(e){this.setState({selectedSlice:e})}},{key:"render",value:function(){var e=this,t=this.props.sequencerEngine.tracks[0],n=t.sample,a=t.getSamplers()[0],s=void 0===a||void 0===a.baseBuffer?void 0:a.baseBuffer.get();return r.a.createElement("div",null,r.a.createElement("p",null,"Click on the thumbnail of a track to go to the  ",r.a.createElement("b",null,"details view")," for the track."),r.a.createElement("p",null,"The Track Details View lets you alter the waveform of your sample and change the track-wide parameters."),void 0===s?"":r.a.createElement(Dd,{track:t,div:document.getElementsByClassName("doc-viewer")[0],fullWidth:!1,selectedSlice:this.state.selectedSlice,slices:a.slices,isReversed:a.isReversed(),sampler:a,decentralized:!0,width:500,soundId:n.getId(),onKeyDown:function(){return[]},onSelectSlice:function(t){return e.onSelectSlice(t)},buffer:s}),r.a.createElement("p",{className:"sub-header"},"Slicing"),r.a.createElement("p",null,"A sample can be broken apart into different slices, each with differen start and end times."),r.a.createElement("p",null,"The ",r.a.createElement("b",null,"start/end times")," of a slice are represented by pairs of flags. Drag the flags to change their positions."),r.a.createElement("p",null,"You can ",r.a.createElement("b",null,"create a new slice")," by highlighting a region within the waveform and then clicking the \u201cAdd Slice\u201d button."),r.a.createElement("p",null,"You can ",r.a.createElement("b",null,"keyboard map")," each slice to a key on your keyboard by pressing the key. Once mapped, pressing the key will trigger that slice."),r.a.createElement("p",{className:"sub-header"},"Onsets"),r.a.createElement("p",null,r.a.createElement("b",null,"Onsets"),' can be thought as "hits" or "transients" within sample-- high energy, often percussive, events. You can view all onsets by clicking the "Select Onsets" button.'),r.a.createElement("p",null,'When the onsets are shown, you can select as many onsets you want and then click "Add Slices" to create slices out of the selected onsets.'),r.a.createElement("p",null,"You can use the ",r.a.createElement("b",null,"Onset Threshold")," slider to adjust the threshold of loudness for considering an onset."),r.a.createElement("p",{className:"sub-header"},"Zooming In/Out"),r.a.createElement("p",null,"The waveform viewer supports zooming gentures (like pinching in and out) to zoom into the waveform."),r.a.createElement("p",{className:"sub-header"},"Tempo and Warp"),r.a.createElement("p",null,"The tempo calculated for the sample is shown in red next to the Warp button. When you click \u201cWarp\u201d, the sample will be stretched to match that tempo."),r.a.createElement("p",{className:"sub-header"},"Gated/Ungated"),r.a.createElement("p",null,"A ",r.a.createElement("b",null,"gated")," sample will only trigger for as long as the duration of the trigger. An ",r.a.createElement("b",null,"ungated")," sample will stay playing once triggered, until it is triggered again."),r.a.createElement("p",{className:"sub-header"},"Parameters"),r.a.createElement("p",null,"You can set the default parameter values for a track by using the sliders. Note that these default values will get overridden when you set a value for a specific step in the step-sequencer."),r.a.createElement("p",{className:"sub-header"},"Key-Mapping Slices"),r.a.createElement("p",null,"The key-mappings of sample slices are shown in the keyboard diagram on the page. Click on a specific key icon to unmap the key from a slice."))}}]),t}(a.Component),GP=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("p",null,"The ",r.a.createElement("b",null,"Play"),", ",r.a.createElement("b",null,"Record"),", ",r.a.createElement("b",null,"Roll")," and ",r.a.createElement("b",null,"Quantized")," buttons are at the bottom of the sequencer."),r.a.createElement(_l,{sequencerEngine:this.props.sequencerEngine}),r.a.createElement("p",null,r.a.createElement("b",null,"Play"),": Play/stop the track.",r.a.createElement("ul",null,r.a.createElement("li",null,"Keyboard Shortcut: ",r.a.createElement("b",null,"spacebar")))),r.a.createElement("p",null,r.a.createElement("b",null,"Record"),": When recording, any triggers you make via your computer-keyboard or MIDI interface will be recorded into the current pattern.",r.a.createElement("ul",null,r.a.createElement("li",null,"Keyboard Shortcut: ",r.a.createElement("b",null,". (period)")))),r.a.createElement("p",null,r.a.createElement("b",null,"Roll"),": When rolling, any triggers you make via your computer-keyboard or midi-interface get triggered at a constant rate, following the ",r.a.createElement("b",null,"resolution")," of the sequencer.",r.a.createElement("ul",null,r.a.createElement("li",null,"Keyboard Shortcut: ",r.a.createElement("b",null,"' (single forward quote)")))),r.a.createElement("p",null,r.a.createElement("b",null,"Quantized"),": When quantized, any triggers recorded are snapped to the grid, at the ",r.a.createElement("b",null,"resolution")," of the sequencer. When unquantized, the triggers get recorded exactly as played."))}}]),t}(a.Component),zP=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.sequencerEngine.store.dispatch(Object(w.Cd)(0,!0))}},{key:"componentWillUnmount",value:function(){this.props.sequencerEngine.store.dispatch(Object(w.Cd)(0,!1))}},{key:"render",value:function(){var e=this.props.sequencerEngine.tracks[0];return r.a.createElement("div",null,r.a.createElement("p",null,"You can view the effects of a track by clicking the red FX button at the top right of a track component."),r.a.createElement(BP,{sequencerEngine:this.props.sequencerEngine}),r.a.createElement("p",null,"By default, 2 disabled effects are added to every track: Delay and Filter. To ",r.a.createElement("b",null,"enable an effect"),", click on the top-left-most icon in the disabled effect box."),r.a.createElement("p",null,"To ",r.a.createElement("b",null,"add a new effect"),", click on the large blue plus-sign at the right of the current effects chain. This will bring up a box with 3 dropdowns, with 3 different types of effects."),r.a.createElement("p",{className:"sub-header"},"Audio Effects"),r.a.createElement("p",null,"Your standard effects, like reverb, filters, distortion etc."),r.a.createElement("p",{className:"sub-header"},"MIDI Effects"),r.a.createElement("p",null,"Effects that alter the actual trigger data, as opposed to the audio signal."),r.a.createElement("p",{className:"sub-header"},"Live Effects"),r.a.createElement("p",null,r.a.createElement("b",null,"Roll Effects"),": Can set the roll effect to SYNC/OFF/ON. When OFF, roll triggers are ignored. When ON, the track acts as if it\u2019s always rolling. When Synced, it only rolls when you roll."),r.a.createElement("p",{className:"sub-header"},"Audio Effects Chains"),r.a.createElement("p",null,"You can create parallel Audio Effects chains by clicking on the smaller + button in the box below the larger plus-button used to add effects."),r.a.createElement(Nh,{track:e}),r.a.createElement("p",null,"You can then view different effects chains by clicking on the numbers in that box."))}}]),t}(a.Component),_P=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("p",null,"Tracks can be broken apart into different patterns, shown in the ",r.a.createElement("b",null,"patterns component"),", in the top toolbar."),r.a.createElement("p",null,"Each pattern can have different inputed steps, volumes and panning for the tracks."),r.a.createElement(Cy,{sequencerEngine:this.props.sequencerEngine}),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement("p",null,"Patterns are represented by numbers, shown in the ",r.a.createElement("b",null,"patterns component"),". The initial pattern in a project is named ",r.a.createElement("b",null,"1"),"."),r.a.createElement("p",{className:"sub-header"},"Pattern Copy"),r.a.createElement("p",null,"To copy the current pattern into a new pattern, simply click the ",r.a.createElement("b",null,"+ button")," in the pattern component."),r.a.createElement("p",{className:"sub-header"},"Pattern Delete"),r.a.createElement("p",null,"To delete a pattern, click the ",r.a.createElement("b",null,"- button"),"."),r.a.createElement("p",{className:"sub-header"},"Pattern Switching"),r.a.createElement("p",null,"Click the desired pattern number to switch to it."),r.a.createElement("p",null,r.a.createElement("b",null,"Keyboard Shortcuts"),r.a.createElement("ul",null,r.a.createElement("li",null,"Typing a number switches to that pattern (unless you are in roll mode)."),r.a.createElement("li",null,"Pressing the ",r.a.createElement("b",null,"= key")," goes to the next pattern and the ",r.a.createElement("b",null,"- key")," goes to the previous pattern."))),r.a.createElement("p",{className:"sub-header"},"Pattern Ordering"),r.a.createElement("p",null,"You change the ordering of your patterns by ",r.a.createElement("b",null,"dragging")," them."))}}]),t}(a.Component),WP=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).filterEffect&&n.filterEffect.enable(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.filterEffect&&this.filterEffect.enable()}},{key:"componentWillUnmount",value:function(){this.filterEffect&&this.filterEffect.enable(!1)}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("p",null,"Every parameter in Zequencer can be set to a modulator. There are 2 types of modulators: LFOs and Envelopes."),r.a.createElement("p",null,"Each sub-sequence has 4 dedicated LFOs and 4 dedicated Envelopes. They are shown at the top of the sequencer view.",r.a.createElement(aw,{sequencerEngine:this.props.sequencerEngine,envelopesTrack:this.props.sequencerEngine.envelopesTrack,lfosTrack:this.props.sequencerEngine.lfosTrack})),r.a.createElement("p",null,"To connect a parameter to a modulator, click on the parameter name. This will bring up 4 square icons followed by 4 circle icons, each with their own color (representing which individual modulator it is). Click an icon to connect the parameter to that modulator.",this.effectComponent),r.a.createElement("p",{className:"sub-header"},"LFO"),r.a.createElement("p",null,"An LFO cycles between a minimum and maximum value at a given rate, following a waveform. The rate can be set using rate dropdown. You can set the rate to be unsynced by unchecking the \u201cSynced\u201d checkbox."),r.a.createElement("p",null,"Example: Take a filter effect, and set the cutoff frequency to be modulated by LFO 1. Once connected, change the minimum and maximum values of LFO 1 and notice the change. Then change the rate."),r.a.createElement("p",{className:"sub-header"},"Envelope"),r.a.createElement("p",null,"An envelope can be set to be triggered by a specific track. The dropdown at the top right of the envelope box selects which track triggers the envelope. Once set, every time a track triggers, the envelope will be triggered."),r.a.createElement("p",null,"There are 2 options for when to trigger an envelope.",r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("b",null,"Pre-FX")," will trigger the envelope before any midi-effects are applied. So if you have an Arpeggiator as a midi effect, and have Pre-FX set, it will only trigger the envelope when the original trigger is hit, instead of triggering for every arpeggiator hit."),r.a.createElement("li",null,r.a.createElement("b",null,"Post-FX")," will trigger the envelope after all midi-effects have been applied. So if you have an Arpeggiator, it will trigger every time the arpeggiator hits."))),r.a.createElement("p",null,"An envelope has 4 well-known parameters:",r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("b",null,"Attack"),": How long it takes for the envelope to go from the min-value of the parameter\u2019s modulation to the max-value."),r.a.createElement("li",null,r.a.createElement("b",null,"Decay"),": How long it takes for the envelope to go from the max value of that parameter\u2019s modulation to the sustain-value."),r.a.createElement("li",null,r.a.createElement("b",null,"Sustain"),": Controls what value the parameter should remain at, after the attack and decay stages of the envelope have completed. The value is determined in relation to the min and max of the parameter."),r.a.createElement("li",null,r.a.createElement("b",null,"Release"),": Controls how long it takes for the parameter value to return to its original value once the trigger is released."))),r.a.createElement("p",{className:"sub-header"},"Parameter Min/Max"),r.a.createElement("p",null,"Once a parameter is connected to a modulator, you may want to define the min and max values for the  modulation."),r.a.createElement("p",null,"For example, if you set the filter cutoff frequency to be controlled by an LFO, you may want to define what the min and max frequencies are. You can do this by going to the ",r.a.createElement("b",null,"Mods")," view of an effect. You can access the ",r.a.createElement("b",null,"Mods")," view by clicking the ",r.a.createElement("b",null,"Mods")," button at the top right of an effect, next to the delete button."),r.a.createElement("p",null,"Note that a parameter needs to be connected to a modulator in order to appear here.",this.effectComponent))}},{key:"track",get:function(){return this.props.sequencerEngine.tracks[0]}},{key:"filterEffect",get:function(){if(this.track)return this.track.effectsChains[0].effects[1]}},{key:"effectComponent",get:function(){return void 0===this.filterEffect?r.a.createElement("div",null):r.a.createElement("div",{className:"demo-effect-container"},r.a.createElement(mp,{onDeleteEffect:function(){return[]},effectNumber:1,onToggle:function(){return[]},track:this.track,group:void 0,send:void 0,effect:this.filterEffect,automation:void 0},r.a.createElement(Af,{effectNumber:1,sequencerEngine:this.props.sequencerEngine,automation:void 0,selectedParameter:void 0,onEffectsChange:function(){return[]},onParameterChanged:function(){return[]},filterEffect:this.filterEffect})))}}]),t}(a.Component),KP=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("p",null,"Tracks can be further organized via sub-sequences. Sub-sequences divide a project by tracks."),r.a.createElement("p",null,"To the right of the pattern buttons is a box containing the letter A and plus and minus buttons.",r.a.createElement("div",null,r.a.createElement(jy,{sequencerEngine:this.props.sequencerEngine})),r.a.createElement("div",{className:"clear-fix"})),r.a.createElement("p",null,"Sub-sequences are named by letters, starting with A (the first one)."),r.a.createElement("p",null,"You can create new sub-sequences by pressing the plus-button. You can switch to sub-sequences by clicking on the letter."),r.a.createElement("p",null,"Each sub-sequence has their own set of independent LFOs and Envelopes that can be modified without affecting the other sub-sequences. Think of sub-sequences as parallel projects that are played together."),r.a.createElement("p",null,"If you load another project, while working on another project, the new project will be loaded as its own sub-sequence. This prevents the new sub-sequence from interfering with any modulators you\u2019ve already set."))}}]),t}(a.Component),YP=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("p",null,"Zequencer has a piano roll for editing a track's melodies. Click on the piano roll button to view it:",r.a.createElement("div",null,r.a.createElement("img",{className:"piano-roll-button",src:"/piano-icon.png"}))),r.a.createElement("p",null,"The piano roll looks like this:",this.pianoRollComponent),r.a.createElement("p",{className:"sub-header"},"Steps"),r.a.createElement("p",null,r.a.createElement("ul",null,r.a.createElement("li",null,"Click on a step to toggle a note."),r.a.createElement("li",null,"Hover over the right-edge of a step and drag to change the duration of a particular step."),r.a.createElement("li",null,"Drag an area to select steps"),r.a.createElement("li",null,'Type the "delete" key to delete selected steps'))),r.a.createElement("p",{className:"sub-header"},"Scolling"),r.a.createElement("p",null,"The piano roll shows 32 steps at a time. If your track has more than 32 steps then a pagination button appears. To go to the next 32 steps, click the ",r.a.createElement("b",null,"Next")," button. To go to the previous 32 steps, click the ",r.a.createElement("b",null,"Previous")," button."),r.a.createElement("p",null,"The bar to the left of the piano roll allows you to scroll up and down the piano roll."),r.a.createElement("p",{className:"sub-header"},"Zooming In/Out"),r.a.createElement("p",null,"Trackpad gestures are supported for zooming in and out, along with dragging the mouse horizontally on the left bar of the piano roll."))}},{key:"track",get:function(){return this.props.sequencerEngine.tracks[0]}},{key:"pianoRollComponent",get:function(){return this.track?r.a.createElement(VE,{hideToolbar:!0,track:this.props.sequencerEngine.tracks[0],sequencerEngine:this.props.sequencerEngine}):r.a.createElement("div",null)}}]),t}(a.Component),QP=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("p",null,"You can save a track's sample, parameters, and effects chains all as a preset-- without any of the step triggers saved. This lets you reuse a track's settings in future projects."),r.a.createElement("p",null,"To save a new preset:",r.a.createElement("ol",null,r.a.createElement("li",null,"Right-click on the track you wish to save as a preset, and from the dropdown menu, press \u201cSave Preset\u201d."),r.a.createElement("li",null,"A pop-up will be shown, where you type the name of your preset."),r.a.createElement("li",null,"You can choose whether to just save the effects, or to save the sample/instrument as well."),r.a.createElement("li",null,"Hit save."))),r.a.createElement("p",{className:"sub-header"},"Loading Presets"),r.a.createElement("p",null,"You can view presets by going to the ",r.a.createElement("b",null,"Presets")," tab on the sidebar.",r.a.createElement("div",{className:"presets-demo-container"},r.a.createElement(Ab,{sequencerEngine:this.props.sequencerEngine}))),r.a.createElement("p",null,"Click on the name of a preset to add it to your project."),r.a.createElement("p",null,"A pop-up will appear asking whether you want to load the presets LFOs and Envelopes into your project. If so, this will replace the project's current LFO and Envelopes."),r.a.createElement("p",{className:"sub-header"},"Folders"),r.a.createElement("p",null,"You can move presets to folders by clicking the dropdown on the + button on the preset, and press \u201cMove to Folder\u201d."),r.a.createElement("p",null,"The pop-up that opens will let you choose which folder to move the preset to. Once you\u2019ve moved some presets, remember to hit \u201cSAVE Changes\u201d."),r.a.createElement("p",null,"The folders are what appear in the sidebar when you first load the sequencer."))}}]),t}(a.Component),XP=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("p",null,"There are 4 instruments you can currently use. Click on the instruments tab on the sidebar to view them"),r.a.createElement("p",{className:"sub-header"},"Synth"),r.a.createElement("p",null,"A synth with one oscillator, 1 filter and pitch/amplitude envelopes."),r.a.createElement("p",{className:"sub-header"},"Multi Oscillator Synth"),r.a.createElement("p",null,"A more advanced synth with 4 oscillators that can be enabled/disabled."),r.a.createElement("p",{className:"sub-header"},"FM Synth"),r.a.createElement("p",null,"A simple FM synth with one modulating oscillator. The main parameters that change the timbre are ",r.a.createElement("b",null,"Modulation Index")," and ",r.a.createElement("b",null,"Harmonicity"),"."),r.a.createElement("p",{className:"sub-header"},"External Instrument"),r.a.createElement("p",null,"A track that can send MIDI to external MIDI devices, such as hardware synths or other soft synths on your computer (via MIDI)."))}}]),t}(a.Component),ZP=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("p",null,"By default, parameters remain the same between patterns. However, locking a pattern allows you to set different parameters, specific to that pattern-- without affecting other patterns."),r.a.createElement("p",null,'To lock a pattern, in a track, click the "lock" button, which looks like this.'),r.a.createElement("div",null,r.a.createElement("img",{className:"lock-button",src:"/closed-padlock.png"})),r.a.createElement("p",null,"For example, if you are on pattern 5, and wish to have a different Filter Cutoff Frequency than the other patterns, lock the pattern and then change the cutoff frequency."),r.a.createElement("p",null,"LFOs and Envelopes can also be pattern locked, using the same process."))}}]),t}(a.Component),$P=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).props.sequencerEngine.subSequences.length>1&&n.props.sequencerEngine.switchToSubSequence(n.props.sequencerEngine.subSequences[1].id),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentWillUnmount",value:function(){this.props.sequencerEngine.switchToSubSequence(this.props.sequencerEngine.subSequences[0].id)}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("p",null,"Go to the ",r.a.createElement("b",null,"Mixer View")," by clicking on the views dropdown at the top right of the page, and selecting \u201cMixer\u201d."),r.a.createElement("p",null,"The ",r.a.createElement("b",null,"Mixer View")," lets you see your track without any triggers, only faders and effects. This is desirable when mixing a track out, or jamming live."),r.a.createElement("p",null,"Similar tracks are automatically grouped together by tags they have in common. You can change the groups by dragging the individual tracks to other groups, or into a new group.",r.a.createElement(Dw,{sequencerEngine:this.props.sequencerEngine})),r.a.createElement("p",null,"You can apply effects to a group by selecting a group and adding effects at the bottom effects pane."),r.a.createElement("p",null,r.a.createElement("b",null,"Keyboard shortcut"),': "Tab" switches between ',r.a.createElement("b",null,"Mixer View")," and ",r.a.createElement("b",null,"Sequencer View"),"."))}}]),t}(a.Component),eT=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("p",null,"Go to the ",r.a.createElement("b",null,"Arrangement View")," by clicking on the views dropdown at the top right of the page, and selecting \u201cArranger\u201d."),r.a.createElement("p",null,"You can arrange your patterns into a complete arrangement here. You can drag patterns from the pattern boxes at the top toolbar into the arrangement timeline. You can then drag the start and end points of each pattern to where you want the pattern changes to occur."),r.a.createElement("p",null,"Furthermore, you can record a mix and have the arrangement be automatically recorded. You can do this by clicking on the circle button, to the right of the play button at the top toolbar.",r.a.createElement("div",null,r.a.createElement(Vy,{sequencerEngine:this.props.sequencerEngine})),r.a.createElement("div",{className:"clear-fix"})),r.a.createElement("p",null,"Note, this is different from the \u201cRecord\u201d button at the bottom of the sequencer screen (that is only concerned with recording triggers into a given pattern)."))}}]),t}(a.Component),tT=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("p",null,"To configure MIDI devices, go to the ",r.a.createElement("b",null,"Preferences View")," by clicking the view dropdown at the top right of the screen and selecting \u201cPreferences\u201d."),r.a.createElement("p",{className:"sub-header"},"Inputs"),r.a.createElement("p",null,"Each MIDI device connected shows up under inputs, with the following options:",r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("b",null,"Track"),": Controls whether a MIDI interface can trigger tracks."),r.a.createElement("li",null,r.a.createElement("b",null,"Sync"),": Controls whether a MIDI interface can sync the timing. For example, if you press PLAY on a drum machine with SYNC enabled, the sequencer would then play."),r.a.createElement("li",null,r.a.createElement("b",null,"Keys"),": Controls whether a MIDI interface is a keyboard."),r.a.createElement("li",null,r.a.createElement("b",null,"Pads"),": Controls whether a MIDI interface is a drum pad."))),r.a.createElement("p",{className:"sub-header"},"Outputs"),r.a.createElement("p",null,"Each MIDI device connected shows up under outputs, with the following options:",r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("b",null,"Track"),": Controls whether you can send triggers to a MIDI device."),r.a.createElement("li",null,r.a.createElement("b",null,"Synced"),": Controls whether you can send timing data to a MIDI device, including PLAY/STOP events."))))}}]),t}(a.Component),nT=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("p",null,"Freezing a track effectively resamples the track, along with any effects. This frees up your CPU, which is useful for tracks with complex effects chains. It freezes based on the current pattern."),r.a.createElement("p",{className:"sub-header"},"Freeze a Track"),r.a.createElement("p",null,'To freeze a track, right click the track and select "Freeze". Once frozen, the steps will be replaced by a box with a play button. You can play/pause the resulting frozen track.'),r.a.createElement("p",{className:"sub-header"},"Unfreeze a Track"),r.a.createElement("p",null,'You can unfreeze a track to go back to the original track. To do this, right-click a frozen track and select "Unfreeze".'),r.a.createElement("p",null,"After freezing a track, a new sample is created. The next time you save a track, an additional ",r.a.createElement("b",null,"Metamask")," pop-up will surface, asking you to confirm the transaction uploading this new frozen sample."))}}]),t}(a.Component),aT=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("p",null,"Transcribing a sample analyzes it and reads the notes information for that sample. It then creates a new ",r.a.createElement("b",null,"External Instrument")," track with  the notes from that sample."),r.a.createElement("p",null,"To transcribe a sample, go to the ",r.a.createElement("b",null,"Piano Roll")," for that track, and then click the ",r.a.createElement("b",null,"Transcribe")," button."),r.a.createElement("p",null,"Zequencer uses a machine-learing algorithm developed by Google's ",r.a.createElement("a",{href:"https://magenta.tensorflow.org/"},"Magenta team")," to transcribe samples. You can read about it ",r.a.createElement("a",{href:"https://magenta.tensorflow.org/onsets-frame"},"here"),"."))}}]),t}(a.Component),rT=(a.Component,a.Component,function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getYoutubeThumbnail",value:function(){return"https://img.youtube.com/vi/"+this.props.result.videoId+"/1.jpg"}},{key:"render",value:function(){return r.a.createElement("div",{onClick:this.props.onClick,className:"youtube-result"},r.a.createElement("img",{className:"youtube-result-thumbnail",src:this.getYoutubeThumbnail()}),r.a.createElement("div",{className:"youtube-result-title"},this.props.result.title))}}]),t}(a.Component)),sT=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onKeyPress",value:function(e){"Enter"===e.key&&this.props.onSearch()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(A.h,null,r.a.createElement(A.g,{onChange:function(t){return e.props.onChange(t.target.value)},value:this.props.searchTerms,onKeyPress:function(t){return e.onKeyPress(t)},id:"search-input",placeholder:this.props.placeHolder,className:"tag-input"}),r.a.createElement(A.i,{addonType:"append"},r.a.createElement(A.b,{onClick:function(){return e.props.onSearch()},color:"secondary"},"Search"))))}}]),t}(a.Component),iT="AIzaSyCf2k8RM7tFFlVGo4CVPvCsOhx86vWwTT0";function oT(e){return new Promise(function(){var t=Object(g.a)(v.a.mark(function t(n,a){var r;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f.a.get("https://www.googleapis.com/youtube/v3/videos?id="+e+"&key="+iT+"&fields=items(snippet(title))&part=snippet");case 2:void 0!==(r=t.sent).data.items[0]?n(r.data.items[0].snippet.title):n("Title not found");case 4:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}var cT="YOUTUBE",uT=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={searchResults:[],mode:cT,nextPageToken:null,prevPageToken:null,next:!1,previous:!1,relatedMode:!1,labelMode:!1,inspirationalWords:[]},n.addListeners(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){""!==this.props.searchTerms&&this.searchYoutube()}},{key:"searchYoutube",value:function(e){var t=this,n="";void 0!==e?n="&pageToken="+e:(this.state.nextPageToken=null,this.state.prevPageToken=null),this.state.relatedMode=!1,f.a.get("https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&key=AIzaSyCf2k8RM7tFFlVGo4CVPvCsOhx86vWwTT0&maxResults=8&q="+this.props.searchTerms+n).then(function(e){"nextPageToken"in e.data&&(t.state.nextPageToken=e.data.nextPageToken),"prevPageToken"in e.data&&(t.state.prevPageToken=e.data.prevPageToken);var n=e.data.items.map(function(e){return new lT(e.id.videoId,e.snippet.title)});t.state.searchResults=n,t.setState(t.state)})}},{key:"clearResults",value:function(){this.state.nextPageToken=null,this.state.prevPageToken=null,this.props.setYoutubeSearchTerms(""),this.state.searchResults=[],this.setState(this.state)}},{key:"onKeyPress",value:function(e){"Enter"===e.key&&this.searchYoutube()}},{key:"addListeners",value:function(){var e=this;window.addEventListener("get_related_videos",function(){e.getRelatedResults()})}},{key:"getRelatedResults",value:function(e){var t=this;this.state.relatedMode=!0;var n="";void 0!==e?n="&pageToken="+e:(this.state.nextPageToken=null,this.state.prevPageToken=null),f.a.get("https://www.googleapis.com/youtube/v3/search?part=snippet&relatedToVideoId="+this.props.videoId+"&type=video&key=AIzaSyCf2k8RM7tFFlVGo4CVPvCsOhx86vWwTT0&maxResults=8"+n).then(function(e){"nextPageToken"in e.data&&(t.state.nextPageToken=e.data.nextPageToken),"prevPageToken"in e.data&&(t.state.prevPageToken=e.data.prevPageToken);var n=e.data.items.map(function(e){return new lT(e.id.videoId,e.snippet.title)});t.state.searchResults=n,t.setState(t.state)})}},{key:"onClickInspired",value:function(){var e=this.ethereumCache.index.TAG.TAG,t=e[Math.floor(Math.random()*e.length)];this.setState({inspirationalWords:t.values})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"youtube-search-container"},r.a.createElement(sT,{placeHolder:"Search youtube",onChange:this.props.setYoutubeSearchTerms,searchTerms:this.props.searchTerms,onSearch:function(){return e.searchYoutube()}}),r.a.createElement("div",{className:"pagination-pane"},this.state.prevPageToken?r.a.createElement("div",{onClick:function(){e.state.relatedMode?e.getRelatedResults(e.state.prevPageToken):e.searchYoutube(e.state.prevPageToken)},className:"field-pagination-button"},"Previous"):"",this.state.nextPageToken?r.a.createElement("div",{onClick:function(){e.state.relatedMode?e.getRelatedResults(e.state.nextPageToken):e.searchYoutube(e.state.nextPageToken)},className:"field-pagination-button"},"Next"):"",r.a.createElement("div",{onClick:function(){return e.clearResults()},className:"field-pagination-button"},"Clear")),this.state.searchResults.map(function(t){return r.a.createElement(rT,{onClick:function(){return e.props.onClickResult(t)},result:t})}))}}]),t}(a.Component),lT=function e(t,n){Object(o.a)(this,e),this.videoId=t,this.title=n},pT=Object(y.b)(function(e){return{searchTerms:e.discover.youtubeSearchTerms}},function(e){return{setYoutubeSearchTerms:function(t){return e(Object(w.Ce)(t))}}})(uT),hT=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"record-labels"},r.a.createElement("div",{className:"record-labels-subheader"},"Record Labels"),0==this.props.labels.length?"No labels found...":"",this.props.labels.map(function(t){return r.a.createElement(dT,{label:t,onClick:function(){return e.props.onClickLabel(t.id)}}," ")}))}}]),t}(a.Component),dT=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{onClick:this.props.onClick,className:"youtube-result discogs-result"},r.a.createElement("div",{className:"floating-thumbnail"},r.a.createElement("img",{className:"youtube-result-thumbnail",src:this.props.label.thumbnail})),r.a.createElement("div",{className:"youtube-result-title"},this.props.label.name))}}]),t}(a.Component),fT=hT,mT=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={videoId:n.props.videoId,name:""},n.updateName(n.props.videoId),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickBuy",value:function(){window.open("https://www.discogs.com/sell/release/"+this.props.release.id,"_blank")}},{key:"shouldComponentUpdate",value:function(e){return e.videoId!==this.state.videoId&&this.updateName(e.videoId),this.state.videoId=e.videoId,!0}},{key:"updateName",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oT(t);case 2:n=e.sent,this.setState({name:n});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getYoutubeThumbnail",value:function(){return"https://img.youtube.com/vi/"+this.props.videoId+"/1.jpg"}},{key:"onClickVideo",value:function(){this.props.loadVideo({videoId:this.props.videoId})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"youtube-discogs-container"},r.a.createElement("img",{onClick:function(){return e.onClickVideo()},className:"youtube-thumbnail",src:this.getYoutubeThumbnail()}),r.a.createElement("div",{className:"discogs-youtube-name"},this.state.name),r.a.createElement(O,{condition:void 0!==this.props.release},r.a.createElement("div",{onClick:function(t){return e.onClickBuy(t)},className:"discogs-result-url"},"Buy Vinyl")))}}]),t}(a.Component),vT=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t="";return this.props.result===this.props.selectedRecord&&(t="selected-record"),r.a.createElement("div",{onClick:function(){return e.props.setSelectedRecord(e.props.result)},className:"discogs-result record"},r.a.createElement("img",{id:t,className:"discogs-thumbnail",src:this.props.result.thumb}),r.a.createElement("div",{className:"record-info"},r.a.createElement("div",{className:"title"},this.props.result.title),r.a.createElement("div",{className:"year"},this.props.result.year),r.a.createElement("div",{className:"styles"},this.props.result.style.map(function(e){return r.a.createElement(A.a,null," ",e," ")}))))}}]),t}(a.Component),gT=Object(y.b)(function(e){return{selectedRecord:e.discover.selectedRecord}},function(e){return{setSelectedRecord:function(t){return e(Object(w.Uc)(t))}}})(vT),bT=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getYoutubeThumbnail",value:function(){return"https://img.youtube.com/vi/"+this.props.videoId+"/1.jpg"}},{key:"render",value:function(){var e=this.props.selectedLabel;return void 0===e?r.a.createElement("div",null):r.a.createElement("div",{className:"youtube-discogs-container"},r.a.createElement("img",{className:"youtube-thumbnail",src:e.thumbnail}),r.a.createElement("div",{className:"discogs-youtube-name"},e.name))}}]),t}(a.Component),yT=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickBuy",value:function(e){return e.stopPropagation(),window.open("https://www.discogs.com/sell/release/"+this.props.release.id,"_blank"),!1}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{onClick:this.props.onClick,className:"youtube-result discogs-result"},""!==this.props.release.thumb?r.a.createElement("img",{className:"youtube-result-thumbnail",src:this.props.release.thumb}):"",r.a.createElement("div",{className:"discogs-result-title"},this.props.release.artist," - ",this.props.release.title," (",this.props.release.year,")"),r.a.createElement("div",{onClick:function(t){return e.onClickBuy(t)},className:"discogs-result-url"},"Buy Vinyl"))}}]),t}(a.Component),kT="CijdTZuyBVDePURSejQHGgfMsTjgfJSxarjJkWBo",ET=n(51);var ST=function(){function e(){Object(o.a)(this,e),this.titleToLabels={},this.nameToLabelInfo={},this.nameToLabel={},this.idToReleases={}}return Object(c.a)(e,[{key:"getLabels",value:function(e){var t=this;return new Promise(function(n,a){void 0===t.titleToLabels[e]?t.searchYoutubeTitle(e).then(function(a){var r=[];null!==a&&void 0!==a.label||n(r),a.label.map(function(s){return t.getLabelInfo(s,function(s){if(null!==s){var i={id:s.id,name:s.name};"images"in s&&(i.thumbnail=s.images[0].uri),r.push(i),t.titleToLabels[e]=r,r.length==a.label.length&&n(r)}else n(r)})})}).catch(function(e){a(e)}):n(t.titleToLabels[e])})}},{key:"searchRecords",value:function(e){return new Promise(function(t,n){var a="https://api.discogs.com/database/search?q="+e.split(/\s/g).join("+")+"&type=release&token="+kT;console.log("searchRecords="+a),ET.get(a).then(function(e){if(void 0!==e.data.results){var n=e.data.results;t(n)}else t([])})})}},{key:"searchLabel",value:function(e,t){var n=this;if(void 0!==this.nameToLabel[e])return t(this.nameToLabel[e]);var a=e,r="https://api.discogs.com/database/search?q="+(a=a.split(/\s/g).join("+"))+"&type=label&token="+kT;ET.get(r).then(function(a){if(void 0!==a.data.results){var r=a.data.results[0];n.nameToLabel[e]=r,t(r)}})}},{key:"getLabelInfo",value:function(e,t){this.searchLabel(e,function(e){var n="https://api.discogs.com/labels/"+e.id+"?token="+kT;ET.get(n).then(function(e){t(e.data)}).catch(function(e){t(null)})})}},{key:"getLabelReleases",value:function(e,t){var n=this;return new Promise(function(a,r){if(void 0===n.idToReleases[e+"_"+t]){var s="https://api.discogs.com/labels/"+e+"/releases?token="+kT+"&page="+t+"&per_page=8";ET.get(s).then(function(r){n.idToReleases[e+"_"+t]=r.data,a(r.data)}).catch(function(e){r(e)})}else a(n.idToReleases[e+"_"+t])})}},{key:"searchYoutubeTitle",value:function(e){return new Promise(function(t,n){var a=function(e,t){var n,a,r=[],e=e||"";function s(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var i=["Full Album","Full vinyl","LP","[dubstep]","(full album)","[electro]","[edm]","[house music]","[glitch hop]","[video]","[official video]","(official video)","(official music video)","(lyrics)","[ official video ]","[official music video]","[free download]","[free dl]","( 1080p )","(with lyrics)","(high res / official video)","(music video)","[music video]","[hd]","(hd)","[hq]","(hq)","(original mix)","[original mix]","[lyrics]","[free]","[trap]","[monstercat release]","[monstercat freebie]","[monstercat]","[edm.com premeire]","[edm.com exclusive]","[enm release]","[free download!]","[monstercat free release]"];i.forEach(function(t){e=(e=(e=(e=(e=(e=e.replace(t+" - ","").trim()).replace(t.toUpperCase()+" - ","").trim()).replace(t.toLowerCase()+" - ","").trim()).replace(t,"").trim()).replace(t.toUpperCase(),"").trim()).replace(t.toLowerCase(),"").trim()});for(var o=(e=(e=e.replace(/ *\([^)]*\) */g,"").trim()).replace(/ *\[[^)]*\] */g,"").trim()).split(" - "),c=0;c<o.length;c++)i.indexOf(o[c].toLowerCase())>=0&&o.splice(c,1);2==o.length?(n=o[0],a=o[1]):o.length>2?(n=o[0],a=o[1]):(n=o[0],a=o[0]);i.forEach(function(e){a=a.replace(new RegExp(s(e),"i"),"").trim(),n=n.replace(new RegExp(s(e),"i"),"").trim()}),r.push(a.replace(/(.*)\((.*) remix\)/i,"$2").trim()),r.push(a.replace(/(.*) ft\.? (.*)/i,"$1").trim()),r.push(a.replace(/(.*) ft\.? (.*)/i,"$2").trim()),r.push(a.replace(/(.*) feat\.? (.*)/i,"$1").trim()),r.push(a.replace(/(.*) feat\.? (.*)/i,"$2").trim()),r.push(a.replace(/(.*) featuring (.*)/i,"$2").trim()),r.push(a.replace(/(.*) \(ft (.*)\)/i,"$1").trim()),r.push(a.replace(/(.*) \(ft (.*)\)/i,"$2").trim()),r.push(a.replace(/(.*) \(feat\.? (.*)\)/i,"$2").trim()),r.push(a.replace(/(.*) \(featuring (.*)\)/i,"$2").trim()),r.push(n.replace(/(.*) ft\.? (.*)/i,"$1").trim()),r.push(n.replace(/(.*) ft\.? (.*)/i,"$2").trim()),r.push(n.replace(/(.*) feat\.? (.*)/i,"$1").trim()),r.push(n.replace(/(.*) feat\.? (.*)/i,"$2").trim()),r.push(n.replace(/(.*) featuring (.*)/i,"$2").trim()),r.push(n.replace(/(.*) \(ft (.*)\)/i,"$1").trim()),r.push(n.replace(/(.*) \(ft (.*)\)/i,"$2").trim()),r.push(n.replace(/(.*) \(feat\.? (.*)\)/i,"$1").trim()),r.push(n.replace(/(.*) \(featuring (.*)\)/i,"$2").trim()),r.push(n.replace(/(.*) & (.*)/gi,"$1").trim()),r.push(n.replace(/(.*) & (.*)/gi,"$2").trim()),r.push(n.replace(/(.*) vs\.? (.*)/i,"$1").trim()),r.push(n.replace(/(.*) vs\.? (.*)/i,"$2").trim()),r.push(n.replace(/(.*) x (.*)/i,"$1").trim()),r.push(n.replace(/(.*) x (.*)/i,"$2").trim());var u={};return r.forEach(function(e){e!==a&&(u[e]=e)}),{artist:n,title:a,credits:Object.keys(u)}}(e),r=a.artist+" - "+a.title,s="https://api.discogs.com/database/search?q="+(r=r.split(/\s/g).join("+"))+"&token="+kT;ET.get(s).then(function(e){var n=e.data.results,r=null;for(var s in n)(null==r||n[s].year<r.year)&&n[s].title.includes(a.title)&&(r=n[s]);if(null==r)for(var s in n)return t(n[s]);t(r)}).catch(function(e){n(e)})})}}]),e}(),OT=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={searchTerms:"",showSearchResults:!1,searchResults:[]},n.discogs=new ST,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onChangeSearch",value:function(e){this.setState({searchTerms:e})}},{key:"onSearch",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.discogs.searchRecords(this.state.searchTerms);case 2:t=e.sent,this.setState({showSearchResults:!0,searchResults:t});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return this.props.show?r.a.createElement("div",null,r.a.createElement(sT,{onChange:function(t){return e.onChangeSearch(t)},onSearch:function(){return e.onSearch()},placeHolder:"Type record name",searchTerms:this.state.searchTerms}),r.a.createElement("div",{className:"search-results"},this.state.searchResults.map(function(t){return r.a.createElement(gT,{result:t,onClick:function(){return e.selectRecord(t)}})}))):r.a.createElement("div",null)}}]),t}(a.Component),wT=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={labelReleases:[],searchTerms:"",recordLabels:[],history:[],releasesPage:1,selectedLabel:void 0,oldVideoId:e.videoId,goneBack:!1,selectedRelease:void 0,isLoadingDiscogs:!1},n.discogs=new ST,n.addListeners(),n.getRecordLabels(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){return e.videoId!==this.state.videoId&&(this.state.videoId=e.videoId),!0}},{key:"addListeners",value:function(){var e=this;window.addEventListener("get_record_labels",function(){e.getRecordLabels()})}},{key:"onClickBack",value:function(){var e=Object(ge.a)(this.state.history),t=e.pop();this.state.goneBack||(t=e.pop(),this.state.goneBack=!0),this.state.history=e,void 0!==t.labelReleases&&t.labelReleases.length>0?this.setState({labelReleases:t.labelReleases,recordLabels:[]}):this.setState({labelReleases:[],recordLabels:t.recordLabels}),void 0!==t.videoId&&this.setState({videoId:t.videoId}),void 0!==t.selectedLabel&&this.setState({selectedLabel:t.selectedLabel})}},{key:"newHistory",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.videoId;if((0!==this.state.recordLabels.length||0!==this.state.labelReleases.length)&&!this.state.history.some(function(t){return t.equals(e.state)})){var n=Object(ge.a)(this.state.history).concat([new CT(this.state.recordLabels,this.state.labelReleases,t,this.state.selectedLabel)]);this.setState({history:n,goneBack:!1})}}},{key:"getLabel",value:function(e){return this.state.recordLabels.filter(function(t){return t.id===e})[0]}},{key:"showLabelReleases",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];void 0!==this.state.selectedLabel&&this.state.selectedLabel.id===e||(this.state.selectedLabel=this.getLabel(e)),this.setState({isLoadingDiscogs:!0}),this.discogs.getLabelReleases(e,this.state.releasesPage).then(function(e){t.setState({isLoadingDiscogs:!1}),n&&t.newHistory(),t.state.recordLabels=[],t.state.labelReleases=e.releases,n&&t.newHistory(),t.setState(t.state)})}},{key:"onClickNextReleases",value:function(){this.state.releasesPage++,this.setState(this.state),this.showLabelReleases(this.state.selectedLabel.id)}},{key:"onClickPreviousReleases",value:function(){this.state.releasesPage--,this.setState(this.state),this.showLabelReleases(this.state.selectedLabel.id)}},{key:"searchForRelease",value:function(e){this.setState({selectedRelease:e}),this.props.searchYoutube(e.artist+" - "+e.title)}},{key:"onClickLabel",value:function(e){this.setState({releasesPage:1}),this.showLabelReleases(e,!0)}},{key:"getRecordLabels",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props.videoId;arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state.videoId;this.state.labelMode=!0,this.state.labelReleases=[],this.state.searchResults=[],this.state.releasesPage=1;this.setState({isLoadingDiscogs:!0}),oT(t).then(function(t){return e.discogs.getLabels(t).then(function(t){e.setState({isLoadingDiscogs:!1}),e.state.recordLabels=t,e.newHistory(),e.setState(e.state)})})}},{key:"render",value:function(){var e=this;return this.props.show?r.a.createElement("div",null,r.a.createElement("div",{className:"discogs-header"},r.a.createElement(O,{condition:this.state.history.length>0},r.a.createElement("div",{onClick:function(){return e.onClickBack()},className:"back-button"},"Back")),r.a.createElement(O,{condition:this.state.recordLabels.length>0},r.a.createElement(mT,{loadVideo:function(t){return e.props.onClickResult(t)},release:this.state.selectedRelease,videoId:this.state.videoId})),r.a.createElement(O,{condition:this.state.labelReleases.length>0},r.a.createElement(bT,{recordLabels:this.state.recordLabels,selectedLabel:this.state.selectedLabel}))),r.a.createElement("div",{className:"pagination-pane"},this.state.releasesPage>1?r.a.createElement("div",{onClick:function(){return e.onClickPreviousReleases()},className:"field-pagination-button"},"Previous"):"",this.state.labelReleases.length>0?r.a.createElement("div",{onClick:function(){return e.onClickNextReleases()},className:"field-pagination-button"},"Next"):""),r.a.createElement(V.a,{sizeUnit:"px",size:10,color:"#123abc",loading:this.state.isLoadingDiscogs}),r.a.createElement(O,{condition:this.state.recordLabels.length>0},r.a.createElement(fT,{onClickLabel:function(t){return e.onClickLabel(t)},labels:this.state.recordLabels})),r.a.createElement(O,{condition:this.state.labelReleases.length>0},r.a.createElement("div",{className:"record-labels-subheader"},"Label Releases"),this.state.labelReleases.map(function(t){return r.a.createElement(yT,{release:t,onClick:function(){return e.searchForRelease(t)}})}))):r.a.createElement("div",null)}}]),t}(a.Component),CT=function(){function e(t,n,a,r){Object(o.a)(this,e),this.recordLabels=t,this.labelReleases=n,this.videoId=a,this.selectedLabel=r}return Object(c.a)(e,[{key:"equals",value:function(e){return e.recordLabels.length>0&&this.recordLabels.length>0?JSON.stringify(e.recordLabels)===JSON.stringify(this.recordLabels):e.labelReleases.length>0&&this.labelReleases>0&&JSON.stringify(e.labelReleases)===JSON.stringify(e.labelReleases)}}]),e}(),PT=wT,TT=new ol,jT=(new Pi(TT),"YOUTUBE"),xT=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={mode:jT},n.addListeners(),n.sequencerEngine={store:n.props.store},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"addListeners",value:function(){var e=this;window.addEventListener("get_related_videos",function(){e.setState({mode:jT})})}},{key:"onClickOption",value:function(e){"DISCOGS"===e&&window.dispatchEvent(new Event("get_record_labels")),this.setState({mode:e})}},{key:"searchYoutube",value:function(e){this.setState({mode:jT}),this.props.setYoutubeSearchTerms(e)}},{key:"chooseSound",value:function(e){console.log("choose sample = "),console.log(e),this.props.onClickResult(e)}},{key:"render",value:function(){var e=this,t=this.state.mode===jT?"option-tab selected":"option-tab",n="DISCOGS"===this.state.mode?"option-tab selected":"option-tab",a=(this.state.mode,"RECORD LABELS"===this.state.mode?"option-tab selected":"option-tab"),s="SAMPLES"===this.state.mode?"internet-navigator show-sounds":"internet-navigator";return r.a.createElement("div",{className:s},r.a.createElement("div",{className:"option-tabs"},r.a.createElement("div",{onClick:function(){return e.onClickOption(jT)},className:t},"Youtube"),r.a.createElement("div",{onClick:function(){return e.onClickOption("DISCOGS")},className:n},"Discogs"),r.a.createElement("div",{onClick:function(){return e.onClickOption("RECORD LABELS")},className:a},"Record Labels")),r.a.createElement(O,{condition:this.state.mode===jT},r.a.createElement(pT,{videoId:this.props.videoId,onClickResult:this.props.onClickResult})),r.a.createElement(OT,{show:"DISCOGS"===this.state.mode}),r.a.createElement(PT,{show:"RECORD LABELS"===this.state.mode,searchYoutube:function(t){return e.searchYoutube(t)},videoId:this.props.videoId,onClickResult:this.props.onClickResult}))}}]),t}(a.Component),NT=Object(y.b)(function(e){return{}},function(e){return{setYoutubeSearchTerms:function(t){return e(Object(w.Ce)(t))}}})(xT),qT=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={type:"youtube"},n.setState(n.state),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"handleOptionChange",value:function(e){"youtube"===e.target.value?this.state.type="youtube":this.state.type="vinyl",this.props.onSampleSourceChange(this.state.type),this.setState(this.state)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"sample-source"},r.a.createElement("form",null,r.a.createElement("div",{className:"radio"},r.a.createElement("label",null,r.a.createElement("input",{className:"filter-radio",type:"radio",value:"youtube",checked:"youtube"===this.state.type,onChange:function(t){return e.handleOptionChange(t)}}),"Youtube"),r.a.createElement("label",null,r.a.createElement("input",{className:"filter-radio",type:"radio",value:"vinyl",checked:"vinyl"===this.state.type,onChange:function(t){return e.handleOptionChange(t)}}),"Vinyl"),r.a.createElement(Xy,{defaultInput:"Soundflower (2ch)",deviceId:this.props.deviceId,onChooseAudio:function(t,n){return e.props.onChooseAudio(t,n)}}))))}}]),t}(a.Component),MT=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("p",null,"To add samples to Zequencer, go to the ",r.a.createElement("a",{href:"https://zequencer.io/discover/"},"Sampler page"),"."),r.a.createElement("p",{className:"sub-header"},"Setting Up Audio Routing"),r.a.createElement("p",null,r.a.createElement("ol",null,r.a.createElement("li",null,"First install ",r.a.createElement("a",{href:"https://soundflower.en.softonic.com/mac/download"},"soundflower"),", which routes audio from your system output to an input."),r.a.createElement("li",null,"Go to Audio MIDI Setup on Mac OSX."),r.a.createElement("li",null,'Go to the "Window" menu and select "Audio Devices"'),r.a.createElement("li",null,'Press the "+" button and select "Create Multi-Output Device".'),r.a.createElement("li",null,'Check "Soundflower (2ch)" and "Built-In Output"'),r.a.createElement("li",null,"Finally, set your system audio output to the newly created Multi-Output Device."))),r.a.createElement("p",{className:"sub-header"},"Youtube"),r.a.createElement("p",null,"On the sampler page, you can search for youtube videos to sample."),r.a.createElement("p",{className:"sub-header"},"Vinyl"),r.a.createElement("p",null,'If you want to record vinyl samples, choose the audio input from the dropdown. Then select the "vinyl" checkbox. This will allow you to monitor the input of your recording.',r.a.createElement("div",{className:"sample-source-demo"},r.a.createElement(qT,{onSampleSourceChange:function(){return[]},onChooseAudio:function(e){return[]}})),r.a.createElement("div",{className:"clear-fix"})),r.a.createElement("p",null,'With "vinyl" selected, go to the "Discogs" tab and type the title of your record in the search box. Then select the matching sample. This will tie whatever samples you record to the record.'),r.a.createElement("p",{className:"sub-header"},"Recording"),r.a.createElement("p",null,"To record a sample, click the ",r.a.createElement("b",null,"RECORD")," button and when you're done click it again. You will notice the recorded sample appear below"),r.a.createElement("p",{className:"sub-header"},"Tagging Samples"),r.a.createElement("p",null,"Setting tags for samples allows you to organize your sample library. Click on the cover art of your recorded samples to select them. Once selected, press the ",r.a.createElement("b",null,"TAG")," button. Then type the tag in the input field and press ENTER."),r.a.createElement("p",{className:"sub-header"},"Saving"),r.a.createElement("p",null,"Once you've tagged your samples, you need to press the ",r.a.createElement("b",null,"SAVE SOUNDS")," button.",r.a.createElement("p",null,"A ",r.a.createElement("b",null,"Metamask")," pop-up will show up confirming you wish to save. The transaction cost will be proportional to the number of samples you've recorded."),r.a.createElement("p",null,"The transaction cost is roughly 1 cent per sample.")),r.a.createElement("p",{className:"sub-header"},"Searching for Samples"),r.a.createElement("p",null,"It's important to tie samples you record to the source you've found them from."),r.a.createElement("p",null,"For youtube samples, this happens automatically. However if you sample directly from vinyl, you need to tie the sample from the ",r.a.createElement("b",null,"Discogs")," tab. Type the name of the record in the search box and click the result closest matching your record.",r.a.createElement(NT,{store:this.props.sequencerEngine.store,videoId:"",onClickResult:function(e){return[]}})))}}]),t}(a.Component),DT=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("p",null,"Zequencer runs on the ",r.a.createElement("a",{href:"https://ethereum.org"},"Ethereum")," blockchain. This means that metadata related to samples, projects, presets, and profiles is stored on the blockchain. The blockchain is immutable, which means that the metadata written to it cannot be altered or censored."),r.a.createElement("p",{className:"sub-header"},"Ether"),r.a.createElement("p",null,r.a.createElement("b",null,"Ether")," is the main cryptocurrency used with Ethereum. Zequencer tokens are bought using ",r.a.createElement("b",null,"ether"),". The transaction costs for writing to the blockchain are also paid using ",r.a.createElement("b",null,"ether"),"."),r.a.createElement("p",null,"Test ",r.a.createElement("b",null,"ether")," is currently used with Zequencer, and costs no real money. When Zequencer switches to the ",r.a.createElement("b",null,"Main Ethereum Network"),", the ",r.a.createElement("b",null,"ether")," will cost real money."),r.a.createElement("p",null,"You can get test ",r.a.createElement("b",null,"ether")," from ",r.a.createElement("a",{href:"https://faucet.metamask.io/"},"here"),"."),r.a.createElement("p",{className:"sub-header"},"Saving Projects"),r.a.createElement("p",null,"To save a project publicly, you need to purchase ",r.a.createElement("b",null,"Zequencer tokens"),". For now, this is free since Zequencer runs on the ",r.a.createElement("b",null,"Ropsten Test Network"),". Eventually, this will cost real money.",r.a.createElement("p",null,"Saving projects privately costs no ",r.a.createElement("b",null,"Zequencer tokens"),".")),r.a.createElement("p",{className:"sub-header"},"Buying Tokens"),r.a.createElement("p",null,"When you save a song, it will tell you that you need to buy a token. So click \u201cbuy\u201d and wait for the transaction to confirm. Once confirmed, you can then save. It will cost ",r.a.createElement("b",null,"1 Zequencer token")," to save."),r.a.createElement("p",{className:"sub-header"},"Distribution of Tokens"),r.a.createElement("p",null,"The token used to save a project gets distributed to each sample used in your track. The creators of the samples can then later retrieve the funds by proving that they own the samples."),r.a.createElement("p",{className:"sub-header"},"Metamask"),r.a.createElement("p",null,"Metamask is a browser plugin that connects websites, like Zequencer, to your Ethereum wallet."),r.a.createElement("p",null,"When Zequencer needs to save something to Ethereum on your behalf, a Metamask pop-up will appear asking you to confirm a transaction."),r.a.createElement("p",null,"Transactions in Ethereum cost a small fee (paid in ",r.a.createElement("b",null,"Ether"),"). The cost is proportional to how large the transaction is."))}}]),t}(a.Component),AT=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("p",null,"Files for samples, projects, presets, and user profiles are all stored using the ",r.a.createElement("a",{href:"https://ipfs.io/"},"IPFS protocol"),". You can think of IPFS as a world-wide filesystem, where files can be copied and hosted on multiple computers-- similar to BitTorrent."),r.a.createElement("p",{className:"sub-header"},"Installing"),r.a.createElement("p",null,"You are encouraged to install ",r.a.createElement("a",{href:"https://github.com/ipfs-shipyard/ipfs-desktop"},"IPFS"),". This will keep the files you use on your computer, so that you can load samples much faster. Also, this gives you peace of mind that your files are at least on your computer."),r.a.createElement("p",{className:"sub-header"},"Fortifying the Archive"),r.a.createElement("p",null,"Note that, all files copied to your own IPFS instance will get backed up on Zequencer servers as well. But there\u2019s no way to guarantee that they\u2019ll be there forever (MySpace for example lost 10 years of history in 2018)."),r.a.createElement("p",null,"So it\u2019s good to run IPFS on your computer, to fortify the archive. The more people do this, the more resilient the archive of samples, songs, and presets will be. And you get the plus of loading songs quickly from your own machine, while possibly helping others looking for files."),r.a.createElement("p",{className:"sub-header"},"Downloading Samples"),r.a.createElement("p",null,"In order to download all samples to your computer, go to ",r.a.createElement("a",{href:"http://zequencer.io/download"},"this page")," and click \u201cStart\u201d. You will need to have IPFS running. This process will probably take hours so sit tight, smoke something."))}}]),t}(a.Component);function RT(e){function t(){e.sequencerEngine.scripting.viCommand("d"),e.sequencerEngine.scripting.viCommand("d"),e.sequencerEngine.switchToSubSequence(e.sequencerEngine.subSequences[0].id)}return Object(a.useEffect)(function(){void 0!==e.sequencerEngine.subSequences[1]&&e.sequencerEngine.switchToSubSequence(e.sequencerEngine.subSequences[1].id),e.sequencerEngine.scripting.viCommand("d"),e.sequencerEngine.scripting.viCommand("d"),e.sequencerEngine.scripting.viCommand("t");for(var n=0;n<16;n++)e.sequencerEngine.scripting.viCommand("i");return t},[0]),r.a.createElement("div",null,r.a.createElement("p",null,"The ",r.a.createElement("b",null,"Warp")," midi-effect's main purpose is to sync a sample's tempo to the tempo of the project."),r.a.createElement("p",null,'Click the "Warp" button below the track\'s thumbnail to enable warping on that track.'),r.a.createElement(BP,{sequencerEngine:e.sequencerEngine}),r.a.createElement("p",null,"Click the ",r.a.createElement("b",null,"FX")," button and notice a new midi-effect called ",r.a.createElement("b",null,"Warp")," in your effects chain. The drum break is automatically synced to the tempo (i.e. it doesn't trip over itself)."),r.a.createElement("p",null,r.a.createElement("b",null,"Warp")," has numerous parameters for refining the timing of your sample."),r.a.createElement("p",{className:"sub-header"},"Warp Length"),r.a.createElement("p",null,"When ",r.a.createElement("b",null,"Warp Length")," set to 1, the sample will be in sync with the BPM of the project."),r.a.createElement("p",null,"For values above 1, it slows down the sample. Below 1, the sample speeds up."),r.a.createElement("p",null,"This gives you a fine grained control for the tempo of a sample."),r.a.createElement("p",{className:"sub-header"},"Warp Factor"),r.a.createElement("p",null,r.a.createElement("b",null,"Warp Factor")," factors the ",r.a.createElement("b",null,"Warp Length")," proportionally to it's value. By default it is 2. So when set to 1, the sample will double in speed. When set to 4, the speed halves."),r.a.createElement("p",null,"Think of it as a coarse control over sample speed."),r.a.createElement("p",{className:"sub-header"},"Rate"),r.a.createElement("p",null,r.a.createElement("b",null,"Warp")," works by slicing a sample into many grains and playing them at the ",r.a.createElement("b",null,"Rate")," specified in the ",r.a.createElement("b",null,"Rate")," parameter."),r.a.createElement("p",null,"By default, the ",r.a.createElement("b",null,"Rate")," is set to 1/16th notes. However, you can set it to any resolution of notes for creative timing."),r.a.createElement("p",{className:"sub-header"},"Grain Size"),r.a.createElement("p",null,"As mentioned, ",r.a.createElement("b",null,"Warp")," slices the sample into grains and triggers them at the ",r.a.createElement("b",null,"Rate")," specified. You can control the size of the grains using the ",r.a.createElement("b",null,"Grain Size")," parameter. By default it is 1, which means one 1/16th note."),r.a.createElement("p",null,"Setting to lower values creates a more stuttering, almost tremolo effect."),r.a.createElement("p",{className:"sub-header"},"Smoothing"),r.a.createElement("p",null,"You can control the crossover between grains using the ",r.a.createElement("b",null,"Smoothing")," parameter."),r.a.createElement("p",null,"This essentially applies a fade-in and fade-out to each grain, making the process smoother. This can smooth out the transients within a sample."),r.a.createElement("p",{className:"sub-header"},"Loop Length"),r.a.createElement("p",null,"You can control the length of the loop cycle-- with respect to the entire length of the sample-- using the ",r.a.createElement("b",null,"Loop Length")," parameter."),r.a.createElement("p",null,"This parameter is very interesting when applied to one hits, with no BPM."),r.a.createElement("p",null,"Click this button and try messing with the ",r.a.createElement("b",null,"Loop Length")," parameter to get a feel for it."),r.a.createElement("div",{onClick:function(){t(),e.sequencerEngine.getSelectedTrack().warp(),e.sequencerEngine.getSelectedTrack().showEffects(!0),function(){e.sequencerEngine.scripting.viCommand("d"),e.sequencerEngine.scripting.viCommand("d"),e.sequencerEngine.scripting.viCommand("t");for(var t=0;t<16;t++)e.sequencerEngine.scripting.viCommand("i")}(),window.scroll(0,0)},className:"common-button pink-button"},"Switch to Hi-Hat"),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement("p",null,"The warping effectively creates a bunch of ghost hits stemming from the initial hit, creating a very human-like rhythm."),r.a.createElement("p",null,"Try it with kicks, hi-hats, sidesticks, claves for extra fun."),r.a.createElement("p",{className:"sub-header"},"Appendix: Retriggering"),r.a.createElement("p",null,"When 2 steps have durations that overlap one another, the second step will not cause a retrigger of the hit. Instead, the second step will override the parameters from the first step."),r.a.createElement("p",null,"For example, if the first step has ",r.a.createElement("b",null,"Velocity")," of 1, and the second step has ",r.a.createElement("b",null,"Velocity")," of 0.5, then once the second step is hit, the velocity of all of the remainding hits will be 0.5."))}function IT(e){return r.a.createElement("div",null,r.a.createElement("p",{className:"sub-header"},"Resolution"),r.a.createElement("p",null,"The ",r.a.createElement("b",null,"resolution")," dropdown at the top-left of the sequencer controls the ",r.a.createElement("b",null,"resolution")," we show the steps in the sequencer."),r.a.createElement("p",null,"It also controls how ",r.a.createElement("b",null,"rolling")," and ",r.a.createElement("b",null,"quantization")," is performed."),r.a.createElement("p",null,r.a.createElement(zy,{sequencerEngine:e.sequencerEngine}),r.a.createElement("div",{className:"clear-fix"})),r.a.createElement("p",null,"For example, when ",r.a.createElement("b",null,"resolution")," is set to 1/8 notes, any recorded triggers will be snapped to the 1/8th note grid."),r.a.createElement("p",{className:"sub-header"},"Rolling"),r.a.createElement("p",null,"When ",r.a.createElement("b",null,"roll")," is turned on, the ",r.a.createElement("b",null,"resolution")," controls the rate at which the triggers are played."),r.a.createElement("p",{className:"sub-header"},"Sequence Rolling"),r.a.createElement("p",null,"When ",r.a.createElement("b",null," roll")," is turned on, you can force the entire sequence to roll by pressing the ",r.a.createElement("b",null,"` key")," (i.e. the backwards quote letter to the left of the 1 key)."),r.a.createElement("p",null,"When the entire sequence is ",r.a.createElement("b",null,"rolling"),", the sequencer will repeatedly cycle through the steps at which the ",r.a.createElement("b",null,"` key")," was first pressed, for as many steps as the ",r.a.createElement("b",null,"resolution")," defines."),r.a.createElement("p",null,'This can be thought of as a beat-repeat function, or "drum roll" function (in some existing drum machines). It allows you to perform the sequencer like a live instrument.'),r.a.createElement("p",{className:"sub-header"},"Keyboard Shortcuts"),r.a.createElement("p",null,"It is possible to alter the ",r.a.createElement("b",null,"resolution")," while rolling, using keyboard shortcuts. This is crucial for effective live performing (both in regular rolling and sequence rolling)."),r.a.createElement("p",null,"The keyboard shortcuts are the number keys (note ",r.a.createElement("b",null,"Roll")," must be turned on).",r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("b",null,"2:")," 1/4"),r.a.createElement("li",null,r.a.createElement("b",null,"3:")," 1/4 (triplets)"),r.a.createElement("li",null,r.a.createElement("b",null,"4: ")," 1/8"),r.a.createElement("li",null,r.a.createElement("b",null,"5:")," 1/8 (triplets)"),r.a.createElement("li",null,r.a.createElement("b",null,"6: "),"1/16"),r.a.createElement("li",null,r.a.createElement("b",null,"7:")," 1/16 (triplets)"),r.a.createElement("li",null,r.a.createElement("b",null,"8:")," 1/32"),r.a.createElement("li",null,r.a.createElement("b",null,"9:")," 1/32 (triplets)"))),r.a.createElement("p",null,"Get comfortable with these key bindings, along with ",r.a.createElement("b",null,"sequence rolling")," to unlock new grooves you hadn't thought of."))}function LT(e){return r.a.createElement("div",null,r.a.createElement("p",null,"Midi Effects alter the trigger data within the effected track. There are several different midi effects to choose from."),r.a.createElement("p",{className:"sub-header"},"Alternate Tuning"),r.a.createElement("p",null,"Maps each note triggered to a different note. You define a custom scale within the effect."),r.a.createElement("p",{className:"sub-header"},"Arpeggiator"),r.a.createElement("p",null,"Arpeggiates a chord or note at a given rate. For example a C+G+D chord arpeggiated at 1/16 notes, will cycle through each note in the chord every 1/16th step."),r.a.createElement("p",{className:"sub-header"},"Harmony"),r.a.createElement("p",null,"Harmonizes each trigger, adding a note relative the initial note triggered. Allows for setting the ",r.a.createElement("b",null,"timing offset")," (in 1/32th notes) at which this harmonizing trigger occurs."),r.a.createElement("p",null,"Can create richer percussive hits by harmonizing and setting a slight timing offset."),r.a.createElement("p",{className:"sub-header"},"Parameterizer"),r.a.createElement("p",null,"Select a ",r.a.createElement("b",null,"parameter")," to modify with an inputed ",r.a.createElement("b",null,"probability"),". A probability of 100% means the ",r.a.createElement("b",null,"parameter")," will always be modified by this effect. A probability of 0% means it will never change."),r.a.createElement("p",null,"The ",r.a.createElement("b",null,"probability")," parameter introduces randomness to your sequencing."),r.a.createElement("p",null,"The ",r.a.createElement("b",null,"factor")," parameter defines the factor by which we multiply the parameter of the inputed trigger. For example, a ",r.a.createElement("b",null,"factor")," of 0.5 means it would multiple the value of the parameter by 0.5."),r.a.createElement("p",null,"The ",r.a.createElement("b",null,"offset")," parameter defines how much we add to the parameter of the inputed trigger. For example, an ",r.a.createElement("b",null,"offset")," of 0.5 means we would add 0.5 to the value of the parameter."),r.a.createElement("p",null,r.a.createElement("b",null,"Tip:")," Modulate the ",r.a.createElement("b",null,"offset")," parameter by an LFO to create madness. This works well when ",r.a.createElement("b",null,"parameter")," is set to ",r.a.createElement("b",null,"Pitch Sustain"),"."),r.a.createElement("p",{className:"sub-header"},"Timing"),r.a.createElement("p",null,"You can set the timing offsets of ",r.a.createElement("b",null,"odd")," and ",r.a.createElement("b",null,"even")," triggers, which can swing the groove."),r.a.createElement("p",null,"The ",r.a.createElement("b",null,"resolution")," parameter, controls what steps we consider to be ",r.a.createElement("b",null,"odd")," or ",r.a.createElement("b",null,"even"),". By default, it is set to 1/16th notes."),r.a.createElement("p",null,"The unit of these offsets is in 1/32th notes."),r.a.createElement("p",{className:"sub-header"},"Midi Outputter"),r.a.createElement("p",null,"Send triggers to another track. You can then have one track controlling multiple tracks."),r.a.createElement("p",{className:"sub-header"},"Warp"),r.a.createElement("p",null,"Controls how much we stretch the sample, with relation to it\u2019s BPM vs the actual BPM."))}var FT=Object(y.b)(function(e,t){return{viMode:e.commands.viMode}},void 0)(function(e){return Object(a.useEffect)(function(){void 0!==e.sequencerEngine.subSequences[0]&&e.sequencerEngine.switchToSubSequence(e.sequencerEngine.subSequences[0].id),e.sequencerEngine.scripting.viCommand("d"),e.sequencerEngine.scripting.viCommand("d")},[0]),r.a.createElement("div",null,r.a.createElement("p",{className:"sub-header"},"Command Mode (VI Mode)"),r.a.createElement("p",null,"Zequencer allows ",r.a.createElement("a",{href:"https://www.vim.org/"},"VI-like")," key-bindings for moving around and editing the sequence using the keyboard."),r.a.createElement("p",null,"Press the ",r.a.createElement("b",null,"escape key")," to enter and exit ",r.a.createElement("b",null,"Command Mode"),". You will see the following button in the top toolbar when in this mode:"),r.a.createElement(O,{condition:e.viMode},r.a.createElement("div",{className:"roll-button command-button"},"COMMAND"),r.a.createElement("div",{className:"clear-fix"})),r.a.createElement("p",null,"The blinking ",r.a.createElement("b",null,"cursor")," is central to ",r.a.createElement("b",null,"Command Mode"),". There are several key-bindings for moving the ",r.a.createElement("b",null,"cursor"),", when in ",r.a.createElement("b",null,"Command Mode"),"."),r.a.createElement(BP,{sequencerEngine:e.sequencerEngine}),r.a.createElement("p",{className:"shortcuts"},r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("b",null,"t"),": toggles the step at cursor on/off.."),r.a.createElement("li",null,r.a.createElement("b",null,"h"),": moves the cursor left one step."),r.a.createElement("li",null,r.a.createElement("b",null,"j"),": moves the cursor down one line."),r.a.createElement("li",null,r.a.createElement("b",null,"k"),": moves the cursor up one line."),r.a.createElement("li",null,r.a.createElement("b",null,"l"),": moves the cursor right one step."),r.a.createElement("li",null,r.a.createElement("b",null,"w"),": moves the cursor to the next cluster of steps."),r.a.createElement("li",null,r.a.createElement("b",null,"b"),": moves the cursor to the previous cluster of steps."),r.a.createElement("li",null,r.a.createElement("b",null,"0"),": moves the cursor to the beginning of the line"),r.a.createElement("li",null,r.a.createElement("b",null,"x"),": deletes the step at the cursor, adding the step to the clipboard."),r.a.createElement("li",null,r.a.createElement("b",null,"p"),": pastes the clipboard at the cursor."),r.a.createElement("li",null,r.a.createElement("b",null,"yy"),": copies the current line into the clipboard."),r.a.createElement("li",null,r.a.createElement("b",null,"dd"),": deletes the current line, adding the steps to the clipboard."),r.a.createElement("li",null,r.a.createElement("b",null,"dw"),": deletes the next cluster of steps, adding the steps to the clipboard."),r.a.createElement("li",null,r.a.createElement("b",null,"a"),": doubles the track length."),r.a.createElement("li",null,r.a.createElement("b",null,"s"),": halves the track length."),r.a.createElement("li",null,r.a.createElement("b",null,"i"),": increase the duration of the step at the cursor by 1."),r.a.createElement("li",null,r.a.createElement("b",null,"o"),": decerease the duration of the step at the cursor by 1."))),r.a.createElement("p",{className:"sub-header"},"Compound Commands"),r.a.createElement("p",null,"Typing a number within a command allows to repeatedly apply a command."),r.a.createElement("p",null,"for example, ",r.a.createElement("b",null,"d2d")," will delete the 2 lines starting at the cursor, adding the steps to the clipboard."),r.a.createElement("p",null,r.a.createElement("b",null,"y2y")," will add the 2 lines to the clipboard."),r.a.createElement("p",null,r.a.createElement("b",null,"d2w")," will delete the next 2 clusters of steps, adding them to the clipboard."))}),VT={Track:function(e){return r.a.createElement(HP,{sequencerEngine:e})},"Sound Selector":function(e){return r.a.createElement(FP,{sequencerEngine:e})},Effects:function(e){return r.a.createElement(zP,{sequencerEngine:e})},Warp:function(e){return r.a.createElement(RT,{sequencerEngine:e})},"Parameter Modulators":function(e){return r.a.createElement(WP,{sequencerEngine:e})},"Track Details":function(e){return r.a.createElement(JP,{sequencerEngine:e})},"Roll, Record and Quantize":function(e){return r.a.createElement(GP,{sequencerEngine:e})},"Rolling and Resolution":function(e){return r.a.createElement(IT,{sequencerEngine:e})},"Piano Roll":function(e){return r.a.createElement(YP,{sequencerEngine:e})},"Midi Effects":function(e){return r.a.createElement(LT,{sequencerEngine:e})},Patterns:function(e){return r.a.createElement(_P,{sequencerEngine:e})},"Pattern Locking":function(e){return r.a.createElement(ZP,{sequencerEngine:e})},"Sub Sequences":function(e){return r.a.createElement(KP,{sequencerEngine:e})},Presets:function(e){return r.a.createElement(QP,{sequencerEngine:e})},Instruments:function(e){return r.a.createElement(XP,{sequencerEngine:e})},Mixer:function(e){return r.a.createElement($P,{sequencerEngine:e})},Arrangement:function(e){return r.a.createElement(eT,{sequencerEngine:e})},"Advanced Keys":function(e){return r.a.createElement(FT,{sequencerEngine:e})},MIDI:function(e){return r.a.createElement(tT,{sequencerEngine:e})},"Freezing Tracks":function(e){return r.a.createElement(nT,{sequencerEngine:e})},"Transcribing Tracks":function(e){return r.a.createElement(aT,{sequencerEngine:e})},Sampler:function(e){return r.a.createElement(MT,{sequencerEngine:e})},"Ethereum and Tokens":function(e){return r.a.createElement(DT,{sequencerEngine:e})},IPFS:function(e){return r.a.createElement(AT,{sequencerEngine:e})}},BT=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getClassName",value:function(e){return this.props.toShow===e?"topic selected":"topic"}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"doc-sidebar"},Object.keys(VT).map(function(t){return r.a.createElement("div",{onClick:function(){return e.props.onClick(t)},className:e.getClassName(t)},t)}))}}]),t}(a.Component),UT=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).sequencerEngine=new pl(e.store),n.sequencerEngine.loadSequence("QmcYPaK6KtPJrpBxpdzBkWUpYAt7nqXSym19qxhsBcKwWN"),n.scripting=new Dl(n.sequencerEngine),n.sequencerEngine.setScripting(n.scripting),n.keyboardEngine=new dy(n.sequencerEngine),n.sequencerEngine.connectToKeyboardEngine(n.keyboardEngine),window.sequencerEngine=n.sequencerEngine,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"doc-viewer"},r.a.createElement("div",{className:"header"},this.props.toShow),VT[this.props.toShow](this.sequencerEngine))}}]),t}(a.Component),HT=(n(2355),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={documentationToShow:"Track"},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"documentation"},r.a.createElement(BT,{onClick:function(t){return e.setState({documentationToShow:t})},toShow:this.state.documentationToShow}),r.a.createElement(UT,{store:this.props.store,toShow:this.state.documentationToShow}))}}]),t}(a.Component)),JT=(n(2356),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={option:"/documentation"===e.location.pathname?DP:MP},R.a.store=n.props.store,Ge.a.setStore(n.props.store),Ge.a.setEthereum(R.a),Ge.a.checkLogin(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickOption",value:function(e){this.setState({option:e})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"landing-page"},r.a.createElement(DC,{store:this.props.store}),r.a.createElement("div",{className:"content"},r.a.createElement(IP,{selectedOption:this.state.option,onClickOption:function(t){return e.onClickOption(t)}}),r.a.createElement(O,{condition:this.state.option===MP},r.a.createElement(qP,null)),r.a.createElement(O,{condition:"GETTING_STARTED"===this.state.option},r.a.createElement(NP,null)),r.a.createElement(O,{condition:this.state.option===DP},r.a.createElement(HT,{store:this.props.store}))))}}]),t}(a.Component)),GT=n(1059),zT=n(599),_T=n(43),WT=new zT.a,KT=new _T("undefined"!==typeof window.web3?window.web3.currentProvider:new _T.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),YT=function(){function e(){Object(o.a)(this,e),console.log("constructing pinner"),this.samplesPinner=new GT.a(WT,[KT.utils.sha3("SampleCreated(address,bytes32,string)"),null,null],2,!1,!0)}return Object(c.a)(e,[{key:"pinAll",value:function(){this.samplesPinner.pinAll()}},{key:"getStats",value:function(){return this.samplesPinner.getStats()}}]),e}(),QT=(n(2557),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={downloading:!1,stats:{date:new Date,local:new Set,pinned:new Set,pinning:new Set,failed:new Set,queued:new Set},counter:0,filesDownloading:{},tagsDownloading:{},notConnected:!1},n.samplesPinner=new YT,setTimeout(function(){n.setState({notConnected:!B.a.isConnectedLocally()})},15e3),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickStart",value:function(){var e=this;this.setState({downloading:!0}),this.samplesPinner.pinAll(),this.interval=setInterval(Object(g.a)(v.a.mark(function t(){var n,a,r,s;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=e.samplesPinner.getStats(),a=Array.from(n.pinning),t.t0=v.a.keys(a);case 3:if((t.t1=t.t0()).done){t.next=16;break}if(r=t.t1.value,!((s=a[r])in e.state.filesDownloading)){t.next=8;break}return t.abrupt("continue",3);case 8:return t.next=10,R.a.getTitleForSound(s);case 10:return e.state.filesDownloading[s]=t.sent,t.next=13,R.a.getTagsForSound(s);case 13:e.state.tagsDownloading[s]=t.sent,t.next=3;break;case 16:e.state.counter++,e.state.stats=n,e.setState(e.state);case 19:case"end":return t.stop()}},t)})),500)}},{key:"render",value:function(){for(var e=this,t=Array.from(this.state.stats.pinning),n=[],a=0;a<350;a++)n.push(0);return this.state.notConnected?r.a.createElement("div",{className:"downloader"},r.a.createElement("div",{className:"title"},"Universal Sequences Downloader"),r.a.createElement("div",{className:"action"},"In order to download files onto your computer, please run ",r.a.createElement("a",{href:"https://github.com/ipfs-shipyard/ipfs-desktop"},"IPFS"))):r.a.createElement("div",{className:"downloader"},r.a.createElement("div",{className:"title"},"Universal Sequences Downloader"),r.a.createElement("div",{className:"divider"},n.map(function(t,a){return e.state.counter%n.length===a?r.a.createElement("span",{className:"current"},"/"):"/"})),r.a.createElement(O,{condition:!this.state.downloading},r.a.createElement("div",{onClick:function(){return e.onClickStart()},className:"download-start-button"},"Start")),r.a.createElement(O,{condition:this.state.downloading&&this.state.stats},r.a.createElement("div",null,"Downloaded up to: ",r.a.createElement("span",{className:"date"},this.state.stats.date.toString())),r.a.createElement("div",null,"Downloaded: ",this.state.stats.pinned.size," "),r.a.createElement("div",null,"Queued: ",this.state.stats.queued.size," "),r.a.createElement("div",null,"Failed : ",this.state.stats.failed.size),r.a.createElement("div",{className:"divider"},n.map(function(e){return"/"})),r.a.createElement("div",null,"Downloading: ",r.a.createElement("span",{className:"file-name"},this.state.stats.pinning.size)),t.map(function(t){return r.a.createElement("div",null,r.a.createElement("span",{className:"action"},"Downloading")," ",r.a.createElement("span",{className:"file-name"},e.state.filesDownloading[t],"..."),(e.state.tagsDownloading[t]||[]).map(function(e){return r.a.createElement("span",{className:"tag"},e)}))}),r.a.createElement("div",{className:"divider"},n.map(function(e){return"/"})),r.a.createElement("div",null,"Local: ",this.state.stats.local.size)))}}]),t}(a.Component)),XT=function(e){function t(e){var n;Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={buffer:e.buffer,sound:e.sound,previousBuffer:void 0,x:0,isPlaying:!1,dragging:!1,selection:null,bufferDuration:void 0},n.width=e.width||825,n.height=e.height||115,n.state.pts=[];var a=Object(p.a)(n);return n.computeWaveformInChunks(0,[],function(e){a.state.pts=e,a.setState(a.state)}),n.convertSpaceToSeconds.bind(Object(p.a)(n)),n.audioUnit=new _(q.a.context),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getWidth",value:function(){var e=150*this.state.buffer.duration;return e>this.width?this.width:e}},{key:"shouldComponentUpdate",value:function(e){if(this.state.bufferDuration!==e.buffer.duration){this.state.buffer=e.buffer,this.state.bufferDuration=e.buffer.duration;this.computeWaveformInChunks(0,[])}return!0}},{key:"computeWaveformInChunks",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n,a){var r,s,i,o,c,u,l,p;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r=this.getWidth(),s=Math.floor(this.state.buffer.length/this.getWidth()),i=this.state.buffer.getChannelData(0),o=window.api.create_buffer(i.length),window.Module.HEAPF32.set(i,o>>2),window.api.getWaveform(o,r,this.height,i.length,s,r*t),c=window.api.get_result_pointer(),u=new Uint16Array(window.Module.HEAP16.buffer,c,7*r),l=[],p=0;p<4*r;p+=4)l.push({x:u[p],y:u[p+1],width:u[p+2],height:u[p+3]});this,this.state.pts=l,this.setState(this.state),window.api.destroy_buffer(o);case 14:case"end":return e.stop()}},e,this)}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"convertSpaceToSeconds",value:function(e){return this.state.buffer.duration*e/this.getWidth()}},{key:"convertSecondsToSpace",value:function(e){return e/this.state.buffer.duration*this.getWidth()}},{key:"convertSamplesToSpace",value:function(e){return this.convertSecondsToSpace(1*e/q.a.Master.context.sampleRate)}},{key:"onClick",value:function(){this.audioUnit.loadRawBuffer(this.state.buffer);var e=!this.state.isPlaying;if(this.setState({isPlaying:e}),e)if(void 0!==this.props.sound.slices&&this.props.sound.slices.length>0){var t=this.props.sound.slices[0],n=t.startTime,a=t.endTime-t.startTime;this.audioUnit.playSound(n,a)}else this.audioUnit.playSound(0);else this.audioUnit.stopSound();this.props.onClick()}},{key:"onDragStart",value:function(e){this.props.dragging(this.state.sound)}},{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"render",value:function(){var e=this,t=this.state.pts,n=this.width+20,a=void 0===this.props.sound?void 0:this.props.sound.getThumbnail(),s=void 0===this.props.sound?void 0:this.props.sound.name,i=void 0===this.props.sound?[]:void 0===this.props.sound.slices?[]:this.props.sound.slices;return console.log("simplewaveform.segmetns = "),console.log(this.props.segments),r.a.createElement("div",{className:"draggable-waveform",onDragStart:function(t){return e.onDragStart(t)},onDragOver:function(t){return e.onDragOver(t)},draggable:!0},r.a.createElement("div",{onClick:function(){return e.onClick()},className:this.props.isSelected?"selected sound-waveform waveform":"sound-waveform waveform",style:{width:n+"px"}},r.a.createElement(b.Stage,{width:this.width,height:this.height},r.a.createElement(b.Layer,null,r.a.createElement(b.Group,null,r.a.createElement(b.Rect,{x:0,y:0,width:this.width,height:this.height,fill:"black"}),this.props.segments.map(function(t){return r.a.createElement(b.Rect,{x:e.convertSamplesToSpace(t.start),y:0,width:e.convertSamplesToSpace(t.end-t.start),height:e.height,fill:"#001821"})}),i.map(function(t,n){return r.a.createElement(b.Rect,{x:e.convertSecondsToSpace(t.startTime),y:0,width:e.convertSecondsToSpace(t.endTime-t.startTime),height:e.height,fill:"yellow"})}),t.map(function(e){return r.a.createElement(b.Rect,{x:e.x,y:e.y,width:e.width,height:e.height,fill:"red"})}),r.a.createElement(b.Line,{x:this.state.x,y:0,points:[this.state.x,0,this.state.x,this.height],strokeWidth:1,stroke:"red",fill:"red"}))))),this.props.isMainWaveform?"":r.a.createElement("div",{onClick:function(){return e.props.onClick()},className:"sound-details"},r.a.createElement("span",{className:"delete-button",onClick:function(){return e.props.onClickDelete()}},"x"),void 0!==a?r.a.createElement("img",{className:"video-thumbnail",src:a}):"",r.a.createElement("div",{className:void 0===a?"just-sound-name sound-name":"sound-name"},void 0!==s?function(e){if(void 0===e||null===e)return null;return e.length>ZT?e.substring(0,ZT)+"...":e}(s):"")))}}]),t}(a.Component),ZT=14;var $T=XT,ej=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={selectedSound:void 0,columns:[e.sounds],columnToTags:{},sounds:e.sounds},n.props.onColumnsChanged(n.state.columns),n.setState(n.state),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){return e.sounds!==this.state.sounds&&this.setState({columns:this.state.columns.concat([e.sounds]),sounds:e.sounds}),!0}},{key:"onClickSound",value:function(e){this.setState({selectedSound:e})}},{key:"deleteSound",value:function(e,t){this.state.columns[e].splice(t,1),this.setState(this.state),this.props.onColumnsChanged(this.state.columns)}},{key:"addTagToColumn",value:function(e,t){if(t in this.state.columnToTags){var n=this.state.columnToTags[t];this.state.columnToTags[t]=[e].concat(n),this.setState({columnToTags:this.state.columnToTags})}else this.state.columnToTags[t]=[e],this.setState({columnToTags:this.state.columnToTags});this.props.onColumnsChanged(this.state.columns),this.props.onColumnTagsChanged(this.state.columnToTags)}},{key:"onClearButtonClicked",value:function(){this.setState({columns:[],columnToTags:{}}),this.props.onClear()}},{key:"onDropNewColumn",value:function(e){if(void 0!==this.state.bufferDragging){var t=this.state.bufferDragging,n=this.removeFromColumn();this.setState({columns:n.concat([[t]])}),this.props.onColumnsChanged(this.state.columns)}}},{key:"onDropToColumn",value:function(e,t){if(void 0!==this.state.draggingColumn&&void 0===this.state.bufferDragging){if(this.state.draggingColumn==t)return void this.setState({draggingColumn:void 0});var n=this.state.columns;n[t]=n[t].concat(n[this.state.draggingColumn]),n.splice(this.state.draggingColumn,1),this.setState({columns:n,draggingColumn:void 0})}else if(void 0!==this.state.bufferDragging&&t!=this.state.bufferColumnDragged){this.state.columns[t].push(this.state.bufferDragging);var a=this.removeFromColumn(t);this.state.bufferDragging;this.setState({columns:a,bufferDragging:void 0})}this.props.onColumnsChanged(this.state.columns)}},{key:"removeFromColumn",value:function(e){var t=this.state.bufferDragging,n=this.state.columns,a=[];for(var r in n){var s=n[r];if(r!=e){var i=s.indexOf(t);i>-1&&s.splice(i,1),s.length>0&&a.push(s)}else a.push(s)}return a}},{key:"onDragStart",value:function(e){}},{key:"onDragColumnStart",value:function(e,t){void 0===this.state.bufferDragging&&this.setState({draggingColumn:t})}},{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"draggingBuffer",value:function(e,t){this.setState({bufferDragging:e,draggingColumn:void 0,bufferColumnDragged:t})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"sounds-container"},r.a.createElement("div",{className:"text-instructions"},"Drag samples into categories"),r.a.createElement("div",{className:"action-buttons"},r.a.createElement("span",{onClick:function(){return e.onClearButtonClicked()},className:"clear-button"},"CLEAR")),r.a.createElement("div",{className:"columns-container"},this.state.columns.map(function(t,n){return r.a.createElement(tj,{addTag:function(t){return e.addTagToColumn(t,n)},tags:e.state.columnToTags[n],draggingBuffer:function(t){return e.draggingBuffer(t,n)},selectedSound:e.state.selectedSound,onClickSound:function(t){return e.onClickSound(t)},onClickDelete:function(t){return e.deleteSound(n,t)},sounds:t,onDragColumnStart:function(t){return e.onDragColumnStart(t,n)},onDragOver:function(t){return e.onDragOver(t)},onDropToColumn:function(t){return e.onDropToColumn(t,n)}})}),r.a.createElement("div",{className:"column new-column",onDragStart:function(t){return e.onDragStart(t)},onDragOver:function(t){return e.onDragOver(t)},onDrop:function(t){return e.onDropNewColumn(t)},draggable:!0},r.a.createElement("div",{className:"inside"},"Drag Here"))))}}]),t}(a.Component),tj=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={tagValue:"",tags:[]},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onKeyPress",value:function(e){"Enter"===e.key&&(this.props.addTag(this.state.tagValue),this.setState({tagValue:""}))}},{key:"onColumnInputChanged",value:function(e){this.setState({tagValue:e})}},{key:"render",value:function(){var e=this,t=(this.props.columnNumber,this.props.sounds);return r.a.createElement("div",{onDragStart:function(t){return e.props.onDragColumnStart(t)},onDragOver:function(t){return e.props.onDragOver(t)},onDrop:function(t){return e.props.onDropToColumn(t)},draggable:!0,className:"column"},r.a.createElement("div",{className:"tags-container"},r.a.createElement("div",null,r.a.createElement("input",{onKeyUp:function(t){return e.onKeyPress(t)},onChange:function(t){return e.onColumnInputChanged(t.target.value)},value:this.state.tagValue,placeholder:"Type tags here",className:"tags-input",type:"text"})),r.a.createElement("div",null,void 0!=this.props.tags?this.props.tags.map(function(e){return r.a.createElement(A.a,{color:"light"},e)}):"")),t.map(function(t,n){return r.a.createElement($T,{dragging:function(n){return e.props.draggingBuffer(t)},isSelected:e.props.selectedSound==t,onClick:function(){return e.props.onClickSound(t)},buffer:t.audioBuffer,sound:t,width:100,height:60,segments:[],onClickDelete:function(){return e.props.onClickDelete(n)}})}))}}]),t}(a.Component),nj=ej,aj=(n(1037),q.a.Master.context),rj=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={recorderingSetup:!1,isRecording:!1,segments:[],sounds:[],selectedSound:void 0,columns:[],columnToTags:{},tagValue:"",sessionTags:[]},n.setupRecording(),n.recorderTimer=void 0,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"setupRecording",value:function(){var e=this;try{window.AudioContext=window.AudioContext||window.webkitAudioContext,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia,window.URL=window.URL||window.webkitURL,this.audioContext=q.a.Master.context}catch(t){console.log("No web audio support in this browser!")}navigator.getUserMedia({audio:{mandatory:{echoCancellation:!1}}},function(t){return e.startUserMedia(t)},function(e){console.log("No live audio input: "+e)})}},{key:"startUserMedia",value:function(e){this.input=this.audioContext.createMediaStreamSource(e),this.input.channelCount=2,this.recorder=new window.Recorder(this.input,{bufferLen:2048}),this.input.connect(q.a.Master),this.state.recordingSetup=!0,this.setState(this.state)}},{key:"onClickRecordButton",value:function(){this.state.isRecording?this.stopRecording():this.startRecording()}},{key:"startRecording",value:function(){this.recorder.record(),this.setState({isRecording:!0})}},{key:"onUploadButtonClicked",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r,s,i,o;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(o in console.log("onUploadButton clicked"),t=new Fs.a(2,void 0),n=[],a=this.state.columns,r=this.state.columnToTags,s=this.state.sessionTags,console.log("columsn = "),console.log(a),i=function(e){var i=function(i){var o=a[e][i];n.push(new Promise(function(){var n=Object(g.a)(v.a.mark(function n(a,i){var c;return v.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.uploadBufferToIpfs(o.audioBuffer);case 2:c=n.sent,console.log("hash returned = "+c),a({ipfsHash:c,tags:r[e].concat(s)});case 5:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}()))};for(var o in a[e])i(o)},a)i(o);return e.next=12,Promise.all(n);case 12:e.sent.forEach(function(e){var t=e.ipfsHash,n=e.tags;R.a.newSampleWithMetadata(t,"recorded","",n,[null,null,null,null],null,2018)});case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"stopRecording",value:function(){var e=this;this.recorder.stop(),this.setState({isRecording:!1}),this.recorder.getBuffer(function(t){var n=aj.createBuffer(2,t[0].length,aj.sampleRate);n.copyToChannel(t[0],0),n.copyToChannel(t[1],1),e.calculateSegments(n)})}},{key:"calculateSegments",value:function(e){var t=e.getChannelData(0),n=window.api.create_buffer(t.length);window.Module.HEAPF32.set(t,n>>2);var a=window.api.getSegments(n,t.length),r=window.api.get_segments_result_pointer(),s=new Uint32Array(window.Module.HEAP16.buffer,r,2*a);window.api.destroy_buffer(n);for(var i=[],o=1;o<2*a-1;o+=2){s[o],s[o+1];i.push({start:s[o],end:s[o+1]})}s[0]>0&&i.push({start:0,end:s[0]}),this.setState({recordingBuffer:e,segments:i})}},{key:"onClickSplit",value:function(){var e=this;if(0!=this.state.segments.length){this.setState({columns:[]});var t=this.state.segments.map(function(t){return T(e.state.recordingBuffer,t.start,t.end,q.a.Master.context)}).map(function(e){var t=new K.a;return t.audioBuffer=e,t});this.recorder.clear(),this.state.recordingBuffer=void 0,this.setState({sounds:t})}}},{key:"onColumnsChanged",value:function(e){this.setState({columns:e})}},{key:"onColumnTagsChanged",value:function(e){this.setState({columnToTags:e})}},{key:"onClear",value:function(){this.setState({sounds:[],columns:[],columnToTags:[],segments:[]})}},{key:"onSessionTagsInputChanged",value:function(e){this.setState({tagValue:e})}},{key:"onKeyPress",value:function(e){"Enter"===e.key&&(this.setState({sessionTags:this.state.sessionTags.concat([this.state.tagValue])}),this.setState({tagValue:""}))}},{key:"onSessionTagClicked",value:function(e){}},{key:"render",value:function(){var e,t=this,n="";if(console.log("segments = "),console.log(this.state.segments),void 0!==this.state.recordingBuffer&&!this.state.isRecording){var a=new K.a;a.slices=[],a.audioBuffer=this.state.recordingBuffer,n=r.a.createElement($T,{onClick:function(){return[]},buffer:this.state.recordingBuffer,sound:a,segments:this.state.segments,isMainWaveform:!0})}var s="";return(this.state.columns.length>0||this.state.sounds.length>0)&&(s=r.a.createElement(nj,{sounds:this.state.sounds,onClear:function(){return t.onClear()},onColumnsChanged:function(e){return t.onColumnsChanged(e)},onColumnTagsChanged:function(e){return t.onColumnTagsChanged(e)}})),r.a.createElement("div",null,r.a.createElement("div",{className:"header"},"WORLD SAMPLER"),r.a.createElement("div",{className:"session-info-container"},r.a.createElement("div",{className:"question"},"What are we sampling?"),r.a.createElement("div",null,r.a.createElement("input",(e={className:"question-input",onKeyUp:function(e){return t.onKeyPress(e)},onChange:function(e){return t.onSessionTagsInputChanged(e.target.value)},value:this.state.tagValue,placeholder:"Type session tags here"},Object(_e.a)(e,"className","tags-input"),Object(_e.a)(e,"type","text"),e))),r.a.createElement("div",null,this.state.sessionTags.map(function(e){return r.a.createElement(A.a,{onClick:function(){return t.onSessionTagClicked(e)},color:"light"},e)}))),n,r.a.createElement("div",{className:"buttons-container"},r.a.createElement("span",{className:this.state.isRecording?"recording record-btn":"record-btn",onClick:function(){return t.onClickRecordButton()}},this.state.isRecording?"RECORDING":"RECORD"),r.a.createElement("span",{onClick:function(){return t.onUploadButtonClicked()},className:"upload-btn"},"UPLOAD"),this.state.isRecording||void 0===this.state.recordingBuffer?"":r.a.createElement("span",{className:"split-button",onClick:function(){return t.onClickSplit()}},"SPLIT")),s)}}]),t}(a.Component),sj=Object(y.b)(null,null)(rj),ij=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("input",{onChange:function(t){return e.props.onNameChanged(t.target.value)},value:this.props.name,placeholder:"Type name here",className:"tags-input sample-pack-input",type:"text"}),r.a.createElement("div",{className:"info-text"},this.props.editingExisting?"... editing existing":""))}}]),t}(a.Component),oj=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={tagValue:""},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onKeyPress",value:function(e){"Enter"===e.key&&(this.props.onAddTag(this.state.tagValue),this.setState({tagValue:""}))}},{key:"onInputChanged",value:function(e){this.setState({tagValue:e})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("input",{onKeyUp:function(t){return e.onKeyPress(t)},onChange:function(t){return e.onInputChanged(t.target.value)},value:this.state.tagValue,placeholder:"Type sample pack tags here",className:"tags-input sample-pack-input",type:"text"}),r.a.createElement("div",null,this.props.tags.length>0?r.a.createElement("span",{className:"tags-label"},"TAGS:"):"",this.props.tags.map(function(e){return r.a.createElement(A.a,{color:"light"},e)}),this.props.tags.length>0?r.a.createElement("span",{onClick:function(){return e.props.onClearClicked()},className:"clear-tags-button"},"CLEAR"):""))}}]),t}(a.Component),cj=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"sample-list"},void 0!==this.props.soundIds&&this.props.soundIds.length>0?r.a.createElement("div",{className:"sub-header"},"Samples:"):"",this.props.sounds.map(function(t,n){return r.a.createElement($T,{dragging:function(e){return[]},isSelected:e.props.selectedSound==t,onClick:function(){return[]},buffer:t.audioBuffer,sound:t,width:100,height:60,segments:[],onClickDelete:function(){return e.props.onClickDelete(n)}})}))}}]),t}(a.Component),uj=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",{onClick:function(){return e.props.onClickCreate()},className:"big-button"},"CREATE"),r.a.createElement("div",{onClick:function(){return e.props.onClickView()},className:"big-button"},"VIEW"))}}]),t}(a.Component),lj=(n(2558),new Gg),pj=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).ethereumCache=new ol,n.ethereumSearcher=new Pi(n.ethereumCache),n.state={showSelectorView:!1,showSamplePacks:!1,tags:[],sounds:[],name:"",samplePack:void 0,blank:!0},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"createNew",value:function(){this.setState({blank:!1})}},{key:"onClickNew",value:function(){window.confirm("Are you sure you want to clear and start over?")&&this.setState({sounds:[],blank:!0,samplePack:void 0,showSamplePacks:!1,showSelectorView:!1,tags:[],name:""})}},{key:"clearTags",value:function(){this.setState({tags:[]})}},{key:"showSamplePacks",value:function(){this.setState({blank:!1,showSamplePacks:!0})}},{key:"onClickSamplePack",value:function(e){for(var t in this.setState({sounds:[],name:"",tags:[],samplePack:e}),e.samples){var n=e.samples[t],a=e.sampleToSlices[n];this.addSound(n,a)}this.setState({name:e.name}),this.setState({tags:e.tags})}},{key:"onNameChanged",value:function(e){this.setState({name:e})}},{key:"addSound",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a,r=this;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new K.a(t)).slices=n,e.next=4,a.fetchMetadata();case 4:a.fetchAudio().then(function(){console.log("fetched the audio"),console.log(a),r.setState({sounds:r.state.sounds.concat([a])})});case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"addTag",value:function(e){this.setState({tags:this.state.tags.concat([e])})}},{key:"deleteSound",value:function(e){var t=this.state.sounds;t.splice(e,1),this.setState({sounds:t})}},{key:"onClickShowSelectorView",value:function(){this.setState({showSelectorView:!this.state.showSelectorView})}},{key:"onClickHide",value:function(){this.setState({showSelectorView:!1,showSamplePacks:!1})}},{key:"saveSamplePack",value:function(){var e={},t=[];for(var n in this.state.sounds){var a=this.state.sounds[n];t.push(a.ipfsHash),void 0!==a.slices&&a.slices.length>0&&(e[a.ipfsHash]=a.slices)}var r=new Ug(this.state.name,t,this.state.tags,e);void 0!==this.state.samplePack?lj.updateSamplePack(this.state.samplePack.id,r):lj.newSamplePack(r)}},{key:"render",value:function(){var e=this;return this.state.blank?r.a.createElement("div",null,r.a.createElement("div",{className:"header"},"SAMPLE PACK"),r.a.createElement(uj,{onClickCreate:function(){return e.createNew()},onClickView:function(){return e.showSamplePacks()}})):(console.log("show sample packs = "+this.state.showSamplePacks),r.a.createElement("div",{className:"sample-packs"},r.a.createElement("div",{className:"header"},"SAMPLE PACK"),r.a.createElement("div",{className:"main-container"},r.a.createElement("div",{className:"sample-pack-pane"},r.a.createElement(ij,{editingExisting:void 0!==this.state.samplePack,name:this.state.name,onNameChanged:function(t){return e.onNameChanged(t)}}),r.a.createElement(oj,{onClearClicked:function(){return e.clearTags()},onAddTag:function(t){return e.addTag(t)},tags:this.state.tags}),r.a.createElement("div",{className:"main-buttons-container"},r.a.createElement("div",{onClick:function(){return e.saveSamplePack()},className:"common-button light-blue-button"},"SAVE"),r.a.createElement("div",{onClick:function(){return e.onClickNew()},className:"common-button light-blue-button"},"NEW")),r.a.createElement(cj,{onClickDelete:function(t){return e.deleteSound(t)},sounds:this.state.sounds})),r.a.createElement("div",{className:"sounds-searcher-pane"},r.a.createElement("div",{onClick:function(){e.state.showSamplePacks||e.state.showSelectorView?e.onClickHide():e.onClickShowSelectorView()},className:"light-blue-button common-button selector-button"},this.state.showSamplePacks||this.state.showSelectorView?"HIDE":"SEARCH"),this.state.showSamplePacks?r.a.createElement(Kg,{showDeleteButton:!0,onClickSamplePack:function(t){return e.onClickSamplePack(t)}}):"",this.state.showSelectorView?r.a.createElement(Vg,{hideLayer:!0,ethereumSearcher:this.ethereumSearcher,sequencerEngine:{store:this.props.store},onAddSamplePack:function(t){return e.onClickSamplePack(t)},onAddSound:function(t,n,a){return e.addSound(t,a)}}):""))))}}]),t}(a.Component),hj=function(e){function t(e){var n;return Object(o.a)(this,t),n=Object(u.a)(this,Object(l.a)(t).call(this,e)),console.log("userName = "+e.userName),n.state={editingName:!1,nameValue:n.props.userName||""},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"doesUserOwnPage",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t1=this.props.userId,e.next=3,this.props.ethereum.getUser();case 3:if(e.t2=e.sent,e.t0=e.t1===e.t2,e.t0){e.next=7;break}e.t0=void 0===this.props.userId;case 7:return t=e.t0,console.log("does user own page = "+t),e.abrupt("return",t);case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onClickName",value:function(){console.log("onClickName"),this.props.isEditing&&this.setState({editingName:!0})}},{key:"onKeyPress",value:function(e){"Enter"===e.key&&this.chooseUserName()}},{key:"chooseUserName",value:function(){this.props.ethereum.users.setUserName(this.state.nameValue),this.setState({editingName:!1}),""!==this.state.nameValue&&this.props.onUserNameUpdated(this.state.nameValue)}},{key:"isEditing",value:function(){return void 0===this.props.userName||this.state.editingName}},{key:"render",value:function(){var e=this,t="";return t=this.isEditing()&&this.doesUserOwnPage()?r.a.createElement(A.h,{className:"tag-sound-input"},r.a.createElement(A.g,{onChange:function(t){e.state.nameValue=t.target.value,e.setState(e.state)},value:this.state.nameValue,onKeyUp:function(t){return e.onKeyPress(t)},placeholder:"Choose a user name",className:"tag-sound-input-box"}),r.a.createElement(A.i,{addonType:"append"},r.a.createElement(A.b,{size:"sm",onClick:function(){return e.chooseUserName()},color:"secondary"},"Done"))):r.a.createElement("span",{onClick:function(){return e.onClickName()},className:"user-name"},this.props.userName),r.a.createElement("div",{className:"user-info"},r.a.createElement("div",{className:"user-profile-picture-container"},void 0===this.props.profilePicture?r.a.createElement("div",{className:"user-no-profile-picture"}):""),r.a.createElement("div",{className:"user-main-info-container"},r.a.createElement("div",{className:"user-info-part-container"},t),r.a.createElement("div",{className:"user-info-part-container"},r.a.createElement("span",{className:"user-location"},"World Galaxy"))))}}]),t}(a.Component),dj=(a.Component,function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={guilds:[],selectedGuild:void 0,ownUserName:""},n.fetchUserName(),n.fetchGuilds(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"fetchUserName",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.ethereum.users.getUserName(this.state.userId);case 2:t=e.sent,this.setState({ownUserName:t});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fetchGuilds",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.guilds.getGuildsForUser();case 2:t=e.sent,this.setState({guilds:t});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getGuildsOptions",value:function(){return this.state.guilds.map(function(e){return{label:e.name,value:e.guildId}})}},{key:"onSelectGuild",value:function(e){this.setState({selectedGuild:e})}},{key:"getSelectedGuild",value:function(){return this.state.selectedGuild}},{key:"connectWithUser",value:function(){void 0!==this.state.selectedGuild?this.props.guilds.requestToAddMember(this.state.selectedGuild.value,this.props.userId):this.props.guilds.connectWithUser(this.props.userId),this.props.hide()}},{key:"render",value:function(){var e=this;void 0!==this.props.preset&&this.props.preset.name;return r.a.createElement(D.a,{dialogClassName:"preset-modal",show:this.props.show,onHide:this.props.hide},r.a.createElement(D.a.Header,{closeButton:!0},r.a.createElement(D.a.Title,null,"Connect with ",this.props.userName)),r.a.createElement(D.a.Body,null,r.a.createElement(O,{condition:this.state.guilds.length>0},r.a.createElement(pp.a,{className:"",options:this.getGuildsOptions(),onChange:function(t){return e.onSelectGuild(t)},value:this.getSelectedGuild(),placeholder:"Choose guild to connect via"})),"Send a request to link up to your ",this.state.ownUserName," account."),r.a.createElement(D.a.Footer,null,r.a.createElement(A.b,{variant:"secondary",onClick:function(){return e.connectWithUser()}},"Ok"),r.a.createElement(A.b,{variant:"primary",onClick:this.props.hide},"Cancel")))}}]),t}(a.Component)),fj=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={commentText:""},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onMessage",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.a.messaging.sendMessage(void 0,void 0,void 0,this.state.commentText);case 2:this.props.hide();case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement(D.a,{dialogClassName:"preset-modal",show:this.props.show,onHide:this.props.hide},r.a.createElement(D.a.Header,{closeButton:!0},r.a.createElement(D.a.Title,null,"Message ",this.props.userName)),r.a.createElement(D.a.Body,null,r.a.createElement(A.h,{className:"tag-sound-input"},r.a.createElement(A.g,{onChange:function(t){e.state.commentText=t.target.value,e.setState(e.state)},type:"textarea",value:this.state.commentText,placeholder:"Write a note",className:"comment-input-box"}),r.a.createElement(A.i,{addonType:"append"},r.a.createElement(A.b,{size:"sm",onClick:function(){return e.onMessage()},color:"secondary"},"Send")))),r.a.createElement(D.a.Footer,null,r.a.createElement(A.b,{variant:"secondary",onClick:function(){return e.onMessage()}},"Done"),r.a.createElement(A.b,{variant:"primary",onClick:this.props.hide},"Cancel")))}}]),t}(a.Component),mj=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={showConnectModal:!1,showMessageModal:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickDirectMessage",value:function(){this.setState({showMessageModal:!0})}},{key:"onClickConnect",value:function(){this.setState({showConnectModal:!0})}},{key:"onClickMessage",value:function(){}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"profile-navigator"},r.a.createElement(fj,{userName:this.props.userName,userId:this.props.userId,hide:function(){return e.setState({showMessageModal:!1})},show:this.state.showMessageModal}),r.a.createElement(dj,{userName:this.props.userName,ethereum:this.props.ethereum,guilds:this.props.guilds,userId:this.props.userId,hide:function(){return e.setState({showConnectModal:!1})},show:this.state.showConnectModal}),r.a.createElement("div",{onClick:function(){return e.props.setUserViewMode("SPOTLIGHT")},className:"SPOTLIGHT"===this.props.viewMode?"selected navigator-option":"navigator-option"},"Spotlight"),r.a.createElement("div",{onClick:function(){return e.props.setUserViewMode("MIXES")},className:"MIXES"===this.props.viewMode?"selected navigator-option":"navigator-option"},"Mixes"),r.a.createElement(O,{condition:this.props.isEditing},r.a.createElement("div",{onClick:function(){return e.props.setUserViewMode("LINKS")},className:"LINKS"===this.props.viewMode?"selected navigator-option":"navigator-option"},"Links")),r.a.createElement(O,{condition:this.props.hasEditsToSave&&this.props.isEditing},r.a.createElement("div",{onClick:this.props.onClickSave,className:"navigator-option save-option"},"SAVE")),r.a.createElement(O,{condition:!0},r.a.createElement("div",{className:"left-buttons"},r.a.createElement("div",null,r.a.createElement("img",{onClick:function(){return e.onClickDirectMessage()},className:"direct-message-button",src:"/direct-message.png"})),r.a.createElement("div",{onClick:function(){return e.onClickConnect()},className:"common-button pink-button connect-button"},"CONNECT"))))}}]),t}(a.Component),vj=Object(y.b)(function(e,t){return{viewMode:e.user.viewMode,hasEditsToSave:e.user.hasEditsToSave}},function(e){return{setUserViewMode:function(t){return e(Object(w.ve)(t))}}})(mj),gj=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t="SPOTLIGHT"===this.props.viewMode?"ADD TRACKS TO SPOTLIGHT":"ADD TRACKS TO MIX";return this.props.isEditing&&this.props.userLoaded?r.a.createElement("div",{onClick:function(){return e.props.onClickAddTrack()},className:"add-spotlight-track"},t):(console.log("did not show the add tracks button because isEditing = "+this.props.isEditing+" and userLoaded="+this.props.userLoaded),r.a.createElement("div",null))}}]),t}(a.Component),bj=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickMix",value:function(e){this.props.setCurrentUserMix(e.getJson())}},{key:"onClickDeleteMix",value:function(e,t){e.stopPropagation(),this.props.onClickDeleteMix(t)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,this.props.mixes.map(function(t){return r.a.createElement("div",{onClick:function(){return e.onClickMix(t)},className:"user-mix"},t.name,r.a.createElement(O,{condition:e.props.isEditing},r.a.createElement("div",{onClick:function(n){return e.onClickDeleteMix(n,t)},className:"delete-button"},"x")))}))}}]),t}(a.Component),yj=Object(y.b)(null,function(e){return{setCurrentUserMix:function(t){return e(Object(w.bb)(t))}}})(bj),kj=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={nameValue:"",editingName:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onNewMix",value:function(){var e=(new OC).getJson();this.props.setCurrentUserMix(e),this.props.addEditedMix((new OC).fromJson(e)),this.props.setUserHasEditsToSave(!0),this.setState({nameValue:""})}},{key:"onKeyPress",value:function(e){"Enter"===e.key&&this.chooseMixName()}},{key:"chooseMixName",value:function(){if(this.props.isEditing){var e=(new OC).fromJson(this.props.currentMix);e.name=this.state.nameValue,this.props.setCurrentUserMix(e.getJson()),this.props.setUserHasEditsToSave(!0),this.setState({editingName:!1})}}},{key:"getName",value:function(){return void 0===this.props.currentMix?void 0:(new OC).fromJson(this.props.currentMix).name}},{key:"onBackToMixes",value:function(){this.props.addEditedMix((new OC).fromJson(this.props.currentMix)),this.props.setCurrentUserMix(void 0)}},{key:"onClickName",value:function(){this.props.isEditing&&this.setState({editingName:!0,nameValue:this.getName()})}},{key:"render",value:function(){var e=this;return void 0===this.props.currentMix&&this.props.isEditing?r.a.createElement("div",{onClick:function(){return e.onNewMix()},className:"new-mix-button"},"NEW MIX"):r.a.createElement("div",{className:"mix-name-container"},r.a.createElement(O,{condition:this.props.isEditing&&(this.state.editingName||void 0===this.getName())},r.a.createElement(A.h,{className:"tag-sound-input mix-name-container"},r.a.createElement(A.g,{onChange:function(t){e.state.nameValue=t.target.value,e.setState(e.state)},value:this.state.nameValue,onKeyUp:function(t){return e.onKeyPress(t)},placeholder:"Choose a mix name",className:"tag-sound-input-box"}),r.a.createElement(A.i,{addonType:"append"},r.a.createElement(A.b,{size:"sm",onClick:function(){return e.chooseMixName()},color:"secondary"},"Done")))),r.a.createElement(O,{condition:!this.state.editingName&&void 0!==this.getName()},r.a.createElement("div",{className:"mix-name-and-back"},r.a.createElement("div",{onClick:function(){return e.onClickName()},className:"mix-name"},this.getName()),r.a.createElement("div",{onClick:function(){return e.onBackToMixes()},className:"back-to-mixes"},"BACK"))),r.a.createElement("div",{className:"clear-fix"}))}}]),t}(a.Component),Ej=Object(y.b)(function(e,t){return{currentMix:e.user.currentMix}},function(e){return{setCurrentUserMix:function(t){return e(Object(w.bb)(t))},setUserHasEditsToSave:function(t){return e(Object(w.te)(t))}}})(kj),Sj=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={guilds:[]},n.fetchGuilds(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"fetchGuilds",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.ethereum.guilds.getGuildsForUser();case 2:t=e.sent,this.setState({guilds:t});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"leaveGuild",value:function(){if(window.confirm("Are you sure you want to leave this guild?")){this.props.ethereum.guilds.leaveGuild(this.props.selectedGuild);var e=Object(ge.a)(this.state.guilds),t=e.indexOf(this.props.selectedGuild);e.splice(t,1),this.setState({guilds:e}),this.props.onClickGuild(this.props.selectedGuild)}}},{key:"renameGuild",value:function(){}},{key:"render",value:function(){var e=this;return 0===this.state.guilds.length?r.a.createElement("div",null):r.a.createElement("div",{className:"guilds"},r.a.createElement("div",{className:"linked-count"},"And ",r.a.createElement("span",{className:"linked-count-number"},this.state.guilds.length)," guilds"),this.state.guilds.map(function(t){return r.a.createElement(Oj,{selected:t.guildId===e.props.selectedGuild,onClickGuild:function(){return e.props.onClickGuild(t.guildId)},guild:t})}),r.a.createElement(O,{condition:this.props.selectedGuild},r.a.createElement("div",{className:"guild-action-buttons"},r.a.createElement("div",{onClick:function(){return e.leaveGuild()},className:"guild-action-button common-button pink-button"},"Leave Guild"),r.a.createElement("div",{onClick:function(){return e.renameGuild()},className:"guild-action-button common-button pink-button"},"Rename Guild"))))}}]),t}(a.Component),Oj=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.selected?"guild selected":"guild";return r.a.createElement("div",{onClick:this.props.onClickGuild,className:e},r.a.createElement("div",{className:"linked-user-name"},""===this.props.guild.name?this.props.guild.guildId:this.props.guild.name))}}]),t}(a.Component),wj=Sj,Cj=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={nameValue:""},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onInputType",value:function(e){this.setState({nameValue:e})}},{key:"setGuildName",value:function(){this.props.ethereum.guilds.setGuildName(this.props.member.guildId,this.state.nameValue),this.props.hide()}},{key:"render",value:function(){var e=this;if(void 0===this.props.member)return console.log("returning nothing"),r.a.createElement("div",null);var t=this.props.member?this.props.member.userName:"",n=this.props.member?this.props.member.guildName:void 0;return r.a.createElement(D.a,{dialogClassName:"preset-modal",show:void 0!==this.props.member,onHide:this.props.hide},r.a.createElement(D.a.Header,{closeButton:!0},r.a.createElement(D.a.Title,null,t)),r.a.createElement(D.a.Body,null,r.a.createElement(O,{condition:""===n},"Name the guild between you and ",t,r.a.createElement(A.g,{value:this.state.nameValue,onChange:function(t){return e.onInputType(t.target.value)},placeholder:"Type name for guild",className:"tag-input"}))),r.a.createElement(D.a.Footer,null,r.a.createElement(A.b,{variant:"secondary",onClick:function(){return e.setGuildName()}},"Ok"),r.a.createElement(A.b,{variant:"primary",onClick:this.props.hide},"Cancel")))}}]),t}(a.Component),Pj=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={members:[],selectedMember:void 0},n.fetchMembers(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"fetchMembers",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"onClickMember",value:function(e){""===e.guildName?this.setState({selectedMember:e}):window.open("/user/"+e.userName,"_blank")}},{key:"onHideModal",value:function(){console.log("on hide"),this.setState({selectedMember:void 0})}},{key:"getLinkedMembers",value:function(){var e=this;return void 0===this.props.selectedGuild?this.state.members:this.state.members.filter(function(t){return t.guildId===e.props.selectedGuild})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"linked-members"},r.a.createElement(Cj,{ethereum:this.props.ethereum,hide:function(){return e.onHideModal()},member:this.state.selectedMember}),r.a.createElement("div",{className:"linked-count"},"You are connected to ",r.a.createElement("span",{className:"linked-count-number"}," ",this.state.members.length," ")," artists"),this.getLinkedMembers().map(function(t){return r.a.createElement(Tj,{onClickMember:function(){return e.onClickMember(t)},member:t})}))}}]),t}(a.Component),Tj=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{onClick:this.props.onClickMember,className:"linked-member"},r.a.createElement("div",{className:"linked-user-name"},this.props.member.userName," "),r.a.createElement(O,{condition:""!==this.props.member.guildName},r.a.createElement("div",{className:"guild-name"},this.props.member.guildName)))}}]),t}(a.Component),jj=Pj,xj=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={selectedGuild:void 0},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickGuild",value:function(e){e===this.state.selectedGuild?this.setState({selectedGuild:void 0}):this.setState({selectedGuild:e})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"links-view"},r.a.createElement(jj,{selectedGuild:this.state.selectedGuild,ethereum:this.props.ethereum}),r.a.createElement(wj,{selectedGuild:this.state.selectedGuild,onClickGuild:function(t){return e.onClickGuild(t)},ethereum:this.props.ethereum}),r.a.createElement(kP,{ethereum:this.props.ethereum}))}}]),t}(a.Component),Nj=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={showSequences:!1,newMix:!1},n.loadTrack=n.loadTrack.bind(Object(p.a)(n)),n.unloadTrack=n.unloadTrack.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickAddTrack",value:function(){this.setState({showSequences:!0})}},{key:"hideSequences",value:function(){this.setState({showSequences:!1})}},{key:"getOrderedTracks",value:function(){var e=this;return"MIXES"==this.props.viewMode?void 0===this.props.currentMix?[]:(new OC).fromJson(this.props.currentMix).tracks:this.props.spotlightTracks.filter(function(t){return void 0!==e.props.multiSequencerEngine.getSequencerEngine(t.id)}).concat(this.props.spotlightTracks.filter(function(t){return!e.props.multiSequencerEngine.getSequencerEngine(t.id)}))}},{key:"getTracks",value:function(){return"MIXES"==this.props.viewMode?void 0===this.props.currentMix?[]:(new OC).fromJson(this.props.currentMix).tracks:this.props.spotlightTracks}},{key:"getAllTracks",value:function(){var e={};for(var t in this.props.spotlightTracks)e[this.props.spotlightTracks[t].id]=this.props.spotlightTracks[t];for(var n in this.props.mixes){var a=this.props.mixes[n];for(var r in a.tracks)e[a.tracks[r].id]=a.tracks[r]}return Object.values(e)}},{key:"filterLoadedTracks",value:function(e,t){var n=this;if(t){var a=new Set(this.props.loadedTracks);return e.filter(function(e){return a.has(e.id)})}return e.filter(function(e){return!n.props.multiSequencerEngine.getSequencerEngine(e.id)})}},{key:"loadTrack",value:function(e){this.props.multiSequencerEngine.loadTrack(e);var t=new Set(this.props.loadedTracks);t.add(e),this.props.setLoadedTracks(Array.from(t))}},{key:"unloadTrack",value:function(e){this.props.multiSequencerEngine.unloadTrack(e);var t=new Set(this.props.loadedTracks);t.delete(e),this.props.setLoadedTracks(Array.from(t))}},{key:"saveAsMix",value:function(e){var t=new OC;t.tracks=e,this.props.setCurrentUserMix(t.getJson()),this.props.addEditedMix(t),this.props.setUserHasEditsToSave(!0),this.props.setViewMode("MIXES")}},{key:"render",value:function(){var e=this;return void 0!==this.props.sequencerEngineEditing?r.a.createElement("div",null):"LINKS"===this.props.viewMode?r.a.createElement(xj,{ethereum:this.props.ethereum,userId:this.props.userId}):r.a.createElement("div",{className:"profile-details"},r.a.createElement("div",{className:"left-pane"},r.a.createElement(O,{condition:"MIXES"==this.props.viewMode},r.a.createElement(Ej,{isEditing:this.props.isEditing,addEditedMix:this.props.addEditedMix,currentMix:this.props.currentMix})),r.a.createElement("div",{className:"spotlight-pane"},r.a.createElement(O,{condition:!this.state.showSequences&&("SPOTLIGHT"===this.props.viewMode||void 0!==this.props.currentMix)},r.a.createElement(gj,{viewMode:this.props.viewMode,userLoaded:this.props.userLoaded,isEditing:this.props.isEditing,onClickAddTrack:function(){return e.onClickAddTrack()}})),r.a.createElement(O,{condition:void 0===this.props.currentMix&&"MIXES"==this.props.viewMode},r.a.createElement(yj,{isEditing:this.props.isEditing,onClickDeleteMix:this.props.onClickDeleteMix,mixes:this.props.mixes}))),r.a.createElement("div",{className:"clear-fix"}),r.a.createElement(qC,{multiSequencerEngine:this.props.multiSequencerEngine,loadTrack:this.loadTrack,unloadTrack:this.unloadTrack,tracks:this.getTracks(),isEditing:this.props.isEditing,ethereum:this.props.ethereum,onEditSequence:this.props.onEditSequence,onDeleteTrack:this.props.onDeleteTrack,store:this.props.store})),r.a.createElement("div",null,r.a.createElement(gC,{isEditing:this.props.isEditing,saveAsMix:function(t){return e.saveAsMix(t)},multiSequencerEngine:this.props.multiSequencerEngine,tracks:this.filterLoadedTracks(this.getAllTracks(),!0)},r.a.createElement(qC,{isPlayable:!0,multiSequencerEngine:this.props.multiSequencerEngine,userId:this.props.userId,tracks:this.filterLoadedTracks(this.getAllTracks(),!0),loadTrack:this.loadTrack,unloadTrack:this.unloadTrack,isEditing:this.props.isEditing,ethereum:this.props.ethereum,onEditSequence:this.props.onEditSequence,onDeleteTrack:this.props.onDeleteTrack,store:this.props.store})),r.a.createElement(O,{condition:this.state.showSequences},r.a.createElement("div",{className:"sequences-chooser-wrapper"},r.a.createElement("div",{onClick:function(){return e.hideSequences()},className:"add-spotlight-track"},"HIDE"),r.a.createElement(lb,{filterByUser:"SPOTLIGHT"===this.props.viewMode,onLoad:function(t){return e.props.addTrack(t)}})))))}}]),t}(a.Component),qj=Object(y.b)(void 0,function(e){return{setLoadedTracks:function(t){return e(Object(w.Sb)(t))},setCurrentUserMix:function(t){return e(Object(w.bb)(t))},setUserHasEditsToSave:function(t){return e(Object(w.te)(t))},setViewMode:function(t){return e(Object(w.ye)(t))}}})(Nj),Mj=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"ethereum-instructions"},r.a.createElement("div",{className:"ethereum-action"},"1. You need the Metamask Chrome-plugin to connect Universal Sequences with Ethereum. Install it ",r.a.createElement("a",{href:"https://chrome.google.com/webstore/detail/metamask/nkbihfbeogaeaoehlefnkodbefgpgknn?hl=en"}," here "),". Unless you have it installed, but are not logged in. If so click on the metamask and type your password."),r.a.createElement("div",{className:"ethereum-action"},"2. Watch the first minute of this ",r.a.createElement("a",{href:"https://www.youtube.com/watch?v=6Gf_kRE4MJU"}," video ")," to learn how to set up a new account. All sounds you sample and tracks you create will be tied to the account you have logged on in Metamask."),r.a.createElement("div",{className:"ethereum-action"},'3. Switch to the "Ropsten" test network on Metamask'),r.a.createElement("div",{className:"ethereum-action"},r.a.createElement("img",{src:"/metamask-ropsten.png"})),r.a.createElement("div",{className:"ethereum-action"},"4. Get free test Ether from this ",r.a.createElement("a",{href:"https://faucet.metamask.io/"}," website "),' and clicking the "request 1 ether from faucet" button.'),r.a.createElement("div",{className:"ethereum-action"},'5. Reload this page and choose a user name. When you choose your name, Metamask will pop-up asking you to confirm a transaction, costing some (free) Ether. It\'s test money (i.e. not worth anything) so go ahead and click "Confirm".'),r.a.createElement("div",{className:"ethereum-action"},"6. Go to the ",r.a.createElement("a",{href:"/sequencer/"}," sequencer ")," page and make a track. When you hit save, a Metamask pop-up will ask you to confirm that transaction. Whenever we save stuff (whether new sounds or tracks), you will need to confirm the transaction and cough up free test Ether."),r.a.createElement("div",{className:"ethereum-action"},"7. Finally, have fun."))}}]),t}(a.Component),Dj=(n(2559),function(e){function t(e){var n;Object(o.a)(this,t),n=Object(u.a)(this,Object(l.a)(t).call(this,e)),"MacIntel"===navigator.platform?q.a.setContext(new AudioContext({sampleRate:ee})):q.a.setContext(new AudioContext({sampleRate:$}));var a=void 0!=e.match.params.userId?e.match.params.userId:void 0;return n.state={mixes:[],profile:void 0,userName:a,hasEthereum:!0,loadedUser:!1,userId:void 0,userNameNotFound:!1,sequencerEngineEditing:void 0,spotlightTracks:[],isPermissionedUser:void 0===a},q.a.context.latencyHint="balanced",n.props.setIsPlayingMix(!0),n.loadProfile(),n.multiSequencerEngine=new Al(n.props.store),R.a.crypto.store=n.props.store,n.onClickSave=n.onClickSave.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClickSave",value:function(){var e=this.props.spotlightTracks.map(function(e){return e.id}),t=this.props.profile;void 0===t&&(t={mixes:[]}),t.spotlightTracks=e,void 0!==this.props.currentMix&&this.addEditedMix((new OC).fromJson(this.props.currentMix)),t.mixes=this.state.mixes.map(function(e){return e.getJson(!1)}),R.a.users.setProfile(t),this.props.setUserHasEditsToSave(!1)}},{key:"deleteTrack",value:function(e){var t=this,n=this.multiSequencerEngine.getSequencerEngine(e.id);if(void 0!==n&&(n.playing&&n.stop(),setTimeout(function(){t.multiSequencerEngine.unloadTrack(e.id)},5e3)),"MIXES"===this.props.viewMode){var a=(new OC).fromJson(this.props.currentMix);a.deleteTrack(e),this.props.setCurrentUserMix(a.getJson()),this.props.setUserHasEditsToSave(!0)}else{var r=Object(ge.a)(this.props.spotlightTracks),s=r.indexOf(e);r.splice(s,1),this.props.setSpotlightTracks(r),this.props.setUserHasEditsToSave(!0)}}},{key:"loadMixes",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t&&void 0!==t.mixes){e.next=2;break}return e.abrupt("return");case 2:n=t.mixes.map(function(e){return(new OC).fromJson(e)}),this.setState({mixes:n});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadSpotlightTracks",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n=this;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=4;break}this.props.setSpotlightTracks([]),e.next=5;break;case 4:return e.delegateYield(v.a.mark(function e(){var a,r,s,i;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(i in a=t.spotlightTracks,console.log("loading spotlight tracks profile.tracks = "),console.log(a),r=[],s=function(e){r.push(new Promise(function(){var t=Object(g.a)(v.a.mark(function t(r,s){return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=r,t.t1=n,t.next=4,R.a.getSequence(a[e]);case 4:t.t2=t.sent,t.t3=t.t1.convertSequence.call(t.t1,t.t2),(0,t.t0)(t.t3);case 7:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()))},a)s(i);return e.t0=n.props,e.next=9,Promise.all(r);case 9:e.t1=e.sent,e.t0.setSpotlightTracks.call(e.t0,e.t1);case 11:case"end":return e.stop()}},e)})(),"t0",5);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"convertSequence",value:function(e){return Object(X.a)({},e,{name:e.title,id:e.newSequence})}},{key:"addTrack",value:function(e){if(console.log("add track = "),console.log(e),"MIXES"===this.props.viewMode){var t=(new OC).fromJson(this.props.currentMix);t.tracks.push(e),this.props.setCurrentUserMix(t.getJson()),this.props.setUserHasEditsToSave(!0)}else this.props.setUserHasEditsToSave(!0),this.props.setSpotlightTracks(this.props.spotlightTracks.concat([e]))}},{key:"addEditedMix",value:function(e){var t=[],n=!1;for(var a in this.state.mixes){var r=this.state.mixes[a];r.id===e.id?(t.push(e),n=!0):t.push(r)}n||t.push(e),this.setState({mixes:t})}},{key:"onClickDeleteMix",value:function(e){var t=void 0;for(var n in this.state.mixes)if(this.state.mixes[n].id===e.id){t=n;break}if(void 0!==t){var a=Object(ge.a)(this.state.mixes);a.splice(t,1),this.setState({mixes:a}),this.props.setUserHasEditsToSave(!0)}}},{key:"doesUserOwnPage",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t1=this.state.userId,e.next=3,R.a.getUser();case 3:if(e.t2=e.sent,e.t0=e.t1===e.t2,e.t0){e.next=7;break}e.t0=void 0===this.state.userId;case 7:return t=e.t0,e.abrupt("return",t);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loadProfile",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,void 0===this.state.userName){e.next=13;break}return e.next=4,R.a.users.isUserNameAvailable(this.state.userName);case 4:if(e.sent){e.next=11;break}return e.next=8,R.a.users.getUserId(this.state.userName);case 8:this.state.userId=e.sent,e.next=13;break;case 11:return this.setState({userNameNotFound:!0,userLoaded:!0}),e.abrupt("return");case 13:return e.next=15,R.a.users.getProfile(this.state.userId);case 15:t=e.sent,this.setState({profile:t,userLoaded:!0}),this.loadMixes(t),this.loadSpotlightTracks(t),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(0),"no user name"==e.t0||("no profile"===e.t0?this.setState({userLoaded:!0}):"no ethereum"===e.t0&&this.setState({hasEthereum:!1}));case 24:return e.prev=24,e.next=27,R.a.users.getUserName(this.state.userId);case 27:n=e.sent,this.setState({userName:n}),e.next=34;break;case 31:e.prev=31,e.t1=e.catch(24),console.log("error loading username "+e.t1);case 34:case"end":return e.stop()}},e,this,[[0,21],[24,31]])}));return function(){return e.apply(this,arguments)}}()},{key:"onEditSequence",value:function(e){this.setState({sequencerEngineEditing:e})}},{key:"onGoBack",value:function(){this.setState({sequencerEngineEditing:void 0})}},{key:"render",value:function(){var e=this;if(this.state.userNameNotFound)return r.a.createElement("div",{className:""},"User name not found");var t=r.a.createElement(qj,{userLoaded:this.state.userLoaded,userId:this.state.userId,onClickDeleteMix:function(t){return e.onClickDeleteMix(t)},mixes:this.state.mixes,currentMix:this.props.currentMix,onClickSave:function(){return e.onClickSave()},spotlightTracks:this.props.spotlightTracks,sequencerEngineEditing:this.state.sequencerEngineEditing,multiSequencerEngine:this.multiSequencerEngine,setIsPlayingMix:function(t){return e.props.setIsPlayingMix(t)},isEditing:void 0===this.state.userId,ethereum:R.a,addEditedMix:function(t){return e.addEditedMix(t)},onDeleteTrack:function(t){return e.deleteTrack(t)},viewMode:this.props.viewMode,addTrack:function(t){return e.addTrack(t)},setLoadingSequence:this.props.setLoadingSequence,onEditSequence:function(t){return e.onEditSequence(t)},loadedTracks:this.props.loadedTracks,isPlaying:this.props.isPlaying,store:this.props.store,profile:this.state.profile});return this.state.sequencerEngineEditing?r.a.createElement("div",null,r.a.createElement(mC,{onGoBack:function(){return e.onGoBack()},store:this.props.store,sequencerEngine:this.state.sequencerEngineEditing}),t):r.a.createElement("div",{className:"user-page"},r.a.createElement(DC,null),r.a.createElement(my,{crypto:R.a.crypto,show:!0}),r.a.createElement(O,{condition:this.state.hasEthereum},r.a.createElement("div",{className:"profile-container"},r.a.createElement("div",{className:"banner"},r.a.createElement(hj,{onUserNameUpdated:function(t){return e.setState({userName:t})},userId:this.state.userId,isEditing:void 0===this.state.userId,ethereum:R.a,userName:this.state.userName,profilePicture:this.state.profilePicture,profile:this.state.profile})),r.a.createElement(vj,{ethereum:R.a,guilds:R.a.guilds,userName:this.state.userName,userId:this.state.userId,isEditing:void 0===this.state.userId,onClickSave:this.onClickSave}),t)),r.a.createElement(O,{condition:!this.state.hasEthereum},r.a.createElement("div",{className:"profile-container"},r.a.createElement("div",{className:"profile-details"},r.a.createElement(Mj,null)))))}}]),t}(a.Component)),Aj=Object(y.b)(function(e){return{viewMode:e.user.viewMode,currentMix:e.user.currentMix,loadedTracks:e.user.loadedTracks,isPlaying:e.sequencer.isPlaying,spotlightTracks:e.user.spotlightTracks}},function(e){return{setIsPlayingMix:function(t){return e(Object(w.Ib)(t))},setLoadingSequence:function(t,n){return e(Object(w.Tb)(t,n))},setUserHasEditsToSave:function(t){return e(Object(w.te)(t))},setCurrentUserMix:function(t){return e(Object(w.bb)(t))},setSpotlightTracks:function(t){return e(Object(w.Kd)(t))}}})(Dj),Rj=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("input",{onChange:function(t){return e.props.onTagNameChanged(t.target.value)},value:this.props.tag,placeholder:"Type name here",className:"tags-input sample-pack-input",type:"text"}))}}]),t}(a.Component),Ij=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:this.props.chosen?"tag-element chosen":this.props.chosenAlready?"chosen-already tag-element":"tag-element",onClick:function(){return e.props.onClick()}},this.props.tag)}}]),t}(a.Component),Lj=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",{className:"instructions-text"},"Click tags that fall under this category"),r.a.createElement("div",{className:"tags-container"},this.props.tags.map(function(t){return r.a.createElement(Ij,{chosenAlready:e.props.chosenSoFar.has(t),chosen:e.props.tagsChosen.indexOf(t)>-1,onClick:function(){return e.props.onClickTag(t)},tag:t})})))}}]),t}(a.Component),Fj=(n(2560),["707","808","909","Access","Casio","Cheetah","EMU","Electro-Harmonix","Elektron","Elka","Fairlight","Farfisa","Fricke","Kawai","Korg","Linn","Moog","Nintendo","Oberheim","Roland"]),Vj=new ci,Bj=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).ethereumCache=new ol,n.ethereumSearcher=new Pi(n.ethereumCache),n.state={tagName:"",tagsChosen:[],tags:[],hierarchy:{},nextMode:!1},n.stack=[],n.tags=[],n.chosenSoFar=new Set,n.reloadEverything(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"reloadEverything",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:0,e.next=3,this.ethereumCache.loadNewIndex(t);case 3:this.loadTags(),this.chosenSoFar=new Set,this.getHierarchy(t);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getHierarchy",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.length>0&&void 0!==t[0]?t[0]:this.props.guildId,console.log("getHierarchy called"),this.autoBuild();case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"autoBuild",value:function(){var e=this;console.log("auto build called with tags = "),console.log(this.state.tags);var t={"Drum Machines":[],Drums:["kick","snare","hi-hat","clap","crash","rim","side-stick","ride"]},n=function(n){var a=Fj[n],r=e.state.tags.filter(function(e){return e!==a&&e.includes(a)});r.length>0&&(t["Drum Machines"].push(a),t[a]=r,r.forEach(function(t){return e.chosenSoFar.add(t)}),e.chosenSoFar.add(a))};for(var a in Fj)n(a);this.setState({hierarchy:Object(X.a)({},this.state.hierarchy,t)})}},{key:"shouldComponentUpdate",value:function(e){return e.guildId!==this.props.guildId&&this.reloadEverything(e.guildId),!0}},{key:"loadTags",value:function(){this.tags=this.ethereumCache.getAllForField(di,0,3e3).map(function(e){return e.value}),this.tags.sort(),this.setState({tags:this.tags})}},{key:"onTagNameChanged",value:function(e){this.state.tagsChosen.length>0&&this.addTagsToHierarchy(),e in this.state.hierarchy?this.setState({tagsChosen:this.state.hierarchy[e]}):this.setState({tagsChosen:[]}),this.setState({tagName:e})}},{key:"onClickTag",value:function(e){if(this.state.nextMode){var t=this.state.hierarchy[e];return t=void 0===t?[]:t,void this.setState({tagName:e,nextMode:!1,tagsChosen:t,tags:this.tags})}var n=this.state.tagsChosen.indexOf(e);if(n>-1){var a=this.state.tagsChosen;a.splice(n,1),this.setState({tagsChosen:a})}else this.setState({tagsChosen:this.state.tagsChosen.concat([e])})}},{key:"addTagsToHierarchy",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.tagName,Object.assign(this.state.hierarchy,{}));t[this.state.tagName]=this.state.tagsChosen,console.log("adding to "+this.state.tagName+" tags ="),console.log(this.state.tagsChosen),this.state.tagsChosen.forEach(function(t){return e.chosenSoFar.add(t)}),this.setState({hierarchy:t}),console.log("hierarchy = "),console.log(t)}},{key:"goBackUpLevel",value:function(){if(this.addTagsToHierarchy(),0!=this.stack.length){var e=this.stack.pop();this.setState({nextMode:!1,tagName:e.name,tags:this.tags,tagsChosen:e.tags})}else this.setState({nextMode:!1,tagName:"",tags:this.tags,tagsChosen:[]})}},{key:"goDownLevel",value:function(){this.state.nextMode||(this.stack.push({name:this.state.tagName,tags:this.state.tagsChosen}),this.addTagsToHierarchy(),this.setState({nextMode:!0,tagsChosen:[],tags:this.state.tagsChosen}))}},{key:"getRelevantTags",value:function(){this.setState({tags:Array.from(this.ethereumCache.getFieldsForField(di,di,this.state.tagName)).sort()})}},{key:"clearRelevantTags",value:function(){this.setState({tags:this.tags})}},{key:"saveHierarchy",value:function(){var e=Object(g.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("saving the tags classification = "),console.log(this.state.hierarchy),delete this.state.hierarchy[""],e.next=5,Vj.saveClassifications(this.props.guildId,this.state.hierarchy);case 5:e.sent;case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"deleteCategory",value:function(){var e=Object(X.a)({},this.state.hierarchy),t=e[this.state.tagName];delete e[this.state.tagName],t.forEach(function(t){return delete e[t]}),console.log("new hierarchy = "),console.log(e),this.setState({hierarchy:e,tagName:""})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",{className:"tags-navigator"},r.a.createElement("div",{className:"header"},"TAGS ORGANIZER"),r.a.createElement(by,null)),r.a.createElement(Rj,{tag:this.state.tagName,onTagNameChanged:function(t){return e.onTagNameChanged(t)}}),r.a.createElement("div",{className:"info-text"},this.stack.length," deep and ",this.chosenSoFar.size,"/",this.tags.length," tags done"),r.a.createElement("div",null,this.state.tagsChosen.map(function(e){return r.a.createElement(A.a,{color:"light"},e)})),r.a.createElement("div",{className:"common-button light-blue-button",onClick:function(){return e.goDownLevel()}},"DOWN LEVEL"),r.a.createElement("div",{className:"common-button light-blue-button",onClick:function(){return e.goBackUpLevel()}},"UP LEVEL"),r.a.createElement("div",{className:"common-button light-blue-button",onClick:function(){return e.getRelevantTags()}},"GET RELEVANT TAGS"),r.a.createElement("div",{className:"common-button light-blue-button",onClick:function(){return e.clearRelevantTags()}},"CLEAR RELEVANT TAGS"),r.a.createElement("div",{className:"common-button light-blue-button",onClick:function(){return e.deleteCategory()}},"DELETE CATEGORY"),r.a.createElement("div",{className:"common-button light-blue-button",onClick:function(){return e.saveHierarchy()}},"SAVE"),r.a.createElement(Lj,{tags:this.state.tags,chosenSoFar:this.chosenSoFar,tagsChosen:this.state.tagsChosen,onClickTag:function(t){return e.onClickTag(t)}}))}}]),t}(a.Component),Uj=Object(y.b)(function(e){return{guildId:e.guilds.selectedGuild?e.guilds.selectedGuild.guildId:0}},null)(Bj),Hj=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={sequences:[],folders:[],selectedFolder:null,selectedSequences:[]},n.getSequences(),n.getFolders(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getSequences",value:function(){var e=this,t=null!==this.state.selectedFolder?"/getSequences/ "+this.state.selectedFolder:"/getSequences/";f.a.get(t).then(function(t){console.log(t.data),e.state.sequences=t.data.data,e.setState(e.state)})}},{key:"getFolders",value:function(){var e=this;f.a.get("/folders").then(function(t){console.log("folders"),console.log(t.data),e.state.folders=t.data.data,e.setState(e.state)})}},{key:"onClickFolder",value:function(e){this.state.selectedFolder=this.state.selectedFolder==e?null:e,this.setState(this.state)}},{key:"newFolder",value:function(){var e=window.prompt("Type the new folders name"),t=this;f.a.post("/newFolder/"+e).then(function(e){console.log("folder id = "+e.folderId),t.getFolders()})}},{key:"onSelectSequence",value:function(e){var t=this.state.selectedSequences.indexOf(e);t>-1?this.state.selectedSequences=this.state.selectedSequences.slice(t,1):this.state.selectedSequences.push(e),console.log("selected sequences"),console.log(this.state.selectedSequences),this.setState(this.state)}},{key:"filterToFolder",value:function(){this.getSequences()}},{key:"moveToFolder",value:function(){var e=this;this.state.selectedSequences.length>0&&null!=this.state.selectedFolder&&f.a.post("/addSequencesToFolder/"+this.state.selectedSequences.join("+")+"/"+this.state.selectedFolder).then(function(t){e.setState(e.state)})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",null,"SEQUENCES"),r.a.createElement("div",{className:"sequences-table"},this.state.sequences.map(function(t){return r.a.createElement(Jj,{selected:e.state.selectedSequences.indexOf(t.id)>-1,onSelectSequence:function(){return e.onSelectSequence(t.id)},sequence:t})})),r.a.createElement("div",{className:"folders-table"},r.a.createElement("div",{className:"new-folder",onClick:function(){return e.newFolder()}},"NEW FOLDER"),r.a.createElement("div",{className:"move-to-folder",onClick:function(){return e.moveToFolder()}},"MOVE TO FOLDER"),r.a.createElement("div",{className:"filter-to-folder",onClick:function(){return e.filterToFolder()}},"FILTER"),this.state.folders.map(function(t){return r.a.createElement(Gj,{selected:e.state.selectedFolder==t.id,onClickFolder:function(){return e.onClickFolder(t.id)},folder:t})})))}}]),t}(a.Component),Jj=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{onClick:this.props.onSelectSequence,className:this.props.selected?"sequence selected":"sequence"},r.a.createElement("span",{className:"sequence-name"},r.a.createElement("a",{href:"/create/"+this.props.sequence.id},this.props.sequence.name)),r.a.createElement("div",{className:"sequence-date"},this.props.sequence.date))}}]),t}(a.Component),Gj=function(e){function t(e){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:this.props.selected?"folder selected":"folder"},r.a.createElement("div",{onClick:this.props.onClickFolder,className:"folder-name"},this.props.folder.name))}}]),t}(a.Component),zj=Object(y.b)(null,function(e){return{setLoadingSequence:function(t,n){return e(Object(w.Tb)(t,n))}}})(Hj),_j=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,[{key:"download",value:function(e){f.a.get("/getSounds/"+e.join(",")).then(function(e){var t=e.data.data,n=document.createElement("a");n.setAttribute("download",null),document.body.appendChild(n);for(var a=0;a<t.length;a++)n.setAttribute("download",t[a].filename),n.setAttribute("href","../downloadSound/"+t[a].filename),n.click();document.body.removeChild(n)})}}]),e}(),Wj=(n(1038),n(2587)),Kj=n(2588),Yj=n(2586),Qj=new(window.AudioContext||window.webkitAudioContext),Xj=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={soundId:e.soundId},n.audioUnit=new _(Qj),n.loadBuffer.bind(Object(p.a)(n)),n.handleLoadBuffer.bind(Object(p.a)(n)),n.loadBuffer(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e){return e.soundId!==this.state.soundId&&(this.state.soundId=e.soundId,this.loadBuffer()),!0}},{key:"loadBuffer",value:function(){var e=this;console.log("loading buffer soundId = "+this.props.soundId),this.sample=new K.a(this.props.soundId,this.props.encryptedIpfs),this.sample.name=this.props.title,this.sample.videoId=this.props.videoId,this.state.name=this.props.title,this.state.videoId=this.props.videoId,console.log("gonna fetch audio for id = "+this.sample.getId()),this.sample.fetchAudio().then(function(t){e.audioUnit.setBuffer(t.audioBuffer),e.state.buffer=t.audioBuffer,e.setState(e.state)})}},{key:"handleLoadBuffer",value:function(e,t){var n=e.state;n.buffer=t,e.setState(n)}},{key:"render",value:function(){var e=this;return void 0!=this.state.buffer?r.a.createElement("div",{className:this.props.isSelected?"selected sound-row":"sound-row"},r.a.createElement("div",{className:"playlist-row"},r.a.createElement(x,{selections:[],buffer:this.audioUnit.buffer,onClickSelection:function(e,t){return[]},height:100,width:350,onSelection:function(e,t){return[]},audioUnit:this.audioUnit,waveformId:0}),r.a.createElement("div",{className:"youtube-info"},r.a.createElement(z,{onClickThumbnail:function(){return e.props.onClickThumbnail(e.state.soundId)},coverArt:this.props.coverArt,sample:this.sample,name:this.props.title,isMuted:!1,soundId:this.state.soundId,onNewSound:this.props.onNewSound,videoId:this.state.videoId})),r.a.createElement("div",{onClick:this.props.onDelete,className:"delete-button"},"x")),null!=this.props.tags?this.props.tags.map(function(t){return r.a.createElement(A.a,{onClick:function(){return e.props.onDeleteTag(t)},color:"light"},t)}):""):r.a.createElement("div",null)}}]),t}(a.Component),Zj=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={tags:[]},n._tag="",n.addListener(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"addListener",value:function(){var e=this;window.addEventListener("sound_selected",function(){e.input&&e.input!==document.activeElement&&e.input.focus()})}},{key:"addTag",value:function(){this.state.tags.push(this._tag);this.props.onUpdateTags(this._tag),this._tag="",this.setState(this.state)}},{key:"onInputType",value:function(e){this._tag=e,this.setState(this.state)}},{key:"onKeyPress",value:function(e){"Enter"===e.key&&this.addTag()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"tag-editor"},this.props.soundUploadMode?"":r.a.createElement("div",{onClick:this.props.onClickBack,className:"light-blue-button common-button"},"Back to search"),r.a.createElement("div",{className:"tags"},r.a.createElement(A.h,null,r.a.createElement("div",null,r.a.createElement("input",{type:"text",ref:function(t){return e.input=t},autoFocus:!0,onKeyPress:function(t){return e.onKeyPress(t)},value:this._tag,id:"search-input",onChange:function(t){return e.onInputType(t.target.value)},placeholder:"Enter tag name",className:"tag-discover-input"})),r.a.createElement(A.i,{addonType:"append"},r.a.createElement(A.b,{onClick:function(){return e.addTag()},color:"secondary"},"Tag")))))}}]),t}(a.Component),$j="undefined"!==typeof window.web3?new ai.a(window.web3.currentProvider):new ai.a(new ai.a.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),ex=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).onChange=function(e){var t=n.state;switch(t.name=e.target.files[0].name,e.target.name){case"selectedFile":t.selectedFile=e.target.files[0];break;default:t[e.target.name]=e.target.value,t.name=e.target.value}n.setState(t)},n.state={name:void 0,description:"",selectedFile:"",soundIds:[],soundIdToName:{},soundIdToTags:{},selectedSounds:{}},console.log("setting store",e.store),Ge.a.setStore(e.store),Ge.a.setEthereum(R.a),Ge.a.checkLogin(),R.a.guilds.initGuilds(),window.sequencerEngine={store:e.store,ethereum:R.a},window.addEventListener("dragenter",function(e){e.preventDefault(),console.log("drag enter!"),e.dataTransfer.effectAllowed="none",e.dataTransfer.dropEffect="none"},!1),window.addEventListener("dragover",function(e){return e.preventDefault(),console.log("drag over!"),e.dataTransfer.effectAllowed="none",!1}),window.addEventListener("drop",function(){var e=Object(g.a)(v.a.mark(function e(t){var a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("dropped!"),t.preventDefault(),t.dataTransfer.effectAllowed="none",t.dataTransfer.dropEffect="none",t.dataTransfer.items)for(a=0;a<t.dataTransfer.items.length;a++)"file"===t.dataTransfer.items[a].kind&&n.uploadFile(t.dataTransfer.items[a].getAsFile());else for(a=0;a<t.dataTransfer.files.length;a++)console.log("... file["+a+"].name = "+t.dataTransfer.files[a].name);return e.abrupt("return",!1);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"uploadFile",value:function(e){var t=this,n=new FileReader;n.readAsArrayBuffer(e),n.onloadend=Object(g.a)(v.a.mark(function a(){var r;return v.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return console.log("read the file"),console.log(n.result),a.next=4,B.a.addArrayBuffer(n.result);case 4:r=a.sent,console.log("hash = "+r),t.state.soundIds.push(r),console.log("file name = "+e.name),t.state.soundIdToName[r]=e.name,t.setState(t.state);case 10:case"end":return a.stop()}},a)}))}},{key:"startTagging",value:function(){this.state.tagMode=!0,this.setState(this.state)}},{key:"onSubmit",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),console.log("on submit called"),n=this.state,a=n.name,r=n.selectedFile,e.next=5,B.a.addBlob(r);case 5:s=e.sent,console.log("hash = "+s),this.state.soundIds.push(s),this.state.soundIdToName[s]=a,this.setState(this.state);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"selectSound",value:function(e){if(this.state.selectedSounds[e]){var t=Object(X.a)({},this.state.selectedSounds);t[e]=!1,this.setState({selectedSounds:t})}else{var n=Object(X.a)({},this.state.selectedSounds);n[e]=!0,this.setState({selectedSounds:n})}}},{key:"loadTags",value:function(){var e=this;console.log("laoding tags"),this.state.soundIds.map(function(){var t=Object(g.a)(v.a.mark(function t(n){var a;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("got tags for "+n),t.next=3,new K.a(n).fetchTags();case 3:a=t.sent,e.state.soundIdToTags[n]=a,e.setState(e.state);case 6:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}},{key:"saveToEthereum",value:function(){var e=[];for(var t in this.state.soundIdToTags){var n=this.state.soundIdToTags[t];n.length>4&&(n=n.slice(0,4));for(var a=n.length;a<4;a++)n.push("");var r=this.state.soundIdToName[t],s=new Date;$j.utils.padLeft("0x0",64);e.push({ipfsHash:t,title:r,videoId:"",tags:n,styles:["","","",""],country:"",year:s.getFullYear()})}R.a.newSamplesWithMetadata(e)}},{key:"hasSelectedSounds",value:function(){var e=this.state.selectedSounds;return Object.keys(e).some(function(t){return e[t]})}},{key:"selectAll",value:function(){var e=this.state.selectedSounds,t=this.hasSelectedSounds();for(var n in this.state.soundIds){e[this.state.soundIds[n]]=!t}this.setState({selectedSounds:e})}},{key:"addTag",value:function(e){for(var t in console.log("add tag called"),this.state.selectedSounds)this.state.selectedSounds[t]&&(t in this.state.soundIdToTags?this.state.soundIdToTags[t].push(e):this.state.soundIdToTags[t]=[e]);console.log(this.state.soundIdToTags),this.setState(this.state)}},{key:"onDropHandler",value:function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.effectAllowed="none",e.dataTransfer.dropEffect="none"}},{key:"dragOverHandler",value:function(e){return e.stopPropagation(),e.preventDefault(),e.dataTransfer.effectAllowed="none",e.dataTransfer.dropEffect="none",!1}},{key:"render",value:function(){var e=this,t=this.state;t.description,t.selectedFile;return console.log("render called with soundIds = "),console.log(this.state.soundIds),r.a.createElement("div",{className:"sound-upload-page"},r.a.createElement(DC,{store:this.props.store,showLogin:!0}),r.a.createElement("div",{className:"upload-pane"},r.a.createElement("form",{onSubmit:function(t){return e.onSubmit(t)}},r.a.createElement("input",{type:"file",name:"selectedFile",onChange:this.onChange}),r.a.createElement("button",{type:"submit"},"Submit")),r.a.createElement("div",{className:"video-buttons-container"},r.a.createElement("div",{className:"pink-button common-button",onClick:function(){return e.startTagging()}},"TAG"),r.a.createElement("div",{className:"pink-button common-button",onClick:function(){return e.saveToEthereum()}},"SAVE"),r.a.createElement("div",{className:"pink-button common-button",onClick:function(){return e.selectAll()}},this.hasSelectedSounds()?"UNSELECT ALL":"SELECT ALL")),r.a.createElement("div",{className:"sampled-sounds-container"},this.state.soundIds.map(function(t){return r.a.createElement(Xj,{tags:e.state.soundIdToTags[t],title:e.state.soundIdToName[t],isSelected:e.state.selectedSounds[t],onClickThumbnail:function(){return e.selectSound(t)},soundId:t})}))),r.a.createElement("div",{className:"description-pane"},this.state.tagMode?r.a.createElement(Zj,{uploadMode:!0,soundIdToHash:this.state.soundIdToHash,onUpdateTags:function(t){return e.addTag(t)},selectedSoundIds:this.state.selectedSoundIds}):""))}}]),t}(a.Component),tx=n(283),nx=n(278),ax=n(66),rx=n.n(ax),sx=n(1060),ix=new tx.a,ox=new ai.a(new ai.a.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),cx={A:ox.utils.asciiToHex("a"),"A#":ox.utils.asciiToHex("A"),B:ox.utils.asciiToHex("b"),C:ox.utils.asciiToHex("c"),"C#":ox.utils.asciiToHex("C"),D:ox.utils.asciiToHex("d"),"D#":ox.utils.asciiToHex("D"),E:ox.utils.asciiToHex("e"),F:ox.utils.asciiToHex("f"),"F#":ox.utils.asciiToHex("F"),G:ox.utils.asciiToHex("g"),"G#":ox.utils.asciiToHex("G")},ux=["Access","Casio","Cheetah","EMU","Electro-Harmonix","Elektron","Elka","Fairlight","Farfisa","Fricke","Kawai","Korg","Linn","Moog","Nintendo","Oberheim","Roland"];function lx(e){var t=rx.a.decode(e).toString("hex").replace(/^1220/,"");return 64!=t.length?null:"0x"+t}var px=function(){function e(){Object(o.a)(this,e),this.model=new nx.OnsetsAndFrames("https://storage.googleapis.com/magentadata/js/checkpoints/transcription/onsets_frames_uni"),this.model.initialize(),this.contract=new ox.eth.Contract(ix.abi,ix.contractAddress),this.ethAddress=this.contract.options.address,this.ethereumHelper=new sx.a}return Object(c.a)(e,[{key:"processAllSounds",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getting all sounds"),e.next=3,R.a.getAllSounds(90);case 3:t=e.sent,t=Array.from(new Set(t)),n=0;case 6:if(!(n<t.length)){e.next=14;break}return console.log("downloading "+t[n]+" i = "+n+" of "+t.length),e.next=10,this.processSound(t[n]);case 10:e.sent;case 11:n++,e.next=6;break;case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"processSound",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n=this;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(g.a)(v.a.mark(function e(a,r){var s,i,o;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.a.getTagsForSound(t);case 2:return(s=e.sent).some(function(e){return ux.indexOf(e)>-1})&&(console.log("skipping ipfsHash = "+t+" with tags = "+s.join(",")),a()),e.next=6,new K.a(t).fetchAudioFromIPFS();case 6:return i=e.sent,e.next=9,n.model.transcribeFromAudioBuffer(i.audioBuffer,16);case 9:(o=e.sent).notes.length>0&&n.addNoteSequence(t,o.notes),a();case 12:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"addNoteSequence",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){var a,r,s,i,o,c,u,l,p,h,d;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=60,console.log(n),e.next=4,B.a.addJson(n);case 4:r=e.sent,(n=n.filter(function(e){return void 0!==e}).map(function(e){return{note:bs.a.fromTranspose(e.pitch-a).note,startTime:Math.floor(1e3*e.startTime),endTime:Math.floor(1e3*e.endTime)}})).sort(function(e,t){return e.startTime-t.startTime}),s=n.map(function(e){return cx[e.note]}),n.filter(function(e){return!(e.note in cx)}),i=[],o=[],c=[],u=0;case 13:if(!(u<8)){e.next=27;break}if(l=32*u,!(s.length<l||void 0===n[l])){e.next=20;break}for(o.push(ox.utils.numberToHex(0)),c.push(ox.utils.numberToHex(0)),p=0;p<32;p++)i.push(ox.utils.numberToHex(0));return e.abrupt("continue",24);case 20:for(o.push(n[l].startTime),h=ox.utils.numberToHex(0),d=0;d<32;d++)void 0===s[d+l]?i.push(ox.utils.numberToHex(0)):(i.push(s[d+l]),h=n[d+l].endTime);c.push(h);case 24:u++,e.next=13;break;case 27:this.publish(t,r,i,o,c);case 28:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"publish",value:function(e,t,n,a,r){for(var s in e=lx(e),t=lx(t),n)"0x0"===n[s]&&(n[s]=ox.utils.padLeft(n[s],64));this.ethereumHelper.runFunction(this.contract.methods.newNoteSequenceLarge(e,n,a,r,t).encodeABI(),this.ethAddress)}}]),e}(),hx=function(e){function t(e){var n;return Object(o.a)(this,t),n=Object(u.a)(this,Object(l.a)(t).call(this,e)),(new px).processAllSounds(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,"Backfilling")}}]),t}(a.Component),dx=n(176),fx=(new tx.a,"undefined"!==typeof window.web3?new ai.a(window.web3.currentProvider):new ai.a(new ai.a.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),n(1061)),mx=(n(1064),n(2572),function(e){function t(e){var n;Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={sampling:!1,dropdownOpen:!1,recordingSetup:!1,videoId:e.videoId,startTime:null,endTime:null,stream:void 0};Object(p.a)(n);return n.soundUploader=new Fs.a(2,function(e,t){return n.props.onSoundUploaded(t,t)}),n.setupRecording(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"toggleDropdown",value:function(){this.setState({dropdownOpen:!this.state.dropdownOpen})}},{key:"shouldComponentUpdate",value:function(e){return this.props.playOutputRecording!=e.playOutputRecording&&(e.playOutputRecording?this.input.connect(this.audioContext.destination):this.input.disconnect(this.audioContext.destination)),e.stream!==this.state.stream&&(this.state.stream=e.stream,this.startUserMedia(this.state.stream)),!0}},{key:"startUserMedia",value:function(e){console.log("starting user media"),console.log(e),this.input=this.audioContext.createMediaStreamSource(e),this.input.channelCount=2,this.recorder=new window.Recorder(this.input,{numChannels:2,bufferLen:2048}),this.props.playOutputRecording&&this.input.connect(this.audioContext.destination),this.state.recordingSetup=!0,this.setState(this.state)}},{key:"setupRecording",value:function(){try{window.AudioContext=window.AudioContext||window.webkitAudioContext,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia,window.URL=window.URL||window.webkitURL,this.audioContext=q.a.Master.context,Hc()(this.audioContext,"#playButton")}catch(e){console.log("No web audio support in this browser!")}}},{key:"onClickSampleButton",value:function(){var e=this;this.state.sampling=!this.state.sampling,this.state.sampling?(this.state.startTime=this.youtubePlayer.getCurrentTime(),this.recorder.record(),console.log("recording started")):(this.recorder.stop(),console.log("recording stopped"),this.state.endTime=this.youtubePlayer.getCurrentTime(),this.recorder.getBuffer(function(t){return e.saveBuffer(t)})),this.setState(this.state)}},{key:"saveBuffer",value:function(){var e=Object(g.a)(v.a.mark(function e(t){var n,a,r=this;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.soundUploader.uploadBufferToIpfs(t,!0);case 2:n=e.sent,this.props.selectedRecord&&(a=this.props.selectedRecord.thumb,f.a.get("https://cors-anywhere.herokuapp.com/"+a,{responseType:"blob"}).then(function(e){var t=e.data;B.a.addBlob(t).then(function(e){return r.props.onCoverDownloaded(n,e)})})),this.recorder.clear();case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getRelatedVideos",value:function(){console.log("get related videos event dispatched"),window.dispatchEvent(new Event("get_related_videos"))}},{key:"getRecordLabels",value:function(){window.dispatchEvent(new Event("get_record_labels"))}},{key:"fastForward",value:function(e){e.preventDefault(),this.youtubePlayer.seekTo(this.youtubePlayer.getCurrentTime()+5)}},{key:"rewind",value:function(e){e.preventDefault(),this.youtubePlayer.seekTo(this.youtubePlayer.getCurrentTime()-5)}},{key:"checkQuality",value:function(){var e=this.youtubePlayer.getAvailableQualityLevels();this.youtubePlayer.setPlaybackQuality(e[0])}},{key:"render",value:function(){var e=this;console.log("selected record = "),console.log(this.props.selectedRecord);var t=this.props.styles,n=this.props.country,a=this.props.yeaer;return"VINYL"===this.props.sampleSource&&this.props.selectedRecord&&(t=this.props.selectedRecord.style,n=this.props.selectedRecord.country,a=this.props.selectedRecord.year),r.a.createElement("div",{className:"youtube-sampler"},r.a.createElement("span",{className:"#playButton"}),r.a.createElement(O,{condition:"YOUTUBE"===this.props.sampleSource},r.a.createElement("div",{className:"youtube-widget-container"},r.a.createElement(fx.a,{videoId:this.props.videoId,opts:{height:"125",width:"400",playerVars:{autoplay:1}},onStateChange:function(t){return e.checkQuality()},onReady:function(t){return e._onReady(t)}}))),r.a.createElement(O,{condition:"VINYL"===this.props.sampleSource},r.a.createElement("img",{className:"cover-art",src:this.props.selectedRecord?this.props.selectedRecord.cover_image:""})),r.a.createElement("div",{className:"video-info-container"}),r.a.createElement("div",{className:"video-buttons-container"},r.a.createElement("div",{className:"action-buttons"},this.state.recordingSetup?r.a.createElement("span",{onClick:function(){return e.onClickSampleButton()},className:this.state.sampling?"record-button recording":"record-button"},this.state.sampling?"RECORDING":"RECORD"):"... initalizing"),r.a.createElement("div",{className:"action-buttons"},r.a.createElement("span",{onClick:function(t){return e.rewind(t)},className:"big-button player-button"},"RRWD")),r.a.createElement("div",{className:"action-buttons"},r.a.createElement("span",{onClick:function(t){return e.fastForward(t)},className:"big-button player-button"},"FFWD")),r.a.createElement("div",{className:"action-buttons"},r.a.createElement("span",{onClick:this.props.onClickTag,className:"big-button tag-samples-button"},"TAG")),r.a.createElement("div",{className:"float-right"},r.a.createElement(O,{condition:"YOUTUBE"===this.props.sampleSource},r.a.createElement(A.c,{show:this.state.dropdownOpen,isOpen:this.state.dropdownOpen,toggle:function(){return e.toggleDropdown()}},r.a.createElement(A.b,{onClick:function(){return e.getRelatedVideos()},id:"caret",color:"secondary"},r.a.createElement("span",{className:""},"Related")),r.a.createElement(A.f,{size:"sm",caret:!0,color:"secondary"}),r.a.createElement(A.e,null,r.a.createElement(A.d,{onClick:function(){return e.getRelatedVideos()},size:"sm"},"Related Videos"),r.a.createElement(A.d,{onClick:function(){return e.getRecordLabels()},size:"sm"},"Record Labels"),r.a.createElement(A.d,{onClick:function(){return e.props.onClickRandomVideo()},size:"sm"},"Random Video")))))),r.a.createElement("div",{className:"discogs-container"},"Styles:  ",t.map(function(e){return r.a.createElement(A.a,{color:"light"},e)})," ",void 0!==a?"Year: "+a:"",void 0!==n?" Country: "+n:""))}},{key:"_onReady",value:function(e){this.youtubePlayer=e.target,this.setState(this.state)}}]),t}(r.a.Component));var vx=Object(y.b)(function(e){return{selectedRecord:e.discover.selectedRecord}},null)(mx),gx=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,[{key:"tag",value:function(e,t){return new Promise(function(n,a){f.a.post("/tagSoundEasy/"+e+"/"+t).then(function(e){return n()}).catch(function(e){return a(e)})})}},{key:"getTags",value:function(e){}}]),e}(),bx="YOUTUBE",yx=function(e){function t(e){var n,a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,e))).ethereumCache=new ol,R.a.store=a.props.store,Ge.a.setStore(a.props.store),Ge.a.setEthereum(R.a),Ge.a.checkLogin(),R.a.guilds.initGuilds(),a.state=(n={videoId:"j5L70BkuKlo",soundIds:[],sampleSource:bx,selectedSoundIds:[],soundIdToHash:{},hashToSoundId:{},tagMode:!1,soundIdToTags:{},hashToStyles:{}},Object(_e.a)(n,"hashToSoundId",{}),Object(_e.a)(n,"hashToYear",{}),Object(_e.a)(n,"hashToCountry",{}),Object(_e.a)(n,"hashToVideoId",{}),Object(_e.a)(n,"hashToVideoTitle",{}),Object(_e.a)(n,"hashToDiscogsId",{}),Object(_e.a)(n,"styles",[]),Object(_e.a)(n,"hashToCoverArt",{}),Object(_e.a)(n,"year",void 0),Object(_e.a)(n,"country",void 0),Object(_e.a)(n,"syncedToEthereum",!1),Object(_e.a)(n,"calculatingNoteSequences",!1),Object(_e.a)(n,"noteSequencesCalculated",0),Object(_e.a)(n,"stream",void 0),Object(_e.a)(n,"taggingSingleSound",!1),Object(_e.a)(n,"soundIdToTag",void 0),n),a.onVideoIdChanged(a.state.videoId),a.discogs=new ST,a.soundsTags=new gx,R.a.crypto.store=a.props.store,a.contentKey=new Uu.a,a.encryptedIpfs=new gn.a(a.props.store,R.a.guilds,R.a.encryption,R.a.crypto),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onCoverArtDownloaded",value:function(e,t){console.log("onCoverARtDownloaded"),console.log(this.props.selectedRecord);var n=Object(X.a)({},this.state.hashToCoverArt);n[e]=t,this.setState({hashToCoverArt:n})}},{key:"onChooseAudio",value:function(e,t){console.log("deviceId chosen = "+t),this.setState({stream:e,deviceId:t})}},{key:"componentDidMount",value:function(){window.addEventListener("beforeunload",function(e){e.returnValue="Hellooww"})}},{key:"onSoundUploaded",value:function(){var e=Object(g.a)(v.a.mark(function e(t,n){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.syncedToEthereum=!1,this.state.soundIdToHash[t]=n,this.state.hashToSoundId[n]=t,this.state.soundIds.push(t),this.state.soundIdToTags[t]=[],"VINYL"!==this.state.sampleSource){e.next=14;break}this.state.hashToVideoTitle[n]=this.props.selectedRecord.title,this.state.hashToCountry[n]=this.props.selectedRecord.country,this.state.hashToStyles[n]=this.props.selectedRecord.style,this.state.hashToYear[n]=this.props.selectedRecord.year,this.state.hashToDiscogsId[n]=this.props.selectedRecord.id,this.soundsTags.tag(t,"vinyl"),e.next=21;break;case 14:return this.state.hashToVideoId[n]=this.state.videoId,e.next=17,this.getYoutubeTitle();case 17:this.state.hashToVideoTitle[n]=e.sent,this.state.hashToStyles[n]=this.state.styles,this.state.hashToYear[n]=void 0===this.state.year?null:this.state.year,this.state.hashToCountry[n]=void 0===this.state.country?null:this.state.country;case 21:this.setState(this.state);case 22:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"onVideoIdChanged",value:function(e){var t=this;console.log("on videddd changed"),this.state.videoId=e,this.getYoutubeTitle().then(function(e){t.discogs.searchYoutubeTitle(e).then(function(e){return t.loadDiscogsResults(e)})}),this.setState(this.state)}},{key:"loadDiscogsResults",value:function(e){if(null!=e&&void 0!==e){var t=e;if(void 0!==e.length){var n=Math.min.apply(Math,e.map(function(e){return e.year}));t=e.filter(function(e){return e.year===n})[0]}this.setState({styles:void 0!==t.style?t.style:[],country:t.country,year:t.year})}else this.setState({styles:[],country:void 0,year:void 0})}},{key:"getYoutubeTitle",value:function(){return oT(this.state.videoId)}},{key:"onSampleSourceChange",value:function(e){this.state.sampleSource="youtube"===e?bx:"VINYL",this.setState(this.state)}},{key:"loadVideo",value:function(e){this.onVideoIdChanged(e.videoId)}},{key:"selectSound",value:function(e){var t=this.state.selectedSoundIds.indexOf(e);t>-1?this.state.selectedSoundIds.splice(t,1):this.state.selectedSoundIds.push(e),1===this.state.selectedSoundIds.length&&t<0&&window.dispatchEvent(new Event("sound_selected")),this.setState({selectedSoundIds:this.state.selectedSoundIds,tagMode:!0})}},{key:"startTagging",value:function(){this.state.tagMode=!0,this.setState(this.state)}},{key:"backToSearch",value:function(){this.state.tagMode=!1,this.setState(this.state)}},{key:"onClickSequence",value:function(e){var t=this.state.selectedSoundIds.join(",");this.props.history.push("/sequencerSounds/"+t)}},{key:"onClickRandomVideo",value:function(){var e=this.ethereumCache.index.YOUTUBE.YOUTUBE,t=e[Math.floor(e.length*Math.random())].dimension;this.loadVideo({videoId:t})}},{key:"syncToEthereum",value:function(){var e=Object(g.a)(v.a.mark(function e(){var t,n,a,r,s,i,o,c,u,l,p,h,d,f=this;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=[],a=[],e.t0=v.a.keys(this.state.hashToSoundId);case 4:if((e.t1=e.t0()).done){e.next=26;break}for(r=e.t1.value,n.push(this.state.hashToSoundId[r]),s=this.state.soundIdToTags[this.state.hashToSoundId[r]],(i=this.state.hashToStyles[r]).length>4&&(i=i.slice(0,4)),o=i.length;o<4;o++)i.push("");for(s.length>4&&(s=s.slice(0,4)),c=s.length;c<4;c++)s.push("");if(u=r,!this.props.selectedGuild){e.next=23;break}return e.next=17,B.a.getSound(r);case 17:return l=e.sent,e.next=20,this.encryptedIpfs.addSound(l,dx.a,this.props.selectedGuild.guildId,this.contentKey);case 20:u=e.sent,console.log("hash to save = "),console.log(u);case 23:a.push({ipfsHash:u,title:this.state.hashToVideoTitle[r],videoId:this.state.hashToVideoId[r],tags:s,styles:i,country:this.state.hashToCountry[r],year:this.state.hashToYear[r],coverArt:this.state.hashToCoverArt[r],discogsId:this.state.hashToDiscogsId[r]}),e.next=4;break;case 26:return 0!==(p=this.props.selectedGuild?this.props.selectedGuild.guildId:0)?R.a.newEncryptedSamples(a,p,this.contentKey):R.a.newSamplesWithMetadata(a,0),e.next=30,Promise.all(t);case 30:for(h in e.sent,this.state.soundIdToHash)d=this.state.soundIdToHash[h],delete this.state.hashToVideoTitle[d],delete this.state.hashToVideoId[d],delete this.state.hashToVideoId[d],delete this.state.hashToStyles[d],delete this.state.hashToYear[d],delete this.state.hashToCountry[d],delete this.state.hashToSoundId[d];n.forEach(function(e){return delete f.state.soundIdToHash[e]}),this.setState({soundIds:[],syncedToEthereum:!0});case 34:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"addTag",value:function(e){for(var t in this.state.selectedSoundIds){var n=this.state.selectedSoundIds[t];n in this.state.soundIdToTags?this.state.soundIdToTags[n].push(e):this.state.soundIdToTags[n]=[e]}this.setState(this.state)}},{key:"deleteSound",value:function(e){var t=this.state.soundIdToHash[e];delete this.state.hashToVideoTitle[t],delete this.state.hashToVideoId[t],delete this.state.hashToVideoId[t],delete this.state.hashToStyles[t],delete this.state.hashToYear[t],delete this.state.hashToCountry[t],delete this.state.hashToSoundId[t],delete this.state.soundIdToHash[e];var n=this.state.soundIds.indexOf(e);this.state.soundIds.splice(n,1),this.setState(this.state)}},{key:"deleteTag",value:function(e,t){var n=this.state.soundIdToTags[e].indexOf(t);this.state.soundIdToTags[e].splice(n,1),this.setState({soundIdToTags:this.state.soundIdToTags})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"discover-full-view"},r.a.createElement(my,{crypto:R.a.crypto,show:!0}),r.a.createElement(sy,{show:this.props.showLogin}),r.a.createElement(DC,{view:"DISCOVER",store:this.props.store}),r.a.createElement("div",{className:"discover-view"},r.a.createElement("div",{className:"clear-fix"}),r.a.createElement("div",{className:"float-left"},r.a.createElement("div",{className:"discover-toolbar"},r.a.createElement(by,{store:this.props.store}),r.a.createElement(O,{condition:!this.state.syncedToEthereum&&this.state.soundIds.length>0},r.a.createElement("div",{onClick:function(){return e.syncToEthereum()},className:"pink-button common-button"},"SAVE ",this.state.soundIds.length," SOUNDS")),r.a.createElement(ky,null),r.a.createElement(qT,{deviceId:this.state.deviceId,onChooseAudio:function(t,n){return e.onChooseAudio(t,n)},onSampleSourceChange:function(t){return e.onSampleSourceChange(t)}})),r.a.createElement("div",{className:"youtube-pane"},r.a.createElement(vx,{onCoverDownloaded:function(t,n){return e.onCoverArtDownloaded(t,n)},stream:this.state.stream,styles:this.state.styles,year:this.state.year,country:this.state.country,videoId:this.state.videoId,onClickTag:function(){return e.startTagging()},onSoundUploaded:function(t,n){return e.onSoundUploaded(t,n)},sampleSource:this.state.sampleSource,onClickRandomVideo:function(){return e.onClickRandomVideo()},playOutputRecording:"VINYL"===this.state.sampleSource}),r.a.createElement(O,{condition:this.state.soundIds.length>0},r.a.createElement("div",{className:"sampled-sounds-container"},this.state.soundIds.map(function(t){return r.a.createElement(Xj,{encryptedIpfs:e.encryptedIpfs,key:t,onDelete:function(){return e.deleteSound(t)},tags:e.state.soundIdToTags[t],isSelected:e.state.selectedSoundIds.indexOf(t)>-1,onClickThumbnail:function(){return e.selectSound(t)},onDeleteTag:function(n){return e.deleteTag(t,n)},onClickTag:function(){return e.tagSound(t)},coverArt:e.state.hashToCoverArt[t],videoId:e.state.hashToVideoId[e.state.soundIdToHash[t]],title:e.state.hashToVideoTitle[e.state.soundIdToHash[t]],soundId:e.state.soundIdToHash[t]})}))))),r.a.createElement("div",{className:"description-pane"},this.state.tagMode?r.a.createElement(Zj,{soundIdToHash:this.state.soundIdToHash,onClickBack:function(){return e.backToSearch()},onUpdateTags:function(t){return e.addTag(t)},selectedSoundIds:this.state.selectedSoundIds}):r.a.createElement(NT,{store:this.props.store,videoId:this.state.videoId,onClickResult:function(t){return e.loadVideo(t)}}))))}}]),t}(a.Component),kx=Object(y.b)(function(e){return{selectedRecord:e.discover.selectedRecord,selectedGuild:e.guilds.selectedGuild,showLogin:e.sequencer.showLogin}},null)(yx),Ex=function(e){function t(e){var n;Object(o.a)(this,t),n=Object(u.a)(this,Object(l.a)(t).call(this,e));var a=void 0!=e.match.params.soundIds?e.match.params.soundIds.split(","):[];return console.log(a[0]),n.loadTags(a[0]),n.state={name:"",showAddTag:!1,id:a[0]},n.setState(n.state),n.loadName.bind(Object(p.a)(n)),n.showAddTag.bind(Object(p.a)(n)),n.loadTags.bind(Object(p.a)(n)),n.addTag.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"showAddTag",value:function(){this.state.showAddTag=!0,this.setState(this.state)}},{key:"loadTags",value:function(e){var t=this;f.a.get("/tagsForSound/"+e).then(function(e){t.state.tags=e.data.data.map(function(e){return e.name}),t.setState(t.state)}).catch(function(e){console.log("okay"),console.log(e)})}},{key:"addTag",value:function(){var e=this._tag,t=this;console.log("tag is = "+e),f.a.post("/tagSoundEasy/"+this.state.id+"/"+e).then(function(e){t.loadTags(t.state.id)})}},{key:"onSoundIdChange",value:function(e,t){this.state.id=t,this.setState(this.state),this.props.history.push("/sound/"+t)}},{key:"onDelete",value:function(e){}},{key:"loadName",value:function(e){this.state.name=e,this.setState(this.state)}},{key:"render",value:function(){var e=this,t=this,n=this.state.id;return console.log("id = "+n),r.a.createElement("div",null,r.a.createElement(A.j,null,this.state.name),null!=this.state.tags?this.state.tags.map(function(e){return r.a.createElement(A.a,{color:"light"},e)}):"",r.a.createElement("div",{className:"tags"},r.a.createElement(A.j,{color:"secondary",onClick:function(){return t.showAddTag()}},"Add Tag"),this.state.showAddTag?r.a.createElement(A.h,null,r.a.createElement(A.g,{onChange:function(t){return e._tag=t.target.value},placeholder:"Add tag",className:"tag-input"}),r.a.createElement(A.i,{addonType:"append"},r.a.createElement(A.b,{onClick:function(){return e.addTag()},color:"secondary"},"Add"))):""))}}]),t}(a.Component),Sx=function(e){function t(e){var n;Object(o.a)(this,t),n=Object(u.a)(this,Object(l.a)(t).call(this,e));var a=void 0!=e.match.params.soundIds?e.match.params.soundIds.split(","):[];return n.state={name:"",soundIds:a,playlistId:e.match.params.playlistId},n.loadPlaylist.bind(Object(p.a)(n)),n.loadPlaylist(),n.save.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"loadPlaylist",value:function(){if(null!=this.state.playlistId){var e=this;console.log("okay"),f.a.get("/playlist/"+this.state.playlistId).then(function(t){e.state.soundIds=t.data.soundIds,e.state.name=t.data.name,console.log("name was = "+t.data),e.setState(e.state)}).catch(function(e){console.log("okay"),console.log(e)}),console.log("word")}}},{key:"addNewSound",value:function(e,t){e.state.soundIds.push(t),e.setState(e.state)}},{key:"updateInputValue",value:function(e,t){var n=e.state;n.name=t.target.value,e.setState(n)}},{key:"onDelete",value:function(e){var t=this.state,n=t.soundIds.indexOf(e);n>-1&&(t.soundIds.splice(n,1),this.setState(t))}},{key:"save",value:function(){void 0!=this.state.playlistId?f.a.post("/updatePlaylist/"+this.state.playlistId+"/"+this.state.soundIds.join(",")).then(function(e){}).catch(function(e){console.log("error")}):f.a.post("/savePlaylist/"+this.state.soundIds.join(",")+"/"+this.state.name).then(function(e){window.location.href="/playlists/"+e.data.playlistId}).catch(function(e){console.log("error")})}},{key:"onSoundIdChange",value:function(e,t){var n=this.state,a=n.soundIds.indexOf(e);a>-1&&(n.soundIds[a]=t,this.setState(n))}},{key:"download",value:function(){(new _j).download(this.state.soundIds)}},{key:"render",value:function(){var e=this,t=this;return r.a.createElement("div",null,null!=this.state.playlistId?r.a.createElement("div",null," ",this.state.name," "):r.a.createElement("div",{className:"search-pane"},r.a.createElement("input",{className:"searchbar",placeholder:"Name your playlist",value:this.state.name,onChange:function(e){return t.updateInputValue(t,e)}})),r.a.createElement(A.b,{bsStyle:"primary",className:"save-btn",onClick:function(){return e.save()}},"Save"),r.a.createElement(A.b,{bsStyle:"secondary",onClick:function(){return e.download()}},"Download"),this.state.soundIds.map(function(e){return r.a.createElement(Q,{onSoundIdChange:function(n){return t.onSoundIdChange(e,n)},soundId:e,onDelete:function(){return t.onDelete(e)}})}),r.a.createElement(Ox,{onNewSound:function(e){return t.addNewSound(t,e)}}))}}]),t}(a.Component),Ox=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={inputValue:"",soundIds:[]},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"updateInputValue",value:function(e,t){var n={inputValue:t.target.value,soundIds:[]};f.a.get("/searchAll/"+n.inputValue+"/all").then(function(t){var a=[];t.data.data.map(function(e,t){return a.push(e.id)}),n.soundIds=a,e.setState(n)}).catch(function(t){e.setState(n)})}},{key:"onNewSound",value:function(e,t){e.props.onNewSound(t);var n=e.state,a=n.soundIds.indexOf(t);a>-1&&(n.soundIds.splice(a,1),e.setState(n))}},{key:"render",value:function(){var e=this,t=this;return console.log("state was "+this.state.soundIds),r.a.createElement("div",null,r.a.createElement("input",{className:"searchbar",placeholder:"Search for more sounds",value:this.state.inputValue,onChange:function(t){return e.updateInputValue(e,t)}}),this.state.soundIds.map(function(e){return r.a.createElement(Q,{soundId:e,onNewSound:function(e){return t.onNewSound(t,e)}})}))}}]),t}(a.Component),wx=function(e){function t(e){var n;return Object(o.a)(this,t),n=Object(u.a)(this,Object(l.a)(t).call(this,e)),console.log("store = "),console.log(e.store),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(Yj.a,null,r.a.createElement(Wj.a,null,r.a.createElement(Kj.a,{path:"/user/:userId",render:function(t){return r.a.createElement(Aj,Object.assign({},t,{store:e.props.store}))}}),r.a.createElement(Kj.a,{path:"/user/",render:function(t){return r.a.createElement(Aj,Object.assign({},t,{store:e.props.store}))}}),r.a.createElement(Kj.a,{path:"/sound/:soundIds",component:Ex}),r.a.createElement(Kj.a,{path:"/newplaylist/:soundIds",component:Sx}),r.a.createElement(Kj.a,{path:"/sequencer/:sequenceId",render:function(t){return r.a.createElement(mC,Object.assign({},t,{store:e.props.store}))}}),r.a.createElement(Kj.a,{path:"/explore/",render:function(t){return r.a.createElement(XC,Object.assign({},t,{store:e.props.store}))}}),r.a.createElement(Kj.a,{path:"/create/:sequenceId",render:function(t){return r.a.createElement(mC,Object.assign({},t,{store:e.props.store}))}}),r.a.createElement(Kj.a,{path:"/nime/:sequenceId",render:function(t){return r.a.createElement(pP,Object.assign({},t,{store:e.props.store}))}}),r.a.createElement(Kj.a,{path:"/fast/:sequenceId",render:function(t){return r.a.createElement(mC,Object.assign({},t,{fastCreate:!0,store:e.props.store}))}}),r.a.createElement(Kj.a,{path:"/sequences/",component:zj}),r.a.createElement(Kj.a,{path:"/guilds/",render:function(t){return r.a.createElement(wP,Object.assign({},t,{store:e.props.store}))}}),r.a.createElement(Kj.a,{path:"/sampler/",component:sj}),r.a.createElement(Kj.a,{path:"/packs/",render:function(t){return r.a.createElement(pj,Object.assign({},t,{store:e.props.store}))}}),r.a.createElement(Kj.a,{path:"/tags/",render:function(t){return r.a.createElement(Uj,Object.assign({},t,{store:e.props.store}))}}),r.a.createElement(Kj.a,{path:"/sequencer/",render:function(t){return r.a.createElement(mC,Object.assign({},t,{store:e.props.store}))}}),r.a.createElement(Kj.a,{path:"/nime/",render:function(t){return r.a.createElement(pP,Object.assign({},t,{store:e.props.store}))}}),r.a.createElement(Kj.a,{path:"/create/",render:function(t){return r.a.createElement(mC,Object.assign({},t,{store:e.props.store}))}}),r.a.createElement(Kj.a,{path:"/download/",render:function(t){return r.a.createElement(QT,Object.assign({},t,{store:e.props.store}))}}),r.a.createElement(Kj.a,{path:"/fast/",render:function(t){return r.a.createElement(mC,Object.assign({},t,{fastCreate:!0,store:e.props.store}))}}),r.a.createElement(Kj.a,{path:"/sequencerSounds/:soundIds",store:this.props.store,component:mC}),r.a.createElement(Kj.a,{path:"/upload/",render:function(t){return r.a.createElement(ex,Object.assign({},t,{store:e.props.store}))}}),r.a.createElement(Kj.a,{path:"/discover/",render:function(t){return r.a.createElement(kx,Object.assign({},t,{store:e.props.store}))}}),r.a.createElement(Kj.a,{path:"/playlists/:playlistId",component:Sx}),r.a.createElement(Kj.a,{path:"/noteSequences",component:hx}),r.a.createElement(Kj.a,{path:"/",render:function(t){return r.a.createElement(JT,Object.assign({},t,{store:e.props.store}))}}),r.a.createElement(Kj.a,{path:"/documentation",render:function(t){return r.a.createElement(JT,Object.assign({},t,{showDocumentation:!0,store:e.props.store}))}})))}}]),t}(a.Component);var Cx=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Px(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}var Tx=n(281),jx=n(8),xx={viewMode:lo,alternateViewMode:"ARRANGEMENT_VIEW",decentralized:!0,masterVolumes:{},showSelectorMode:!1,resolution:new ht(16,!1),numberOfPatterns:{},currentPattern:{},currentStep:{},currentGlobalStep:{},isPlaying:{},samplePack:void 0,sampleDragging:void 0,effectDragging:void 0,patternDragging:void 0,tracksRecording:{},tracksPreparingToRecord:{},trackSteps:{},quantized:!0,isRecording:!1,isRecordingExpanded:!1,sequenceName:void 0,trackFocused:void 0,loadingSequence:{},isCompactMode:!1,showEnvelopes:!1,showLFOs:!1,selectedLFO:1,selectedEnvelope:1,automationMode:"PLAY",showSequenceModal:!1,showModsModal:!1,sequenceRolling:!1,trackRolling:!1,showInstruments:!1,showSequences:!1,showPresets:!1,zIndexHack:!1,resampleMaster:!1,audioInputSource:void 0,latency:0,patternLocks:{},clockType:"NONE",showConvolverModal:!1,convolverSample:void 0,showLogin:!1,signingUp:!1,userToken:void 0,showPasswordModal:!1,passwordModalCallback:void 0,contextualHelp:void 0,showGroups:!1,currentSubSequence:{},subSequences:{},sidebarViewMode:qv},Nx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xx,t=arguments.length>1?arguments[1]:void 0,n={},a={};switch(t.type){case jx.l:return Object(X.a)({},e,{isPlaying:{}});case jx.Fc:return Object(X.a)({},e,{resolution:t.payload});case jx.ld:return Object(X.a)({},e,{sequencerEngine:t.payload});case jx.Le:return t.payload===lo?n=Object(X.a)({},e,{viewMode:t.payload,showSelectorMode:!1,sidebarViewMode:qv}):(n=Object(X.a)({},e,{viewMode:t.payload}),t.payload!==po&&"ARRANGEMENT_VIEW"!==t.payload||(n.alternateViewMode=t.payload)),n;case jx.nb:return Object(X.a)({},e,{viewMode:t.payload});case jx.zd:return Object(X.a)({},e,{showLogin:t.payload});case jx.Ie:return void 0===t.payload.userName?Object(X.a)({},e,{userToken:void 0}):Object(X.a)({},e,{userToken:t.payload});case jx.Qd:return Object(X.a)({},e,{signingUp:t.payload});case jx.mb:return Object(X.a)({},e,{decentralized:t.payload});case jx.jd:return Object(X.a)({},e,{showSelectorMode:t.payload});case jx.eb:return(n=Object(X.a)({},e)).currentPattern[t.payload.sequenceId]=t.payload.currentPattern,n;case jx.jc:var r=e.numberOfPatterns;return r[t.payload.id]=t.payload.numberOfPatterns,Object(X.a)({},e,{numberOfPatterns:r});case jx.bb:return(n=Object(X.a)({},e)).currentStep[t.payload.sequenceId]=t.payload.currentStep,n.currentGlobalStep[t.payload.sequenceId]=t.payload.currentGlobalStep,n;case jx.fb:return(n=Object(X.a)({},e)).currentStep[t.payload.sequenceId]=t.payload.currentStep,n;case jx.cb:return(n=Object(X.a)({},e)).currentGlobalStep[t.payload.sequenceId]=t.payload.currentGlobalStep,n;case jx.Jc:return Object(X.a)({},e,{samplePack:t.payload});case jx.g:return Object(X.a)({},e,{sampleDragging:t.payload});case jx.e:return Object(X.a)({},e,{effectDragging:t.payload});case jx.f:return Object(X.a)({},e,{patternDragging:t.payload});case jx.Ve:return(n=Object(X.a)({},e)).tracksRecording[t.payload.trackNumber]=t.payload.recording,n.tracksPreparingToRecord[t.payload.trackNumber]=!1,n;case jx.Ue:return(n=Object(X.a)({},e)).tracksRecording[t.payload.trackNumber]=!1,n.tracksPreparingToRecord[t.payload.trackNumber]=t.payload.preparing,n;case jx.Cc:return Object(X.a)({},e,{quantized:t.payload});case jx.Qb:return Object(X.a)({},e,{isRecording:t.payload});case jx.Rb:return Object(X.a)({},e,{isRecordingExpanded:t.payload});case jx.Ob:var s=Object(X.a)({},e.isPlaying);return s[t.payload.sequenceId]=t.payload.isPlaying,n=Object(X.a)({},e,{isPlaying:s});case jx.cc:return(n=Object(X.a)({},e)).masterVolumes[t.payload.sequenceId]=t.payload.volume,n;case jx.md:return Object(X.a)({},e,{sequenceName:t.payload});case jx.Xb:return Object(X.a)({},e,{latency:t.payload});case jx.qe:return Object(X.a)({},e,{trackFocused:t.payload});case jx.W:return Object(X.a)({},e,{isCompactMode:t.payload});case jx.yd:return Object(X.a)({},e,{showLFOs:t.payload,showEnvelopes:!1});case jx.Wc:return Object(X.a)({},e,{selectedLFO:t.payload});case jx.Sc:return Object(X.a)({},e,{selectedEnvelope:t.payload});case jx.vd:return Object(X.a)({},e,{showEnvelopes:t.payload,showLFOs:!1});case jx.T:return Object(X.a)({},e,{clockType:t.payload});case jx.Gd:return Object(X.a)({},e,{showSequenceModal:t.payload});case jx.Z:return Object(X.a)({},e,{contextualHelp:t.payload});case jx.Ad:return Object(X.a)({},e,{showModsModal:t.payload});case jx.ac:n=Object(X.a)({},e);var i=t.payload.loading,o=Object(X.a)({},n.loadingSequence);return o[t.payload.id]=i,n.loadingSequence=o,n;case jx.Bc:return Object(X.a)({},e,{automationMode:t.payload});case jx.pd:return Object(X.a)({},e,{sequenceRolling:t.payload});case jx.ze:return Object(X.a)({},e,{trackRolling:t.payload});case jx.Fd:return Object(X.a)({},e,{showSequences:t.payload});case jx.xd:return Object(X.a)({},e,{showInstruments:t.payload});case jx.Dd:return Object(X.a)({},e,{showPresets:t.payload});case jx.Re:return Object(X.a)({},e,{zIndexHack:t.payload});case jx.Ec:return Object(X.a)({},e,{resampleMaster:t.payload});case jx.O:return Object(X.a)({},e,{audioInputSource:t.payload});case jx.nd:return a=Object(X.a)({},e.patternLocks),!t.payload.subSequence in a&&(a[t.payload.subSequence]={}),a[t.payload.subSequence][t.payload.patternNumber]=t.payload.locked,Object(X.a)({},e,{patternLocks:a});case jx.od:return a=Object(X.a)({},e.patternLocks),!t.payload.subSequence in t.payload.patternLocks&&(a[t.payload.subSequence]={}),a[t.payload.subSequence]=t.payload.patternLocks,Object(X.a)({},e,{patternLocks:a});case jx.Cd:return Object(X.a)({},e,{showPasswordModal:t.payload});case jx.qc:return Object(X.a)({},e,{passwordModalCallback:t.payload});case jx.sd:return Object(X.a)({},e,{showConvolverModal:t.payload.show,convolverSample:t.payload.convolverSample});case jx.wd:return Object(X.a)({},e,{showGroups:t.payload});case jx.de:var c=e.subSequences;return c[t.payload.sequenceId]=t.payload.ids,Object(X.a)({},e,{subSequences:c});case jx.gb:var u=e.currentSubSequence;return u[t.payload.sequenceId]=t.payload.subSequenceId,Object(X.a)({},e,{currentSubSequence:u});case jx.Pd:return Object(X.a)({},e,{sidebarViewMode:t.payload});default:return e}},qx={actionsRemaining:200,timeRemaining:0},Mx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qx,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case jx.o:return Object(X.a)({},e,{actionsRemaining:t.payload});case jx.ie:return Object(X.a)({},e,{timeRemaining:t.payload});default:return e}},Dx={triggers:{},trackSteps:{},trackStepIds:{},trackFills:{},tracksFrozen:{},frozenTracksPlaying:{},trackPatternSteps:{},trackPianoRollSteps:{},trackPianoRollDurations:{},trackVolumes:{},trackPannings:{},trackMutes:{},trackSolos:{},groupVolumes:{},groupPannings:{},groupMutes:{},trackWarps:{},trackPianoRollPositions:{},sendMutes:{},trackSendVolumes:{},trackIsEnabled:{},selectedSampleTags:{},tracksToResample:[],trackToFreeze:void 0,trackPatternLocks:{},trackEffectsChain:{},showTrackEffects:{},lfoPatternLocks:{},envelopePatternLocks:{},isResampling:!1,resampleDuration:1,sampleSlices:{},trackIsLoading:{},annotationDragging:void 0},Ax=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Dx,n=arguments.length>1?arguments[1]:void 0,a=void 0,r=void 0;switch(n.type){case jx.l:return Dx;case jx.Se:return void 0===(e=Object(X.a)({},t)).triggers[n.payload.trackNumber]&&(e.triggers[n.payload.trackNumber]={}),e.triggers[n.payload.trackNumber][n.payload.sliceNumber]=!0,e;case jx.Te:return void 0===(e=Object(X.a)({},t)).triggers[n.payload.trackNumber]&&(e.triggers[n.payload.trackNumber]={}),e.triggers[n.payload.trackNumber][n.payload.sliceNumber]=!1,e;case jx.u:return(e=Object(X.a)({},t)).trackSteps[n.payload.trackNumber]=n.payload.steps,e.trackPatternSteps[n.payload.trackNumber]=n.payload.patternSteps,e.trackFills[n.payload.trackNumber]=n.payload.fills,e.trackStepIds[n.payload.trackNumber]=n.payload.stepToId,n.payload.pianoRollSteps&&(e.trackPianoRollSteps[n.payload.trackNumber]=n.payload.pianoRollSteps),e.trackPianoRollPositions[n.payload.trackNumber]=n.payload.stepToPosition,e.trackPianoRollDurations[n.payload.trackNumber]=n.payload.pianoRollDurations,e;case jx.We:for(var s in(e=Object(X.a)({},t)).trackSteps={},e.trackFills={},e.trackPianoRollSteps={},e.trackStepIds={},e.trackPatternSteps={},e.trackPianoRollPositions={},e.trackPianoRollDurations={},e.trackMutes={},n.payload){var i=n.payload[s];e.trackSteps[i.trackNumber]=i.steps,e.trackFills[i.trackNumber]=i.trackFills,e.trackStepIds[i.trackNumber]=i.stepToId,e.trackPatternSteps[i.trackNumber]=i.trackPatternSteps,void 0!==i.pianoRollSteps&&(e.trackPianoRollSteps[i.trackNumber]=i.pianoRollSteps),e.trackPianoRollPositions[i.trackNumber]=i.pianoRollPositions,e.trackPianoRollDurations[i.trackNumber]=i.pianoRollDurations,e.trackMutes[i.trackNumber]=i.muted}return e;case jx.Ce:return(e=Object(X.a)({},t)).trackSteps[n.payload.trackNumber]=n.payload.steps,e;case jx.pe:return(e=Object(X.a)({},t)).trackFills[n.payload.trackNumber]=n.payload.fills,e;case jx.ye:return(e=Object(X.a)({},t)).trackPianoRollSteps[n.payload.trackNumber]=n.payload.steps,e;case jx.ue:return(e=Object(X.a)({},t)).trackMutes[n.payload.trackNumber]=n.payload.muted,e;case jx.Be:return(e=Object(X.a)({},t)).trackSolos[n.payload.trackNumber]=n.payload.solo,e;case jx.Ee:return(e=Object(X.a)({},t)).trackVolumes[n.payload.trackNumber]=n.payload.volume,e;case jx.ve:return(e=Object(X.a)({},t)).trackPannings[n.payload.trackNumber]=n.payload.pan,e;case jx.Hb:return(e=Object(X.a)({},t)).groupVolumes[n.payload.groupNumber]=n.payload.volume,e;case jx.Gb:return(e=Object(X.a)({},t)).groupPannings[n.payload.groupNumber]=n.payload.pan,e;case jx.Fb:return(e=Object(X.a)({},t)).groupMutes[n.payload.groupNumber]=n.payload.muted,e;case jx.kd:return(e=Object(X.a)({},t)).sendMutes[n.payload.sendNumber]=n.payload.muted,e;case jx.Ae:return void 0===(a=(e=Object(X.a)({},t)).trackSendVolumes[n.payload.trackVolume])&&(a={}),a[n.payload.sendNumber]=n.payload.volume,e.trackSendVolumes[n.payload.trackVolume]=a,e;case jx.se:var o=(e=Object(X.a)({},t)).trackIsEnabled[n.payload.subSequenceId]||{};return o[n.payload.trackNumber]=n.payload.isEnabled,e.trackIsEnabled[n.payload.subSequenceId]=o,e;case jx.Fe:var c=(e=Object(X.a)({},t)).trackWarps[n.payload.subSequenceId]||{};return c[n.payload.trackNumber]=n.payload.warp,e.trackWarps[n.payload.subSequenceId]=c,e;case jx.ge:return(e=Object(X.a)({},t)).trackWarps[n.payload.subSequenceId]=n.payload.warps,e;case jx.dd:return(e=Object(X.a)({},t)).selectedSampleTags[n.payload.sampleId]=n.payload.tag,e;case jx.t:return Object(X.a)({},t,{trackPatternLocks:n.payload});case jx.s:return Object(X.a)({},t,{lfoPatternLocks:n.payload});case jx.r:return Object(X.a)({},t,{envelopePatternLocks:n.payload});case jx.De:return Object(X.a)({},t,{trackToFreeze:n.payload});case jx.we:return void 0===(e=Object(X.a)({},t)).trackPatternLocks[n.payload.subSequence]&&(e.trackPatternLocks[n.payload.subSequence]={}),(a=e.trackPatternLocks[n.payload.subSequence][n.payload.trackNumber]||{})[n.payload.patternNumber]=n.payload.locked,e.trackPatternLocks[n.payload.subSequence][n.payload.trackNumber]=a,e;case jx.xe:return void 0===(e=Object(X.a)({},t)).trackPatternLocks[n.payload.subSequence]&&(e.trackPatternLocks[n.payload.subSequence]={}),e.trackPatternLocks[n.payload.subSequence][n.payload.trackNumber]=n.payload.patternLocks,e;case jx.ke:return Object(X.a)({},t,{tracksToResample:n.payload});case jx.xb:return(e=Object(X.a)({},t)).envelopePatternLocks[n.payload.subSequence]=n.payload.patternLocks,e;case jx.Yb:return(e=Object(X.a)({},t)).lfoPatternLocks[n.payload.subSequence]=n.payload.patternLocks,e;case jx.Tb:return Object(X.a)({},t,{isResampling:n.payload});case jx.Dc:return Object(X.a)({},t,{resampleDuration:n.payload});case jx.oe:return(e=Object(X.a)({},t)).trackEffectsChain[n.payload.trackNumber]=n.payload.effectsChain,e;case jx.Kc:return(e=Object(X.a)({},t)).sampleSlices[n.payload.id]=n.payload.slices,e;case jx.Ld:return(e=Object(X.a)({},t)).showTrackEffects[n.payload.trackNumber]=n.payload.show,e;case jx.j:for(var u in(e=Object(X.a)({},t)).showTrackEffects)e.showTrackEffects[u]=!1;return e;case jx.re:return(r=(e=Object(X.a)({},t)).tracksFrozen[n.payload.subSequenceId]||{})[n.payload.trackNumber]=n.payload.frozen,e.tracksFrozen[n.payload.subSequenceId]=r,e;case jx.te:return(r=(e=Object(X.a)({},t)).trackIsLoading[n.payload.subSequenceId]||{})[n.payload.trackNumber]=n.payload.isLoading,e.trackIsLoading[n.payload.subSequenceId]=r,e;case jx.Eb:return(r=(e=Object(X.a)({},t)).frozenTracksPlaying[n.payload.subSequenceId]||{})[n.payload.trackNumber]=n.payload.playing,e.frozenTracksPlaying[n.payload.subSequenceId]=r,e;case jx.Cb:return(e=Object(X.a)({},t)).tracksFrozen[n.payload.subSequenceId]=n.payload.frozenTracks,e;case jx.Db:return(e=Object(X.a)({},t)).frozenTracksPlaying[n.payload.subSequenceId]=n.payload.frozenTracksPlaying,e;case jx.mc:return(e=Object(X.a)({},t)).parametersToRecord=n.payload,e;case jx.w:return Object(X.a)({},t,{annotationDragging:n.payload});default:return t}},Rx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case jx.l:return{};case jx.Gc:var n=Object.assign({},e);return n[t.payload.sampleId]=t.payload.sample,n;default:return e}},Ix={parameterAutomations:{},trackDevice:{},trackSubDevice:{},trackParameter:{},show:!1},Lx=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ix,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case jx.le:var a=Object(X.a)({},t.trackDevice);return a[n.payload.trackId]=n.payload.device,(e=Object(X.a)({},t.trackParameter))[n.payload.trackId]=void 0,Object(X.a)({},t,{trackDevice:a,trackParameter:e});case jx.ne:var r=Object(X.a)({},t.trackSubDevice);return r[n.payload.trackId]=n.payload.subDevice,(e=Object(X.a)({},t.trackParameter))[n.payload.trackId]=void 0,Object(X.a)({},t,{trackSubDevice:r,trackParameter:e});case jx.me:return(e=Object(X.a)({},t.trackParameter))[n.payload.trackId]=n.payload.parameter,Object(X.a)({},t,{trackParameter:e});case jx.qd:return Object(X.a)({},t,{show:n.payload.show});case jx.nc:var s=Object(X.a)({},t.parameterAutomations);return s[n.payload.parameter.id]=n.payload.automations,Object(X.a)({},t,{parameterAutomations:s});default:return t}},Fx={track:0,step:0,show:!1},Vx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Fx,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case jx.kb:return Object(X.a)({},e,{track:t.payload});case jx.jb:return Object(X.a)({},e,{step:t.payload});case jx.ib:return Object(X.a)({},e,{show:t.payload});default:return e}},Bx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case jx.Mb:return{instrumentTypeDragging:t.payload};default:return e}},Ux={selectedGuild:void 0},Hx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ux,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case jx.Vc:return Object(X.a)({},e,{selectedGuild:t.payload});default:return e}},Jx=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;switch(n.type){case jx.a:return(e=Object.assign({},t))[n.payload.id]=n.payload,e;case jx.m:return delete(e=Object.assign({},t))[n.payload.id],e;default:return t}},Gx={selectedGroup:void 0,selectedTrack:void 0,selectedStep:void 0,hoveredStep:void 0,selectedParameter:void 0,selectedParameterFlashing:void 0,effectsPaneOption:"EFFECTS",isPlayingMix:!1,isRecordingMix:!1,erasingAutomation:!1,mixes:[],currentMix:void 0,multiParameterSliderValues:{},mixViewMode:"ALL",subSequenceFades:{},subSequenceMuted:{},selectedSequence:void 0},zx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Gx,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case jx.Uc:return Object(X.a)({},e,{selectedGroup:t.payload});case jx.id:return Object(X.a)({},e,{selectedTrack:t.payload});case jx.gd:return Object(X.a)({},e,{selectedStep:t.payload});case jx.Lb:return Object(X.a)({},e,{hoveredStep:t.payload});case jx.Yc:return Object(X.a)({},e,{selectedParameter:t.payload});case jx.Zc:return Object(X.a)({},e,{selectedParameterFlashing:t.payload});case jx.sb:return Object(X.a)({},e,{effectsPaneOption:t.payload});case jx.Sb:return Object(X.a)({},e,{isRecordingMix:t.payload});case jx.Pb:return Object(X.a)({},e,{isPlayingMix:t.payload});case jx.fc:return Object(X.a)({},e,{mixes:t.payload});case jx.db:return Object(X.a)({},e,{currentMix:t.payload});case jx.yb:return Object(X.a)({},e,{erasingAutomation:t.payload});case jx.hc:return Object(X.a)({},e,{mixViewMode:t.payload});case jx.ee:var n=Object(X.a)({},e.subSequenceFades);return n[t.payload.subSequenceId]=t.payload.value,Object(X.a)({},e,{subSequenceFades:n});case jx.ic:var a=e.multiParameterSliderValues;return a[t.payload.id]=t.payload.value,Object(X.a)({},e,{multiParameterSliderValues:a});case jx.fe:var r=Object(X.a)({},e);return r.subSequenceMuted[t.payload.id]=t.payload.muted,r;case jx.fd:return Object(X.a)({},e,{selectedSequence:t.payload});default:return e}},_x={selectedFolder:void 0,folderDragging:void 0,presetDragging:void 0,selectedPreset:void 0,hasChangesToFolders:!1},Wx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_x,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case jx.Tc:return Object(X.a)({},e,{selectedPreset:void 0,selectedFolder:t.payload});case jx.bd:return Object(X.a)({},e,{selectedFolder:void 0,selectedPreset:t.payload});case jx.Ib:return Object(X.a)({},e,{hasChangesToFolders:t.payload});case jx.Bb:return Object(X.a)({},e,{folderDragging:t.payload});case jx.Ac:return Object(X.a)({},e,{presetDragging:t.payload});default:return e}},Kx={notes:[],isDragToggled:!1,dragStepTranspose:void 0,stepDragging:void 0,stepDataDragging:void 0,isDraggingDuration:!1,stepToCopy:void 0,transposeDragging:void 0,isMouseDown:!1,isCommandDown:!1,pianoRollSelection:void 0,selectedPianoRollSteps:void 0,stepsToCopy:void 0,easyPatternToCopy:void 0,lastMidiKeyMapped:void 0,pianoRollPagination:void 0,keyMappings:{},padMappings:{},lastNotePlayed:void 0,dragOffset:void 0,cursor:void 0},Yx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kx,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case jx.i:return Object(X.a)({},e,{isDragToggled:t.payload});case jx.h:return Object(X.a)({},e,{dragStepTranspose:t.payload});case jx.k:var n=t.payload;return Object(X.a)({},e,{isMouseDown:n});case jx.b:return Object(X.a)({},e,{isCommandDown:t.payload});case jx.Yd:return Object(X.a)({},e,{stepDragging:t.payload});case jx.be:return Object(X.a)({},e,{stepToCopy:t.payload});case jx.Nb:return Object(X.a)({},e,{isDraggingDuration:t.payload});case jx.wc:return Object(X.a)({},e,{notes:t.payload});case jx.Wd:return Object(X.a)({},e,{stepDataDragging:t.payload.stepData,stepDragging:t.payload.stepNumber});case jx.Xd:return Object(X.a)({},e,{stepDataDragging:t.payload});case jx.yc:return void 0===t.payload.stepNumber?Object(X.a)({},e,{pianoRollSelection:void 0}):Object(X.a)({},e,{pianoRollSelection:t.payload});case jx.ad:return Object(X.a)({},e,{selectedPianoRollSteps:t.payload});case jx.Vd:return Object(X.a)({},e,{stepsToCopy:t.payload});case jx.pb:return Object(X.a)({},e,{easyPatternToCopy:t.payload});case jx.Vb:return Object(X.a)({},e,{lastMidiKeyMapped:t.payload});case jx.Ge:return Object(X.a)({},e,{transposeDragging:t.payload.transpose});case jx.xc:return Object(X.a)({},e,{pianoRollPagination:t.payload});case jx.Ub:return Object(X.a)({},e,{keyMappings:t.payload});case jx.lc:return Object(X.a)({},e,{padMappings:t.payload});case jx.Wb:return Object(X.a)({},e,{lastNotePlayed:t.payload});case jx.vc:return Object(X.a)({},e,{dragOffset:t.payload});case jx.uc:return Object(X.a)({},e,{cursor:t.payload});default:return e}},Qx={selectedEffect:void 0,selectedSendEffect:void 0,effectParameters:{},midiEffectDragging:void 0,effectCollapsed:{},effectsChainToShow:{},effectRackNodePositions:{}},Xx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Qx,t=arguments.length>1?arguments[1]:void 0,n=Object(X.a)({},e);switch(t.type){case jx.l:return Qx;case jx.Rc:return Object(X.a)({},e,{selectedEffect:t.payload});case jx.ed:return Object(X.a)({},e,{selectedSendEffect:t.payload});case jx.dc:return Object(X.a)({},e,{midiEffectDragging:t.payload});case jx.ub:return(n=Object(X.a)({},e)).effectParameters[t.payload.id]=t.payload.value,n;case jx.vb:var a=Object(X.a)({},e.effectParameters,t.payload);return Object(X.a)({},e,{effectParameters:a});case jx.rb:var r=Object(X.a)({},e.effectsChainToShow),s=r[t.payload.subSequenceId]||{};return s[t.payload.trackNumber]=t.payload.chainNumber,r[t.payload.subSequenceId]=s,Object(X.a)({},e,{effectsChainToShow:r});case jx.tb:return(n=Object(X.a)({},e)).effectCollapsed[t.payload.id]=t.payload.isCollapsed,n;case jx.qb:return(n=Object(X.a)({},e)).effectsChainToShow[t.payload.subSequenceId]=t.payload.effectsChains,n;case jx.wb:var i=e.effectRackNodePositions[t.payload.rackId]||{};i[t.payload.effectId]={x:t.payload.x,y:t.payload.y};var o=Object(X.a)({},e.effectRackNodePositions);return o[t.payload.rackId]=i,Object(X.a)({},e,{effectRackNodePositions:o});default:return e}},Zx={yearSelected:void 0,countriesSelected:{},sampleToExplore:void 0,stylesSelected:{},tagsSelected:{},videosSelected:{},discogsSelected:{},sampleDragging:void 0,chordSelected:void 0,hierarchyRoot:void 0,hierarchyTreeTags:void 0,showYearSlider:!1,showCountries:!1,showStyles:!1,showVideos:!1,showTags:!0,showChordFilter:!1,showDateSampled:!1,searchResultsSamples:[],selectedChordSample:void 0,waveformSelection:void 0,sortBy:"RANDOM",sidebarCollapsed:!1,dateSampled:void 0,startX:0,startY:0,endX:0,endY:0,similarSoundsToFind:void 0,showSamples2D:!1,searchResultsStart:0},$x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Zx,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case jx.Pe:return Object(X.a)({},e,{yearSelected:t.payload});case jx.he:return Object(X.a)({},e,{tagsSelected:t.payload});case jx.Nc:return Object(X.a)({},e,{searchResultsStart:t.payload});case jx.ab:return Object(X.a)({},e,{countriesSelected:t.payload});case jx.Ke:return Object(X.a)({},e,{videosSelected:t.payload});case jx.ob:return Object(X.a)({},e,{discogsSelected:t.payload});case jx.ce:return Object(X.a)({},e,{stylesSelected:t.payload});case jx.Jb:return Object(X.a)({},e,{hierarchyRoot:t.payload});case jx.Kb:return Object(X.a)({},e,{hierarchyTreeTags:t.payload});case jx.Kd:return Object(X.a)({},e,{showTags:t.payload});case jx.Nd:return Object(X.a)({},e,{showYearSlider:t.payload});case jx.td:return Object(X.a)({},e,{showCountries:t.payload});case jx.Jd:return Object(X.a)({},e,{showStyles:t.payload});case jx.rd:return Object(X.a)({},e,{showChordFilter:t.payload});case jx.R:return Object(X.a)({},e,{chordSelected:t.payload});case jx.Mc:return Object(X.a)({},e,{searchResultsSamples:t.payload});case jx.Qc:return Object(X.a)({},e,{selectedChordSample:t.payload});case jx.Md:return Object(X.a)({},e,{showVideos:t.payload});case jx.Ne:return Object(X.a)({},e,{waveformSelection:t.payload});case jx.Oe:var n=Object(X.a)({},e.waveformSelection,{end:t.payload});return Object(X.a)({},e,{waveformSelection:n});case jx.Oc:return Object(X.a)({},e,{sortBy:t.payload});case jx.Od:return Object(X.a)({},e,{sidebarCollapsed:t.payload});case jx.ud:return Object(X.a)({},e,{showDateSampled:t.payload});case jx.lb:return Object(X.a)({},e,{dateSampled:t.payload});case jx.Rd:return Object(X.a)({},e,{similarSoundsToFind:t.payload});case jx.Ed:return Object(X.a)({},e,{showSamples2D:t.payload});case jx.n:return Object(X.a)({},e,{startX:t.payload.startX,startY:t.payload.startY,endX:t.payload.endX,endY:t.payload.endY});case jx.Ic:return Object(X.a)({},e,{sampleDragging:t.payload});case jx.Lc:return Object(X.a)({},e,{showSamples2D:void 0!==t.payload,sampleToExplore:t.payload});default:return e}},eN={sampleAuditioning:void 0},tN=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:eN,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case jx.Hc:return Object(X.a)({},e,{sampleAuditioning:t.payload});default:return e}},nN={viewMode:"SPOTLIGHT",currentMix:void 0,hasEditsToSave:!1,loadedTracks:[],bpm:120,spotlightTracks:[]},aN=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nN,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case jx.Je:return Object(X.a)({},e,{viewMode:t.payload});case jx.hb:return Object(X.a)({},e,{currentMix:t.payload});case jx.He:return Object(X.a)({},e,{hasEditsToSave:t.payload});case jx.Zb:return Object(X.a)({},e,{loadedTracks:t.payload});case jx.Q:return Object(X.a)({},e,{bpm:t.payload});case jx.Td:return Object(X.a)({},e,{spotlightTracks:t.payload});default:return e}},rN={patternToEditColor:void 0,patternColors:{}},sN=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:rN,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case jx.sc:return Object(X.a)({},e,{patternToEditColor:t.payload});case jx.rc:var n=Object(X.a)({},e.patternColors);return n[t.payload.pattern]=t.payload.color,Object(X.a)({},e,{patternColors:n});default:return e}},iN={stepsSelection:void 0,selectedSteps:void 0,stepNumberDraggingFrom:void 0,stepNumberDraggedTo:void 0,singleStepToDrag:void 0,showStepOptions:void 0,masterStepToggles:Array(16).fill(!0)},oN=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:iN,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case jx.Ud:return void 0===t.payload.fromStep?Object(X.a)({},e,{stepsSelection:void 0}):Object(X.a)({},e,{stepsSelection:t.payload});case jx.hd:return void 0===t.payload.trackNumber?Object(X.a)({},e,{selectedSteps:void 0}):Object(X.a)({},e,{selectedSteps:t.payload});case jx.ae:return Object(X.a)({},e,{stepNumberDraggingFrom:t.payload});case jx.bc:return Object(X.a)({},e,{masterStepToggles:t.payload});case jx.Sd:return Object(X.a)({},e,{singleStepToDrag:t.payload});case jx.Zd:return Object(X.a)({},e,{stepNumberDraggedTo:t.payload});case jx.Id:return void 0===t.payload.option?Object(X.a)({},e,{showStepOptions:void 0}):Object(X.a)({},e,{showStepOptions:{option:t.payload.option,effect:t.payload.effect}});default:return e}},cN={youtubeSearchTerms:"",selectedRecord:void 0},uN=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:cN,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case jx.Qe:return Object(X.a)({},e,{youtubeSearchTerms:t.payload});case jx.cd:return Object(X.a)({},e,{selectedRecord:t.payload});default:return e}},lN={midiMapMode:"OFF",parameterSelected:void 0,mappings:{},actionSelected:void 0,actionMappings:{}},pN=function(){var e,t,n,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:lN,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case jx.ec:return Object(X.a)({},a,{midiMapMode:r.payload,parameterSelected:void 0,actionSelected:void 0});case jx.pc:return Object(X.a)({},a,{actionSelected:void 0,parameterSelected:r.payload});case jx.q:return Object(X.a)({},a,{parameterSelected:void 0,actionSelected:r.payload});case jx.oc:return void 0===(t=Object(X.a)({},a.mappings))[e=r.payload.midiControl]&&(t[e]=[]),t[e].push(r.payload.parameter),Object(X.a)({},a,{mappings:t});case jx.p:return void 0===(n=Object(X.a)({},a.actionMappings))[e=r.payload.midiControl]&&(n[e]=[]),n[e].push(r.payload.action),Object(X.a)({},a,{actionMappings:n});case jx.d:var s={},i=r.payload;for(var o in a.mappings){var c=a.mappings[o],u=c.indexOf(i);u>-1&&c.splice(u,1),c.length>0&&(s[o]=c)}return Object(X.a)({},a,{mappings:s,parameterSelected:void 0,midiMapMode:"OFF"});case jx.c:return n=Object(X.a)({},a.actionMappings),t=Object(X.a)({},a.mapping),delete n[r.payload],delete t[r.payload],Object(X.a)({},a,{mappings:t,actionMappings:n});default:return a}},hN={connectionStatus:"NONE",connectedUserName:void 0,clockTick:void 0,playScheduled:!1,availableUsers:[]},dN=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hN,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case jx.Y:return Object(X.a)({},e,{connectionStatus:t.payload});case jx.X:return Object(X.a)({},e,{connectedUserName:t.payload});case jx.S:return Object(X.a)({},e,{clockTick:t.payload});case jx.zc:return Object(X.a)({},e,{playScheduled:t.payload});case jx.P:return console.log("setting available users = "),console.log(t.payload),Object(X.a)({},e,{availableUsers:t.payload});default:return e}},fN={showShareSequenceModal:!1},mN=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fN,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case jx.Hd:return console.log("setting share sequence modal = "+t.payload),Object(X.a)({},e,{showShareSequenceModal:t.payload});default:return e}},vN={totalLength:300,browserMode:1,bottomHeight:300,bottomMode:Jk,patternDragging:void 0,patternResizing:void 0,isBottomResizing:!1,patternStartSteps:{},loopSelected:!1,mixEvents:{},xScale:.5,selectedEvents:void 0,selection:{start:0,end:64},looping:!1,mouseX:void 0,automationTypeToShow:{},selectedRows:[],rowSelections:{},cursorStep:void 0},gN=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:vN,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case jx.gc:var n=Object(X.a)({},e.mixEvents),a=n[t.payload.subSequenceId]||{};return a[t.payload.type]=t.payload.events,n[t.payload.subSequenceId]=a,Object(X.a)({},e,{mixEvents:n});case jx.x:var r=Object(X.a)({},e.automationTypeToShow);return r[t.payload.subSequenceId]=t.payload.type,Object(X.a)({},e,{automationTypeToShow:r});case jx.Pc:return Object(X.a)({},e,{rowSelections:void 0===t.payload?e.rowSelections:{},selectedEvents:t.payload});case jx.L:return void 0===t.payload.start?Object(X.a)({},e,{selection:void 0}):Object(X.a)({},e,{selection:{start:t.payload.start,end:t.payload.end}});case jx.J:return Object(X.a)({},e,{selectedEvents:void 0===t.payload?e.selectedEvents:void 0,rowSelections:Object(X.a)({},t.payload)});case jx.F:return Object(X.a)({},e,{mouseX:t.payload});case jx.D:return Object(X.a)({},e,{looping:t.payload});case jx.E:return Object(X.a)({},e,{loopSelected:t.payload});case jx.K:return Object(X.a)({},e,{selectedRows:t.payload});case jx.M:return Object(X.a)({},e,{xScale:t.payload});case jx.y:return Object(X.a)({},e,{bottomHeight:t.payload});case jx.z:var s=Gk[t.payload];return Object(X.a)({},e,{bottomMode:t.payload,bottomHeight:void 0!==s?s:0});case jx.A:return Object(X.a)({},e,{isBottomResizing:t.payload});case jx.G:return Object(X.a)({},e,{patternDragging:t.payload});case jx.H:return Object(X.a)({},e,{patternResizing:t.payload});case jx.I:var i=e.patternStartSteps[t.payload.subSequenceId]||{};i[t.payload.patternId]=t.payload.startStep;var o=e.patternStartSteps;return o[t.payload.subSequenceId]=i,Object(X.a)({},e,{patternStartSteps:o});case jx.C:return Object(X.a)({},e,{cursorStep:t.payload});case jx.B:return Object(X.a)({},e,{browserMode:t.payload});default:return e}},bN={selectedOnsets:{},onsetThreshold:.5,showingOnsets:!1},yN=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bN,t=arguments.length>1?arguments[1]:void 0,n=Object(X.a)({},e);switch(t.type){case jx.Xc:return n.selectedOnsets[t.payload.id]=t.payload.selectedOnsets,n;case jx.kc:return Object(X.a)({},e,{onsetThreshold:t.payload});case jx.Bd:return Object(X.a)({},e,{showingOnsets:t.payload});default:return e}},kN={pendingTransactions:[]},EN=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:kN,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case jx.tc:return Object(X.a)({},e,{pendingTransactions:t.payload});default:return e}},SN={commandInput:void 0,commandPrefix:void 0,viMode:!1},ON=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:SN,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case jx.U:return Object(X.a)({},e,{commandInput:t.payload});case jx.V:return Object(X.a)({},e,{commandPrefix:t.payload});case jx.Me:return Object(X.a)({},e,{viMode:t.payload});default:return e}},wN={mixerEffects:{REVERB:!0,PHASER:!1,DELAY:!1},eqEffects:{LOW:!0,MID:!0,HIGH:!0}},CN=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wN,t=arguments.length>1?arguments[1]:void 0,n=Object(X.a)({},e);switch(t.type){case jx.Ab:return n.mixerEffects=Object(X.a)({},n.mixerEffects),n.mixerEffects[t.payload.effect]=t.payload.toggle,n;case jx.zb:return n.eqEffects=Object(X.a)({},n.eqEffects),n.eqEffects[t.payload.type]=t.payload.toggle,n;default:return e}},PN=Object(Tx.b)({sequencer:Nx,tracks:Ax,cursor:Vx,samples:Rx,guilds:Hx,palette:Jx,presets:Wx,mix:zx,keyboard:Yx,effects:Xx,selector:$x,audition:tN,user:aN,toolbar:sN,steps:oN,discover:uN,midi:pN,clock:dN,modals:mN,arrangement:gN,waveform:yN,transactions:EN,commands:ON,explore:CN,instruments:Bx,automation:Lx,installation:Mx}),TN=Object(Tx.c)(PN);i.a.render(r.a.createElement(y.a,{store:TN},r.a.createElement(wx,{store:TN})),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("","/service-worker.js");Cx?function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):Px(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e):Px(e)})}}()},26:function(e,t,n){"use strict";(function(e){n.d(t,"i",function(){return d}),n.d(t,"h",function(){return f}),n.d(t,"f",function(){return m}),n.d(t,"g",function(){return v}),n.d(t,"n",function(){return g}),n.d(t,"b",function(){return b}),n.d(t,"e",function(){return y}),n.d(t,"d",function(){return k}),n.d(t,"l",function(){return E}),n.d(t,"j",function(){return S}),n.d(t,"k",function(){return O}),n.d(t,"a",function(){return w}),n.d(t,"m",function(){return C}),n.d(t,"c",function(){return P});var a=n(1),r=n(2),s=n(43),i=n.n(s),o=n(150),c=n(66),u="undefined"!==typeof window.web3?new i.a(window.web3.currentProvider):new i.a(new i.a.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),l=u.utils.padLeft("0x0",64),p=function(){function e(t,n){Object(a.a)(this,e),this.toConversion=t,this.fromConversion=n}return Object(r.a)(e,[{key:"convertTo",value:function(e){return this.toConversion(e)}},{key:"convertFrom",value:function(e){return e===l?null:this.fromConversion(e)}}]),e}();function h(e){var t="";for(var n in e)0!=e.charCodeAt(n)&&(t+=e.charAt(n));return t}var d=new p(function(e){return function(e){var t=c.decode(e).toString("hex").replace(/^1220/,"");return 64!=t.length?null:"0x"+t}(e)},function(t){return function(t){var n=new e(t.replace(/^0x/,"1220"),"hex");return c.encode(n)}(t)}),f=new p(function(e){return u.utils.padLeft(u.utils.numberToHex(e),64)},function(e){return u.utils.hexToNumber(e)}),m=new p(function(e){return u.utils.padLeft(u.utils.numberToHex(e),64)},function(e){return h(u.utils.toAscii(e))}),v=new p(function(e){return u.utils.padLeft(u.utils.numberToHex(e),64)},function(e){return u.utils.hexToNumber(e)}),g=new p(function(e){return u.utils.padLeft(u.utils.numberToHex(parseInt(e)),64)},function(e){return u.utils.hexToNumber(e)}),b=new p(function(e){return u.utils.padRight(u.utils.fromAscii(e),64)},function(e){return h(u.utils.toAscii(e))}),y=new p(function(e){return u.utils.padLeft(u.utils.fromAscii(e),64)},function(e){return h(u.utils.toAscii(e))}),k=new p(function(e){return u.utils.padLeft(u.utils.toHex(e),64)},function(e){return function(e){for(var t=0;t<e.length;t++)if("0"!==e.slice(t,t+1))return e.slice(t);return e}(e.slice(2))});var E=new p(function(e){return u.utils.padRight(u.utils.toHex(e),64)},function(e){return h(u.utils.toAscii(e))}),S=new p(function(e){return u.utils.padRight(e,64)},function(e){return h(u.utils.toAscii(e)).split("").map(function(e){return o.a[e]})}),O=new p(function(e){return u.utils.padRight(e,64)},function(e){return o.a[h(u.utils.toAscii(e))]}),w=new p(function(e){return u.utils.padLeft(e,64)},function(e){return function(e){return"0x"+e.slice(e.length-40)}(e)}),C=new p(function(e){return u.utils.padLeft(e[0],64)},function(e){return h(u.utils.toAscii(e))}),P=function(e){return new p(function(e){return e},function(t){return t.slice(2,2+64*e)})}}).call(this,n(15).Buffer)},271:function(e,t,n){},282:function(e,t,n){"use strict";var a=n(1),r=n(2),s=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,[{key:"getName",value:function(){}},{key:"getId",value:function(){}}]),e}();t.a=s},283:function(e,t,n){"use strict";var a=n(1);t.a=function e(){Object(a.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"sampleIpfs",type:"bytes32"},{name:"notes",type:"bytes32[32]"},{name:"startTime",type:"uint32"},{name:"endTime",type:"uint32"},{name:"noteSequenceIpfs",type:"bytes32"}],name:"newNoteSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"sampleIpfs",type:"bytes32"},{name:"notes",type:"bytes32[256]"},{name:"startTimes",type:"uint32[8]"},{name:"endTimes",type:"uint32[8]"},{name:"noteSequenceIpfs",type:"bytes32"}],name:"newNoteSequenceLarge",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"noteSequenceIpfs",type:"bytes32"}],name:"NewNoteSequence",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"noteA",type:"bytes32"},{indexed:!0,name:"noteB",type:"bytes32"},{indexed:!1,name:"startTime",type:"uint32"},{indexed:!1,name:"endTime",type:"uint32"},{indexed:!1,name:"remainingNotes",type:"bytes32"}],name:"NewNotesAggregation",type:"event"}],this.contractAddress="0x3edab21966363a5c9d69ba0ed78abc5b9c6007c5"}},31:function(e,t,n){"use strict";var a=n(26),r=n(1),s=function e(t,n){Object(r.a)(this,e),this.event=t,this.topics=n;for(var a=arguments.length,s=new Array(a>2?a-2:0),i=2;i<a;i++)s[i-2]=arguments[i];this.data=s},i=n(2),o=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Object(r.a)(this,e),this.name=t,this.type=n,this.size=64*a}return Object(i.a)(e,[{key:"convertTo",value:function(e){if(void 0!==e&&null!==e)return this.type.convertTo(e)}},{key:"convertFrom",value:function(e){if(void 0!==e&&null!==e)return this.type.convertFrom(e)}}]),e}();n.d(t,"E",function(){return c}),n.d(t,"D",function(){return u}),n.d(t,"H",function(){return l}),n.d(t,"A",function(){return p}),n.d(t,"I",function(){return h}),n.d(t,"J",function(){return d}),n.d(t,"B",function(){return f}),n.d(t,"r",function(){return m}),n.d(t,"f",function(){return v}),n.d(t,"s",function(){return g}),n.d(t,"C",function(){return b}),n.d(t,"G",function(){return y}),n.d(t,"K",function(){return k}),n.d(t,"Q",function(){return E}),n.d(t,"x",function(){return S}),n.d(t,"h",function(){return O}),n.d(t,"j",function(){return w}),n.d(t,"k",function(){return C}),n.d(t,"l",function(){return P}),n.d(t,"c",function(){return T}),n.d(t,"g",function(){return j}),n.d(t,"a",function(){return x}),n.d(t,"u",function(){return N}),n.d(t,"t",function(){return q}),n.d(t,"w",function(){return M}),n.d(t,"v",function(){return D}),n.d(t,"q",function(){return A}),n.d(t,"d",function(){return R}),n.d(t,"y",function(){return I}),n.d(t,"z",function(){return L}),n.d(t,"F",function(){return F}),n.d(t,"b",function(){return V}),n.d(t,"n",function(){return B}),n.d(t,"m",function(){return U}),n.d(t,"i",function(){return H}),n.d(t,"R",function(){return J}),n.d(t,"N",function(){return G}),n.d(t,"L",function(){return z}),n.d(t,"M",function(){return _}),n.d(t,"O",function(){return W}),n.d(t,"P",function(){return K}),n.d(t,"e",function(){return Y}),n.d(t,"p",function(){return Q}),n.d(t,"o",function(){return X});var c=new s("SampleTagged(bytes32,bytes32,uint32)",[new o("ipfsHash",a.i),new o("tag",a.b),new o("guildId",a.g)]),u=new s("SampleStyle(bytes32,bytes32,uint32)",[new o("ipfsHash",a.i),new o("style",a.b),new o("guildId",a.g)]),l=new s("SampleYear(bytes32,int16,uint32)",[new o("ipfsHash",a.i),new o("year",a.f),new o("guildId",a.g)]),p=new s("SampleCountry(bytes32,bytes32,uint32)",[new o("ipfsHash",a.i),new o("country",a.b),new o("guildId",a.g)]),h=new s("SampledYoutube(bytes32,bytes32,uint32)",[new o("ipfsHash",a.i),new o("videoId",a.l),new o("guildId",a.g)]),d=new s("SequenceCreated(address,bytes32,string)",[new o("user",a.a),new o("ipfsHash",a.i)],new o("title",a.m)),f=new s("SampleCreated(address,bytes32,string,uint32)",[new o("user",a.a),new o("ipfsHash",a.i),new o("guildId",a.g)],new o("title",a.m)),m=new s("NewNoteSequence(bytes32,bytes32)",[new o("sampleHash",a.i),new o("noteSequenceHash",a.i)]),v=new s("NewDiscogsSample(bytes32,uint256,bytes32,uint32)",[new o("sampleHash",a.i),new o("coverArtHash",a.i),new o("guildId",a.g)],new o("discogsId",a.n)),g=new s("NewNotesAggregation(bytes32,bytes32,bytes32,uint32,uint32,bytes32)",[new o("sampleHash",a.i),new o("noteA",a.k),new o("noteB",a.k)],new o("startTime",a.g),new o("endTime",a.g),new o("remainingNotes",a.j)),b=new s("SampleFavorited(address,bytes32)",[new o("user",a.a),new o("sampleHash",a.i)]),y=new s("SampleUnfavorited(address,bytes32)",[new o("user",a.a),new o("sampleHash",a.i)]),k=new s("SequenceEdited(address,bytes32,bytes32,bytes32,string)",[new o("user",a.a),new o("previousSequence",a.i),new o("newSequence",a.i)],new o("diff",a.i),new o("title",a.m)),E=new s("SequenceEdited(address,bytes32,bytes32,string)",[new o("user",a.a),new o("previousSequence",a.i),new o("newSequence",a.i)],new o("title",a.m)),S=new s("PresetTagged(address,bytes32,bytes32,uint32)",[new o("contentHash",a.i),new o("tag",a.b),new o("guildId",a.g)],new o("user",a.a)),O=new s("NewGuild(address,uint32,string)",[new o("user",a.a),new o("guildId",a.g)],new o("name",a.m)),w=new s("NewGuildMemberRequest(address,address,uint32)",[new o("requester",a.a),new o("newMember",a.a),new o("guildId",a.g)]),C=new s("NewGuildMemberRequestAccepted(address,uint32)",[new o("newMember",a.a),new o("guildId",a.g)]),P=new s("NewGuildMemberRequestRejected(address,uint32)",[new o("newMember",a.a),new o("guildId",a.g)]),T=new s("GuildKeyEncrypted(address,uint32,bytes32)",[new o("user",a.a),new o("guildId",a.g),new o("ipfsHash",a.i)]),j=new s("NewEncryptedContent(address,bytes32,bytes32,int8,bytes32,bytes32[9],bytes32[6])",[new o("user",a.a),new o("newContent",a.i),new o("contentType",a.h)],new o("previousContent",a.i),new o("encryptedName",a.d),new o("encryptedContentKey",Object(a.c)(9),9),new o("publicKey",Object(a.c)(6),6)),x=new s("EncryptedContentShared(address,address,bytes32,bytes32[9],bytes32[6])",[new o("sharedWith",a.a),new o("creator",a.a),new o("contentHash",a.i)],new o("encryptedContentKey",Object(a.c)(9),9),new o("publicKey",Object(a.c)(6),6)),N=new s("NewPublicKey(address,bytes32[6])",[new o("user",a.a)],new o("publicKey",Object(a.c)(6),6)),q=new s("NewPreset(address,bytes32,uint32,bytes32,bytes32[9],bytes32[6])",[new o("user",a.a),new o("contentHash",a.i),new o("guildId",a.g)],new o("encryptedName",a.d),new o("encryptedContentKey",Object(a.c)(9),9),new o("publicKey",Object(a.c)(6),6)),M=new s("PresetSample(bytes32,bytes32,uint32)",[new o("contentHash",a.i),new o("sampleHash",a.i),new o("guildId",a.g)]),D=new s("PresetInstrumentType(bytes32,bytes32,uint32)",[new o("contentHash",a.i),new o("instrumentType",a.e),new o("guildId",a.g)]),A=new s("NewMonthlyIndex(bytes32,uint32,uint64)",[new o("month",a.n),new o("year",a.n)],new o("hash",a.i)),R=new s("New2DMapping(bytes32)",[new o("ipfsHash",a.i)]),I=new s("PublicMessageSent(address,address,bytes32,bytes32)",[new o("fromUser",a.a),new o("toUser",a.a),new o("referenceHash",a.i)],new o("messageHash",a.i)),L=new s("SampleCopyStrike(address,bytes32,bytes32)",[new o("user",a.a),new o("sampleHash",a.i),new o("referenceHash",a.i)]),F=new s("SampleTakenDown(bytes32)",[new o("sampleHash",a.i)]),V=new s("FoldersUpdated(address,bytes32)",[new o("user",a.a),new o("foldersHash",a.i)]),B=new s("NewIndex(uint32,bytes32)",[new o("guildId",a.g)],new o("indexHash",a.i)),U=new s("NewGuildSequence(address,bytes32,uint32,bytes32,bytes32,bytes32[9],bytes32[6])",[new o("user",a.a),new o("contentHash",a.i),new o("guildId",a.g)],new o("previousHash",a.i),new o("encryptedName",a.d),new o("encryptedContentKey",Object(a.c)(9),9),new o("publicKey",Object(a.c)(6),6)),H=new s("NewGuildClassification(uint32,bytes32)",[new o("guildId",a.g),new o("contentHash",a.i)]),J=new s("Transfer(address,address,uint256)",[new o("fromUser",a.a),new o("toUser",a.a)],new o("amount",a.g)),G=new s("SequenceTagged(bytes32,bytes32,uint32)",[new o("ipfsHash",a.i),new o("tag",a.b),new o("guildId",a.g)]),z=new s("SequenceFavorited(bytes32,address,uint32)",[new o("ipfsHash",a.i),new o("user",a.a),new o("guildId",a.g)]),_=new s("SequenceStarred(bytes32,address,uint32)",[new o("ipfsHash",a.i),new o("user",a.a),new o("guildId",a.g)]),W=new s("SequenceUnfavorited(bytes32,address,uint32)",[new o("ipfsHash",a.i),new o("user",a.a),new o("guildId",a.g)]),K=new s("SequenceUnstarred(bytes32,address,uint32)",[new o("ipfsHash",a.i),new o("user",a.a),new o("guildId",a.g)]),Y=new s("NewDataType(bytes32,string)",[new o("dataType",a.b)],new o("description",a.m)),Q=new s("NewLinkType(bytes32,string)",[new o("linkType",a.b)],new o("description",a.m)),X=(new s("NewAnnotationType(bytes32,string)",[new o("annotationType",a.b)],new o("description",a.m)),new s("NewLink(bytes32,bytes32,bytes32,address)",[new o("linkType",a.b),new o("fromData",a.i),new o("toData",a.i)],new o("address",a.a)))},331:function(e,t,n){},332:function(e,t,n){},333:function(e,t,n){},338:function(e,t,n){"use strict";n.d(t,"a",function(){return l});var a=n(3),r=n.n(a),s=n(11),i=n(278),o=(n(47),n(43)),c=n.n(o),u=(n(150),n(66),n(45),n(35),"undefined"!==typeof window.web3?new c.a(window.web3.currentProvider):new c.a(new c.a.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),null);function l(e){return new Promise(function(){var t=Object(s.a)(r.a.mark(function t(n,a){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null!==u){t.next=4;break}return u=new i.OnsetsAndFrames("https://storage.googleapis.com/magentadata/js/checkpoints/transcription/onsets_frames_uni"),t.next=4,u.initialize();case 4:u.transcribeFromAudioBuffer(e,16).then(function(e){n(e)});case 5:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},339:function(e,t,n){"use strict";var a=n(3),r=n.n(a),s=n(11),i=n(1),o=n(2),c=function(){function e(t,n){Object(i.a)(this,e),this.currentPromise=t,this.nextPromise=n}return Object(o.a)(e,[{key:"getCurrent",value:function(){var e=Object(s.a)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.currentPromise();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getNext",value:function(){var e=Object(s.a)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.nextPromise;case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=c},340:function(e,t,n){"use strict";var a=n(17),r=n(1),s=n(2),i=n(6),o=n(4),c=n(7),u=n(51),l=n.n(u),p=n(35),h=n(16),d=function(e){function t(e,n,a,s,c){var u;return Object(r.a)(this,t),(u=Object(i.a)(this,Object(o.a)(t).call(this))).decentralized=e,u.ipfsHash=a,u.sequenceId=n,u.data=s,u.title=c,u}return Object(c.a)(t,e),Object(s.a)(t,[{key:"getName",value:function(){return this.title}},{key:"getId",value:function(){return this.ipfsHash}},{key:"save",value:function(e,t,n,a,r){var s=this;return new Promise(function(i,o){p.a.addJson(t).then(function(t){i({ipfsHash:t}),s.saveToLocalStorage(e,t),r&&h.a.saveNewSequence(n,t,e,a)})})}},{key:"saveToLocalStorage",value:function(e,t){var n=window.localStorage,r=n.getItem("sequences");r?(r=JSON.parse(r),r=[{title:e,hash:t}].concat(Object(a.a)(r))):r=[{title:e,hash:t}],n.setItem("sequences",JSON.stringify(r))}},{key:"loadTitle",value:function(){var e=this;return new Promise(function(t,n){console.log("loading title for ipfshash = "+e.ipfsHash),h.a.getSequence(e.ipfsHash).then(function(e){return t(e.title)})})}},{key:"load",value:function(){var e=this;return new Promise(function(t,n){e.data?t(JSON.parse(e.data)):e.decentralized&&void 0!==e.ipfsHash?p.a.getJson(e.ipfsHash).then(function(e){return t(e)}):l.a.get("/sequence/"+e.sequenceId).then(function(e){return t(e.data.data)})})}}]),t}(n(282).a);t.a=d},341:function(e,t,n){"use strict";n.d(t,"a",function(){return c}),n.d(t,"b",function(){return u});var a=n(3),r=n.n(a),s=n(11),i=n(47),o=2e3;function c(e){var t=[];if("subSequences"in e)for(var n in e.subSequences){var a=e.subSequences[n];for(var r in a.tracksData){var s=a.tracksData[r];t=t.concat(Object.keys(s.samplers))}}else for(var i in e.tracksData){var o=e.tracksData[i];t=t.concat(Object.keys(o.samplers))}return Array.from(new Set(t))}function u(e,t,n){return l.apply(this,arguments)}function l(){return(l=Object(s.a)(r.a.mark(function e(t,n,a){var s,i,o,c;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s={},e.t0=r.a.keys(t);case 2:if((e.t1=e.t0()).done){e.next=19;break}return i=e.t1.value,o=t[i],e.prev=5,e.next=8,d(n,o);case 8:return c=e.sent,s[o]=c,e.next=12,p(a/2);case 12:e.next=17;break;case 14:e.prev=14,e.t2=e.catch(5),console.log("couldnt get sampleId = "+o);case 17:e.next=2;break;case 19:return console.log("finished getting samples"),e.abrupt("return",s);case 21:case"end":return e.stop()}},e,null,[[5,14]])}))).apply(this,arguments)}function p(e){return h.apply(this,arguments)}function h(){return(h=Object(s.a)(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(r.a.mark(function e(n,a){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:setTimeout(function(){n()},t);case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function d(e,t){return new Promise(function(){var n=Object(s.a)(r.a.mark(function n(a,s){var c;return r.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return setTimeout(function(){s()},o),c=new i.a(t,e),n.prev=2,n.next=5,c.load();case 5:a(c),n.next=12;break;case 8:n.prev=8,n.t0=n.catch(2),console.log("rejection from lod"),s();case 12:case"end":return n.stop()}},n,null,[[2,8]])}));return function(e,t){return n.apply(this,arguments)}}())}},35:function(e,t,n){"use strict";(function(e){var a=n(3),r=n.n(a),s=n(11),i=n(1),o=n(2),c=n(443),u=n.n(c),l=n(378),p=new XMLHttpRequest,h="/ip4/3.17.26.249/tcp/4001/ipfs/QmeQRpfSrYcAaqkhNoArDyTUwyYiru2gJp4WY1WegQGjtR",d=[85,110,105,118,101,114,115,97,108,32,83,101,113,101,117,110,99,101,115],f=new(function(){function t(){Object(i.a)(this,t),this.controllers=new Set,"http:"===window.location.protocol?this.centralIpfs=u()("www.universalsequences.com","5001",{protocol:"http"}):this.centralIpfs=u()("www.universalsequences.com","5002",{protocol:"https"}),this.ipfs=this.centralIpfs;var e=this;this.connectedLocally=!1,this.finishedTestingLocalConnection=!1,p.onreadystatechange=function(){4==p.readyState&&200==p.status&&(e.ipfs=u()("localhost","5001",{protocol:"http"}),e.connectToCentral(),e.connectedLocally=!0,e.finishedTestingLocalConnection=!0)},p.open("GET","http://localhost:5001/api/v0/swarm/peers",!0),p.timeout=4e3,p.ontimeout=function(){console.log("timed out connecting to local ipfs daemon")},p.send("")}return Object(o.a)(t,[{key:"restart",value:function(){}},{key:"getIPFSPrefix",value:function(){return this.connectedLocally?"http://localhost:5001":"http:"===window.location.protocol?"http://www.universalsequences.com:5001":"https:"===window.location.protocol?"https://www.universalsequences.com:5002":void 0}},{key:"getHashUrl",value:function(e){return this.connectedLocally?"http://localhost:8080/ipfs/"+e:"http://zequencer.io:8080/ipfs/"+e}},{key:"getPinnedHashes",value:function(){var e=Object(s.a)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ipfs.refs.local();case 2:e.sent;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),Object(o.a)(t,[{key:"findProvs",value:function(e){var t=this;return new Promise(function(n,a){t.ipfs.dht.findprovs(e,{maxNumProviders:1},function(e,t){n(t)})})}},{key:"connectToCentral",value:function(){try{this.ipfs.swarm.connect(h,function(e,t){}).catch(function(e){return console.log("error")})}catch(e){console.log("error connecting to ipfs")}}},{key:"keepSwarmConnectionAlive",value:function(){var e=this;try{this.ipfs.swarm.connect(h,function(e,t){}).catch(function(e){return console.log("error")})}catch(t){console.log("error connecting to ipfs")}setInterval(function(){if(window.sequencerEngine&&window.sequencerEngine.getSequenceId){var n=window.sequencerEngine.getSequenceId();if(window.sequencerEngine.store.getState().sequencer.isPlaying[n])return}try{e.ipfs.swarm.connect(h,function(e,t){}).catch(function(e){return console.log("error")})}catch(t){console.log("error connecting to ipfs")}},6e4)}},{key:"isConnectedLocally",value:function(){return this.connectedLocally}},{key:"addArrayBuffer",value:function(e,t){return this.addHelper(e,t)}},{key:"addArrayBufferAndSaveToDB",value:function(e,t){return this.addBlobAndSaveToDB(new Blob([new Uint8Array(e)]),t)}},{key:"addHelper",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var n=this;return new Promise(function(a,r){n.ipfs.add({path:"hello",content:new e(t)},function(e,t){var n=t[0].hash;e?r(e):a(n)})})}},{key:"addJson",value:function(t){var n=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(r,s){var i=a?n.centralIpfs:n.ipfs;i.add({path:"sequence",content:e.from(JSON.stringify(t),"utf8")},function(e,t){if(e)s(e);else{var a=t[0].hash;n.connectedLocally&&i.pin.add(a),r(a)}}),a||n.addJson(t,!0)})}},{key:"getJson",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.restart();var a=this.finishedTestingLocalConnection?0:1e3;return new Promise(function(r,s){setTimeout(function(){(n?t.centralIpfs:t.ipfs).cat(e,function(e,t){if(e)throw e;r(JSON.parse(t.toString("utf8")))})},a)})}},{key:"addBytesArray",value:function(){var e=Object(s.a)(r.a.mark(function e(t){var n,a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new Uint8Array(t.length+d.length)).set(t,0),n.set(d,t.length),e.next=5,this.addHelper(n.buffer);case 5:return a=e.sent,this.ipfs.pin.add(a),e.next=9,this.getSound(a);case 9:return e.sent,e.abrupt("return",a);case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addBlob",value:function(e){var t=this;return this.restart(),new Promise(function(n,a){var r,s=new FileReader,i=t;s.onload=function(){var e=this;r=this.result,i.addHelper(r).then(function(t){e.connectedLocally&&i.ipfs.pin.add(t),i.centralIpfs.pin.add(t),n(t)}).catch(function(e){return a(e)})},s.readAsArrayBuffer(e)})}},{key:"addBlobAndSaveToDB",value:function(e,t){}},{key:"converttoarraybuffer",value:function(e){return new Promise(function(t,n){var a=new a;a.onload=function(){t(this.result)},a.readasarraybuffer(e)})}},{key:"readAllChunks",value:function(e){var t=e.getReader(),n=[];return function e(){return t.read().then(function(t){var a=t.value;return t.done?n:(n.push(a),e())})}()}},{key:"getSound",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e4;return new Promise(function(a,i){var o=new AbortController;t.controllers.add(o);var c=o.signal;setTimeout(function(){o.abort(),t.controllers.delete(o),i()},n),fetch(t.getIPFSPrefix()+"/api/v0/get?arg="+e+"&stream-channels=true",{signal:c}).then(function(){var e=Object(s.a)(r.a.mark(function e(n){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.readAllChunks(n.body).then(function(e){var n=t.mergeArrays(e);a(n)}).catch(function(e){return console.log("error reading chunks")});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){console.log("aborted")})})}},{key:"arrayToBuffer",value:function(e){var t=new ArrayBuffer(e.length);return e.map(function(e,n){t[n]=e}),t}},{key:"cancel",value:function(){console.log("cancelling = ",this.controllers),Array.from(this.controllers).forEach(function(e){return e.abort()})}},{key:"mergeArrays",value:function(e){var t=0;for(var n in e)t+=e[n].length;var a=new Uint8Array(t-512),r=0;for(var s in e)0===r?(a.set(e[s].subarray(512),r),r+=e[s].length-512):(a.set(e[s],r),r+=e[s].length);var i=a,o=this.findEnd(i,d);return-1!==o?i.slice(0,o):a.slice(0,a.length-1024)}},{key:"findEnd",value:function(e,t){for(var n=e.length-1600,a=e.slice(n).values(),r=0,s=n;s<e.length;s++){if(a.next().value===t[r]){if(0==r&&(n=s),++r===t.length-1)return n}else r=0,n=s}return-1}},{key:"getAudioBuffer",value:function(e,t){var n=this;return this.restart(),new Promise(function(a,r){n.getSound(e).then(function(e){return t.decodeAudioData(l(e),function(e){a(e)},function(e,t,n){n&&r(n)})}).catch(function(e){r(e)})})}}]),t}());t.a=f}).call(this,n(15).Buffer)},37:function(e,t,n){"use strict";var a=n(3),r=n.n(a),s=n(11),i=n(1),o=n(2),c=n(285),u=n.n(c),l=n(5),p=new(function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,[{key:"setEthereum",value:function(e){this.ethereum=e}},{key:"setStore",value:function(e){this.store=e}},{key:"isMetamaskInstalled",value:function(){return"undefined"!==typeof window.web3}},{key:"isLoggedIn",value:function(){return this.isMetamaskInstalled()||void 0!==this.store.getState().sequencer.userToken}},{key:"getToken",value:function(){var e=this.store.getState().sequencer.userToken;return e?e.token:void 0}},{key:"checkLogin",value:function(){var e=this,t=u.a.load("token");""!==t&&void 0!==t&&fetch("/checkToken/"+t,{method:"POST",headers:{Accept:"text/html","Content-Type":"text/html"}}).then(function(){var t=Object(s.a)(r.a.mark(function t(n){var a,s;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(401!==n.status){t.next=3;break}t.next=8;break;case 3:return t.next=5,n.text();case 5:a=t.sent,s=u.a.load("token"),e.store.dispatch(Object(l.ue)(a,s));case 8:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}},{key:"logout",value:function(){this.store.dispatch(Object(l.ue)(void 0)),u.a.remove("token",{path:"/"})}},{key:"signUp",value:function(e,t){var n=this;fetch("/signUp/"+e+"/"+t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(a){var r=u.a.load("token");n.store.dispatch(Object(l.ue)(e,r)),n.ethereum.crypto.password=t})}},{key:"login",value:function(e,t){var n=this;return new Promise(function(a,r){fetch("/login/"+e+"/"+t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(r){if(401===r.status)a(!1);else{var s=u.a.load("token");n.store.dispatch(Object(l.ue)(e,s)),n.ethereum.crypto.password=t,n.ethereum.guilds.onUserChanged(),n.account=void 0,a(!0)}})})}},{key:"getAccount",value:function(){var e=Object(s.a)(r.a.mark(function e(){var t=this;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.installation){e.next=2;break}return e.abrupt("return",void 0);case 2:if(!this.isMetamaskInstalled()){e.next=6;break}return e.abrupt("return",this.ethereum.getUser());case 6:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(r.a.mark(function e(n,a){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.account){e.next=3;break}return n(t.account),e.abrupt("return");case 3:fetch("/getAccount/",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include"}).then(function(){var e=Object(s.a)(r.a.mark(function e(a){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(401!==a.status&&404!==a.status){e.next=4;break}n(void 0),e.next=8;break;case 4:return e.next=6,a.text();case 6:t.account=e.sent,n(t.account);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUserName",value:function(){var e=Object(s.a)(r.a.mark(function e(){var t,n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isMetamaskInstalled()){e.next=10;break}return e.next=3,this.ethereum.getUser();case 3:return t=e.sent,e.next=6,this.ethereum.users.getUserName(t);case 6:return n=e.sent,e.abrupt("return",n);case 10:if(!this.isLoggedIn()){e.next=14;break}return e.abrupt("return",this.store.getState().sequencer.userToken.userName);case 14:return console.log("is not logged in..."),e.abrupt("return","Not Logged In");case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}());t.a=p},38:function(e,t,n){"use strict";var a=n(1),r=n(2),s=["#00e1f5","#ff1797","#d7003a","#ff4040","#ff853c","#ff6022","#6c2efc","#52ff89","#b7ffb3","#91ffd7","#40adff","#4440ff","#5e09ff"],i={},o=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,[{key:"getColor",value:function(e){return s[e%s.length]}},{key:"getColorForHash",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:170,n=this.intToRGB(this.hashCode(e)),a=this.getBrightness(n);return a<t?this.brighten(n,170/a):n}},{key:"hashCode",value:function(e){for(var t=0,n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);return t}},{key:"intToRGB",value:function(e){var t=(16777215&e).toString(16).toUpperCase();return"#"+"00000".substring(0,6-t.length)+t}},{key:"brighten",value:function(e,t){var n=i[e+"."+t];if(n)return n;var a=Math.min(255,Math.floor(parseInt(e.slice(1,3),16)*t)),r=Math.min(255,Math.floor(parseInt(e.slice(3,5),16)*t)),s=Math.min(255,Math.floor(parseInt(e.slice(5),16)*t));a=a.toString(16),r=r.toString(16),s=s.toString(16),1===a.length&&(a="0"+a),1===r.length&&(r="0"+r),1===s.length&&(s="0"+s);var o="#"+a+r+s;return i[e+"."+t]=o,o}},{key:"getBrightness",value:function(e){var t=this.getRGB(e);return.299*t.r+.587*t.g+.114*t.b}},{key:"getRGB",value:function(e){return{r:Math.floor(parseInt(e.slice(1,3),16)),g:Math.floor(parseInt(e.slice(3,5),16)),b:Math.floor(parseInt(e.slice(5),16))}}}]),e}();t.a=o},40:function(e,t,n){"use strict";var a=n(43),r=n.n(a),s=n(425),i=n(195),o=n(426),c=n(427),u=n(428),l=n(429),p=n(430),h=n(431),d=n(432),f=n(1),m=n(2),v=function(){function e(){Object(f.a)(this,e),this.abi=[{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SequenceFavorited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SequenceStarred",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"tag",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SequenceTagged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SequenceUnfavorited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"SequenceUnstarred",type:"event"},{constant:!1,inputs:[{internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"favoriteSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"starSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{internalType:"bytes32",name:"tag",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"tagSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"unfavoriteSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"ipfsHash",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"unstarSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"}],this.contractAddress="0x03172e863dbF7EEb3994AF5a6608c470eB6E79fC"}return Object(m.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}(),g=n(433),b=n(434);n.d(t,"e",function(){return k}),n.d(t,"j",function(){return E}),n.d(t,"f",function(){return S}),n.d(t,"d",function(){return O}),n.d(t,"c",function(){return w}),n.d(t,"a",function(){return C}),n.d(t,"b",function(){return P}),n.d(t,"g",function(){return T}),n.d(t,"i",function(){return j}),n.d(t,"h",function(){return x}),n.d(t,"k",function(){return N});var y="undefined"!==typeof window.web3?new r.a(window.web3.currentProvider):new r.a(new r.a.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),k="GUILD_SAMPLES",E="TOKENIZED_SEQUENCES",S="GUILD_SEQUENCES",O="GUILD_PRESETS",w="GUILDS",C="ENCRYPTION",P="FOLDERS",T="MESSAGING",j="SEQUENCE_METADATA",x="RESAMPLE",N={USERS:(new s.a).getContract(y),GUILDS:(new l.a).getContract(y),GUILD_SAMPLES:(new i.a).getContract(y),TOKENIZED_SEQUENCES:(new o.a).getContract(y),GUILD_SEQUENCES:(new c.a).getContract(y),GUILD_PRESETS:(new u.a).getContract(y),ENCRYPTION:(new p.a).getContract(y),FOLDERS:(new h.a).getContract(y),MESSAGING:(new d.a).getContract(y),SEQUENCE_METADATA:(new v).getContract(y),RESAMPLE:(new g.a).getContract(y),XANADU:(new b.a).getContract(y)}},41:function(e,t,n){"use strict";var a=n(1),r=n(2),s=n(6),i=n(4),o=n(20),c=n(7),u=n(93),l=(n(31),function(e){function t(e){return Object(a.a)(this,t),Object(s.a)(this,Object(i.a)(t).call(this,e))}return Object(c.a)(t,e),Object(r.a)(t,[{key:"executeQuery",value:function(){var e=this;if(!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:!window.installation))return Object(o.a)(Object(i.a)(t.prototype),"executeQuery",this).call(this);this.getJson(),(new Date).getTime();return new Promise(function(t,n){fetch("/search/",{method:"POST",body:JSON.stringify(e.getJson()),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){(new Date).getTime();t(e)}).catch(function(e){console.log(e)})})}}]),t}(u.a));t.a=l},424:function(e,t,n){"use strict";var a=n(17),r=n(1),s=n(2),i=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(r.a)(this,e),this.name=t,this.parent=n,this.subFolders=[],this.items=[],this.depth=a}return Object(s.a)(e,[{key:"isDynamic",value:function(){return!1}},{key:"isRoot",value:function(){return void 0===this.parent}},{key:"addItem",value:function(e){e.parent=this,this.items.push(e)}},{key:"deleteItem",value:function(e){var t=this.items.indexOf(e);if(t>-1)return e.parent=void 0,this.items.splice(t,1),e}},{key:"deleteFolder",value:function(e){var t=this.subFolders.indexOf(e);if(t>-1)return this.subFolders.splice(t,1),e}},{key:"delete",value:function(){void 0!==this.parent&&this.parent.deleteFolder(this)}},{key:"newFolder",value:function(t){var n=new e(t,this,this.depth+1);return this.subFolders.push(n),n}},{key:"addFolder",value:function(e){e.depth=this.depth+1,this.subFolders.push(e)}},{key:"getJson",value:function(){return{name:this.name,subFolders:this.subFolders.map(function(e){return e.getJson()}),items:this.items.map(function(e){return e.getJson()})}}},{key:"fromJson",value:function(t,n){var a=this;return this.name=t.name,this.items=t.items.map(function(e){return n(e)}),this.items.forEach(function(e){return e.parent=a}),this.subFolders=t.subFolders.map(function(t){return new e(void 0,a,a.depth+1).fromJson(t,n)}),this}},{key:"getAllItems",value:function(){var e=Object(a.a)(this.items);for(var t in this.subFolders)e=e.concat(this.subFolders[t].getAllItems());return e}}]),e}();t.a=i},425:function(e,t,n){"use strict";var a=n(1),r=n(2),s=function(){function e(){Object(a.a)(this,e),this.abi=[{constant:!0,inputs:[{name:"user",type:"address"}],name:"getNumberOfFollowers",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"userB",type:"address"}],name:"unfollow",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"name",type:"string"}],name:"isUserNameAvailable",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"user",type:"address"}],name:"getUserProfilePicture",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"profile",type:"bytes32"}],name:"setProfileHash",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"userB",type:"address"}],name:"follow",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"user",type:"address"},{name:"index",type:"uint256"}],name:"getFollower",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"profilePicture",type:"bytes32"}],name:"setProfilePicture",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"name",type:"string"}],name:"getUserAddressFromName",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"user",type:"address"}],name:"getUserProfile",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"name",type:"string"}],name:"setName",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"user",type:"address"}],name:"getUserName",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"userAddress",type:"address"},{indexed:!0,name:"ipfsAddress",type:"bytes32"}],name:"ProfileIpfsHashUpdated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"userAddress",type:"address"},{indexed:!0,name:"ipfsAddress",type:"bytes32"}],name:"ProfilePictureIpfsHashUpdated",type:"event"}],this.contractAddress="0xd0fb239ceb867bdcf68ae8331e911a9d4ec80632"}return Object(r.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=s},426:function(e,t,n){"use strict";var a=n(1),r=n(2),s=function(){function e(){Object(a.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"delegate",type:"address"},{name:"numTokens",type:"uint256"}],name:"approve",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"contentHash",type:"bytes32"},{name:"user",type:"address"}],name:"approveContentOwner",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"numTokens",type:"uint256"}],name:"buyTokens",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{name:"contentHash",type:"bytes32"}],name:"claimContentBalance",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"previousSequence",type:"bytes32"},{name:"newSequence",type:"bytes32"},{name:"title",type:"string"},{name:"samples",type:"bytes32[]"}],name:"editSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"newPrice",type:"uint256"}],name:"setPrice",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"receiver",type:"address"},{name:"numTokens",type:"uint256"}],name:"transfer",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"user",type:"address"},{name:"buyer",type:"address"},{name:"numTokens",type:"uint256"}],name:"transferFrom",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{name:"total",type:"uint256"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"tokenOwner",type:"address"},{indexed:!0,name:"spender",type:"address"},{indexed:!1,name:"tokens",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"tokens",type:"uint256"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!0,name:"previousSequence",type:"bytes32"},{indexed:!0,name:"newSequence",type:"bytes32"},{indexed:!1,name:"title",type:"string"}],name:"SequenceEdited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"sequenceHash",type:"bytes32"},{indexed:!0,name:"sampleHash",type:"bytes32"}],name:"SampleInSequence",type:"event"},{constant:!0,inputs:[{name:"user",type:"address"},{name:"delegate",type:"address"}],name:"allowance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"tokenOwner",type:"address"}],name:"balanceOf",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"contentHash",type:"bytes32"}],name:"getContentBalance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"getPrice",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"}],this.contractAddress="0x606f760c228cd5f11c6f79de64d3b299b11f1ed1"}return Object(r.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=s},427:function(e,t,n){"use strict";var a=n(1),r=n(2),s=function(){function e(){Object(a.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"bytes32",name:"previousHash",type:"bytes32"},{internalType:"bytes32",name:"newHash",type:"bytes32"},{internalType:"bytes32",name:"encryptedTitle",type:"bytes32"},{internalType:"bytes32[9]",name:"encryptedContentKey",type:"bytes32[9]"},{internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"editSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"guildsAddress",type:"address"},{internalType:"address",name:"encryptionAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"sequenceHash",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"},{indexed:!1,internalType:"bytes32",name:"previousHash",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"encryptedTitle",type:"bytes32"},{indexed:!1,internalType:"bytes32[9]",name:"encryptedContentKey",type:"bytes32[9]"},{indexed:!1,internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"NewGuildSequence",type:"event"}],this.contractAddress="0x15Da2ef01D9F881f694Be962Db28b76110fa195C"}return Object(r.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=s},428:function(e,t,n){"use strict";var a=n(1),r=n(2),s=function(){function e(){Object(a.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"}],name:"favoritePreset",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"},{internalType:"bytes32",name:"title",type:"bytes32"},{internalType:"bytes32",name:"sampleHash",type:"bytes32"},{internalType:"bytes32",name:"instrumentType",type:"bytes32"},{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"bytes32[9]",name:"encryptedContentKey",type:"bytes32[9]"},{internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"newPreset",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"contentHash",type:"bytes32"},{internalType:"bytes32[4]",name:"tags",type:"bytes32[4]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"tagPreset",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"guildsContractAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"},{indexed:!1,internalType:"bytes32",name:"title",type:"bytes32"},{indexed:!1,internalType:"bytes32[9]",name:"encryptedContentKey",type:"bytes32[9]"},{indexed:!1,internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"NewPreset",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"sampleHash",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"PresetSample",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"tag",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"PresetTagged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"}],name:"PresetFavorited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"contentHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"instrumentType",type:"bytes32"},{indexed:!0,internalType:"uint32",name:"guildId",type:"uint32"}],name:"PresetInstrumentType",type:"event"}],this.contractAddress="0x45aC8aCbEba84071D4e549d4dCd273E01E5a8daF"}return Object(r.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=s},429:function(e,t,n){"use strict";var a=n(1),r=n(2),s=function(){function e(){Object(a.a)(this,e),this.abi=[{constant:!0,inputs:[{internalType:"uint32",name:"i",type:"uint32"}],name:"getGuildForSelf",outputs:[{internalType:"uint32",name:"",type:"uint32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"user",type:"address"}],name:"getTotalGuildsForUser",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"bytes32[6]",name:"guildPublicKey",type:"bytes32[6]"},{internalType:"string",name:"name",type:"string"},{internalType:"bytes32",name:"encryptedKeyIpfsHash",type:"bytes32"},{internalType:"bytes32[9]",name:"contentKey",type:"bytes32[9]"},{internalType:"bytes32[6]",name:"userPublicKey",type:"bytes32[6]"}],name:"newGuild",outputs:[{internalType:"uint32",name:"",type:"uint32"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"}],name:"rejectRequestToAddToGuild",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"setPublicKeyForGuild",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"address",name:"member",type:"address"}],name:"isGuildMember",outputs:[{internalType:"bool",name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"address",name:"potentialMember",type:"address"},{internalType:"bytes32",name:"encryptedKeyIpfsHash",type:"bytes32"},{internalType:"bytes32[9]",name:"contentKey",type:"bytes32[9]"},{internalType:"bytes32[6]",name:"publicKey",type:"bytes32[6]"}],name:"requestToAddMember",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"getTotalGuildsForSelf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"}],name:"acceptRequestToAddToGuild",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"user",type:"address"},{internalType:"uint32",name:"i",type:"uint32"}],name:"getGuildForUser",outputs:[{internalType:"uint32",name:"",type:"uint32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"}],name:"getTotalGuildUsers",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"}],name:"getGuildName",outputs:[{internalType:"string",name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"uint32",name:"guildId",type:"uint32"},{internalType:"string",name:"name",type:"string"}],name:"setNameForGuild",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"uint32",name:"guild",type:"uint32"},{internalType:"uint32",name:"i",type:"uint32"}],name:"getUserFromGuild",outputs:[{internalType:"address",name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"encryptionContractAddress",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"},{indexed:!1,internalType:"string",name:"name",type:"string"}],name:"NewGuild",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"}],name:"NewGuildMember",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"}],name:"NewGuildMemberRequest",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"}],name:"NewGuildMemberRequestAccepted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"}],name:"NewGuildMemberRequestRejected",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"}],name:"GuildMemberLeft",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint32",name:"",type:"uint32"},{indexed:!0,internalType:"bytes32[6]",name:"",type:"bytes32[6]"}],name:"GuildPublicKeyChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"",type:"address"},{indexed:!0,internalType:"uint32",name:"",type:"uint32"},{indexed:!0,internalType:"bytes32",name:"",type:"bytes32"}],name:"GuildKeyEncrypted",type:"event"}],this.contractAddress="0x70548646c2A475ebfE46F19637651e76a38324d4"}return Object(r.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=s},430:function(e,t,n){"use strict";var a=n(1),r=n(2),s=function(){function e(){Object(a.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"sharedWith",type:"address"},{name:"contentHash",type:"bytes32"},{name:"encryptedContentKey",type:"bytes32[9]"},{name:"publicKey",type:"bytes32[6]"}],name:"shareEncryptedContentWith",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"publicKey",type:"bytes32[6]"}],name:"setPublicKey",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"previousContentHash",type:"bytes32"},{name:"newContentHash",type:"bytes32"},{name:"encryptedName",type:"bytes32"},{name:"contentType",type:"int8"},{name:"encryptedContentKey",type:"bytes32[9]"},{name:"publicKey",type:"bytes32[6]"}],name:"newEncryptedContent",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"hasPublicKey",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!1,name:"publicKey",type:"bytes32[6]"}],name:"NewPublicKey",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!1,name:"previousContent",type:"bytes32"},{indexed:!0,name:"newContent",type:"bytes32"},{indexed:!0,name:"contentType",type:"int8"},{indexed:!1,name:"encryptedName",type:"bytes32"},{indexed:!1,name:"contentKey",type:"bytes32[9]"},{indexed:!1,name:"publicKey",type:"bytes32[6]"}],name:"NewEncryptedContent",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"sharedWith",type:"address"},{indexed:!0,name:"creator",type:"address"},{indexed:!0,name:"contentHash",type:"bytes32"},{indexed:!1,name:"contentKey",type:"bytes32[9]"},{indexed:!1,name:"publicKey",type:"bytes32[6]"}],name:"EncryptedContentShared",type:"event"}],this.contractAddress="0xbe559f9f38c5f36186b364972cb8b4ebd7174043"}return Object(r.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=s},431:function(e,t,n){"use strict";var a=n(1),r=n(2),s=function(){function e(){Object(a.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"bytes32",name:"foldersHash",type:"bytes32"}],name:"foldersUpdated",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"foldersHash",type:"bytes32"}],name:"FoldersUpdated",type:"event"}],this.contractAddress="0x20039b89449aC0bAB5B4114Bf66aCff1b3043988"}return Object(r.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=s},432:function(e,t,n){"use strict";var a=n(1),r=n(2),s=function(){function e(){Object(a.a)(this,e),this.abi=[{constant:!1,inputs:[{internalType:"address",name:"toUser",type:"address"},{internalType:"bytes32",name:"referenceHash",type:"bytes32"},{internalType:"bytes32",name:"messageContentHash",type:"bytes32"}],name:"sendPublicMessage",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"messageContentHash",type:"bytes32"}],name:"deleteMessage",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"fromUser",type:"address"},{indexed:!0,internalType:"address",name:"toUser",type:"address"},{indexed:!0,internalType:"bytes32",name:"referencedHash",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"messageContentHash",type:"bytes32"}],name:"PublicMessageSent",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"messageContentHash",type:"bytes32"}],name:"PublicMessageDeleted",type:"event"}],this.contractAddress="0xb407EFd2254583C8BF99c578c7b891313AC1933E"}return Object(r.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=s},433:function(e,t,n){"use strict";var a=n(1),r=n(2),s=function(){function e(){Object(a.a)(this,e),this.abi=[{inputs:[{internalType:"address",name:"samplesAddress",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!0,internalType:"bytes32",name:"resampleHash",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"sampleUsed",type:"bytes32"}],name:"NewResample",type:"event"},{inputs:[{internalType:"bytes32",name:"resampleHash",type:"bytes32"},{internalType:"string",name:"title",type:"string"},{internalType:"bytes32[4]",name:"tags",type:"bytes32[4]"},{internalType:"bytes32[]",name:"samplesUsedHashes",type:"bytes32[]"},{internalType:"uint32",name:"guildId",type:"uint32"}],name:"newResample",outputs:[],stateMutability:"nonpayable",type:"function"}],this.contractAddress="0xD914528749Fcfc2945148551d0F61AfDFe429962"}return Object(r.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=s},434:function(e,t,n){"use strict";var a=n(1),r=n(2),s=function(){function e(){Object(a.a)(this,e),this.abi=[{inputs:[{internalType:"bytes32",name:"annotationType",type:"bytes32"},{internalType:"bytes32",name:"data",type:"bytes32"},{internalType:"bytes32",name:"annotationData",type:"bytes32"}],name:"newAnnotation",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"annotationType",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"data",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"annotationData",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"}],name:"NewAnnotation",type:"event"},{inputs:[{internalType:"bytes32",name:"annotationType",type:"bytes32"},{internalType:"bytes32",name:"data",type:"bytes32"},{internalType:"bytes32[]",name:"annotationData",type:"bytes32[]"}],name:"newAnnotations",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"annotationType",type:"bytes32"},{internalType:"string",name:"description",type:"string"}],name:"newAnnotationType",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"annotationType",type:"bytes32"},{indexed:!1,internalType:"string",name:"description",type:"string"}],name:"NewAnnotationType",type:"event"},{inputs:[{internalType:"bytes32",name:"dataType",type:"bytes32"},{internalType:"string",name:"description",type:"string"}],name:"newDataType",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"dataType",type:"bytes32"},{indexed:!1,internalType:"string",name:"description",type:"string"}],name:"NewDataType",type:"event"},{inputs:[{internalType:"bytes32",name:"linkType",type:"bytes32"},{internalType:"bytes32",name:"fromData",type:"bytes32"},{internalType:"bytes32",name:"toData",type:"bytes32"}],name:"newLink",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"linkType",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"fromData",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"toData",type:"bytes32"},{indexed:!1,internalType:"address",name:"user",type:"address"}],name:"NewLink",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"linkType",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"fromData",type:"bytes32"},{indexed:!1,internalType:"address",name:"user",type:"address"}],name:"NewLinkRoot",type:"event"},{inputs:[{internalType:"bytes32",name:"linkType",type:"bytes32"},{internalType:"bytes32",name:"fromData",type:"bytes32"},{internalType:"bytes32[]",name:"toData",type:"bytes32[]"}],name:"newLinks",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"linkType",type:"bytes32"},{internalType:"string",name:"description",type:"string"}],name:"newLinkType",outputs:[],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"linkType",type:"bytes32"},{indexed:!1,internalType:"string",name:"description",type:"string"}],name:"NewLinkType",type:"event"}],this.contractAddress="0x305306F68D9C230B59d5B6869AEd1723365C9290"}return Object(r.a)(e,[{key:"getContract",value:function(e){return new e.eth.Contract(this.abi,this.contractAddress)}}]),e}();t.a=s},435:function(e,t,n){"use strict";var a=n(1),r=n(2),s=n(6),i=n(4),o=n(7),c=(n(16),function(e){function t(e,n){var r;return Object(a.a)(this,t),(r=Object(s.a)(this,Object(i.a)(t).call(this))).name=e,r.contentHash=n,r}return Object(o.a)(t,e),Object(r.a)(t,[{key:"getName",value:function(){return this.name}},{key:"getId",value:function(){return this.contentHash}},{key:"getJson",value:function(){return{name:this.name,contentHash:this.contentHash}}},{key:"fromJson",value:function(e){return this.name=e.name,this.contentHash=e.contentHash,this}}]),t}(n(282).a));t.a=c},436:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var a=n(13),r=n.n(a),s=n(598),i=.75;function o(e,t,n){var a=(new Date).getTime(),o=e.getChannelData(0),u=o.length,l=1e3*u/r.a.context.sampleRate;if(u/r.a.context.sampleRate<i)return{onsets:[],tempo:0};for(var p=t.asm._initTempo(1024,256,r.a.context.sampleRate,n,-45),h=t._newBuffer(256),d=[],f=new Set,m=o.length/256-1,v=u/256-1,g=0;g<m;g++){var b=o.subarray(256*g,256*(g+1));t.HEAPF32.set(b,h>>2);var y=t.asm._processTempo(p,h),k=t.asm._getOnset(p);0===g&&(y=c(b)?1:0);var E=t.asm._getTempo(p);d.push(E),0!=y&&g<v&&k<.8*l&&f.add(k)}f=Array.from(f),t._destroyBuffer(h),t.asm._dispose(p);var S=Object(s.a)(d.filter(function(e){return 0!=e}))||0;S>180&&(S/=2);(new Date).getTime();return{tempo:S,onsets:f,onsetToPitch:{}}}function c(e){return Math.sqrt(e.reduce(function(e,t){return e+Math.pow(t,2)})/e.length)>.1}},437:function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return r});var a=1,r=2},438:function(e,t,n){"use strict";(function(e){var a=n(3),r=n.n(a),s=n(11),i=n(1),o=n(2),c=n(425),u=n(35),l=new c.a,p=n(66),h=function(){function e(t){Object(i.a)(this,e),this.web3=t,this.cachedUserNames={}}return Object(o.a)(e,[{key:"isUserNameAvailable",value:function(e){var t=this;return new Promise(function(){var n=Object(s.a)(r.a.mark(function n(a,s){var i,o,c;return r.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.web3.eth.getAccounts();case 2:return i=n.sent,i[0],o=l.getContract(t.web3),n.prev=5,n.next=8,o.methods.isUserNameAvailable(e).call();case 8:c=n.sent,a(c),n.next=16;break;case 12:n.prev=12,n.t0=n.catch(5),console.log(n.t0),s(n.t0);case 16:case"end":return n.stop()}},n,null,[[5,12]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getUserId",value:function(e){var t=this;return new Promise(function(){var n=Object(s.a)(r.a.mark(function n(a,s){var i,o,c;return r.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.web3.eth.getAccounts();case 2:return i=n.sent,i[0],o=l.getContract(t.web3),n.prev=5,n.next=8,o.methods.getUserAddressFromName(e).call();case 8:c=n.sent,a(c),n.next=16;break;case 12:n.prev=12,n.t0=n.catch(5),console.log(n.t0),s(n.t0);case 16:case"end":return n.stop()}},n,null,[[5,12]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"setUserName",value:function(e){var t=this;return new Promise(function(){var n=Object(s.a)(r.a.mark(function n(a,s){var i;return r.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.web3.eth.getAccounts();case 2:i=n.sent,l.getContract(t.web3).methods.setName(e).send({from:i[0]},function(e,t){e?s(e):a()});case 5:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"setProfile",value:function(e){var t=this;return new Promise(function(){var n=Object(s.a)(r.a.mark(function n(a,s){var i,o;return r.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.web3.eth.getAccounts();case 2:return i=n.sent,n.next=5,u.a.addJson(e);case 5:o=d(o=n.sent),l.getContract(t.web3).methods.setProfileHash(o).send({from:i[0]},function(e,t){e?s(e):a()});case 9:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getUserName",value:function(e){var t=this;return new Promise(function(){var n=Object(s.a)(r.a.mark(function n(a,s){var i,o,c;return r.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.cachedUserNames[e]){n.next=3;break}return a(t.cachedUserNames[e]),n.abrupt("return");case 3:if(void 0!==e){n.next=8;break}return n.next=6,t.web3.eth.getAccounts();case 6:i=n.sent,e=i[0];case 8:if(void 0!==e){n.next=11;break}return a(void 0),n.abrupt("return");case 11:if(!(e in t.cachedUserNames)){n.next=14;break}return a(t.cachedUserNames[e]),n.abrupt("return");case 14:return o=l.getContract(t.web3),n.prev=15,n.next=18,o.methods.getUserName(e).call();case 18:if(""!==(c=n.sent)){n.next=22;break}return a(void 0),n.abrupt("return");case 22:t.cachedUserNames[e]=c,a(c),n.next=29;break;case 26:n.prev=26,n.t0=n.catch(15),s(n.t0);case 29:case"end":return n.stop()}},n,null,[[15,26]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getProfile",value:function(e){var t=this;return new Promise(function(){var n=Object(s.a)(r.a.mark(function n(a,s){var i,o,c,p;return r.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0!==e){n.next=8;break}return n.next=3,t.web3.eth.getAccounts();case 3:if(void 0!==(i=n.sent)&&0!==i.length){n.next=7;break}return s("no ethereum"),n.abrupt("return");case 7:e=i[0];case 8:return o=l.getContract(t.web3),n.next=11,o.methods.getUserProfile(e).call();case 11:if(c=n.sent,n.prev=12,0!==t.web3.utils.hexToNumber(c)){n.next=16;break}return a("no profile"),n.abrupt("return");case 16:n.next=21;break;case 18:n.prev=18,n.t0=n.catch(12),console.log("had error while trying to get profile");case 21:return c=f(c),n.next=24,u.a.getJson(c);case 24:p=n.sent,a(p);case 26:case"end":return n.stop()}},n,null,[[12,18]])}));return function(e,t){return n.apply(this,arguments)}}())}}]),e}();function d(e){var t=p.decode(e).toString("hex").replace(/^1220/,"");return 64!=t.length?null:"0x"+t}function f(t){var n=new e(t.replace(/^0x/,"1220"),"hex");return p.encode(n)}t.a=h}).call(this,n(15).Buffer)},45:function(e,t,n){"use strict";var a=n(1),r=n(2),s=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],i={C:0,"C#":1,D:2,"D#":3,E:4,F:5,"F#":6,G:7,"G#":8,A:9,"A#":10,B:11},o={"C#":!0,"D#":!0,"F#":!0,"G#":!0,"A#":!0},c={},u=function(){function e(t,n){Object(a.a)(this,e),void 0===t&&(t="C"),this.note=t.toUpperCase(),this.octave=n}return Object(r.a)(e,[{key:"isBlackNote",value:function(){return o[this.note]}},{key:"transpose",value:function(t){this.note;var n=Math.floor(p(t,12)),a=Math.floor(t/12);return new e(s[n],this.octave+a)}},{key:"addTranspose",value:function(t){var n=i[this.note],a=Math.floor(p(t+n,12)),r=Math.floor((t+n)/12);return new e(s[a],this.octave+r)}},{key:"toString",value:function(){return this.note+this.octave}},{key:"getTranspose",value:function(){this.noteIndex();return 12*(this.octave-l.octave)+(this.noteIndex()-l.noteIndex())}},{key:"noteIndex",value:function(){return i[this.note]}},{key:"getCopy",value:function(){return new e(this.note,this.octave)}},{key:"equal",value:function(e){return this.note===e.note&&this.octave===e.octave}}]),e}(),l=new u("C",3);function p(e,t){return(e%t+t)%t}function h(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t&&c[e])return c[e];var n=void 0;return n="#"===e.substring(1,2)?new u(e.substring(0,2),parseInt(e.substring(2))):new u(e.substring(0,1),parseInt(e.substring(1))),t&&(c[e]=n),n}for(var d=s.map(function(e){return new u(e,3)}),f=0;f<16;f++)for(var m in s){h(s[m]+f)}t.a={Note:u,middleC:l,fromString:h,fromTranspose:function(e){return l.getCopy().transpose(e)},NOTES:d,baseNotes:s}},47:function(e,t,n){"use strict";var a=n(17),r=n(3),s=n.n(r),i=n(11),o=n(1),c=n(2),u=n(6),l=n(4),p=n(7),h=(n(51),n(282)),d=n(13),f=n.n(d),m=n(436),v=n(16),g=n(35),b=(n(192),n(196)),y=n(58),k=(n(338),n(38)),E=n(378),S=new k.a,O=function(e){function t(e,n,a){var r;return Object(o.a)(this,t),r=Object(u.a)(this,Object(l.a)(t).call(this)),"number"==typeof e||Object(y.a)(e)?r.soundId=e:r.ipfsHash=e,r.guildId=a,r.downloadUrl=void 0,r.videoId=void 0,r.name=void 0,r.tags=void 0,r.slices=void 0,r.noteSequence=void 0,r.isStems=!1,r.guildId=void 0,r.encryptedIpfs=n||new b.a(window.sequencerEngine.store,window.sequencerEngine.ethereum.guilds,window.sequencerEngine.ethereum.encryption,window.sequencerEngine.ethereum.crypto),r.audioBuffer=void 0,r.addedToProject=!1,r.highlightedTags={},r.samplesUsed=[],r}return Object(p.a)(t,e),Object(c.a)(t,[{key:"getName",value:function(){return this.name}},{key:"getTagsToSave",value:function(){var e=this;return Object.keys(this.highlightedTags).length>0?Object.keys(this.highlightedTags).filter(function(t){return e.highlightedTags[t]}):this.tags}},{key:"getId",value:function(){return void 0!==this.soundId?this.soundId:this.ipfsHash}},{key:"fromJson",value:function(e){this.ipfsHash=e.id,this.name=e.name,this.videoId=e.videoId,this.tags=e.tags,this.slices=e.slices,this.coverArtHash=e.coverArtHash,this.discogsId=e.discogsId}},{key:"dispose",value:function(){!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this.addedToProject||(this.audioBuffer=void 0,this.discogsId=void 0,this.name=void 0,this.videoId=void 0,this.coverArtHash=void 0,this.slices=void 0)}},{key:"isLoaded",value:function(){return void 0!==this.audioBuffer}},{key:"getId",value:function(){return void 0!==this.ipfsHash?this.ipfsHash:this.soundId}},{key:"getJson",value:function(){return{id:this.getId(),slices:this.slices,name:this.name,videoId:this.videoId,tags:this.tags,thumbnail:this.getThumbnail(),discogsId:this.discogsId,coverArtHash:this.coverArtHash}}},{key:"fetchMetadata",value:function(){var e=this;if(void 0!==this.ipfsHash)return new Promise(function(){var t=Object(i.a)(s.a.mark(function t(n,a){var r,i,o;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.a.getTitleForSound(e.ipfsHash);case 2:return r=t.sent,t.next=5,v.a.getVideoIdForSound(e.ipfsHash);case 5:return i=t.sent,t.next=8,v.a.getCoverArtForSound(e.ipfsHash);case 8:o=t.sent,void 0!==r&&(e.name=r),void 0!==i&&(e.videoId=i),void 0!==o&&(e.coverArtHash=o),n(e);case 13:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"fetchTags",value:function(){var e=this;return new Promise(function(){var t=Object(i.a)(s.a.mark(function t(n,a){var r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e.soundId||void 0===e.ipfsHash){t.next=11;break}return t.t0=Set,t.next=4,v.a.getTagsForSound(e.ipfsHash);case 4:return t.t1=t.sent,r=new t.t0(t.t1),e.tags=Array.from(r),n(e.tags),t.abrupt("return");case 11:n([]);case 12:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"fetchSlices",value:function(){var e=this;return new Promise(function(){var t=Object(i.a)(s.a.mark(function t(n,a){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:v.a.getSlicesForSound(e.ipfsHash).then(function(t){e.slices=t,n(t)});case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"fetchAudio",value:function(){var e=this;return new Promise(function(t,n){void 0!==e.ipfsHash&&e.fetchAudioFromIPFS().then(function(e){return t(e)}).catch(function(e){n("timed out")})})}},{key:"fetchAudioFromIPFS",value:function(){var e=this;return new Promise(function(t,n){var a=(new Date).getTime();e.encryptedIpfs.getSound(e.ipfsHash).then(function(){var r=Object(i.a)(s.a.mark(function r(i){var o;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return o=(new Date).getTime(),o-a,r.prev=2,r.next=5,f.a.Master.context.decodeAudioData(E(i));case 5:e.audioBuffer=r.sent,t(e),r.next=12;break;case 9:r.prev=9,r.t0=r.catch(2),n(r.t0);case 12:case"end":return r.stop()}},r,null,[[2,9]])}));return function(e){return r.apply(this,arguments)}}()).catch(function(e){n(e)})})}},{key:"fetchGuild",value:function(){var e=Object(i.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.a.guildSamples.getGuildIdForSound(this.getId());case 2:this.guildId=e.sent;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"analyze",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;if(void 0===this.tempo){var n=Object(m.a)(this.audioBuffer,e,t),a=n.tempo,r=n.onsets;this.tempo=a,this.onsets=r}}},{key:"fetchNoteSequence",value:function(){var e=this;return new Promise(function(){var t=Object(i.a)(s.a.mark(function t(n,a){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n(e.noteSequence);case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getThumbnail",value:function(){return void 0!==this.coverArtHash?g.a.getHashUrl(this.coverArtHash):void 0===this.videoId?void 0:"https://img.youtube.com/vi/"+this.videoId+"/1.jpg"}},{key:"load",value:function(){var e=this;return new Promise(function(){var t=Object(i.a)(s.a.mark(function t(n,a){var r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=[e.fetchTags(),e.fetchAudio(),e.fetchMetadata(),e.fetchGuild()],t.next=4,Promise.all(r);case 4:n(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),a();case 10:case"end":return t.stop()}},t,null,[[0,7]])}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getCopyWith",value:function(e,n){var r=new t(e);return r.videoId=this.videoId,r.discogsId=this.discogsId,r.coverArtHash=this.coverArtHash,r.name=this.name+"("+n+")",r.year=this.year,r.country=this.country,r.styles=this.styles,r.tags=[].concat(Object(a.a)(this.tags),[n]),r.isStems=!0,r}},{key:"getCopy",value:function(){var e=new t(this.getId());if(e.videoId=this.videoId,e.discogsId=this.discogsId,e.coverArtHash=this.coverArtHash,e.name=this.name,e.year=this.year,e.country=this.country,e.styles=this.styles,e.tags=this.tags?Object(a.a)(this.tags):[],void 0!==this.audioBuffer){var n=new AudioBuffer({length:this.audioBuffer.length,numberOfChannels:this.audioBuffer.numberOfChannels,sampleRate:this.audioBuffer.sampleRate}),r=this.audioBuffer.getChannelData(0);n.copyToChannel(r,0),this.audioBuffer.numberOfChannels>1&&(r=this.audioBuffer.getChannelData(1),n.copyToChannel(r,1)),e.audioBuffer=n}return e}},{key:"color",get:function(){return S.getColorForHash(this.getId())}}]),t}(h.a);t.a=O},5:function(e,t,n){"use strict";n.d(t,"xc",function(){return r}),n.d(t,"gd",function(){return s}),n.d(t,"ye",function(){return i}),n.d(t,"hb",function(){return o}),n.d(t,"gb",function(){return c}),n.d(t,"bd",function(){return u}),n.d(t,"bc",function(){return l}),n.d(t,"Z",function(){return p}),n.d(t,"Y",function(){return h}),n.d(t,"X",function(){return d}),n.d(t,"yc",function(){return f}),n.d(t,"Ee",function(){return m}),n.d(t,"Fe",function(){return v}),n.d(t,"Bc",function(){return g}),n.d(t,"a",function(){return b}),n.d(t,"l",function(){return y}),n.d(t,"f",function(){return k}),n.d(t,"d",function(){return E}),n.d(t,"e",function(){return S}),n.d(t,"j",function(){return O}),n.d(t,"h",function(){return w}),n.d(t,"g",function(){return C}),n.d(t,"P",function(){return P}),n.d(t,"He",function(){return T}),n.d(t,"Ge",function(){return j}),n.d(t,"s",function(){return x}),n.d(t,"ad",function(){return N}),n.d(t,"Yc",function(){return q}),n.d(t,"Mc",function(){return M}),n.d(t,"pe",function(){return D}),n.d(t,"he",function(){return A}),n.d(t,"ne",function(){return R}),n.d(t,"Bb",function(){return I}),n.d(t,"zb",function(){return L}),n.d(t,"uc",function(){return F}),n.d(t,"Jb",function(){return V}),n.d(t,"Kb",function(){return B}),n.d(t,"Lb",function(){return U}),n.d(t,"Hb",function(){return H}),n.d(t,"Ib",function(){return J}),n.d(t,"cd",function(){return G}),n.d(t,"Nd",function(){return z}),n.d(t,"Qd",function(){return _}),n.d(t,"dd",function(){return W}),n.d(t,"Jc",function(){return K}),n.d(t,"lb",function(){return Y}),n.d(t,"qb",function(){return Q}),n.d(t,"Qc",function(){return X}),n.d(t,"Rc",function(){return Z}),n.d(t,"sb",function(){return $}),n.d(t,"me",function(){return ee}),n.d(t,"de",function(){return te}),n.d(t,"Be",function(){return ne}),n.d(t,"W",function(){return ae}),n.d(t,"xe",function(){return re}),n.d(t,"Td",function(){return se}),n.d(t,"Yd",function(){return ie}),n.d(t,"M",function(){return oe}),n.d(t,"Db",function(){return ce}),n.d(t,"Eb",function(){return ue}),n.d(t,"Ed",function(){return le}),n.d(t,"kd",function(){return pe}),n.d(t,"Dd",function(){return he}),n.d(t,"Ad",function(){return de}),n.d(t,"Bd",function(){return fe}),n.d(t,"id",function(){return me}),n.d(t,"Gb",function(){return ve}),n.d(t,"Md",function(){return ge}),n.d(t,"qc",function(){return be}),n.d(t,"Sc",function(){return ye}),n.d(t,"Ec",function(){return ke}),n.d(t,"Ic",function(){return Ee}),n.d(t,"Sd",function(){return Se}),n.d(t,"Tb",function(){return Oe}),n.d(t,"jb",function(){return we}),n.d(t,"zc",function(){return Ce}),n.d(t,"Pb",function(){return Pe}),n.d(t,"fe",function(){return Te}),n.d(t,"Vc",function(){return je}),n.d(t,"se",function(){return xe}),n.d(t,"Vb",function(){return Ne}),n.d(t,"ve",function(){return qe}),n.d(t,"bb",function(){return Me}),n.d(t,"te",function(){return De}),n.d(t,"kc",function(){return Ae}),n.d(t,"jc",function(){return Re}),n.d(t,"S",function(){return Ie}),n.d(t,"pd",function(){return Le}),n.d(t,"md",function(){return Fe}),n.d(t,"re",function(){return Ve}),n.d(t,"tc",function(){return Be}),n.d(t,"k",function(){return Ue}),n.d(t,"Rd",function(){return He}),n.d(t,"Zc",function(){return Je}),n.d(t,"Pd",function(){return Ge}),n.d(t,"fd",function(){return ze}),n.d(t,"ed",function(){return _e}),n.d(t,"je",function(){return We}),n.d(t,"ke",function(){return Ke}),n.d(t,"Ie",function(){return Ye}),n.d(t,"Ob",function(){return Qe}),n.d(t,"rb",function(){return Xe}),n.d(t,"pc",function(){return Ze}),n.d(t,"Mb",function(){return $e}),n.d(t,"vc",function(){return et}),n.d(t,"Nb",function(){return tt}),n.d(t,"dc",function(){return nt}),n.d(t,"wd",function(){return at}),n.d(t,"rd",function(){return rt}),n.d(t,"ac",function(){return st}),n.d(t,"xd",function(){return it}),n.d(t,"ud",function(){return ot}),n.d(t,"od",function(){return ct}),n.d(t,"le",function(){return ut}),n.d(t,"De",function(){return lt}),n.d(t,"Sb",function(){return pt}),n.d(t,"L",function(){return ht}),n.d(t,"wc",function(){return dt}),n.d(t,"Ce",function(){return ft}),n.d(t,"J",function(){return mt}),n.d(t,"ze",function(){return vt}),n.d(t,"Ae",function(){return gt}),n.d(t,"Xb",function(){return bt}),n.d(t,"fc",function(){return yt}),n.d(t,"gc",function(){return kt}),n.d(t,"c",function(){return Et}),n.d(t,"m",function(){return St}),n.d(t,"n",function(){return Ot}),n.d(t,"b",function(){return wt}),n.d(t,"Rb",function(){return Ct}),n.d(t,"Kd",function(){return Pt}),n.d(t,"O",function(){return Tt}),n.d(t,"U",function(){return jt}),n.d(t,"T",function(){return xt}),n.d(t,"N",function(){return Nt}),n.d(t,"rc",function(){return qt}),n.d(t,"K",function(){return Mt}),n.d(t,"Gc",function(){return Dt}),n.d(t,"Wb",function(){return At}),n.d(t,"Cd",function(){return Rt}),n.d(t,"jd",function(){return It}),n.d(t,"td",function(){return Lt}),n.d(t,"ic",function(){return Ft}),n.d(t,"yd",function(){return Vt}),n.d(t,"i",function(){return Bt}),n.d(t,"kb",function(){return Ut}),n.d(t,"V",function(){return Ht}),n.d(t,"Oc",function(){return Jt}),n.d(t,"Kc",function(){return Gt}),n.d(t,"Fd",function(){return zt}),n.d(t,"Yb",function(){return _t}),n.d(t,"nd",function(){return Wt}),n.d(t,"ab",function(){return Kt}),n.d(t,"Xd",function(){return Yt}),n.d(t,"r",function(){return Qt}),n.d(t,"q",function(){return Xt}),n.d(t,"p",function(){return Zt}),n.d(t,"Zb",function(){return $t}),n.d(t,"Ud",function(){return en}),n.d(t,"Cc",function(){return tn}),n.d(t,"Hc",function(){return nn}),n.d(t,"ld",function(){return an}),n.d(t,"fb",function(){return rn}),n.d(t,"mb",function(){return sn}),n.d(t,"ie",function(){return on}),n.d(t,"Ab",function(){return cn}),n.d(t,"Uc",function(){return un}),n.d(t,"Id",function(){return ln}),n.d(t,"vd",function(){return pn}),n.d(t,"Qb",function(){return hn}),n.d(t,"Gd",function(){return dn}),n.d(t,"ib",function(){return fn}),n.d(t,"Lc",function(){return mn}),n.d(t,"Tc",function(){return vn}),n.d(t,"Cb",function(){return gn}),n.d(t,"eb",function(){return bn}),n.d(t,"db",function(){return yn}),n.d(t,"cb",function(){return kn}),n.d(t,"vb",function(){return En}),n.d(t,"sc",function(){return Sn}),n.d(t,"Ac",function(){return On}),n.d(t,"ob",function(){return wn}),n.d(t,"Vd",function(){return Cn}),n.d(t,"ee",function(){return Pn}),n.d(t,"oe",function(){return Tn}),n.d(t,"wb",function(){return jn}),n.d(t,"yb",function(){return xn}),n.d(t,"xb",function(){return Nn}),n.d(t,"pb",function(){return qn}),n.d(t,"Pc",function(){return Mn}),n.d(t,"Jd",function(){return Dn}),n.d(t,"Od",function(){return An}),n.d(t,"Fc",function(){return Rn}),n.d(t,"zd",function(){return In}),n.d(t,"Ub",function(){return Ln}),n.d(t,"hc",function(){return Fn}),n.d(t,"cc",function(){return Vn}),n.d(t,"sd",function(){return Bn}),n.d(t,"Nc",function(){return Un}),n.d(t,"nc",function(){return Hn}),n.d(t,"oc",function(){return Jn}),n.d(t,"Ld",function(){return Gn}),n.d(t,"qd",function(){return zn}),n.d(t,"Hd",function(){return _n}),n.d(t,"ue",function(){return Wn}),n.d(t,"lc",function(){return Kn}),n.d(t,"Q",function(){return Yn}),n.d(t,"R",function(){return Qn}),n.d(t,"we",function(){return Xn}),n.d(t,"qe",function(){return Zn}),n.d(t,"Wd",function(){return $n}),n.d(t,"H",function(){return ea}),n.d(t,"B",function(){return ta}),n.d(t,"u",function(){return na}),n.d(t,"A",function(){return aa}),n.d(t,"G",function(){return ra}),n.d(t,"z",function(){return sa}),n.d(t,"F",function(){return ia}),n.d(t,"Xc",function(){return oa}),n.d(t,"ub",function(){return ca}),n.d(t,"tb",function(){return ua}),n.d(t,"Wc",function(){return la}),n.d(t,"Fb",function(){return pa}),n.d(t,"ge",function(){return ha}),n.d(t,"mc",function(){return da}),n.d(t,"I",function(){return fa}),n.d(t,"v",function(){return ma}),n.d(t,"w",function(){return va}),n.d(t,"x",function(){return ga}),n.d(t,"C",function(){return ba}),n.d(t,"E",function(){return ya}),n.d(t,"y",function(){return ka}),n.d(t,"D",function(){return Ea}),n.d(t,"Dc",function(){return Sa}),n.d(t,"nb",function(){return Oa}),n.d(t,"t",function(){return wa}),n.d(t,"ae",function(){return Ca}),n.d(t,"ce",function(){return Pa}),n.d(t,"be",function(){return Ta}),n.d(t,"hd",function(){return ja}),n.d(t,"ec",function(){return xa}),n.d(t,"o",function(){return Na}),n.d(t,"Zd",function(){return qa});var a=n(8),r=function(e){return{type:a.Fc,payload:e}},s=function(e){return{type:a.ld,payload:e}},i=function(e){return{type:a.Le,payload:e}},o=function(e){return{type:a.nb,payload:e}},c=function(e){return{type:a.mb,payload:e}},u=function(e){return{type:a.jd,payload:e}},l=function(e,t){return{type:a.jc,payload:{id:e,numberOfPatterns:t}}},p=function(e,t){return{type:a.eb,payload:{sequenceId:e,currentPattern:t}}},h=function(e,t){return{type:a.cb,payload:{sequenceId:e,currentGlobalStep:t}}},d=function(e,t,n){return{type:a.bb,payload:{sequenceId:e,currentStep:t,currentGlobalStep:n}}},f=function(e,t){return{type:a.Gc,payload:{sampleId:e,sample:t}}},m=function(e,t){return{type:a.Se,payload:{trackNumber:e,sliceNumber:t}}},v=function(e,t){return{type:a.Te,payload:{trackNumber:e,sliceNumber:t}}},g=function(e){return{type:a.Jc,payload:e}},b=function(e){return{type:a.a,payload:e}},y=function(e){return{type:a.m,payload:e}},k=function(e){return{type:a.g,payload:e}},E=function(e){return{type:a.e,payload:e}},S=function(e){return{type:a.f,payload:e}},O=function(e){return{type:a.k,payload:e}},w=function(e){return{type:a.i,payload:e}},C=function(e){return{type:a.h,payload:e}},P=function(e){return{type:a.b,payload:e}},T=function(e,t){return{type:a.Ve,payload:{trackNumber:e,recording:t}}},j=function(e,t){return{type:a.Ue,payload:{trackNumber:e,preparing:t}}},x=function(e,t,n,r,s,i,o,c){return{type:a.u,payload:{trackNumber:e,steps:t,pianoRollSteps:n,fills:r,stepToId:s,stepToPosition:i,pianoRollDurations:o,patternSteps:c}}},N=function(e){return{type:a.id,payload:e}},q=function(e){return{type:a.gd,payload:e}},M=function(e){return{type:a.Uc,payload:e}},D=function(e,t){return{type:a.Ee,payload:{trackNumber:e,volume:t}}},A=function(e,t){return{type:a.ue,payload:{trackNumber:e,muted:t}}},R=function(e,t){return{type:a.Be,payload:{trackNumber:e,solo:t}}},I=function(e,t){return{type:a.Hb,payload:{groupNumber:e,volume:t}}},L=function(e,t){return{type:a.Fb,payload:{groupNumber:e,muted:t}}},F=function(e){return{type:a.Cc,payload:e}},V=function(e){return{type:a.Qb,payload:e}},B=function(e){return{type:a.Rb,payload:e}},U=function(e){return{type:a.Sb,payload:e}},H=function(e,t){return{type:a.Ob,payload:{sequenceId:e,isPlaying:t}}},J=function(e){return{type:a.Pb,payload:e}},G=function(e,t){return{type:a.kd,payload:{sendNumber:e,muted:t}}},z=function(e){return{type:a.Yd,payload:e}},_=function(e){return{type:a.be,payload:e}},W=function(e){return{type:a.md,payload:e}},K=function(e){return{type:a.Rc,payload:e}},Y=function(e,t){return{type:a.ub,payload:{id:e,value:t}}},Q=function(e){return{type:a.sb,payload:e}},X=function(e){return{type:a.Yc,payload:e}},Z=function(e){return{type:a.Zc,payload:e}},$=function(e){return{type:a.yb,payload:e}},ee=function(e,t,n,r){return{type:a.Ae,payload:{subSequenceId:e,trackNumber:t,sendNumber:n,volume:r}}},te=function(e){return{type:a.qe,payload:e}},ne=function(e){return{type:a.Pe,payload:e}},ae=function(e){return{type:a.ab,payload:e}},re=function(e){return{type:a.Ke,payload:e}},se=function(e){return{type:a.ce,payload:e}},ie=function(e){return{type:a.he,payload:e}},oe=function(e){return{type:a.R,payload:e}},ce=function(e){return{type:a.Jb,payload:e}},ue=function(e){return{type:a.Kb,payload:e}},le=function(e){return{type:a.Nd,payload:e}},pe=function(e){return{type:a.td,payload:e}},he=function(e){return{type:a.Md,payload:e}},de=function(e){return{type:a.Jd,payload:e}},fe=function(e){return{type:a.Kd,payload:e}},me=function(e){return{type:a.rd,payload:e}},ve=function(e){return{type:a.Nb,payload:e}},ge=function(e){return{type:a.Xd,payload:e}},be=function(e,t,n,r){return{type:a.yc,payload:{stepNumber:e,transpose:t,numSteps:n,numNotes:r}}},ye=function(e){return{type:a.ad,payload:e}},ke=function(e){return{type:a.Mc,payload:e}},Ee=function(e){return{type:a.Qc,payload:e}},Se=function(e){return{type:a.Vd,payload:e}},Oe=function(e,t){return{type:a.ac,payload:{id:e,loading:t}}},we=function(e){return{type:a.pb,payload:e}},Ce=function(e){return{type:a.Hc,payload:e}},Pe=function(e){return{type:a.Vb,payload:e}},Te=function(e,t,n){return{type:a.se,payload:{subSequenceId:e,trackNumber:t,isEnabled:n}}},je=function(e,t){return{type:a.dd,payload:{sampleId:e,tag:t}}},xe=function(e){return{type:a.Ge,payload:{transpose:e}}},Ne=function(e,t){return{type:a.cc,payload:{sequenceId:e,volume:t}}},qe=function(e){return{type:a.Je,payload:e}},Me=function(e){return{type:a.hb,payload:e}},De=function(e){return{type:a.He,payload:e}},Ae=function(e){return{type:a.sc,payload:e}},Re=function(e,t){return{type:a.rc,payload:{pattern:e,color:t}}},Ie=function(e){return{type:a.W,payload:e}},Le=function(e){return{type:a.yd,payload:e}},Fe=function(e){return{type:a.vd,payload:e}},Ve=function(e){return{type:a.ke,payload:e}},Be=function(e){return{type:a.Bc,payload:e}},Ue=function(){return{type:a.l,payload:{}}},He=function(e,t,n){return{type:a.Ud,payload:{trackNumber:e,fromStep:t,toStep:n}}},Je=function(e,t,n){return{type:a.hd,payload:{trackNumber:e,patternNumber:t,steps:n}}},Ge=function(e){return{type:a.ae,payload:e}},ze=function(e){return{type:a.od,payload:{patternLocks:e}}},_e=function(e,t){return{type:a.nd,payload:{patternNumber:e,locked:t}}},We=function(e,t,n,r){return{type:a.we,payload:{subSequence:e,trackNumber:t,patternNumber:n,locked:r}}},Ke=function(e,t,n){return{type:a.xe,payload:{subSequence:e,trackNumber:t,patternLocks:n}}},Ye=function(e){return{type:a.We,payload:e}},Qe=function(e,t){return{type:a.Yb,payload:{patternLocks:t,subSequence:e}}},Xe=function(e,t){return{type:a.xb,payload:{patternLocks:t,subSequence:e}}},Ze=function(e,t){return{type:a.xc,payload:{start:e,end:t}}},$e=function(e){return{type:a.Tb,payload:e}},et=function(e){return{type:a.Dc,payload:e}},tt=function(e){return{type:a.Ub,payload:e}},nt=function(e){return{type:a.lc,payload:e}},at=function(e){return{type:a.Gd,payload:e}},rt=function(e){return{type:a.Ad,payload:e}},st=function(e,t){return{type:a.ic,payload:{id:e,value:t}}},it=function(e){return{type:a.Fd,payload:e}},ot=function(e){return{type:a.Dd,payload:e}},ct=function(e){return{type:a.xd,payload:e}},ut=function(e){return{type:a.ze,payload:e}},lt=function(e){return{type:a.Re,payload:e}},pt=function(e){return{type:a.Zb,payload:e}},ht=function(e){return{type:a.Q,payload:e}},dt=function(e){return{type:a.Ec,payload:e}},ft=function(e){return{type:a.Qe,payload:e}},mt=function(e){return{type:a.O,payload:e}},vt=function(e){return{type:a.Ne,payload:e}},gt=function(e){return{type:a.Oe,payload:e}},bt=function(e){return{type:a.ec,payload:e}},yt=function(e){return{type:a.pc,payload:e}},kt=function(e,t){return{type:a.oc,payload:{parameter:e,midiControl:t}}},Et=function(e){return{type:a.d,payload:e}},St=function(e){return{type:a.q,payload:e}},Ot=function(e,t){return{type:a.p,payload:{action:e,midiControl:t}}},wt=function(e){return{type:a.c,payload:e}},Ct=function(e){return{type:a.Xb,payload:e}},Pt=function(e){return{type:a.Td,payload:e}},Tt=function(e){return{type:a.T,payload:e}},jt=function(e){return{type:a.Y,payload:e}},xt=function(e){return{type:a.X,payload:e}},Nt=function(e){return{type:a.S,payload:e}},qt=function(e){return{type:a.zc,payload:e}},Mt=function(e){return{type:a.P,payload:e}},Dt=function(e){return{type:a.Oc,payload:e}},At=function(e){return{type:a.dc,payload:e}},Rt=function(e,t){return{type:a.Ld,payload:{trackNumber:e,show:t}}},It=function(e,t){return{type:a.sd,payload:{show:e,convolverSample:t}}},Lt=function(e){return{type:a.Cd,payload:e}},Ft=function(e){return{type:a.qc,payload:e}},Vt=function(e){return{type:a.Hd,payload:e}},Bt=function(){return{type:a.j,payload:{}}},Ut=function(e,t){return{type:a.tb,payload:{id:e,isCollapsed:t}}},Ht=function(e){return{type:a.Z,payload:e}},Jt=function(e){return{type:a.Wc,payload:e}},Gt=function(e){return{type:a.Sc,payload:e}},zt=function(e){return{type:a.Od,payload:e}},_t=function(e,t,n){return{type:a.gc,payload:{subSequenceId:e,type:t,events:n}}},Wt=function(e){return{type:a.wd,payload:e}},Kt=function(e,t){return{type:a.gb,payload:{sequenceId:e,subSequenceId:t}}},Yt=function(e,t){return{type:a.de,payload:{sequenceId:e,ids:t}}},Qt=function(e){return{type:a.t,payload:e}},Xt=function(e){return{type:a.s,payload:e}},Zt=function(e){return{type:a.r,payload:e}},$t=function(e){return{type:a.hc,payload:e}},en=function(e,t){return{type:a.ee,payload:{subSequenceId:e,value:t}}},tn=function(e,t){return{type:a.Kc,payload:{id:e,slices:t}}},nn=function(e){return{type:a.Pc,payload:e}},an=function(e){return{type:a.ud,payload:e}},rn=function(e){return{type:a.lb,payload:e}},sn=function(e){return{type:a.vb,payload:e}},on=function(e,t){return{type:a.ve,payload:{trackNumber:e,pan:t}}},cn=function(e,t){return{type:a.Gb,payload:{groupNumber:e,pan:t}}},un=function(e){return{type:a.cd,payload:e}},ln=function(e){return{type:a.Rd,payload:e}},pn=function(e){return{type:a.Ed,payload:e}},hn=function(e){return{type:a.Wb,payload:e}},dn=function(e){return{type:a.Pd,payload:e}},fn=function(e){return{type:a.ob,payload:e}},mn=function(e){return{type:a.Tc,payload:e}},vn=function(e){return{type:a.bd,payload:e}},gn=function(e){return{type:a.Ib,payload:e}},bn=function(e){return{type:a.kb,payload:e}},yn=function(e){return{type:a.jb,payload:e}},kn=function(e){return{type:a.ib,payload:e}},En=function(e){return{type:a.Bb,payload:e}},Sn=function(e){return{type:a.Ac,payload:e}},On=function(e){return{type:a.Ic,payload:e}},wn=function(e,t,n){return{type:a.rb,payload:{subSequenceId:e,trackNumber:t,chainNumber:n}}},Cn=function(e,t){return{type:a.fe,payload:{id:e,muted:t}}},Pn=function(e,t,n){return{type:a.re,payload:{subSequenceId:e,trackNumber:t,frozen:n}}},Tn=function(e,t){return{type:a.De,payload:{subSequenceId:e,trackNumber:t}}},jn=function(e,t,n){return{type:a.Eb,payload:{subSequenceId:e,trackNumber:t,playing:n}}},xn=function(e,t){return{type:a.Db,payload:{subSequenceId:e,frozenTracksPlaying:t}}},Nn=function(e,t){return{type:a.Cb,payload:{subSequenceId:e,frozenTracks:t}}},qn=function(e,t){return{type:a.qb,payload:{subSequenceId:e,effectsChains:t}}},Mn=function(e,t){return{type:a.Xc,payload:{id:e,selectedOnsets:t}}},Dn=function(e){return{type:a.Sd,payload:e}},An=function(e){return{type:a.Zd,payload:e}},Rn=function(e){return{type:a.Nc,payload:e}},In=function(e,t){return{type:a.Id,payload:{option:e,effect:t}}},Ln=function(e){return{type:a.bc,payload:e}},Fn=function(e){return{type:a.mc,payload:e}},Vn=function(e){return{type:a.kc,payload:e}},Bn=function(e){return{type:a.Bd,payload:e}},Un=function(e){return{type:a.Vc,payload:e}},Hn=function(e){return{type:a.vc,payload:e}},Jn=function(e){return{type:a.wc,payload:e}},Gn=function(e,t){return{type:a.Wd,payload:{stepNumber:e,stepData:t}}},zn=function(e){return{type:a.zd,payload:e}},_n=function(e){return{type:a.Qd,payload:e}},Wn=function(e,t){return{type:a.Ie,payload:{userName:e,token:t}}},Kn=function(e){return{type:a.tc,payload:e}},Yn=function(e){return{type:a.U,payload:e}},Qn=function(e){return{type:a.V,payload:e}},Xn=function(e){return{type:a.Me,payload:e}},Zn=function(e,t,n){return{type:a.Fe,payload:{subSequenceId:e,trackNumber:t,warp:n}}},$n=function(e,t){return{type:a.ge,payload:{subSequenceId:e,warps:t}}},ea=function(e,t){return{type:a.L,payload:{start:e,end:t}}},ta=function(e){return{type:a.F,payload:e}},na=function(e,t){return{type:a.x,payload:{subSequenceId:e,type:t}}},aa=function(e){return{type:a.D,payload:e}},ra=function(e){return{type:a.K,payload:e}},sa=function(e){return{type:a.E,payload:e}},ia=function(e){return{type:a.J,payload:e}},oa=function(e){return{type:a.fd,payload:e}},ca=function(e,t){return{type:a.Ab,payload:{effect:e,toggle:t}}},ua=function(e,t){return{type:a.zb,payload:{type:e,toggle:t}}},la=function(e){return{type:a.ed,payload:e}},pa=function(e){return{type:a.Mb,payload:e}},ha=function(e,t,n){return{type:a.te,payload:{subSequenceId:e,trackNumber:t,isLoading:n}}},da=function(e){return{type:a.uc,payload:e}},fa=function(e){return{type:a.M,payload:e}},ma=function(e){return{type:a.y,payload:e}},va=function(e){return{type:a.z,payload:e}},ga=function(e){return{type:a.A,payload:e}},ba=function(e,t){return{type:a.G,payload:void 0===e?void 0:{patternDragging:e,offsetX:t}}},ya=function(e,t,n){return{type:a.I,payload:{subSequenceId:e,patternId:t,startStep:n}}},ka=function(e){return{type:a.C,payload:e}},Ea=function(e,t){return{type:a.H,payload:void 0===e?void 0:{pattern:e,direction:t}}},Sa=function(e){return{type:a.Lc,payload:e}},Oa=function(e,t,n,r){return{type:a.wb,payload:{rackId:e,effectId:t,x:n,y:r}}},wa=function(e){return{type:a.w,payload:e}},Ca=function(e,t){return{type:a.le,payload:{trackId:e,device:t}}},Pa=function(e,t){return{type:a.ne,payload:{trackId:e,subDevice:t}}},Ta=function(e,t){return{type:a.me,payload:{trackId:e,parameter:t}}},ja=function(e){return{type:a.qd,payload:{show:e}}},xa=function(e,t){return{type:a.nc,payload:{parameter:e,automations:t}}},Na=function(e){return{type:a.o,payload:e}},qa=function(e){return{type:a.ie,payload:e}}},576:function(e,t,n){},577:function(e,t,n){},579:function(e,t,n){e.exports=n.p+"static/media/logo.5d5d9eef.svg"},58:function(e,t,n){"use strict";function a(e){return!isNaN(parseFloat(e))&&isFinite(e)}n.d(t,"a",function(){return a})},59:function(e,t,n){"use strict";(function(e){n.d(t,"b",function(){return o}),n.d(t,"a",function(){return c});var a=n(43),r=n.n(a),s="undefined"!==typeof window.web3?new r.a(window.web3.currentProvider):new r.a(new r.a.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),i=n(66);function o(e){var t=i.decode(e).toString("hex").replace(/^1220/,"");return 64!=t.length?null:"0x"+t}function c(e){for(var t=s.utils.fromAscii(e),n=t.length;n<=65;n++)t+="0";return t}}).call(this,n(15).Buffer)},598:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var a=n(17);function r(e){return(e=Object(a.a)(e)).sort(),e[Math.floor(e.length/2)]}},599:function(e,t,n){"use strict";var a=n(1);t.a=function e(){Object(a.a)(this,e),this.abi=[{constant:!1,inputs:[{name:"country",type:"bytes32"}],name:"deleteCountry",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"style",type:"bytes32"}],name:"deleteStyle",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"tag",type:"bytes32"}],name:"deleteTag",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"country",type:"bytes32"}],name:"newCountry",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"ipfsHash",type:"bytes32"},{name:"title",type:"string"}],name:"newSample",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"tag",type:"bytes32"}],name:"SampleTagged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"youtubeVideoId",type:"bytes32"}],name:"SampledYoutube",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!0,name:"sampleHash",type:"bytes32"},{indexed:!1,name:"title",type:"string"}],name:"SampleCreated",type:"event"},{constant:!1,inputs:[{name:"sampleHash",type:"bytes32"},{name:"title",type:"string"},{name:"youtubeVideoId",type:"bytes32"},{name:"tagsToAdd",type:"bytes32[4]"},{name:"stylesToAdd",type:"bytes32[4]"},{name:"country",type:"bytes32"},{name:"year",type:"int16"}],name:"newSampleWithMetadata",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"country",type:"bytes32"}],name:"SampleCountry",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"year",type:"int16"}],name:"SampleYear",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"sampleHash",type:"bytes32"},{indexed:!0,name:"style",type:"bytes32"}],name:"SampleStyle",type:"event"},{constant:!1,inputs:[{name:"sequenceHash",type:"bytes32"},{name:"title",type:"string"}],name:"newSequence",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"style",type:"bytes32"}],name:"newStyle",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"tag",type:"bytes32"}],name:"newTag",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"year",type:"int16"}],name:"newYear",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"user",type:"address"},{indexed:!0,name:"sequenceHash",type:"bytes32"},{indexed:!1,name:"title",type:"string"}],name:"SequenceCreated",type:"event"},{constant:!1,inputs:[{name:"sampleHash",type:"bytes32"},{name:"country",type:"bytes32"}],name:"setSampleCountry",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"sampleHash",type:"bytes32"},{name:"stylesToAdd",type:"bytes32[4]"},{name:"country",type:"bytes32"},{name:"year",type:"int16"}],name:"setSampleDiscogsMetadata",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"sampleHash",type:"bytes32"},{name:"style",type:"bytes32"}],name:"setSampleStyle",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"sampleHash",type:"bytes32"},{name:"tag",type:"bytes32"}],name:"setSampleTag",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"sampleHash",type:"bytes32"},{name:"tagsToAdd",type:"bytes32[4]"}],name:"setSampleTags",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"sampleHash",type:"bytes32"},{name:"year",type:"int16"}],name:"setSampleYear",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"sampleHash",type:"bytes32"},{name:"youtubeVideoId",type:"bytes32"}],name:"setSampleYoutubeVideoId",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{constant:!0,inputs:[{name:"",type:"uint256"}],name:"allYears",outputs:[{name:"",type:"int16"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"",type:"uint256"}],name:"countries",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"getNumberOfCountries",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"getNumberOfStyles",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"getNumberOfTags",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"getNumberOfYears",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"",type:"uint256"}],name:"styles",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"",type:"uint256"}],name:"tags",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"}],this.contractAddress="0x87efb60d3239958f9e6671b45cae668da531a22b"}},600:function(e,t,n){"use strict";var a=n(12),r=n(3),s=n.n(r),i=n(11),o=n(1),c=n(2),u=n(428),l=n(166),p=function(){function e(t){Object(o.a)(this,e),this.crypto=t}return Object(c.a)(e,[{key:"decryptQueryResult",value:function(){var e=Object(i.a)(s.a.mark(function e(t,n){var r,i,o,c,u;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("query decryptor"),r=Object(l.b)(t.encryptedContentKey),e.next=4,this.crypto.decryptName(t.encryptedName,r,n);case 4:return i=e.sent,o=t.user,e.next=8,this.crypto.decryptContentKey(r,n);case 8:return c=e.sent,u=Object(a.a)({},t,{title:Object(l.b)(i),encryptedTitle:t.encryptedName,user:"0x"+Object(l.a)(o.slice(2)),contentKey:c?c.contentKey:void 0,publicKey:Object(l.b)(t.publicKey)}),e.abrupt("return",u);case 11:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),h=n(43),d=n.n(h),f=n(62),m=n(40),v=n(35),g=n(59);function b(e,t){var n=new Set,a=Array.from(e);for(var r in a)t.has(a[r])&&n.add(a[r]);return n}var y=n(41),k=n(31),E="undefined"!==typeof window.web3?new d.a(window.web3.currentProvider):new d.a(new d.a.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),S=new u.a,O=E.utils.padLeft("0x0",64),w=function(){function e(t,n,a){Object(o.a)(this,e),this.web3=t,this.contract=new t.eth.Contract(S.abi,S.contractAddress),this.crypto=n,this.guilds=a,this.queryDecryptor=new p(this.crypto)}return Object(c.a)(e,[{key:"getPresetData",value:function(){var e=Object(i.a)(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=4;break}return e.next=3,v.a.getJson(t);case 3:return e.abrupt("return",e.sent);case 4:if(0!==t.guildId&&null!==t.guildId&&void 0!==t.guildId){e.next=8;break}return e.next=7,v.a.getJson(t.contentHash);case 7:return e.abrupt("return",e.sent);case 8:return e.t0=JSON,e.next=11,this.crypto.fetchAndDecrypt(t.contentHash,t);case 11:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPresetTitle",value:function(){var e=Object(i.a)(s.a.mark(function e(t){var n,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new y.a(this.contract.options.address).from(k.t).select("encryptedName").where("contentHash",t),e.next=3,n.executeQuery();case 3:if(0!==(a=e.sent).length){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",a[0].title);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"newPreset",value:function(e,t,n,a,r){var o=this;S.getContract(E);return new Promise(function(){var c=Object(i.a)(s.a.mark(function i(c,u){var l,p,h,d,b;return s.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(l=void 0,p=new Array(9).fill(O),h=new Array(6).fill(O),0===r){s.next=18;break}return s.next=6,o.guilds.getGuildKey(r);case 6:return d=s.sent,s.next=9,o.crypto.encryptRawContent(JSON.stringify(e),t,d.rawPublicKey);case 9:return b=s.sent,s.next=12,v.a.addJson(b.encryptedContent);case 12:l=s.sent,t=o.web3.utils.padLeft("0x"+b.encryptedName,64),p=b.encryptedContentKey,h=d.publicKey,s.next=22;break;case 18:return t=o.web3.utils.fromAscii(t),s.next=21,v.a.addJson(e);case 21:l=s.sent;case 22:n=void 0===n?O:Object(g.b)(n),a=void 0===a?O:E.utils.fromAscii(a),new f.a(m.d,"newPreset",[Object(g.b)(l),t,n,a,r,p,h]).execute(),c(l);case 26:case"end":return s.stop()}},i)}));return function(e,t){return c.apply(this,arguments)}}())}},{key:"tagPreset",value:function(e,t,n){null!==n&&void 0!==n||(n=0);S.getContract(E);return new Promise(function(){var a=Object(i.a)(s.a.mark(function a(r,i){var o;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:for(o=t.map(function(e){return E.utils.fromAscii(e)});o.length<4;)o.push(O);o.length>4&&(o=o.slice(0,4)),new f.a(m.d,"tagPreset",[Object(g.b)(e),o,n]).execute().then(function(){return r()});case 4:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"getTotalPresets",value:function(){var e=Object(i.a)(s.a.mark(function e(){var t,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new y.a(this.contract.options.address).from(k.t).select("user").select("title").select("contentHash"),e.next=3,t.executeQuery();case 3:return n=e.sent,e.abrupt("return",n.length);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getPresets",value:function(){var e=Object(i.a)(s.a.mark(function e(t,n){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPaginatedPresets(0,t,1e3,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getPaginatedPresets",value:function(){var e=Object(i.a)(s.a.mark(function e(t,n){var r,i,o,c,u,l,p,h=this,d=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=d.length>2&&void 0!==d[2]?d[2]:10,i=d.length>3&&void 0!==d[3]?d[3]:0,console.log("get paginted presets called with guildId = "+i),console.log("filter = "),console.log(n),o=new y.a(this.contract.options.address).from(k.t).select("user").select("encryptedName").select("contentHash").select("encryptedContentKey").select("publicKey").select("guildId").where("guildId",i),e.next=8,o.executeQuery();case 8:if(c=e.sent,this.isFilterEmpty(n)){e.next=13;break}return e.next=12,this.filterPresets(c,n);case 12:c=e.sent;case 13:if(0===i){e.next=31;break}return e.next=16,this.guilds.getGuildKey(i);case 16:u=e.sent,l=[],e.t0=s.a.keys(c);case 19:if((e.t1=e.t0()).done){e.next=28;break}return p=e.t1.value,e.t2=l,e.next=24,this.queryDecryptor.decryptQueryResult(c[p],u.privateKey);case 24:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=19;break;case 28:c=l,e.next=32;break;case 31:c=c.map(function(e){return Object(a.a)({},e,{title:h.web3.utils.toAscii("0x"+e.encryptedName)})});case 32:if(!(c.length<=t+r)){e.next=34;break}return e.abrupt("return",c.slice(t));case 34:return e.abrupt("return",c.slice(t,t+r));case 35:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"isFilterEmpty",value:function(e){for(var t in e.instrumentTypes)if(e.instrumentTypes[t])return!1;for(var n in e.tags)if(e.tags[n])return!1;return!0}},{key:"getPresetSampleHash",value:function(){var e=Object(i.a)(s.a.mark(function e(t){var n,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new y.a(this.contract.options.address).from(k.w).select("sampleHash").where("contentHash",t),e.next=3,n.executeQuery();case 3:if(0!==(a=e.sent).length){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",a[0].sampleHash);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPresetInstrumentType",value:function(){var e=Object(i.a)(s.a.mark(function e(t){var n,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new y.a(this.contract.options.address).from(k.v).select("instrumentType").where("contentHash",t),e.next=3,n.executeQuery();case 3:if(0!==(a=e.sent).length){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",a[0].instrumentType);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllTags",value:function(){var e=Object(i.a)(s.a.mark(function e(t){var n,a,r,i,o,c=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:0,!this.isFilterEmpty(t)){e.next=5;break}return e.next=4,this.getFilteredTags(void 0,void 0,n);case 4:return e.abrupt("return",e.sent);case 5:return e.next=7,this.getPresets(t,n);case 7:a=e.sent,r=[],e.t0=s.a.keys(a);case 10:if((e.t1=e.t0()).done){e.next=18;break}return i=e.t1.value,e.next=14,this.getTags(a[i].contentHash);case 14:(o=e.sent)&&(r=r.concat(o)),e.next=10;break;case 18:return e.abrupt("return",Array.from(new Set(r)));case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getFilteredTags",value:function(){var e=Object(i.a)(s.a.mark(function e(t,n){var a,r,i,o=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>2&&void 0!==o[2]?o[2]:0,r=new y.a(this.contract.address).from(k.x).where("guildId",a).select("tag"),void 0!==n&&r.where(t,n),e.next=5,r.executeQuery();case 5:return i=(i=e.sent).map(function(e){return e.tag}).filter(function(e){return""!==e}),e.abrupt("return",Array.from(new Set(i)));case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTags",value:function(){var e=Object(i.a)(s.a.mark(function e(t){var n,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new y.a(this.contract.address).from(k.x).select("tag").where("contentHash",t),e.next=3,n.executeQuery();case 3:return(a=(a=e.sent).map(function(e){return e.tag}).filter(function(e){return""!==e})).sort(),e.abrupt("return",Array.from(new Set(a)));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"filterPresets",value:function(){var e=Object(i.a)(s.a.mark(function e(t,n){var a,r,i,o,c,u,l,p,h,d,f,m,v,g,E;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=new Set,r=new Set,!n.instrumentTypes){e.next=15;break}e.t0=s.a.keys(n.instrumentTypes);case 4:if((e.t1=e.t0()).done){e.next=15;break}if(i=e.t1.value,n.instrumentTypes[i]){e.next=8;break}return e.abrupt("continue",4);case 8:return o=new y.a(this.contract.address).from(k.v).select("contentHash").where("instrumentType",i),e.next=11,o.executeQuery();case 11:for(u in c=e.sent)for(p in l=c[u].contentHash,t)t[p].contentHash===l&&a.add(t[p].contentHash);e.next=4;break;case 15:if(!n.tags){e.next=28;break}e.t2=s.a.keys(n.tags);case 17:if((e.t3=e.t2()).done){e.next=28;break}if(h=e.t3.value,n.tags[h]){e.next=21;break}return e.abrupt("continue",17);case 21:return d=new y.a(this.contract.address).from(k.x).select("contentHash").where("tag",h),e.next=24,d.executeQuery();case 24:for(m in f=e.sent)for(g in v=f[m].contentHash,t)t[g].contentHash===v&&r.add(t[g].contentHash);e.next=17;break;case 28:if(0!==a.size){e.next=32;break}return e.abrupt("return",this.convertToPresets(Array.from(r),t));case 32:if(0!==r.size){e.next=34;break}return e.abrupt("return",this.convertToPresets(Array.from(a),t));case 34:return E=Array.from(b(a,r)),e.abrupt("return",this.convertToPresets(E,t));case 36:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"convertToPresets",value:function(e,t){var n=[];for(var a in e)for(var r in t)t[r].contentHash===e[a]&&n.push(t[r]);return n}},{key:"getAllUserAddresses",value:function(){var e=Object(i.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),e}();t.a=w},601:function(e,t,n){"use strict";var a=n(3),r=n.n(a),s=n(11),i=n(1),o=n(2),c=n(134),u=n.n(c),l=n(37),p=n(5),h=n(197),d=n(16),f=function(){function e(t){Object(i.a)(this,e),this.store=t,this.masterKey=void 0,this.masterPublicKey=void 0,this.promptingPassword=!1}return Object(o.a)(e,[{key:"needsPassword",value:function(){return void 0===this.masterPublicKey}},{key:"isCorrectPassword",value:function(){var e=Object(s.a)(r.a.mark(function e(t){var n,a,s,i;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.encryption.getPublicKey();case 2:if(n=e.sent,console.log("public key = "+n),void 0!==n){e.next=6;break}return e.abrupt("return",!0);case 6:return a=u.a.generateRSAKey(t,1024),s=u.a.publicKeyString(a),i=n===s,e.abrupt("return",i);case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"syncPassword",value:function(){var e=Object(s.a)(r.a.mark(function e(){var t;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.masterPublicKey){e.next=4;break}return e.next=3,this.getPassword();case 3:this.password=e.sent;case 4:t=this.getPublicKeyAsBytes32(),d.a.encryption.newPublicKey(t);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getPublicKeyAsBytes32",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.masterPublicKey,t=d.a.web3.utils.toHex(e);return Object(h.a)(t)}},{key:"sleep",value:function(e){return new Promise(function(e,t){e()},e)}},{key:"getPassword",value:function(){var e=this;return this.passwordPromise?this.passwordPromise:(this.passwordPromise=new Promise(function(){var t=Object(s.a)(r.a.mark(function t(n,a){var s,i;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===e.masterPublicKey){t.next=3;break}return n(void 0),t.abrupt("return");case 3:return t.next=5,l.a.getAccount();case 5:if(s=t.sent,null===sessionStorage.getItem("user_password."+s)){t.next=14;break}if(i=sessionStorage.getItem("user_password."+s),console.log("password we got from cache = "+i),!e.isCorrectPassword(i)){t.next=13;break}return e.password=i,n(i),t.abrupt("return");case 13:console.log("was incorrect password...");case 14:e.store.dispatch(Object(p.ic)(function(t){void 0!==t?(e.password=t,n(t)):e.passwordPromise=void 0})),e.store.dispatch(Object(p.td)(!0));case 16:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()),this.passwordPromise)}},{key:"getPublicKeyIfNeeded",value:function(){var e=Object(s.a)(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=6;break}if(void 0!==this.masterPublicKey){e.next=5;break}return e.next=4,this.getPassword();case 4:this.password=e.sent;case 5:t=this.masterPublicKey;case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPrivateKeyIfNeeded",value:function(){var e=Object(s.a)(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=6;break}if(void 0!==this.masterKey){e.next=5;break}return e.next=4,this.getPassword();case 4:this.password=e.sent;case 5:t=this.masterKey;case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"password",set:function(e){void 0!==e&&(this.masterKey=u.a.generateRSAKey(e,1024),this.masterPublicKey=u.a.publicKeyString(this.masterKey),l.a.getAccount().then(function(t){console.log('setItem("user_password"'+t+","+e+")"),sessionStorage.setItem("user_password."+t,e)}))}}]),e}(),m=n(165),v=(n(1743),n(135)),g=n.n(v),b=n(35),y=function(){function e(t,n){Object(i.a)(this,e),this.ethereum=t,this.web3=this.ethereum.web3,this.passwordManager=new f(n),this.store=n}return Object(o.a)(e,[{key:"needsPassword",value:function(){return this.passwordManager.needsPassword()}},{key:"syncPassword",value:function(){var e=Object(s.a)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.passwordManager.syncPassword();case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"isCorrectPassword",value:function(){var e=Object(s.a)(r.a.mark(function e(t){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.passwordManager.isCorrectPassword(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPassword",value:function(){var e=Object(s.a)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.passwordManager.getPassword();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"generateGuildKey",value:function(e){var t=u.a.generateRSAKey(e,1024),n=u.a.publicKeyString(t),a=this.ethereum.web3.utils.toHex(n);return{publicKey:Object(h.a)(a),rawPublicKey:n,privateKey:t,passphrase:e}}},{key:"encryptAndSave",value:function(e,t,n){var a=this;!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new Promise(function(){var i=Object(s.a)(r.a.mark(function i(o,c){var u,l,p;return r.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,a.passwordManager.getPublicKeyIfNeeded(a.masterPublicKey);case 2:if(i.sent,(u=new m.a).encryptKey(a.masterPublicKey),!n){i.next=10;break}return i.next=8,a.ethereum.encryption.getEncryptedSequenceIfAny(n);case 8:void 0!==(l=i.sent)&&(u=l[0].contentKey,u=new m.a(g.a.utils.hex.toBytes(u)));case 10:return i.next=12,u.encryptContent(JSON.stringify(t));case 12:p=i.sent,b.a.addJson(p).then(function(){var t=Object(s.a)(r.a.mark(function t(s){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=a.ethereum.encryption,t.t1=n,t.t2=s,t.next=5,u.encryptContent(e);case 5:t.t3=t.sent,t.t4=u.convertForEthereum(),t.t5=a.passwordManager.getPublicKeyAsBytes32(),t.t0.newEncryptedSequence.call(t.t0,t.t1,t.t2,t.t3,t.t4,t.t5),o(s);case 10:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}());case 14:case"end":return i.stop()}},i)}));return function(e,t){return i.apply(this,arguments)}}())}},{key:"encryptRawContent",value:function(){var e=Object(s.a)(r.a.mark(function e(t,n){var a,s,i,o=arguments;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>2&&void 0!==o[2]?o[2]:this.masterPublicKey,s=o.length>3&&void 0!==o[3]&&o[3],i=o.length>4?o[4]:void 0,e.next=5,this.passwordManager.getPublicKeyIfNeeded(a);case 5:return a=e.sent,void 0===i&&(i=new m.a),i.encryptKey(a),e.t0=this.passwordManager.getPublicKeyAsBytes32(a),e.t1=i.convertForEthereum(),e.t2=i,e.next=13,i.encryptContent(t,s);case 13:return e.t3=e.sent,e.next=16,i.encryptContent(n);case 16:return e.t4=e.sent,e.t5=i.encryptedContentKey,e.abrupt("return",{publicKey:e.t0,encryptedContentKey:e.t1,contentKey:e.t2,encryptedContent:e.t3,encryptedName:e.t4,eCk:e.t5});case 19:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"encryptAndUploadJSON",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.masterPublicKey;return new Promise(function(){var a=Object(s.a)(r.a.mark(function a(s,i){var o;return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.encryptRawContent(JSON.stringify(e),"",n);case 2:o=a.sent,b.a.addJson(o.encryptedContent).then(function(e){return s({publicKey:o.publicKey,encryptedContentKey:o.encryptedContentKey,encryptedContentIpfsHash:e,contentKey:o.contentKey})});case 4:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"decryptName",value:function(){var e=Object(s.a)(r.a.mark(function e(t,n,a){var s;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t&&void 0!==t){e.next=2;break}return e.abrupt("return","");case 2:return e.next=4,this.passwordManager.getPrivateKeyIfNeeded(a);case 4:return a=e.sent,g.a.utils.hex.toBytes(t),e.next=8,this.decryptContentKey(n,a);case 8:if(void 0!==(s=e.sent)){e.next=11;break}return e.abrupt("return","");case 11:return e.next=13,s.decryptContent(t);case 13:return t=e.sent,e.abrupt("return",t);case 15:case"end":return e.stop()}},e,this)}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"decryptContentKey",value:function(){var e=Object(s.a)(r.a.mark(function e(t,n){var a,s;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.passwordManager.getPrivateKeyIfNeeded(n);case 2:if(n=e.sent,a=this.web3.utils.toAscii("0x"+t),"failure"!==(s=u.a.decrypt(a,n)).status){e.next=7;break}return e.abrupt("return",void 0);case 7:return e.abrupt("return",new m.a(s.plaintext));case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"fetchAndDecrypt",value:function(){var e=Object(s.a)(r.a.mark(function e(t,n){var a,s,i,o,c,u=arguments;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=u.length>2&&void 0!==u[2]&&u[2],new Date,void 0!==n.length&&(n=n[0]),s=n.contentKey,!a){e.next=10;break}return e.next=7,b.a.getSound(t);case 7:e.t0=e.sent,e.next=13;break;case 10:return e.next=12,b.a.getJson(t);case 12:e.t0=e.sent;case 13:return i=e.t0,e.next=16,this.passwordManager.getPrivateKeyIfNeeded();case 16:return o=new m.a(s),e.next=19,o.decryptContent(i,a);case 19:return c=e.sent,e.abrupt("return",c);case 21:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"stripHexPrefix",value:function(e){return 0===e.indexOf("0x")?e.slice(2):e}},{key:"strip",value:function(e,t){return e.slice(0,e.length-t)}},{key:"getPublicKeyFromBytes32",value:function(e){var t="0x";for(var n in e)t+=this.stripHexPrefix(e[n]);return t=this.strip(t,38),this.ethereum.web3.utils.toAscii(t)}},{key:"shareSequence",value:function(e,t){var n=this;return new Promise(function(){var a=Object(s.a)(r.a.mark(function a(s,i){var o,c;return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n.ethereum.encryption.getPublicKey(t);case 2:if(void 0!==(o=a.sent)){a.next=6;break}return i("User has no public key"),a.abrupt("return");case 6:c=u.a.encrypt(e.contentKey,o).cipher,c=n.web3.utils.toHex(c),n.ethereum.encryption.shareEncryptedContent(t,e.id,Object(h.a)(c),n.passwordManager.getPublicKeyAsBytes32()),s();case 10:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"store",set:function(e){this.passwordManager.store=e}},{key:"password",set:function(e){this.passwordManager.password=e}},{key:"masterPublicKey",get:function(){return this.passwordManager.masterPublicKey},set:function(e){this.passwordManager.masterPublicKey=e}},{key:"masterKey",get:function(){return this.passwordManager.masterKey}}]),e}();t.a=y},62:function(e,t,n){"use strict";var a=n(3),r=n.n(a),s=n(17),i=n(11),o=n(1),c=n(2),u=n(37);function l(e,t){return p.apply(this,arguments)}function p(){return(p=Object(i.a)(r.a.mark(function e(t,n){var a,s;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.eth.getTransaction(t);case 3:return a=e.sent,e.next=6,n.eth.getBlockNumber();case 6:return s=e.sent,e.abrupt("return",null===a.blockNumber?0:s-a.blockNumber);case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:case"end":return e.stop()}},e,null,[[0,10]])}))).apply(this,arguments)}var h=n(5),d=n(40),f={USERS:{setName:d.k.USERS.methods.setName,setProfileHash:d.k.USERS.methods.setProfileHash},TOKENIZED_SEQUENCES:{editSequence:d.k.TOKENIZED_SEQUENCES.methods.editSequence,buyTokens:d.k.TOKENIZED_SEQUENCES.methods.buyTokens},GUILD_SEQUENCES:{editSequence:d.k.GUILD_SEQUENCES.methods.editSequence},GUILD_PRESETS:{newPreset:d.k.GUILD_PRESETS.methods.newPreset,tagPreset:d.k.GUILD_PRESETS.methods.tagPreset},GUILDS:{newGuild:d.k.GUILDS.methods.newGuild,requestToAddMember:d.k.GUILDS.methods.requestToAddMember,leaveGuild:d.k.GUILDS.methods.leaveGuild,acceptRequestToAddToGuild:d.k.GUILDS.methods.acceptRequestToAddToGuild,rejectRequestToAddToGuild:d.k.GUILDS.methods.requestRequestToAddToGuild},GUILD_SAMPLES:{newSamplesWithMetadata:d.k.GUILD_SAMPLES.methods.newSamplesWithMetadata,newSampleWithMetadata:d.k.GUILD_SAMPLES.methods.newSampleWithMetadata,newEncryptedSamples:d.k.GUILD_SAMPLES.methods.newEncryptedSamples},ENCRYPTION:{setPublicKey:d.k.ENCRYPTION.methods.setPublicKey,newEncryptedContent:d.k.ENCRYPTION.methods.newEncryptedContent,shareEncryptedContentWith:d.k.ENCRYPTION.methods.newEncryptedContent},FOLDERS:{foldersUpdated:d.k.FOLDERS.methods.foldersUpdated},MESSAGING:{sendPublicMessage:d.k.MESSAGING.methods.sendPublicMessage},SEQUENCE_METADATA:{tagSequence:d.k.SEQUENCE_METADATA.methods.tagSequence,starSequence:d.k.SEQUENCE_METADATA.methods.starSequence,favoriteSequence:d.k.SEQUENCE_METADATA.methods.favoriteSequence,unfavoriteSequence:d.k.SEQUENCE_METADATA.methods.unfavoriteSequence,unstarSequence:d.k.SEQUENCE_METADATA.methods.unstarSequence},RESAMPLE:{newResample:d.k.RESAMPLE.methods.newResample},XANADU:{newDataType:d.k.XANADU.methods.newDataType,newLinkType:d.k.XANADU.methods.newLinkType,newAnnotationType:d.k.XANADU.methods.newAnnotationType,newLink:d.k.XANADU.methods.newLink,newLinks:d.k.XANADU.methods.newLinks,newAnnotation:d.k.XANADU.methods.newAnnotation}},m=n(16),v=function(){function e(t,n,a,r){Object(o.a)(this,e),this.contract=t,this.method=n,this.arguments=a,this.value=r}return Object(c.a)(e,[{key:"execute",value:function(){var e=this;return new Promise(function(){var t=Object(i.a)(r.a.mark(function t(n,a){var o,c,l;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.a.getAccount();case 2:if(void 0!==(o=t.sent)){t.next=6;break}return a(),t.abrupt("return");case 6:m.a.isMetamaskInstalled()?(l={from:o},e.value&&(l.value=e.value),(c=f[e.contract])[e.method].apply(c,Object(s.a)(e.arguments)).send(l,function(e,t){e?a(e):n()})):(console.log("runnign transaction"),fetch("/transaction/",{method:"POST",body:JSON.stringify(e.getJson()),headers:{Accept:"application/json","Content-Type":"application/json"},withCredentials:!0}).then(function(){var t=Object(i.a)(r.a.mark(function t(a){var s,i;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("returned ="),t.next=3,a.json();case 3:s=t.sent,i=s.transactionHash,console.log("transaction hash = "+i),e.newPendingTransaction(i),e.waitForConfirmation(i),n();case 9:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()));case 7:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"newPendingTransaction",value:function(e){this.transactions=[].concat(Object(s.a)(this.transactions),[e])}},{key:"waitForConfirmation",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;setTimeout(Object(i.a)(r.a.mark(function a(){return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,l(e,m.a.web3);case 2:if(!(a.sent>=n)){a.next=6;break}return t.onConfirm(e),a.abrupt("return");case 6:return a.abrupt("return",t.waitForConfirmation(e,n));case 7:case"end":return a.stop()}},a)})),5e3)}},{key:"onConfirm",value:function(e){var t=Object(s.a)(this.transactions),n=t.indexOf(e);n>-1&&(t.splice(n,1),this.transactions=t)}},{key:"getJson",value:function(){return{contract:this.contract,method:this.method,arguments:this.arguments,token:u.a.getToken(),value:this.value}}},{key:"transactions",get:function(){return m.a.store.getState().transactions.pendingTransactions},set:function(e){m.a.store.dispatch(Object(h.lc)(e))}}]),e}();t.a=v},708:function(e,t){},8:function(e,t,n){"use strict";n.d(t,"Fc",function(){return a}),n.d(t,"ld",function(){return r}),n.d(t,"Le",function(){return s}),n.d(t,"nb",function(){return i}),n.d(t,"mb",function(){return o}),n.d(t,"jd",function(){return c}),n.d(t,"jc",function(){return u}),n.d(t,"eb",function(){return l}),n.d(t,"fb",function(){return p}),n.d(t,"cb",function(){return h}),n.d(t,"Gc",function(){return d}),n.d(t,"Se",function(){return f}),n.d(t,"Te",function(){return m}),n.d(t,"Jc",function(){return v}),n.d(t,"a",function(){return g}),n.d(t,"m",function(){return b}),n.d(t,"g",function(){return y}),n.d(t,"e",function(){return k}),n.d(t,"f",function(){return E}),n.d(t,"k",function(){return S}),n.d(t,"i",function(){return O}),n.d(t,"h",function(){return w}),n.d(t,"b",function(){return C}),n.d(t,"Ve",function(){return P}),n.d(t,"Ue",function(){return T}),n.d(t,"Ce",function(){return j}),n.d(t,"We",function(){return x}),n.d(t,"u",function(){return N}),n.d(t,"pe",function(){return q}),n.d(t,"ye",function(){return M}),n.d(t,"id",function(){return D}),n.d(t,"Uc",function(){return A}),n.d(t,"Ee",function(){return R}),n.d(t,"ue",function(){return I}),n.d(t,"Be",function(){return L}),n.d(t,"Hb",function(){return F}),n.d(t,"Fb",function(){return V}),n.d(t,"Cc",function(){return B}),n.d(t,"Qb",function(){return U}),n.d(t,"Rb",function(){return H}),n.d(t,"Sb",function(){return J}),n.d(t,"Ob",function(){return G}),n.d(t,"Pb",function(){return z}),n.d(t,"kd",function(){return _}),n.d(t,"gd",function(){return W}),n.d(t,"Lb",function(){return K}),n.d(t,"Yd",function(){return Y}),n.d(t,"be",function(){return Q}),n.d(t,"md",function(){return X}),n.d(t,"Rc",function(){return Z}),n.d(t,"ub",function(){return $}),n.d(t,"sb",function(){return ee}),n.d(t,"Yc",function(){return te}),n.d(t,"Zc",function(){return ne}),n.d(t,"fc",function(){return ae}),n.d(t,"db",function(){return re}),n.d(t,"yb",function(){return se}),n.d(t,"Ae",function(){return ie}),n.d(t,"qe",function(){return oe}),n.d(t,"Pe",function(){return ce}),n.d(t,"ab",function(){return ue}),n.d(t,"Ke",function(){return le}),n.d(t,"ce",function(){return pe}),n.d(t,"he",function(){return he}),n.d(t,"Jb",function(){return de}),n.d(t,"Kb",function(){return fe}),n.d(t,"Nd",function(){return me}),n.d(t,"td",function(){return ve}),n.d(t,"Md",function(){return ge}),n.d(t,"Jd",function(){return be}),n.d(t,"Kd",function(){return ye}),n.d(t,"rd",function(){return ke}),n.d(t,"R",function(){return Ee}),n.d(t,"Nb",function(){return Se}),n.d(t,"Xd",function(){return Oe}),n.d(t,"yc",function(){return we}),n.d(t,"ad",function(){return Ce}),n.d(t,"Mc",function(){return Pe}),n.d(t,"Qc",function(){return Te}),n.d(t,"Vd",function(){return je}),n.d(t,"ac",function(){return xe}),n.d(t,"pb",function(){return Ne}),n.d(t,"Hc",function(){return qe}),n.d(t,"Vb",function(){return Me}),n.d(t,"se",function(){return De}),n.d(t,"dd",function(){return Ae}),n.d(t,"Ge",function(){return Re}),n.d(t,"cc",function(){return Ie}),n.d(t,"Je",function(){return Le}),n.d(t,"hb",function(){return Fe}),n.d(t,"He",function(){return Ve}),n.d(t,"sc",function(){return Be}),n.d(t,"rc",function(){return Ue}),n.d(t,"W",function(){return He}),n.d(t,"yd",function(){return Je}),n.d(t,"ke",function(){return Ge}),n.d(t,"Bc",function(){return ze}),n.d(t,"l",function(){return _e}),n.d(t,"Ud",function(){return We}),n.d(t,"hd",function(){return Ke}),n.d(t,"ae",function(){return Ye}),n.d(t,"t",function(){return Qe}),n.d(t,"r",function(){return Xe}),n.d(t,"s",function(){return Ze}),n.d(t,"we",function(){return $e}),n.d(t,"xe",function(){return et}),n.d(t,"Yb",function(){return tt}),n.d(t,"xb",function(){return nt}),n.d(t,"xc",function(){return at}),n.d(t,"Tb",function(){return rt}),n.d(t,"Dc",function(){return st}),n.d(t,"Ub",function(){return it}),n.d(t,"Gd",function(){return ot}),n.d(t,"ic",function(){return ct}),n.d(t,"Ad",function(){return ut}),n.d(t,"pd",function(){return lt}),n.d(t,"oe",function(){return pt}),n.d(t,"Fd",function(){return ht}),n.d(t,"Dd",function(){return dt}),n.d(t,"xd",function(){return ft}),n.d(t,"ze",function(){return mt}),n.d(t,"Re",function(){return vt}),n.d(t,"Zb",function(){return gt}),n.d(t,"Q",function(){return bt}),n.d(t,"Ec",function(){return yt}),n.d(t,"Qe",function(){return kt}),n.d(t,"O",function(){return Et}),n.d(t,"Ne",function(){return St}),n.d(t,"Oe",function(){return Ot}),n.d(t,"ec",function(){return wt}),n.d(t,"pc",function(){return Ct}),n.d(t,"oc",function(){return Pt}),n.d(t,"d",function(){return Tt}),n.d(t,"Xb",function(){return jt}),n.d(t,"lc",function(){return xt}),n.d(t,"q",function(){return Nt}),n.d(t,"p",function(){return qt}),n.d(t,"c",function(){return Mt}),n.d(t,"nd",function(){return Dt}),n.d(t,"od",function(){return At}),n.d(t,"Td",function(){return Rt}),n.d(t,"T",function(){return It}),n.d(t,"Y",function(){return Lt}),n.d(t,"X",function(){return Ft}),n.d(t,"S",function(){return Vt}),n.d(t,"zc",function(){return Bt}),n.d(t,"P",function(){return Ut}),n.d(t,"Oc",function(){return Ht}),n.d(t,"dc",function(){return Jt}),n.d(t,"Ld",function(){return Gt}),n.d(t,"sd",function(){return zt}),n.d(t,"Cd",function(){return _t}),n.d(t,"qc",function(){return Wt}),n.d(t,"Hd",function(){return Kt}),n.d(t,"j",function(){return Yt}),n.d(t,"vd",function(){return Qt}),n.d(t,"tb",function(){return Xt}),n.d(t,"Z",function(){return Zt}),n.d(t,"Wc",function(){return $t}),n.d(t,"Sc",function(){return en}),n.d(t,"Od",function(){return tn}),n.d(t,"gc",function(){return nn}),n.d(t,"wd",function(){return an}),n.d(t,"de",function(){return rn}),n.d(t,"gb",function(){return sn}),n.d(t,"hc",function(){return on}),n.d(t,"ee",function(){return cn}),n.d(t,"Kc",function(){return un}),n.d(t,"Pc",function(){return ln}),n.d(t,"ud",function(){return pn}),n.d(t,"lb",function(){return hn}),n.d(t,"vb",function(){return dn}),n.d(t,"ve",function(){return fn}),n.d(t,"Gb",function(){return mn}),n.d(t,"cd",function(){return vn}),n.d(t,"n",function(){return gn}),n.d(t,"Rd",function(){return bn}),n.d(t,"Ed",function(){return yn}),n.d(t,"Wb",function(){return kn}),n.d(t,"Pd",function(){return En}),n.d(t,"ob",function(){return Sn}),n.d(t,"Tc",function(){return On}),n.d(t,"bd",function(){return wn}),n.d(t,"Ib",function(){return Cn}),n.d(t,"kb",function(){return Pn}),n.d(t,"jb",function(){return Tn}),n.d(t,"ib",function(){return jn}),n.d(t,"Bb",function(){return xn}),n.d(t,"Ac",function(){return Nn}),n.d(t,"Ic",function(){return qn}),n.d(t,"rb",function(){return Mn}),n.d(t,"fe",function(){return Dn}),n.d(t,"re",function(){return An}),n.d(t,"De",function(){return Rn}),n.d(t,"Eb",function(){return In}),n.d(t,"Cb",function(){return Ln}),n.d(t,"Db",function(){return Fn}),n.d(t,"qb",function(){return Vn}),n.d(t,"Xc",function(){return Bn}),n.d(t,"Sd",function(){return Un}),n.d(t,"Zd",function(){return Hn}),n.d(t,"Nc",function(){return Jn}),n.d(t,"Id",function(){return Gn}),n.d(t,"bc",function(){return zn}),n.d(t,"mc",function(){return _n}),n.d(t,"kc",function(){return Wn}),n.d(t,"Bd",function(){return Kn}),n.d(t,"Vc",function(){return Yn}),n.d(t,"bb",function(){return Qn}),n.d(t,"vc",function(){return Xn}),n.d(t,"wc",function(){return Zn}),n.d(t,"Wd",function(){return $n}),n.d(t,"zd",function(){return ea}),n.d(t,"Qd",function(){return ta}),n.d(t,"Ie",function(){return na}),n.d(t,"tc",function(){return aa}),n.d(t,"U",function(){return ra}),n.d(t,"V",function(){return sa}),n.d(t,"Me",function(){return ia}),n.d(t,"Fe",function(){return oa}),n.d(t,"ge",function(){return ca}),n.d(t,"L",function(){return ua}),n.d(t,"F",function(){return la}),n.d(t,"x",function(){return pa}),n.d(t,"D",function(){return ha}),n.d(t,"v",function(){return da}),n.d(t,"K",function(){return fa}),n.d(t,"E",function(){return ma}),n.d(t,"J",function(){return va}),n.d(t,"N",function(){return ga}),n.d(t,"fd",function(){return ba}),n.d(t,"Ab",function(){return ya}),n.d(t,"zb",function(){return ka}),n.d(t,"ed",function(){return Ea}),n.d(t,"Mb",function(){return Sa}),n.d(t,"te",function(){return Oa}),n.d(t,"uc",function(){return wa}),n.d(t,"M",function(){return Ca}),n.d(t,"je",function(){return Pa}),n.d(t,"y",function(){return Ta}),n.d(t,"z",function(){return ja}),n.d(t,"A",function(){return xa}),n.d(t,"G",function(){return Na}),n.d(t,"I",function(){return qa}),n.d(t,"C",function(){return Ma}),n.d(t,"H",function(){return Da}),n.d(t,"B",function(){return Aa}),n.d(t,"Lc",function(){return Ra}),n.d(t,"wb",function(){return Ia}),n.d(t,"w",function(){return La}),n.d(t,"le",function(){return Fa}),n.d(t,"me",function(){return Va}),n.d(t,"qd",function(){return Ba}),n.d(t,"ne",function(){return Ua}),n.d(t,"nc",function(){return Ha}),n.d(t,"o",function(){return Ja}),n.d(t,"ie",function(){return Ga});var a=1,r=2,s=3,i=4,o=5,c=6,u=7,l=8,p=9,h=10,d=11,f=12,m=13,v=16,g=17,b=18,y=19,k=20,E=21,S=22,O=23,w=24,C=25,P=26,T=27,j=28,x=29,N=30,q=31,M=32,D=33,A=34,R=35,I=36,L=37,F=38,V=39,B=40,U=41,H=42,J=43,G=44,z=45,_=46,W=47,K=48,Y=49,Q=50,X=51,Z=52,$=53,ee=54,te=55,ne=56,ae=57,re=58,se=59,ie=60,oe=61,ce=62,ue=63,le=64,pe=65,he=66,de=67,fe=68,me=69,ve=70,ge=71,be=72,ye=73,ke=74,Ee=75,Se=76,Oe=77,we=78,Ce=79,Pe=80,Te=81,je=82,xe=83,Ne=84,qe=85,Me=86,De=87,Ae=88,Re=89,Ie=90,Le=91,Fe=92,Ve=93,Be=94,Ue=95,He=96,Je=97,Ge=98,ze=99,_e=100,We=101,Ke=102,Ye=103,Qe=104,Xe=105,Ze=106,$e=107,et=108,tt=109,nt=110,at=111,rt=112,st=113,it=114,ot=115,ct=116,ut=117,lt=118,pt=119,ht=120,dt=121,ft=122,mt=123,vt=124,gt=125,bt=126,yt=127,kt=128,Et=129,St=130,Ot=131,wt=132,Ct=133,Pt=134,Tt=135,jt=136,xt=137,Nt=138,qt=139,Mt=140,Dt=141,At=142,Rt=143,It=144,Lt=145,Ft=146,Vt=147,Bt=148,Ut=149,Ht=150,Jt=151,Gt=152,zt=153,_t=154,Wt=155,Kt=156,Yt=157,Qt=158,Xt=159,Zt=160,$t=161,en=162,tn=163,nn=164,an=165,rn=166,sn=167,on=168,cn=169,un=170,ln=171,pn=172,hn=173,dn=174,fn=175,mn=176,vn=178,gn=179,bn=180,yn=181,kn=182,En=183,Sn=184,On=185,wn=186,Cn=187,Pn=188,Tn=189,jn=190,xn=191,Nn=192,qn=193,Mn=194,Dn=195,An=196,Rn=197,In=198,Ln=199,Fn=200,Vn=201,Bn=202,Un=203,Hn=204,Jn=205,Gn=206,zn=207,_n=208,Wn=209,Kn=210,Yn=211,Qn=212,Xn=213,Zn=214,$n=215,ea=216,ta=217,na=218,aa=219,ra=220,sa=221,ia=222,oa=223,ca=224,ua=225,la=226,pa=229,ha=230,da=231,fa=232,ma=233,va=234,ga=235,ba=236,ya=237,ka=238,Ea=239,Sa=240,Oa=241,wa=242,Ca=243,Pa=244,Ta=245,ja=246,xa=247,Na=248,qa=249,Ma=250,Da=251,Aa=252,Ra=253,Ia=254,La=255,Fa=256,Va=257,Ba=258,Ua=259,Ha=260,Ja=261,Ga=262},833:function(e,t,n){},93:function(e,t,n){"use strict";var a=n(17),r=n(3),s=n.n(r),i=n(11),o=n(1),c=n(2),u=n(43),l=n.n(u),p=(n(31),n(26)),h="undefined"!==typeof window.web3,d=h?new l.a(window.web3.currentProvider):new l.a(new l.a.providers.HttpProvider("https://ropsten.infura.io/v3/2f3dce2af1044e88b4851c3d73c3d00c")),f=new l.a(new l.a.providers.WebsocketProvider("wss://ropsten.infura.io/ws/v3/2f3dce2af1044e88b4851c3d73c3d00c")),m=function(){function e(t){Object(o.a)(this,e),this.address=t,this.distinct=!1,this.selectStatements=[],this.whereClauses=[],this.groupBy=[],this.joinClauses=[],this.limitSize=void 0,this.fromBlockNumber="0x2",this.toBlockNumber=void 0}return Object(c.a)(e,[{key:"from",value:function(e){return this.eventLog=e,this}},{key:"select",value:function(e){return this.selectStatements.push(e),this}},{key:"distinct",value:function(){return this.distinct=!0,this}},{key:"groupBy",value:function(e){return this.groupBy.push(e),this}},{key:"where",value:function(e,t){return this.whereClauses.push(new v(e,t)),this}},{key:"whereIn",value:function(e,t){return this.whereClauses.push(new v(e,void 0,t)),this}},{key:"join",value:function(e,t){this.joinClauses.push(new g(e,t))}},{key:"fromBlock",value:function(e){return this.fromBlockNumber=d.utils.toHex(e),this}},{key:"toBlock",value:function(e){return this.toBlockNumber=d.utils.toHex(e),this}},{key:"limit",value:function(e){return this.limitSize=e,this}},{key:"getTopics",value:function(){var e=[d.utils.sha3(this.eventLog.event)];for(var t in this.eventLog.topics){var n=this.eventLog.topics[parseInt(t)],a=null;for(var r in this.whereClauses){var s=this.whereClauses[parseInt(r)];if(s.name===n.name){var i=void 0!==s.value?s.value:s.valueList[0];a=n.convertTo(i)}}e.push(a)}return e}},{key:"executeQuery",value:function(){var e=this;return new Promise(function(t,n){d.eth.getPastLogs({address:e.address,topics:e.getTopics(),toBlock:e.toBlockNumber,fromBlock:e.fromBlockNumber},function(a,r){if(a)n(a);else{var s=[];r.reverse();for(var i=Math.min(r.length,e.limitSize||r.length),o=0;o<i;o++)s.push(e.parseResult(r[o]));t(s)}})})}},{key:"watchQuery",value:function(){var e=Object(i.a)(s.a.mark(function e(t){var n,a=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.eth.getBlockNumber();case 2:n=e.sent,(h?d:f).eth.subscribe("logs",{address:this.address,topics:this.getTopics(),fromBlock:d.utils.toHex(n)},function(e,n){e&&(console.log("error watching "),console.log(e));var r=a.parseResult(n);console.log("watch query got "),console.log(r),t(r)});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"parseResult",value:function(e){if(void 0!==e&&null!==e){var t={};for(var n in this.selectStatements){var a=this.selectStatements[parseInt(n)];for(var r in this.eventLog.topics){var s=e.topics[1+parseInt(r)],i=this.eventLog.topics[parseInt(r)];i.name===a&&(t[a]=i.type.convertFrom(s))}var o=0;for(var c in this.eventLog.data){c=parseInt(c);var u=this.eventLog.data[c];if(void 0!==u&&a==u.name){var l=e.data.slice(2+o,2+o+u.size);l="0x"+l,u.type==p.m&&(l="0x"+e.data.slice(130+64*c)),t[a]=u.convertFrom(l)}o+=u.size}}return t.blockNumber=e.blockNumber,t}}},{key:"getCopy",value:function(){var t=new e(this.address);return t.eventLog=this.eventLog,t.selectStatements=Object(a.a)(this.selectStatements),t.joinClauses=Object(a.a)(this.joinClauses),t.groupBy=Object(a.a)(this.groupBy),t.fromBlockNumber=this.fromBlockNumber,t.toBlockNumber=this.toBlockNumber,t.limitSize=this.limitSize,t}},{key:"getJson",value:function(){return{address:this.address,eventLog:this.eventLog.event,selectStatements:Object(a.a)(this.selectStatements),whereClauses:Object(a.a)(this.whereClauses),joinClauses:Object(a.a)(this.joinClauses),groupBy:Object(a.a)(this.groupBy),fromBlockNumber:d.utils.hexToNumber(this.fromBlockNumber),toBlockNumber:void 0===this.toBlockNumber?void 0:d.utils.hexToNumber(this.toBlockNumber),limitSize:this.limitSize,distinct:this.distinct}}}]),e}(),v=function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];Object(o.a)(this,e),this.name=t,this.value=n,this.valueList=a},g=function e(t,n){Object(o.a)(this,e),this.event=t,this.field=n};t.a=m},984:function(e,t,n){},985:function(e,t,n){},986:function(e,t,n){},987:function(e,t,n){},988:function(e,t,n){},990:function(e,t,n){},991:function(e,t,n){},992:function(e,t,n){}},[[1074,1,2]]]);
//# sourceMappingURL=main.29fd3b69.chunk.js.map